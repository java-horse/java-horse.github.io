<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hexoæç¤ºæ¡†</title>
    <url>/post/46526.html</url>
    <content><![CDATA[<h2 id="æœ‰å›¾æ ‡çš„æç¤ºæ¡†"><a href="#æœ‰å›¾æ ‡çš„æç¤ºæ¡†" class="headerlink" title="æœ‰å›¾æ ‡çš„æç¤ºæ¡†"></a>æœ‰å›¾æ ‡çš„æç¤ºæ¡†</h2><div class="note default flat"><p>default æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note default %}</span><br><span class="line">default æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<div class="note primary flat"><p>primary æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note primary %}</span><br><span class="line">primary æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<div class="note success flat"><p>success æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note success %}</span><br><span class="line">success æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<div class="note info flat"><p>info æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note info %}</span><br><span class="line">info æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<div class="note warning flat"><p>warning æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note warning %}</span><br><span class="line">warning æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<div class="note danger flat"><p>danger æç¤ºå—æ ‡ç­¾</p>
</div>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note danger %}</span><br><span class="line">danger æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ä¸å¸¦å›¾æ ‡çš„æç¤ºæ¡†"><a href="#ä¸å¸¦å›¾æ ‡çš„æç¤ºæ¡†" class="headerlink" title="ä¸å¸¦å›¾æ ‡çš„æç¤ºæ¡†"></a>ä¸å¸¦å›¾æ ‡çš„æç¤ºæ¡†</h2><ul>
<li>ä¸å¸¦å›¾æ ‡çš„å†™æ³•å’Œä¸Šè¿°å†™æ³•ä¸€è‡´åªæ˜¯å†ä»£ç ä¸­åŠ å…¥ <code>no-icon</code> å³å¯</li>
<li>æ —å­ <figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">{% note info no-icon %}</span><br><span class="line">info æç¤ºå—æ ‡ç­¾</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<div class="note default no-icon flat"><p>default æç¤ºå—æ ‡ç­¾</p>
</div>
<div class="note primary no-icon flat"><p>primary æç¤ºå—æ ‡ç­¾</p>
</div>
<div class="note success no-icon flat"><p>success æç¤ºå—æ ‡ç­¾</p>
</div>
<div class="note info no-icon flat"><p>info æç¤ºå—æ ‡ç­¾</p>
</div>
<div class="note warning no-icon flat"><p>warning æç¤ºå—æ ‡ç­¾</p>
</div>
<div class="note danger no-icon flat"><p>danger æç¤ºå—æ ‡ç­¾</p>
</div>
]]></content>
      <categories>
        <category>ç”Ÿæ´»éšç¬”</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>GitåŸºç¡€æ“ä½œå‘½ä»¤</title>
    <url>/post/7884.html</url>
    <content><![CDATA[<h1 id="GitåŸºç¡€æ“ä½œå‘½ä»¤"><a href="#GitåŸºç¡€æ“ä½œå‘½ä»¤" class="headerlink" title="GitåŸºç¡€æ“ä½œå‘½ä»¤"></a>GitåŸºç¡€æ“ä½œå‘½ä»¤</h1><blockquote>
<p>é¡¹ç›®ä¸€èˆ¬ä¼šæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>master(main) ä¸»åˆ†æ”¯ï¼šç”¨äºä¿å­˜å‘å¸ƒçš„é¡¹ç›®ä»£ç </li>
<li>dev å¼€å‘åˆ†æ”¯ï¼š ç”¨äºä¿å­˜å¼€å‘è¿‡ç¨‹ä¸­çš„ä»£ç ï¼Œæ‰€æœ‰çš„ç»„å‘˜å°†è‡ªå·±å¼€å‘çš„ä»£ç æäº¤åˆ°è¯¥åˆ†æ”¯ä¸Š</li>
</ul>
</blockquote>
<h2 id="Gitå¸¸ç”¨å‘½ä»¤"><a href="#Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Gitå¸¸ç”¨å‘½ä»¤"></a>Gitå¸¸ç”¨å‘½ä»¤</h2><blockquote>
<ol>
<li><code>mkdir [å·¥ä½œç›®å½•]</code>ï¼šwindowså‘½ä»¤åˆ›å»ºå·¥ä½œç›®å½•ï¼ˆçœ‹èµ·æ¥å°±é«˜å¤§ä¸Šï¼‰</li>
<li><code>git init</code>ï¼šåˆå§‹åŒ–å½“å‰æ–‡ä»¶</li>
<li><code>git add .</code>ï¼šå°†æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº</li>
<li><code>git commit -m "[æäº¤è¯´æ˜]"</code>ï¼šå°†æš‚å­˜åŒºæ–‡ä»¶ä¸Šä¼ åˆ°æœ¬åœ°ä»“åº“</li>
<li><code>git remote add origin [ä½ çš„github/giteeçš„ä»“åº“åœ°å€]</code>ï¼šæ·»åŠ è¿œç¨‹ä»“åº“</li>
<li><code>git checkout -b dev</code>ï¼šåˆ›å»ºå¹¶åˆ‡æ¢åˆ°devåˆ†æ”¯</li>
<li><code>git push origin dev -u</code>ï¼š æ¨é€é¡¹ç›®æ–‡ä»¶åˆ°è¿œç¨‹åˆ›åº“çš„devåˆ†æ”¯ä¸Šï¼ˆå¦‚æœæ¨é€ä¸æˆåŠŸï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ  <code>-f</code> å‚æ•°ï¼Œæ‰§è¡Œå¼ºåˆ¶æ¨é€ï¼‰</li>
</ol>
</blockquote>
<p>Gitçš„å¸¸ç”¨å‘½ä»¤è¿œè¿œä¸æ­¢äºæ­¤ï¼Œéœ€è¦æˆ‘ä»¬ä¸æ–­çš„å­¦ä¹ ï¼ŒåŒæ—¶å¯ä»¥é…ç½®Gitå¯è§†åŒ–å·¥å…·ã€GitKrakenã€‘ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</p>
<h2 id="Gitç‰ˆæœ¬åˆ‡æ¢"><a href="#Gitç‰ˆæœ¬åˆ‡æ¢" class="headerlink" title="Gitç‰ˆæœ¬åˆ‡æ¢"></a>Gitç‰ˆæœ¬åˆ‡æ¢</h2><blockquote>
<p>ä¸»è¦å‘½ä»¤ï¼š</p>
<ul>
<li><code>git reset --hard [ç‰ˆæœ¬å·]</code>ï¼šæ ¹æ®å…·ä½“ç‰ˆæœ¬å·è¿›è¡Œç‰ˆæœ¬åˆ‡æ¢</li>
<li><code>git reflog</code>ï¼š æŸ¥çœ‹æ“ä½œè®°å½•ï¼ˆç”¨äºæŸ¥è¯¢<code>git log</code> å‘½ä»¤æ‰¾ä¸åˆ°çš„ç‰ˆæœ¬å·ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> F:\git_test î‚° î‚  master î‚°</span><br><span class="line"><span class="comment">// å½“å‰å·²ç»æäº¤è¿‡é¡¹ç›®çš„ä¸¤ä¸ªç‰ˆæœ¬</span></span><br><span class="line">$ git log</span><br><span class="line"><span class="function">commit <span class="title">f33ec4acb3dd5373d4d064c3288e473c9833654a</span> <span class="params">(HEAD -&gt; master)</span></span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 10:43:01 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    version 2</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">commit f71a3fd8a586d8b41f709ef989477af2d87f069e</span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 10:40:29 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    version 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function"><span class="comment">// åˆ‡æ¢ä¸ºç‰ˆæœ¬1</span></span></span><br><span class="line"><span class="function"><span class="comment">// HEAD^è¡¨ç¤ºå½“å‰ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬ï¼ŒHEAD^^è¡¨ç¤ºå½“å‰ç‰ˆæœ¬çš„å‰å‰ä¸ªç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨HEAD~1è¡¨ç¤ºå½“å‰ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬ï¼ŒHEAD~100è¡¨ç¤ºå½“å‰ç‰ˆæœ¬çš„å‰100ç‰ˆæœ¬ã€‚</span></span></span><br><span class="line"><span class="function">$ git reset --hard HEAD~1</span></span><br><span class="line"><span class="function">HEAD is now at f71a3fd version 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function"><span class="comment">// ç‰ˆæœ¬1çš„å†…å®¹åªç”¨1å¥è¯</span></span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function"><span class="comment">// æŸ¥çœ‹logæäº¤æ—¥å¿—ï¼Œå‘ç°ç‰ˆæœ¬2çš„è®°å½•æ¶ˆå¤±</span></span></span><br><span class="line"><span class="function">$ git log</span></span><br><span class="line"><span class="function">commit <span class="title">f71a3fd8a586d8b41f709ef989477af2d87f069e</span> <span class="params">(HEAD -&gt; master)</span></span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 10:40:29 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    version 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function"><span class="comment">// æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œè®°å½•ï¼Œå¯ä»¥æ‰¾åˆ°ç‰ˆæœ¬2çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è¿›è¡Œç‰ˆæœ¬åˆ‡æ¢</span></span></span><br><span class="line"><span class="function">$ git reflog</span></span><br><span class="line"><span class="function"><span class="title">f71a3fd</span> <span class="params">(HEAD -&gt; master)</span> HEAD@</span>{<span class="number">0</span>}: reset: moving to HEAD~<span class="number">1</span></span><br><span class="line">f33ec4a HEAD@{<span class="number">1</span>}: reset: moving to f33ec4acb3dd5373d4d064c3288e473c9833654a</span><br><span class="line">f71a3fd (HEAD -&gt; master) HEAD@{<span class="number">2</span>}: reset: moving to HEAD</span><br><span class="line">f71a3fd (HEAD -&gt; master) HEAD@{<span class="number">3</span>}: reset: moving to HEAD~<span class="number">1</span></span><br><span class="line">f33ec4a HEAD@{<span class="number">4</span>}: commit: version <span class="number">2</span></span><br><span class="line">f71a3fd (HEAD -&gt; master) HEAD@{<span class="number">5</span>}: commit (initial): version <span class="number">1</span></span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  master î‚°</span><br><span class="line"><span class="comment">// åˆ‡æ¢ä¸ºç‰ˆæœ¬2</span></span><br><span class="line">$ git reset --hard f33ec4a</span><br><span class="line">HEAD is now at f33ec4a version <span class="number">2</span></span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  master î‚°</span><br><span class="line"><span class="comment">// ç‰ˆæœ¬2å†…å®¹æœ‰2å¥è¯</span></span><br><span class="line">$ cat code.txt</span><br><span class="line">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span><br><span class="line"></span><br><span class="line">éƒ‘å·å¤§å­¦</span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  master î‚°</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Gitæ–‡ä»¶ä¿®æ”¹æ’¤é”€"><a href="#Gitæ–‡ä»¶ä¿®æ”¹æ’¤é”€" class="headerlink" title="Gitæ–‡ä»¶ä¿®æ”¹æ’¤é”€"></a>Gitæ–‡ä»¶ä¿®æ”¹æ’¤é”€</h2><blockquote>
<p>ç®¡ç†æ–‡ä»¶å¸¸è§åœºæ™¯ï¼š</p>
<ul>
<li>åœºæ™¯1ï¼šå½“ä¿®æ”¹äº†å·¥ä½œåŒºçš„æŸä¸ªæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œ<code>git add .</code>å‘½ä»¤å‰ï¼Œå‘ç°ä¿®æ”¹çš„ä¸å¥½ï¼Œæƒ³ç›´æ¥ä¸¢å¼ƒå½“å‰è‡ªå·±åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹æ—¶ï¼Œä½¿ç”¨å‘½ä»¤<code>git checkout -- [æ–‡ä»¶åç§°]</code>ç›´æ¥å›é€€æ–‡ä»¶å†…å®¹è‡³åˆå§‹</li>
<li>åœºæ™¯2ï¼šå½“ä¿®æ”¹äº†å·¥ä½œåŒºçš„å†…å®¹åï¼Œä½†æ˜¯å·²ç»æ‰§è¡Œ<code>git add .</code>å‘½ä»¤ï¼Œæƒ³è¦ä¸¢å¼ƒä¿®æ”¹æ—¶ï¼Œéœ€è¦æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤æ­¥éª¤ï¼š<ul>
<li>å…ˆæ‰§è¡Œ<code>git reset HEAD â€“ [æ–‡ä»¶åç§°]</code>å‘½ä»¤</li>
<li>å†æ‰§è¡Œ<code>git checkout -- [æ–‡ä»¶åç§°]</code>å‘½ä»¤</li>
</ul>
</li>
<li>åœºæ™¯3ï¼šå½“ä¿®æ”¹çš„å·¥ä½œå†…å®¹å·²ç»æ‰§è¡Œ<code>git commit -m "commit info"</code>å‘½ä»¤æäº¤åˆ°æœ¬åœ°ä»“åº“åï¼Œæƒ³è¦æ’¤é”€ä¿®æ”¹æ“ä½œï¼Œé‚£å°±åªèƒ½æ‰§è¡Œç‰ˆæœ¬å›é€€æ“ä½œå•¦<code>git reset --hard HEAD~x</code>(å›é€€åˆ°æŸä¸ªç‰ˆæœ¬,ä¸¢å¼ƒå·¥ä½œåŒºä»£ç )ï¼Œæˆ–è€…ä½¿ç”¨<code>git reset --soft HEAD~x</code>ï¼ˆå›é€€åˆ°æŸä¸ªç‰ˆæœ¬,ä¿ç•™å·¥ä½œåŒºä»£ç ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> F:\git_test î‚° î‚  master Â± î‚°</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€å¥å†…å®¹</span></span><br><span class="line">$ cat code.txt</span><br><span class="line">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span><br><span class="line"></span><br><span class="line">éƒ‘å·å¤§å­¦</span><br><span class="line"></span><br><span class="line">éƒ‘å·å·¥ä¸šå­¦é™¢</span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  master Â± î‚°</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes in working directory)</span><br><span class="line">        modified:   code.txt</span><br><span class="line"></span><br><span class="line"><span class="function">no changes added to <span class="title">commit</span> <span class="params">(use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function"><span class="comment">// å›é€€å†…å®¹ï¼Œç›´æ¥ä¸¢å¼ƒä¿®æ”¹å†…å®¹</span></span></span><br><span class="line"><span class="function">$ git checkout -- code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function"><span class="comment">//  å†…å®¹å›é€€æˆåŠŸ</span></span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å·¥ä¸šåº”ç”¨æŠ€æœ¯å­¦é™¢</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git status</span></span><br><span class="line"><span class="function">On branch master</span></span><br><span class="line"><span class="function">Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="function">  <span class="params">(use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span></span></span><br><span class="line"><span class="function">  <span class="params">(use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes in working directory)</span></span></span><br><span class="line"><span class="function">        modified:   code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">no changes added to <span class="title">commit</span> <span class="params">(use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git add .</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git status</span></span><br><span class="line"><span class="function">On branch master</span></span><br><span class="line"><span class="function">Changes to be committed:</span></span><br><span class="line"><span class="function">  <span class="params">(use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span></span></span><br><span class="line"><span class="function">        modified:   code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git reset HEAD code.txt</span></span><br><span class="line"><span class="function">Unstaged changes after reset:</span></span><br><span class="line"><span class="function">M       code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å·¥ä¸šåº”ç”¨æŠ€æœ¯å­¦é™¢</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git status</span></span><br><span class="line"><span class="function">On branch master</span></span><br><span class="line"><span class="function">Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="function">  <span class="params">(use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span></span></span><br><span class="line"><span class="function">  <span class="params">(use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes in working directory)</span></span></span><br><span class="line"><span class="function">        modified:   code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">no changes added to <span class="title">commit</span> <span class="params">(use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master Â± î‚°</span></span><br><span class="line"><span class="function">$ git checkout -- code.txt</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git status</span></span><br><span class="line"><span class="function">On branch master</span></span><br><span class="line"><span class="function">nothing to commit, working tree clean</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Gitåˆ†æ”¯åˆ›å»ºåˆå¹¶"><a href="#Gitåˆ†æ”¯åˆ›å»ºåˆå¹¶" class="headerlink" title="Gitåˆ†æ”¯åˆ›å»ºåˆå¹¶"></a>Gitåˆ†æ”¯åˆ›å»ºåˆå¹¶</h2><blockquote>
<p>åˆ†æ”¯çš„åˆ›å»ºåˆå¹¶ä»¥åŠåˆå¹¶ååˆ é™¤æœ¬åœ°å’Œè¿œç¨‹çš„åˆ†æ”¯åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š<code>git branch</code></li>
<li>æŸ¥çœ‹åˆ›åº“çš„å…¨éƒ¨åˆ†æ”¯ï¼š<code>git branch -a</code></li>
<li>åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼š <code>git checkout -b dev</code></li>
<li>åœ¨devåˆ†æ”¯ä¸Šä¿®æ”¹æ–‡ä»¶å¹¶åŒæ­¥ä¸Šä¼ åˆ°è¿œç¨‹åˆ†æ”¯ä¸Š(æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“æ­¥éª¤çœç•¥)ï¼š<code>git push --set-upstream origin dev</code></li>
<li>åˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯ï¼ˆå‡†å¤‡å°†devåˆ†æ”¯åˆå¹¶åˆ°æ­¤åˆ†æ”¯ä¸Šï¼‰ï¼š<code>git checkout master</code></li>
<li>åˆå¹¶æŸæŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼š<code>git merge dev</code></li>
<li>åˆå¹¶å®Œæˆåï¼Œåˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼š<code>git branch -d dev</code></li>
<li>åˆå¹¶å®Œæˆåï¼Œåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š<code>git push origin --delete dev</code></li>
<li>åˆ é™¤è¿œç¨‹åˆ†æ”¯çš„å¦å¤–ä¸€ç§ç”¨æ³•ï¼ˆä¸¤æ­¥å‘½ä»¤ï¼Œä¸æ¨èï¼‰ï¼š<code>git branch -rd origin/dev</code> &gt;&gt;&gt;&gt;&gt; <code>git push origin: dev</code></li>
<li>è‡³æ­¤ï¼Œåˆ›å»ºæ–°åˆ†æ”¯ä¿®æ”¹ä»£ç ï¼Œåˆå¹¶å®Œæˆåï¼Œåˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯çš„æ“ä½œå®Œæˆï¼ˆä¸‹é¢çš„ä»£ç æ­¥éª¤æ˜¾ç¤ºä¸å…¨ï¼Œä¸»è¦ç†è§£å‘½ä»¤å³å¯ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  dev Â± î‚°</span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  dev Â± î‚°</span><br><span class="line">$ git commit -m <span class="string">"devåˆ†æ”¯ version 1"</span></span><br><span class="line">[dev aeb86d5] devåˆ†æ”¯ version <span class="number">1</span></span><br><span class="line"> <span class="number">1</span> file changed, <span class="number">3</span> insertions(+)</span><br><span class="line"></span><br><span class="line"> F:\git_test î‚° î‚  dev î‚°</span><br><span class="line">$ git log</span><br><span class="line"><span class="function">commit <span class="title">aeb86d5a3906a88b249a47bdb8d80e4a05ea8953</span> <span class="params">(HEAD -&gt; dev)</span></span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 11:26:30 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    devåˆ†æ”¯ version 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">commit <span class="title">f33ec4acb3dd5373d4d064c3288e473c9833654a</span> <span class="params">(master)</span></span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 10:43:01 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    version 2</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">commit f71a3fd8a586d8b41f709ef989477af2d87f069e</span></span><br><span class="line"><span class="function">Author: é©¬æ»¨ &lt;3468449362@qq.com&gt;</span></span><br><span class="line"><span class="function">Date:   Fri May 7 10:40:29 2021 +0800</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    version 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  dev î‚°</span></span><br><span class="line"><span class="function">$ git checkout master</span></span><br><span class="line"><span class="function">Switched to branch 'master'</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git checkout dev</span></span><br><span class="line"><span class="function">Switched to branch 'dev'</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  dev î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">æˆ‘æ˜¯devåˆ†æ”¯ä¸‹åˆ›å»ºçš„å†…å®¹...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  dev î‚°</span></span><br><span class="line"><span class="function">$ git checkout master</span></span><br><span class="line"><span class="function">Switched to branch 'master'</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git merge dev</span></span><br><span class="line"><span class="function">Updating f33ec4a..aeb86d5</span></span><br><span class="line"><span class="function">Fast-forward</span></span><br><span class="line"><span class="function"> code.txt | 3 +++</span></span><br><span class="line"><span class="function"> 1 file changed, 3 <span class="title">insertions</span><span class="params">(+)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ cat code.txt</span></span><br><span class="line"><span class="function">æ­å·ç»¿ä¹‹å±…æœ‰é™å…¬å¸</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">éƒ‘å·å¤§å­¦</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">æˆ‘æ˜¯devåˆ†æ”¯ä¸‹åˆ›å»ºçš„å†…å®¹...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git branch -d dev</span></span><br><span class="line"><span class="function">Deleted branch <span class="title">dev</span> <span class="params">(was aeb86d5)</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git branch</span></span><br><span class="line"><span class="function">* master</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$ git branch -a</span></span><br><span class="line"><span class="function">* master</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> F:\git_test î‚° î‚  master î‚°</span></span><br><span class="line"><span class="function">$</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Gitåˆ†æ”¯æ–‡ä»¶å†²çªè§£å†³"><a href="#Gitåˆ†æ”¯æ–‡ä»¶å†²çªè§£å†³" class="headerlink" title="Gitåˆ†æ”¯æ–‡ä»¶å†²çªè§£å†³"></a>Gitåˆ†æ”¯æ–‡ä»¶å†²çªè§£å†³</h2><blockquote>
<ul>
<li>äº§ç”ŸåŸå› ï¼šå½“masteråˆ†æ”¯å’Œdevåˆ†æ”¯éƒ½æ“ä½œäº†åŒä¸€ä»½æ–‡ä»¶ï¼Œå¹¶ä¸”éƒ½è¿›æ¥commitæäº¤æ“ä½œï¼Œè¿™æ—¶è¿›è¡Œæ–‡ä»¶çš„mergeæ“ä½œï¼Œå°±æ˜¯äº§ç”Ÿæ–‡ä»¶å†²çªã€‚</li>
<li>è§£å†³æ–¹æ³•ï¼š æ‰‹åŠ¨åˆ é™¤å†²çªçš„åœ°æ–¹ï¼Œç„¶åé‡æ–°æ‰§è¡Œæš‚å­˜ã€æäº¤æ“ä½œã€‚</li>
</ul>
</blockquote>
<h2 id="Gitå…¶ä»–å‘½ä»¤"><a href="#Gitå…¶ä»–å‘½ä»¤" class="headerlink" title="Gitå…¶ä»–å‘½ä»¤"></a>Gitå…¶ä»–å‘½ä»¤</h2><blockquote>
<ul>
<li>ç¦ç”¨fast forwardåˆå¹¶æ–¹å¼ï¼š <code>git merge --no-ff -m "ç¦ç”¨fast forwardæ–¹å¼å¹¶é‡æ–°åˆå¹¶æäº¤" dev</code></li>
<li>ä¿®æ”¹commitä¿¡æ¯ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼ˆHEADï¼‰çš„commitä¿¡æ¯ï¼‰ï¼š <code>git commit --amend -m "update commit info version 6"</code></li>
<li>æš‚æ—¶å­˜å‚¨å·¥ä½œåŒºæ–‡ä»¶ï¼š<code>git stash</code></li>
<li>æŸ¥çœ‹æš‚å­˜æ–‡ä»¶åˆ—è¡¨ï¼š<code>git stash list</code></li>
<li>é‡Šæ”¾å­˜å‚¨çš„å·¥ä½œåŒºæ–‡ä»¶ï¼š<code>git stash pop</code></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>æ•ˆç‡å·¥å…·</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Github</tag>
        <tag>Gitee</tag>
      </tags>
  </entry>
  <entry>
    <title>GitKrakené…ç½®ä½¿ç”¨</title>
    <url>/post/25166.html</url>
    <content><![CDATA[<h2 id="GitKrakené…ç½®ä½¿ç”¨"><a href="#GitKrakené…ç½®ä½¿ç”¨" class="headerlink" title="GitKrakené…ç½®ä½¿ç”¨"></a>GitKrakené…ç½®ä½¿ç”¨</h2><p><code>ç¾å›¾æ¬£èµ</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210414212031.png" alt="ç¾å¥½äº‹åŠ¡"></p>
<h3 id="1-è½¯ä»¶ä»‹ç»"><a href="#1-è½¯ä»¶ä»‹ç»" class="headerlink" title="1. è½¯ä»¶ä»‹ç»"></a>1. è½¯ä»¶ä»‹ç»</h3><p>Gitæ˜¯ç°åœ¨æœ€æµè¡Œçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œåº”ç”¨èŒƒå›´éå¸¸å¹¿æ³›ã€‚æ¨èä¸€æ¬¾gitçš„å¯è§†åŒ–å·¥å…·ï¼Œè¿™æ¬¾ å·¥å…·ç‰¹åˆ«æ–¹ä¾¿ å®ƒçš„å®˜æ–¹å¦‚ä¸‹ï¼š<a href="https://www.gitkraken.com/">GitKrakenå®˜ç½‘</a></p>
<p>æ³¨æ„ï¼šè¯¥Gitå·¥å…·æœ€åä¸€ä¸ªå…è´¹ç‰ˆæœ¬ä¸º6.5.1ï¼Œä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼š<a href="https://release.axocdn.com/win64/GitKrakenSetup-6.5.1.exe">GitKraken 6.5.1ä¸‹è½½</a></p>
<h3 id="2-ä¸‹è½½å®‰è£…"><a href="#2-ä¸‹è½½å®‰è£…" class="headerlink" title="2. ä¸‹è½½å®‰è£…"></a>2. ä¸‹è½½å®‰è£…</h3><p>ç›´æ¥ç‚¹å‡»GitKrakenSetup-6.5.1.exeå®‰è£…ï¼Œæœ¬è¿‡ç¨‹æ— æ³•è‡ªå®šä¹‰å®‰è£…ä½ç½®ï¼ˆè®©äººéº»å¤´çš®ğŸ˜…ğŸ˜…ğŸ˜…ï¼‰</p>
<h3 id="3-å¿«é€Ÿé…ç½®"><a href="#3-å¿«é€Ÿé…ç½®" class="headerlink" title="3. å¿«é€Ÿé…ç½®"></a>3. å¿«é€Ÿé…ç½®</h3><p>æ‰“å¼€GitKrakenï¼Œæ‰¾åˆ° File â€”&gt; Preferences â€”&gt; Authentication  é…ç½®å½“å‰å…¬ç§é’¥ï¼Œå½“å‰è´¦æˆ·å…¬ç§é’¥éœ€è¦å’Œgit/githubå¯¼å…¥çš„ä¸€è‡´ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210414212529.png" alt="image-20210414212520739"></p>
<blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>æ£€æŸ¥è‡ªå·±å…¬ç§é’¥ æ˜¯å¦é…ç½®æ­£ç¡®ï¼Œè´¦æˆ·æ˜¯å¦åŒ¹é…ã€‚</li>
<li>æ£€æŸ¥ å½“å‰é…ç½®è·¯å¾„ ä¸­æ˜¯å¦åŒ…å« <code>ä¸­æ–‡</code> ï¼Œå¦‚æœåŒ…å«ä¼šæŠ¥é”™ï¼</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>æ•ˆç‡å·¥å…·</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitKraken</tag>
      </tags>
  </entry>
  <entry>
    <title>JDK1.8æ–°ç‰¹æ€§Optionalç®€å•ä½¿ç”¨</title>
    <url>/post/60013.html</url>
    <content><![CDATA[<h2 id="Optionalç±»ApiåŸºæœ¬ä½¿ç”¨"><a href="#Optionalç±»ApiåŸºæœ¬ä½¿ç”¨" class="headerlink" title="Optionalç±»ApiåŸºæœ¬ä½¿ç”¨"></a>Optionalç±»ApiåŸºæœ¬ä½¿ç”¨</h2><blockquote>
<p>Optionalä¸»è¦ç”¨äºå¯¹å•ä¸ªå¯¹è±¡çš„æ“ä½œ,å¦‚æœåƒé›†åˆ,æ•°ç»„ä¹‹ç±»çš„å¯¹è±¡,å»ºè®®ä½¿ç”¨Streamå¤„ç†</p>
</blockquote>
<h3 id="of"><a href="#of" class="headerlink" title="of"></a>of</h3><blockquote>
<p>æŠŠæŒ‡å®šçš„å€¼å°è£…ä¸ºOptionalå¯¹è±¡ï¼Œå¦‚æœæŒ‡å®šçš„å€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºNullPointerException</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠŠæŒ‡å®šçš„å€¼å°è£…ä¸ºOptionalå¯¹è±¡ï¼Œå¦‚æœæŒ‡å®šçš„å€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºNullPointerException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ofTest</span><span class="params">()</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line">    Optional&lt;String&gt; topsun = Optional.of(<span class="string">"topsun"</span>);</span><br><span class="line">    <span class="comment">// æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">    Optional&lt;String&gt; green = Optional.of(<span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.NullPointerException</span><br><span class="line">	at java.util.Objects.requireNonNull(Objects.java:<span class="number">203</span>)</span><br><span class="line">	at java.util.Optional.&lt;init&gt;(Optional.java:<span class="number">96</span>)</span><br><span class="line">	at java.util.Optional.of(Optional.java:<span class="number">108</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.ofTest(OptionalApi.java:<span class="number">21</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.main(OptionalApi.java:<span class="number">16</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ofNullable"><a href="#ofNullable" class="headerlink" title="ofNullable"></a>ofNullable</h3><blockquote>
<p>æŠŠæŒ‡å®šçš„å€¼å°è£…ä¸ºOptionalå¯¹è±¡ï¼Œå¦‚æœæŒ‡å®šçš„å€¼ä¸ºnullï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸ºæŒ‡å®šçš„å€¼åˆ›å»ºOptionalå¯¹è±¡ï¼Œä¸ç®¡æ‰€ä¼ å…¥çš„å€¼ä¸ºnullä¸ä¸ºnullï¼Œåˆ›å»ºçš„æ—¶å€™éƒ½ä¸ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ofNullableTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; topsun = Optional.ofNullable(<span class="string">"topsun"</span>);</span><br><span class="line"></span><br><span class="line">    Optional&lt;Object&gt; green = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="enpty"><a href="#enpty" class="headerlink" title="enpty"></a>enpty</h3><blockquote>
<p>åˆ›å»ºä¸€ä¸ªç©ºçš„Stringç±»å‹çš„Optionalå¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä¸€ä¸ªç©ºçš„Stringç±»å‹çš„Optionalå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">emptyTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><blockquote>
<p>å¦‚æœæˆ‘ä»¬åˆ›å»ºçš„Optionalå¯¹è±¡ä¸­æœ‰å€¼å­˜åœ¨åˆ™è¿”å›æ­¤å€¼ï¼Œå¦‚æœæ²¡æœ‰å€¼å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡º<br>NoSuchElementExceptionå¼‚å¸¸</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœæˆ‘ä»¬åˆ›å»ºçš„Optionalå¯¹è±¡ä¸­æœ‰å€¼å­˜åœ¨åˆ™è¿”å›æ­¤å€¼ï¼Œå¦‚æœæ²¡æœ‰å€¼å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡º</span></span><br><span class="line"><span class="comment"> * NoSuchElementExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; top = Optional.of(<span class="string">"æ³°æ™®æ£®"</span>);</span><br><span class="line">    Optional&lt;String&gt; green = Optional.ofNullable(<span class="string">"ç»¿ä¹‹å±…"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line">    logger.info(<span class="string">"of ==&gt; {}"</span>, top.get());</span><br><span class="line">    logger.info(<span class="string">"ofNullable ==&gt; {}"</span>, green.get());</span><br><span class="line">    logger.info(<span class="string">"empty ==&gt; {}"</span>, empty.get());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">11</span>:<span class="number">24</span>:<span class="number">39.639</span> [main] INFO com.topsun.optional.OptionalApi - of ==&gt; æ³°æ™®æ£®</span><br><span class="line"><span class="number">11</span>:<span class="number">24</span>:<span class="number">39.642</span> [main] INFO com.topsun.optional.OptionalApi - ofNullable ==&gt; ç»¿ä¹‹å±…</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.util.NoSuchElementException: No value present</span><br><span class="line">	at java.util.Optional.get(Optional.java:<span class="number">135</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.getTest(OptionalApi.java:<span class="number">62</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.main(OptionalApi.java:<span class="number">22</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="orElse"><a href="#orElse" class="headerlink" title="orElse"></a>orElse</h3><blockquote>
<p>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orElseTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å·²å­˜åœ¨çš„å€¼</span></span><br><span class="line">    logger.info(<span class="string">"è¿”å›å·²å­˜åœ¨çš„å€¼ ==&gt; {}"</span>, optional.orElse(<span class="string">"é‡‘å·å‹‡å£«é˜Ÿ"</span>));</span><br><span class="line">    <span class="comment">// è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">    logger.info(<span class="string">"è¿”å›é»˜è®¤å€¼ ==&gt; {}"</span>, empty.orElse(<span class="string">"ä¸­å›½ç”·ç¯®"</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">11</span>:<span class="number">31</span>:<span class="number">06.502</span> [main] INFO com.topsun.optional.OptionalApi - è¿”å›å·²å­˜åœ¨çš„å€¼ ==&gt; ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ</span><br><span class="line"><span class="number">11</span>:<span class="number">31</span>:<span class="number">06.505</span> [main] INFO com.topsun.optional.OptionalApi - è¿”å›é»˜è®¤å€¼ ==&gt; ä¸­å›½ç”·ç¯®</span><br></pre></td></tr></tbody></table></figure>
<h3 id="orElseGet"><a href="#orElseGet" class="headerlink" title="orElseGet"></a>orElseGet</h3><blockquote>
<p>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç”±Supplieræ¥å£ç”Ÿæˆçš„å€¼</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç”±Supplieræ¥å£ç”Ÿæˆçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orElseGetTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å·²å­˜åœ¨çš„å€¼</span></span><br><span class="line">    logger.info(<span class="string">"è¿”å›å·²å­˜åœ¨çš„å€¼ ==&gt; {}"</span>, optional.orElseGet(() -&gt; <span class="string">"é‡‘å·å‹‡å£«é˜Ÿ"</span>));</span><br><span class="line">    <span class="comment">// è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">    logger.info(<span class="string">"è¿”å›é»˜è®¤å€¼ ==&gt; {}"</span>, empty.orElseGet(() -&gt; <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">06</span>:<span class="number">29.831</span> [main] INFO com.topsun.optional.OptionalApi - è¿”å›å·²å­˜åœ¨çš„å€¼ ==&gt; ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ</span><br><span class="line"><span class="number">13</span>:<span class="number">06</span>:<span class="number">29.835</span> [main] INFO com.topsun.optional.OptionalApi - è¿”å›é»˜è®¤å€¼ ==&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="orElseThrow"><a href="#orElseThrow" class="headerlink" title="orElseThrow"></a>orElseThrow</h3><blockquote>
<p>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ªç”±æŒ‡å®šçš„Supplieræ¥å£ç”Ÿæˆçš„å¼‚å¸¸</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ªç”±æŒ‡å®šçš„Supplieræ¥å£ç”Ÿæˆçš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orElseThrowTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å·²å­˜åœ¨çš„å€¼</span></span><br><span class="line">    logger.info(optional.orElseThrow(() -&gt; <span class="keyword">new</span> Exception(<span class="string">"dfs"</span>)));</span><br><span class="line">    <span class="comment">// è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">    logger.info((String) empty.orElseThrow(() -&gt; <span class="keyword">new</span> Exception(<span class="string">"æŠ›å‡ºå¼‚å¸¸"</span>)));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">24</span>:<span class="number">40.207</span> [main] INFO com.topsun.optional.OptionalApi - ä¼‘æ–¯æ•¦ç«ç®­é˜Ÿ</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.Exception: æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">	at com.topsun.optional.OptionalApi.lambda$orElseThrowTest$<span class="number">3</span>(OptionalApi.java:<span class="number">100</span>)</span><br><span class="line">	at java.util.Optional.orElseThrow(Optional.java:<span class="number">290</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.orElseThrowTest(OptionalApi.java:<span class="number">100</span>)</span><br><span class="line">	at com.topsun.optional.OptionalApi.main(OptionalApi.java:<span class="number">24</span>)</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ç»“åˆä½¿ç”¨ï¼Œæ³¨æ„äº‹é¡¹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String trans_id = <span class="string">"100866666"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æŸ¥è¯¢é›†åˆæ•°æ®</span></span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šæŸ¥è¯¢æ•°æ®é›†åˆï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ Optional åˆ¤ç©ºæŠ›å¼‚å¸¸ï¼Œå› ä¸ºè¿”å›çš„ç»“æœä¸æ˜¯ nullï¼Œè€Œæ˜¯ç©ºé›†åˆï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼</span></span><br><span class="line">      List&lt;Transportation&gt; transportationList = transportationService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;Transportation&gt;()</span><br><span class="line">              .in(Transportation::getTrans_id, <span class="keyword">new</span> ArrayList&lt;&gt;(Collections.singletonList(trans_id))));</span><br><span class="line">      log.info(<span class="string">"&gt;&gt;&gt; transportationList: {}"</span>,transportationList);</span><br><span class="line">      Optional.ofNullable(transportationList).orElseThrow(() -&gt; <span class="keyword">new</span> BusinessException(<span class="string">"æ•°æ®ä¸å­˜åœ¨ï¼"</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æŸ¥è¯¢å•æ¡æ•°æ®</span></span><br><span class="line">      Transportation transportation = transportationService.getById(trans_id);</span><br><span class="line">      log.info(<span class="string">"&gt;&gt;&gt; transportation: {}"</span>,transportation);</span><br><span class="line">      Optional.ofNullable(transportation).orElseThrow(() -&gt; <span class="keyword">new</span> BusinessException(<span class="string">"æ•°æ®ä¸å­˜åœ¨ï¼"</span>));</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ç©ºé›†åˆï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line">&gt;&gt;&gt; transportationList: []</span><br><span class="line"><span class="comment">// nullå€¼ï¼ŒæŠ›å¼‚å¸¸</span></span><br><span class="line">&gt;&gt;&gt; transportation: <span class="keyword">null</span></span><br><span class="line">com.topsun.common.exception.BusinessException: æ•°æ®ä¸å­˜åœ¨ï¼</span><br></pre></td></tr></tbody></table></figure>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><blockquote>
<p>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼æ»¡è¶³filterä¸­çš„æ¡ä»¶ï¼Œåˆ™è¿”å›åŒ…å«è¯¥å€¼çš„Optionalå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡<br>æ³¨æ„: Optionalä¸­çš„filteræ–¹æ³•å’ŒStreamä¸­çš„filteræ–¹æ³•æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·çš„ï¼ŒStreamä¸­çš„filteræ–¹æ³•æ˜¯å¯¹ä¸€å †å…ƒç´ è¿›</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼æ»¡è¶³filterä¸­çš„æ¡ä»¶ï¼Œåˆ™è¿”å›åŒ…å«è¯¥å€¼çš„Optionalå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">filterTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"topsun"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœªæ»¡è¶³filteræ¡ä»¶,ç»§ç»­æ‰§è¡ŒorElse</span></span><br><span class="line">    logger.info(<span class="string">" ==&gt; {}"</span>, optional.filter(item -&gt; item.length() &lt; <span class="number">3</span>).orElse(<span class="string">"è¿‡æ»¤åè¿”å›çš„å€¼"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ»¡è¶³filteræ¡ä»¶,ç»§ç»­æ‰§è¡ŒorElse</span></span><br><span class="line">    logger.info(<span class="string">" ==&gt; {}"</span>, optional.filter(item -&gt; item.length() &gt; <span class="number">3</span>).orElse(<span class="string">"è¿‡æ»¤åè¿”å›çš„å€¼"</span>));</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">" ==&gt; "</span> + empty.filter(item -&gt; String.valueOf(item).length() &gt; <span class="number">3</span>).orElse(<span class="string">"è¿‡æ»¤åè¿”å›çš„å€¼"</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">38</span>:<span class="number">27.481</span> [main] INFO com.topsun.optional.OptionalApi -  ==&gt; è¿‡æ»¤åè¿”å›çš„å€¼</span><br><span class="line"><span class="number">13</span>:<span class="number">38</span>:<span class="number">27.484</span> [main] INFO com.topsun.optional.OptionalApi -  ==&gt; topsun</span><br><span class="line"><span class="number">13</span>:<span class="number">38</span>:<span class="number">27.485</span> [main] INFO com.topsun.optional.OptionalApi -  ==&gt; è¿‡æ»¤åè¿”å›çš„å€¼</span><br></pre></td></tr></tbody></table></figure>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><blockquote>
<p>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨,è¿”å›ä¸€ä¸ªè¢«OptionalåŒ…è£…çš„å¯¹è±¡,å¦‚æœå€¼ä¸å­˜åœ¨,è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨,è¿”å›ä¸€ä¸ªè¢«OptionalåŒ…è£…çš„å¯¹è±¡,å¦‚æœå€¼ä¸å­˜åœ¨,è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mapTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"topsun"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">"==&gt; "</span> + optional.map(item -&gt; item.toUpperCase()).orElse(<span class="string">"å¤±è´¥"</span>));</span><br><span class="line">    logger.info(<span class="string">"==&gt; "</span> + empty.map(item -&gt; String.valueOf(item).toUpperCase()).orElse(<span class="string">"å¤±è´¥"</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">47</span>:<span class="number">36.295</span> [main] INFO com.topsun.optional.OptionalApi - ==&gt; TOPSUN</span><br><span class="line"><span class="number">13</span>:<span class="number">47</span>:<span class="number">36.297</span> [main] INFO com.topsun.optional.OptionalApi - ==&gt; å¤±è´¥</span><br></pre></td></tr></tbody></table></figure>
<h3 id="isPresentå’ŒifPresent"><a href="#isPresentå’ŒifPresent" class="headerlink" title="isPresentå’ŒifPresent"></a>isPresentå’ŒifPresent</h3><blockquote>
<pre><code> isPresent: å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›false
 ifPresent: å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œè¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åš
</code></pre></blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * isPresent: å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment"> * ifPresent: å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œè¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">presentTest</span><span class="params">()</span> </span>{</span><br><span class="line">    Optional&lt;String&gt; optional = Optional.of(<span class="string">"topsun"</span>);</span><br><span class="line">    Optional&lt;Object&gt; empty = Optional.empty();</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">"optionalå€¼æ˜¯å¦å­˜åœ¨ ==&gt; "</span> + optional.isPresent());</span><br><span class="line">    logger.info(<span class="string">"emptyå€¼æ˜¯å¦å­˜åœ¨ ==&gt; "</span> + empty.isPresent());</span><br><span class="line"></span><br><span class="line">    optional.ifPresent(item -&gt; logger.info(<span class="string">"æ‰§è¡Œè°ƒç”¨ ==&gt; {}"</span>, item));</span><br><span class="line">    empty.ifPresent(item -&gt; logger.info(<span class="string">"==&gt; {}"</span>, item));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">59</span>:<span class="number">34.289</span> [main] INFO com.topsun.optional.OptionalApi - optionalå€¼æ˜¯å¦å­˜åœ¨ ==&gt; <span class="keyword">true</span></span><br><span class="line"><span class="number">13</span>:<span class="number">59</span>:<span class="number">34.291</span> [main] INFO com.topsun.optional.OptionalApi - emptyå€¼æ˜¯å¦å­˜åœ¨ ==&gt; <span class="keyword">false</span></span><br><span class="line"><span class="number">13</span>:<span class="number">59</span>:<span class="number">34.334</span> [main] INFO com.topsun.optional.OptionalApi - æ‰§è¡Œè°ƒç”¨ ==&gt; topsun</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>DFAç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤</title>
    <url>/post/6430.html</url>
    <content><![CDATA[<h2 id="DFAç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤"><a href="#DFAç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤" class="headerlink" title="DFAç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤"></a>DFAç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤</h2><h3 id="å¼•å…¥æ•æ„Ÿè¯æ–‡ä»¶"><a href="#å¼•å…¥æ•æ„Ÿè¯æ–‡ä»¶" class="headerlink" title="å¼•å…¥æ•æ„Ÿè¯æ–‡ä»¶"></a>å¼•å…¥æ•æ„Ÿè¯æ–‡ä»¶</h3><blockquote>
<p>å°†æ•æ„Ÿè¯åº“æ–‡ä»¶<code>sensitive-words.txt</code>æ”¾åˆ°<code>resources</code>ç›®å½•ä¸‹,æ–‡ä»¶å¤ªå¤§ï¼Œåœ¨è¿™é‡Œå°±è±¡å¾æ€§å¼•å…¥ä¸€ä¸‹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">å›æ°‘åƒçŒªè‚‰</span><br><span class="line">ä¹ è¿‘å¹³</span><br><span class="line">TMD</span><br><span class="line">æ¯›æ°‘è¿›å…š</span><br><span class="line">æœºå§</span><br><span class="line">è”å›½</span><br><span class="line"><span class="number">1989</span>å…­å››</span><br><span class="line">æ€§çˆ±ç”µå½±</span><br><span class="line">æçº¢æ™º</span><br><span class="line">æ¢å…‰çƒˆ</span><br><span class="line">......</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆ›å»ºèŠ‚ç‚¹å®ä¾‹"><a href="#åˆ›å»ºèŠ‚ç‚¹å®ä¾‹" class="headerlink" title="åˆ›å»ºèŠ‚ç‚¹å®ä¾‹"></a>åˆ›å»ºèŠ‚ç‚¹å®ä¾‹</h3><blockquote>
<p>åˆ›å»ºæ•æ„Ÿè¯è¿‡æ»¤å‰ç¼€æ ‘çš„èŠ‚ç‚¹å®ä¾‹<code>TrieNode</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler.sensitive;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ•æ„Ÿè¯è¿‡æ»¤å‰ç¼€æ ‘</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/31 8:53</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤çš„å…³é”®è¯ç»“æŸæ ‡è¯†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isKeyWordEnd = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Character, TrieNode&gt; subNodes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isKeyWordEnd</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> isKeyWordEnd;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeyWordEnd</span><span class="params">(<span class="keyword">boolean</span> keyWordEnd)</span> </span>{</span><br><span class="line">        isKeyWordEnd = keyWordEnd;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> character</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubNode</span><span class="params">(Character character, TrieNode node)</span> </span>{</span><br><span class="line">        subNodes.put(character, node);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> character</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TrieNode <span class="title">getSubNode</span><span class="params">(Character character)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> subNodes.get(character);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆå§‹åŒ–åŠ è½½è¯åº“"><a href="#åˆå§‹åŒ–åŠ è½½è¯åº“" class="headerlink" title="åˆå§‹åŒ–åŠ è½½è¯åº“"></a>åˆå§‹åŒ–åŠ è½½è¯åº“</h3><blockquote>
<p>ä½¿ç”¨<code>CommandLineRunner</code>æ“ä½œï¼šæœåŠ¡å¯åŠ¨è¿‡ç¨‹ä¸­å¼‚æ­¥åŠ è½½æ•æ„Ÿè¯åˆ°å‰ç¼€æ ‘,ç»„å»ºæ•æ„Ÿè¯åº“</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.init;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.handler.sensitive.SensitiveFilterHandler;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.util.ThreadUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: åˆå§‹åŒ–æ•æ„Ÿè¯åº“: æœåŠ¡å¯åŠ¨è¿‡ç¨‹ä¸­,åŠ è½½æ•æ„Ÿè¯åˆ°å‰ç¼€æ ‘,é€æ¸æ•æ„Ÿè¯åº“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/31 9:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveWordInit</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SensitiveFilterHandler sensitiveFilterHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        ThreadUtils.executor.execute(<span class="keyword">new</span> KeyWordsInit());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">KeyWordsInit</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">            watch.start();</span><br><span class="line">            log.info(<span class="string">" ==&gt; å¼€å§‹åˆå§‹åŒ–æ•æ„Ÿè¯åº“..."</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">// åŠ è½½æ•æ„Ÿè¯æ–‡ä»¶</span></span><br><span class="line">                InputStream resource = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">"sensitive-words.txt"</span>);</span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(resource));</span><br><span class="line">                <span class="comment">// å¼‚æ­¥åŠ è½½æ•æ„Ÿè¯æ–‡ä»¶å¹¶ä¸»é”®è¯åº“</span></span><br><span class="line">                String keyWord;</span><br><span class="line">                <span class="keyword">while</span> ((keyWord = reader.readLine()) != <span class="keyword">null</span>) {</span><br><span class="line">                    sensitiveFilterHandler.addKeyWord(keyWord);</span><br><span class="line">                }</span><br><span class="line">                watch.stop();</span><br><span class="line">                log.info(<span class="string">" ==&gt; åˆå§‹åŒ–æ•æ„Ÿè¯åº“å…±è€—æ—¶: {}ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                log.error(<span class="string">" ==&gt; æ•æ„Ÿè¯åº“åˆå§‹åŒ–å¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ThreadUtilsçº¿ç¨‹æ± å·¥å…·ç±»"><a href="#ThreadUtilsçº¿ç¨‹æ± å·¥å…·ç±»" class="headerlink" title="ThreadUtilsçº¿ç¨‹æ± å·¥å…·ç±»"></a>ThreadUtilsçº¿ç¨‹æ± å·¥å…·ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.ThreadFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰çº¿ç¨‹æ± å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/10 14:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºåŸºäºguavaå¼€æºç±»åº“çš„çº¿ç¨‹å·¥å‚(è¿™ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹å,æ¯”è¾ƒæ–¹ä¾¿ä¸”å®‰å…¨)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadFactory threadFactory = <span class="keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="string">"SystemThreadPool-%d"</span>).build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºçº¿ç¨‹æ± (åˆ©ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹å·¥å‚)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, TimeUnit.SECONDS, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">30</span>), threadFactory);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ•æ„Ÿè¯è¿‡æ»¤å¤„ç†å®ç°"><a href="#æ•æ„Ÿè¯è¿‡æ»¤å¤„ç†å®ç°" class="headerlink" title="æ•æ„Ÿè¯è¿‡æ»¤å¤„ç†å®ç°"></a>æ•æ„Ÿè¯è¿‡æ»¤å¤„ç†å®ç°</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler.sensitive;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.constants.BlogConstants;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.CharUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ•æ„Ÿè¯è¿‡æ»¤å¤„ç†å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/31 8:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilterHandler</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TrieNode rootNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¸€ä¸ªæ•æ„Ÿè¯æ·»åŠ åˆ°å‰ç¼€æ ‘èŠ‚ç‚¹ä¸­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyWord</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addKeyWord</span><span class="params">(String keyWord)</span> </span>{</span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="keyword">int</span> length = keyWord.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) {</span><br><span class="line">            <span class="keyword">char</span> ch = keyWord.charAt(i);</span><br><span class="line">            TrieNode subNode = tempNode.getSubNode(ch);</span><br><span class="line">            <span class="keyword">if</span> (subNode == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">// åˆå§‹åŒ–èŠ‚ç‚¹: è®¾ç½®å­èŠ‚ç‚¹</span></span><br><span class="line">                subNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line">                tempNode.addSubNode(ch, subNode);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// è®¾ç½®subNodeæŒ‡å‘ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹,è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯</span></span><br><span class="line">            tempNode = subNode;</span><br><span class="line">            <span class="comment">// è®¾ç½®ç»“æŸæ ‡è¯†</span></span><br><span class="line">            <span class="keyword">if</span> (i == length - <span class="number">1</span>) {</span><br><span class="line">                tempNode.setKeyWordEnd(<span class="keyword">true</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦ä¸ºç¬¦å·</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> c</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSymbol</span><span class="params">(Character c)</span> </span>{</span><br><span class="line">        <span class="comment">// 0x2E80~0x9FFF æ˜¯ä¸œäºšæ–‡å­—èŒƒå›´</span></span><br><span class="line">        <span class="keyword">return</span> !CharUtils.isAsciiAlphanumeric(c) &amp;&amp; (c &lt; <span class="number">0x2E80</span> || c &gt; <span class="number">0x9FFF</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤æ•æ„Ÿè¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterSensitiveWord</span><span class="params">(String text)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æŒ‡é’ˆ1</span></span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="comment">//æŒ‡é’ˆ2</span></span><br><span class="line">        <span class="keyword">int</span> begin = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//æŒ‡é’ˆ3</span></span><br><span class="line">        <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//ç»“æœ</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">while</span> (position &lt; text.length()) {</span><br><span class="line">            <span class="keyword">char</span> c = text.charAt(position);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            	è·³è¿‡ç¬¦å·</span></span><br><span class="line"><span class="comment">            	æƒ…å†µä¸€ï¼šç¬¦å·åœ¨æ•æ„Ÿè¯å‰é¢ï¼Œå°†ç¬¦å·å†™å…¥ç»“æœï¼Œå¦‚ â˜†æ•æ„Ÿè¯</span></span><br><span class="line"><span class="comment">            	æƒ…å†µäºŒï¼šç¬¦å·åœ¨æ•æ„Ÿè¯ä¸­é—´ï¼Œåˆ™å°†ç¬¦å·ä¸æ•æ„Ÿè¯ä¸€èµ·æ›¿æ¢ï¼Œå¦‚æ•â˜†æ„Ÿâ˜†è¯</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">if</span> (isSymbol(c)) {</span><br><span class="line">                <span class="comment">//è‹¥æŒ‡é’ˆ1å¤„äºæ ¹èŠ‚ç‚¹ï¼Œå¯¹åº”æƒ…å†µä¸€ï¼Œå°†ç¬¦å·è®¡å…¥ç»“æœï¼Œè®©æŒ‡é’ˆ2å‘ä¸‹èµ°ä¸€æ­¥</span></span><br><span class="line">                <span class="keyword">if</span> (tempNode == rootNode) {</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                    begin++;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//æ— è®ºç¬¦å·åœ¨å¼€å¤´è¿˜æ˜¯æ•æ„Ÿè¯ä¸­é—´ï¼ŒæŒ‡é’ˆ3éƒ½å‘ä¸‹èµ°ä¸€æ­¥</span></span><br><span class="line">                position++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ£€æŸ¥ä¸‹çº§èŠ‚ç‚¹</span></span><br><span class="line">            tempNode = tempNode.getSubNode(c);</span><br><span class="line">            <span class="keyword">if</span> (tempNode == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">//ä»¥beginå¼€å¤´çš„çš„å­—ç¬¦ä¸²ä¸æ˜¯æ•æ„Ÿè¯</span></span><br><span class="line">                sb.append(text.charAt(begin));</span><br><span class="line">                <span class="comment">//æŒ‡é’ˆ2å’ŒæŒ‡é’ˆ3å…±åŒæŒ‡å‘æŒ‡é’ˆ2çš„ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">                position = ++begin;</span><br><span class="line">                <span class="comment">//æŒ‡é’ˆ1é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (tempNode.isKeyWordEnd()) {</span><br><span class="line">                <span class="comment">//å‘ç°æ•æ„Ÿè¯ï¼Œå°†begin~positionå­—ç¬¦ä¸²æ›¿æ¢: ***</span></span><br><span class="line">                sb.append(BlogConstants.REPLACEMENT);</span><br><span class="line">                <span class="comment">//è¿›å…¥ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">                begin = ++position;</span><br><span class="line">                <span class="comment">//æŒ‡é’ˆ1é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">                position++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å°†æœ€åä¸€æ‰¹å­—ç¬¦è®¡å…¥ç»“æœ</span></span><br><span class="line">        sb.append(text.substring(begin));</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æµ‹è¯•ç»“æœï¼švery nice!</p>
<p><img src="https://i.loli.net/2021/05/24/uSjR24PvBDkomGg.gif" alt="ç‡¥èµ·æ¥"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>DFA</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®¢æˆ·ç«¯è¯·æ±‚ç®€å•å®ç°</title>
    <url>/post/38160.html</url>
    <content><![CDATA[<h1 id="HttpClientç¤ºä¾‹å¦‚ä¸‹ï¼š"><a href="#HttpClientç¤ºä¾‹å¦‚ä¸‹ï¼š" class="headerlink" title="HttpClientç¤ºä¾‹å¦‚ä¸‹ï¼š"></a>HttpClientç¤ºä¾‹å¦‚ä¸‹ï¼š</h1><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// httpClientçš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// æ™®é€šgetè¯·æ±‚</span></span><br><span class="line">String url = <span class="string">"http://www.horsemuzi.top"</span>;</span><br><span class="line"><span class="comment">// è·å–httpClientå®¢æˆ·ç«¯</span></span><br><span class="line">CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class="line"><span class="comment">// è®¾ç½®ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£</span></span><br><span class="line">HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line"><span class="comment">// è¶…æ—¶è®¾ç½®(å•ä½:ms)</span></span><br><span class="line">RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">        .setConnectTimeout(<span class="number">5000</span>) <span class="comment">// è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        .setConnectionRequestTimeout(<span class="number">5000</span>) <span class="comment">// è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        .setSocketTimeout(<span class="number">10000</span>) <span class="comment">// è®¾ç½®socketè¯»å†™è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        .setRedirectsEnabled(<span class="keyword">true</span>) <span class="comment">// æ˜¯å¦å…è®¸é‡å®šå‘(é»˜è®¤ä¸ºtrue)</span></span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">// å°†é…ç½®åŠ è½½åˆ°è¿™ä¸ªGETè¯·æ±‚ä¸­</span></span><br><span class="line">httpGet.setConfig(requestConfig);</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯å‘èµ·getè¯·æ±‚</span></span><br><span class="line">    response = httpClient.execute(httpGet);</span><br><span class="line">    <span class="comment">// è·å–å“åº”å®ä½“</span></span><br><span class="line">    HttpEntity responseEntity = response.getEntity();</span><br><span class="line">    <span class="comment">// è·å–å“åº”çŠ¶æ€</span></span><br><span class="line">    System.out.println(<span class="string">"å“åº”çŠ¶æ€:"</span> + response.getStatusLine().getStatusCode());</span><br><span class="line">    <span class="keyword">if</span> (responseEntity != <span class="keyword">null</span>) {</span><br><span class="line">        System.out.println(<span class="string">"å“åº”å†…å®¹é•¿åº¦:"</span> + responseEntity.getContentLength() + <span class="string">"==å“åº”å†…å®¹ç±»å‹:"</span> + responseEntity.getContentType());</span><br><span class="line">        System.out.println(<span class="string">"ç›¸åº”å†…å®¹:"</span> + EntityUtils.toString(responseEntity, StandardCharsets.UTF_8));</span><br><span class="line">    }</span><br><span class="line">} <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">} <span class="keyword">finally</span> {</span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) {</span><br><span class="line">            httpClient.close();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (response != <span class="keyword">null</span>) {</span><br><span class="line">            response.close();</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="HuToolå·¥å…·ç±»HttpUtilç¤ºä¾‹å¦‚ä¸‹ï¼š"><a href="#HuToolå·¥å…·ç±»HttpUtilç¤ºä¾‹å¦‚ä¸‹ï¼š" class="headerlink" title="HuToolå·¥å…·ç±»HttpUtilç¤ºä¾‹å¦‚ä¸‹ï¼š"></a>HuToolå·¥å…·ç±»HttpUtilç¤ºä¾‹å¦‚ä¸‹ï¼š</h1><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String url = <span class="string">"http://www.horsemuzi.top"</span>;</span><br><span class="line">        <span class="comment">// å‘é€è‡ªå®šä¹‰è¯·æ±‚ç­–ç•¥</span></span><br><span class="line">        HttpResponse response = HttpRequest.get(url)</span><br><span class="line">                .charset(StandardCharsets.UTF_8)</span><br><span class="line">                .timeout(<span class="number">5000</span>)</span><br><span class="line">                .execute();</span><br><span class="line">        System.out.println(<span class="string">"å“åº”çŠ¶æ€ç :"</span> + response.getStatus());</span><br><span class="line">        System.out.println(<span class="string">"cookiesé›†åˆ:"</span> + response.getCookies());</span><br><span class="line">        System.out.println(<span class="string">"å“åº”å†…å®¹:"</span> + response.body());</span><br><span class="line">        response.close();</span><br></pre></td></tr></tbody></table></figure>
<p><strong>å…¶ä»–æ–¹å¼çš„è¯·æ±‚ï¼ŒåŸºæœ¬éƒ½ä¸€æ ·ï¼ŒHuToolå·¥å…·ç±»ç›¸å¯¹æ¥è¯´ï¼Œæ“ä½œæ›´åŠ ç®€å•</strong></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>HttpClient</tag>
      </tags>
  </entry>
  <entry>
    <title>Interceptoræ‹¦æˆªå™¨å’ŒFilterè¿‡æ»¤å™¨åŸºæ“</title>
    <url>/post/36074.html</url>
    <content><![CDATA[<h2 id="Interceptoræ‹¦æˆªå™¨å’ŒFilterè¿‡æ»¤å™¨åŸºæ“"><a href="#Interceptoræ‹¦æˆªå™¨å’ŒFilterè¿‡æ»¤å™¨åŸºæ“" class="headerlink" title="Interceptoræ‹¦æˆªå™¨å’ŒFilterè¿‡æ»¤å™¨åŸºæ“"></a>Interceptoræ‹¦æˆªå™¨å’ŒFilterè¿‡æ»¤å™¨åŸºæ“</h2><h3 id="æ•´ä½“å›¾ç¤º"><a href="#æ•´ä½“å›¾ç¤º" class="headerlink" title="æ•´ä½“å›¾ç¤º"></a>æ•´ä½“å›¾ç¤º</h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210713103820.jpg" alt="æ•´ä½“å›¾ç¤º"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210713103854.jpg" alt="æ‰§è¡Œæµç¨‹"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210713104126.jpg" alt="è¯¦ç»†å›¾ç¤º"></p>
<blockquote>
<p>ç®€æï¼š</p>
<ul>
<li><p>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ ï¼šå¯ä»¥æ‹¿åˆ°åŸå§‹çš„httpè¯·æ±‚ï¼Œä½†æ˜¯æ‹¿ä¸åˆ°ä½ è¯·æ±‚çš„æ§åˆ¶å™¨å’Œè¯·æ±‚æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•çš„ä¿¡æ¯ã€‚</p>
</li>
<li><p>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼šå¯ä»¥æ‹¿åˆ°ä½ è¯·æ±‚çš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼Œå´æ‹¿ä¸åˆ°è¯·æ±‚æ–¹æ³•çš„å‚æ•°ã€‚</p>
</li>
<li><p>åˆ‡ç‰‡ï¼ˆAspectï¼‰: å¯ä»¥æ‹¿åˆ°æ–¹æ³•çš„å‚æ•°ï¼Œä½†æ˜¯å´æ‹¿ä¸åˆ°httpè¯·æ±‚å’Œå“åº”çš„å¯¹è±¡</p>
</li>
</ul>
</blockquote>
<h3 id="Interceptoræ‹¦æˆªå™¨"><a href="#Interceptoræ‹¦æˆªå™¨" class="headerlink" title="Interceptoræ‹¦æˆªå™¨"></a>Interceptoræ‹¦æˆªå™¨</h3><h4 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h4><blockquote>
<ol>
<li>ç±»è¦å®ç°Spring çš„HandlerInterceptor æ¥å£</li>
<li>ç±»ç»§æ‰¿å®ç°äº†HandlerInterceptor æ¥å£çš„ç±»ï¼Œä¾‹å¦‚ å·²ç»æä¾›çš„å®ç°äº†HandlerInterceptor æ¥å£çš„æŠ½è±¡ç±»HandlerInterceptorAdapter</li>
</ol>
</blockquote>
<h4 id="æ–¹æ³•ä»‹ç»"><a href="#æ–¹æ³•ä»‹ç»" class="headerlink" title="æ–¹æ³•ä»‹ç»"></a>æ–¹æ³•ä»‹ç»</h4><blockquote>
<ul>
<li>preHandleï¼šåœ¨ä¸šåŠ¡å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹å‰è¢«è°ƒç”¨ã€‚é¢„å¤„ç†ï¼Œå¯ä»¥è¿›è¡Œç¼–ç ã€å®‰å…¨æ§åˆ¶ã€æƒé™æ ¡éªŒç­‰å¤„ç†ï¼›</li>
<li>postHandleï¼šåœ¨ä¸šåŠ¡å¤„ç†å™¨å¤„ç†è¯·æ±‚æ‰§è¡Œå®Œæˆåï¼Œç”Ÿæˆè§†å›¾ä¹‹å‰æ‰§è¡Œã€‚åå¤„ç†ï¼ˆè°ƒç”¨äº†Serviceå¹¶è¿”å›ModelAndViewï¼Œä½†æœªè¿›è¡Œé¡µé¢æ¸²æŸ“ï¼‰ï¼Œæœ‰æœºä¼šä¿®æ”¹ModelAndView ï¼ˆè¿™ä¸ªåšä¸»å°±åŸºæœ¬ä¸æ€ä¹ˆç”¨äº†ï¼‰ï¼›</li>
<li>afterCompletionï¼šåœ¨DispatcherServletå®Œå…¨å¤„ç†å®Œè¯·æ±‚åè¢«è°ƒç”¨ï¼Œå¯ç”¨äºæ¸…ç†èµ„æºç­‰ã€‚è¿”å›å¤„ç†ï¼ˆå·²ç»æ¸²æŸ“äº†é¡µé¢ï¼‰ï¼›</li>
</ul>
</blockquote>
<h4 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h4><blockquote>
<p>è¿™é‡Œé€‰æ‹©å®ç°HandlerInterceptor æ¥å£</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/18 11:52</span></span><br><span class="line"><span class="comment"> * é…ç½®è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseResultInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String RESPONSE_PACK_FLAG = <span class="string">"RESPONSE_PACK_FLAG"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod) {</span><br><span class="line">            <span class="keyword">final</span> HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">            <span class="comment">// è·å–ç±»å¯¹è±¡å’Œè¯·æ±‚æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">final</span> Class&lt;?&gt; clazz = handlerMethod.getBeanType();</span><br><span class="line">            <span class="keyword">final</span> Method method = handlerMethod.getMethod();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç±»å¯¹è±¡æˆ–è€…è¯·æ±‚æ–¹æ³•ä¸Šæ˜¯å¦åˆæ³¨è§£</span></span><br><span class="line">            <span class="keyword">if</span> (clazz.isAnnotationPresent(ResponseResult.class)) {</span><br><span class="line">                <span class="comment">// åœ¨è¯·æ±‚è¿”å›ä½“çš„åŠ å…¥æ ‡å¿—,å¾€ä¸‹ä¼ é€’,åœ¨ResponseBodyAdviceæ¥å£å®ç°ç±»ä¸­è¿›ä¸€æ­¥çš„åˆ¤æ–­å’ŒåŒ…è£…</span></span><br><span class="line">                request.setAttribute(RESPONSE_PACK_FLAG, clazz.getAnnotation(ResponseResult.class));</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (method.isAnnotationPresent(ResponseResult.class)) {</span><br><span class="line">                request.setAttribute(RESPONSE_PACK_FLAG, method.getAnnotation(ResponseResult.class));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">                                Exception ex)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ³¨å†Œæ‹¦æˆªå™¨"><a href="#æ³¨å†Œæ‹¦æˆªå™¨" class="headerlink" title="æ³¨å†Œæ‹¦æˆªå™¨"></a>æ³¨å†Œæ‹¦æˆªå™¨</h4><blockquote>
<p>å…¶å®ä»¥å‰éƒ½æ˜¯ç»§æ‰¿WebMvcConfigurerAdapterç±» ä¸è¿‡springBoot2.0ä»¥ä¸Š WebMvcConfigurerAdapter æ–¹æ³•è¿‡æ—¶ï¼Œæœ‰ä¸¤ç§æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<ol>
<li>ç»§æ‰¿WebMvcConfigurationSupportç±»</li>
<li>å®ç°WebMvcConfigureræ¥å£</li>
</ol>
<p>ä½†æ˜¯ç»§æ‰¿WebMvcConfigurationSupportä¼šè®©Spring-bootå¯¹mvcçš„è‡ªåŠ¨é…ç½®å¤±æ•ˆã€‚æ ¹æ®é¡¹ç›®æƒ…å†µé€‰æ‹©ã€‚ç°åœ¨å¤§å¤šæ•°é¡¹ç›®æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œå¹¶æ²¡æœ‰å¯¹é™æ€èµ„æºæœ‰è‡ªåŠ¨é…ç½®çš„éœ€æ±‚æ‰€ä»¥ç»§æ‰¿WebMvcConfigurationSupportä¹Ÿæœªå°ä¸å¯ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½é€‰æ‹©å®ç°WebMvcConfigureræ¥å£ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/18 13:11</span></span><br><span class="line"><span class="comment"> * æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ResponseResultInterceptor resultInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>{</span><br><span class="line">        <span class="comment">// æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œæ‹¦æˆªè·¯å¾„ [æ‹¦æˆªå…¨éƒ¨è·¯å¾„çš„è¯·æ±‚]</span></span><br><span class="line">        registry.addInterceptor(resultInterceptor).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><blockquote>
<p>æ‹¦æˆªå™¨æœ¬è´¨ä¸Šæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼Œç¬¦åˆæ¨ªåˆ‡å…³æ³¨ç‚¹çš„åŠŸèƒ½éƒ½å¯ä»¥æ”¾åœ¨æ‹¦æˆªå™¨ä¸­æ¥å®ç°ï¼Œä¸»è¦çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç™»å½•éªŒè¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚</li>
<li>æƒé™éªŒè¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èµ„æºï¼Œå¦‚æ ¡éªŒtoken</li>
<li>æ—¥å¿—è®°å½•ï¼Œè®°å½•è¯·æ±‚æ“ä½œæ—¥å¿—ï¼ˆç”¨æˆ·ipï¼Œè®¿é—®æ—¶é—´ç­‰ï¼‰ï¼Œä»¥ä¾¿ç»Ÿè®¡è¯·æ±‚è®¿é—®é‡ã€‚</li>
<li>å¤„ç†cookieã€æœ¬åœ°åŒ–ã€å›½é™…åŒ–ã€ä¸»é¢˜ç­‰ã€‚</li>
<li>æ€§èƒ½ç›‘æ§ï¼Œç›‘æ§è¯·æ±‚å¤„ç†æ—¶é•¿ç­‰ã€‚</li>
<li>é€šç”¨è¡Œä¸ºï¼šè¯»å–cookieå¾—åˆ°ç”¨æˆ·ä¿¡æ¯å¹¶å°†ç”¨æˆ·å¯¹è±¡æ”¾å…¥è¯·æ±‚ï¼Œä»è€Œæ–¹ä¾¿åç»­æµç¨‹ä½¿ç”¨ï¼Œè¿˜æœ‰å¦‚æå–Localeã€Themeä¿¡æ¯ç­‰ï¼Œåªè¦æ˜¯å¤šä¸ªå¤„ç†å™¨éƒ½éœ€è¦çš„å³å¯ä½¿ç”¨æ‹¦æˆªå™¨å®ç°ï¼‰</li>
</ul>
</blockquote>
<h3 id="Filterè¿‡æ»¤å™¨"><a href="#Filterè¿‡æ»¤å™¨" class="headerlink" title="Filterè¿‡æ»¤å™¨"></a>Filterè¿‡æ»¤å™¨</h3><h4 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h4><blockquote>
<ol>
<li>ä½¿ç”¨spring bootæä¾›çš„<code>FilterRegistrationBean</code>æ³¨å†ŒFilter</li>
<li>ä½¿ç”¨åŸç”Ÿservletçš„<code>ServletComponentScan</code>æ³¨è§£å®šä¹‰Filter</li>
<li>ä¸¤ç§æ–¹å¼çš„æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å»FilterRegistrationBeanæ³¨å†Œè‡ªå®šä¹‰Filterã€‚åªæ˜¯å®ç°æ–¹å¼ä¸åŒè€Œå·²</li>
</ol>
</blockquote>
<h4 id="æ–¹å¼1"><a href="#æ–¹å¼1" class="headerlink" title="æ–¹å¼1"></a>æ–¹å¼1</h4><h5 id="é…ç½®Filter"><a href="#é…ç½®Filter" class="headerlink" title="é…ç½®Filter"></a>é…ç½®Filter</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.constants.BlogConstants;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.MDC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆæ—¥å¿—é“¾è·¯ID, æ­¤æ¬¡ä½¿ç”¨spring bootæä¾›çš„FilterRegistrationBeanæ³¨å†ŒFilter</span></span><br><span class="line"><span class="comment"> *              æ­¤é“¾è·¯æ—¥å¿—ç›®å‰ä¸é€‚ç”¨äºå¾®æœåŠ¡,å› ä¸ºå¾®æœåŠ¡ä¹‹é—´å­˜åœ¨è·¨æœåŠ¡è°ƒç”¨,MDCçš„å€¼éœ€è¦è¿›è¡Œåšä¼ é€’æ“ä½œ,å½“å‰å¹¶æœªå®ç°.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/12 20:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">        log.info(<span class="string">"====&gt; åˆå§‹åŒ–å…¨å±€è¿‡æ»¤å™¨..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ServletException </span>{</span><br><span class="line">        <span class="comment">// è®¾ç½®é“¾è·¯æ—¥å¿—IDå”¯ä¸€æ ‡è¯†(ç¼ºç‚¹: åªå±€é™äºå½“å‰çº¿ç¨‹,è‹¥äº§ç”Ÿå­çº¿ç¨‹,è¿™å­çº¿ç¨‹çš„æ—¥å¿—å°†ç¼ºå¤±å”¯ä¸€æ ‡è¯†)</span></span><br><span class="line">        MDC.put(BlogConstants.TRACE_ID, IdUtil.fastSimpleUUID());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¾è¡Œå‰: do something</span></span><br><span class="line">        log.info(<span class="string">"111"</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¾è¡Œå,æ•°æ®è¿˜æœªå“åº”åˆ°é¡µé¢: do something</span></span><br><span class="line">        log.info(<span class="string">"222"</span>);</span><br><span class="line">        <span class="comment">// å“åº”è¿”å›é¡µé¢å‰,æ¸…æ¥šè¡¨ç¤º,é¿å…å†…å­˜èµ„æºæµªè´¹</span></span><br><span class="line">        MDC.remove(BlogConstants.TRACE_ID);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="æ³¨å†ŒFilter"><a href="#æ³¨å†ŒFilter" class="headerlink" title="æ³¨å†ŒFilter"></a>æ³¨å†ŒFilter</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilterConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean&lt;GlobalFilter&gt; <span class="title">registrationBean</span><span class="params">()</span> </span>{</span><br><span class="line">        FilterRegistrationBean&lt;GlobalFilter&gt; filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;(<span class="keyword">new</span> GlobalFilter());</span><br><span class="line">        filterRegistrationBean.setOrder(<span class="number">1</span>);</span><br><span class="line">        filterRegistrationBean.setName(<span class="string">"globalFilter"</span>);</span><br><span class="line">        filterRegistrationBean.addUrlPatterns(<span class="string">"/*"</span>);</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="æ–¹å¼2"><a href="#æ–¹å¼2" class="headerlink" title="æ–¹å¼2"></a>æ–¹å¼2</h4><h5 id="é…ç½®Filter-1"><a href="#é…ç½®Filter-1" class="headerlink" title="é…ç½®Filter"></a>é…ç½®Filter</h5><blockquote>
<p>ä½¿ç”¨<code>@WebFilter</code>æ³¨è§£è¿›è¡ŒFilterçš„é…ç½®ï¼ŒåŒ…æ‹¬åç§°å’Œè¿‡æ»¤çš„è·¯å¾„ç­‰ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = "globalFilter", urlPatterns = "/*")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">        log.info(<span class="string">"====&gt; åˆå§‹åŒ–å…¨å±€è¿‡æ»¤å™¨..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ServletException </span>{</span><br><span class="line">        <span class="comment">// è®¾ç½®é“¾è·¯æ—¥å¿—IDå”¯ä¸€æ ‡è¯†(ç¼ºç‚¹: åªå±€é™äºå½“å‰çº¿ç¨‹,è‹¥äº§ç”Ÿå­çº¿ç¨‹,è¿™å­çº¿ç¨‹çš„æ—¥å¿—å°†ç¼ºå¤±å”¯ä¸€æ ‡è¯†)</span></span><br><span class="line">        MDC.put(BlogConstants.TRACE_ID, IdUtil.fastSimpleUUID());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¾è¡Œå‰: do something</span></span><br><span class="line">        log.info(<span class="string">"111"</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¾è¡Œå,æ•°æ®è¿˜æœªå“åº”åˆ°é¡µé¢: do something</span></span><br><span class="line">        log.info(<span class="string">"222"</span>);</span><br><span class="line">        <span class="comment">// å“åº”è¿”å›é¡µé¢å‰,æ¸…æ¥šè¡¨ç¤º,é¿å…å†…å­˜èµ„æºæµªè´¹</span></span><br><span class="line">        MDC.remove(BlogConstants.TRACE_ID);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="æ‰«æFilter"><a href="#æ‰«æFilter" class="headerlink" title="æ‰«æFilter"></a>æ‰«æFilter</h5><blockquote>
<p>åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨<code>@ServletComponentScan</code>æ³¨è§£é…ç½®æ‰«æå³å¯ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ServletComponentScan(basePackages={"com.horse.service.base.filter"})</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceBlogApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(ServiceBlogApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Interceptor</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8é›†åˆæ•°æ®å»é‡ç¤ºä¾‹</title>
    <url>/post/45364.html</url>
    <content><![CDATA[<h2 id="Java8é›†åˆæ•°æ®å»é‡ç¤ºä¾‹"><a href="#Java8é›†åˆæ•°æ®å»é‡ç¤ºä¾‹" class="headerlink" title="Java8é›†åˆæ•°æ®å»é‡ç¤ºä¾‹"></a>Java8é›†åˆæ•°æ®å»é‡ç¤ºä¾‹</h2><blockquote>
<p>åŸºäºJava8 Streamæµçš„å»é‡æ“ä½œ,ä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>distinct æŒ‰ç…§å¯¹è±¡å»é‡(å®ç° hashCode()å’Œ equals()æ–¹æ³•)</li>
<li>filter æŒ‰ç…§å¯¹è±¡å±æ€§å»é‡(ä¸éœ€è¦å®ç° hashCode()å’Œ equals()æ–¹æ³•)</li>
<li>åˆ©ç”¨streamçš„collectingAndThen+TreeSetå»é‡</li>
</ul>
</blockquote>
<h3 id="å»é‡å®ä¾‹å¯¹è±¡"><a href="#å»é‡å®ä¾‹å¯¹è±¡" class="headerlink" title="å»é‡å®ä¾‹å¯¹è±¡"></a>å»é‡å®ä¾‹å¯¹è±¡</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/7/5 10:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8170834275910515552L</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean sex;</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * distinct æŒ‰ç…§å¯¹è±¡å»é‡(å®ç° hashCode()å’Œ equals()æ–¹æ³•)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> students</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">distinctHandleRepeat</span><span class="params">(List&lt;Student&gt; students)</span> </span>{</span><br><span class="line">    students.stream().distinct().collect(Collectors.toList()).forEach(System.out::println);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * filter æŒ‰ç…§å¯¹è±¡å±æ€§å»é‡(ä¸éœ€è¦å®ç° hashCode()å’Œ equals()æ–¹æ³•)</span></span><br><span class="line"><span class="comment"> * å•å±æ€§å»é‡</span></span><br><span class="line"><span class="comment"> * å¤šå±æ€§å»é‡(ä¾‹å¦‚: æ ¹æ®ageå»é‡å,å†æ ¹æ®sexå†æ¬¡è¿›è¡Œå»é‡)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> students</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">filterHandleRepeat</span><span class="params">(List&lt;Student&gt; students)</span> </span>{</span><br><span class="line">    students.stream()</span><br><span class="line">            .filter(filterByKey(Student::getAge))</span><br><span class="line">            .filter(filterByKey(Student::getSex))</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * putIfAbsent(): keyå­˜åœ¨æ—¶ä¸æ·»åŠ åˆ°mapå¹¶è¿”å›valueï¼Œä¸å­˜åœ¨æ—¶åˆ™æ·»åŠ è¿”å›null</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyExtractor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Predicate&lt;T&gt; <span class="title">filterByKey</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ?&gt; keyExtractor)</span> </span>{</span><br><span class="line">    Map&lt;Object, Boolean&gt; seen = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> t -&gt; seen.putIfAbsent(keyExtractor.apply(t), Boolean.TRUE) == <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="TreeSet-æ¨è"><a href="#TreeSet-æ¨è" class="headerlink" title="TreeSet(æ¨è)"></a>TreeSet(æ¨è)</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ©ç”¨streamçš„collectingAndThen+TreeSetå»é‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> students</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">collectingAndThenHandleRepeat</span><span class="params">(List&lt;Student&gt; students)</span> </span>{</span><br><span class="line">    students.stream()</span><br><span class="line">            .collect(Collectors.collectingAndThen(Collectors.toCollection(() -&gt; <span class="keyword">new</span> TreeSet&lt;&gt;(Comparator.comparing(Student::getAge))), ArrayList::<span class="keyword">new</span>))</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è°ƒç”¨ç¤ºä¾‹"><a href="#è°ƒç”¨ç¤ºä¾‹" class="headerlink" title="è°ƒç”¨ç¤ºä¾‹"></a>è°ƒç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    <span class="comment">// distinctå»é‡</span></span><br><span class="line">    distinctHandleRepeat(getStudents());</span><br><span class="line">    System.out.println(<span class="string">"================================================"</span>);</span><br><span class="line">    <span class="comment">// filterå»é‡</span></span><br><span class="line">    filterHandleRepeat(getStudents());</span><br><span class="line">    System.out.println(<span class="string">"================================================"</span>);</span><br><span class="line">    <span class="comment">// collectingAndThen+TreeSetå»é‡</span></span><br><span class="line">    collectingAndThenHandleRepeat(getStudents());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºJava8 Streamæµçš„å»é‡æ“ä½œ,ä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼:</span></span><br><span class="line">    <span class="comment">// distinct æŒ‰ç…§å¯¹è±¡å»é‡(å®ç° hashCode()å’Œ equals()æ–¹æ³•)</span></span><br><span class="line">    <span class="comment">// filter æŒ‰ç…§å¯¹è±¡å±æ€§å»é‡(ä¸éœ€è¦å®ç° hashCode()å’Œ equals()æ–¹æ³•)</span></span><br><span class="line">    <span class="comment">// åˆ©ç”¨streamçš„collectingAndThen+TreeSetå»é‡</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span> </span>{</span><br><span class="line">    List&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    students.add(<span class="keyword">new</span> Student(<span class="string">"Tom"</span>, <span class="number">25</span>, Boolean.TRUE));</span><br><span class="line">    students.add(<span class="keyword">new</span> Student(<span class="string">"Jack"</span>, <span class="number">23</span>, Boolean.TRUE));</span><br><span class="line">    students.add(<span class="keyword">new</span> Student(<span class="string">"Top"</span>, <span class="number">22</span>, Boolean.FALSE));</span><br><span class="line">    students.add(<span class="keyword">new</span> Student(<span class="string">"Gao"</span>, <span class="number">22</span>, Boolean.FALSE));</span><br><span class="line">    students.add(<span class="keyword">new</span> Student(<span class="string">"Top"</span>, <span class="number">22</span>, Boolean.FALSE));</span><br><span class="line">    <span class="keyword">return</span> students;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Student(name=Tom, age=<span class="number">25</span>, sex=<span class="keyword">true</span>)</span><br><span class="line">Student(name=Jack, age=<span class="number">23</span>, sex=<span class="keyword">true</span>)</span><br><span class="line">Student(name=Top, age=<span class="number">22</span>, sex=<span class="keyword">false</span>)</span><br><span class="line">Student(name=Gao, age=<span class="number">22</span>, sex=<span class="keyword">false</span>)</span><br><span class="line">================================================</span><br><span class="line">Student(name=Tom, age=<span class="number">25</span>, sex=<span class="keyword">true</span>)</span><br><span class="line">Student(name=Top, age=<span class="number">22</span>, sex=<span class="keyword">false</span>)</span><br><span class="line">================================================</span><br><span class="line">Student(name=Top, age=<span class="number">22</span>, sex=<span class="keyword">false</span>)</span><br><span class="line">Student(name=Jack, age=<span class="number">23</span>, sex=<span class="keyword">true</span>)</span><br><span class="line">Student(name=Tom, age=<span class="number">25</span>, sex=<span class="keyword">true</span>)</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Stream</tag>
      </tags>
  </entry>
  <entry>
    <title>JSR-303æ³¨è§£æ ¡éªŒ</title>
    <url>/post/62225.html</url>
    <content><![CDATA[<h2 id="æ³¨è§£æ ¡éªŒ"><a href="#æ³¨è§£æ ¡éªŒ" class="headerlink" title="æ³¨è§£æ ¡éªŒ"></a>æ³¨è§£æ ¡éªŒ</h2><h3 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-ä½¿ç”¨è§„åˆ™"><a href="#2-ä½¿ç”¨è§„åˆ™" class="headerlink" title="2. ä½¿ç”¨è§„åˆ™"></a>2. ä½¿ç”¨è§„åˆ™</h3><blockquote>
<p>ä¸€èˆ¬æˆ‘ä»¬ç”¨æ¥å®ä½“ç±»å±æ€§çš„æ ¡éªŒï¼Œé‡Œé¢çš„åˆ†ç»„æ ¡éªŒä¸å¤ªç”¨å¾—ç€ï¼Œæš‚æ—¶ä¸è€ƒè™‘ã€‚</p>
</blockquote>
<p>æ³¨è§£è§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Nullæ£€æŸ¥</span><br><span class="line"><span class="meta">@Null(message = "")</span>       éªŒè¯å¯¹è±¡æ˜¯å¦ä¸º<span class="keyword">null</span></span><br><span class="line"><span class="meta">@NotNull(message = "")</span>    éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸º<span class="keyword">null</span>, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º<span class="number">0</span>çš„å­—ç¬¦ä¸²</span><br><span class="line"><span class="meta">@NotBlank(message = "")</span>   æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº<span class="number">0</span>,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.</span><br><span class="line"><span class="meta">@NotEmpty(message = "")</span>  æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.</span><br><span class="line"></span><br><span class="line">Booelanæ£€æŸ¥</span><br><span class="line"><span class="meta">@AssertTrue(message = "")</span>     éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º <span class="keyword">true</span>  </span><br><span class="line"><span class="meta">@AssertFalse(message = "")</span>    éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º <span class="keyword">false</span>  </span><br><span class="line"></span><br><span class="line">é•¿åº¦æ£€æŸ¥</span><br><span class="line"><span class="meta">@Size(min=, max=,message = "")</span> éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  </span><br><span class="line"><span class="meta">@Length(min=, max=,message = "")</span> éªŒè¯å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…</span><br><span class="line"></span><br><span class="line">æ—¥æœŸæ£€æŸ¥</span><br><span class="line"><span class="meta">@Past(message = "")</span>           éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  </span><br><span class="line"><span class="meta">@Future(message = "")</span>     	éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  </span><br><span class="line"><span class="meta">@Pattern(regexp = "",message = "")</span>    	éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™</span><br><span class="line"></span><br><span class="line">æ•°å€¼æ£€æŸ¥</span><br><span class="line">	å»ºè®®ä½¿ç”¨åœ¨åŒ…è£…ç±»å‹ï¼ˆIntegerè¿™ç±»ï¼‰ï¼Œä¸å»ºè®®ä½¿ç”¨åœ¨<span class="keyword">int</span>ç±»å‹ä¸Šï¼Œ</span><br><span class="line">	å› ä¸ºè¡¨å•å€¼ä¸ºâ€œâ€æ—¶æ— æ³•è½¬æ¢ä¸º<span class="keyword">int</span>ï¼Œä½†å¯ä»¥è½¬æ¢ä¸ºStirngä¸º<span class="string">""</span>,Integerä¸º<span class="keyword">null</span></span><br><span class="line"><span class="meta">@Min(message = "")</span>     éªŒè¯ Number å’Œ String å¯¹è±¡æ˜¯å¦å¤§ç­‰äºæŒ‡å®šçš„å€¼  </span><br><span class="line"><span class="meta">@Max(message = "")</span>     éªŒè¯ Number å’Œ String å¯¹è±¡æ˜¯å¦å°ç­‰äºæŒ‡å®šçš„å€¼  </span><br><span class="line"><span class="meta">@DecimalMax(message = "")</span> å€¼ä¸å¤§äºçº¦æŸä¸­æŒ‡å®šçš„æœ€å¤§å€¼. è¿™ä¸ªçº¦æŸçš„å‚æ•°æ˜¯ä¸€ä¸ªé€šè¿‡BigDecimalå®šä¹‰çš„æœ€å¤§å€¼çš„å­—ç¬¦ä¸²è¡¨ç¤º.å°æ•°å­˜åœ¨ç²¾åº¦</span><br><span class="line"><span class="meta">@DecimalMin(message = "")</span> å€¼å¿…é¡»ä¸å°äºçº¦æŸä¸­æŒ‡å®šçš„æœ€å°å€¼. è¿™ä¸ªçº¦æŸçš„å‚æ•°æ˜¯ä¸€ä¸ªé€šè¿‡BigDecimalå®šä¹‰çš„æœ€å°å€¼çš„å­—ç¬¦ä¸²è¡¨ç¤º.å°æ•°å­˜åœ¨ç²¾åº¦</span><br><span class="line"><span class="meta">@Digits(message = "")</span>     éªŒè¯ Number å’Œ String çš„æ„æˆæ˜¯å¦åˆæ³•  </span><br><span class="line"><span class="meta">@Digits(integer=,fraction=,message = "")</span> éªŒè¯å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ç¬¦åˆæŒ‡å®šæ ¼å¼çš„æ•°å­—ï¼ŒintergeræŒ‡å®šæ•´æ•°ç²¾åº¦ï¼ŒfractionæŒ‡å®šå°æ•°ç²¾åº¦ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">@Range(min=, max=,message = "")</span> æ£€æŸ¥æ•°å­—æ˜¯å¦ä»‹äºminå’Œmaxä¹‹é—´.</span><br><span class="line"></span><br><span class="line"><span class="meta">@Valid</span>  é€’å½’çš„å¯¹å…³è”å¯¹è±¡è¿›è¡Œæ ¡éªŒ, å¦‚æœå…³è”å¯¹è±¡æ˜¯ä¸ªé›†åˆæˆ–è€…æ•°ç»„,é‚£ä¹ˆå¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œé€’å½’æ ¡éªŒ,å¦‚æœæ˜¯ä¸€ä¸ªmap,åˆ™å¯¹å…¶ä¸­çš„å€¼éƒ¨åˆ†è¿›è¡Œæ ¡éªŒ.(æ˜¯å¦è¿›è¡Œé€’å½’éªŒè¯)</span><br><span class="line"></span><br><span class="line"><span class="meta">@CreditCardNumber(message = "")</span> ä¿¡ç”¨å¡éªŒè¯</span><br><span class="line"><span class="meta">@Email(message = "")</span>  éªŒè¯æ˜¯å¦æ˜¯é‚®ä»¶åœ°å€ï¼Œå¦‚æœä¸º<span class="keyword">null</span>,ä¸è¿›è¡ŒéªŒè¯ï¼Œç®—é€šè¿‡éªŒè¯ã€‚</span><br><span class="line"><span class="meta">@ScriptAssert(lang= ,script=, alias=,message = "")</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@URL(protocol=,host=, port=,regexp=, flags=,message = "")</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-æ³¨æ„ç‚¹"><a href="#3-æ³¨æ„ç‚¹" class="headerlink" title="3. æ³¨æ„ç‚¹"></a>3. æ³¨æ„ç‚¹</h3><blockquote>
<ul>
<li>@RequestBodyæ³¨è§£æ ¡éªŒä¸€èˆ¬åœ¨å…¶æ—è¾¹æ·»åŠ <code>@Valid</code>æ³¨è§£æˆ–è€…<code>@Valiated</code>æ³¨è§£å³å¯</li>
<li>@RequestParamå’Œ@PathVariableæ³¨è§£å‚æ•°æ ¡éªŒï¼Œå¿…é¡»æŠŠ<code>@Valiated</code>æ³¨è§£æ”¾åˆ°ç±»ä¸Šé¢ï¼Œå¦åˆ™æ ¡éªŒä¸ç”Ÿæ•ˆ</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/20 14:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Validated</span>  <span class="comment">// æ³¨è§£ä¸€å®šè¦å†™åœ¨ç±»ä¸Šé¢ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(TestController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/valid")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">validParams</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@NotBlank(message = "nameä¸èƒ½ä¸ºç©º")</span></span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam("name")</span> String name)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">" ==&gt; name:{}"</span>, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Fileæ–‡ä»¶ä¸Šä¼ ç®€å•æµ‹è¯•</title>
    <url>/post/53122.html</url>
    <content><![CDATA[<h2 id="Fileæ–‡ä»¶ä¸Šä¼ ç®€å•æµ‹è¯•"><a href="#Fileæ–‡ä»¶ä¸Šä¼ ç®€å•æµ‹è¯•" class="headerlink" title="Fileæ–‡ä»¶ä¸Šä¼ ç®€å•æµ‹è¯•"></a>Fileæ–‡ä»¶ä¸Šä¼ ç®€å•æµ‹è¯•</h2><h3 id="å†…å®¹è¦ç‚¹"><a href="#å†…å®¹è¦ç‚¹" class="headerlink" title="å†…å®¹è¦ç‚¹"></a>å†…å®¹è¦ç‚¹</h3><blockquote>
<ul>
<li>å­—èŠ‚æµæ–‡ä»¶ä¸Šä¼ ï¼ˆBIOï¼‰</li>
<li>ç›´æ¥ç¼“å†²æµæ–‡ä»¶ä¸Šä¼ ï¼ˆBIOï¼‰</li>
<li>Channelç®¡é“æ–‡ä»¶ä¸Šä¼ ï¼ˆNIOï¼‰ ==&gt; <code>æœ€å¿«</code></li>
<li>NIOçš„Fileså·¥å…·ç±»æ–‡ä»¶ä¸Šä¼ ï¼ˆNIOï¼‰</li>
</ul>
</blockquote>
<h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><blockquote>
<p>ä»£ç ä¸­ä¸»è¦ç”¨åˆ°HuToolå·¥å…·ç±»ï¼Œè¿è¡Œå‰ï¼Œè¯·å…ˆå¼•å…¥HuToolä¾èµ–</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>  å…³äºå…³é—­æµçš„ç®€å•å†™æ³•ï¼š</p>
<ul>
<li>try-with-resourcesè¯­å¥åŒ…å«äº†ä¸¤ä¸ªç”¨åˆ†å·éš”å¼€çš„å£°æ˜ï¼šinputStream å’Œ outputStreamï¼Œ å½“ä»£ç å—ä¸­ä»£ç ç»ˆæ­¢ï¼Œä¸ç®¡æ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸ï¼ŒinputStream å’Œ outputStream å¯¹è±¡çš„ closeæ–¹æ³• éƒ½ä¼šè‡ªåŠ¨æŒ‰å£°æ˜çš„ ç›¸åé¡ºåº è°ƒç”¨ã€‚</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String inner_file_path = <span class="string">"C:\\Users\\administered\\Pictures\\Saved Pictures\\2052675.20211018.jpg"</span>;</span><br><span class="line">      String out_file_path = <span class="string">"C:\\Users\\administered\\Pictures\\Camera Roll\\file.jpg"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// try-with-resourcesè¯­å¥åŒ…å«äº†ä¸¤ä¸ªç”¨åˆ†å·éš”å¼€çš„å£°æ˜ï¼šinputStream å’Œ outputStreamã€‚</span></span><br><span class="line">      <span class="comment">// å½“ä»£ç å—ä¸­ä»£ç ç»ˆæ­¢ï¼Œä¸ç®¡æ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸ï¼ŒinputStream å’Œ outputStream å¯¹è±¡çš„ closeæ–¹æ³• éƒ½ä¼šè‡ªåŠ¨æŒ‰å£°æ˜çš„ ç›¸åé¡ºåº è°ƒç”¨ã€‚</span></span><br><span class="line">      <span class="keyword">try</span> (</span><br><span class="line">              FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(inner_file_path));</span><br><span class="line">              FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(out_file_path));</span><br><span class="line">              ) {</span><br><span class="line">          <span class="comment">// æ“ä½œæ•°æ®æµ</span></span><br><span class="line">          log.info(<span class="string">"&gt;&gt;&gt; inputStreamæµå¤§å°ï¼š{}KB"</span>, inputStream.available() &gt;&gt; <span class="number">10</span>);</span><br><span class="line">          IoUtil.copy(inputStream, outputStream);</span><br><span class="line">      } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">"æµå…³é—­å¼‚å¸¸ï¼š"</span> + e.getMessage());</span><br><span class="line">      }</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ–‡ä»¶æµçš„åŸºæœ¬ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.IoUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/29 15:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IoStreamTestController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(IoStreamTestController.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String dirPath = <span class="string">"D:/file/upload/"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—èŠ‚æµè¯»å–æ•ˆç‡è¾ƒæ…¢ä¸€ç‚¹(BIO)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping("/simple/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleFileUpload</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file)</span> </span>{</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// æ ¡éªŒæ–‡ä»¶åç§°,ç±»å‹,å†…å®¹ç­‰ä¿¡æ¯</span></span><br><span class="line">            inputStream = file.getInputStream();</span><br><span class="line">            <span class="comment">// è¾“å‡ºä½ç½®(è·¯å¾„ä¸å­˜åœ¨,è‡ªåŠ¨åˆ›å»º)</span></span><br><span class="line">            outputStream = FileUtil.getOutputStream(<span class="keyword">new</span> File(dirPath.concat(<span class="string">"simple.mp4"</span>)));</span><br><span class="line">            IoUtil.copy(inputStream, outputStream, IoUtil.DEFAULT_BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line">            watch.stop();</span><br><span class="line">            logger.info(<span class="string">"å­—èŠ‚æµæ–‡ä»¶ä¸Šä¼ è€—æ—¶: {} ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            logger.error(<span class="string">"æ–‡ä»¶ä¸Šä¼ å¼‚å¸¸:{}"</span>, e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            IoUtil.close(inputStream);</span><br><span class="line">            IoUtil.close(outputStream);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—èŠ‚ç¼“å†²æµè¯»å–æ•ˆç‡æ›´é«˜(BIO)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping("/buffer/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bufferFileUpload</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file)</span> </span>{</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        BufferedInputStream bufferedInputStream = <span class="keyword">null</span>;</span><br><span class="line">        BufferedOutputStream bufferedOutputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            InputStream inputStream = file.getInputStream();</span><br><span class="line">            bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(inputStream);</span><br><span class="line">            <span class="comment">// è¾“å‡ºä½ç½®(è·¯å¾„ä¸å­˜åœ¨,è‡ªåŠ¨åˆ›å»º)</span></span><br><span class="line">            bufferedOutputStream = FileUtil.getOutputStream(<span class="keyword">new</span> File(dirPath.concat(<span class="string">"buffer.mp4"</span>)));</span><br><span class="line"></span><br><span class="line">            IoUtil.copy(bufferedInputStream, bufferedOutputStream, IoUtil.DEFAULT_BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line">            watch.stop();</span><br><span class="line">            logger.info(<span class="string">"å­—èŠ‚ç¼“å†²æµæ–‡ä»¶ä¸Šä¼ è€—æ—¶: {} ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"æ–‡ä»¶ä¼ è¾“å¼‚å¸¸:{}"</span>, e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            IoUtil.close(bufferedInputStream);</span><br><span class="line">            IoUtil.close(bufferedOutputStream);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * NIOæ–¹å¼çš„ç®¡é“ä¼ è¾“: é€Ÿåº¦æœ€å¿«,ä¸»è¦æ˜¯å’Œæ–‡ä»¶ä¼ è¾“æ—¶å®šä¹‰çš„ç¼“å†²å—å¤§å°æœ‰å…³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping("/channel/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">nioChannelUploadFile</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file)</span> </span>{</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line"></span><br><span class="line">        FileInputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">        FileChannel inChannel = <span class="keyword">null</span>;</span><br><span class="line">        FileChannel outChannel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">            FileUtil.mkdir(<span class="keyword">new</span> File(dirPath));</span><br><span class="line">            <span class="comment">// è·å–è¾“å…¥è¾“å‡ºæµ</span></span><br><span class="line">            inputStream = (FileInputStream) file.getInputStream();</span><br><span class="line">            outputStream = <span class="keyword">new</span> FileOutputStream(dirPath.concat(<span class="string">"nioChannel.mp4"</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–è¾“å…¥è¾“å‡ºé€šé“</span></span><br><span class="line">            inChannel = inputStream.getChannel();</span><br><span class="line">            outChannel = outputStream.getChannel();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å®šä¹‰ç¼“å†²å—: ä¸åŒåœºæ™¯,éœ€è¦å®šä¹‰ä¸åŒå¤§å°çš„ç¼“å†²å—,å½“å‰ç¼“å†²å—ä¸º: 1M</span></span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">2</span> &lt;&lt; <span class="number">20</span>);</span><br><span class="line">            <span class="keyword">while</span> (inChannel.read(buffer) != IoUtil.EOF) {</span><br><span class="line">                <span class="comment">// åˆ‡æ¢ä¸ºè¯»å–æ•°æ®æ¨¡å¼(å°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®,å¹¶å°†å½“å‰ä½ç½®ç½®ä¸º0)</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="comment">// å°†ç¼“å†²åŒºæ•°æ®å†™å…¥è¾“å‡ºé€šé“ä¸­</span></span><br><span class="line">                outChannel.write(buffer);</span><br><span class="line">                <span class="comment">// æ¸…ç©ºç¼“å†²åŒº: ç»§ç»­å¾ªç¯è¯»å–æ•°æ®</span></span><br><span class="line">                buffer.clear();</span><br><span class="line">            }</span><br><span class="line">            watch.stop();</span><br><span class="line">            logger.info(<span class="string">"NIOæ–¹å¼çš„ç®¡é“ä¼ è¾“æ–‡ä»¶è€—æ—¶: {} ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"æ–‡ä»¶ä¼ è¾“å¼‚å¸¸:{}"</span>, e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            IoUtil.close(outputStream);</span><br><span class="line">            IoUtil.close(inputStream);</span><br><span class="line">            IoUtil.close(inChannel);</span><br><span class="line">            IoUtil.close(outChannel);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * NIOå·¥å…·ç±»Files è¿›è¡Œçš„æ–‡ä»¶ä¼ è¾“(é€Ÿåº¦å’Œbufferå·®ä¸å¤š,å°æ–‡ä»¶å‡ ä¹æ²¡å·®åˆ«)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping("/files/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">nioFilesUpload</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file)</span> </span>{</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// æ–‡ä»¶æ ¡éªŒ(çœç•¥...)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·¯å¾„ä¸å­˜åœ¨,ç›´æ¥åˆ›å»º</span></span><br><span class="line">            FileUtil.mkdir(<span class="keyword">new</span> File(dirPath));</span><br><span class="line">            <span class="comment">// è®¾ç½®å¹¶è·å–æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            Path path = Paths.get(dirPath.concat(<span class="string">"nioFiles.mp4"</span>));</span><br><span class="line">            inputStream = file.getInputStream();</span><br><span class="line">            Files.copy(inputStream, path, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line"></span><br><span class="line">            watch.stop();</span><br><span class="line">            logger.info(<span class="string">"NIOå·¥å…·ç±»Filesæ–‡ä»¶ä¸Šä¼ è€—æ—¶: {} ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"æ–‡ä»¶ä¼ è¾“å¼‚å¸¸:{}"</span>, e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            IoUtil.close(inputStream);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œé€Ÿåº¦æ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">28</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">45.299</span>  INFO <span class="number">9656</span> --- [nio-<span class="number">8099</span>-exec-<span class="number">1</span>] c.h.u.controller.IoStreamTestController  : å­—èŠ‚æµæ–‡ä»¶ä¸Šä¼ è€—æ—¶: <span class="number">68</span> ms</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">28</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">54.249</span>  INFO <span class="number">9656</span> --- [nio-<span class="number">8099</span>-exec-<span class="number">4</span>] c.h.u.controller.IoStreamTestController  : å­—èŠ‚ç¼“å†²æµæ–‡ä»¶ä¸Šä¼ è€—æ—¶: <span class="number">62</span> ms</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">28</span> <span class="number">14</span>:<span class="number">32</span>:<span class="number">11.656</span>  INFO <span class="number">9656</span> --- [nio-<span class="number">8099</span>-exec-<span class="number">5</span>] c.h.u.controller.IoStreamTestController  : NIOæ–¹å¼çš„ç®¡é“ä¼ è¾“æ–‡ä»¶è€—æ—¶: <span class="number">29</span> ms</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">28</span> <span class="number">14</span>:<span class="number">32</span>:<span class="number">19.062</span>  INFO <span class="number">9656</span> --- [nio-<span class="number">8099</span>-exec-<span class="number">3</span>] c.h.u.controller.IoStreamTestController  : NIOå·¥å…·ç±»Filesæ–‡ä»¶ä¸Šä¼ è€—æ—¶: <span class="number">67</span> ms</span><br></pre></td></tr></tbody></table></figure>
<h2 id="å„ç§æµçš„è½¬æ¢"><a href="#å„ç§æµçš„è½¬æ¢" class="headerlink" title="å„ç§æµçš„è½¬æ¢"></a>å„ç§æµçš„è½¬æ¢</h2><blockquote>
<p><code>OutputStream</code> ==&gt; <code>InputStream</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * OutputStream è½¬ InputStream</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> out è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> inputStreamå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InputStream <span class="title">outConvertInput</span><span class="params">(OutputStream out)</span> </span>{</span><br><span class="line">    ByteArrayOutputStream byteArrayOutputStream = (ByteArrayOutputStream) out;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ByteArrayInputStream(byteArrayOutputStream.toByteArray());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p><code>InputStream</code> &lt;==&gt;  <code>String</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * inputStream è½¬ String åŸç†: å…ˆå†™å…¥OutputStreamå,å†è¿›è¡Œè½¬åŒ–String</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">inputConvertStr</span><span class="params">(InputStream inputStream)</span> </span>{</span><br><span class="line">    ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = inputStream.read(bytes)) != -<span class="number">1</span>) {</span><br><span class="line">            outputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> outputStream.toString();</span><br><span class="line">    } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            inputStream.close();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * String è½¬ InputStream</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InputStream <span class="title">strConvertInput</span><span class="params">(String string)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ByteArrayInputStream(string.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p><code>String</code> ==&gt; <code>OutputStream</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * String å†™å…¥ OutputStream</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OutputStream <span class="title">strConvertOut</span><span class="params">(String string)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    OutputStream outputStream = System.out;</span><br><span class="line">    outputStream.write(string.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    <span class="keyword">return</span> outputStream;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://i.loli.net/2021/05/24/uSjR24PvBDkomGg.gif" alt="ç‡¥èµ·æ¥"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>File</tag>
      </tags>
  </entry>
  <entry>
    <title>Jacksonå’ŒFastjsonåºåˆ—åŒ–åŸºæ“</title>
    <url>/post/16893.html</url>
    <content><![CDATA[<h1 id="Jacksonå’ŒFastjsonåºåˆ—åŒ–åŸºæ“"><a href="#Jacksonå’ŒFastjsonåºåˆ—åŒ–åŸºæ“" class="headerlink" title="Jacksonå’ŒFastjsonåºåˆ—åŒ–åŸºæ“"></a>Jacksonå’ŒFastjsonåºåˆ—åŒ–åŸºæ“</h1><h2 id="FastJsonç®€æ"><a href="#FastJsonç®€æ" class="headerlink" title="FastJsonç®€æ"></a>FastJsonç®€æ</h2><h3 id="pomä¾èµ–"><a href="#pomä¾èµ–" class="headerlink" title="pomä¾èµ–"></a>pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŸºæœ¬æµ‹è¯•"><a href="#åŸºæœ¬æµ‹è¯•" class="headerlink" title="åŸºæœ¬æµ‹è¯•"></a>åŸºæœ¬æµ‹è¯•</h3><p><code>Person</code>å®ä½“ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2609767654646984159L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(name = "username")</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(ordinal = 2, serialize = false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(ordinal = 1)</span></span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(format = "yyyy-MM-dd HH:mm:ss.SSS", ordinal = 3)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æµ‹è¯•æ¼”ç¤º</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(FastJsonDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * JavaBeanå’ŒJsonå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        String personJson = JSON.toJSONString(person, <span class="keyword">true</span>);</span><br><span class="line">        logger.info(<span class="string">"beanè½¬json ==&gt; {}"</span>, personJson);</span><br><span class="line">        Person personBean = JSON.parseObject(personJson, Person.class);</span><br><span class="line">        logger.info(<span class="string">"jsonè½¬bean ==&gt; {}"</span>, personBean);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * JavaBeanå’ŒJsonObject(åº•å±‚æ˜¯Mapçš„æ•°æ®ç»“æ„)çš„è½¬æ¢å’Œç›¸å…³æ“ä½œ</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        String personJsonObject = JSONObject.toJSONString(person, <span class="keyword">true</span>);</span><br><span class="line">        logger.info(<span class="string">"beanè½¬json ==&gt; {}"</span>, personJsonObject);</span><br><span class="line">        JSONObject personBeanObject = JSONObject.parseObject(personJsonObject);</span><br><span class="line">        logger.info(<span class="string">"jsonè½¬JSONObject ==&gt; {}"</span>, personBeanObject);</span><br><span class="line">        personBeanObject.put(<span class="string">"age"</span>, <span class="number">303</span>);</span><br><span class="line">        logger.info(<span class="string">"==&gt; {}"</span>, personBeanObject.get(<span class="string">"username"</span>));</span><br><span class="line">        logger.info(<span class="string">"==&gt; {}"</span>, personBeanObject.get(<span class="string">"age"</span>));</span><br><span class="line">        logger.info(<span class="string">"==&gt; {}"</span>, personBeanObject.get(<span class="string">"money"</span>));</span><br><span class="line">        logger.info(<span class="string">"==&gt; {}"</span>, personBeanObject.get(<span class="string">"birthday"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *listå’Œjsonçš„ç›¸äº’è½¬æ¢</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        List&lt;Person&gt; personList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        personList.add(<span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ1"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        personList.add(<span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ2"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        personList.add(<span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ3"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        personList.add(<span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ4"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        List&lt;Person&gt; list = JSON.parseArray(JSON.toJSONString(personList, <span class="keyword">true</span>), Person.class);</span><br><span class="line">        logger.info(<span class="string">"jsonè½¬list ==&gt; {}"</span>, list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * mapå¯¹åº”jsonå­—ç¬¦ä¸²è½¬æˆJSONObject,ä»¥åŠå¯¹åº”å€¼è½¬æˆJavaBean</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        map.put(<span class="string">"person1"</span>, <span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ1"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        map.put(<span class="string">"person2"</span>, <span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ2"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        map.put(<span class="string">"person3"</span>, <span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ3"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        map.put(<span class="string">"person4"</span>, <span class="keyword">new</span> Person(<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ4"</span>, <span class="number">30</span>, <span class="number">7324.5432</span>, <span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">        JSONObject resultMap = JSONObject.parseObject(JSON.toJSONString(map));</span><br><span class="line">        logger.info(<span class="string">"jsonè½¬map ==&gt; {}"</span>, resultMap);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : resultMap.entrySet()) {</span><br><span class="line">            <span class="keyword">if</span> (entry.getValue() <span class="keyword">instanceof</span> JSONObject) {</span><br><span class="line">                logger.info(<span class="string">"mapä¸­Objectç±»å‹è½¬æ¢åå®é™…ç±»å‹æ˜¯: JSONObject"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// mapç±»å‹å­—ç¬¦è½¬è½¬æ¢æˆJSONObjectå,å…¶ä¸­å¯¹åº”çš„Objectå‚æ•°è½¬æ¢ä½JavaBean</span></span><br><span class="line">            Person p = JSON.parseObject(JSON.toJSONString(entry.getValue()), Person.class);</span><br><span class="line">            logger.info(<span class="string">"key:{} &lt;==&gt; value:{}"</span>, entry.getKey(), p);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ¼”ç¤ºç»“æœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.680</span> [main] INFO com.topsun.json.FastJsonDemo - beanè½¬json ==&gt; {</span><br><span class="line">	<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ"</span>,</span><br><span class="line">	<span class="string">"money"</span>:<span class="number">7324.5432</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">30</span>,</span><br><span class="line">	<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.559"</span></span><br><span class="line">}</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.702</span> [main] INFO com.topsun.json.FastJsonDemo - jsonè½¬bean ==&gt; Person(name=æ³°æ™®æ£®å…ˆç”Ÿ, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.705</span> [main] INFO com.topsun.json.FastJsonDemo - beanè½¬json ==&gt; {</span><br><span class="line">	<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ"</span>,</span><br><span class="line">	<span class="string">"money"</span>:<span class="number">7324.5432</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">30</span>,</span><br><span class="line">	<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.559"</span></span><br><span class="line">}</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.706</span> [main] INFO com.topsun.json.FastJsonDemo - jsonè½¬JSONObject ==&gt; {<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.559"</span>,<span class="string">"money"</span>:<span class="number">7324.5432</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ"</span>}</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.707</span> [main] INFO com.topsun.json.FastJsonDemo - ==&gt; æ³°æ™®æ£®å…ˆç”Ÿ</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.707</span> [main] INFO com.topsun.json.FastJsonDemo - ==&gt; <span class="number">303</span></span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.707</span> [main] INFO com.topsun.json.FastJsonDemo - ==&gt; <span class="number">7324.5432</span></span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.707</span> [main] INFO com.topsun.json.FastJsonDemo - ==&gt; <span class="number">2021</span>-<span class="number">06</span>-<span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20.559</span></span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.709</span> [main] INFO com.topsun.json.FastJsonDemo - jsonè½¬list ==&gt; [Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">1</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>), Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">2</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>), Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">3</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>), Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">4</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)]</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.710</span> [main] INFO com.topsun.json.FastJsonDemo - jsonè½¬map ==&gt; {<span class="string">"person4"</span>:{<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.709"</span>,<span class="string">"money"</span>:<span class="number">7324.5432</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ4"</span>},<span class="string">"person3"</span>:{<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.709"</span>,<span class="string">"money"</span>:<span class="number">7324.5432</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ3"</span>},<span class="string">"person2"</span>:{<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.709"</span>,<span class="string">"money"</span>:<span class="number">7324.5432</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ2"</span>},<span class="string">"person1"</span>:{<span class="string">"birthday"</span>:<span class="string">"2021-06-17 14:04:20.709"</span>,<span class="string">"money"</span>:<span class="number">7324.5432</span>,<span class="string">"age"</span>:<span class="number">30</span>,<span class="string">"username"</span>:<span class="string">"æ³°æ™®æ£®å…ˆç”Ÿ1"</span>}}</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.710</span> [main] INFO com.topsun.json.FastJsonDemo - ç±»å‹æ˜¯: JSONObject</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.713</span> [main] INFO com.topsun.json.FastJsonDemo - key:person4 &lt;==&gt; value:Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">4</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.713</span> [main] INFO com.topsun.json.FastJsonDemo - ç±»å‹æ˜¯: JSONObject</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.714</span> [main] INFO com.topsun.json.FastJsonDemo - key:person3 &lt;==&gt; value:Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">3</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.714</span> [main] INFO com.topsun.json.FastJsonDemo - ç±»å‹æ˜¯: JSONObject</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.714</span> [main] INFO com.topsun.json.FastJsonDemo - key:person2 &lt;==&gt; value:Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">2</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.714</span> [main] INFO com.topsun.json.FastJsonDemo - ç±»å‹æ˜¯: JSONObject</span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">20.714</span> [main] INFO com.topsun.json.FastJsonDemo - key:person1 &lt;==&gt; value:Person(name=æ³°æ™®æ£®å…ˆç”Ÿ<span class="number">1</span>, age=<span class="number">30</span>, money=<span class="number">7324.5432</span>, birthday=Thu Jun <span class="number">17</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">20</span> CST <span class="number">2021</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å°è£…å·¥å…·"><a href="#å°è£…å·¥å…·" class="headerlink" title="å°è£…å·¥å…·"></a>å°è£…å·¥å…·</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.common.util.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.JSONLibDataFormatSerializer;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> åŸºäºfastjsonå°è£…å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/8 20:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastjsonUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(FastjsonUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exceptionMsg</span><span class="params">(String methodName, Exception e)</span> </span>{</span><br><span class="line">        log.error(<span class="string">"FastjsonUtilså·¥å…·ç±»çš„[{}]æ–¹æ³•è°ƒç”¨å¼‚å¸¸: {}"</span>, methodName, e.getMessage());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºæœ¬åºåˆ—åŒ–é…ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SerializeConfig CONFIG;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        CONFIG = <span class="keyword">new</span> SerializeConfig();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å’Œjson-libå…¼å®¹çš„æ—¥æœŸè¾“å‡ºæ ¼å¼</span></span><br><span class="line">        CONFIG.put(java.util.Date.class, <span class="keyword">new</span> JSONLibDataFormatSerializer());</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å’Œjson-libå…¼å®¹çš„æ—¥æœŸè¾“å‡ºæ ¼å¼</span></span><br><span class="line">        CONFIG.put(java.sql.Date.class, <span class="keyword">new</span> JSONLibDataFormatSerializer());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰å±æ€§åºåˆ—åŒ–ç‰¹å¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SerializerFeature[] FEATURES = {</span><br><span class="line">            <span class="comment">//æ‰“å¼€å¾ªç¯å¼•ç”¨æ£€æµ‹ï¼ŒJSONField(serialize = false)ä¸å¾ªç¯</span></span><br><span class="line">            SerializerFeature.DisableCircularReferenceDetect,</span><br><span class="line">            <span class="comment">//é»˜è®¤ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ æ ¼å¼æ—¥æœŸæ ¼å¼åŒ–</span></span><br><span class="line">            SerializerFeature.WriteDateUseDateFormat,</span><br><span class="line">            <span class="comment">//è¾“å‡ºç©ºç½®å­—æ®µ</span></span><br><span class="line">            SerializerFeature.WriteMapNullValue,</span><br><span class="line">            <span class="comment">//listå­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º[]ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">            SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">            <span class="comment">// æ•°å€¼å­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º0ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">            SerializerFeature.WriteNullNumberAsZero,</span><br><span class="line">            <span class="comment">//Booleanå­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸ºfalseï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">            SerializerFeature.WriteNullBooleanAsFalse,</span><br><span class="line">            <span class="comment">//å­—ç¬¦ç±»å‹å­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º""ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">            SerializerFeature.WriteNullStringAsEmpty</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹è±¡è½¬ä¸ºå…·æœ‰è‡ªå®šä¹‰å±æ€§ç‰¹å¾çš„jsonå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toFeaturesJson</span><span class="params">(Object obj)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(obj, CONFIG, FEATURES);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toFeaturesJson"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹è±¡è½¬ä¸ºæ ¼å¼åŒ–è¾“å‡ºçš„jsonå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toPrettyJson</span><span class="params">(Object obj)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(obj, <span class="keyword">true</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toPrettyJson"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹è±¡è½¬jsonå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toJson</span><span class="params">(Object obj)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(obj, CONFIG);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toJson"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jsonå­—ç¬¦ä¸²è½¬æŒ‡å®šç±»å‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">toObj</span><span class="params">(String jsonString, Class&lt;T&gt; clazz)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.parseObject(jsonString, clazz);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toObj"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†jsonå­—ç¬¦ä¸²è½¬ä¸ºObjectå®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">toObj</span><span class="params">(String jsonString)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.parse(jsonString);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toObj"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jsonå­—ç¬¦ä¸²è½¬Mapå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Map&lt;String, T&gt; <span class="title">toMap</span><span class="params">(String jsonString)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSONObject.parseObject(jsonString, Map.class);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toMap"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»jsonå­—ç¬¦ä¸²è·å–æŒ‡å®škeyçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getValueFromJson</span><span class="params">(String jsonString, String key)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isAnyBlank(jsonString, key)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> JSONObject.parseObject(jsonString).get(key);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"getValueFromJson"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jsonå­—ç¬¦ä¸²è½¬List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">toList</span><span class="params">(String jsonString, Class&lt;T&gt; clazz)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSONArray.parseArray(jsonString, clazz);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toList"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jsonå­—ç¬¦ä¸²è½¬æ¢æˆList&lt;Map&lt;String, Object&gt;&gt;ç±»å‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; toListMap(String jsonString) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> JSON.parseObject(jsonString, <span class="keyword">new</span> TypeReference&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt;() {</span><br><span class="line">            });</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            exceptionMsg(<span class="string">"toListMap"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Jacksonç®€æ"><a href="#Jacksonç®€æ" class="headerlink" title="Jacksonç®€æ"></a>Jacksonç®€æ</h2><blockquote>
<p>springbootæ¡†æ¶é»˜è®¤åºåˆ—åŒ–å·¥å…·ï¼Œæ— é¡»å¼•å…¥pomæ–‡ä»¶</p>
</blockquote>
<h3 id="å°è£…å·¥å…·-1"><a href="#å°è£…å·¥å…·-1" class="headerlink" title="å°è£…å·¥å…·"></a>å°è£…å·¥å…·</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.common.util.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JavaType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> To0To0/10/17 1To:ToTo</span></span><br><span class="line"><span class="comment"> * jacksonåºåˆ—åŒ–å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JacksonUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper OBJECTMAPPER = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="comment">// ç»Ÿä¸€æ—¥æœŸæ ¼å¼yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">        OBJECTMAPPER.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®è§£æé‡åˆ°æœªçŸ¥å±æ€§æ—¶ä¸å¤±è´¥</span></span><br><span class="line">        OBJECTMAPPER.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">objToString</span><span class="params">(T obj)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> obj <span class="keyword">instanceof</span> String ? (String) obj : OBJECTMAPPER.writeValueAsString(obj);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">"Parse object to String error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">objToStringPretty</span><span class="params">(T obj)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> obj <span class="keyword">instanceof</span> String ? (String) obj :</span><br><span class="line">                    OBJECTMAPPER.writerWithDefaultPrettyPrinter().writeValueAsString(obj);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">"Parse object to String error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, Class&lt;T&gt; clazz)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(str) || clazz == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> clazz.equals(String.class) ? (T) str : OBJECTMAPPER.readValue(str, clazz);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.error(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, TypeReference&lt;T&gt; typeReference)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(str) || typeReference == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> (T) (typeReference.getType().equals(String.class) ? str : OBJECTMAPPER.readValue(str,</span><br><span class="line">                    typeReference));</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.error(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, Class&lt;?&gt; collectionClass, Class&lt;?&gt;... clazz)</span> </span>{</span><br><span class="line">        JavaType javaType = OBJECTMAPPER.getTypeFactory().constructParametricType(collectionClass, clazz);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> OBJECTMAPPER.readValue(str, javaType);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.error(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>fastjson</tag>
      </tags>
  </entry>
  <entry>
    <title>LocalDateTimeå’ŒDateè½¬åŒ–</title>
    <url>/post/21735.html</url>
    <content><![CDATA[<h2 id="LocalDateTimeå’ŒDateäº’ç›¸è½¬åŒ–"><a href="#LocalDateTimeå’ŒDateäº’ç›¸è½¬åŒ–" class="headerlink" title="LocalDateTimeå’ŒDateäº’ç›¸è½¬åŒ–"></a>LocalDateTimeå’ŒDateäº’ç›¸è½¬åŒ–</h2><h3 id="ç¤ºä¾‹å¦‚ä¸‹ï¼š"><a href="#ç¤ºä¾‹å¦‚ä¸‹ï¼š" class="headerlink" title="ç¤ºä¾‹å¦‚ä¸‹ï¼š"></a>ç¤ºä¾‹å¦‚ä¸‹ï¼š</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Date =&gt; LocalDateTime(é»˜è®¤æ—¶åŒºä¸º ä¸œ8åŒº)</span></span><br><span class="line">Date date = <span class="keyword">new</span> Date();</span><br><span class="line">LocalDateTime dateTime1 = LocalDateTime.ofInstant(date.toInstant(), ZoneId.systemDefault());</span><br><span class="line">System.out.println(<span class="string">"LocalDateTime:"</span> + dateTime1);</span><br><span class="line"></span><br><span class="line">LocalDateTime dateTime2 = LocalDateTime.ofInstant(Instant.ofEpochMilli(date.getTime()), ZoneId.systemDefault());</span><br><span class="line">System.out.println(<span class="string">"LocalDateTime:"</span> + dateTime2);</span><br><span class="line"></span><br><span class="line">LocalDateTime dateTime3 = date.toInstant().atOffset(ZoneOffset.ofHours(<span class="number">8</span>)).toLocalDateTime();</span><br><span class="line">System.out.println(<span class="string">"LocalDateTime:"</span> + dateTime3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LocalDateTime =&gt;Date(é»˜è®¤æ—¶åŒºä¸º ä¸œ8åŒº)</span></span><br><span class="line">LocalDateTime dateTime = LocalDateTime.now();</span><br><span class="line">Date date1 = Date.from(dateTime.atZone(ZoneId.systemDefault()).toInstant());</span><br><span class="line"></span><br><span class="line">Date date2 = Date.from(dateTime.toInstant(ZoneOffset.of(<span class="string">"+8"</span>)));</span><br><span class="line"></span><br><span class="line">Date date3 = Date.from(dateTime.toInstant(ZoneOffset.ofHours(<span class="number">8</span>)));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"Date:"</span> + date1);</span><br><span class="line">System.out.println(<span class="string">"Date:"</span> + date2);</span><br><span class="line">System.out.println(<span class="string">"Date:"</span> + date3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LocalDateTime è½¬æ¯«ç§’å€¼å’Œç§’å€¼</span></span><br><span class="line"><span class="keyword">long</span> milli = dateTime.toInstant(ZoneOffset.ofHours(<span class="number">8</span>)).toEpochMilli();</span><br><span class="line"><span class="keyword">long</span> second = dateTime.toEpochSecond(ZoneOffset.ofHours(<span class="number">8</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// LocalDateTime è®¡ç®—æ—¶é—´å·®</span></span><br><span class="line">LocalDateTime startTime = LocalDateTime.of(LocalDate.of(<span class="number">2021</span>, <span class="number">3</span>, <span class="number">25</span>), LocalTime.of(<span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>));</span><br><span class="line">LocalDateTime endTime = LocalDateTime.now();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Durationå·¥å…·ç±»</span></span><br><span class="line">Duration duration = Duration.between(startTime, endTime);</span><br><span class="line">System.out.println(<span class="string">"ç›¸å·®å¤©æ•°:"</span> + duration.toDays());</span><br><span class="line">System.out.println(<span class="string">"ç›¸å·®å°æ—¶:"</span> + duration.toHours());</span><br><span class="line">System.out.println(<span class="string">"ç›¸å·®åˆ†é’Ÿ:"</span> + duration.toMinutes());</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>LocalDateTime</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å¯MybatisPlusæ‰¹é‡æ’å…¥</title>
    <url>/post/10577.html</url>
    <content><![CDATA[<h2 id="å¼€å¯MPæ‰¹é‡æ’å…¥"><a href="#å¼€å¯MPæ‰¹é‡æ’å…¥" class="headerlink" title="å¼€å¯MPæ‰¹é‡æ’å…¥"></a>å¼€å¯MPæ‰¹é‡æ’å…¥</h2><h3 id="1-æ‰¹é‡æ–¹æ³•æ³¨å…¥"><a href="#1-æ‰¹é‡æ–¹æ³•æ³¨å…¥" class="headerlink" title="1. æ‰¹é‡æ–¹æ³•æ³¨å…¥"></a>1. æ‰¹é‡æ–¹æ³•æ³¨å…¥</h3><blockquote>
<p>ç»§æ‰¿<code>DefaultSqlInjector</code>: MPæ–¹æ³•æ‰©å±•é…ç½®æ³¨å°„å™¨(æ”¯æŒè‡ªå®šä¹‰æ•°æ®æ–¹æ³•æ³¨å…¥)</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.AbstractMethod;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.DefaultSqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.injector.methods.InsertBatchSomeColumn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: MPæ–¹æ³•æ‰©å±•é…ç½®æ³¨å°„å™¨(æ”¯æŒè‡ªå®šä¹‰æ•°æ®æ–¹æ³•æ³¨å…¥)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/7 13:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EasySqlInjector</span> <span class="keyword">extends</span> <span class="title">DefaultSqlInjector</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;AbstractMethod&gt; <span class="title">getMethodList</span><span class="params">(Class&lt;?&gt; mapperClass)</span> </span>{</span><br><span class="line">        <span class="comment">// é˜²æ­¢çˆ¶ç±»æ–¹æ³•ä¸å¯ä½¿ç”¨,æ‰€æœ‰è¦è¿”å›çˆ¶ç±»æ–¹æ³•å¹¶æ·»åŠ è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•</span></span><br><span class="line">        List&lt;AbstractMethod&gt; methodList = <span class="keyword">super</span>.getMethodList(mapperClass);</span><br><span class="line">        <span class="comment">// å¢åŠ æ‰©å±•çš„æ–¹æ³•(å­˜åœ¨äºæºç ,ä½†ä½œè€…æ²¡æœ‰å†…ç½®,æœ‰ä¸€å®šçš„bug)</span></span><br><span class="line">        methodList.add(<span class="keyword">new</span> InsertBatchSomeColumn());</span><br><span class="line">        <span class="keyword">return</span> methodList;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ¥å£"><a href="#2-è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ¥å£" class="headerlink" title="2. è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ¥å£"></a>2. è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ¥å£</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: åŸºäºMPè‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/7 13:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExpandMapper</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥ ä»…ä½¿ç”¨äºmysql,æ–¹æ³•åå¿…é¡»æ˜¯è¿™ä¸ª,(åŸºäºMPçš„æºç ä¸­çš„è§„å®š)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entityList å®ä¾‹åˆ—è¡¨ç»“åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½±å“è¡Œæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insertBatchSomeColumn</span><span class="params">(List&lt;T&gt; entityList)</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-æ”¹é€ ä¸šåŠ¡æ‰©å±•æ¥å£"><a href="#3-æ”¹é€ ä¸šåŠ¡æ‰©å±•æ¥å£" class="headerlink" title="3. æ”¹é€ ä¸šåŠ¡æ‰©å±•æ¥å£"></a>3. æ”¹é€ ä¸šåŠ¡æ‰©å±•æ¥å£</h3><blockquote>
<p>è®©ä¸šåŠ¡æ¥å£ç»§æ‰¿æˆ‘ä»¬ä¸Šé¢è‡ªå®šä¹‰çš„<code>ExpanMapper</code>æ¥å£ï¼Œå°±å¯ä»¥ä½¿ç”¨æ‰¹é‡æ’å…¥æ–¹æ³•ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.horse.service.blog.entity.Song;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ­Œæ›²ä¿¡æ¯è¡¨ Mapper æ¥å£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-02-04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SongMapper</span> <span class="keyword">extends</span> <span class="title">ExpandMapper</span>&lt;<span class="title">Song</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤é‡å¤æ­Œæ›²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeRepeatSong</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-å®ç°æ‰¹é‡æ’å…¥"><a href="#4-å®ç°æ‰¹é‡æ’å…¥" class="headerlink" title="4. å®ç°æ‰¹é‡æ’å…¥"></a>4. å®ç°æ‰¹é‡æ’å…¥</h3><blockquote>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>æ•°æ®åº“ä¸­é…ç½®æœ‰é»˜è®¤å€¼çš„ï¼Œè¿™é‡Œæ‰¹é‡æ’å…¥æ—¶ä¸ä¼šç”Ÿæ•ˆï¼Œéœ€è¦åœ¨è¿™é‡Œæ˜¾å¼çš„èµ‹å€¼ï¼›</li>
<li>Mybatis-Plusè®¾ç½®çš„è‡ªåŠ¨å¡«å……å­—æ®µä¸å—å½±å“ï¼Œä¾‹å¦‚ï¼šgmt_createå­—æ®µï¼›</li>
<li>å¯èƒ½å­˜åœ¨ä¸€å®šçš„bugï¼Œè°¨æ…ä½¿ç”¨ï¼Œä¸è¿‡æ•ˆç‡æŒºå¿«ã€‚åœ¨ä¸¥è°¨çš„å‰æä¸‹ï¼Œæœ€å¥½ä½¿ç”¨mybatisçš„åŠ¨æ€SQLè¿›è¡Œæ‰¹é‡æ’å…¥æ“ä½œï¼›</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SongServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SongMapper</span>, <span class="title">Song</span>&gt; <span class="keyword">implements</span> <span class="title">SongService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡ä¿å­˜ç½‘æ˜“äº‘æ­Œæ›²ä¿¡æ¯(å®šæ—¶ä»»åŠ¡å¤„ç†é‡å¤çš„æ­Œæ›²)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> songList</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSong</span><span class="params">(List&lt;Song&gt; songList)</span> </span>{</span><br><span class="line">        <span class="comment">// æºç æ³¨æ„: è¿™æ˜¯è‡ªé€‰å­—æ®µ insert !!,å¦‚æœä¸ªåˆ«å­—æ®µåœ¨ entity é‡Œä¸º null ä½†æ˜¯æ•°æ®åº“ä¸­æœ‰é…ç½®é»˜è®¤å€¼, insert åæ•°æ®åº“å­—æ®µæ˜¯ä¸º null è€Œä¸æ˜¯é»˜è®¤å€¼</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿™é‡Œentityä¸­çš„æ‰€æœ‰å­—æ®µå€¼éƒ½ä¸èƒ½ä¸ºç©º(é™¤äº†è‡ªåŠ¨å¡«å……çš„å­—æ®µ)</span></span><br><span class="line">        songList.forEach(song -&gt; song.setCopyright(BlogConstants.MUSIC_COPYRIGHT.UNCERTAIN.getCopyrightInfo())</span><br><span class="line">                .setDeleted(Boolean.TRUE));</span><br><span class="line">        baseMapper.insertBatchSomeColumn(songList);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <tags>
        <tag>MybatisPlus</tag>
      </tags>
  </entry>
  <entry>
    <title>MapStructå±æ€§è½¬æ¢ç®€å•ä½¿ç”¨</title>
    <url>/post/34398.html</url>
    <content><![CDATA[<h2 id="MapStructå±æ€§è½¬æ¢ç®€å•ä½¿ç”¨"><a href="#MapStructå±æ€§è½¬æ¢ç®€å•ä½¿ç”¨" class="headerlink" title="MapStructå±æ€§è½¬æ¢ç®€å•ä½¿ç”¨"></a>MapStructå±æ€§è½¬æ¢ç®€å•ä½¿ç”¨</h2><blockquote>
<p>å…¶å®è¿™ä¸ªç©æ„ï¼Œä¹Ÿå°±ä»…ä»…é™äºå±æ€§çš„å¤åˆ¶ï¼Œå…¶ä»–çš„å¤æ‚åŠŸèƒ½ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨ï¼Œå¢åŠ ä»£ç å¤æ‚ç¨‹åº¦ã€‚</p>
</blockquote>
<h3 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h3><blockquote>
<p>æˆ‘è¿™é‡Œå¼•å…¥å¼•å…¥äº†<code>mapstruct</code>å’Œ<code>lombok</code>ä¸¤ä¸ªä¾èµ–ï¼Œæ²¡æœ‰æŠ¥å†²çªï¼Œä½†æ˜¯åœ¨åšå®¢é¡¹ç›®ä½¿ç”¨ä¸­ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæŠ¥é”™å•¦ï¼Œè‡³ä»Šæœªè§£å†³ã€‚</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç¼–å†™æ˜ å°„æ¥å£"><a href="#ç¼–å†™æ˜ å°„æ¥å£" class="headerlink" title="ç¼–å†™æ˜ å°„æ¥å£"></a>ç¼–å†™æ˜ å°„æ¥å£</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.topsun.struct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mapstruct.BeanMapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mappings;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.factory.Mappers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/7 9:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CarStructMapper</span> </span>{</span><br><span class="line"></span><br><span class="line">    CarStructMapper INSTANCE = Mappers.getMapper(CarStructMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ä¾‹æ˜ å°„é…ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeanMapping(ignoreByDefault = true)</span></span><br><span class="line">    <span class="meta">@Mappings({</span></span><br><span class="line"><span class="meta">            @Mapping(source = "car.name", target = "carName"),</span></span><br><span class="line"><span class="meta">            @Mapping(source = "car.brand", target = "brand"),</span></span><br><span class="line"><span class="meta">            @Mapping(source = "car.price", target = "price"),</span></span><br><span class="line"><span class="meta">            @Mapping(source = "carAddress.address", target = "address")</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="function">CarDTO <span class="title">carToCarDto</span><span class="params">(Car car, CarAddress carAddress)</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="æµ‹è¯•å®ä¾‹"><a href="#æµ‹è¯•å®ä¾‹" class="headerlink" title="æµ‹è¯•å®ä¾‹"></a>æµ‹è¯•å®ä¾‹</h3><p><code>Car</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>CarAddress</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarAddress</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>CarDTO</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarDTO</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String carName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">"æœ—é€¸"</span>, <span class="string">"ä¸Šæµ·å¤§ä¼—"</span>, <span class="number">99999.99</span>);</span><br><span class="line">        CarAddress carAddress = <span class="keyword">new</span> CarAddress(<span class="string">"æµ™æ±Ÿæ­å·"</span>);</span><br><span class="line">        CarDTO carDTO = CarStructMapper.INSTANCE.carToCarDto(car, carAddress);</span><br><span class="line">        System.out.println(<span class="string">"carDTO: "</span> + carDTO);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">carDTO: CarDTO(carName=æœ—é€¸, brand=ä¸Šæµ·å¤§ä¼—, price=<span class="number">99999.99</span>, address=æµ™æ±Ÿæ­å·)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿˜æ˜¯ä¸è¦è½»æ˜“ä½¿ç”¨çš„ä¸ºå¥½ï¼Œ<code>BeanUtilså·¥å…·ç±»</code>å°±æŒºå¥½çš„ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>MapStruct</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL and Redis ç¢ç‰‡æ¸…ç†</title>
    <url>/post/49715.html</url>
    <content><![CDATA[<h1 id="MySQL-and-Redis-ç¢ç‰‡æ¸…ç†"><a href="#MySQL-and-Redis-ç¢ç‰‡æ¸…ç†" class="headerlink" title="MySQL and Redis ç¢ç‰‡æ¸…ç†"></a>MySQL and Redis ç¢ç‰‡æ¸…ç†</h1><h3 id="MySQLç£ç›˜ç¢ç‰‡æ¸…ç†"><a href="#MySQLç£ç›˜ç¢ç‰‡æ¸…ç†" class="headerlink" title="MySQLç£ç›˜ç¢ç‰‡æ¸…ç†"></a>MySQLç£ç›˜ç¢ç‰‡æ¸…ç†</h3><p>ç£ç›˜ç¢ç‰‡äº§ç”Ÿçš„åŸå› ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿç£ç›˜ç¢ç‰‡ï¼Ÿé‚£æ˜¯å› ä¸ºæŸä¸€ä¸ªè¡¨å¦‚æœç»å¸¸æ’å…¥æ•°æ®å’Œåˆ é™¤æ•°æ®ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå¾ˆå¤šæœªä½¿ç”¨çš„ç©ºç™½ç©ºé—´ï¼Œè¿™äº›ç©ºç™½ç©ºé—´å°±æ˜¯ä¸è¿ç»­çš„ç¢ç‰‡ï¼Œè¿™æ ·ä¹…è€Œä¹…ä¹‹ï¼Œè¿™ä¸ªè¡¨å°±ä¼šå ç”¨å¾ˆå¤§ç©ºé—´ï¼Œä½†å®é™…ä¸Šè¡¨é‡Œé¢çš„è®°å½•æ•°å´å¾ˆå°‘ï¼Œè¿™æ ·ä¸ä½†ä¼šæµªè´¹ç©ºé—´ï¼Œå¹¶ä¸”æŸ¥è¯¢é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚</p>
<blockquote>
<p>æŸ¥çœ‹é™¤ç³»ç»Ÿè¡¨å¤–ç£ç›˜ç¢ç‰‡å ç”¨ç©ºé—´[date_free]å¤§äº0çš„æ‰€æœ‰è¡¨ä¿¡æ¯</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹é™¤ç³»ç»Ÿè¡¨å¤– data_freeå€¼å¤§äº0 çš„æ‰€æœ‰è¡¨çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    concat(TABLE_SCHEMA,<span class="string">'.'</span>,TABLE_NAME)                                         <span class="keyword">AS</span> database_name,</span><br><span class="line">    concat(<span class="keyword">TRUNCATE</span>(<span class="built_in">SUM</span>(DATA_LENGTH<span class="operator">+</span>DATA_FREE<span class="operator">+</span>INDEX_LENGTH)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>),<span class="string">' MB'</span>) <span class="keyword">AS</span> total_size,</span><br><span class="line">    concat(<span class="keyword">TRUNCATE</span>(<span class="built_in">SUM</span>(DATA_LENGTH)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>),<span class="string">' MB'</span>)                        <span class="keyword">AS</span> data_size,</span><br><span class="line">    concat(<span class="keyword">TRUNCATE</span>(<span class="built_in">SUM</span>(DATA_FREE)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>),<span class="string">' MB'</span>)                          <span class="keyword">AS</span> data_free,</span><br><span class="line">    concat(<span class="keyword">TRUNCATE</span>(<span class="built_in">SUM</span>(INDEX_LENGTH)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>)                        <span class="keyword">AS</span> index_size,</span><br><span class="line">    ENGINE</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">'information_schema'</span>,</span><br><span class="line">                           <span class="string">'mysql'</span>)</span><br><span class="line">    <span class="keyword">AND</span> data_free<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    TABLE_SCHEMA,</span><br><span class="line">    ENGINE</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    data_free <span class="keyword">DESC</span></span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ¸…ç†ç£ç›˜ç¢ç‰‡çš„ä¸¤ç§æ–¹å¼</p>
</blockquote>
<ul>
<li><code>OPTIMIZE TABLE è¡¨å;</code></li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- OPTIMIZE TABLEåªå¯¹MyISAMã€BDBå’ŒInnoDBè¡¨èµ·ä½œç”¨</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> tb_task_log;</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œç»“æœä¼šå‡ºç° â€œTable does not support optimize, doing recreate + analyze insteadâ€ï¼Œè¿™ä¸ªå…¶å®æ— å¦¨ï¼Œå®é™…ä¸Šç£ç›˜ç¢ç‰‡å·²ç»è¢«æ¸…é™¤æ‰äº†ã€‚</p>
<ul>
<li><code>ALTER TABLE è¡¨å ENGINE = Innodb;</code>ï¼ˆåªæ˜¯<code>InnoDB</code>çš„è¡¨å¯ä»¥è¿™ä¹ˆåš</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_operational_log engine<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></tbody></table></figure>
<p><strong>æ³¨æ„ï¼<code>OPTIMIZE</code>æ“ä½œä¼šæš‚æ—¶é”ä½è¡¨,è€Œä¸”æ•°æ®é‡è¶Šå¤§,è€—è´¹çš„æ—¶é—´ä¹Ÿè¶Šé•¿,å®ƒæ¯•ç«Ÿä¸æ˜¯ç®€å•æŸ¥è¯¢æ“ä½œã€‚</strong>æ‰€ä»¥æŠŠ<code>OPTIMIZE</code>å‘½ä»¤æ”¾åœ¨ç¨‹åºä¸­æ˜¯ä¸å¦¥å½“çš„,ä¸ç®¡è®¾ç½®çš„å‘½ä¸­ç‡å¤šä½,å½“è®¿é—®é‡å¢å¤§çš„æ—¶å€™,æ•´ä½“å‘½ä¸­ç‡ä¹Ÿä¼šä¸Šå‡,è¿™æ ·è‚¯å®šä¼šå¯¹ç¨‹åºçš„è¿è¡Œæ•ˆç‡é€ æˆå¾ˆå¤§å½±å“ã€‚æ¯”è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯åšä¸ªshell,å®šæœŸæ£€æŸ¥mysqlä¸­ <code>information_schema</code>.<code>TABLES</code>å­—æ®µ,æŸ¥çœ‹<code>DATA_FREE</code>å­—æ®µ,å¤§äº0çš„è¯,å°±è¡¨ç¤ºæœ‰ç¢ç‰‡ï¼Œç„¶åå¯åŠ¨è„šæœ¬ã€‚</p>
<hr>
<h3 id="Redisç£ç›˜ç¢ç‰‡æ¸…ç†"><a href="#Redisç£ç›˜ç¢ç‰‡æ¸…ç†" class="headerlink" title="Redisç£ç›˜ç¢ç‰‡æ¸…ç†"></a>Redisç£ç›˜ç¢ç‰‡æ¸…ç†</h3><p>å†…å­˜ç¢ç‰‡äº§ç”Ÿçš„åŸå› ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>å½“Redisä¸­æ¸…ç†äº†å¤§é‡çš„Keyä¹‹ååŸå…ˆRedisç”³è¯·çš„å†…å­˜ï¼ˆused_memory_rssï¼‰å°†ç»§ç»­æŒæœ‰è€Œä¸ä¼šé‡Šæ”¾ï¼Œæ­¤æ—¶æŸ¥çœ‹å†…å­˜ä¿¡æ¯å°†ä¼šçœ‹åˆ°å­˜åœ¨å¤§é‡çš„å†…å­˜ç¢ç‰‡ã€‚</p>
<p>å†…å­˜åˆ†æ(å½“å‰æ¼”ç¤ºçš„redisæœåŠ¡å†…å­˜ç¢ç‰‡ç‡å¹¶ä¸é«˜)</p>
<blockquote>
<p>åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ <code>used_memory_rss</code>çš„å€¼åº”è¯¥åªæ¯”<code>used_memory</code>é«˜ä¸€ç‚¹ç‚¹ã€‚å½“ rss &gt; used ï¼Œä¸”ä¸¤è€…çš„å€¼ç›¸å·®è¾ƒå¤§æ—¶ï¼Œè¡¨ç¤ºå­˜åœ¨ï¼ˆå†…éƒ¨æˆ–å¤–éƒ¨çš„ï¼‰å†…å­˜ç¢ç‰‡ã€‚å½“ used &gt; rss æ—¶ï¼Œè¡¨ç¤º redisçš„éƒ¨åˆ†å†…å­˜è¢«æ“ä½œç³»ç»Ÿæ¢å‡ºåˆ°äº¤æ¢ç©ºé—´äº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œå¯èƒ½ä¼šäº§ç”Ÿæ˜æ˜¾çš„å»¶è¿Ÿ</p>
<p>å†…å­˜ç¢ç‰‡çš„æ¯”ç‡å¯ä»¥é€šè¿‡<code>mem_fragmentation_ratio</code>çš„å€¼çœ‹å‡ºã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">&gt; info memory</span><br><span class="line"># Memory</span><br><span class="line">used_memory:872168  # ç”±redisåˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œå•ä½ï¼šå­—èŠ‚ï¼ˆbyteï¼‰</span><br><span class="line">used_memory_human:851.73K # ä»¥äººç±»å¯è¯»çš„æ ¼å¼è¿”å› Redis åˆ†é…çš„å†…å­˜æ€»é‡</span><br><span class="line">used_memory_rss:2912256 # ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿”å› Redis å·²åˆ†é…çš„å†…å­˜æ€»é‡</span><br><span class="line">used_memory_rss_human:<span class="number">2.</span>78M</span><br><span class="line">used_memory_peak:913800 # Redis çš„å†…å­˜æ¶ˆè€—å³°å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span><br><span class="line">used_memory_peak_human:<span class="number">892.</span>38K</span><br><span class="line">used_memory_peak_perc:<span class="number">95.44</span>%</span><br><span class="line">used_memory_overhead:<span class="number">830616</span></span><br><span class="line">used_memory_startup:<span class="number">810120</span></span><br><span class="line">used_memory_dataset:<span class="number">41552</span></span><br><span class="line">used_memory_dataset_perc:<span class="number">66.97</span>%</span><br><span class="line">allocator_allocated:<span class="number">958056</span></span><br><span class="line">allocator_active:<span class="number">1265664</span></span><br><span class="line">allocator_resident:<span class="number">3502080</span></span><br><span class="line">total_system_memory:<span class="number">1927168000</span></span><br><span class="line">total_system_memory_human:<span class="number">1.</span>79G</span><br><span class="line">used_memory_lua:37888 # Lua å¼•æ“æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span><br><span class="line">used_memory_lua_human:<span class="number">37.</span>00K</span><br><span class="line">used_memory_scripts:<span class="number">0</span></span><br><span class="line">used_memory_scripts_human:0B</span><br><span class="line">number_of_cached_scripts:<span class="number">0</span></span><br><span class="line">maxmemory:<span class="number">268435456</span></span><br><span class="line">maxmemory_human:<span class="number">256.</span>00M</span><br><span class="line">maxmemory_policy:noeviction</span><br><span class="line">allocator_frag_ratio:<span class="number">1.32</span></span><br><span class="line">allocator_frag_bytes:<span class="number">307608</span></span><br><span class="line">allocator_rss_ratio:<span class="number">2.77</span></span><br><span class="line">allocator_rss_bytes:<span class="number">2236416</span></span><br><span class="line">rss_overhead_ratio:<span class="number">0.83</span></span><br><span class="line">rss_overhead_bytes:-<span class="number">589824</span></span><br><span class="line">mem_fragmentation_ratio:3.50 # used_memory_rss å’Œ used_memory ä¹‹é—´çš„æ¯”ç‡</span><br><span class="line">mem_fragmentation_bytes:<span class="number">2081112</span></span><br><span class="line">mem_not_counted_for_evict:<span class="number">0</span></span><br><span class="line">mem_replication_backlog:<span class="number">0</span></span><br><span class="line">mem_clients_slaves:<span class="number">0</span></span><br><span class="line">mem_clients_normal:<span class="number">20496</span></span><br><span class="line">mem_aof_buffer:<span class="number">0</span></span><br><span class="line">mem_allocator:jemalloc-<span class="number">5.1</span><span class="number">.0</span></span><br><span class="line">active_defrag_running:<span class="number">0</span></span><br><span class="line">lazyfree_pending_objects:<span class="number">0</span></span><br><span class="line">lazyfreed_objects:<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æ¸…ç†å†…å­˜ç¢ç‰‡</p>
<p>å¼€å¯redisè‡ªåŠ¨æ¸…ç†</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œredisçš„è‡ªåŠ¨æ¸…ç†å†…å­˜ç¢ç‰‡çš„å‚æ•°æ˜¯å…³é—­çš„</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢å¼€å…³çŠ¶æ€</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> config get activedefrag</span></span><br><span class="line">activedefrag</span><br><span class="line">no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰‹åŠ¨å¼€å¯</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> config <span class="built_in">set</span> activedefrag yes</span></span><br><span class="line">OK</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æ‰‹åŠ¨æ¸…ç†</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨æ¸…ç†</span></span><br><span class="line">&gt; memory purge</span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>
<p>ç›¸å…³å‚æ•°é…ç½®</p>
<blockquote>
<p>å†…å­˜æ¸…ç†ç›¸å…³å‚æ•°å¦‚ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨config getçš„æ–¹å¼æŸ¥çœ‹å¯¹åº”çš„å€¼</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Enabled active defragmentation</span></span><br><span class="line"><span class="comment"># ç¢ç‰‡æ•´ç†æ€»å¼€å…³</span></span><br><span class="line"><span class="comment">#activedefrag yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Minimum amount of fragmentation waste to start active defrag</span></span><br><span class="line"><span class="comment"># å†…å­˜ç¢ç‰‡è¾¾åˆ°å¤šå°‘çš„æ—¶å€™å¼€å¯æ•´ç†</span></span><br><span class="line">active-defrag-ignore-bytes 100mb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Minimum percentage of fragmentation to start active defrag</span></span><br><span class="line"><span class="comment"># ç¢ç‰‡ç‡è¾¾åˆ°ç™¾åˆ†ä¹‹å¤šå°‘å¼€å¯æ•´ç†</span></span><br><span class="line">active-defrag-threshold-lower 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maximum percentage of fragmentation at which we use maximum effort</span></span><br><span class="line"><span class="comment"># ç¢ç‰‡ç‡å°ä½™å¤šå°‘ç™¾åˆ†æ¯”å¼€å¯æ•´ç†</span></span><br><span class="line">active-defrag-threshold-upper 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># Minimal effort for defrag in CPU percentage</span></span><br><span class="line">active-defrag-cycle-min 25</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maximal effort for defrag in CPU percentage</span></span><br><span class="line">active-defrag-cycle-max 75</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå¸¸è§„æ“ä½œ</title>
    <url>/post/4919.html</url>
    <content><![CDATA[<h2 id="MySQLå¸¸è§„æ“ä½œ"><a href="#MySQLå¸¸è§„æ“ä½œ" class="headerlink" title="MySQLå¸¸è§„æ“ä½œ"></a>MySQLå¸¸è§„æ“ä½œ</h2><blockquote>
<p>ä¸»è¦5.7ç‰ˆæœ¬å†™æ³•ï¼Œå¯èƒ½ä¼šç©¿æ’8.xç‰ˆæœ¬çš„å†™æ³•</p>
</blockquote>
<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><h4 id="1-æŸ¥è¯¢ç»“æœè¡Œè½¬åˆ—"><a href="#1-æŸ¥è¯¢ç»“æœè¡Œè½¬åˆ—" class="headerlink" title="1.æŸ¥è¯¢ç»“æœè¡Œè½¬åˆ—"></a>1.æŸ¥è¯¢ç»“æœè¡Œè½¬åˆ—</h4><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tt.user_id                             <span class="keyword">AS</span> userId,</span><br><span class="line">       <span class="built_in">sum</span>(if(tt.pay_type <span class="operator">=</span> <span class="number">0</span>, tt.amount, <span class="number">0</span>)) <span class="keyword">AS</span> alipayAmount,</span><br><span class="line">       <span class="built_in">sum</span>(if(tt.pay_type <span class="operator">=</span> <span class="number">1</span>, tt.amount, <span class="number">0</span>)) <span class="keyword">AS</span> weChatAmount,</span><br><span class="line">       <span class="built_in">sum</span>(tt.amount)                         <span class="keyword">AS</span> totalAmount</span><br><span class="line"><span class="keyword">FROM</span> tb_trade tt</span><br><span class="line"><span class="keyword">WHERE</span> tt.is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">AND</span> tt.trade_status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> tt.user_id</span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥è¯¢ç»“æœ</p>
<p><img src="https://i.loli.net/2021/06/21/VjiZLWb1wO72KRI.png" alt="image-20210621092620291"></p>
<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><h4 id="1-åˆ é™¤é‡å¤è®°å½•"><a href="#1-åˆ é™¤é‡å¤è®°å½•" class="headerlink" title="1. åˆ é™¤é‡å¤è®°å½•"></a>1. åˆ é™¤é‡å¤è®°å½•</h4><blockquote>
<p>åˆ é™¤é‡å¤è®°å½•ï¼Œä¿ç•™idæœ€å°çš„</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¸èƒ½æ ¹æ®æœ¬è¡¨çš„æŸ¥è¯¢ç»“æœæ¥æ›´æ–°æœ¬è¡¨çš„æ•°æ®ï¼ˆmysqlåªèƒ½è¿™æ ·å†™ï¼‰</span></span><br><span class="line"><span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	tb_student </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	email <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> email <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> email <span class="keyword">FROM</span> tb_student <span class="keyword">GROUP</span> <span class="keyword">BY</span> email <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>( <span class="number">1</span> )<span class="operator">&gt;</span> <span class="number">1</span> ) sheet1 ) </span><br><span class="line">	<span class="keyword">AND</span> `<span class="keyword">no</span>` <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> `twoNo` <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="built_in">MIN</span>( `<span class="keyword">no</span>` ) <span class="keyword">AS</span> `twoNo` <span class="keyword">FROM</span> tb_student <span class="keyword">GROUP</span> <span class="keyword">BY</span> email <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>( <span class="number">1</span> )<span class="operator">&gt;</span> <span class="number">1</span> ) sheet2 );</span><br></pre></td></tr></tbody></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>email</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>æ±¤å§†</td>
<td>3468449362@qq.com</td>
</tr>
<tr>
<td>2</td>
<td>æ°ç‘</td>
<td>mabin142804@163.com</td>
</tr>
<tr>
<td>3</td>
<td>é«˜é£</td>
<td>3468449362@qq.com</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><h4 id="1-åŸºæœ¬æ’å…¥æ“ä½œ"><a href="#1-åŸºæœ¬æ’å…¥æ“ä½œ" class="headerlink" title="1. åŸºæœ¬æ’å…¥æ“ä½œ"></a>1. åŸºæœ¬æ’å…¥æ“ä½œ</h4><blockquote>
<p>æ“ä½œé¡»çŸ¥ï¼š</p>
<ol>
<li>å¦‚æœæ’å…¥å…¨æ•°æ®å­—æ®µï¼Œå¯ç›´æ¥çœç•¥ï¼Œå¦åˆ™ï¼Œéœ€è¦å¯¹åº”æ’å…¥æ•°æ®ä¹¦å†™å¯¹åº”å­—æ®µ</li>
<li>æ’å…¥å­—æ®µå’Œå¾…æ’å…¥æ•°æ®çš„æ•°é‡å’Œç±»å‹å¿…é¡»å¯¹åº”</li>
</ol>
</blockquote>
<p>æ–¹å¼1ï¼šå•æ¡æ’å…¥</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">INTO</span> tb_student <span class="keyword">value</span>(<span class="string">'66'</span>,<span class="string">'å°å¦®'</span>,<span class="string">'1998-10-04'</span>,<span class="string">'å¥³'</span>); <span class="comment">-- å…¨å­—æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">INTO</span> tb_student(s_id,s_name,s_birth) <span class="keyword">value</span>(<span class="string">'66'</span>,<span class="string">'å°å¦®'</span>,<span class="string">'1998-10-04'</span>); <span class="comment">-- æŒ‡å®šå­—æ®µ</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ–¹å¼2ï¼šæ‰¹é‡æ’å…¥</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">INSERT into tb_student values</span><br><span class="line">('66','å°å¦®1','1998-10-04','å¥³'),</span><br><span class="line">('67','å°å¦®2','1998-10-04','å¥³'),</span><br><span class="line">('68','å°å¦®3','1998-10-04','å¥³'); -- å…¨å­—æ®µ</span><br><span class="line"></span><br><span class="line">INSERT into tb_student(s_id,s_name,s_birth) values</span><br><span class="line">('66','å°å¦®1','1998-10-04'),</span><br><span class="line">('67','å°å¦®2','1998-10-04'),</span><br><span class="line">('68','å°å¦®3','1998-10-04'); -- æŒ‡å®šå­—æ®µ</span><br></pre></td></tr></tbody></table></figure>
<p>æ–¹å¼3ï¼šæŸ¥è¯¢å¹¶æ’å…¥æ•°æ®ï¼ˆæ ¼å¼ï¼šINSERT INTO â€¦ SELECT â€¦ï¼‰</p>
<blockquote>
<p>æ³¨æ„ï¼šç›®æ ‡è¡¨ï¼ˆtb_studentï¼‰å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ï¼Œç³»ç»Ÿä¼šæç¤ºç³»ç»Ÿæ— æ•ˆï¼</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">INTO</span> tb_student <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_student <span class="keyword">WHERE</span> s_id <span class="operator">=</span> <span class="string">'66'</span>; <span class="comment">-- å…¨å­—æ®µï¼ˆè‡ªè¡¨æ•°æ®ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">INTO</span> tb_student(s_id,s_name,s_birth) </span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">IF(s_id<span class="operator">=</span><span class="string">'66'</span>,<span class="string">'99'</span>,s_id),</span><br><span class="line">s_name,</span><br><span class="line">s_birth </span><br><span class="line"><span class="keyword">from</span> tb_student <span class="keyword">WHERE</span> s_id <span class="operator">=</span> <span class="string">'66'</span>; <span class="comment">-- æŒ‡å®šå­—æ®µï¼ˆè‡ªè¡¨æ•°æ®ï¼‰</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ–¹å¼4ï¼š[MySQLä¸æ”¯æŒ] æ‰¹é‡æŸ¥è¯¢æ’å…¥å¹¶åˆ›å»ºç›®æ ‡è¡¨ï¼ˆæ ¼å¼ï¼šSELECT â€¦ INTO . FROM .ï¼‰</p>
<blockquote>
<p>æ³¨æ„ï¼šç›®æ ‡è¡¨ï¼ˆtb_student2ï¼‰å¿…é¡»ä¸å­˜åœ¨ï¼Œæ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å»ºè¡¨å¹¶æ’å…¥æ•°æ®</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">INTO</span> tb_student2 <span class="keyword">FROM</span> tb_student <span class="keyword">WHERE</span> s_sex <span class="operator">=</span> <span class="string">'ç”·'</span>;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><h4 id="1-updateåˆ·æ•°æ®"><a href="#1-updateåˆ·æ•°æ®" class="headerlink" title="1. updateåˆ·æ•°æ®"></a>1. updateåˆ·æ•°æ®</h4><blockquote>
<p>updateæ–¹å¼æ‰¹é‡æ–¹å¼æ‰¹é‡åˆ·æ•°æ®ï¼Œå‡ ç§æ–¹å¼å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- updateå¤šè¡¨è”åˆ·æ•°æ®</span></span><br><span class="line"></span><br><span class="line">UPDATE A </span><br><span class="line"><span class="keyword">SET</span> A.update_time <span class="operator">=</span> B.update_time </span><br><span class="line"><span class="keyword">FROM</span> A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.order_bh <span class="operator">=</span> B.order_bh;</span><br><span class="line">	</span><br><span class="line">UPDATE A</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.order_bh <span class="operator">=</span> B.order_bh </span><br><span class="line"><span class="keyword">SET</span> A.update_time <span class="operator">=</span> B.update_time;</span><br><span class="line"></span><br><span class="line">UPDATE A </span><br><span class="line"><span class="keyword">SET</span> A.update_time <span class="operator">=</span> ( <span class="keyword">SELECT</span> B.update_time <span class="keyword">FROM</span> B <span class="keyword">WHERE</span> A.order_bh <span class="operator">=</span> B.order_bh );</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><h4 id="1-COUNT-å‡½æ•°"><a href="#1-COUNT-å‡½æ•°" class="headerlink" title="1. COUNT()å‡½æ•°"></a>1. COUNT()å‡½æ•°</h4><blockquote>
<p>countå‡½æ•°ä¸­è¿˜å¯ä»¥å†™å¦‚å‡½æ•°è¡¨è¾¾å¼<code>express</code>ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ç»Ÿè®¡æ•°æ®ã€‚</p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>countçš„å€¼æ˜¯NULLæ˜¯ä¸ç»Ÿè®¡æ•°ï¼Œ count(â€˜ä»»æ„å†…å®¹â€™)éƒ½ä¼šç»Ÿè®¡å‡ºæ‰€æœ‰è®°å½•æ•°ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- å’Œjavaä¸­çš„orè¿ç®—ç¬¦ç±»ä¼¼ï¼šå¦‚æœexpressä¸ºtrue,é‚£ä¹ˆå°±ä¸æ‰§è¡Œoråé¢çš„è¡¨è¾¾å¼ï¼Œå¦åˆ™å°±æ‰§è¡Œ,ç»“æœä¸ºNULLï¼Œä¸ä¼šè¿›è¡Œç»Ÿè®¡è®¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(tb.views <span class="operator">&gt;</span> <span class="number">100</span>) <span class="keyword">AS</span> <span class="string">'viewCount'</span></span><br><span class="line"><span class="keyword">FROM</span> tb_blog tb</span><br><span class="line"><span class="keyword">WHERE</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">ç»“æœï¼šviewCount:<span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(tb.views <span class="operator">&gt;</span> <span class="number">100</span> <span class="keyword">OR</span> <span class="keyword">NULL</span>) <span class="keyword">AS</span> <span class="string">'viewCount'</span></span><br><span class="line"><span class="keyword">FROM</span> tb_blog tb</span><br><span class="line"><span class="keyword">WHERE</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">ç»“æœï¼šviewCount:<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¹Ÿå¯ä»¥ä½¿ç”¨ifå‡½æ•°è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(if(tb.views <span class="operator">&gt;</span> <span class="number">100</span>, <span class="string">'ä»»æ„éNULLå€¼'</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> <span class="string">'viewCount'</span></span><br><span class="line"><span class="keyword">FROM</span> tb_blog tb</span><br><span class="line"><span class="keyword">WHERE</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">ç»“æœï¼šviewCount:<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ¦‚å¿µå¸¸è¯†"><a href="#æ¦‚å¿µå¸¸è¯†" class="headerlink" title="æ¦‚å¿µå¸¸è¯†"></a>æ¦‚å¿µå¸¸è¯†</h3><h4 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h4><blockquote>
</blockquote>
]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Nacosæ³¨å†Œé…ç½®ä¸­å¿ƒ</title>
    <url>/post/32731.html</url>
    <content><![CDATA[<h2 id="Nacosæ³¨å†Œé…ç½®ä¸­å¿ƒ"><a href="#Nacosæ³¨å†Œé…ç½®ä¸­å¿ƒ" class="headerlink" title="Nacosæ³¨å†Œé…ç½®ä¸­å¿ƒ"></a>Nacosæ³¨å†Œé…ç½®ä¸­å¿ƒ</h2><h3 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"># çˆ¶å…¬è½¦ä¸ªéœ€è¦å¼•å…¥çš„ä¾èµ–</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># æ¨¡å—éœ€è¦å¼•å…¥çš„ä¾èµ–</span><br><span class="line">        # æ³¨å†Œä¸­å¿ƒä¾èµ–</span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		# é…ç½®ä¸­å¿ƒä¾èµ–</span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-nacosæ³¨å†Œä¸­å¿ƒè§„åˆ™"><a href="#2-nacosæ³¨å†Œä¸­å¿ƒè§„åˆ™" class="headerlink" title="2. nacosæ³¨å†Œä¸­å¿ƒè§„åˆ™"></a>2. nacosæ³¨å†Œä¸­å¿ƒè§„åˆ™</h3><blockquote>
<ul>
<li>æ¯ä¸ªæ¨¡å—å¿…é¡»é…ç½®<code>spring.application.name</code>é€‰é¡¹çš„æ¨¡å—å<ul>
<li>å› ä¸ºå®ƒæ˜¯æ„æˆNacosé…ç½®ä¸­å¿ƒDataIdå­—æ®µçš„ä¸€éƒ¨åˆ†</li>
</ul>
</li>
<li>DataIdå®Œæˆå…¬å¼ï¼š<code>${prefix}-${spring.profile.active}-${file-extension}</code><ul>
<li>prefixï¼šé»˜è®¤æ˜¯ç½®<code>spring.application.name</code>çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>spring.cloud.nacos.config.prefix</code>é¡¹æ¥é…ç½®</li>
<li>spring.profile.activeï¼šå½“å‰æœåŠ¡è¿è¡Œçš„ç¯å¢ƒï¼šprodã€devã€testç­‰</li>
<li>file-extensionï¼šé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡<code>spring.cloud.nacos.config.file-extension</code>é¡¹æ¥é…ç½®ï¼Œç›®å‰åªæ”¯æŒyamlå’Œpropretiesä¸¤ç§ç±»å‹</li>
</ul>
</li>
<li>é€šè¿‡SpringCloudçš„åŸç”Ÿæ³¨è§£<code>@RefreshScope</code>å®ç°é…ç½®çš„è‡ªåŠ¨æ›´æ–°<ul>
<li>ä¸€èˆ¬å°†æ³¨è§£å†™åœ¨ä¸»å¯åŠ¨ç±»ä¸Šå³å¯</li>
</ul>
</li>
</ul>
</blockquote>
<p>é…ç½®å‘½åç©ºé—´</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426203335.png" alt="Snipaste_2021-04-26_20-29-47"></p>
<p>é…ç½®yamlç±»å‹æˆ–è€…propertiesç±»å‹æ–‡ä»¶</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426203405.png" alt="Snipaste_2021-04-26_20-32-28"></p>
<h3 id="3-å·¥ç¨‹é…ç½®æ–‡ä»¶"><a href="#3-å·¥ç¨‹é…ç½®æ–‡ä»¶" class="headerlink" title="3. å·¥ç¨‹é…ç½®æ–‡ä»¶"></a>3. å·¥ç¨‹é…ç½®æ–‡ä»¶</h3><blockquote>
<p>NacosåŒSpringCloud Configä¸€æ ·,åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶,è¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–,æ‹‰å–é…ç½®ä¹‹å,æ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚</p>
<p>springbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„, bootstrap.ymlä¼˜å…ˆçº§é«˜äºapplication.ymlã€‚</p>
<p>ä¸€å®šä¸è¦å¿˜è®°å…³é—­<code>ClientWorker</code>çš„æ—¥å¿—æ‰“å°ã€‚</p>
</blockquote>
<p><code>bootstrap.yml</code></p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8110</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-blog</span> <span class="comment"># æœåŠ¡å</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># æ¿€æ´»ç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">*.*.*.*:8848</span> <span class="comment"># æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span>  <span class="comment"># é…ç½®ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">${spring.cloud.nacos.discovery.server-addr}</span> <span class="comment"># é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span>    <span class="comment"># é…ç½®æ–‡ä»¶åç¼€(å’Œnacoså®¢æˆ·ç«¯ä¿æŒä¸€è‡´)</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">c0df1ff6-5f81-4f88-a41b-d23d2075f354</span>  <span class="comment"># å‘½åç©ºé—´id</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">HORSE_VUE_BLOG_DEV</span>  <span class="comment"># åˆ†ç»„åç§°</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">******</span>  <span class="comment"># ç™»å½•nacoså®¢æˆ·ç«¯çš„ç”¨æˆ·å</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">******</span>  <span class="comment">#  ç™»å½•nacoså®¢æˆ·ç«¯çš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨äºæŸ¥çœ‹sqlè¯­å¥</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.horse.service.blog:</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">com.alibaba.nacos.client.config.impl.ClientWorker:</span> <span class="string">error</span> <span class="comment"># è°ƒæ•´nacosçš„æ—¥å¿—çº§åˆ«[å‡å°‘æ—¥å¿—æ‰“å°]</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>application.yml</code>é…ç½®ä¸é…ç½®éƒ½å¯ä»¥ï¼Œæ²¡æœ‰ä¸¥æ ¼è¦æ±‚ã€‚</p>
<h3 id="4-æ·»åŠ æ³¨è§£"><a href="#4-æ·»åŠ æ³¨è§£" class="headerlink" title="4. æ·»åŠ æ³¨è§£"></a>4. æ·»åŠ æ³¨è§£</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/9/8 11:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@RefreshScope # é…ç½®æ–‡ä»¶åŠ¨æ€åˆ·æ–°æ³¨è§£ï¼Œä¹Ÿå¯ä½œç”¨äºç±»ä¸Š</span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = {"com.horse", "cn.hutool.extra.spring"})</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceBlogApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(ServiceBlogApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Nacos</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQå®‰è£…é…ç½®</title>
    <url>/post/47578.html</url>
    <content><![CDATA[<h2 id="RabbitMQå®‰è£…é…ç½®"><a href="#RabbitMQå®‰è£…é…ç½®" class="headerlink" title="RabbitMQå®‰è£…é…ç½®"></a>RabbitMQå®‰è£…é…ç½®</h2><blockquote>
<p>å› ä¸ºRabbitMQå®‰è£…åŒ…è¿›è¡Œå®‰è£…æ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ï¼Œè¿™é‡ŒæŸ¥ç”¨Dockeré•œåƒå®‰è£…ã€‚</p>
</blockquote>
<h3 id="1-æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨"><a href="#1-æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨" class="headerlink" title="1. æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨"></a>1. æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨</h3><blockquote>
<p>è¿›å…¥Docker Hubï¼ŒæŸ¥æ‰¾éœ€è¦çš„æƒŠé™©ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426204759.png" alt="Snipaste_2021-04-26_20-47-38"></p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker pull rabbitmq:3.8.14-management</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG                 IMAGE ID       CREATED       SIZE</span><br><span class="line">rabbitmq     3.8.14-management   edd581f906b9   3 weeks ago   187MB</span><br></pre></td></tr></tbody></table></figure>
<p>å¯åŠ¨å®¹å™¨ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker run -d --name horse-rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.8.14-management</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED      STATUS      PORTS                                                                                                                                                 NAMES</span><br><span class="line">2d2dc97ed0f1   rabbitmq:3.8.14-management   <span class="string">"docker-entrypoint.sâ€¦"</span>   7 days ago   Up 2 days   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   horse-rabbitmq</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-å¯è§†åŒ–é…ç½®"><a href="#2-å¯è§†åŒ–é…ç½®" class="headerlink" title="2. å¯è§†åŒ–é…ç½®"></a>2. å¯è§†åŒ–é…ç½®</h3><h4 id="2-1-ç™»å½•"><a href="#2-1-ç™»å½•" class="headerlink" title="2.1 ç™»å½•"></a>2.1 ç™»å½•</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205228.png" alt="Snipaste_2021-04-26_20-51-24"></p>
<h4 id="2-2-æ·»åŠ ç”¨æˆ·"><a href="#2-2-æ·»åŠ ç”¨æˆ·" class="headerlink" title="2.2 æ·»åŠ ç”¨æˆ·"></a>2.2 æ·»åŠ ç”¨æˆ·</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205351.png" alt="image_2021-04-23_17-59-01"></p>
<h4 id="2-3-æ·»åŠ è™šæ‹Ÿä¸»æœº"><a href="#2-3-æ·»åŠ è™šæ‹Ÿä¸»æœº" class="headerlink" title="2.3 æ·»åŠ è™šæ‹Ÿä¸»æœº"></a>2.3 æ·»åŠ è™šæ‹Ÿä¸»æœº</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205409.png" alt="image_2021-04-23_18-00-36"></p>
<h4 id="2-4-ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº"><a href="#2-4-ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº" class="headerlink" title="2.4 ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº"></a>2.4 ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205742.png" alt="Snipaste_2021-04-26_20-56-58"></p>
<p>é…ç½®å®Œæˆåï¼Œä½¿ç”¨é…ç½®çš„ç”¨æˆ·å’Œå¯†ç ç™»å½•å³å¯ã€‚</p>
<h3 id="3-é…ç½®æ–‡ä»¶"><a href="#3-é…ç½®æ–‡ä»¶" class="headerlink" title="3. é…ç½®æ–‡ä»¶"></a>3. é…ç½®æ–‡ä»¶</h3><blockquote>
<p>å¦‚æœç®€å•çš„ä½¿ç”¨ï¼Œé…ç½®åˆ°ç”¨æˆ·åã€å¯†ç å³å¯ã€‚</p>
</blockquote>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># rabbitMQä¿¡æ¯é…ç½®</span></span><br><span class="line"><span class="attr">rabbitmq:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">*.*.*.*</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5672</span>    <span class="comment"># é»˜è®¤å¯çœç•¥</span></span><br><span class="line">  <span class="attr">virtual-host:</span> <span class="string">/horse</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">***</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">***</span></span><br><span class="line">  <span class="comment"># å¼€å¯æŠ•é€’æˆåŠŸå›è°ƒ P -&gt; Exchange</span></span><br><span class="line">  <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br><span class="line">  <span class="comment"># å¼€å¯æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—å¤±è´¥å›è°ƒ Exchange -&gt; Queue</span></span><br><span class="line">  <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># å¼€å¯æ‰‹åŠ¨ACKç¡®è®¤æ¨¡å¼ Queue -&gt; C</span></span><br><span class="line">  <span class="attr">listener:</span></span><br><span class="line">    <span class="attr">simple:</span></span><br><span class="line">      <span class="attr">acknowledge-mode:</span> <span class="string">manual</span> <span class="comment"># ä»£è¡¨æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">      <span class="comment"># ä¸€äº›åŸºæœ¬å‚æ•°çš„è®¾ç½®(ä¹Ÿå¯ä»¥ä¸è®¾ç½®,é»˜è®¤å³å¯)</span></span><br><span class="line">      <span class="attr">concurrency:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">max-concurrency:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">prefetch:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">max-attempts:</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>
<p>ä¹‹åï¼Œå°±æ˜¯RabbitMQæ¶ˆæ¯æŠ•é€’ï¼Œå»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨å•¦ã€‚</p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>RabbitMQ</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisçš„zsetæ•°æ®ç»“æ„åœºæ™¯åº”ç”¨ï¼ˆå…³æ³¨&amp;ç²‰ä¸ï¼‰</title>
    <url>/post/1039.html</url>
    <content><![CDATA[<h1 id="Redisçš„zsetæ•°æ®ç»“æ„åœºæ™¯åº”ç”¨"><a href="#Redisçš„zsetæ•°æ®ç»“æ„åœºæ™¯åº”ç”¨" class="headerlink" title="Redisçš„zsetæ•°æ®ç»“æ„åœºæ™¯åº”ç”¨"></a>Redisçš„zsetæ•°æ®ç»“æ„åœºæ™¯åº”ç”¨</h1><blockquote>
<p>åŠŸèƒ½å®ç°ï¼š</p>
<ol>
<li>å®ç°ç”¨æˆ·ç›¸äº’å…³æ³¨</li>
<li>å®ç°ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨</li>
<li>å¯æ‰©å±•å¤šä¸ªç”¨æˆ·ä¹‹é—´çš„å…±åŒå…³æ³¨ï¼Œå…¬å…±ç²‰ä¸ç­‰</li>
</ol>
<p>åŸç†ï¼šå°†æ•°æ®ä»¥<code>zset</code>ç»“æ„å­˜å‚¨åœ¨<code>redis</code>ä¸­ï¼Œæ ¹æ®zsetçš„ç‰¹æ€§è¿›è¡Œç›¸å…³æ“ä½œã€‚</p>
<p><strong>æ³¨æ„ï¼šA å…³æ³¨ Bï¼Œé‚£ä¹ˆè¡¨ç¤ºï¼šBä¼šå‡ºç°åœ¨Açš„å…³æ³¨åˆ—è¡¨ä¸­ï¼ŒAä¼šå‡ºç°åœ¨Bçš„ç²‰ä¸åˆ—è¡¨ä¸­</strong></p>
</blockquote>
<h2 id="1-å…¬å…±ä¿¡æ¯"><a href="#1-å…¬å…±ä¿¡æ¯" class="headerlink" title="1. å…¬å…±ä¿¡æ¯"></a>1. å…¬å…±ä¿¡æ¯</h2><blockquote>
<p>æ¥æ”¶å‚æ•°çš„å®ä½“ç±»<code>FollowVo</code>ï¼Œ<strong>æ³¨æ„æ³¨é‡Šè¯´æ˜å’Œå±æ€§åç§°ï¼Œå®¹æ˜“æ··æ·†</strong>ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 11:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FollowVo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è¢«å…³æ³¨ç”¨æˆ·çš„idä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¢«å…³æ³¨ç”¨æˆ·çš„id")</span></span><br><span class="line">    <span class="keyword">private</span> String followedId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ç²‰ä¸ç”¨æˆ·çš„idä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "å…³æ³¨ä»–äºº,æˆä¸ºç²‰ä¸çš„ç”¨æˆ·çš„id")</span></span><br><span class="line">    <span class="keyword">private</span> String fansId;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>å­˜å‚¨Redisçš„å…¬å…±KEY</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æˆ‘çš„å…³æ³¨ KEY æ¨¡æ¿</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FOLLOW_USER = <span class="string">"follow:%s"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FANS_USER = <span class="string">"fans:%s"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FOLLOW = <span class="string">"FOLLOW"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FANS = <span class="string">"FANS"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String INTERSECTION_DEST_KEY = <span class="string">"intersection:%s"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String UNION_DEST_KEY = <span class="string">"union:%s"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String INTERSECTION = <span class="string">"intersection"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String UNION = <span class="string">"union"</span>;</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>å…³æ³¨æˆ–ç²‰ä¸åˆ—è¡¨å“åº”å®ä¾‹ä¿¡æ¯<code>ResponseFollowVo</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 14:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseFollowVo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>å…³æ³¨æˆ–ç²‰ä¸äº¤å¹¶é›†å“åº”å®ä¾‹ä¿¡æ¯<code>FollowOrFansDto</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FollowOrFansDto</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8409057262225157803L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤é›†æˆ–å¹¶é›†æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤é›†æˆ–å¹¶é›†ç»“æœåˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MyFollowDto&gt; result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="2-å°è£…å¤„ç†ç±»"><a href="#2-å°è£…å¤„ç†ç±»" class="headerlink" title="2. å°è£…å¤„ç†ç±»"></a>2. å°è£…å¤„ç†ç±»</h2><blockquote>
<p>å¯¹åŸºæœ¬çš„ZSetæ–¹æ³•è¿›è¡Œå°è£…ï¼Œç›´æ¥å°±å¯ä»¥åœ¨controllerå±‚è¿›è¡Œè°ƒç”¨</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Redisçš„ZSetæœºæ„è¿›è¡Œ å…³æ³¨/ç²‰ä¸ çš„åŸºæœ¬æ“ä½œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 11:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisFollowHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fansId æˆä¸ºä»–äººç²‰ä¸,åŒæ—¶ä¹Ÿæ˜¯å…³æ³¨è€…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆ‘çš„å…³æ³¨çš„key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFollowUserKey</span><span class="params">(String fansId)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> String.format(BlogConstants.FOLLOW_USER, fansId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> followedId è¢«å…³æ³¨è€…id,åŒæ—¶æ‹¥æœ‰è‡ªå·±çš„ç²‰ä¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆ‘çš„ç²‰ä¸key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFansUserKey</span><span class="params">(String followedId)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> String.format(BlogConstants.FANS_USER, followedId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">currentTime</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³æ³¨: æ˜¯å¦å·²å…³æ³¨,è‡ªå·±ä¸èƒ½å…³æ³¨è‡ªå·±,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> follow</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toFollow</span><span class="params">(FollowVo follow)</span> </span>{</span><br><span class="line">        String fansId = follow.getFansId();</span><br><span class="line">        String followedId = follow.getFollowedId();</span><br><span class="line">        <span class="keyword">double</span> score = currentTime();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±(å‰ç«¯å·²åšæ§åˆ¶,åç«¯å†æ ¡éªŒä¸€æ¬¡)</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.equals(followedId, fansId)) {</span><br><span class="line">            <span class="comment">// æ˜¯å¦å·²å…³æ³¨è¿‡</span></span><br><span class="line">            Double exist = isFollow(fansId, followedId);</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtils.isEmpty(exist)) {</span><br><span class="line">                <span class="comment">// å°†å¯¹æ–¹idæ·»åŠ åˆ°è‡ªå·±çš„å…³æ³¨åˆ—è¡¨ä¸­</span></span><br><span class="line">                redisTemplate.opsForZSet().add(getFollowUserKey(fansId), followedId, score);</span><br><span class="line">                <span class="comment">// å°†è‡ªå·±çš„idæ·»åŠ åˆ°å¯¹æ–¹çš„ç²‰ä¸åˆ—è¡¨ä¸­</span></span><br><span class="line">                redisTemplate.opsForZSet().add(getFansUserKey(followedId), fansId, score);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å…³æ³¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fansId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> followedId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">isFollow</span><span class="params">(String fansId, String followedId)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForZSet().score(getFollowUserKey(fansId), followedId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆå…³æ³¨: æ˜¯å¦å·²å…³æ³¨,è‡ªå·±ä¸èƒ½å…³æ³¨è‡ªå·±</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> follow</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancelFollow</span><span class="params">(FollowVo follow)</span> </span>{</span><br><span class="line">        String fansId = follow.getFansId();</span><br><span class="line">        String followedId = follow.getFollowedId();</span><br><span class="line">        Double exist = isFollow(fansId, followedId);</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isNotEmpty(exist)) {</span><br><span class="line">            <span class="comment">// å°†å¯¹æ–¹idä»è‡ªå·±çš„å…³æ³¨åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class="line">            redisTemplate.opsForZSet().remove(getFollowUserKey(fansId), followedId);</span><br><span class="line">            <span class="comment">// å°†è‡ªå·±çš„idä»å¯¹æ–¹çš„ç²‰ä¸åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class="line">            redisTemplate.opsForZSet().remove(getFansUserKey(followedId), fansId);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æˆ‘çš„å…³æ³¨åˆ—è¡¨æˆ–è€…ç²‰ä¸åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;MyFollowDto&gt; <span class="title">getFollowOrFansRangeWithTimeDesc</span><span class="params">(String userId, String type)</span> </span>{</span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; followList;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(BlogConstants.FOLLOW, type)) {</span><br><span class="line">            followList = redisTemplate.opsForZSet().reverseRangeWithScores(getFollowUserKey(userId), <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            followList = redisTemplate.opsForZSet().reverseRangeWithScores(getFansUserKey(userId), <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> convertZsetList(followList);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æˆ‘çš„å…³æ³¨æ•°æˆ–è€…ç²‰ä¸æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">followCount</span><span class="params">(String userId, String type)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(BlogConstants.FOLLOW, type)) {</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForZSet().zCard(getFollowUserKey(userId));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForZSet().zCard(getFansUserKey(userId));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·çš„å…±åŒå…³æ³¨æˆ–å…±åŒç²‰ä¸(äº¤é›† æˆ–è€… å¹¶é›†)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userIds             ç”¨æˆ·idé›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type                å…³æ³¨æˆ–è€…ç²‰ä¸ç±»å‹ (follow/fans)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intersectionOrUnion äº¤é›†æˆ–è€…å¹¶é›†ç±»å‹ (intersection/union)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FollowOrFansDto <span class="title">commonFollowOrFansCount</span><span class="params">(List&lt;String&gt; userIds, String type, String intersectionOrUnion)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(userIds)) {</span><br><span class="line">            FollowOrFansDto result = <span class="keyword">new</span> FollowOrFansDto();</span><br><span class="line">            <span class="keyword">int</span> defaultIndex = <span class="number">0</span>;</span><br><span class="line">            String firstKey;</span><br><span class="line"></span><br><span class="line">            List&lt;MyFollowDto&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            Long count = <span class="number">0L</span>;</span><br><span class="line">            Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; range;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.equals(BlogConstants.INTERSECTION, intersectionOrUnion)) {</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(BlogConstants.FOLLOW, type)) {</span><br><span class="line">                    log.info(<span class="string">" ==&gt; å¼€å§‹è®¡ç®—ç”¨æˆ·å…³æ³¨äº¤é›†,userIds: {}"</span>, userIds);</span><br><span class="line">                    List&lt;String&gt; followList = <span class="keyword">this</span>.getFullKeyList(type, userIds);</span><br><span class="line">                    firstKey = followList.get(defaultIndex);</span><br><span class="line">                    followList.remove(defaultIndex);</span><br><span class="line">                    String destKey = String.format(BlogConstants.INTERSECTION_DEST_KEY, BlogConstants.FOLLOW);</span><br><span class="line">                    count = redisTemplate.opsForZSet().intersectAndStore(firstKey, followList, destKey);</span><br><span class="line">                    range = redisTemplate.opsForZSet().rangeWithScores(destKey, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    log.info(<span class="string">" ==&gt; å¼€å§‹è®¡ç®—ç”¨æˆ·ç²‰ä¸äº¤é›†,userIds: {}"</span>, userIds);</span><br><span class="line">                    List&lt;String&gt; fansList = <span class="keyword">this</span>.getFullKeyList(type, userIds);</span><br><span class="line">                    firstKey = fansList.get(defaultIndex);</span><br><span class="line">                    fansList.remove(defaultIndex);</span><br><span class="line">                    String destKey = String.format(BlogConstants.INTERSECTION_DEST_KEY, BlogConstants.FANS);</span><br><span class="line">                    count = redisTemplate.opsForZSet().intersectAndStore(firstKey, fansList, destKey);</span><br><span class="line">                    range = redisTemplate.opsForZSet().rangeWithScores(destKey, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">                list = convertZsetList(range);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.equals(BlogConstants.UNION, intersectionOrUnion)) {</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(BlogConstants.FOLLOW, type)) {</span><br><span class="line">                    log.info(<span class="string">" ==&gt; å¼€å§‹è®¡ç®—ç”¨æˆ·å…³æ³¨å¹¶é›†,userIds: {}"</span>, userIds);</span><br><span class="line">                    List&lt;String&gt; followList = <span class="keyword">this</span>.getFullKeyList(type, userIds);</span><br><span class="line">                    firstKey = followList.get(defaultIndex);</span><br><span class="line">                    followList.remove(defaultIndex);</span><br><span class="line">                    String destKey = String.format(BlogConstants.UNION_DEST_KEY, BlogConstants.FOLLOW);</span><br><span class="line">                    count = redisTemplate.opsForZSet().unionAndStore(firstKey, followList, destKey);</span><br><span class="line">                    range = redisTemplate.opsForZSet().rangeWithScores(destKey, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    log.info(<span class="string">" ==&gt; å¼€å§‹è®¡ç®—ç”¨æˆ·ç²‰ä¸å¹¶é›†,userIds: {}"</span>, userIds);</span><br><span class="line">                    List&lt;String&gt; fansList = <span class="keyword">this</span>.getFullKeyList(type, userIds);</span><br><span class="line">                    firstKey = fansList.get(defaultIndex);</span><br><span class="line">                    fansList.remove(defaultIndex);</span><br><span class="line">                    String destKey = String.format(BlogConstants.UNION_DEST_KEY, BlogConstants.FANS);</span><br><span class="line">                    count = redisTemplate.opsForZSet().unionAndStore(firstKey, fansList, destKey);</span><br><span class="line">                    range = redisTemplate.opsForZSet().rangeWithScores(destKey, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">                list = convertZsetList(range);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            result.setCount(count);</span><br><span class="line">            result.setResult(list);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å®Œæ•´keyé›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userIds</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">getFullKeyList</span><span class="params">(String type, List&lt;String&gt; userIds)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(BlogConstants.FOLLOW, type)) {</span><br><span class="line">            <span class="keyword">return</span> userIds.stream().map(<span class="keyword">this</span>::getFollowUserKey).collect(Collectors.toList());</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> userIds.stream().map(<span class="keyword">this</span>::getFansUserKey).collect(Collectors.toList());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¼å¼åŒ–æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> followList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;MyFollowDto&gt; <span class="title">convertZsetList</span><span class="params">(Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; followList)</span> </span>{</span><br><span class="line">        List&lt;MyFollowDto&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(followList)) {</span><br><span class="line">            <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;Object&gt; tuple : followList) {</span><br><span class="line">                MyFollowDto dto = <span class="keyword">new</span> MyFollowDto();</span><br><span class="line">                dto.setFollowedId(String.valueOf(tuple.getValue()));</span><br><span class="line">                Double score = tuple.getScore();</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtils.isNotEmpty(score)) {</span><br><span class="line">                    dto.setFollowDate(DateUtil.date(Convert.toLong(score)));</span><br><span class="line">                }</span><br><span class="line">                list.add(dto);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-å…·ä½“å®ç°"><a href="#3-å…·ä½“å®ç°" class="headerlink" title="3. å…·ä½“å®ç°"></a>3. å…·ä½“å®ç°</h2><h3 id="3-1-controlleræ¥å£"><a href="#3-1-controlleræ¥å£" class="headerlink" title="3.1 controlleræ¥å£"></a>3.1 controlleræ¥å£</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 10:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = {"æˆ‘çš„å…³æ³¨æœåŠ¡"})</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RequestMapping("/api/blog/follow")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiFollowController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisFollowHandler redisFollowHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FollowService followService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.ADD,operDesc = "å‘èµ·å…³æ³¨")</span></span><br><span class="line">    <span class="meta">@PostMapping("/sure")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sureFollow</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> FollowVo follow)</span> </span>{</span><br><span class="line">        redisFollowHandler.toFollow(follow);</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">"å…³æ³¨æˆåŠŸ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.REMOVE,operDesc = "å–æ¶ˆå…³æ³¨")</span></span><br><span class="line">    <span class="meta">@PostMapping("/cancel")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">cancelFollow</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> FollowVo follow)</span> </span>{</span><br><span class="line">        redisFollowHandler.cancelFollow(follow);</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">"å–æ¶ˆå…³æ³¨"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ ¹æ®typeç±»å‹åˆ¤æ–­æŸ¥è¯¢çš„æ˜¯å…³æ³¨åˆ—è¡¨æˆ–è€…ç²‰ä¸åˆ—è¡¨ï¼ˆä»–ä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºkeyä¸ä¸€æ ·ï¼‰</span></span><br><span class="line">    <span class="meta">@GetMapping("/list/{userId}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryFollowOrFansList</span><span class="params">(<span class="meta">@PathVariable("userId")</span> <span class="meta">@NotBlank(message = "ç”¨æˆ·idä¸èƒ½ä¸ºç©º")</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="meta">@RequestParam("type")</span> <span class="meta">@NotBlank(message = "ç±»å‹typeä¸èƒ½ä¸ºç©º")</span> String type)</span> </span>{</span><br><span class="line">        List&lt;ResponseFollowVo&gt; follows = followService.queryFollowOrFansList(userId, type);</span><br><span class="line">        Long count = redisFollowHandler.followCount(userId, type);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"items"</span>, follows).data(<span class="string">"count"</span>, count);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = "å…³æ³¨ç²‰ä¸äº¤å¹¶é›†", notes = "å¤šç”¨æˆ·ä¹‹é—´çš„äº¤é›†æˆ–å¹¶é›†æ•°é‡å’Œå…·ä½“åˆ—è¡¨ä¿¡æ¯")</span></span><br><span class="line">    <span class="meta">@PostMapping("/intersection/or/union")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryInterOrUnion</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> QueryFollowOrFans query)</span> </span>{</span><br><span class="line">        FollowOrFansDto result = redisFollowHandler.commonFollowOrFansCount(query.getUserIds(), query.getType(), query.getIntersectionOrUnion());</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"items"</span>, result);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-2-serviceæœåŠ¡"><a href="#3-2-serviceæœåŠ¡" class="headerlink" title="3.2 serviceæœåŠ¡"></a>3.2 serviceæœåŠ¡</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 14:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FollowServiceImpl</span> <span class="keyword">implements</span> <span class="title">FollowService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisFollowHandler redisFollowHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserPortalMapper userPortalMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®typeç±»å‹æŸ¥è¯¢å…³æ³¨åˆ—è¡¨æˆ–ç²‰ä¸åˆ—è¡¨(ç»„è£…ç²‰ä¸çš„åç§°å’Œå¤´åƒç­‰ä¿¡æ¯)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ResponseFollowVo&gt; <span class="title">queryFollowOrFansList</span><span class="params">(String userId, String type)</span> </span>{</span><br><span class="line">        List&lt;MyFollowDto&gt; temp = redisFollowHandler.getFollowOrFansRangeWithTimeDesc(userId, type);</span><br><span class="line">        List&lt;String&gt; userIds = temp.stream().map(MyFollowDto::getFollowedId).collect(Collectors.toList());</span><br><span class="line">        List&lt;ResponseFollowVo&gt; users = userPortalMapper.queryFollowOrFansList(userIds);</span><br><span class="line">        <span class="keyword">for</span> (ResponseFollowVo user : users) {</span><br><span class="line">            <span class="keyword">for</span> (MyFollowDto dto : temp) {</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(dto.getFollowedId(), user.getId())) {</span><br><span class="line">                    user.setDate(dto.getFollowDate());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="4-æµ‹è¯•ç»“æœ"><a href="#4-æµ‹è¯•ç»“æœ" class="headerlink" title="4. æµ‹è¯•ç»“æœ"></a>4. æµ‹è¯•ç»“æœ</h2><blockquote>
<p>åŸºæœ¬å®ç°äº†<code>ç›¸äº’å…³æ³¨</code>çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰è¿›è¡ŒDBæ•°æ®æŒä¹…åŒ–ï¼Œè¿™ä¸ªéœ€è¦è¿›è¡Œè€ƒè™‘è€ƒè™‘ã€‚ã€‚ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ResponseBodyAdviceæ¥å£æ‹¦æˆªå¤„ç†å“åº”ç»“æœ</title>
    <url>/post/12739.html</url>
    <content><![CDATA[<h2 id="ResponseBodyAdviceæ¥å£å¤„ç†å“åº”ç»“æœ"><a href="#ResponseBodyAdviceæ¥å£å¤„ç†å“åº”ç»“æœ" class="headerlink" title="ResponseBodyAdviceæ¥å£å¤„ç†å“åº”ç»“æœ"></a>ResponseBodyAdviceæ¥å£å¤„ç†å“åº”ç»“æœ</h2><blockquote>
<p>ResponseBodyAdviceæ¥å£æ˜¯åœ¨Controlleræ‰§è¡Œreturnä¹‹åï¼Œåœ¨responseè¿”å›ç»™æµè§ˆå™¨æˆ–è€…APPå®¢æˆ·ç«¯ä¹‹å‰ï¼Œæ‰§è¡Œçš„å¯¹responseçš„ä¸€äº›å¤„ç†ã€‚å¯ä»¥å®ç°å¯¹responseæ•°æ®çš„ä¸€äº›ç»Ÿä¸€å°è£…æˆ–è€…åŠ å¯†ç­‰æ“ä½œã€‚</p>
<p>ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•ï¼š <strong>@ControllerAdviceæ³¨è§£å’ŒResponseBodyAdviceæ¥å£ç»“åˆä½¿ç”¨</strong></p>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/18 12:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseResultHandler</span> <span class="keyword">implements</span> <span class="title">ResponseBodyAdvice</span>&lt;<span class="title">Object</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­è¯·æ±‚æ˜¯å¦åŒ…å«æ ‡è®°,æ²¡æœ‰æ ‡è®°å°±è¿”å›false,ä¸éœ€è¦è¿›è¡ŒåŒ…è£…,å¦åˆ™è¿”å›true,ç»§ç»­æ‰§è¡ŒbeforeBodyWriteæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converterType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> </span>{</span><br><span class="line">        ServletRequestAttributes requestAttributes =</span><br><span class="line">                (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = requestAttributes.getRequest();</span><br><span class="line">        ResponseResult result = (ResponseResult) request.getAttribute(BlogConstants.RESPONSE_PACK_FLAG);</span><br><span class="line">        <span class="keyword">return</span> result != <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒ…è£…è¿”å›ç»“æœçš„å¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body æ¥å£æ–¹æ³•è¿”å›å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selectedContentType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selectedConverterType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">beforeBodyWrite</span><span class="params">(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;?</span></span></span><br><span class="line"><span class="function"><span class="params">            extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  ServerHttpResponse response)</span> </span>{</span><br><span class="line">        log.info(<span class="string">" ==&gt; å“åº”ç»“æœé‡å†™å¤„ç†ä¸­ &lt;=="</span>);</span><br><span class="line">        <span class="comment">// åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ä¸­å·²ç»å°è£…è¿‡,è¿™é‡Œè¿”å›å€¼å±äºRç±»,ç›´æ¥è¿”å›å³å¯</span></span><br><span class="line">        <span class="keyword">if</span> (body <span class="keyword">instanceof</span> R) {</span><br><span class="line">            <span class="keyword">return</span> body;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"item"</span>, body);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>RestTemplateé…ç½®æ­£å‘ä»£ç†</title>
    <url>/post/18060.html</url>
    <content><![CDATA[<h2 id="RestTemplateé…ç½®æ­£å‘ä»£ç†"><a href="#RestTemplateé…ç½®æ­£å‘ä»£ç†" class="headerlink" title="RestTemplateé…ç½®æ­£å‘ä»£ç†"></a>RestTemplateé…ç½®æ­£å‘ä»£ç†</h2><blockquote>
<p><strong>æ­£å‘ä»£ç†åŸç†</strong>ï¼š</p>
<p>å½“å‰æœåŠ¡ç›´æ¥è®¿é—®å¦ä¸€ä¸ªæœåŠ¡,å¦‚æœå‡ºç°è®¿é—®é€Ÿåº¦è¿‡æ…¢,æ— æ³•è®¿é—®ç­‰æƒ…å†µ,è¿™æ—¶,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£å‘ä»£ç†çš„æ–¹å¼ã€‚å°†å½“å‰è¯·æ±‚å‘é€åˆ°ä»£ç†æœåŠ¡å™¨,ä»£ç†æœåŠ¡å™¨å†å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·è¯·æ±‚,è·å–å“åº”æ•°æ®,è¿”å›ç»™æˆ‘ä»¬ã€‚</p>
<p>é€šä¿—çš„è®²,ä¹Ÿå°±æ˜¯å½“å‰æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ä¸€èµ·è’™éª—ç›®æ ‡æœåŠ¡å™¨,è¿™æ—¶,å½“å‰æœåŠ¡å™¨æ˜¯éšè”½çš„,ä¸å¯è§çš„,å’Œåå‘ä»£ç†åˆšå¥½ç›¸åã€‚</p>
</blockquote>
<ul>
<li>é…ç½®ä¿¡æ¯</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "proxy")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyConfig</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;* æ˜¯å¦å¯ç”¨ä»£ç†</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;* ä»£ç†ä¸»æœºåœ°å€</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;* ä»£ç†ç«¯å£ &nbsp; &nbsp;</span></span><br><span class="line"><span class="comment">     * &nbsp; &nbsp; &nbsp;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å…·ä½“é…ç½®</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanInitConfig</span> </span>{</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProxyConfig proxyConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>{</span><br><span class="line">        SimpleClientHttpRequestFactory requestFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span><br><span class="line">        </span><br><span class="line">        requestFactory.setConnectTimeout(<span class="number">10</span> * <span class="number">1000</span>);</span><br><span class="line">        requestFactory.setReadTimeout(<span class="number">10</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (proxyConfig.getEnabled()) {</span><br><span class="line">            SocketAddress address = <span class="keyword">new</span> InetSocketAddress(proxyConfig.getHost(), proxyConfig.getPort());</span><br><span class="line">            Proxy proxy = <span class="keyword">new</span> Proxy(Proxy.Type.HTTP, address);</span><br><span class="line">            requestFactory.setProxy(proxy);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate(requestFactory);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
        <tag>RestTemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootä¸­ä½¿ç”¨DelayQueueå»¶æ—¶é˜Ÿåˆ—</title>
    <url>/post/25530.html</url>
    <content><![CDATA[<h1 id="SpringBootä¸­ä½¿ç”¨DelayQueueå»¶æ—¶é˜Ÿåˆ—"><a href="#SpringBootä¸­ä½¿ç”¨DelayQueueå»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="SpringBootä¸­ä½¿ç”¨DelayQueueå»¶æ—¶é˜Ÿåˆ—"></a>SpringBootä¸­ä½¿ç”¨DelayQueueå»¶æ—¶é˜Ÿåˆ—</h1><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><blockquote>
<p>DelayQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰è¾¹ç•ŒBlockingQueueå®ç°ï¼ŒåŠ å…¥å…¶ä¸­çš„å…ƒç´ å¿…éœ€å®ç°Delayedæ¥å£ã€‚å½“ç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨putä¹‹ç±»çš„æ–¹æ³•åŠ å…¥å…ƒç´ æ—¶ï¼Œä¼šè§¦å‘Delayedæ¥å£ä¸­çš„compareToæ–¹æ³•è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ—ä¸­å…ƒç´ çš„é¡ºåºæ˜¯æŒ‰åˆ°æœŸæ—¶é—´æ’åºçš„ï¼Œè€Œéå®ƒä»¬è¿›å…¥é˜Ÿåˆ—çš„é¡ºåºã€‚æ’åœ¨é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ æ˜¯æœ€æ—©åˆ°æœŸçš„ï¼Œè¶Šå¾€ååˆ°æœŸæ—¶é—´èµ¿æ™šã€‚</p>
<p>æ¶ˆè´¹è€…çº¿ç¨‹æŸ¥çœ‹é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ï¼Œæ³¨æ„æ˜¯æŸ¥çœ‹ä¸æ˜¯å–å‡ºã€‚ç„¶åè°ƒç”¨å…ƒç´ çš„getDelayæ–¹æ³•ï¼Œå¦‚æœæ­¤æ–¹æ³•è¿”å›çš„å€¼å°0æˆ–è€…ç­‰äº0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºæ­¤å…ƒç´ ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœgetDelayæ–¹æ³•è¿”å›çš„å€¼å¤§äº0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹waitè¿”å›çš„æ—¶é—´å€¼åï¼Œå†ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºå…ƒç´ ï¼Œæ­¤æ—¶å…ƒç´ åº”è¯¥å·²ç»åˆ°æœŸã€‚</p>
</blockquote>
<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><blockquote>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å› ä¸ºæ­¤å»¶æ—¶é˜Ÿåˆ—å­˜åœ¨äºå†…å­˜ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œæ‰€æœ‰çš„å»¶æ—¶ä»»åŠ¡å°†è¢«ä¸¢å¼ƒã€‚</li>
</ul>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>åˆ›å»º<code>delayQueue</code>é˜Ÿåˆ—æ•°æ®åº“ï¼Œå›ºåŒ–æ•°æ®ã€‚</li>
<li>å½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œæ£€æŸ¥åº“ä¸­æ‰€æœ‰å»¶æ—¶ä»»åŠ¡ï¼Œæœªå¤±æ•ˆçš„é‡æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œå¤±æ•ˆçš„ç«‹å³æ‰§è¡Œï¼ˆæˆ–è€…ç›´æ¥ä¸¢å¼ƒï¼Œè§†ä¸šåŠ¡é€»è¾‘è€Œå®šï¼‰ã€‚</li>
</ul>
</blockquote>
<h2 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h2><blockquote>
<p>åº”ç”¨æ­¥éª¤ï¼š</p>
<ol>
<li>å®ç° <code>Delayed</code> æ¥å£ï¼Œåˆ›å»ºå»¶æ—¶ä»»åŠ¡å®ä¾‹</li>
<li>åˆ›å»ºå»¶æ—¶ä»»åŠ¡ç®¡ç†å®ä¾‹ï¼Œå¹¶å®ç° <code>CommandLineRunner</code> æ¥å£ï¼Œé¡¹ç›®å¯åŠ¨æ—¶åŠ è½½å»¶æ—¶ä»»åŠ¡</li>
<li>åˆ›å»ºå»¶æ—¶é˜Ÿåˆ—æ•°æ®åº“ï¼šå°è£…å»¶æ—¶ä»»åŠ¡çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ–¹æ³•</li>
</ol>
</blockquote>
<h3 id="å»¶æ—¶ä»»åŠ¡å®ä¾‹"><a href="#å»¶æ—¶ä»»åŠ¡å®ä¾‹" class="headerlink" title="å»¶æ—¶ä»»åŠ¡å®ä¾‹"></a>å»¶æ—¶ä»»åŠ¡å®ä¾‹</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å»¶æ—¶ä»»åŠ¡æ„å»ºå®ä¾‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/8/4 8:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayTask</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†…å®¹id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> String contentId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»»åŠ¡å»¶æ—¶æ—¶é—´,å•ä½: s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> Long expire;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»»åŠ¡ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> String taskType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºå»¶æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expire    ä»»åŠ¡å»¶æ—¶æˆªæ­¢æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskType</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelayTask</span><span class="params">(String contentId, Long expire, String taskType)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.contentId = contentId;</span><br><span class="line">        <span class="keyword">this</span>.expire = expire * <span class="number">1000</span> + System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">this</span>.taskType = taskType;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å»¶è¿Ÿæ—¶é—´: è¿‡æœŸæ—¶é—´ - å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="keyword">this</span>.expire - System.currentTimeMillis(), unit);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»¶è¿Ÿé˜Ÿåˆ—å†…éƒ¨æ¯”è¾ƒæ’åº: å½“å‰çš„å»¶è¿Ÿæ—¶é—´ - æ¯”è¾ƒå¯¹è±¡çš„å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Convert.toInt(<span class="keyword">this</span>.getDelay(TimeUnit.NANOSECONDS) - o.getDelay(TimeUnit.NANOSECONDS));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringBuilder().append(<span class="string">"[data: "</span>)</span><br><span class="line">                .append(contentId)</span><br><span class="line">                .append(<span class="string">", expire: "</span>)</span><br><span class="line">                .append(DateUtil.format(<span class="keyword">new</span> Date(expire), DatePattern.NORM_DATETIME_PATTERN))</span><br><span class="line">                .append(<span class="string">", taskType: "</span>)</span><br><span class="line">                .append(taskType)</span><br><span class="line">                .append(<span class="string">"]"</span>)</span><br><span class="line">                .toString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> DelayTask) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.contentId.equals(((DelayTask) obj).getContentId());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å»¶æ—¶ç®¡ç†å®ä¾‹"><a href="#å»¶æ—¶ç®¡ç†å®ä¾‹" class="headerlink" title="å»¶æ—¶ç®¡ç†å®ä¾‹"></a>å»¶æ—¶ç®¡ç†å®ä¾‹</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å»¶æ—¶ä»»åŠ¡ç®¡ç†å®ä¾‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/8/4 9:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(4)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "delay.queue", name = "enable", havingValue = "true")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayQueueManager</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DelayQueue&lt;DelayTask&gt; delayQueue = <span class="keyword">new</span> DelayQueue&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DelayTaskLogService delayTaskLogService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlogService blogService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(DelayTask task)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"åŠ å…¥å»¶æ—¶ä»»åŠ¡: {}"</span>, task);</span><br><span class="line">        delayQueue.offer(task);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(DelayTask task)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"å–æ¶ˆå»¶æ—¶ä»»åŠ¡: {}"</span>, task);</span><br><span class="line">        <span class="keyword">return</span> delayQueue.remove(task);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(String contentId)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"å–æ¶ˆå»¶æ—¶ä»»åŠ¡: {}"</span>, contentId);</span><br><span class="line">        <span class="keyword">return</span> delayQueue.remove(<span class="keyword">new</span> DelayTask(contentId, <span class="number">0L</span>, <span class="keyword">null</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»¶æ—¶ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeThread</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                DelayTask task = delayQueue.take();</span><br><span class="line">                log.info(<span class="string">"å¼€å§‹æ‰§è¡Œå»¶æ—¶ä»»åŠ¡: {}"</span>, task);</span><br><span class="line">                <span class="comment">// å¼‚æ­¥æ‰§è¡Œå»¶æ—¶ä»»åŠ¡</span></span><br><span class="line">                ThreadUtils.executor.execute(() -&gt; {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        processTask(task.getContentId(), task.getTaskType());</span><br><span class="line">                    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                        log.error(<span class="string">"#######ã€æ‰§è¡Œå»¶æ—¶ä»»åŠ¡å¼‚å¸¸æç¤ºã€‘#######æç¤ºå†…å®¹=&gt;{} #######"</span>, e.getMessage());</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å»¶æ—¶ä»»åŠ¡: åç»­æ·»åŠ å»¶æ—¶ä»»åŠ¡,åªéœ€è¦åœ¨è¿™é‡Œæ·»åŠ æ ‡è¯†å’Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskType</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processTask</span><span class="params">(String contentId, String taskType)</span> </span>{</span><br><span class="line">        <span class="keyword">switch</span> (taskType) {</span><br><span class="line">            <span class="keyword">case</span> BlogConstants.DELAY_TASK_TYPE.BLOG_DELAY_TIME:</span><br><span class="line">                <span class="comment">// åœ¨è¿™é‡Œè°ƒç”¨ç›¸åº”çš„å»¶æ—¶ä»»åŠ¡å¤„ç†é€»è¾‘æ–¹æ³• </span></span><br><span class="line">                </span><br><span class="line">                log.info(<span class="string">"####### å»¶æ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ #######"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> BlogConstants.DELAY_TASK_TYPE.POST_DELAY_TIME:</span><br><span class="line">                log.info(<span class="string">"####### å»¶æ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ #######"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                log.info(<span class="string">"æœªåŒ¹é…åˆ°å»¶æ—¶ä»»åŠ¡ç±»å‹: {}"</span>, taskType);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        log.info(<span class="string">"åˆå§‹åŒ–å»¶æ—¶é˜Ÿåˆ—å¼€å§‹..."</span>);</span><br><span class="line"></span><br><span class="line">        AtomicInteger delayOkCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">        AtomicInteger delayVoidCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢æ•°æ®åº“ä¸­çš„å»¶æ—¶ä»»åŠ¡ä¿¡æ¯</span></span><br><span class="line">        List&lt;DelayTaskLog&gt; delayList = delayTaskLogService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;DelayTaskLog&gt;().eq(DelayTaskLog::getExecStatus, Boolean.FALSE));</span><br><span class="line">        <span class="keyword">if</span> (PublicUtil.isNotEmpty(delayList)) {</span><br><span class="line">            delayList.forEach(delay -&gt; {</span><br><span class="line">                <span class="comment">// è®¡ç®—å»¶æ—¶é˜Ÿåˆ—æ˜¯å¦å¤±æ•ˆ</span></span><br><span class="line">                <span class="keyword">long</span> diffTime = DateUtil.between(<span class="keyword">new</span> Date(), delay.getEndTime(), DateUnit.SECOND, <span class="keyword">false</span>);</span><br><span class="line">                <span class="keyword">if</span> (diffTime &gt; <span class="number">0</span>) {</span><br><span class="line">                    <span class="comment">// å»¶æ—¶é˜Ÿåˆ—å»¶ç»­</span></span><br><span class="line">                    <span class="keyword">this</span>.put(<span class="keyword">new</span> DelayTask(delay.getContentId(), diffTime, delay.getTaskType()));</span><br><span class="line">                    delayOkCount.getAndIncrement();</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="comment">// å»¶æ—¶é˜Ÿåˆ—å¤±æ•ˆ(ä»»åŠ¡å¤±æ•ˆ,å°±ç«‹å³æ‰§è¡Œ)</span></span><br><span class="line">                    <span class="keyword">this</span>.processTask(delay.getContentId(), delay.getTaskType());</span><br><span class="line">                    delayVoidCount.getAndIncrement();</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">        log.info(<span class="string">"#######ã€åˆå§‹åŒ–å»¶æ—¶é˜Ÿåˆ—å®Œæˆã€‘#######å»¶ç»­é˜Ÿåˆ—æ•°=&gt;{},#######å¤±æ•ˆé˜Ÿåˆ—æ•°=&gt;{} #######"</span>, delayOkCount, delayVoidCount);</span><br><span class="line">        <span class="comment">// å¼€å¯å»¶æ—¶ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">        ThreadUtils.executor.execute(<span class="keyword">this</span>::executeThread);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å»¶æ—¶é˜Ÿåˆ—å°è£…"><a href="#å»¶æ—¶é˜Ÿåˆ—å°è£…" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—å°è£…"></a>å»¶æ—¶é˜Ÿåˆ—å°è£…</h3><h4 id="SQLè„šæœ¬"><a href="#SQLè„šæœ¬" class="headerlink" title="SQLè„šæœ¬"></a>SQLè„šæœ¬</h4><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- auto-generated definition</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_delay_task_log</span><br><span class="line">(</span><br><span class="line">    id           <span class="type">CHAR</span>(<span class="number">19</span>)                     <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">        <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    content_id   <span class="type">CHAR</span>(<span class="number">19</span>)                     <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'å»¶æ—¶é¡¹idï¼šæ–‡ç« /å¸–å­/ç”¨æˆ·...'</span>,</span><br><span class="line">    task_type    <span class="type">VARCHAR</span>(<span class="number">50</span>)                  <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'ä»»åŠ¡ç±»å‹ï¼šå’Œç³»ç»Ÿé…ç½®è¡¨ä¿¡æ¯å¯¹åº”'</span>,</span><br><span class="line">    start_time   DATETIME                     <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'å¼€å§‹æ—¶é—´'</span>,</span><br><span class="line">    end_time     DATETIME                     <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'ç»“æŸæ—¶é—´'</span>,</span><br><span class="line">    duration     <span class="type">BIGINT</span> UNSIGNED              <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'æ—¶é•¿,é»˜è®¤å•ä½ï¼šs'</span>,</span><br><span class="line">    exec_status  BIT             <span class="keyword">DEFAULT</span> b<span class="string">'0'</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼Œ0-æœªæ‰§è¡Œï¼Œ1-å·²å®Œæˆ'</span>,</span><br><span class="line">    gmt_create   DATETIME                     <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    gmt_modified DATETIME                     <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    version      <span class="type">BIGINT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    is_deleted   BIT             <span class="keyword">DEFAULT</span> b<span class="string">'1'</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">)</span><br><span class="line">    COMMENT <span class="string">'å»¶æ—¶ä»»åŠ¡æ—¥å¿—'</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å»¶æ—¶æ–¹æ³•å°è£…"><a href="#å»¶æ—¶æ–¹æ³•å°è£…" class="headerlink" title="å»¶æ—¶æ–¹æ³•å°è£…"></a>å»¶æ—¶æ–¹æ³•å°è£…</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/8/4 10:44</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "delay.queue", name = "enable", havingValue = "true")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayTaskServiceImpl</span> <span class="keyword">implements</span> <span class="title">DelayTaskService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConfigInfoServiceImpl configInfoService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DelayQueueManager delayQueueManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AsyncProvider asyncProvider;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å»¶æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskType</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addQueue</span><span class="params">(String contentId, String taskType)</span> </span>{</span><br><span class="line">        <span class="comment">// æ ¡éªŒå‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (PublicUtil.isEmpty(contentId) || PublicUtil.isEmpty(taskType)) {</span><br><span class="line">            log.warn(<span class="string">"#######ã€æ–°å¢å»¶æ—¶ä»»åŠ¡å¤±è´¥ã€‘#######"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ç»„è£…å‚æ•°,æ·»åŠ ä»»åŠ¡</span></span><br><span class="line">        Long expire = Convert.toLong(configInfoService.queryConfValueByKey(taskType));</span><br><span class="line">        <span class="keyword">if</span> (expire != <span class="number">0</span>) {</span><br><span class="line">            delayQueueManager.put(<span class="keyword">new</span> DelayTask(contentId, expire, taskType));</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            log.warn(<span class="string">"#######ã€æ–°å¢å»¶æ—¶ä»»åŠ¡å¤±è´¥ã€‘#######"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¼‚æ­¥æ·»åŠ å»¶æ—¶ä»»åŠ¡æ—¥å¿—</span></span><br><span class="line">        asyncProvider.asyncAddDelayLog(contentId, taskType, expire);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­å»¶æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeQueue</span><span class="params">(String contentId)</span> </span>{</span><br><span class="line">        <span class="comment">// æ ¡éªŒå‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (PublicUtil.isEmpty(contentId)) {</span><br><span class="line">            log.info(<span class="string">"#######ã€å»¶æ—¶ä»»åŠ¡å…³é—­å¼‚å¸¸,å†…å®¹ä¸ºç©º: contentId: {}ã€‘#######"</span>, contentId);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ç§»é™¤å»¶æ—¶ä»»åŠ¡</span></span><br><span class="line">        delayQueueManager.remove(contentId);</span><br><span class="line">        <span class="comment">// æ›´æ–°å»¶æ—¶ä»»åŠ¡çŠ¶æ€</span></span><br><span class="line">        asyncProvider.asyncUpdateDelayTaskStatus(contentId);</span><br><span class="line">        log.info(<span class="string">"#######ã€å»¶æ—¶ä»»åŠ¡å…³é—­æˆåŠŸã€‘#######"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¼‚æ­¥æ—¥å¿—æ–¹æ³•"><a href="#å¼‚æ­¥æ—¥å¿—æ–¹æ³•" class="headerlink" title="å¼‚æ­¥æ—¥å¿—æ–¹æ³•"></a>å¼‚æ­¥æ—¥å¿—æ–¹æ³•</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å»¶æ—¶ä»»åŠ¡æ—¥å¿—è®°å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expire</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Async("customAsync")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncAddDelayLog</span><span class="params">(String contentId, String taskType, Long expire)</span> </span>{</span><br><span class="line">        Date startTime = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="comment">// æ¯«ç§’çº§åˆ«çš„æ—¶é—´æˆ³è½¬æ¢</span></span><br><span class="line">        Date endTime = DateUtil.date(startTime.getTime() + expire * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        DelayTaskLog taskLog = <span class="keyword">new</span> DelayTaskLog();</span><br><span class="line">        taskLog.setContentId(contentId)</span><br><span class="line">                .setTaskType(taskType)</span><br><span class="line">                .setStartTime(startTime)</span><br><span class="line">                .setEndTime(endTime)</span><br><span class="line">                .setDuration(expire)</span><br><span class="line">                .setExecStatus(Boolean.FALSE);</span><br><span class="line">        delayTaskLogMapper.insert(taskLog);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°å»¶æ—¶ä»»åŠ¡çŠ¶æ€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Async("customAsync")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncUpdateDelayTaskStatus</span><span class="params">(String contentId)</span> </span>{</span><br><span class="line">        DelayTaskLog taskLog = Optional.ofNullable(delayTaskLogMapper.selectOne(<span class="keyword">new</span> LambdaQueryWrapper&lt;DelayTaskLog&gt;()</span><br><span class="line">                .eq(PublicUtil.isNotEmpty(contentId), DelayTaskLog::getContentId, contentId)</span><br><span class="line">                .eq(DelayTaskLog::getExecStatus, Boolean.FALSE)))</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> BlogException(ResultCodeEnum.DATA_NOT_EXIST));</span><br><span class="line">        delayTaskLogMapper.updateById(taskLog.setExecStatus(Boolean.TRUE));</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="åŠ¨æ€é…ç½®"><a href="#åŠ¨æ€é…ç½®" class="headerlink" title="åŠ¨æ€é…ç½®"></a>åŠ¨æ€é…ç½®</h2><h3 id="å¼€å…³é…ç½®"><a href="#å¼€å…³é…ç½®" class="headerlink" title="å¼€å…³é…ç½®"></a>å¼€å…³é…ç½®</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°å»¶æ—¶é˜Ÿåˆ—å¼€å…³</span></span><br><span class="line"><span class="attr">delay:</span></span><br><span class="line">  <span class="attr">queue:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># é»˜è®¤falseï¼šå…³é—­çŠ¶æ€</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å»¶æ—¶ä¿¡æ¯é…ç½®"><a href="#å»¶æ—¶ä¿¡æ¯é…ç½®" class="headerlink" title="å»¶æ—¶ä¿¡æ¯é…ç½®"></a>å»¶æ—¶ä¿¡æ¯é…ç½®</h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210912150505.png" alt="å»¶æ—¶ä¿¡æ¯é…ç½®"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>DelayQueue</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootä¸­ä½¿ç”¨LocalDateTimeå‚æ•°ä½œä¸ºå…¥å‚è§£æå¼‚å¸¸é—®é¢˜</title>
    <url>/post/24411.html</url>
    <content><![CDATA[<h2 id="SpringBootä¸­ä½¿ç”¨LocalDateTimeå‚æ•°ä½œä¸ºå…¥å‚è§£æå¼‚å¸¸é—®é¢˜"><a href="#SpringBootä¸­ä½¿ç”¨LocalDateTimeå‚æ•°ä½œä¸ºå…¥å‚è§£æå¼‚å¸¸é—®é¢˜" class="headerlink" title="SpringBootä¸­ä½¿ç”¨LocalDateTimeå‚æ•°ä½œä¸ºå…¥å‚è§£æå¼‚å¸¸é—®é¢˜"></a>SpringBootä¸­ä½¿ç”¨LocalDateTimeå‚æ•°ä½œä¸ºå…¥å‚è§£æå¼‚å¸¸é—®é¢˜</h2><blockquote>
<p>æŠ›å‡ºé—®é¢˜ï¼š</p>
<ul>
<li>å½“LocalDateTimeä½œä¸ºRequestParamæˆ–è€…PathVariableçš„å…¥å‚æ—¶çš„æ¥æ”¶è½¬åŒ–å¼‚å¸¸é—®é¢˜</li>
<li>å½“LocalDateTimeä½œä¸ºRequestBodyçš„jsonå½¢å¼æ•°æ®çš„å…¥å‚æ—¶çš„åºåˆ—åŒ–å¼‚å¸¸é—®é¢˜</li>
</ul>
<p>è§£å†³æ–¹æ³•:</p>
<ul>
<li>é…ç½®Converterè½¬æ¢å™¨(è§£å†³é—®é¢˜1)</li>
<li>é…ç½®Jacksonå·¥å…·çš„åºåˆ—åŒ–(è§£å†³é—®é¢˜2)</li>
</ul>
</blockquote>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><blockquote>
<p>åœ¨é¡¹ç›®ä¸­æ·»åŠ æ­¤æ–‡ä»¶,å¯ä»¥è§£å†³LocalDateTimeå‚æ•°çš„æ¥æ”¶å’Œå“åº”å¼‚å¸¸çš„é—®é¢˜</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonParser;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/7/9 9:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(DateConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ—¥æœŸæ—¶é—´æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DATE_TIME_FORMAT = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DATE_FORMAT = <span class="string">"yyyy-MM-dd"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ—¶é—´æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_TIME_FORMAT = <span class="string">"HH:mm:ss"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*=================================è½¬æ¢@RequestParamå’ŒPathVariableæ—¶é—´ç±»å‹å‚æ•°================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = "localDateConverter")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Converter&lt;String, LocalDate&gt; <span class="title">localDateConverter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Converter&lt;String, LocalDate&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> LocalDate <span class="title">convert</span><span class="params">(String source)</span> </span>{</span><br><span class="line">                <span class="keyword">return</span> LocalDate.parse(source, DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = "localDateTimeConverter")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Converter&lt;String, LocalDateTime&gt; <span class="title">localDateTimeConverter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Converter&lt;String, LocalDateTime&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> LocalDateTime <span class="title">convert</span><span class="params">(String source)</span> </span>{</span><br><span class="line">                <span class="keyword">switch</span> (source.length()) {</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                        source += <span class="string">"00:00:00"</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">                        source += <span class="string">":00:00"</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">                        source += <span class="string">":00"</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> LocalDateTime.parse(source, DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = "localTimeConverter")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Converter&lt;String, LocalTime&gt; <span class="title">localTimeConverter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Converter&lt;String, LocalTime&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> LocalTime <span class="title">convert</span><span class="params">(String source)</span> </span>{</span><br><span class="line">                <span class="keyword">return</span> LocalTime.parse(source, DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = "dateConverter")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Converter&lt;String, Date&gt; <span class="title">dateConverter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Converter&lt;String, Date&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String source)</span> </span>{</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(DEFAULT_DATE_TIME_FORMAT).parse(source);</span><br><span class="line">                } <span class="keyword">catch</span> (ParseException e) {</span><br><span class="line">                    log.error(<span class="string">"Dateè½¬æ¢å™¨å¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*=================================è½¬æ¢@RequestBodyæ—¶é—´ç±»å‹å‚æ•°================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectMapper <span class="title">objectMapper</span><span class="params">()</span> </span>{</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">// ç¦ç”¨å±æ€§</span></span><br><span class="line">        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line">        objectMapper.disable(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®æœªçŸ¥å±æ€§è§£æä¸æŠ¥é”™</span></span><br><span class="line">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®è½¬Jsonæ ¼å¼æ—¶å°†Dateè½¬æ¢æˆæŒ‡å®šæ ¼å¼</span></span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(DEFAULT_DATE_TIME_FORMAT));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//LocalDateTimeç³»åˆ—åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¨¡å—ï¼Œç»§æ‰¿è‡ªjsr310ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¿®æ”¹äº†æ—¥æœŸæ ¼å¼</span></span><br><span class="line">        JavaTimeModule javaTimeModule = <span class="keyword">new</span> JavaTimeModule();</span><br><span class="line">        javaTimeModule.addSerializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addSerializer(LocalDate.class, <span class="keyword">new</span> LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)));</span><br><span class="line">        javaTimeModule.addSerializer(LocalTime.class, <span class="keyword">new</span> LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDate.class, <span class="keyword">new</span> LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalTime.class, <span class="keyword">new</span> LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Dateåºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></span><br><span class="line">        javaTimeModule.addSerializer(Date.class, <span class="keyword">new</span> JsonSerializer&lt;Date&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Date date, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">                jsonGenerator.writeString(<span class="keyword">new</span> SimpleDateFormat(DEFAULT_DATE_TIME_FORMAT).format(date));</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        javaTimeModule.addDeserializer(Date.class, <span class="keyword">new</span> JsonDeserializer&lt;Date&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Date <span class="title">deserialize</span><span class="params">(JsonParser jsonParser, DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(DEFAULT_DATE_TIME_FORMAT).parse(jsonParser.getText());</span><br><span class="line">                } <span class="keyword">catch</span> (ParseException e) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        objectMapper.registerModule(javaTimeModule);</span><br><span class="line">        <span class="keyword">return</span> objectMapper;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>LocalDateTime</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootäº‹ä»¶ç›‘å¬ç®€æ</title>
    <url>/post/12773.html</url>
    <content><![CDATA[<h2 id="SpringBootäº‹ä»¶ç›‘å¬"><a href="#SpringBootäº‹ä»¶ç›‘å¬" class="headerlink" title="SpringBootäº‹ä»¶ç›‘å¬"></a>SpringBootäº‹ä»¶ç›‘å¬</h2><h3 id="1-springå†…ç½®äº‹ä»¶"><a href="#1-springå†…ç½®äº‹ä»¶" class="headerlink" title="1. springå†…ç½®äº‹ä»¶"></a>1. springå†…ç½®äº‹ä»¶</h3><p>äº‹ä»¶æ˜¯springä¸­éå¸¸é‡è¦çš„ä¸€ç§å¼‚æ­¥é€šçŸ¥æœºåˆ¶ï¼Œåœ¨springæ¡†æ¶ä¸­å°±å†…ç½®äº†å®¹å™¨äº‹ä»¶ï¼Œå¦‚ContextStartedEventï¼ˆå¯åŠ¨ï¼‰ ã€ContextStoppedEventï¼ˆåœæ­¢ï¼‰ã€<code>ContextRefreshedEvent</code>ï¼ˆåˆ·æ–°ï¼‰ã€ContextClosedEventï¼ˆå…³é—­ï¼‰ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿è‡ªApplicationEventå¯¹è±¡ï¼Œæˆ‘ä»¬ç¼–å†™çš„äº‹ä»¶ç›‘å¬å™¨ç±»æ—¶éœ€è¦å®ç°ApplicationListener æ¥å£ï¼Œç„¶åé‡å†™onApplicationEvent(event)æ–¹æ³•å³å¯ã€‚</p>
<blockquote>
<p>ContextRefreshedEvent äº‹ä»¶æ¯”è¾ƒå¸¸ç”¨ï¼Œä¸‹é¢ç¤ºä¾‹ç›´æ¥ä½¿ç”¨@EventListener`æ³¨è§£è¿›è¡Œäº‹ä»¶ç›‘å¬é…ç½®</p>
</blockquote>
<p><code>ContextRefreshedEvent</code>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ³¨è§£ç›‘å¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/15 17:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refreshEvent</span><span class="params">(ContextRefreshedEvent event)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"==&gt; ContextRefreshedEvent &lt;=="</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-SpringBootå†…ç½®äº‹ä»¶"><a href="#2-SpringBootå†…ç½®äº‹ä»¶" class="headerlink" title="2. SpringBootå†…ç½®äº‹ä»¶"></a>2. SpringBootå†…ç½®äº‹ä»¶</h3><p>ã€€spring bootåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­å¢åŠ äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼Œä¸ºç”¨æˆ·åŠŸèƒ½æ‹“å±•æä¾›æå¤§çš„ä¾¿åˆ©ï¼Œsptingbootæ”¯æŒçš„äº‹ä»¶ç±»å‹æœ‰ä»¥ä¸‹äº”ç§:</p>
<ul>
<li>ApplicationStartingEvent</li>
<li>ApplicationFailedEvent</li>
<li>ApplicationPreparedEvent</li>
<li>ApplicationReadyEvent</li>
<li>ApplicationEnvironmentPreparedEvent</li>
</ul>
<blockquote>
<p>ApplicationReadyEventäº‹ä»¶æ¯”è¾ƒå¸¸ç”¨ã€‚ä¸‹é¢ç¤ºä¾‹ç›´æ¥ä½¿ç”¨@EventListener`æ³¨è§£è¿›è¡Œäº‹ä»¶ç›‘å¬é…ç½®</p>
</blockquote>
<p>ApplicationReadyEventç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ³¨è§£ç›‘å¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/15 17:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readyEvent</span><span class="params">(ApplicationReadyEvent event)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"==&gt; ApplicationReadyEvent &lt;=="</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-è‡ªå®šä¹‰äº‹ä»¶"><a href="#3-è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="3. è‡ªå®šä¹‰äº‹ä»¶"></a>3. è‡ªå®šä¹‰äº‹ä»¶</h3><h4 id="3-1-åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶"><a href="#3-1-åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="3.1 åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶"></a>3.1 åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰äº‹ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/15 17:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(MyEvent.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyEvent</span><span class="params">(Object source)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMsg</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">"è§¦å‘ç›‘å¬äº‹ä»¶ ==&gt; "</span> + message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>ç¼–ç¨‹å¼å†™æ³•</code></p>
<h4 id="3-2-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨"><a href="#3-2-è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="3.2 è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨"></a>3.2 è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/15 17:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// è¿™é‡Œå¿…é¡»æ³¨å…¥Springå®¹å™¨</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">MyEvent</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(MyEvent event)</span> </span>{</span><br><span class="line">        event.printMsg(<span class="string">"ç¼–ç¨‹å¼ç›‘å¬å™¨"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-3-å‘å¸ƒäº‹ä»¶"><a href="#3-3-å‘å¸ƒäº‹ä»¶" class="headerlink" title="3.3 å‘å¸ƒäº‹ä»¶"></a>3.3 å‘å¸ƒäº‹ä»¶</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTestApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication application = <span class="keyword">new</span> SpringApplication(SimpleTestApplication.class);</span><br><span class="line">        ConfigurableApplicationContext context = application.run(args);</span><br><span class="line">        <span class="comment">// å‘å¸ƒäº‹ä»¶</span></span><br><span class="line">        context.publishEvent(<span class="keyword">new</span> MyEvent(<span class="keyword">new</span> Object()));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>æ³¨è§£å¼å†™æ³•</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eventListener</span><span class="params">(MyEvent event)</span> </span>{</span><br><span class="line">        event.printMsg(<span class="string">"æ³¨è§£ç›‘å¬å™¨"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†</title>
    <url>/post/14002.html</url>
    <content><![CDATA[<h2 id="SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†"><a href="#SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†" class="headerlink" title="SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†"></a>SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†</h2><h3 id="1-è‡ªå®šä¹‰å¼‚å¸¸ç±»"><a href="#1-è‡ªå®šä¹‰å¼‚å¸¸ç±»" class="headerlink" title="1. è‡ªå®šä¹‰å¼‚å¸¸ç±»"></a>1. è‡ªå®šä¹‰å¼‚å¸¸ç±»</h3><blockquote>
<p>ä¸€èˆ¬å¯ä»¥ç»§æ‰¿RuntimeExceptionè¿è¡Œæ—¶å¼‚å¸¸ç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7683466324584252019L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŠ¶æ€ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥å—çŠ¶æ€ç å’Œæ¶ˆæ¯ï¼Œå¹¶ä¸”é»˜è®¤çš„æ˜¯å¦æˆåŠŸçš„ç»“æœä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlogException</span><span class="params">(Integer code, String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code=code;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlogException</span><span class="params">(ResultCodeEnum resultCodeEnum)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">this</span>.code = resultCodeEnum.getCode();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™toStringæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BlogException{"</span> +</span><br><span class="line">                <span class="string">"code="</span> + code +</span><br><span class="line">                <span class="string">"message="</span> + <span class="keyword">this</span>.getMessage() +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#2-å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="2.å…¨å±€å¼‚å¸¸å¤„ç†"></a>2.å…¨å±€å¼‚å¸¸å¤„ç†</h3><blockquote>
<p>åŸç†ï¼šå½“ç³»ç»Ÿæ•è·åˆ°å¼‚å¸¸æ—¶ï¼Œä¼šåŒ¹é…æœ€æ¥è¿‘çš„å¼‚å¸¸æ–¹æ³•ï¼Œä¾‹å¦‚BadSqlGrammarException.classï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±ç›´æ¥å®šä½åˆ°Exception.classçš„å¼‚å¸¸æ–¹æ³•ã€‚</p>
<p>æ“ä½œï¼š<code>@RestControllerAdvice</code>æ³¨è§£</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šç”¨å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(Exception e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.error();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç‰¹å®šå¼‚å¸¸å¤„ç†:sqlè¯­å¥é”™è¯¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BadSqlGrammarException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(BadSqlGrammarException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.BAD_SQL_GRAMMAR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç‰¹å®šå¼‚å¸¸å¤„ç†ï¼šjsonè§£æå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(HttpMessageNotReadableException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(HttpMessageNotReadableException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.JSON_PARSE_ERROR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚æ•°æ ¡éªŒå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(MethodArgumentNotValidException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼šæœ€æ–¹ä¾¿çµæ´»çš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BlogException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(BlogException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.error().message(e.getMessage()).code(e.getCode());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringAOP</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼</title>
    <url>/post/13298.html</url>
    <content><![CDATA[<h2 id="SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼"><a href="#SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼" class="headerlink" title="SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼"></a>SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼</h2><h3 id="1-ymlé…ç½®æ–‡ä»¶è§„åˆ™"><a href="#1-ymlé…ç½®æ–‡ä»¶è§„åˆ™" class="headerlink" title="1. ymlé…ç½®æ–‡ä»¶è§„åˆ™"></a>1. ymlé…ç½®æ–‡ä»¶è§„åˆ™</h3><blockquote>
<p>å­—ç¬¦ä¸²é»˜è®¤<strong>ä¸éœ€è¦</strong>åŠ ä¸Š<strong>å•å¼•å·</strong>æˆ–<strong>åŒå¼•å·</strong></p>
</blockquote>
<h4 id="1-1-ymlç¤ºä¾‹ï¼š"><a href="#1-1-ymlç¤ºä¾‹ï¼š" class="headerlink" title="1.1 ymlç¤ºä¾‹ï¼š"></a>1.1 ymlç¤ºä¾‹ï¼š</h4><blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¯»å–listï¼Œmapç±»å‹ï¼Œå°½é‡ä½¿ç”¨<code>@ConfigurationProperties</code>æ³¨è§£æ‰¹é‡è¯»å–ï¼Œä½¿ç”¨<code>@Value</code>æ³¨è§£é€‚åˆç®€å•ç±»å‹çš„å€¼ã€‚</li>
</ul>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">springboot</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">23</span></span><br><span class="line">  <span class="attr">list:</span>  <span class="comment"># List&lt;String&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">one</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">two</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">three</span></span><br><span class="line">  <span class="attr">again:</span> <span class="string">one,tow,three</span> <span class="comment"># listè¡Œå†…å†™æ³•,æˆ–è€…  again: [one,thwo,three]</span></span><br><span class="line">  <span class="attr">map:</span> <span class="comment">#  Map&lt;String,String&gt;</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">two:</span> {<span class="attr">k1:</span> <span class="string">'v1'</span>,<span class="attr">k2:</span> <span class="string">'v2'</span>} <span class="comment"># mapè¡Œå†…å†™æ³•</span></span><br><span class="line">  <span class="attr">nested:</span>  <span class="comment"># Map&lt;String,List&lt;String&gt;&gt;</span></span><br><span class="line">    <span class="attr">key11:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t3</span></span><br><span class="line">    <span class="attr">key22:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t11</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t22</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t33</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-2-é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š"><a href="#1-2-é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š" class="headerlink" title="1.2 é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š"></a>1.2 é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š</h4><blockquote>
<p>springbootå¯åŠ¨è¿‡ç¨‹ä¸­åŠ è½½é…ç½®æ–‡ä»¶çš„é¡ºåº</p>
<ol>
<li><strong>file:./config/</strong>    [å½“å‰é¡¹ç›®è·¯å¾„configç›®å½•ä¸‹]</li>
<li><strong>file:./</strong>   [å½“å‰é¡¹ç›®è·¯å¾„ä¸‹]</li>
<li><strong>classpath:/config/</strong>    [ç±»è·¯å¾„ï¼ˆresourcesï¼‰çš„configç›®å½•ä¸‹]</li>
<li><strong>classpath:/</strong>   [ç±»è·¯å¾„ï¼ˆresourcesï¼‰ç›®å½•ä¸‹, ==ä¸€èˆ¬æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶éƒ½å†™åœ¨è¿™é‡Œ==]</li>
</ol>
</blockquote>
<h3 id="2-Valueæ³¨è§£"><a href="#2-Valueæ³¨è§£" class="headerlink" title="2. @Valueæ³¨è§£"></a>2. @Valueæ³¨è§£</h3><blockquote>
<p>è¯¥å¯¹è±¡å¿…é¡»åœ¨å·²ç»è¢«æ³¨å…¥Springå®¹å™¨çš„beanä¸­ä½¿ç”¨</p>
</blockquote>
<h4 id="2-1-æ­£å¸¸ä½¿ç”¨"><a href="#2-1-æ­£å¸¸ä½¿ç”¨" class="headerlink" title="2.1 æ­£å¸¸ä½¿ç”¨"></a>2.1 æ­£å¸¸ä½¿ç”¨</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="meta">@Value("${person.name}")</span></span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Value("${person.age}")</span></span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Valueè·å–listå±æ€§èµ‹å€¼çš„æœ€æ­£ç¡®çš„æ–¹å¼</span></span><br><span class="line">   <span class="meta">@Value("#{'${person.list}'.empty() ? null : '${person.list}'.split(',')}")</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;String&gt; list;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2-é™æ€å˜é‡èµ‹å€¼"><a href="#2-2-é™æ€å˜é‡èµ‹å€¼" class="headerlink" title="2.2 é™æ€å˜é‡èµ‹å€¼"></a>2.2 é™æ€å˜é‡èµ‹å€¼</h4><blockquote>
<p>åœ¨å¤„ç†é™æ€å˜é‡æ—¶å€™ï¼Œä½¿ç”¨ä¸Šé¢çš„@Valueçš„ç”¨æ³•æ˜¯æ— æ³•è·å–åˆ°é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®çš„ï¼Œåªèƒ½è·å–åˆ°nullã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”Ÿæˆè¯¥é™æ€å˜é‡çš„setæ–¹æ³•ï¼Œç„¶å<strong>åˆ é™¤è¯¥æ–¹æ³•çš„staticä¿®é¥°</strong></li>
<li>å°†æ³¨è§£@Valueå†™åœ¨setå‡½æ•°ä¸Šé¢</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer age;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value("${person.age}")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>{</span><br><span class="line">    SimpleTestApplicationTests.age = age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-ä¸æ³¨beançš„ä½¿ç”¨æ–¹æ³•"><a href="#2-3-ä¸æ³¨beançš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2.3 ä¸æ³¨beançš„ä½¿ç”¨æ–¹æ³•"></a>2.3 ä¸æ³¨beançš„ä½¿ç”¨æ–¹æ³•</h4><p>ä¸€èˆ¬åœ¨å·¥å…·ç±»ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šæŠŠå·¥å…·ç±»æ³¨å…¥Springå®¹å™¨ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¿˜æƒ³ç»§ç»­ä½¿ç”¨è¿™æ ·æ–¹å¼èµ‹å€¼çš„è¯ã€‚å¯ä»¥åœ¨springbootå¯åŠ¨æ—¶ä½¿ç”¨ç›‘å¬äº‹ä»¶æˆ–è€…CommandLineRunnerç±»è¿›è¡Œå¯åŠ¨æ—¶èµ‹å€¼ã€‚</p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆElasticSearchåˆ†å¸ƒå¼æœç´¢å¼•æ“</title>
    <url>/post/21497.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆElasticSearchåˆ†å¸ƒå¼æœç´¢å¼•æ“"><a href="#SpringBootæ•´åˆElasticSearchåˆ†å¸ƒå¼æœç´¢å¼•æ“" class="headerlink" title="SpringBootæ•´åˆElasticSearchåˆ†å¸ƒå¼æœç´¢å¼•æ“"></a>SpringBootæ•´åˆElasticSearchåˆ†å¸ƒå¼æœç´¢å¼•æ“</h2><h3 id="å¼•å…¥pom"><a href="#å¼•å…¥pom" class="headerlink" title="å¼•å…¥pom"></a>å¼•å…¥pom</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>springbootå’Œelasticsearchçš„ç‰ˆæœ¬ä¸€å®šè¦ç›¸äº’å…¼å®¹</li>
<li>æœ¬é¡¹ç›®é‡‡ç”¨<code>2.3.2.RELEASE</code> ç‰ˆæœ¬ï¼Œå¯¹åº”elacticsearchç‰ˆæœ¬ä¸º <code>7.6.2</code></li>
<li><img src="https://i.loli.net/2021/06/26/rsQHehiqUCxnEfz.png" alt="ç‰ˆæœ¬å¯¹ç…§å›¾"></li>
</ul>
</blockquote>
<h3 id="åˆå§‹åŒ–é…ç½®"><a href="#åˆå§‹åŒ–é…ç½®" class="headerlink" title="åˆå§‹åŒ–é…ç½®"></a>åˆå§‹åŒ–é…ç½®</h3><blockquote>
<p>é…ç½®å¯¹åº”çš„hostï¼ˆ192.168.71.129ï¼‰åœ°å€å’Œportï¼ˆ9200ï¼‰ç«¯å£</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.config.AbstractElasticsearchConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åˆå§‹åŒ–ElasticSearché«˜çº§å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/23 9:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "elasticsearch")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchConfig</span> <span class="keyword">extends</span> <span class="title">AbstractElasticsearchConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ElasticSearché«˜çº§å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">elasticsearchClient</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestHighLevelClient(RestClient.builder(<span class="keyword">new</span> HttpHost(host, port)));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆå§‹åŒ–å­˜å‚¨å¯¹è±¡"><a href="#åˆå§‹åŒ–å­˜å‚¨å¯¹è±¡" class="headerlink" title="åˆå§‹åŒ–å­˜å‚¨å¯¹è±¡"></a>åˆå§‹åŒ–å­˜å‚¨å¯¹è±¡</h3><blockquote>
<p>é…ç½®æ³¨è§£ï¼Œè¿›è¡Œç´¢å¼•è®¾ç½®å’Œè§„åˆ™æ˜ å°„è®¾ç½®</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Document;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Field;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.FieldType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/22 14:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="comment">// è®¾ç½®ç´¢å¼•/åˆ†ç‰‡å’Œå‰¯æœ¬å€¼</span></span><br><span class="line"><span class="meta">@Document(indexName = "blogs", replicas = 0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexSearchBlog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6710699909610548088L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å±æ€§æ˜ å°„,è‡ªå®šä¹‰åˆ†è¯å™¨ä¸ºikåˆ†è¯å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text, analyzer = "ik_max_word"</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Text, index = false)</span></span><br><span class="line"><span class="meta">    private String picture;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String flag;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Long, index = false)</span></span><br><span class="line"><span class="meta">    private Long views;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Text, analyzer = "ik_max_word")</span></span><br><span class="line"><span class="meta">    private String description;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Boolean, index = false)</span></span><br><span class="line"><span class="meta">    private Boolean comment;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Boolean, index = false)</span></span><br><span class="line"><span class="meta">    private Boolean appreciation;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Boolean, index = false)</span></span><br><span class="line"><span class="meta">    private Boolean recommend;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Boolean, index = false)</span></span><br><span class="line"><span class="meta">    private Boolean share;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Long, index = false)</span></span><br><span class="line"><span class="meta">    private Long wordCount;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Boolean, index = false)</span></span><br><span class="line"><span class="meta">    private Boolean markdown;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String categoryId;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String categoryName;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String userId;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String nickname;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private String avatar;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    private List&lt;Tag&gt; tags;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    // ä¸ºäº†é¿å…Dateç±»å‹è½¬æ¢è§£æä¿é”™ï¼Œè¿™é‡Œç›´æ¥è®¾ç½®å±‚Textç±»å‹å­˜å‚¨</span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Text, index = false)</span></span><br><span class="line"><span class="meta">    private Date gmtCreate;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Long, index = false)</span></span><br><span class="line"><span class="meta">    private Long commentCount;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    @Field(type = FieldType.Long, index = false)</span></span><br><span class="line"><span class="meta">    private Long likeCount;</span></span><br><span class="line"><span class="meta">}</span></span><br><span class="line"><span class="meta"></span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tag</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6656419195498399499L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ElasticSearchTemplateç®€å•ä½¿ç”¨"><a href="#ElasticSearchTemplateç®€å•ä½¿ç”¨" class="headerlink" title="ElasticSearchTemplateç®€å•ä½¿ç”¨"></a>ElasticSearchTemplateç®€å•ä½¿ç”¨</h3><blockquote>
<p>æ¼”ç¤ºç¤ºä¾‹ï¼š</p>
<ul>
<li>æ‰¹é‡å¯¼å…¥æˆ–æ›´æ–°</li>
<li>æ‰¹é‡åˆ é™¤</li>
<li>åˆ†é¡µé«˜äº®æ£€ç´¢</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.horse.common.util.result.R;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.elastic.base.IndexSearchBlog;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.elastic.mapper.BlogMapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.elastic.service.ElasticService;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.lang.Collections;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.MatchQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.MultiMatchQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.FieldSortBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.PageRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.ElasticsearchOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.ElasticsearchRestTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.IndexOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.query.NativeSearchQuery;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/22 10:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticServiceImpl</span> <span class="keyword">implements</span> <span class="title">ElasticService</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier("elasticsearchTemplate")</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchOperations restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BlogMapper blogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é«˜äº®æ£€ç´¢å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TITLE = <span class="string">"title"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DESCRIPTION = <span class="string">"description"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CATEGORY_NAME = <span class="string">"categoryName"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é«˜çº§å®¢æˆ·ç«¯å°è£…çš„tTemplateæ¨¡æ¿: æ‰¹é‡å¯¼å…¥æˆ–æ›´æ–°ElasticSearchæ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blogs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importTemplateSearchBlog</span><span class="params">(List&lt;IndexSearchBlog&gt; blogs)</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        IndexOperations index = restTemplate.indexOps(IndexSearchBlog.class);</span><br><span class="line">        <span class="comment">// ç´¢å¼•ä¸å­˜åœ¨,åˆ™ç›´æ¥åˆ›å»ºç´¢å¼•å’Œæ˜ å°„è§„åˆ™</span></span><br><span class="line">        <span class="keyword">if</span> (!index.exists()) {</span><br><span class="line">            index.create();</span><br><span class="line">            index.createMapping();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®</span></span><br><span class="line">        Iterable&lt;IndexSearchBlog&gt; indexSearchBlogs = blogMapper.saveAll(blogs);</span><br><span class="line">        <span class="comment">// éå†è¾“å‡ºä¿å­˜çš„æ‰€æœ‰å®ä½“</span></span><br><span class="line">        AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line">        indexSearchBlogs.forEach(blog -&gt; log.info(<span class="string">"==&gt; ä¿å­˜ç¬¬ã€{}ã€‘æ¡æ•°æ®: ã€{}ã€‘"</span>, count.getAndIncrement(), blog));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ElasticSearchæ•°æ®åˆ é™¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blogIds</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeSearchBlog</span><span class="params">(List&lt;String&gt; blogIds)</span> </span>{</span><br><span class="line">        List&lt;IndexSearchBlog&gt; blogs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        blogIds.forEach(blogId -&gt; {</span><br><span class="line">            IndexSearchBlog blog = <span class="keyword">new</span> IndexSearchBlog();</span><br><span class="line">            blog.setId(blogId);</span><br><span class="line">            blogs.add(blog);</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// æ‰¹é‡åˆ é™¤æ•°æ®</span></span><br><span class="line">        blogMapper.deleteAll(blogs);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºElasticSearchæ ¹æ®æ–‡ç« æ ‡é¢˜è¿›è¡Œå…¨æ–‡é«˜äº®æ£€ç´¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> search</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">highlightSearchBlog</span><span class="params">(String search, Long page, Long limit)</span> </span>{</span><br><span class="line">        log.info(<span class="string">" ==&gt; ElasticSearchå¼€å§‹æ£€ç´¢å…³é”®è¯: {}"</span>, search);</span><br><span class="line">        <span class="comment">// ç»„è£…åˆ†é¡µå‚æ•°: ç¬¬ä¸€é¡µæ˜¯ 0</span></span><br><span class="line">        PageRequest pageRequest = PageRequest.of(page.intValue() - <span class="number">1</span>, limit.intValue());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        MultiMatchQueryBuilder matchQuery =</span><br><span class="line">                QueryBuilders.multiMatchQuery(search, TITLE, DESCRIPTION, CATEGORY_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">        FieldSortBuilder sortBuilder = SortBuilders.fieldSort(<span class="string">"views"</span>)</span><br><span class="line">                .order(SortOrder.DESC);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»ºé«˜äº®å‚æ•°</span></span><br><span class="line">        HighlightBuilder highlightBuilder = <span class="keyword">new</span> HighlightBuilder();</span><br><span class="line">        highlightBuilder.field(TITLE).field(DESCRIPTION).field(CATEGORY_NAME)</span><br><span class="line">                .preTags(<span class="string">"&lt;font color='red'&gt;"</span>).postTags(<span class="string">"&lt;/font&gt;"</span>);</span><br><span class="line">        <span class="comment">// æ„å»ºæ£€ç´¢å¯¹è±¡</span></span><br><span class="line">        NativeSearchQuery searchQueryBuilder = <span class="keyword">new</span> NativeSearchQueryBuilder()</span><br><span class="line">                .withQuery(matchQuery)</span><br><span class="line">                .withPageable(pageRequest)</span><br><span class="line">                .withSort(sortBuilder)</span><br><span class="line">                .withHighlightBuilder(highlightBuilder)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢åŒ¹é…æ•°æ®</span></span><br><span class="line">        SearchHits&lt;IndexSearchBlog&gt; searchHits = restTemplate.search(searchQueryBuilder, IndexSearchBlog.class);</span><br><span class="line">        log.info(<span class="string">"==&gt; å…±æ£€ç´¢åˆ°ã€{}ã€‘æ¡æ•°æ®"</span>, searchHits.getTotalHits());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é«˜äº®è¯æ›¿æ¢</span></span><br><span class="line">        List&lt;IndexSearchBlog&gt; searchBlogs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        searchHits.forEach(searchHit -&gt; {</span><br><span class="line">            IndexSearchBlog blog = searchHit.getContent();</span><br><span class="line">            <span class="comment">// è·å–é«˜äº®å­—æ®µç»“æœå¹¶æ›¿æ¢</span></span><br><span class="line">            List&lt;String&gt; titleList = searchHit.getHighlightField(TITLE);</span><br><span class="line">            List&lt;String&gt; descriptionList = searchHit.getHighlightField(DESCRIPTION);</span><br><span class="line">            List&lt;String&gt; categories = searchHit.getHighlightField(CATEGORY_NAME);</span><br><span class="line">            <span class="keyword">if</span> (!Collections.isEmpty(titleList)) {</span><br><span class="line">                blog.setTitle(titleList.get(<span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!Collections.isEmpty(descriptionList)) {</span><br><span class="line">                blog.setDescription(descriptionList.get(<span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!Collections.isEmpty(categories)) {</span><br><span class="line">                blog.setCategoryName(categories.get(<span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line">            searchBlogs.add(blog);</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"rows"</span>, searchBlogs).data(<span class="string">"total"</span>, searchHits.getTotalHits());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é«˜äº®æ£€ç´¢æµ‹è¯•"><a href="#é«˜äº®æ£€ç´¢æµ‹è¯•" class="headerlink" title="é«˜äº®æ£€ç´¢æµ‹è¯•"></a>é«˜äº®æ£€ç´¢æµ‹è¯•</h3><blockquote>
<p>æ£€ç´¢å…³é”®è¯ï¼šSpringBoot</p>
</blockquote>
<h4 id="æ£€ç´¢æ•ˆæœå›¾"><a href="#æ£€ç´¢æ•ˆæœå›¾" class="headerlink" title="æ£€ç´¢æ•ˆæœå›¾"></a>æ£€ç´¢æ•ˆæœå›¾</h4><p><img src="https://i.loli.net/2021/06/26/DmC2qZJB8px647M.png" alt="é«˜äº®æ£€ç´¢æ•ˆæœå›¾"></p>
<h4 id="Kibanaæ£€ç´¢æ•ˆæœ"><a href="#Kibanaæ£€ç´¢æ•ˆæœ" class="headerlink" title="Kibanaæ£€ç´¢æ•ˆæœ"></a>Kibanaæ£€ç´¢æ•ˆæœ</h4><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"took"</span> : <span class="number">4</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span> : {</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"successful"</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"skipped"</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"hits"</span> : {</span><br><span class="line">    <span class="attr">"total"</span> : {</span><br><span class="line">      <span class="attr">"value"</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"relation"</span> : <span class="string">"eq"</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">"max_score"</span> : <span class="number">2.5516207</span>,</span><br><span class="line">    <span class="attr">"hits"</span> : [</span><br><span class="line">      {</span><br><span class="line">        <span class="attr">"_index"</span> : <span class="string">"blogs"</span>,</span><br><span class="line">        <span class="attr">"_type"</span> : <span class="string">"_doc"</span>,</span><br><span class="line">        <span class="attr">"_id"</span> : <span class="string">"1379775100554858498"</span>,</span><br><span class="line">        <span class="attr">"_score"</span> : <span class="number">2.5516207</span>,</span><br><span class="line">        <span class="attr">"_source"</span> : {</span><br><span class="line">          <span class="attr">"_class"</span> : <span class="string">"com.horse.service.elastic.base.IndexSearchBlog"</span>,</span><br><span class="line">          <span class="attr">"id"</span> : <span class="string">"1379775100554858498"</span>,</span><br><span class="line">          <span class="attr">"title"</span> : <span class="string">"Springbootæ•´åˆShiro"</span>,</span><br><span class="line">          <span class="attr">"picture"</span> : <span class="string">"http://h1.ioliu.cn/bing/BFBadger_PT-BR10164748033_1920x1080.jpg?imageslim"</span>,</span><br><span class="line">          <span class="attr">"flag"</span> : <span class="string">"åŸåˆ›"</span>,</span><br><span class="line">          <span class="attr">"views"</span> : <span class="number">5</span>,</span><br><span class="line">          <span class="attr">"description"</span> : <span class="string">"shiroä½œä¸ºæ¯”è¾ƒè½»é‡çº§çš„æƒé™æ§åˆ¶æ¡†æ¶ï¼Œç®€å•æ˜“ä¸Šæ‰‹ã€‚Springbootæ•´åˆShiro(MD5ç›å€¼åŠ å¯†)ï¼Œéå‰åç«¯åˆ†ç¦»çš„ç‰ˆæœ¬ã€‚"</span>,</span><br><span class="line">          <span class="attr">"comment"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"appreciation"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"recommend"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"share"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"wordCount"</span> : <span class="number">12513</span>,</span><br><span class="line">          <span class="attr">"markdown"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"categoryId"</span> : <span class="string">"1304674926594215938"</span>,</span><br><span class="line">          <span class="attr">"categoryName"</span> : <span class="string">"æµè¡Œæ¡†æ¶"</span>,</span><br><span class="line">          <span class="attr">"nickname"</span> : <span class="string">"å°éº‹é¹¿"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span> : <span class="string">"http://mabin.horsemuzi.top/7338ad388e9940f091a8533b22328ffe.gif"</span>,</span><br><span class="line">          <span class="attr">"tags"</span> : [</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1366670150710870018"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"Java"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1379776002334412801"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"Apache Shiro"</span></span><br><span class="line">            }</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"gmtCreate"</span> : <span class="number">1617798994000</span>,</span><br><span class="line">          <span class="attr">"commentCount"</span> : <span class="number">0</span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">      {</span><br><span class="line">        <span class="attr">"_index"</span> : <span class="string">"blogs"</span>,</span><br><span class="line">        <span class="attr">"_type"</span> : <span class="string">"_doc"</span>,</span><br><span class="line">        <span class="attr">"_id"</span> : <span class="string">"1386210456728793090"</span>,</span><br><span class="line">        <span class="attr">"_score"</span> : <span class="number">1.9496658</span>,</span><br><span class="line">        <span class="attr">"_source"</span> : {</span><br><span class="line">          <span class="attr">"_class"</span> : <span class="string">"com.horse.service.elastic.base.IndexSearchBlog"</span>,</span><br><span class="line">          <span class="attr">"id"</span> : <span class="string">"1386210456728793090"</span>,</span><br><span class="line">          <span class="attr">"title"</span> : <span class="string">"SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†"</span>,</span><br><span class="line">          <span class="attr">"picture"</span> : <span class="string">"http://h1.ioliu.cn/bing/ImaginePeace_EN-AU12572046001_1920x1080.jpg?imageslim"</span>,</span><br><span class="line">          <span class="attr">"flag"</span> : <span class="string">"åŸåˆ›"</span>,</span><br><span class="line">          <span class="attr">"views"</span> : <span class="number">57</span>,</span><br><span class="line">          <span class="attr">"description"</span> : <span class="string">"åœ¨SpringBootå…¨å±€å¼‚å¸¸çš„å¤„ç†ï¼Œä¸»è¦ç”¨äºå¼‚å¸¸çš„ç»Ÿä¸€æ•è·å’Œå¤„ç†æ–¹é¢ã€‚"</span>,</span><br><span class="line">          <span class="attr">"comment"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"appreciation"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"recommend"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"share"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"wordCount"</span> : <span class="number">3913</span>,</span><br><span class="line">          <span class="attr">"markdown"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"categoryId"</span> : <span class="string">"1304674926594215938"</span>,</span><br><span class="line">          <span class="attr">"categoryName"</span> : <span class="string">"æµè¡Œæ¡†æ¶"</span>,</span><br><span class="line">          <span class="attr">"nickname"</span> : <span class="string">"å°éº‹é¹¿"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span> : <span class="string">"http://mabin.horsemuzi.top/7338ad388e9940f091a8533b22328ffe.gif"</span>,</span><br><span class="line">          <span class="attr">"tags"</span> : [</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1304300802713620481"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"SpringBoot"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1379416868611280898"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"Spring"</span></span><br><span class="line">            }</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"gmtCreate"</span> : <span class="number">1619333302000</span>,</span><br><span class="line">          <span class="attr">"commentCount"</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"likeCount"</span> : <span class="number">2</span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">      {</span><br><span class="line">        <span class="attr">"_index"</span> : <span class="string">"blogs"</span>,</span><br><span class="line">        <span class="attr">"_type"</span> : <span class="string">"_doc"</span>,</span><br><span class="line">        <span class="attr">"_id"</span> : <span class="string">"1386220171676381186"</span>,</span><br><span class="line">        <span class="attr">"_score"</span> : <span class="number">1.8410828</span>,</span><br><span class="line">        <span class="attr">"_source"</span> : {</span><br><span class="line">          <span class="attr">"_class"</span> : <span class="string">"com.horse.service.elastic.base.IndexSearchBlog"</span>,</span><br><span class="line">          <span class="attr">"id"</span> : <span class="string">"1386220171676381186"</span>,</span><br><span class="line">          <span class="attr">"title"</span> : <span class="string">"SpringBooté…ç½®æ–‡ä»¶å±æ€§èµ‹å€¼"</span>,</span><br><span class="line">          <span class="attr">"picture"</span> : <span class="string">"http://shp.qpic.cn/ishow/2735040813/1586324882_84828260_15556_sProdImgNo_6.jpg/0"</span>,</span><br><span class="line">          <span class="attr">"flag"</span> : <span class="string">"åŸåˆ›"</span>,</span><br><span class="line">          <span class="attr">"views"</span> : <span class="number">295</span>,</span><br><span class="line">          <span class="attr">"description"</span> : <span class="string">""</span><span class="string">"1. è¯»å–listï¼Œmapç±»å‹ï¼Œå°½é‡ä½¿ç”¨`@ConfigurationProperties`æ³¨è§£æ‰¹é‡è¯»å–ï¼Œä½¿ç”¨`@Value`æ³¨è§£é€‚åˆç®€å•ç±»å‹çš„å€¼</span></span><br><span class="line"><span class="string">2. åœ¨å¤„ç†é™æ€å˜é‡æ—¶å€™ï¼Œä½¿ç”¨ä¸Šé¢çš„@Valueçš„ç”¨æ³•æ˜¯æ— æ³•è·å–åˆ°é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®çš„ï¼Œåªèƒ½è·å–åˆ°nullï¼ˆè§£å†³æ–¹æ³•ï¼šç”Ÿæˆè¯¥é™æ€å˜é‡çš„setæ–¹æ³•ï¼Œç„¶ååˆ é™¤è¯¥æ–¹æ³•çš„staticä¿®é¥° ï¼Œå°†æ³¨è§£@Valueå†™åœ¨setå‡½æ•°ä¸Šé¢å³å¯è·å–åˆ°å€¼ï¼‰"</span><span class="string">""</span>,</span><br><span class="line">          <span class="attr">"comment"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"appreciation"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"recommend"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"share"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"wordCount"</span> : <span class="number">2849</span>,</span><br><span class="line">          <span class="attr">"markdown"</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"categoryId"</span> : <span class="string">"1304674926594215938"</span>,</span><br><span class="line">          <span class="attr">"categoryName"</span> : <span class="string">"æµè¡Œæ¡†æ¶"</span>,</span><br><span class="line">          <span class="attr">"nickname"</span> : <span class="string">"å°éº‹é¹¿"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span> : <span class="string">"http://mabin.horsemuzi.top/7338ad388e9940f091a8533b22328ffe.gif"</span>,</span><br><span class="line">          <span class="attr">"tags"</span> : [</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1304300802713620481"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"SpringBoot"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1304781819060740097"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"SpringMVC"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">              <span class="attr">"id"</span> : <span class="string">"1379416868611280898"</span>,</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"Spring"</span></span><br><span class="line">            }</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"gmtCreate"</span> : <span class="number">1619335618000</span>,</span><br><span class="line">          <span class="attr">"commentCount"</span> : <span class="number">9</span>,</span><br><span class="line">          <span class="attr">"likeCount"</span> : <span class="number">2</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    ]</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>è¿˜æœ‰å¾ˆå¤šå¤æ‚çš„æŸ¥è¯¢æ“ä½œï¼Œåé¢ä¸šåŠ¡ç”¨åˆ°å†æ·±å…¥ç ”ç©¶â€¦..</p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆEmailå‘é€</title>
    <url>/post/11417.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆEmailå‘é€"><a href="#SpringBootæ•´åˆEmailå‘é€" class="headerlink" title="SpringBootæ•´åˆEmailå‘é€"></a>SpringBootæ•´åˆEmailå‘é€</h2><h3 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--springboot-mail--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é…ç½®é‚®ä»¶ä¿¡æ¯-QQé‚®ç®±"><a href="#é…ç½®é‚®ä»¶ä¿¡æ¯-QQé‚®ç®±" class="headerlink" title="é…ç½®é‚®ä»¶ä¿¡æ¯(QQé‚®ç®±)"></a>é…ç½®é‚®ä»¶ä¿¡æ¯(QQé‚®ç®±)</h3><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment">#é…ç½®mailå‘é€çš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">3468449362</span><span class="string">@qq.com</span></span><br><span class="line">    <span class="comment">#é‚®ç®±æˆæƒç </span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">x*********</span></span><br><span class="line">    <span class="comment">#ä¸»æœºå‘é€é‚®ä»¶æœåŠ¡å™¨ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œä¸€èˆ¬å†™æ³•æ˜¯å›ºå®šçš„ï¼‰</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="comment">#å¼€å¯å®‰å…¨æœåŠ¡</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é‚®ä»¶å‘é€å·¥å…·ç±»"><a href="#é‚®ä»¶å‘é€å·¥å…·ç±»" class="headerlink" title="é‚®ä»¶å‘é€å·¥å…·ç±»"></a>é‚®ä»¶å‘é€å·¥å…·ç±»</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/5/9 15:11</span></span><br><span class="line"><span class="comment"> * å‘é€é‚®ä»¶å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.mail.username}")</span></span><br><span class="line">    <span class="keyword">private</span> String sendUsername;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€htmlæ¨¡æ¿é‚®ä»¶:æ¥æ”¶ç½‘é¡µå‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendTo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‘é€çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendHtmlMail</span><span class="params">(String title, String[] sendTo, String html)</span> <span class="keyword">throws</span> MessagingException </span>{</span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å‘ä»¶äººé‚®ç®±</span></span><br><span class="line">        helper.setFrom(sendUsername);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ”¶ä»¶äººé‚®ç®±ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼‰</span></span><br><span class="line">        helper.setTo(sendTo);</span><br><span class="line">        <span class="comment">//è®¾ç½®é‚®ä»¶æ ‡é¢˜</span></span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        <span class="comment">//è®¾ç½®é‚®ä»¶æ­£æ–‡</span></span><br><span class="line">        helper.setText(html, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//å¼€å§‹å‘é€</span></span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">        log.info(<span class="string">" ==&gt; é‚®ä»¶å‘é€æˆåŠŸ"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æœ¬åœ°é™„ä»¶é‚®ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendTo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath æœ¬åœ°èµ„æºè·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendLocalAttachMail</span><span class="params">(String title, String[] sendTo, String html, String filePath)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper mailHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">            mailHelper.setFrom(sendUsername);</span><br><span class="line">            mailHelper.setTo(sendTo);</span><br><span class="line">            mailHelper.setSubject(title);</span><br><span class="line">            mailHelper.setText(html, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// æºå¸¦é™„ä»¶(æœ¬åœ°å›¾ç‰‡é™„ä»¶)</span></span><br><span class="line">            FileSystemResource file = <span class="keyword">new</span> FileSystemResource(filePath);</span><br><span class="line">            String fileName = filePath.substring(filePath.lastIndexOf(<span class="string">"/"</span>));</span><br><span class="line">            mailHelper.addAttachment(fileName, file);</span><br><span class="line">            javaMailSender.send(mimeMessage);</span><br><span class="line">            log.info(<span class="string">" ==&gt; é‚®ä»¶å‘é€æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (MessagingException e) {</span><br><span class="line">            log.error(<span class="string">" ==&gt; é‚®ä»¶å‘é€å¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ–‡ä»¶æµé™„ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendTo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendWebAttachMail</span><span class="params">(String title, String[] sendTo, String html, String fileName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  InputStream inputStream)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper mailHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">            mailHelper.setFrom(sendUsername);</span><br><span class="line">            mailHelper.setTo(sendTo);</span><br><span class="line">            mailHelper.setSubject(title);</span><br><span class="line">            mailHelper.setText(html, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// æºå¸¦é™„ä»¶(æ–‡ä»¶æµé™„ä»¶)</span></span><br><span class="line">            <span class="comment">// å¯¹äºå†…å­˜ä¸­ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ByteArrayResourceã€‚åªéœ€ä½¿ç”¨Apache Commonsä¸­çš„IOUtilsè½¬æ¢æ‚¨çš„InputStreamå¯¹è±¡</span></span><br><span class="line">            mailHelper.addAttachment(fileName, <span class="keyword">new</span> ByteArrayResource(IOUtils.toByteArray(inputStream)));</span><br><span class="line">            javaMailSender.send(mimeMessage);</span><br><span class="line">            log.info(<span class="string">" ==&gt; é‚®ä»¶å‘é€æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">" ==&gt; é‚®ä»¶å‘é€å¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é¡µé¢è¡¨å•å‘é€æµ‹è¯•ï¼Œå®Œç¾æˆåŠŸã€‚ã€‚ã€‚</p>
<p><img src="https://i.loli.net/2021/05/24/uSjR24PvBDkomGg.gif" alt="ç‡¥èµ·æ¥"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Email</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆMybatiså¤šæ•°æ®æºåŠ¨æ€åˆ‡æ¢</title>
    <url>/post/31777.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆMybatiså¤šæ•°æ®æºåŠ¨æ€åˆ‡æ¢"><a href="#SpringBootæ•´åˆMybatiså¤šæ•°æ®æºåŠ¨æ€åˆ‡æ¢" class="headerlink" title="SpringBootæ•´åˆMybatiså¤šæ•°æ®æºåŠ¨æ€åˆ‡æ¢"></a>SpringBootæ•´åˆMybatiså¤šæ•°æ®æºåŠ¨æ€åˆ‡æ¢</h2><blockquote>
<p>ç®€ä»‹ï¼šSpringBootæ•´åˆMybatiså®ç°æ•°æ®æºåŠ¨æ€åˆ‡æ¢ï¼ˆåŠ¨æ€åŠ è½½ï¼š<a href="http://www.horsemuzi.top/JAVA/MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº/">MybatisPlus åŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº | å°é©¬åšå®¢</a>ï¼‰</p>
<p>è¦ç‚¹ï¼š</p>
<ul>
<li>ç»“åˆSpring AOPå’ŒThreadLocalå®ç°æ•°æ®æºå”¯ä¸€æ ‡è¯†keyçš„è·å–å’Œæ•°æ®æºçš„åˆ‡æ¢</li>
<li>ä¸»è¦ä½¿ç”¨<code>AbstractRoutingDataSource</code>æŠ½è±¡ç±»</li>
<li>Druidæ•°æ®æº</li>
</ul>
</blockquote>
<h3 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é…ç½®yml"><a href="#é…ç½®yml" class="headerlink" title="é…ç½®yml"></a>é…ç½®yml</h3><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mybatis-dynamic</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ•°æ®æºå®ä¾‹é…ç½®ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment"># ä¸»æ•°æ®æº</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">****</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://****:3306/dynamic_master?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line">      <span class="comment"># ä»æ•°æ®æº</span></span><br><span class="line">      <span class="attr">slave:</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">****</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://****:3306/dynamic_slave?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.horse.dynamic.mapper:</span> <span class="string">debug</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å…¬å…±å®ä¾‹"><a href="#å…¬å…±å®ä¾‹" class="headerlink" title="å…¬å…±å®ä¾‹"></a>å…¬å…±å®ä¾‹</h3><p><code>DataSourceConstants</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConstants</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æºåç§°æ ‡è¯†: é…ç½®æ–‡ä»¶å¯ä»¥æ— é™æ·»åŠ ,è¿™é‡ŒåŒæ­¥æ·»åŠ å³å¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MASTER = <span class="string">"master"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SLAVE = <span class="string">"slave"</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>User</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ¨æ€æ•°æ®æºé…ç½®"><a href="#åŠ¨æ€æ•°æ®æºé…ç½®" class="headerlink" title="åŠ¨æ€æ•°æ®æºé…ç½®"></a>åŠ¨æ€æ•°æ®æºé…ç½®</h3><blockquote>
<ol>
<li>åŠ è½½ymlçš„é…ç½®ä¿¡æ¯ï¼Œåˆå§‹åŒ–DruidDataSourceæ•°æ®æº</li>
<li>ç»§æ‰¿<code>AbstractRoutingDataSource</code>æŠ½è±¡ç±»ï¼Œå®ç°æ•°æ®æºåŠ¨æ€åˆ‡æ¢</li>
</ol>
</blockquote>
<p><code>DynamicDataSourceConfig</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.dynamic.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> com.horse.dynamic.common.DataSourceConstants;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/1 14:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSourceConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åŠ¨æ€é…ç½®æ•°æ®æº</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = "spring.datasource.druid.master")</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dynamicMasterDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = "spring.datasource.druid.slave")</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dynamicSlaveDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ•°æ®æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DynamicDataSource <span class="title">dataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// ç»„è£…å¤‡ç”¨æ•°æ®æº: è¿˜æœ‰æ•°æ®æº,å‘targetDataSourcesä¸­ç»§ç»­æ·»åŠ å³å¯</span></span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        targetDataSources.put(DataSourceConstants.MASTER, dynamicMasterDataSource());</span><br><span class="line">        targetDataSources.put(DataSourceConstants.SLAVE, dynamicSlaveDataSource());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DynamicDataSource(dynamicMasterDataSource(), targetDataSources);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>DynamicDataSource</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.dynamic.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/1 14:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; CONTEXT_HOLDER = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicDataSource</span><span class="params">(DataSource dynamicMasterDataSource, Map&lt;Object, Object&gt; targetDataSources)</span> </span>{</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•: è®¾ç½®é»˜è®¤æ•°æ®æº</span></span><br><span class="line">        <span class="keyword">super</span>.setDefaultTargetDataSource(dynamicMasterDataSource);</span><br><span class="line">        <span class="comment">// è®¾ç½®å¤‡ç”¨æ•°æ®æºé›†åˆ</span></span><br><span class="line">        <span class="keyword">super</span>.setTargetDataSources(targetDataSources);</span><br><span class="line">        <span class="comment">// è¿™ä¸ªä¸€å®šè¦å†™,ä¸å†™ä¼šæŠ¥é”™(æœªè¿½ç©¶å…¶åŸå› )</span></span><br><span class="line">        <span class="keyword">super</span>.afterPropertiesSet();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡ä¸­è·å–å†³å®šå½“å‰ä½¿ç”¨é‚£ä¸ªæ•°æ®æºå¯¹åº”çš„keyæ ‡è¯†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>{</span><br><span class="line">        String dataSource = getDataSource();</span><br><span class="line">        log.info(<span class="string">"æ•°æ®æº ==&gt; {} &lt;== åˆ‡æ¢æˆåŠŸ"</span>, dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * AOPçš„ç¯ç»•é€šçŸ¥è°ƒç”¨æ­¤æ–¹æ³•: å°†æ•°æ®æºå¯¹åº”çš„keyè®¾ç½®è¿›ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡ä¸­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(String dataSource)</span> </span>{</span><br><span class="line">        CONTEXT_HOLDER.set(dataSource);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> CONTEXT_HOLDER.get();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * AOPç¯ç»•é€šçŸ¥: æ–¹æ³•æ‰§è¡Œå®Œæ¯•,é‡Šæ”¾çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        CONTEXT_HOLDER.remove();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="AOPæ³¨è§£é…ç½®"><a href="#AOPæ³¨è§£é…ç½®" class="headerlink" title="AOPæ³¨è§£é…ç½®"></a>AOPæ³¨è§£é…ç½®</h3><blockquote>
<ol>
<li>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£</li>
<li>ç¼–å†™AOPè‡ªå®šä¹‰åˆ‡é¢æ–¹æ³•</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target({ElementType.METHOD, ElementType.TYPE})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DataSource {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æºæ ‡è¯†åç§°,é»˜è®¤å€¼: masterä¸»æ•°æ®æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> DataSourceConstants.MASTER</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.dynamic.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.dynamic.annotation.DataSource;</span><br><span class="line"><span class="keyword">import</span> com.horse.dynamic.common.DataSourceConstants;</span><br><span class="line"><span class="keyword">import</span> com.horse.dynamic.config.DynamicDataSource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/1 15:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceAspect</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut("@annotation(com.horse.dynamic.annotation.DataSource)")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dataSourcePointCut</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around("dataSourcePointCut()")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">dataSourceAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>{</span><br><span class="line">        MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line"></span><br><span class="line">        DataSource dataSource = method.getAnnotation(DataSource.class);</span><br><span class="line">        <span class="comment">// å¦‚æœæ–¹æ³•ä¸Šæ²¡æœ‰å†™æ³¨è§£,é»˜è®¤ä½¿ç”¨ä¸»æ•°æ®æº,å¦åˆ™æŒ‰ç…§æ³¨è§£å€¼åŠ¨æ€åˆ‡æ¢</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(dataSource)) {</span><br><span class="line">            DynamicDataSource.setDataSource(DataSourceConstants.MASTER);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            DynamicDataSource.setDataSource(dataSource.value());</span><br><span class="line">        }</span><br><span class="line">        Object proceed = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            proceed = joinPoint.proceed();</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable throwable) {</span><br><span class="line">            log.error(<span class="string">" ==&gt; mybatisåŠ¨æ€æ•°æ®æºåˆ‡æ¢å¼‚å¸¸: {}"</span>, throwable.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// é‡Šæ”¾çº¿ç¨‹å±€éƒ¨å˜é‡å€¼</span></span><br><span class="line">            DynamicDataSource.clearDataSource();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä¸»å¯åŠ¨ç±»é…ç½®"><a href="#ä¸»å¯åŠ¨ç±»é…ç½®" class="headerlink" title="ä¸»å¯åŠ¨ç±»é…ç½®"></a>ä¸»å¯åŠ¨ç±»é…ç½®</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Import({DynamicDataSourceConfig.class})</span> <span class="comment">// å¼•å…¥é…ç½®ç±»,ä½†æ˜¯é«˜ç‰ˆæœ¬çš„å¥½åƒä¸å¼•å…¥ä¹Ÿä¸ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = "com.horse.dynamic.mapper")</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span> <span class="comment">// æ’é™¤è‡ªåŠ¨æ•°æ®æºè‡ªåŠ¨é…ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootMybatisDynamicApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(SpringbootMybatisDynamicApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è°ƒç”¨æµ‹è¯•"><a href="#è°ƒç”¨æµ‹è¯•" class="headerlink" title="è°ƒç”¨æµ‹è¯•"></a>è°ƒç”¨æµ‹è¯•</h3><blockquote>
<p>controllerå±‚è¿›è¡Œè°ƒç”¨æµ‹è¯•ï¼š</p>
<ul>
<li>insertæ–¹æ³•ä½¿ç”¨<code>é»˜è®¤ä¸»æ•°æ®æº</code></li>
<li>selectæ–¹æ³•ä½¿ç”¨<code>æ‰‹åŠ¨æŒ‡å®šä»æ•°æ®æº</code></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/dynamic")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DataSource</span></span><br><span class="line">    <span class="meta">@PostMapping("/insert")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dynamicInsertUserInfo</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = userMapper.dynamicInsertUserInfo(user);</span><br><span class="line">        System.out.println(<span class="string">"count: "</span> + count);</span><br><span class="line">        System.out.println(<span class="string">"ä¸»é”®ID: "</span> + user.getId());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DataSource(DataSourceConstants.SLAVE)</span></span><br><span class="line">    <span class="meta">@GetMapping("/select")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dynamicSelectUserInfo</span><span class="params">()</span> </span>{</span><br><span class="line">        List&lt;User&gt; users = userMapper.dynamicSelectUserInfo();</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.horse.dynamic.model.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Options;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.ResultType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/1 15:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert("INSERT INTO tb_user(name) VALUES (#{name})")</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = "id")</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dynamicInsertUserInfo</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select("SELECT * FROM tb_user")</span></span><br><span class="line">    <span class="meta">@ResultType(User.class)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">dynamicSelectUserInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç®€è¦æ—¥å¿—</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"># ä»æ•°æ®æºæŸ¥è¯¢</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">25.672</span>  INFO <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">1</span>] c.h.dynamic.config.DynamicDataSource     : æ•°æ®æº ==&gt; slave &lt;== åˆ‡æ¢æˆåŠŸ</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">25.696</span>  INFO <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">1</span>] com.alibaba.druid.pool.DruidDataSource   : {dataSource-<span class="number">1</span>} inited</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">25.927</span> DEBUG <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">1</span>] c.h.d.m.U.dynamicSelectUserInfo          : ==&gt;  Preparing: SELECT * FROM tb_user</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">25.938</span> DEBUG <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">1</span>] c.h.d.m.U.dynamicSelectUserInfo          : ==&gt; Parameters: </span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">25.957</span> DEBUG <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">1</span>] c.h.d.m.U.dynamicSelectUserInfo          : &lt;==      Total: <span class="number">2</span></span><br><span class="line">User(id=<span class="number">1</span>, name=é©¬æ»¨)</span><br><span class="line">User(id=<span class="number">2</span>, name=æˆé¾™)</span><br><span class="line"></span><br><span class="line"># ä¸»æ•°æ®æºæ’å…¥æ“ä½œ</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">46.552</span>  INFO <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">2</span>] c.h.dynamic.config.DynamicDataSource     : æ•°æ®æº ==&gt; master &lt;== åˆ‡æ¢æˆåŠŸ</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">46.553</span>  INFO <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">2</span>] com.alibaba.druid.pool.DruidDataSource   : {dataSource-<span class="number">2</span>} inited</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">46.837</span> DEBUG <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">2</span>] c.h.d.m.U.dynamicInsertUserInfo          : ==&gt;  Preparing: <span class="function">INSERT INTO <span class="title">tb_user</span><span class="params">(name)</span> <span class="title">VALUES</span> <span class="params">(?)</span></span></span><br><span class="line"><span class="function">2021-06-01 16:19:46.837 DEBUG 15884 --- [nio-8888-exec-2] c.h.d.m.U.dynamicInsertUserInfo          : </span>==&gt; Parameters: xxl-job-admin(String)</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">01</span> <span class="number">16</span>:<span class="number">19</span>:<span class="number">46.896</span> DEBUG <span class="number">15884</span> --- [nio-<span class="number">8888</span>-exec-<span class="number">2</span>] c.h.d.m.U.dynamicInsertUserInfo          : &lt;==    Updates: <span class="number">1</span></span><br><span class="line">count: <span class="number">1</span></span><br><span class="line">ä¸»é”®ID: <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure>
<p>Mybatisæ•°æ®æºçš„åŠ¨æ€åˆ‡æ¢çš„æ€æƒ³å’Œå¤šç§Ÿæˆ·å¹³å°çš„å·®ä¸å¤šï¼Œçœ‹å¦ä¸€ç¯‡åšå®¢å³å¯ï¼</p>
<p><a href="http://www.horsemuzi.top/JAVA/MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº/">MybatisPlus åŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº | å°é©¬åšå®¢</a></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆRedisä½¿ç”¨æ³¨è§£ç¼“å­˜</title>
    <url>/post/43275.html</url>
    <content><![CDATA[<h2 id="ç¼“å­˜åŸç†"><a href="#ç¼“å­˜åŸç†" class="headerlink" title="ç¼“å­˜åŸç†"></a>ç¼“å­˜åŸç†</h2><blockquote>
<p>CacheManager === Cache ç¼“å­˜ç»„ä»¶ä¼šå®é™…é¡¹ç›®ä¸­å¼•å…¥çš„ç¼“å­˜ç»„ä»¶ï¼Œè¿›è¡Œæ•°æ®çš„ç¼“å­˜ã€‚</p>
<p><strong>æˆ‘ä»¬å¯ä»¥å¯¹<code>redisCacheManager</code>ç¼“å­˜ç®¡ç†å™¨è¿›è¡Œä¸€å®šçš„é…ç½®</strong></p>
<ol>
<li>å¼•å…¥redisçš„starterï¼Œå®¹å™¨ä¸­ä¿å­˜çš„æ˜¯RedisCacheManager</li>
<li>RedisCacheManager å¸®æˆ‘ä»¬åˆ›å»ºRedisCache æ¥ä½œä¸ºç¼“å­˜ç»„ä»¶ï¼ŒRedisCacheé€šè¿‡æ“ä½œredisæ¥ç¼“å­˜æ•°æ®</li>
<li>é»˜è®¤ä¿å­˜æ•°æ® K -V éƒ½æ˜¯é€šè¿‡åºåˆ—åŒ–æ¥ä¿å­˜çš„</li>
</ol>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li><strong>éœ€è¦è¢«åºåˆ—åŒ–ç¼“å­˜çš„å®ä¾‹ï¼Œå¿…é¡»å®ç°<code>Serializater</code>é€‰é¡¹</strong></li>
</ul>
</blockquote>
<h2 id="Redisç¼“å­˜é…ç½®"><a href="#Redisç¼“å­˜é…ç½®" class="headerlink" title="Redisç¼“å­˜é…ç½®"></a>Redisç¼“å­˜é…ç½®</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/10 17:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">// å¼€å¯åŸºäºæ³¨è§£çš„ç¼“å­˜</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰jsonåºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>{</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ³¨å…¥æ•°æ®æº</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ—¶å°†å¯¹è±¡å…¨ç±»åä¸€èµ·ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">        mapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(mapper);</span><br><span class="line"></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// key-valueç»“æ„åºåˆ—åŒ–æ•°æ®ç»“æ„</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashæ•°æ®ç»“æ„åºåˆ—åŒ–æ–¹å¼,å¿…é¡»è¿™æ ·å¦åˆ™å­˜hash å°±æ˜¯åŸºäºjdkåºåˆ—åŒ–çš„</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// å¯ç”¨é»˜è®¤åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setEnableDefaultSerializer(<span class="keyword">true</span>);</span><br><span class="line">        redisTemplate.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        redisTemplate.setEnableTransactionSupport(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£ç¼“å­˜ä¿¡æ¯é…ç½®(å¦‚æœä¸é…ç½®ï¼Œä½¿ç”¨çš„æ³¨è§£æ‚£å¤„å…¨éƒ¨éƒ½æ˜¯é»˜è®¤å±æ€§ï¼Œä¸€èˆ¬ä¼šåœ¨è¿™é‡Œè¿›è¡Œç®€å•é…ç½®)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(LettuceConnectionFactory connectionFactory)</span> </span>{</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                <span class="comment">//è¿‡æœŸæ—¶é—´600ç§’:600ç§’åä¼šé‡æ–°è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                <span class="comment">// é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> StringRedisSerializer()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer()))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(connectionFactory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ ¸å¿ƒæ³¨è§£ç®€æ"><a href="#æ ¸å¿ƒæ³¨è§£ç®€æ" class="headerlink" title="æ ¸å¿ƒæ³¨è§£ç®€æ"></a>æ ¸å¿ƒæ³¨è§£ç®€æ</h2><h3 id="EnableCaching"><a href="#EnableCaching" class="headerlink" title="@EnableCaching"></a>@EnableCaching</h3><blockquote>
<p>ä½œç”¨åœ¨é¡¹ç›®å¯åŠ¨ç±»æˆ–è€…æŸä¸ªé…ç½®ç±»ä¸Šä½¿ç”¨æ­¤æ³¨è§£ï¼Œè¡¨ç¤ºï¼š<strong>å…è®¸ä½¿ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œç¼“å­˜æ“ä½œ</strong></p>
<p>æ³¨æ„ï¼šæ­¤ã€ç±»ã€‘å¿…é¡»æ˜¯Springå®¹å™¨ä¸­çš„ï¼Œå¦åˆ™æ³¨è§£ä¸ä¼šç”Ÿæ•ˆ</p>
</blockquote>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><blockquote>
<p>ä½œç”¨ç›®æ ‡ï¼šç±»æˆ–è€…æ–¹æ³•ä¸Š</p>
<p>ç¼“å­˜æ•ˆæœï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ï¼Œä¼šæ ¹æ®keyå…ˆå»ç¼“å­˜ä¸­æŸ¥è¯¢çœ‹æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰å°±ç›´æ¥<br>                         è¿”å›ç¼“å­˜ä¸­çš„keyå¯¹åº”çš„valueå€¼ã€‚ä¸å†æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼›æ— åˆ™æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œå¹¶å°†æ–¹æ³•çš„è¿”å›å€¼<br>                         ä½œä¸ºvalueï¼Œå¹¶ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å…¥ç¼“å­˜</p>
</blockquote>
<h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><blockquote>
<p>ä½œç”¨ç›®æ ‡ï¼šç±»æˆ–è€…æ–¹æ³•ä¸Š</p>
<p>ç¼“å­˜æ•ˆæœï¼šè§¦å‘ç¼“å­˜æ›´æ–°æ“ä½œï¼Œæ·»åŠ è¯¥æ³¨è§£åæ€»æ˜¯ä¼šæ‰§è¡Œæ–¹æ³•ä½“ï¼Œå¹¶ä¸”ä½¿ç”¨è¿”å›çš„ç»“æœæ›´æ–°ç¼“å­˜</p>
</blockquote>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><blockquote>
<p>ä½œç”¨ç›®æ ‡ï¼šç±»æˆ–è€…æ–¹æ³•ä¸Š</p>
<p>ç¼“å­˜æ•ˆæœï¼šåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•åï¼Œæ¸…é™¤ç¼“å­˜ä¸­å¯¹åº”keyçš„æ•°æ®(å¦‚æœç¼“å­˜ä¸­æœ‰å¯¹åº”keyçš„æ•°æ®ç¼“å­˜çš„è¯)</p>
</blockquote>
<h3 id="CacheConfig"><a href="#CacheConfig" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h3><blockquote>
<p>ä½œç”¨ç›®æ ‡ï¼šä¸€èˆ¬ä½œç”¨ä¸ç±»ä¸Š</p>
<p>æ•ˆæœï¼š@Cacheableã€@CacheEvictã€@CachePutè¿™ä¸‰ä¸ªæ³¨è§£çš„cacheNameså±æ€§æ˜¯å¿… å¡«é¡¹(æˆ–valueå±æ€§æ˜¯å¿…å¡«é¡¹,å› ä¸ºvalueå±æ€§æ˜¯cacheNamesçš„åˆ«åå±æ€§)ï¼›å¦‚æœä¸Šè¿°ä¸‰ç§æ³¨è§£éƒ½ç”¨çš„æ˜¯åŒä¸€ä¸ªcacheNamesçš„è¯ï¼Œé‚£ä¹ˆåœ¨æ¯æ­¤éƒ½å†™cacheNamesçš„è¯ï¼Œå°±ä¼šæ˜¾å¾—éº»çƒ¦ã€‚å¦‚å°†@CacheConfigæ³¨è§£å°±æ˜¯æ¥é…ç½®ä¸€äº›å…¬å…±å±æ€§(å¦‚ï¼šcacheNamesï¼ŒkeyGeneratorç­‰)çš„å€¼ã€‚</p>
</blockquote>
<p>ä¸»è¦å±æ€§ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>ç¼“å­˜çš„åç§°ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªï¼Œç›¸å½“äºnacosé…ç½®ä¸­çš„å‘½åç©ºé—´ï¼ˆä¸åŒçš„valueä¸­ï¼Œå¯ä»¥æœ‰ç›¸åŒçš„keyï¼‰</td>
</tr>
<tr>
<td>key</td>
<td>ç¼“å­˜çš„keyå€¼ï¼Œåˆ†ä¸ºä¸‰ç±»ï¼šé»˜è®¤çš„ã€keyGeneratorç”Ÿæˆçš„ã€ä¸»åŠ¨æŒ‡å®šçš„</td>
</tr>
<tr>
<td>condition</td>
<td>åœ¨æ¿€æ´»æ³¨è§£åŠŸèƒ½å‰ï¼Œè¿›è¡ŒconditionéªŒè¯ï¼Œå¦‚æœconditionç»“æœä¸ºtrueï¼Œåˆ™è¡¨æ˜éªŒè¯é€šè¿‡ï¼Œç¼“å­˜æ³¨è§£ç”Ÿæ•ˆï¼›å¦åˆ™ç¼“å­˜æ³¨è§£ä¸ç”Ÿæ•ˆ</td>
</tr>
<tr>
<td>unless</td>
<td>æ˜¯å¦ä»¤æ³¨è§£ï¼ˆåœ¨æ–¹æ³•æ‰§è¡Œåçš„åŠŸèƒ½ï¼‰ä¸ç”Ÿæ•ˆï¼›è‹¥unlessçš„ç»“æœä¸ºtrueï¼Œåˆ™(æ–¹æ³•æ‰§è¡Œåçš„åŠŸèƒ½)ä¸ç”Ÿæ•ˆï¼›è‹¥unlessçš„ç»“æœä¸ºfalseï¼Œåˆ™(æ–¹æ³•æ‰§è¡Œåçš„)åŠŸèƒ½ç”Ÿæ•ˆ</td>
</tr>
</tbody>
</table>
</div>
<h2 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h2><blockquote>
<p>æ³¨æ„ key çš„å®é™…å†™æ³•ï¼Œéœ€è¦ç”¨<code>å•å¼•å·</code>åŒ…è£¹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¦–é¡µæ¨èåˆ—è¡¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Cacheable(value = "index",key = "'recommend'")</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Blog&gt; <span class="title">queryRecommendList</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;Blog&gt;()</span><br><span class="line">            .select(Blog::getId, Blog::getTitle, Blog::getViews)</span><br><span class="line">            .eq(Blog::getRecommend, <span class="keyword">true</span>)</span><br><span class="line">            .orderByDesc(Blog::getViews)</span><br><span class="line">            .last(<span class="string">"LIMIT 10"</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åšå®¢é¦–é¡µè½®æ’­å›¾æ•°æ®(æ–‡ç« æµè§ˆé‡çš„å‰6å)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Cacheable(value = "index",key = "'bigCollapse'")</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;IndexCollapseInfo&gt; <span class="title">queryIndexCollapse</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> baseMapper.queryIndexCollapse();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Redis</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ ¹æ®Mavenä¸­Profilesæ ‡ç­¾åŠ¨æ€é…ç½®ç¼–è¯‘é€‰é¡¹</title>
    <url>/post/11669.html</url>
    <content><![CDATA[<h2 id="SpringBootæ ¹æ®Mavenä¸­Profilesæ ‡ç­¾åŠ¨æ€é…ç½®ç¼–è¯‘é€‰é¡¹"><a href="#SpringBootæ ¹æ®Mavenä¸­Profilesæ ‡ç­¾åŠ¨æ€é…ç½®ç¼–è¯‘é€‰é¡¹" class="headerlink" title="SpringBootæ ¹æ®Mavenä¸­Profilesæ ‡ç­¾åŠ¨æ€é…ç½®ç¼–è¯‘é€‰é¡¹"></a>SpringBootæ ¹æ®Mavenä¸­Profilesæ ‡ç­¾åŠ¨æ€é…ç½®ç¼–è¯‘é€‰é¡¹</h2><h3 id="Profileç®€ä»‹"><a href="#Profileç®€ä»‹" class="headerlink" title="Profileç®€ä»‹"></a>Profileç®€ä»‹</h3><blockquote>
<p>profileå¯ä»¥è®©æˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åæŒ‡å®šå…¶æ¿€æ´»æ¡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰å¤šä¸ªprofileï¼Œç„¶åæ¯ä¸ªprofileå¯¹åº”ä¸åŒçš„æ¿€æ´»æ¡ä»¶å’Œé…ç½®ä¿¡æ¯ï¼Œä»è€Œè¾¾åˆ°ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®ä¿¡æ¯çš„æ•ˆæœã€‚</p>
</blockquote>
<h4 id="pomæ–‡ä»¶é…ç½®"><a href="#pomæ–‡ä»¶é…ç½®" class="headerlink" title="pomæ–‡ä»¶é…ç½®"></a>pomæ–‡ä»¶é…ç½®</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--å¦‚æœä¸è®¾ç½®resource ä¼šå¯¼è‡´application.yamlä¸­çš„@@ç¬¦å·æ‰¾ä¸åˆ°pomæ–‡ä»¶ä¸­çš„é…ç½®--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--å¦‚æœä¸è®¾ç½®resource ä¼šå¯¼è‡´application.yamlä¸­çš„@@ç¬¦å·æ‰¾ä¸åˆ°pomæ–‡ä»¶ä¸­çš„é…ç½®--&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--å¼€å‘ç¯å¢ƒ--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- ç¯å¢ƒé…ç½®å”¯ä¸€æ ‡è¯† --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- ä»¥ä¸‹å…¨éƒ¨æ˜¯è‡ªå®šä¹‰å±æ€§é…ç½®ï¼Œæ ‡ç­¾åéšä¾¿å†™ï¼Œä½†æœ€å¥½è§åçŸ¥ä¹‰--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">profileActive</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">profileActive</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--å„å¾®æœåŠ¡æ¨¡å—ç«¯å£å·--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">gateWay.port</span>&gt;</span>9001<span class="tag">&lt;/<span class="name">gateWay.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">blog.port</span>&gt;</span>8110<span class="tag">&lt;/<span class="name">blog.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">oss.port</span>&gt;</span>8120<span class="tag">&lt;/<span class="name">oss.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">sms.port</span>&gt;</span>8130<span class="tag">&lt;/<span class="name">sms.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.port</span>&gt;</span>8140<span class="tag">&lt;/<span class="name">mongo.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">elastic.port</span>&gt;</span>8150<span class="tag">&lt;/<span class="name">elastic.port</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--å„å¾®æœåŠ¡æ¨¡å—åç§°--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">gateWay.name</span>&gt;</span>service-gateway<span class="tag">&lt;/<span class="name">gateWay.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">blog.name</span>&gt;</span>service-blog<span class="tag">&lt;/<span class="name">blog.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">oss.name</span>&gt;</span>service-oss<span class="tag">&lt;/<span class="name">oss.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">sms.name</span>&gt;</span>service-sms<span class="tag">&lt;/<span class="name">sms.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.name</span>&gt;</span>service-mongo<span class="tag">&lt;/<span class="name">mongo.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">elastic.name</span>&gt;</span>service-elastic<span class="tag">&lt;/<span class="name">elastic.name</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  MySQLä¿¡æ¯  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.port</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">db.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.url</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">db.url</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.username</span>&gt;</span>root<span class="tag">&lt;/<span class="name">db.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">db.password</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.databaseName</span>&gt;</span>horse_vue_blog<span class="tag">&lt;/<span class="name">db.databaseName</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  redisä¿¡æ¯  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.port</span>&gt;</span>6379<span class="tag">&lt;/<span class="name">redis.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.host</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">redis.host</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.database</span>&gt;</span>1<span class="tag">&lt;/<span class="name">redis.database</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">redis.password</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  MongoDBä¿¡æ¯--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.port</span>&gt;</span>27017<span class="tag">&lt;/<span class="name">mongo.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.host</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">mongo.host</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.database</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">mongo.database</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.username</span>&gt;</span>root<span class="tag">&lt;/<span class="name">mongo.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">mongo.password</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--nacosä¿¡æ¯--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.addr</span>&gt;</span>121.5.168.31:8848<span class="tag">&lt;/<span class="name">nacos.addr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.username</span>&gt;</span>nacos<span class="tag">&lt;/<span class="name">nacos.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">nacos.password</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.file-extension</span>&gt;</span>yml<span class="tag">&lt;/<span class="name">nacos.file-extension</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--ElasticSearchä¿¡æ¯--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">elasticsearch.host</span>&gt;</span>192.168.71.129<span class="tag">&lt;/<span class="name">elasticsearch.host</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">elasticsearch.port</span>&gt;</span>9200<span class="tag">&lt;/<span class="name">elasticsearch.port</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--è®¾ç½®ä¸º é»˜è®¤æ¿€æ´»æ­¤id=devçš„é…ç½®ä¿¡æ¯--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>pro<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--æ¿€æ´»ç¯å¢ƒ--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">profileActive</span>&gt;</span>pro<span class="tag">&lt;/<span class="name">profileActive</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--å„å¾®æœåŠ¡æ¨¡å—ç«¯å£å·--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">gateWay.port</span>&gt;</span>9001<span class="tag">&lt;/<span class="name">gateWay.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">blog.port</span>&gt;</span>8110<span class="tag">&lt;/<span class="name">blog.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">oss.port</span>&gt;</span>8120<span class="tag">&lt;/<span class="name">oss.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">sms.port</span>&gt;</span>8130<span class="tag">&lt;/<span class="name">sms.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.port</span>&gt;</span>8140<span class="tag">&lt;/<span class="name">mongo.port</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--å„å¾®æœåŠ¡æ¨¡å—åç§°--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">gateWay.name</span>&gt;</span>service-gateway<span class="tag">&lt;/<span class="name">gateWay.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">blog.name</span>&gt;</span>service-blog<span class="tag">&lt;/<span class="name">blog.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">oss.name</span>&gt;</span>service-oss<span class="tag">&lt;/<span class="name">oss.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">sms.name</span>&gt;</span>service-sms<span class="tag">&lt;/<span class="name">sms.name</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.name</span>&gt;</span>service-mongo<span class="tag">&lt;/<span class="name">mongo.name</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  MySQLä¿¡æ¯  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.port</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">db.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.url</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">db.url</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.username</span>&gt;</span>root<span class="tag">&lt;/<span class="name">db.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">db.password</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">db.databaseName</span>&gt;</span>horse_vue_blog<span class="tag">&lt;/<span class="name">db.databaseName</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  redisä¿¡æ¯  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.port</span>&gt;</span>6379<span class="tag">&lt;/<span class="name">redis.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.host</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">redis.host</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.database</span>&gt;</span>1<span class="tag">&lt;/<span class="name">redis.database</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">redis.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">redis.password</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--  MongoDBä¿¡æ¯--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.port</span>&gt;</span>27017<span class="tag">&lt;/<span class="name">mongo.port</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.host</span>&gt;</span>121.5.168.31<span class="tag">&lt;/<span class="name">mongo.host</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.database</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">mongo.database</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.username</span>&gt;</span>root<span class="tag">&lt;/<span class="name">mongo.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mongo.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">mongo.password</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--nacosä¿¡æ¯--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.addr</span>&gt;</span>121.5.168.31:8848<span class="tag">&lt;/<span class="name">nacos.addr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.username</span>&gt;</span>nacos<span class="tag">&lt;/<span class="name">nacos.username</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">nacos.password</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">nacos.file-extension</span>&gt;</span>yml<span class="tag">&lt;/<span class="name">nacos.file-extension</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¼•ç”¨é…ç½®ç¤ºä¾‹"><a href="#å¼•ç”¨é…ç½®ç¤ºä¾‹" class="headerlink" title="å¼•ç”¨é…ç½®ç¤ºä¾‹"></a>å¼•ç”¨é…ç½®ç¤ºä¾‹</h4><blockquote>
<p>æ³¨æ„ï¼šnacosè¿œç¨‹é…ç½®ä¸­å¿ƒçš„yamlæ–‡ä»¶ï¼Œä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œæ— æ³•è¯»å–åˆ°å€¼ã€‚</p>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">@blog.port@</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">@blog.name@</span> <span class="comment"># æœåŠ¡å</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">@profileActive@</span> <span class="comment"># æ¿€æ´»ç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">@nacos.addr@</span> <span class="comment"># æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span>  <span class="comment"># é…ç½®ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">@nacos.addr@</span> <span class="comment"># é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">@nacos.file-extension@</span>    <span class="comment"># é…ç½®æ–‡ä»¶åç¼€(å’Œnacoså®¢æˆ·ç«¯ä¿æŒä¸€è‡´)</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">c0df1ff6-5f81-4f88-a41b-d23d2075f354</span>  <span class="comment"># å‘½åç©ºé—´id</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">HORSE_VUE_BLOG_DEV</span>  <span class="comment"># åˆ†ç»„åç§°</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">@nacos.username@</span>  <span class="comment"># ç™»å½•nacoså®¢æˆ·ç«¯çš„ç”¨æˆ·å</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">@nacos.password@</span>  <span class="comment">#  ç™»å½•nacoså®¢æˆ·ç«¯çš„å¯†ç </span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="IDEAçš„å¯è§†åŒ–ç•Œé¢"><a href="#IDEAçš„å¯è§†åŒ–ç•Œé¢" class="headerlink" title="IDEAçš„å¯è§†åŒ–ç•Œé¢"></a>IDEAçš„å¯è§†åŒ–ç•Œé¢</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210622204000.png" alt="æ‰‹åŠ¨åˆ‡æ¢ç¯å¢ƒé…ç½®"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootç®€å•å®ç°PDFæ–‡ä»¶å¯¼å‡º</title>
    <url>/post/31520.html</url>
    <content><![CDATA[<h2 id="SpringBootç®€å•å®ç°PDFæ–‡ä»¶å¯¼å‡º"><a href="#SpringBootç®€å•å®ç°PDFæ–‡ä»¶å¯¼å‡º" class="headerlink" title="SpringBootç®€å•å®ç°PDFæ–‡ä»¶å¯¼å‡º"></a>SpringBootç®€å•å®ç°PDFæ–‡ä»¶å¯¼å‡º</h2><h3 id="å¼•å…¥pom"><a href="#å¼•å…¥pom" class="headerlink" title="å¼•å…¥pom"></a>å¼•å…¥pom</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--itext pdf--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itextpdf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>itextpdf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itextpdf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>itext-asian<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å‚æ•°é…ç½®"><a href="#å‚æ•°é…ç½®" class="headerlink" title="å‚æ•°é…ç½®"></a>å‚æ•°é…ç½®</h3><blockquote>
<p>ç”Ÿäº§ç¯å¢ƒçš„æ–‡ä»¶è·¯å¾„ï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p>
</blockquote>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># pdfæ–‡ä»¶å¯¼å‡ºè·¯å¾„</span></span><br><span class="line"><span class="attr">report:</span></span><br><span class="line">  <span class="attr">pdf:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">D:/file/pdf/</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä¸Šå¹²è´§"><a href="#ä¸Šå¹²è´§" class="headerlink" title="ä¸Šå¹²è´§"></a>ä¸Šå¹²è´§</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: PDFæ–‡ä»¶å¯¼å‡ºå¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/26 16:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PdfReportHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${report.pdf.path}")</span></span><br><span class="line">    <span class="keyword">private</span> String reportPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å‡ºç™»å½•æ—¥å¿—PDFæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logs     æ—¥å¿—æ•°æ®é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">pdfLoginLogReport</span><span class="params">(List&lt;LoginLog&gt; logs, String fileName)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è®¾ç½®æ–‡ä»¶ç”Ÿæˆä½ç½®(æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»º)</span></span><br><span class="line">            FileUtil.mkdir(<span class="keyword">new</span> File(reportPath));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®æ–‡ä»¶ç»å¯¹è·¯å¾„</span></span><br><span class="line">            String realPath = reportPath.concat(fileName).concat(<span class="string">".pdf"</span>);</span><br><span class="line">            <span class="comment">// åˆ›å»ºè¾“å‡ºæµ</span></span><br><span class="line">            FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(realPath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ›å»ºå­—ä½“</span></span><br><span class="line">            BaseFont bf = BaseFont.createFont(<span class="string">"STSong-Light"</span>, <span class="string">"UniGB-UCS2-H"</span>, BaseFont.NOT_EMBEDDED);</span><br><span class="line">            Font contentFont = <span class="keyword">new</span> Font(bf, <span class="number">12</span>);</span><br><span class="line">            Font headFont = <span class="keyword">new</span> Font(bf, <span class="number">14</span>, Font.BOLD);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®æ–‡æ¡£è§„æ ¼å’Œé¡µé¢å¸ƒå±€å‚æ•°,é¡µé¢èƒŒæ™¯è‰²</span></span><br><span class="line">            Rectangle rect = <span class="keyword">new</span> Rectangle(PageSize.A4);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// rect.setBackgroundColor(BaseColor.GRAY);</span></span><br><span class="line"></span><br><span class="line">            Document document = <span class="keyword">new</span> Document(rect, <span class="number">2.5f</span>, <span class="number">2.5f</span>, <span class="number">2.5f</span>, <span class="number">2.5f</span>);</span><br><span class="line">            PdfWriter writer = PdfWriter.getInstance(document, outputStream);</span><br><span class="line">            <span class="comment">// PDFç‰ˆæœ¬</span></span><br><span class="line">            writer.setPdfVersion(PdfWriter.PDF_VERSION_1_7);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ–‡æ¡£åŠ å¯†: ä½¿ç”¨ä¸¤ä¸ªå¯†ç å‡å¯ä»¥æ‰“å¼€æ–‡ä»¶,ä½†æ˜¯ä½¿ç”¨ "horse" æ‰“å¼€æ–‡ä»¶åªå…·æœ‰æœ‰é™çš„åŠŸèƒ½(ä¸å¸¸ç”¨)</span></span><br><span class="line">            <span class="comment">// writer.setEncryption("horse".getBytes(), "horse123".getBytes(), PdfWriter.ALLOW_SCREENREADERS, PdfWriter.ENCRYPTION_AES_128);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ–‡æ¡£å±æ€§</span></span><br><span class="line">            document.addTitle(<span class="string">"Login log title"</span>);</span><br><span class="line">            document.addSubject(<span class="string">"Login log subject title"</span>);</span><br><span class="line">            document.addAuthor(<span class="string">"Mr.Horse"</span>);</span><br><span class="line">            document.addCreationDate();</span><br><span class="line"></span><br><span class="line">            document.open();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®è¡¨æ ¼æ ¼å¼å†…å®¹(è°ƒç”¨ç­¾åˆ¤ç©º)</span></span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ª 8 åˆ—çš„è¡¨æ ¼</span></span><br><span class="line">            PdfPTable table = <span class="keyword">new</span> PdfPTable(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(fileName, headFont));</span><br><span class="line">            <span class="comment">// å å‡ è¡Œå‡ åˆ—</span></span><br><span class="line">            cell.setRowspan(<span class="number">3</span>);</span><br><span class="line">            cell.setColspan(<span class="number">8</span>);</span><br><span class="line">            <span class="comment">// æ°´å¹³å‚ç›´å±…ä¸­</span></span><br><span class="line">            cell.setVerticalAlignment(Element.ALIGN_MIDDLE);</span><br><span class="line">            cell.setHorizontalAlignment(Element.ALIGN_CENTER);</span><br><span class="line">            <span class="comment">// å›ºå®šè¡Œé«˜</span></span><br><span class="line">            cell.setFixedHeight(<span class="number">25</span>);</span><br><span class="line">            table.addCell(cell);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç¬¬äºŒè¡Œè¡¨å¤´è®¾ç½®</span></span><br><span class="line">            PdfPCell cell1 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"ç™»å½•ç”¨æˆ·"</span>, contentFont));</span><br><span class="line">            setStyle(cell1);</span><br><span class="line">            table.addCell(cell1);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell2 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"ç”¨æˆ·è¡Œä¸º"</span>, contentFont));</span><br><span class="line">            setStyle(cell2);</span><br><span class="line">            table.addCell(cell2);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell3 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"IPåœ°å€"</span>, contentFont));</span><br><span class="line">            setStyle(cell3);</span><br><span class="line">            table.addCell(cell3);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell5 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"ç³»ç»ŸOS"</span>, contentFont));</span><br><span class="line">            setStyle(cell5);</span><br><span class="line">            table.addCell(cell5);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell6 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"æµè§ˆå™¨OS"</span>, contentFont));</span><br><span class="line">            setStyle(cell6);</span><br><span class="line">            table.addCell(cell6);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell7 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"çŠ¶æ€"</span>, contentFont));</span><br><span class="line">            setStyle(cell7);</span><br><span class="line">            table.addCell(cell7);</span><br><span class="line"></span><br><span class="line">            PdfPCell cell8 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(<span class="string">"æ“ä½œæ—¶é—´"</span>, contentFont));</span><br><span class="line">            cell8.setRowspan(<span class="number">2</span>);</span><br><span class="line">            cell8.setColspan(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">this</span>.setCommonStyle(cell8);</span><br><span class="line">            table.addCell(cell8);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®è¡¨æ ¼å†…å®¹</span></span><br><span class="line">            <span class="keyword">int</span> size = logs.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) {</span><br><span class="line">                LoginLog log = logs.get(i);</span><br><span class="line"></span><br><span class="line">                PdfPCell cell_1 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(log.getUsername(), contentFont));</span><br><span class="line">                setContentStyle(cell_1);</span><br><span class="line">                table.addCell(cell_1);</span><br><span class="line">                PdfPCell cell_2 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(BlogConstants.LOGIN.equals(log.getOperType()) ? <span class="string">"ç™»å½•"</span> : <span class="string">"é€€å‡º"</span>, contentFont));</span><br><span class="line">                setContentStyle(cell_2);</span><br><span class="line">                table.addCell(cell_2);</span><br><span class="line">                PdfPCell cell_3 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(log.getLoginIp(), contentFont));</span><br><span class="line">                setContentStyle(cell_3);</span><br><span class="line">                table.addCell(cell_3);</span><br><span class="line">                PdfPCell cell_4 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(log.getLoginComputerOs(), contentFont));</span><br><span class="line">                setContentStyle(cell_4);</span><br><span class="line">                table.addCell(cell_4);</span><br><span class="line">                PdfPCell cell_5 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(log.getLoginBrowser(), contentFont));</span><br><span class="line">                setContentStyle(cell_5);</span><br><span class="line">                table.addCell(cell_5);</span><br><span class="line">                PdfPCell cell_6 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(log.getSuccess() ? <span class="string">"æˆåŠŸ"</span> : <span class="string">"å¤±è´¥"</span>, contentFont));</span><br><span class="line">                setContentStyle(cell_6);</span><br><span class="line">                table.addCell(cell_6);</span><br><span class="line">                PdfPCell cell_7 = <span class="keyword">new</span> PdfPCell(<span class="keyword">new</span> Phrase(DateUtil.format(log.getGmtCreate(), DatePattern.NORM_DATETIME_PATTERN), contentFont));</span><br><span class="line">                <span class="comment">// å å‡ åˆ—</span></span><br><span class="line">                cell_7.setColspan(<span class="number">2</span>);</span><br><span class="line">                <span class="comment">// æ°´å¹³å‚ç›´å±…ä¸­</span></span><br><span class="line">                <span class="keyword">this</span>.setCommonStyle(cell_7);</span><br><span class="line">                table.addCell(cell_7);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//  æ·»åŠ è¡¨æ ¼</span></span><br><span class="line">            document.add(table);</span><br><span class="line">            document.close();</span><br><span class="line">            log.info(<span class="string">" ==&gt; pdfæ–‡ä»¶å¯¼å‡ºæˆåŠŸ,æ–‡ä»¶è·¯å¾„: {}"</span>, realPath);</span><br><span class="line">            <span class="keyword">return</span> realPath;</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">" ==&gt; pdfæ–‡ä»¶å¯¼å‡ºå¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.EXCEL_DATA_EXPORT_ERROR);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é¡µé¢æ–‡å­—æ°´å°(æš‚æœªç”Ÿæ•ˆ,ä¸å¤ªç†è§£)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> realPath     PDFæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream PDFæ–°çš„è¾“å‡ºæµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> waterMark    æ°´å°æ–‡å­—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> DocumentException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setPageTextWatermark</span><span class="params">(String realPath, FileOutputStream outputStream, String waterMark)</span> <span class="keyword">throws</span> IOException, DocumentException </span>{</span><br><span class="line">        <span class="comment">// é‡æ–°è¯»å–ç”Ÿæˆçš„pdfæ–‡ä»¶,è®¾ç½®æ°´å°å,å†é‡æ–°å¯¼å‡ºpdf</span></span><br><span class="line">        PdfReader reader = <span class="keyword">new</span> PdfReader(realPath);</span><br><span class="line">        PdfStamper stamper = <span class="keyword">new</span> PdfStamper(reader, outputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æ–‡å­—æ°´å°</span></span><br><span class="line">        PdfContentByte over = stamper.getOverContent(<span class="number">1</span>);</span><br><span class="line">        over.beginText();</span><br><span class="line">        BaseFont overBf = BaseFont.createFont(BaseFont.HELVETICA, BaseFont.WINANSI,</span><br><span class="line">                BaseFont.EMBEDDED);</span><br><span class="line">        over.setFontAndSize(overBf, <span class="number">26</span>);</span><br><span class="line">        over.setTextMatrix(<span class="number">30f</span>, <span class="number">30f</span>);</span><br><span class="line">        over.showTextAligned(Element.ALIGN_LEFT, waterMark, <span class="number">230</span>, <span class="number">430</span>, <span class="number">45</span>);</span><br><span class="line">        over.endText();</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å¤´éƒ¨æ ‡é¢˜å•å…ƒæ ¼æ ¼å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setStyle</span><span class="params">(PdfPCell cell)</span> </span>{</span><br><span class="line">        <span class="comment">// å å‡ è¡Œå‡ åˆ—</span></span><br><span class="line">        cell.setRowspan(<span class="number">2</span>);</span><br><span class="line">        cell.setColspan(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">this</span>.setCommonStyle(cell);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å†…å®¹å•å…ƒæ ¼æ ¼å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setContentStyle</span><span class="params">(PdfPCell cell)</span> </span>{</span><br><span class="line">        <span class="comment">// å å‡ åˆ—</span></span><br><span class="line">        cell.setColspan(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">this</span>.setCommonStyle(cell);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é€šç”¨å•å…ƒæ ¼æ ¼å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setCommonStyle</span><span class="params">(PdfPCell cell)</span> </span>{</span><br><span class="line">        <span class="comment">// æ°´å¹³å‚ç›´å±…ä¸­</span></span><br><span class="line">        cell.setVerticalAlignment(Element.ALIGN_CENTER);</span><br><span class="line">        cell.setHorizontalAlignment(Element.ALIGN_CENTER);</span><br><span class="line">        <span class="comment">// å›ºå®šè¡Œé«˜</span></span><br><span class="line">        cell.setFixedHeight(<span class="number">20</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://i.loli.net/2021/05/24/uSjR24PvBDkomGg.gif" alt="ç‡¥èµ·æ¥"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>PDF</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootè‡ªå®šä¹‰æ³¨è§£</title>
    <url>/post/11863.html</url>
    <content><![CDATA[<h2 id="SpringBootè‡ªå®šä¹‰æ³¨è§£"><a href="#SpringBootè‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="SpringBootè‡ªå®šä¹‰æ³¨è§£"></a>SpringBootè‡ªå®šä¹‰æ³¨è§£</h2><blockquote>
<p>ä¸»è¦æ˜¯è¦å­¦ä¼šå¹¶ç†è§£æ³¨è§£å¯¹è±¡ä¸­çš„å‡ ä¸ªæ³¨è§£çš„å«ä¹‰</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target({ElementType.METHOD, ElementType.TYPE})</span>  <span class="comment">// æ³¨è§£æ”¾ç½®çš„ç›®æ ‡ä½ç½®</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>  <span class="comment">// æ³¨è§£åœ¨å“ªä¸ªé˜¶æ®µæ‰§è¡Œ</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> OperatingLog {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ“ä½œç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">operType</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ“ä½œæè¿°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">operDesc</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h3><blockquote>
<p>æ³¨è§£çš„ä½œç”¨ç›®æ ‡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span>â€”â€”æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£</span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span>â€”â€”å­—æ®µã€æšä¸¾çš„å¸¸é‡</span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span>â€”â€”æ–¹æ³•</span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span>â€”â€”æ–¹æ³•å‚æ•°</span><br><span class="line"><span class="meta">@Target(ElementType.CONSTRUCTOR)</span>&nbsp;â€”â€”æ„é€ å‡½æ•°</span><br><span class="line"><span class="meta">@Target(ElementType.LOCAL_VARIABLE)</span>â€”â€”å±€éƒ¨å˜é‡</span><br><span class="line"><span class="meta">@Target(ElementType.ANNOTATION_TYPE)</span>â€”â€”æ³¨è§£</span><br><span class="line"><span class="meta">@Target(ElementType.PACKAGE)</span>â€”â€”åŒ…</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h3><blockquote>
<p>æ³¨è§£çš„ä¿ç•™ä½ç½®</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">RetentionPolicy.SOURCE:è¿™ç§ç±»å‹çš„Annotationsåªåœ¨æºä»£ç çº§åˆ«ä¿ç•™,ç¼–è¯‘æ—¶å°±ä¼šè¢«å¿½ç•¥,åœ¨<span class="class"><span class="keyword">class</span>å­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒ…å«ã€‚</span></span><br><span class="line">RetentionPolicy.CLASS:è¿™ç§ç±»å‹çš„Annotationsç¼–è¯‘æ—¶è¢«ä¿ç•™,é»˜è®¤çš„ä¿ç•™ç­–ç•¥,åœ¨classæ–‡ä»¶ä¸­å­˜åœ¨,ä½†JVMå°†ä¼šå¿½ç•¥,è¿è¡Œæ—¶æ— æ³•è·å¾—ã€‚</span><br><span class="line">RetentionPolicy.RUNTIME:è¿™ç§ç±»å‹çš„Annotationså°†è¢«JVMä¿ç•™,æ‰€ä»¥ä»–ä»¬èƒ½åœ¨è¿è¡Œæ—¶è¢«JVMæˆ–å…¶ä»–ä½¿ç”¨åå°„æœºåˆ¶çš„ä»£ç æ‰€è¯»å–å’Œä½¿ç”¨ã€‚(ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨è¿™ç§ç±»å‹)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Document"><a href="#Document" class="headerlink" title="@Document"></a>@Document</h3><blockquote>
<p>è¯´æ˜è¯¥æ³¨è§£å°†è¢«åŒ…å«åœ¨<code>javadoc</code>ä¸­,ä¹Ÿå°±æ˜¯é¼ æ ‡æ”¾ä¸Šå»å‡ºç°çš„è§£é‡Šè¯´æ˜ä¸­</p>
</blockquote>
<h3 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h3><blockquote>
<p>è¯´æ˜å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„è¯¥æ³¨è§£ ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰</p>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Annotation</tag>
      </tags>
  </entry>
  <entry>
    <title>Springbootæ•´åˆShiro(MD5ç›å€¼åŠ å¯†)</title>
    <url>/post/49746.html</url>
    <content><![CDATA[<h2 id="Springbootæ•´åˆShiro-MD5ç›å€¼åŠ å¯†"><a href="#Springbootæ•´åˆShiro-MD5ç›å€¼åŠ å¯†" class="headerlink" title="Springbootæ•´åˆShiro(MD5ç›å€¼åŠ å¯†)"></a>Springbootæ•´åˆShiro(MD5ç›å€¼åŠ å¯†)</h2><ol>
<li>å¼•å…¥pomä¾èµ–<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--shiro--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--å¼•å…¥thymeleafå’Œshiroæ•´åˆçš„éƒ¨åˆ†ä¾èµ–--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--shiroæ•´åˆehcacheç¼“å­˜(å’Œå¯åŠ¨å™¨ä¸­çš„åŒåä¾èµ–ä¸ä¸€æ ·)--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>ç¼–å†™é…ç½®ç±»MyShiroConfig<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">		<span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯†ç åŒ¹é…å‡­è¯ç®¡ç†å™¨ï¼ˆshiroçš„å†…ç½®MD5+saltç›å€¼åŠ å¯†ï¼‰</span></span><br><span class="line"><span class="comment">     * MD5ç®—æ³•ï¼šç®—æ³•ä¸å¯é€†ï¼Œå¦‚æœå†…å®¹ç›¸åŒï¼Œæ— è®ºåšå¤šå°‘æ¬¡MD5ç®—æ³•ç”Ÿæˆçš„ç»“æœå§‹ç»ˆä¸€è‡´ï¼Œå¤šç”¨äºåŠ å¯†å’Œç­¾åæ ¡éªŒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "hashedCredentialsMatcher")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span> </span>{</span><br><span class="line">        HashedCredentialsMatcher credentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">        <span class="comment">//æŒ‡å®šåŠ å¯†æ–¹å¼</span></span><br><span class="line">        credentialsMatcher.setHashAlgorithmName(<span class="string">"MD5"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®åŠ å¯†æ¬¡æ•°</span></span><br><span class="line">        credentialsMatcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®ç¼–ç æ–¹å¼ï¼štrue:hexç¼–ç ï¼Œfalse:base64ç¼–ç </span></span><br><span class="line">        credentialsMatcher.setStoredCredentialsHexEncoded(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> credentialsMatcher;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜ç®¡ç†å™¨ï¼ˆæœ€ç®€å•çš„ï¼Œå…¨éƒ¨æŒ‰ç…§é»˜è®¤é…ç½®ï¼Œæ²¡æœ‰åšè‡ªå®šä¹‰çš„ä¸€äº›ç¼“å­˜é€»è¾‘ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "ehCacheManager")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EhCacheManager <span class="title">ehCacheManager</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EhCacheManager();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè‡ªå®šä¹‰realm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashedCredentialsMatcher</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "myShiroRealm")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyShiroRealm <span class="title">myShiroRealm</span><span class="params">(<span class="meta">@Qualifier("hashedCredentialsMatcher")</span> HashedCredentialsMatcher hashedCredentialsMatcher,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@Qualifier("ehCacheManager")</span> EhCacheManager ehCacheManager)</span> </span>{</span><br><span class="line">        MyShiroRealm myShiroRealm = <span class="keyword">new</span> MyShiroRealm();</span><br><span class="line">        <span class="comment">//è®¾ç½®å¯†ç æ ¡éªŒåŒ¹é…å™¨</span></span><br><span class="line">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher);</span><br><span class="line">        <span class="comment">//å¼€å¯shiroçš„ç¼“å­˜ç®¡ç†:å¼€å¯ä¹‹åï¼Œå½“é¡µé¢é‡åˆ°æˆæƒçš„æ ¡éªŒæ—¶ï¼Œå°±ä¸ä¼šå†èµ°ä¸€éMyShiroRealmä¸­çš„æˆæƒæ–¹æ³•ï¼Œå¦åˆ™æ¯æ¬¡éƒ½è¦èµ°ï¼Œè€—è´¹èµ„æº</span></span><br><span class="line">        myShiroRealm.setCacheManager(ehCacheManager);</span><br><span class="line">        myShiroRealm.setCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//ä¸‹é¢çš„å†™ä¸å†™éƒ½è¡Œï¼ˆä¸»è¦ç”¨äºä¸shiro-ehcache.xmlé…ç½®æ–‡ä»¶æ­é…ï¼‰</span></span><br><span class="line">        myShiroRealm.setAuthenticationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        myShiroRealm.setAuthenticationCacheName(<span class="string">"authenticationCache"</span>);</span><br><span class="line">        myShiroRealm.setAuthorizationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        myShiroRealm.setAuthorizationCacheName(<span class="string">"authorizationCache"</span>);</span><br><span class="line">        <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> myShiroRealm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "defaultWebSecurityManager")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">defaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier("myShiroRealm")</span> MyShiroRealm myShiroRealm)</span> </span>{</span><br><span class="line">        DefaultWebSecurityManager defaultWebSecurityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">//ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®è‡ªå®šä¹‰realm</span></span><br><span class="line">        defaultWebSecurityManager.setRealm(myShiroRealm);</span><br><span class="line">        <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier("defaultWebSecurityManager")</span> DefaultWebSecurityManager defaultWebSecurityManager)</span> </span>{</span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è®¿é—®(åç»­ä¼šæ·»åŠ ...)</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/login"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/registered"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//å¼‚æ­¥è¯·æ±‚è·¯å¾„éªŒè¯</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/login/checkUser"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/login/checkPass"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/echarts"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//æƒé™æ§åˆ¶æ”¾è¡Œ</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/category"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/tags"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/comments"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/link"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//å¼‚æ­¥è¯·æ±‚å‘é€éªŒè¯ç </span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/code"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//ç®¡ç†å‘˜æƒé™é™å®šï¼ˆåç»­æ·»åŠ æ™®é€šç”¨æˆ·çš„æƒé™é™å®šï¼‰</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/category/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/tags/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/comments/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/link/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        <span class="comment">//é™åˆ¶ç³»ç»Ÿåº”ç”¨è®¿é—®</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/swagger"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/access"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/druid"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/user"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/excel"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/logExcel"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/logs"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æƒé™è®¤è¯è·¯å¾„</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/**"</span>, <span class="string">"authc"</span>);</span><br><span class="line">        bean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="comment">//ç™»å½•é¡µé¢è®¿é—®è·¯å¾„</span></span><br><span class="line">        bean.setLoginUrl(<span class="string">"/admin"</span>);</span><br><span class="line">        <span class="comment">//è®¿é—®å—é™ï¼šæœªæˆæƒè·³è½¬è·¯å¾„</span></span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">"/admin/unauthorized"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•´åˆShiroDialectï¼šé¿å…æ•´åˆthymeleafå’ŒshiroæŠ¥é”™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>ç¼–å†™è®¤è¯æˆæƒè§„åˆ™ç±»MyShiroRealm<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">		<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•æˆæƒï¼ˆåç»­å¢åŠ æƒé™æ§åˆ¶ï¼‰</span></span><br><span class="line"><span class="comment">     * å½“ç”¨æˆ·è®¿é—®éœ€è¦æƒé™æ‰èƒ½è®¿é—®çš„è·¯å¾„æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¸ºç”¨æˆ·è®¾ç½®ç›¸å…³çš„æƒé™ï¼Œè‹¥æƒé™ä¸å¤Ÿï¼Œåˆ™è·³è½¬åˆ°401.htmlé¡µé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principals</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>{</span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰è®¤è¯ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆä»è®¤è¯å“ªé‡Œä¼ é€’è¿‡æ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼‰</span></span><br><span class="line">        User currentUser = (User) principals.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//æˆäºˆå½“å‰ç”¨æˆ·(ç®¡ç†å‘˜)ç›¸å…³æƒé™[user:admin]</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>{</span><br><span class="line">        UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line">        User currentUser = userMapper.selectOne(<span class="keyword">new</span> QueryWrapper&lt;User&gt;().eq(<span class="string">"username"</span>, userToken.getUsername()));</span><br><span class="line">        <span class="comment">//è¿”å›null,shiroä¼šè‡ªåŠ¨å“åº”å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å½“å‰ç”¨æˆ·ä¿¡æ¯å­˜å…¥session(ç”¨äºå‰ç«¯è°ƒç”¨)</span></span><br><span class="line">        SecurityUtils.getSubject().getSession().setAttribute(<span class="string">"loginUser"</span>, currentUser);</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰ç›å€¼(å°†ç”¨æˆ·åä½œä¸ºç›å€¼)</span></span><br><span class="line">        ByteSource salt = ByteSource.Util.bytes(currentUser.getUsername());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * currentUser:å°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ç»™åé¢çš„æˆæƒæ“ä½œ</span></span><br><span class="line"><span class="comment">        * currentUser.getPassword():å¯†ç Shiroæ¡†æ¶è‡ªå·±è®¤è¯,ï¼ˆMyShiroConfigé…ç½®ç±»ä¸­è‡ªå®šä¹‰ä¼ å…¥MD5åŠ å¯†ï¼‰</span></span><br><span class="line"><span class="comment">        * salt:ä¼ å…¥è‡ªå®šä¹‰çš„ç›å€¼</span></span><br><span class="line"><span class="comment">        * this.getRealm():æ­¤è‡ªå®šä¹‰realmçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„æ„ä¹‰</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(currentUser, currentUser.getPassword(), salt, <span class="keyword">this</span>.getName());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>MD5ç›å€¼åŠ å¯†å·¥å…·(utils)<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5ShiroUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”ŸæˆMD5å¯†ç ï¼šç”¨äºç™»å½•éªŒè¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> username:ç”¨äºä½œä¸ºéšå³ç›salt</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5Code</span><span class="params">(String username, String password)</span> </span>{</span><br><span class="line">      String hashAlgorithName = <span class="string">"MD5"</span>;</span><br><span class="line">      <span class="keyword">int</span> hashInteractions = <span class="number">1024</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SimpleHash(hashAlgorithName,password, ByteSource.Util.bytes(username),hashInteractions).toHex();</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure></li>
<li>loginç™»å½•éªŒè¯<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = "/login")</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(<span class="meta">@RequestParam("username")</span> String username,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="meta">@RequestParam("password")</span> String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                      RedirectAttributes redirectAttributes, Model model,</span></span></span><br><span class="line"><span class="function"><span class="params">                      HttpServletRequest request)</span> </span>{</span><br><span class="line">      <span class="comment">/*è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯å¹¶å°è£…*/</span></span><br><span class="line">      UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line">      Subject subject = SecurityUtils.getSubject();</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">          subject.login(token);</span><br><span class="line">          <span class="comment">//ç™»å½•åé¦–å…ˆè¿›è¡ŒéªŒè¯ç éªŒè¯</span></span><br><span class="line">          model.addAttribute(<span class="string">"image"</span>, avatar);</span><br><span class="line">          <span class="keyword">if</span> (!KaptchaUtils.checkVerifyCode(request)) {</span><br><span class="line">              redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"éªŒè¯ç é”™è¯¯"</span>);</span><br><span class="line">              <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"admin/index"</span>;</span><br><span class="line">      } <span class="keyword">catch</span> (UnknownAccountException e) { <span class="comment">//æ³¨æ„ï¼šä¸‹é¢å¦‚æœæ˜¯é‡å®šå‘ï¼Œè¿™é‡Œä¸é€‚ç”¨Modelï¼Œè€Œæ˜¯ä½¿ç”¨RedirectAttribute</span></span><br><span class="line">          redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"ç”¨æˆ·åä¸å­˜åœ¨"</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">      } <span class="keyword">catch</span> (IncorrectCredentialsException e) {</span><br><span class="line">          redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"å¯†ç é”™è¯¯"</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<strong>åˆ°æ­¤åŸºæœ¬ç®€å•é…ç½®æˆåŠŸâ€¦</strong></li>
</ol>
]]></content>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Shiro</tag>
      </tags>
  </entry>
  <entry>
    <title>Springå¼€å¯@Asyncå¼‚æ­¥è°ƒç”¨</title>
    <url>/post/16549.html</url>
    <content><![CDATA[<h2 id="Springå¼€å¯-Asyncå¼‚æ­¥è°ƒç”¨"><a href="#Springå¼€å¯-Asyncå¼‚æ­¥è°ƒç”¨" class="headerlink" title="Springå¼€å¯@Asyncå¼‚æ­¥è°ƒç”¨"></a>Springå¼€å¯@Asyncå¼‚æ­¥è°ƒç”¨</h2><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><blockquote>
<p>å¼€å¯<code>@EanableAsync</code>æ³¨è§£: åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæˆ–è€…é…ç½®ç±»ä¸Šå¼€å¯éƒ½å¯ä»¥</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span> <span class="comment">// å¼€å¯å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAsyncApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(SpringbootAsyncApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>è‡ªå®šä¹‰çº¿ç¨‹æ± </h3><blockquote>
<p>@Asyncæ³¨è§£çš„å¼‚æ­¥è°ƒç”¨ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ï¼ŒæŒ‡å®šçº¿ç¨‹æ± çš„å„é¡¹å‚æ•°</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰<span class="doctag">@Async</span>å¼‚æ­¥æ–¹æ³•çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/26 11:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorConfig</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean("customAsync")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">customAsync</span><span class="params">()</span> </span>{</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°: çº¿ç¨‹æ± åˆ›å»ºæ—¶å€™åˆå§‹åŒ–çš„çº¿ç¨‹æ•°</span></span><br><span class="line">        executor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± æœ€å¤§çš„çº¿ç¨‹æ•°</span></span><br><span class="line">        executor.setMaxPoolSize(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">// ç¼“å†²é˜Ÿåˆ—</span></span><br><span class="line">        executor.setQueueCapacity(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// å…è®¸çº¿ç¨‹çš„ç©ºé—²æ—¶é—´60ç§’ï¼šå½“è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹å‡ºä¹‹å¤–çš„çº¿ç¨‹åœ¨ç©ºé—²æ—¶é—´åˆ°è¾¾ä¹‹åä¼šè¢«é”€æ¯</span></span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± çš„å‰ç¼€</span></span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">"AsyncExecutor-"</span>);</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ï¼šè¿™é‡Œé‡‡ç”¨äº†CallerRunsPolicyç­–ç•¥ï¼Œå½“çº¿ç¨‹æ± æ²¡æœ‰å¤„ç†èƒ½åŠ›çš„æ—¶å€™ï¼Œè¯¥ç­–ç•¥ä¼šç›´æ¥åœ¨ execute æ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼›å¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡</span></span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆ›å»ºåŸºäº-Asyncçš„å¼‚æ­¥æ–¹æ³•"><a href="#åˆ›å»ºåŸºäº-Asyncçš„å¼‚æ­¥æ–¹æ³•" class="headerlink" title="åˆ›å»ºåŸºäº@Asyncçš„å¼‚æ­¥æ–¹æ³•"></a>åˆ›å»ºåŸºäº@Asyncçš„å¼‚æ­¥æ–¹æ³•</h3><blockquote>
<p>åªéœ€è¦åœ¨<code>@Async</code>æ³¨è§£ä¸ŠæŒ‡å®šè‡ªå®šä¹‰çº¿ç¨‹æ± çš„åç§°ï¼Œå°±å¯ä»¥ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„çº¿ç¨‹æ± </p>
</blockquote>
<h4 id="åŸºäº-Asyncæ— è¿”å›å€¼è°ƒç”¨"><a href="#åŸºäº-Asyncæ— è¿”å›å€¼è°ƒç”¨" class="headerlink" title="åŸºäº@Asyncæ— è¿”å›å€¼è°ƒç”¨"></a>åŸºäº@Asyncæ— è¿”å›å€¼è°ƒç”¨</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäº<span class="doctag">@Async</span>æ— è¿”å›å€¼è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Async("customAsync")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncVoidReturnType</span><span class="params">()</span> </span>{</span><br><span class="line">    String currentThreadName = Thread.currentThread().getName();</span><br><span class="line">    StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">    watch.start();</span><br><span class="line">    logger.info(<span class="string">" ==&gt; å½“å‰çº¿ç¨‹ {} å¼€å§‹æ‰§è¡Œæ— è¿”å›å€¼è°ƒç”¨"</span>, currentThreadName);</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¼‘çœ </span></span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++) {</span><br><span class="line">        sum += i;</span><br><span class="line">    }</span><br><span class="line">    watch.stop();</span><br><span class="line">    logger.info(<span class="string">" ==&gt; æ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="åŸºäº-Asyncæœ‰è¿”å›å€¼è°ƒç”¨"><a href="#åŸºäº-Asyncæœ‰è¿”å›å€¼è°ƒç”¨" class="headerlink" title="åŸºäº@Asyncæœ‰è¿”å›å€¼è°ƒç”¨"></a>åŸºäº@Asyncæœ‰è¿”å›å€¼è°ƒç”¨</h4><blockquote>
<p>è¿”å›çš„æ•°æ®ç±»å‹ä¸º<code>Future</code>ç±»å‹ï¼Œå…¶ä¸ºä¸€ä¸ªæ¥å£ã€‚å…·ä½“çš„ç»“æœç±»å‹ä¸º<code>AsyncResult</code></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäº<span class="doctag">@Async</span>æœ‰è¿”å›å€¼è°ƒç”¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Async("customAsync")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;Object&gt; <span class="title">asyncWithReturnType</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        String currentThreadName = Thread.currentThread().getName();</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; å½“å‰çº¿ç¨‹ {} å¼€å§‹æ‰§è¡Œæœ‰è¿”å›å€¼è°ƒç”¨"</span>, currentThreadName);</span><br><span class="line">        <span class="comment">// ä¼‘çœ 2ç§’</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        watch.stop();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; æ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeSeconds());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(<span class="string">"welcome to hangzhou!"</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        logger.error(<span class="string">" ==&gt; æ–¹æ³•è°ƒç”¨å¼‚å¸¸: {}"</span>, e.getMessage());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è°ƒç”¨æµ‹è¯•"><a href="#è°ƒç”¨æµ‹è¯•" class="headerlink" title="è°ƒç”¨æµ‹è¯•"></a>è°ƒç”¨æµ‹è¯•</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/26 10:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/async")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumeController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(ConsumeController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncProvider asyncProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/void")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumeVoid</span><span class="params">()</span> </span>{</span><br><span class="line">        String currentThreadName = Thread.currentThread().getName();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; å½“å‰çº¿ç¨‹: {}"</span>, currentThreadName);</span><br><span class="line">        asyncProvider.asyncVoidReturnType();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/with")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumeWith</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String currentThreadName = Thread.currentThread().getName();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; å½“å‰çº¿ç¨‹: {}"</span>, currentThreadName);</span><br><span class="line">        Future&lt;Object&gt; result = asyncProvider.asyncWithReturnType();</span><br><span class="line">        <span class="comment">// å¾ªç¯è¯»å–: åˆ¤æ–­å¼‚æ­¥çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•,å¹¶è·å–è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">if</span> (result.isDone()) {</span><br><span class="line">                System.out.println(<span class="string">"å¼‚æ­¥ç»“æœè¿”å›: "</span> + result.get());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="è¾“å‡ºç»“æœ"><a href="#è¾“å‡ºç»“æœ" class="headerlink" title="è¾“å‡ºç»“æœ"></a>è¾“å‡ºç»“æœ</h4><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">æ— è¿”å›å€¼çš„è°ƒç”¨<span class="number">1</span>æ¬¡</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">21.489</span>  INFO <span class="number">13476</span> --- [nio-<span class="number">8999</span>-exec-<span class="number">3</span>] c.h.async.controller.ConsumeController   :  ==&gt; å½“å‰çº¿ç¨‹: http-nio-<span class="number">8999</span>-exec-<span class="number">3</span></span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">21.491</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">3</span>] com.horse.async.service.AsyncProvider    :  ==&gt; å½“å‰çº¿ç¨‹ AsyncExecutor-<span class="number">3</span> å¼€å§‹æ‰§è¡Œæ— è¿”å›å€¼è°ƒç”¨</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">21.492</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">3</span>] com.horse.async.service.AsyncProvider    :  ==&gt; æ‰§è¡Œè€—æ—¶: 1ms</span><br><span class="line"></span><br><span class="line">æœ‰è¿”å›å€¼çš„è°ƒç”¨<span class="number">2</span>æ¬¡</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">23.331</span>  INFO <span class="number">13476</span> --- [nio-<span class="number">8999</span>-exec-<span class="number">4</span>] c.h.async.controller.ConsumeController   :  ==&gt; å½“å‰çº¿ç¨‹: http-nio-<span class="number">8999</span>-exec-<span class="number">4</span></span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">23.331</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">4</span>] com.horse.async.service.AsyncProvider    :  ==&gt; å½“å‰çº¿ç¨‹ AsyncExecutor-<span class="number">4</span> å¼€å§‹æ‰§è¡Œæœ‰è¿”å›å€¼è°ƒç”¨</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">25.347</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">4</span>] com.horse.async.service.AsyncProvider    :  ==&gt; æ‰§è¡Œè€—æ—¶: <span class="number">2.</span>0148967ms</span><br><span class="line">å¼‚æ­¥ç»“æœè¿”å›: welcome to hangzhou!</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">30.737</span>  INFO <span class="number">13476</span> --- [nio-<span class="number">8999</span>-exec-<span class="number">6</span>] c.h.async.controller.ConsumeController   :  ==&gt; å½“å‰çº¿ç¨‹: http-nio-<span class="number">8999</span>-exec-<span class="number">6</span></span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">30.738</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">5</span>] com.horse.async.service.AsyncProvider    :  ==&gt; å½“å‰çº¿ç¨‹ AsyncExecutor-<span class="number">5</span> å¼€å§‹æ‰§è¡Œæœ‰è¿”å›å€¼è°ƒç”¨</span><br><span class="line"><span class="number">2021</span>-<span class="number">05</span>-<span class="number">26</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">32.746</span>  INFO <span class="number">13476</span> --- [AsyncExecutor-<span class="number">5</span>] com.horse.async.service.AsyncProvider    :  ==&gt; æ‰§è¡Œè€—æ—¶: <span class="number">2.</span>0086615ms</span><br><span class="line">å¼‚æ­¥ç»“æœè¿”å›: welcome to hangzhou!</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote>
<p><code>@Async</code>æ³¨è§£å¤±æ•ˆé—®é¢˜æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>æŸ¥çœ‹æ˜¯å¦å¼€å¯<code>EnableAsync</code>æ³¨è§£æœåŠ¡</li>
<li>æ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯publicæ–¹æ³•ï¼Œä¸èƒ½æ˜¯static</li>
<li>åœ¨å®šä¹‰å¼‚æ­¥æ–¹æ³•çš„åŒä¸€ä¸ªç±»ä¸­ï¼Œè°ƒç”¨å¸¦æœ‰<code>@Async</code>æ³¨è§£æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ™æ— æ³•å¼‚æ­¥æ‰§è¡Œ<ul>
<li>åŸå› ï¼šæ²¡æœ‰èµ°Springçš„ä»£ç†ç±»ã€‚å› ä¸º@Transactionalå’Œ@Asyncæ³¨è§£çš„å®ç°éƒ½æ˜¯åŸºäºSpringçš„AOPï¼Œè€ŒAOPçš„å®ç°æ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¨¡å¼å®ç°çš„ã€‚é‚£ä¹ˆæ³¨è§£å¤±æ•ˆçš„åŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œæœ‰å¯èƒ½å› ä¸ºè°ƒç”¨æ–¹æ³•çš„æ˜¯å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡Springå®¹å™¨ç®¡ç†ã€‚</li>
</ul>
</li>
</ul>
<p><code>@Async</code>ä¸­çš„äº‹åŠ¡å¤±æ•ˆé—®é¢˜å¤„ç†</p>
<p>è§£å†³æ–¹æ³•ï¼šå¯ä»¥å°†éœ€è¦äº‹åŠ¡ç®¡ç†æ“ä½œçš„æ–¹æ³•æ”¾ç½®åˆ°å¼‚æ­¥æ–¹æ³•å†…éƒ¨ï¼Œåœ¨å†…éƒ¨è¢«è°ƒç”¨çš„æ–¹æ³•ä¸Šæ·»åŠ @Transactional</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ–¹æ³•Aï¼ŒåŒæ—¶ä½¿ç”¨äº†@Asyncå’Œ@Transactionalæ¥æ ‡æ³¨ï¼Œä½†æ˜¯æ— æ³•äº§ç”Ÿäº‹åŠ¡æ§åˆ¶çš„ç›®çš„</li>
<li><strong>æ–¹æ³•Bï¼Œä½¿ç”¨äº†@Asyncæ¥æ ‡æ³¨ï¼Œ  Bä¸­è°ƒç”¨äº†Cã€Dï¼ŒC/DæŠ½ç¦»å°è£…å‡ºæ¥ï¼Œåˆ†åˆ«ä½¿ç”¨@Transactionalåšäº†æ ‡æ³¨ï¼Œåˆ™å¯å®ç°äº‹åŠ¡æ§åˆ¶çš„ç›®çš„</strong></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Async</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¸¸è§å…³é”®å­—ç®€æ</title>
    <url>/post/42937.html</url>
    <content><![CDATA[<h2 id="javaå¸¸è§å…³é”®å­—ç®€æ"><a href="#javaå¸¸è§å…³é”®å­—ç®€æ" class="headerlink" title="javaå¸¸è§å…³é”®å­—ç®€æ"></a>javaå¸¸è§å…³é”®å­—ç®€æ</h2><h3 id="final"><a href="#final" class="headerlink" title="final"></a>final</h3><blockquote>
<p>finalå…³é”®å­—ï¼Œæ„æ€æ˜¯æœ€ç»ˆçš„ã€ä¸å¯ä¿®æ”¹çš„ï¼Œæœ€è§ä¸å¾—å˜åŒ– ï¼Œç”¨æ¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡</p>
</blockquote>
<ol>
<li><p>finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•ï¼›</p>
</li>
<li><p>finalä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼›</p>
</li>
<li><p>finalä¿®é¥°çš„å˜é‡æ˜¯å¸¸é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
</ol>
<h3 id="super"><a href="#super" class="headerlink" title="super"></a>super</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(SuperClass.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SuperClass</span><span class="params">(Integer score)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">        logger.info(<span class="string">"çˆ¶ç±»æœ‰å‚æ„é€ å‡½æ•°æ‰§è¡Œ ==&gt; "</span> + score);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">customFunc</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) {</span><br><span class="line">            score += i;</span><br><span class="line">        }</span><br><span class="line">        logger.info(<span class="string">"score ==&gt; "</span> + score);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Item().itemFunc();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> <span class="keyword">extends</span> <span class="title">SuperClass</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// åœ¨ä¹‹ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°,è¯¥è¯­å¥å¿…é¡»å¤„äºæ„é€ å™¨çš„é¦–è¡Œï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™</span></span><br><span class="line">            <span class="keyword">super</span>(<span class="number">200</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æµ‹è¯•åœ¨å­ç±»ä¸­ä½¿ç”¨ superå…³é”®å­— è®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">itemFunc</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>.score = <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">super</span>.customFunc();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">15</span>:<span class="number">12</span>:<span class="number">10.573</span> [main] INFO com.topsun.keyword.SuperClass - çˆ¶ç±»æœ‰å‚æ„é€ å‡½æ•°æ‰§è¡Œ ==&gt; <span class="number">200</span></span><br><span class="line"><span class="number">15</span>:<span class="number">12</span>:<span class="number">10.576</span> [main] INFO com.topsun.keyword.SuperClass - score ==&gt; <span class="number">5150</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><blockquote>
<p>å®ä¾‹åŒ–å¯¹è±¡æ‰§è¡Œé¡ºåº: é™æ€ä»£ç å— â€”&gt; éé™æ€ä»£ç å— â€”&gt; æ„é€ å‡½æ•°<br>é™æ€ä»£ç å—: åªè¦è¿™ä¸ªç±»è¢«ä½¿ç”¨æˆ–è€…è¢«å®ä¾‹åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œ,ä½†æ˜¯åªæ‰§è¡Œä¸€æ¬¡ [ä¸»åŠ¨æ‰§è¡Œ]<br>éé™æ€ä»£ç å—: å¯¹è±¡è¢«å®ä¾‹åŒ–å¤šå°‘æ¬¡,å°±è¢«è°ƒç”¨å¤šå°‘æ¬¡ [è¢«åŠ¨æ‰§è¡Œ]</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(StaticClass.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StaticClass</span><span class="params">()</span> </span>{</span><br><span class="line">        logger.info(<span class="string">" ==&gt; é»˜è®¤æ„é€ æ–¹æ³•"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    {</span><br><span class="line">        logger.info(<span class="string">" ==&gt; éé™æ€ä»£ç å—"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        logger.info(<span class="string">" ==&gt; é™æ€ä»£ç å—"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        StaticClass.func();</span><br><span class="line">        StaticClass.func();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span> </span>{</span><br><span class="line">        logger.info(<span class="string">" ==&gt; é™æ€æ–¹æ³•ä¸­çš„å†…å®¹"</span>);</span><br><span class="line">        {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; é™æ€æ–¹æ³•ä¸­çš„éé™æ€ä»£ç å—"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">15</span>:<span class="number">40</span>:<span class="number">58.094</span> [main] INFO com.topsun.keyword.StaticClass -  ==&gt; é™æ€ä»£ç å—  <span class="comment">// åªè¢«æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="number">15</span>:<span class="number">40</span>:<span class="number">58.096</span> [main] INFO com.topsun.keyword.StaticClass -  ==&gt; éé™æ€ä»£ç å—</span><br><span class="line"><span class="number">15</span>:<span class="number">40</span>:<span class="number">58.096</span> [main] INFO com.topsun.keyword.StaticClass -  ==&gt; é»˜è®¤æ„é€ æ–¹æ³•</span><br><span class="line"><span class="number">15</span>:<span class="number">40</span>:<span class="number">58.096</span> [main] INFO com.topsun.keyword.StaticClass -  ==&gt; éé™æ€ä»£ç å—</span><br><span class="line"><span class="number">15</span>:<span class="number">40</span>:<span class="number">58.096</span> [main] INFO com.topsun.keyword.StaticClass -  ==&gt; é»˜è®¤æ„é€ æ–¹æ³•</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ThreadLocalçš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/post/22692.html</url>
    <content><![CDATA[<h2 id="ThreadLocalçš„åŸºæœ¬ä½¿ç”¨"><a href="#ThreadLocalçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ThreadLocalçš„åŸºæœ¬ä½¿ç”¨"></a>ThreadLocalçš„åŸºæœ¬ä½¿ç”¨</h2><blockquote>
<p>ä¸»è¦æ˜¯ç”¨äºçº¿ç¨‹å€¼ä¼ é€’å’Œå¤šçº¿ç¨‹ä¸­å˜é‡ä¸å…±äº«æ§åˆ¶</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: ä½¿ç”¨ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡æ¥ä¼ é€’ç¨‹åºæ‰§è¡Œæ—¶é—´å˜é‡: startTime</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/26 14:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(MyInterceptor.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; ç¨‹åºå¼€å§‹æ‰§è¡Œ,startTime: {}"</span>, startTime);</span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</span></span><br><span class="line">        threadLocal.set(startTime);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// é€šè¿‡ThreadLocalå±€éƒ¨å˜é‡è·å–ç¨‹åºæ‰§è¡Œå¼€å§‹æ—¶é—´: startTime</span></span><br><span class="line">        <span class="keyword">long</span> startTime = (<span class="keyword">long</span>) threadLocal.get();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; ç¨‹åºæ‰§è¡Œç»“æŸ,startTime: {}"</span>, startTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; ç¨‹åºæ‰§è¡Œè€—æ—¶: {}ms"</span>, endTime - startTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹ä½¿ç”¨å®Œæ¯•å,æ‰‹åŠ¨æ¸…é™¤,é¿å…å†…å­˜æ³„éœ²</span></span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>ThreadLocal</tag>
      </tags>
  </entry>
  <entry>
    <title>logback-spring.xmlåŠ¨æ€è¯»å–ymlæ–‡ä»¶æ—¥å¿—è·¯å¾„</title>
    <url>/post/64530.html</url>
    <content><![CDATA[<h1 id="SpringBootä¸­logback-spring-xmlåŠ¨æ€è¯»å–ymlæ–‡ä»¶æ—¥å¿—è·¯å¾„"><a href="#SpringBootä¸­logback-spring-xmlåŠ¨æ€è¯»å–ymlæ–‡ä»¶æ—¥å¿—è·¯å¾„" class="headerlink" title="SpringBootä¸­logback-spring.xmlåŠ¨æ€è¯»å–ymlæ–‡ä»¶æ—¥å¿—è·¯å¾„"></a>SpringBootä¸­logback-spring.xmlåŠ¨æ€è¯»å–ymlæ–‡ä»¶æ—¥å¿—è·¯å¾„</h1><blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>logback.xmlçš„åŠ è½½é¡ºåºæ—©äºspringbootçš„application.yml ï¼Œæ‰€ä»¥æŒ‰ç…§å®˜æ–¹çš„å»ºè®®ï¼Œæ–‡ä»¶åå‘½åä¸º<code>logback-spring.xml</code></li>
<li>éœ€è¦ä½¿ç”¨springå®˜æ–¹æä¾›çš„æ ‡ç­¾<code>&lt;springProperty&gt; &lt;/springProperty&gt;</code></li>
<li>sourceå±æ€§ä¸éœ€è¦ <code>${}</code>ç¬¦å·ï¼Œç›´æ¥å†™ymlæ–‡ä»¶ä¸­çš„é…ç½®åç§°å³å¯</li>
</ul>
</blockquote>
<p>ymlé…ç½®ä¿¡æ¯</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># logback-spring.xmlé…ç½®åŠ¨æ€æ—¥å¿—è·¯å¾„</span></span><br><span class="line"><span class="attr">logback:</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">    <span class="attr">dev:</span> <span class="string">E:/HorseVueBlog/horse_vue_blog/horse_vue_blog/service/blog_service/src/log</span></span><br><span class="line">    <span class="attr">prod:</span> <span class="string">/home/play/logs</span></span><br></pre></td></tr></tbody></table></figure>
<p>logback-spring.xmlé…ç½®</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"10 seconds"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--åŠ¨æ€é…ç½®æ—¥å¿—è¾“å‡ºè·¯å¾„: ä»ymlé…ç½®æ–‡ä»¶è¯»å–--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--devç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"log.path"</span> <span class="attr">source</span>=<span class="string">"logback.path.dev"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--prodç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;springProperty scope="context" name="log.path" source="logback.path.prod"/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:é’è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:ç™½è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"CONSOLE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"FILE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%date{yyyy-MM-dd HH:mm:ss} |%-5level |%thread |%file:%line |%logger |%msg%n"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç¼–ç --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ENCODING"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"CONSOLE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è‡ªå®šä¹‰ï¼šæ—¥å¿—çº§åˆ«--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—å­—ç¬¦é›†--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"INFO_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•INFOçº§åˆ«çš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"WARN_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•WARNçº§åˆ«çš„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"ERROR_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¼€å‘ç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¯ä»¥çµæ´»è®¾ç½®æ­¤å¤„ï¼Œä»è€Œæ§åˆ¶æ—¥å¿—çš„è¾“å‡º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_FILE"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_FILE"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_FILE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"pro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ERROR"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_FILE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Logback</tag>
      </tags>
  </entry>
  <entry>
    <title>try catch finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ</title>
    <url>/post/41956.html</url>
    <content><![CDATA[<h1 id="try-catch-finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ"><a href="#try-catch-finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ" class="headerlink" title="try catch finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ"></a>try catch finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ</h1><h2 id="tryå’Œfinallyä¸­å‡æœ‰return"><a href="#tryå’Œfinallyä¸­å‡æœ‰return" class="headerlink" title="tryå’Œfinallyä¸­å‡æœ‰return"></a>tryå’Œfinallyä¸­å‡æœ‰return</h2><blockquote>
<p>åˆ†æï¼štryä¸­çš„returnè¯­å¥æ‰§è¡Œåé¢çš„è¡¨è¾¾å¼åï¼Œä¼šæŠŠå€¼æš‚æ—¶å­˜å‚¨èµ·æ¥ï¼Œæ¥ç€å»æ‰§è¡Œfinallä¸­çš„è¯­å¥ï¼Œå¦‚æœfinallyä¸­å­˜åœ¨returnè¯­å¥ï¼Œé‚£ä¹ˆå°†ä¼šè¦†ç›–æ‰tryçš„returnè¯­å¥ï¼Œæ‰€ä»¥å®˜ç½‘ä¸æ¨èåœ¨finallyä¸­æ‰§è¡Œreturnè¯­å¥ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TryFinallyReturnTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(TryFinallyReturnTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = TryFinallyReturnTest.test01();</span><br><span class="line">        logger.info(<span class="string">"count:{}"</span>, count);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tryå’Œfinallyä¸­éƒ½å­˜åœ¨return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test01</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œtry"</span>);</span><br><span class="line">            <span class="keyword">return</span> count += <span class="number">90</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œcatch"</span>);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œfinally"</span>);</span><br><span class="line">            count = <span class="number">200</span>;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">45.149</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">try</span></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">45.151</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">finally</span></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">45.151</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest - count:<span class="number">200</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="finallyä¸­æ”¹å˜è¿”å›åŸºæœ¬æ•°æ®ç±»å‹å€¼"><a href="#finallyä¸­æ”¹å˜è¿”å›åŸºæœ¬æ•°æ®ç±»å‹å€¼" class="headerlink" title="finallyä¸­æ”¹å˜è¿”å›åŸºæœ¬æ•°æ®ç±»å‹å€¼"></a>finallyä¸­æ”¹å˜è¿”å›åŸºæœ¬æ•°æ®ç±»å‹å€¼</h2><blockquote>
<p>åˆ†æï¼šå¦‚æœreturnçš„æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™åœ¨finallyä¸­å¯¹è¯¥åŸºæœ¬æ•°æ®çš„æ”¹å˜ä¸èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›è¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„å€¼ã€‚</p>
<p>å†…å­˜è§£é‡Šï¼š<code>return count+90</code> è¯­å¥å…¶å®æ˜¯åœ¨æ ˆé‡Œæ–°å¼€è¾Ÿäº†ä¸€å—ç©ºé—´ï¼Œç„¶åæŠŠ<code>count</code>çš„å€¼èµ‹ç»™äº†æ–°å¼€è¾Ÿçš„ç©ºé—´ï¼Œæ‰€ä»¥èµ‹å€¼å®Œæ¯•åï¼Œ<code>count</code>çš„å€¼æ€ä¹ˆå˜ä¸å½±å“è¿”å›å€¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TryFinallyReturnTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(TryFinallyReturnTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = TryFinallyReturnTest.test02();</span><br><span class="line">        logger.info(<span class="string">"count:{}"</span>, count);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨finallyä¸­ç»™counté‡æ–°èµ‹å€¼,æµ‹è¯•èƒ½ä¸èƒ½æ”¹å˜countçš„å€¼,ç­”æ¡ˆæ˜¯å¦å®šçš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test02</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œtry"</span>);</span><br><span class="line">            <span class="keyword">return</span> count + <span class="number">90</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œcatch"</span>);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œfinally,åªæ”¹å˜å€¼,ä¸return"</span>);</span><br><span class="line">            count = <span class="number">200</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">21</span>:<span class="number">51</span>:<span class="number">27.864</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">try</span></span><br><span class="line"><span class="number">21</span>:<span class="number">51</span>:<span class="number">27.866</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">finally</span>,åªæ”¹å˜å€¼,ä¸<span class="keyword">return</span></span><br><span class="line"><span class="number">21</span>:<span class="number">51</span>:<span class="number">27.866</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest - count:<span class="number">100</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="finallyä¸­æ”¹å˜è¿”å›å¼•ç”¨æ•°æ®ç±»å‹å€¼"><a href="#finallyä¸­æ”¹å˜è¿”å›å¼•ç”¨æ•°æ®ç±»å‹å€¼" class="headerlink" title="finallyä¸­æ”¹å˜è¿”å›å¼•ç”¨æ•°æ®ç±»å‹å€¼"></a>finallyä¸­æ”¹å˜è¿”å›å¼•ç”¨æ•°æ®ç±»å‹å€¼</h2><blockquote>
<p><strong>æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆIntegerï¼‰å’ŒåŸºæœ¬æ•°æ®ç±»å‹(int)çš„è‡ªåŠ¨æ‹†ç®±æ“ä½œã€‚</strong></p>
<p>åˆ†æï¼šå¦‚æœreturnçš„æ•°æ®æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œè€Œåœ¨finallyä¸­å¯¹è¯¥å¼•ç”¨æ•°æ®ç±»å‹çš„å±æ€§å€¼çš„æ”¹å˜èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›çš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åçš„è¯¥å±æ€§çš„å€¼ã€‚</p>
<p>å†…å­˜è§£é‡Šï¼šreturnè¯­å¥ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªç©ºé—´ï¼Œå°†å€¼èµ‹ç»™æ–°å¼€è¾Ÿçš„æ–°å¼€è¾Ÿçš„ç©ºé—´ã€‚ä½†æ˜¯<code>builder</code>æ˜¯å¼•ç”¨ç±»å‹ï¼Œfinallyä¸­æ˜¯å¯¹<code>builder</code>æŒ‡å‘çš„å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆè‚¯å®šä¼šå½±å“åˆ°è¿”å›å€¼ï¼Œå› ä¸ºä»–ä»¬æŒ‡å‘åŒä¸€å—å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥å¯ä»¥æ”¹å˜å¼•ç”¨æ•°æ®ç±»å‹çš„å€¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TryFinallyReturnTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(TryFinallyReturnTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        StringBuilder count = TryFinallyReturnTest.test03();</span><br><span class="line">        logger.info(<span class="string">"count:{}"</span>, count);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuilder <span class="title">test03</span><span class="params">()</span> </span>{</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"ab"</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œtry"</span>);</span><br><span class="line">            <span class="keyword">return</span> builder.append(<span class="string">"ef"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œcatch"</span>);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; æ‰§è¡Œfinally,åªæ”¹å˜å€¼,ä¸return"</span>);</span><br><span class="line">            builder.append(<span class="string">"cd"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> builder;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">21</span>:<span class="number">55</span>:<span class="number">52.649</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">try</span></span><br><span class="line"><span class="number">21</span>:<span class="number">55</span>:<span class="number">52.651</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest -  ==&gt; æ‰§è¡Œ<span class="keyword">finally</span>,åªæ”¹å˜å€¼,ä¸<span class="keyword">return</span></span><br><span class="line"><span class="number">21</span>:<span class="number">55</span>:<span class="number">52.651</span> [main] INFO com.topsun.runOrder.TryFinallyReturnTest - count:abefcd</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote>
<ul>
<li>å‡½æ•°æ‰§è¡Œåˆ°tryé‡Œé¢çš„å†…å®¹ï¼Œä¸€å®šä¼šæ‰§è¡Œfinallyé‡Œé¢çš„è¯­å¥å—ï¼Œé™¤étryé‡Œé¢æœ‰ç±»ä¼¼System.exit(0)çš„æ–¹æ³•</li>
<li>tryè¯­å¥åœ¨è¿”å›å‰ï¼Œå°†å…¶ä»–æ‰€æœ‰çš„æ“ä½œæ‰§è¡Œå®Œï¼Œä¿ç•™å¥½è¦è¿”å›çš„å€¼ï¼Œè€Œåè½¬å…¥æ‰§è¡Œfinallyä¸­çš„è¯­å¥ï¼Œè€Œååˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š<ul>
<li>æƒ…å†µä¸€ï¼šå¦‚æœfinallyä¸­æœ‰returnè¯­å¥ï¼Œåˆ™ä¼šå°†tryä¸­çš„returnè¯­å¥â€è¦†ç›–â€œæ‰ï¼Œç›´æ¥æ‰§è¡Œfinallyä¸­çš„returnè¯­å¥ï¼Œå¾—åˆ°è¿”å›å€¼ï¼Œè¿™æ ·ä¾¿æ— æ³•å¾—åˆ°tryä¹‹å‰ä¿ç•™å¥½çš„è¿”å›å€¼ã€‚</li>
<li>æƒ…å†µäºŒï¼šå¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä¹Ÿæ²¡æœ‰æ”¹å˜è¦è¿”å›å€¼ï¼Œåˆ™æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åï¼Œä¼šæ¥ç€æ‰§è¡Œtryä¸­çš„returnè¯­å¥ï¼Œè¿”å›ä¹‹å‰ä¿ç•™çš„å€¼ã€‚</li>
<li>æƒ…å†µä¸‰ï¼šå¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œ<code>ä½†æ˜¯æ”¹å˜äº†è¦è¿”å›çš„å€¼</code>ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä¸å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’çš„åŒºåˆ«ï¼Œåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š<ul>
<li>å¦‚æœreturnçš„æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œåˆ™åœ¨finallyä¸­å¯¹è¯¥<code>åŸºæœ¬æ•°æ®</code>çš„æ”¹å˜ä¸èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›è¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„å€¼ã€‚</li>
<li>å¦‚æœreturnçš„æ•°æ®æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œè€Œåœ¨finallyä¸­å¯¹è¯¥<code>å¼•ç”¨æ•°æ®ç±»å‹</code>çš„å±æ€§å€¼çš„æ”¹å˜èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›çš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åçš„è¯¥å±æ€§çš„å€¼ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¥½ç©æœ‰è¶£API</title>
    <url>/post/57779.html</url>
    <content><![CDATA[<h2 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h2><h3 id="è·å–IPåœ°ç†ä½ç½®æ¥å£"><a href="#è·å–IPåœ°ç†ä½ç½®æ¥å£" class="headerlink" title="è·å–IPåœ°ç†ä½ç½®æ¥å£"></a>è·å–IPåœ°ç†ä½ç½®æ¥å£</h3><div class="table-container">
<table>
<thead>
<tr>
<th>è¯·æ±‚ç±»å‹</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><a href="http://ip.geo.iqiyi.com/cityjson?format=json&amp;ip=121.5.168.31">http://ip.geo.iqiyi.com/cityjson?format=json&amp;ip=121.5.168.31</a></td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line"><span class="attr">"code"</span>: <span class="string">"A00000"</span>,</span><br><span class="line"><span class="attr">"data"</span>: {</span><br><span class="line"><span class="attr">"country"</span>: <span class="string">"ä¸­å›½"</span>,</span><br><span class="line"><span class="attr">"province"</span>: <span class="string">"å‰æ—"</span>,</span><br><span class="line"><span class="attr">"city"</span>: <span class="string">"é•¿æ˜¥"</span>,</span><br><span class="line"><span class="attr">"country_id"</span>: <span class="number">48</span>,</span><br><span class="line"><span class="attr">"province_id"</span>: <span class="number">21</span>,</span><br><span class="line"><span class="attr">"city_id"</span>: <span class="number">21001</span>,</span><br><span class="line"><span class="attr">"location_id"</span>: <span class="number">30021001</span>,</span><br><span class="line"><span class="attr">"isp_id"</span>: <span class="number">30</span>,</span><br><span class="line"><span class="attr">"isp"</span>: <span class="string">"æ–¹æ­£å®½å¸¦"</span>,</span><br><span class="line"><span class="attr">"longitude"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">"latitude"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">"ip"</span>: <span class="string">"121.5.168.31"</span></span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>æ•ˆç‡å·¥å…·</category>
      </categories>
      <tags>
        <tag>Api</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®å“åº”ç­–ç•¥</title>
    <url>/post/27935.html</url>
    <content><![CDATA[<h2 id="å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š"></a>å…·ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</h2><blockquote>
<p>åˆ›å»ºè¿”å›ç»“æœæšä¸¾ç±»ResultCodeEnum</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResultCodeEnum</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŠ¶æ€ç å’Œå“åº”æ¶ˆæ¯æ ¹æ®ä¸šåŠ¡æ¥è¿›è¡Œå®šåˆ¶</span></span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="keyword">true</span>, <span class="number">20000</span>,<span class="string">"æˆåŠŸ"</span>),</span><br><span class="line">    UNKNOWN_REASON(<span class="keyword">false</span>, <span class="number">20001</span>, <span class="string">"æœªçŸ¥é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    BAD_SQL_GRAMMAR(<span class="keyword">false</span>, <span class="number">21001</span>, <span class="string">"sqlè¯­æ³•é”™è¯¯"</span>),</span><br><span class="line">    JSON_PARSE_ERROR(<span class="keyword">false</span>, <span class="number">21002</span>, <span class="string">"jsonè§£æå¼‚å¸¸"</span>),</span><br><span class="line">    PARAM_ERROR(<span class="keyword">false</span>, <span class="number">21003</span>, <span class="string">"å‚æ•°ä¸æ­£ç¡®"</span>),</span><br><span class="line"></span><br><span class="line">    FILE_UPLOAD_ERROR(<span class="keyword">false</span>, <span class="number">21004</span>, <span class="string">"æ–‡ä»¶ä¸Šä¼ é”™è¯¯"</span>),</span><br><span class="line">    FILE_DELETE_ERROR(<span class="keyword">false</span>, <span class="number">21005</span>, <span class="string">"æ–‡ä»¶åˆªé™¤é”™è¯¯"</span>),</span><br><span class="line">    EXCEL_DATA_IMPORT_ERROR(<span class="keyword">false</span>, <span class="number">21006</span>, <span class="string">"Excelæ•°æ®å¯¼å…¥é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    VIDEO_UPLOAD_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22001</span>, <span class="string">"è§†é¢‘ä¸Šä¼ è‡³é˜¿é‡Œäº‘å¤±è´¥"</span>),</span><br><span class="line">    VIDEO_UPLOAD_TOMCAT_ERROR(<span class="keyword">false</span>, <span class="number">22002</span>, <span class="string">"è§†é¢‘ä¸Šä¼ è‡³ä¸šåŠ¡æœåŠ¡å™¨å¤±è´¥"</span>),</span><br><span class="line">    VIDEO_DELETE_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22003</span>, <span class="string">"é˜¿é‡Œäº‘è§†é¢‘æ–‡ä»¶åˆ é™¤å¤±è´¥"</span>),</span><br><span class="line">    FETCH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22004</span>, <span class="string">"è·å–ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥"</span>),</span><br><span class="line">    REFRESH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22005</span>, <span class="string">"åˆ·æ–°ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥"</span>),</span><br><span class="line">    FETCH_PLAYAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22006</span>, <span class="string">"è·å–æ’­æ”¾å‡­è¯å¤±è´¥"</span>),</span><br><span class="line"></span><br><span class="line">    URL_ENCODE_ERROR(<span class="keyword">false</span>, <span class="number">23001</span>, <span class="string">"URLç¼–ç å¤±è´¥"</span>),</span><br><span class="line">    ILLEGAL_CALLBACK_REQUEST_ERROR(<span class="keyword">false</span>, <span class="number">23002</span>, <span class="string">"éæ³•å›è°ƒè¯·æ±‚"</span>),</span><br><span class="line">    FETCH_ACCESSTOKEN_FAILD(<span class="keyword">false</span>, <span class="number">23003</span>, <span class="string">"è·å–accessTokenå¤±è´¥"</span>),</span><br><span class="line">    FETCH_USERINFO_ERROR(<span class="keyword">false</span>, <span class="number">23004</span>, <span class="string">"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="keyword">false</span>, <span class="number">23005</span>, <span class="string">"ç™»å½•å¤±è´¥"</span>),</span><br><span class="line"></span><br><span class="line">    COMMENT_EMPTY(<span class="keyword">false</span>, <span class="number">24006</span>, <span class="string">"è¯„è®ºå†…å®¹å¿…é¡»å¡«å†™"</span>),</span><br><span class="line"></span><br><span class="line">    PAY_RUN(<span class="keyword">false</span>, <span class="number">25000</span>, <span class="string">"æ”¯ä»˜ä¸­"</span>),</span><br><span class="line">    PAY_UNIFIEDORDER_ERROR(<span class="keyword">false</span>, <span class="number">25001</span>, <span class="string">"ç»Ÿä¸€ä¸‹å•é”™è¯¯"</span>),</span><br><span class="line">    PAY_ORDERQUERY_ERROR(<span class="keyword">false</span>, <span class="number">25002</span>, <span class="string">"æŸ¥è¯¢æ”¯ä»˜ç»“æœé”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    ORDER_EXIST_ERROR(<span class="keyword">false</span>, <span class="number">25003</span>, <span class="string">"è¯¾ç¨‹å·²è´­ä¹°"</span>),</span><br><span class="line"></span><br><span class="line">    GATEWAY_ERROR(<span class="keyword">false</span>, <span class="number">26000</span>, <span class="string">"æœåŠ¡ä¸èƒ½è®¿é—®"</span>),</span><br><span class="line"></span><br><span class="line">    CODE_ERROR(<span class="keyword">false</span>, <span class="number">28000</span>, <span class="string">"éªŒè¯ç é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    LOGIN_PHONE_ERROR(<span class="keyword">false</span>, <span class="number">28009</span>, <span class="string">"æ‰‹æœºå·ç ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_MOBILE_ERROR(<span class="keyword">false</span>, <span class="number">28001</span>, <span class="string">"è´¦å·ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_PASSWORD_ERROR(<span class="keyword">false</span>, <span class="number">28008</span>, <span class="string">"å¯†ç ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_DISABLED_ERROR(<span class="keyword">false</span>, <span class="number">28002</span>, <span class="string">"è¯¥ç”¨æˆ·å·²è¢«ç¦ç”¨"</span>),</span><br><span class="line">    REGISTER_MOBLE_ERROR(<span class="keyword">false</span>, <span class="number">28003</span>, <span class="string">"æ‰‹æœºå·å·²è¢«æ³¨å†Œ"</span>),</span><br><span class="line">    REQUEST_TOKEN_ERROR(<span class="keyword">false</span>, <span class="number">28008</span>, <span class="string">"è¯·æ±‚tokenå¤±è´¥"</span>),</span><br><span class="line">    LOGIN_AUTH(<span class="keyword">false</span>, <span class="number">28004</span>, <span class="string">"éœ€è¦ç™»å½•"</span>),</span><br><span class="line">    LOGIN_ACL(<span class="keyword">false</span>, <span class="number">28005</span>, <span class="string">"æ²¡æœ‰æƒé™"</span>),</span><br><span class="line">    SMS_SEND_ERROR(<span class="keyword">false</span>, <span class="number">28006</span>, <span class="string">"çŸ­ä¿¡å‘é€å¤±è´¥"</span>),</span><br><span class="line">    SMS_SEND_ERROR_BUSINESS_LIMIT_CONTROL(<span class="keyword">false</span>, <span class="number">28007</span>, <span class="string">"çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    ResultCodeEnum(Boolean success, Integer code, String message) {</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>åˆ›å»ºè¿”å›ç»“æœå®ä½“ç±»R.class</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = "å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœ")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ˜¯å¦æˆåŠŸ")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›ç ")</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›æ¶ˆæ¯")</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›æ•°æ®")</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">R</span><span class="params">()</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆåŠŸ:æ— æ•°æ®è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Rå¯¹è±¡:å¯ä»¥é“¾å¼è°ƒç”¨æ­¤ç±»çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.SUCCESS.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.SUCCESS.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.SUCCESS.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”™è¯¯:æ— æ•°æ®è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Rå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.UNKNOWN_REASON.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.UNKNOWN_REASON.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.UNKNOWN_REASON.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆåŠŸ:å“åº”æšä¸¾ç±»è‡ªå®šä¹‰çš„çŠ¶æ€ç å’Œæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum  è‡ªå®šä¹‰æšä¸¾ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">setResult</span><span class="params">(ResultCodeEnum resultCodeEnum)</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(resultCodeEnum.getSuccess());</span><br><span class="line">        r.setCode(resultCodeEnum.getCode());</span><br><span class="line">        r.setMessage(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è¿”å›çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡è½½mapç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä½¿ç”¨å®ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Api("åå°ç®¡ç†è®²å¸ˆAPI")</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span>  <span class="comment">// å“åº”jsonç±»å‹æ•°æ®</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/edu/teacher")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("è·å–è®²å¸ˆåˆ—è¡¨")</span></span><br><span class="line">    <span class="meta">@GetMapping("/list")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">()</span> </span>{</span><br><span class="line">        List&lt;Teacher&gt; teachers = teacherService.list();</span><br><span class="line">        <span class="keyword">boolean</span> empty = CollectionUtils.isEmpty(teachers);</span><br><span class="line">        <span class="keyword">return</span> empty ? R.error().message(<span class="string">"èµ„æºæœªæ‰¾åˆ°"</span>) : R.ok().data(<span class="string">"items"</span>, teachers);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆå¾®ä¿¡æ²™ç®±æ”¯ä»˜</title>
    <url>/post/59545.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆå¾®ä¿¡æ²™ç®±æ”¯ä»˜"><a href="#SpringBootæ•´åˆå¾®ä¿¡æ²™ç®±æ”¯ä»˜" class="headerlink" title="SpringBootæ•´åˆå¾®ä¿¡æ²™ç®±æ”¯ä»˜"></a>SpringBootæ•´åˆå¾®ä¿¡æ²™ç®±æ”¯ä»˜</h2>]]></content>
      <categories>
        <category>æ”¯ä»˜å¯¹æ¥</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>weChat</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆWebSocketå®ç°ç®€å•èŠå¤©å®¤</title>
    <url>/post/10942.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆWebSocketå®ç°ç®€å•èŠå¤©å®¤"><a href="#SpringBootæ•´åˆWebSocketå®ç°ç®€å•èŠå¤©å®¤" class="headerlink" title="SpringBootæ•´åˆWebSocketå®ç°ç®€å•èŠå¤©å®¤"></a>SpringBootæ•´åˆWebSocketå®ç°ç®€å•èŠå¤©å®¤</h2><blockquote>
<p>æœªå®Œå¾…ç»­â€¦â€¦</p>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>WebSocket</tag>
      </tags>
  </entry>
  <entry>
    <title>è¶…å¥½ç”¨Orikaå±æ€§æ˜ å°„å·¥å…·</title>
    <url>/post/11538.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ï¼" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ï¼">
  <script id="hbeData" type="hbeData" data-hmacdigest="f205c80ed8742d0626cabf3b574d483011b25cf35f4267a99cfeb124bc848fd2">f35418a5c6541f65fe8123136a1af0fd4ea58c24a6950c620e3d3e32856892553419a81b7c34e88a61c445d2bb72d15b6740d1ab8c7bd4da0c1894988fd38f6c18e29d5dd38bd26f4fc40451f5c8c03ff7044ab61670f52d671f9365fa1ac573565c2c4503dce043b6260de7f2207b14b54ed62bf65010d10921e5944ddeadf7f3b862c38144b6b7fea83335c21af5dc144c418eafdebbf1540716a6d6c60147b5c51160485b96c9370c60d907bfcaa38283b3f177866dede43964bf284dd0be38ca12e42cab190b8602887929c5bdf2c8d59c24722734aa2e314281e78311a076a570431e95bc7090a43d19a76842c77d88f372bff5f13c4b897a33df1f4e2058251333ef18c2cad519e1bed36d04fe35600f2a05015dc5627463681fe48c3500f9b0f8960b4a4a3d2131660342913bce4352b26d5d71ff912fb4c5b9bc9f62073491cfb8aa7f5ce64fc72ca4b2b8b3021b010060ad54a0abada039ef3682df5f842b8141df480620219aa5ed524a3d633708c0f68a02f077e08a460732a4280f4ead40075da7f3a1a598a275ec71d7135766d853699b896d64b15a9fc13b72c946f8fae31b2b9a9020eb6af6cb2dd2f80aa910c1b11e2e8006d88ff08145ce89cd33421a03ae4a3fa6e8c8408952e69651bbaaece11f4e922fd14b94ed076621acd58f89b30101458e067556512169acf4f03a047956e8d5f298fc9153fdd7cb9432f6227ab0449a262726abf76dafdcbf9befb4a94c11d595650012bd438c90b50bfdea4e3189b3d46fcc67e75550d68d68d422614e82f8b707215e29413cf96d2e0a05a1f222e676c24859577e437a02e47e0dacfd0db611989f22053d2dd69dbd3adbb6558ba77e65686ebd202f0186a238076e0e21ad8d68ab5aa3e83ea3e26484d0b41578a226731503a0ef6631ed7f9c88601b24d6732af9464837db1767953ab364b3f7237d1b973b379462719f0de2b0fab121bbb42922b4287c88b47661445a1a43960b01e0e7a9d3572ff794e0c1a810d0abb3c95b72941b8428d628aea6a0dd8baa0ad8c56f31e5011a8beaf6ca1363702a8df806ea7d86fb27f42209b390f55d4c7a16742dea2970b106780cff3f7feff1efc030465dc796bca4ab3c9cdfe8970b5cf09cf5128ff7053dda0ec2d278b68434ad69c0fb3921a3abc73b25d5c33911831dff292b2da6c0b247eeca634e182a079cae1890fe91ee7dd6f445cf83ab99870728e22a0507f3dceae8b8802d33722fd4f3ba6528bf032af1ee47725e3668f992118aae90e914b5877e44f48d68268239fea46f18c6784e8f1b048a319cfeeb871cbf664e5dcb51510bb1ba0409bb3e2d6604e1c0ec4b9d0529b852e0c3c2d5405e3b3de78c9ebf853c8a2e6693364b165d5dc214b8c50e6dd3ffb8a13054521086917dac699d05a284cfcc74e1b09e2cd335e03a1c2c371005c2b21b2c0e7603ba11b6a75be8c7ddeb0e9a25fbaffece03d55f14e72a511bfbc64345c5b7fc3a5e4457dd1ffd0f91f0dcc82a06918ceef6662a8111bdfff122119b43f50b2a77dd130b1135b85fbffb0735c7c179aa04875670ab9090207886cb86951ab607d414fb1dfd3d19cbd9a73ccbdf48c0fa5f52f78fd3c8eb712107a9e35b439e64c409531400faee284418cd2c76881c3feb9dcac917031356a2eee1775eb26acb8732528306b92d3141fa35b15186a11ba3e4c7914022a85af34cc63befde141c48a9202c957f48d18a95e3d92842d9774c43836a0f2270e8cf9b3960da46b485ce384fbe0277d3ff4014b599c08ddfa945567bf34c1493ff7e8643228e3df8cf8ec0d17c7a91a98449c6138365a479ccb7d55aa7717befe71dd7083b3bbcb66ef14240ade1def2cfe4784f07fa1dd70a073bb2d791a8c6b41298142b5d9b01a2056691a28b803fcb210a807ba9db6e98e6c0fdc12baab315b1e95db23d7248e10c116b8f2f88312c0ce9c6ad80a4d3170903e973d343eaf98bf0b70d2faaf45e75c922fb22a8fa5b6c8b885cadcd7afb5125a2d2fd984a678af4c8fdd8b0d9063ab5657e80e203bd2473deac580a852b1bfde07879a15baf3b261a5bd9347d5ed4bc487d506dc45f92c470bb38dd6ebd745317da0cb114f65146f0cc020d8ecff20021420105d99393dfc4b5c6b5766d36c5b7f914eac839b3d308e975dc3be31cfbabe30b3c9dc399b34db93eb10cbe9a6fc850db3db87bbfd0ac4719f4afc560e4898dda2a1c2eb29e53c3c8b1976cb891244c9338d00ce468a53529d7eb95d56067823e7ae03c4a457f8c8fb8727de4f9398294599723d8545a357bdb165fa0b54f37022f6229106a434665e15df59aea1d3bfb910b89030e0fa71ce49bee3abb9df006ab908f5861985ff14585ba83269637d18c2ef5f48c6fa5975116dc0e028f2a9a521a9e45542a1b4a3952f49c8af07bac2aa218f014e33bf37839f835bd29e2ffca47a50cd22dfe5f9f21897a7e7bd47defb3b871c96c02485dca6be40aa9b51ad0e2aa199681189feae5a48a92ecb556d1438fc27aaf6ec1e375e794ca94beccda4d4f46762d67a6cce6378988794e066293291ccbda892dba65b0e4757825ec8dbcc72ff5d126957df6493ae23fbc3b989ce4a81909afbfad42358512b539b84d99fa1026a8b840483fa5fb07c18b7169820a8a4549b5bfe5654f0b57ae33f51b9ba637e34cd35eabfb1d52f53f4e7c87ce9831b9da5d5499b8f4a2899a5af8e0db50e2f54584b250ac2d23d1c3925f1ffdd1f3a554c7bb04066560e545286a9a8c5faaaa9d64277232dabffe5b81ee5124e713d39083cda62b821bce9d88340c62519059525418ca9ec983c0386f40593cd48fc71f6cebc8a620852a51573f96a3c64fbcfb8976db9d3556b1da2364ec78aaa35fea30e34b8816aba1ef099be5f84317ea10725a7f84028a5331b9cdfea7762f4646d2e7bc2593186b5babedcdc466ed7e3025e2fffa5f6e04d82ace62da918f714c0d4874b893bbe461953504e27ad51e7cc6126a4de36cbcd1b224cfb6deced3225bc3b2d4837dc4318ae59062ca7fd6b39841c0cc216b3fff0e2e0378fdbe17b77b87d30d379c62d5fa7b300c2ebe61daa437efa88e1745eb3d1ceb4cb5ae3c35556ae8e0e15ea8c7feeb297d65e02bcb849f273fac4263deb194476f639eddb314b653549f2183009b552570f88e466d86a9354775e2fc8f4f1e3b281a59da1d22d09f3fae94453ea88008e6a0868d7f4dfd9a28d85073943f18e114c9eeb1da8d2e3688cc4e7ca1b64252a742cb28247c9baa01a80383232fdfe1ca56ee0f5b65c5a8afc301414efe466675367e92a64074483ae42c49b9f05a0d4a451175fe6887df16f85d7b5c1b99882f2037b11be9152a26d1f34945587ff15426e889c53cc8342a63dce006e25a7e2a64844658de98c37d386c5b0d58ea08b06898b7e092dbeee54bfac77a62b3b41aee790a0103531807cc532b33a2dd6c3d54fab9615f19ea37a950358ac9bfd3050abcd03699b269186204cf6af541ff66f5b2c4e9a820649ce1709a89e004aba6bd4f2e45f0af440e39150ad4260421df37a4fa3e48595459f5f0833f73540a53bc790d53c4c4efcb24e7aa140f3b6b25f941cf55309a0618f6cec48e2d0410a76e7c895402f8d313f218ea1473a0236fc2752314f2c33879ff87b9c5265b86a280e4a3c7e3c68218b19f236f92eca9f16a2677b45277345ff1387b52d70b1cd8beda03380e197fc3f0a3de7892f3f2affa48645fe6251b1ea0abeea8d2b192174b578aad98de0bb6a9ce33959b15cff681e23559248cdda1016a52457ad58d7a9e18a92ebdc780f4b99b927494784d6d07e5ceb70a1b3ed856c0df9b8170c0dbcb225c883e0645f9eb9e187412da773ee05015a6e9d2bd8a850805747818dfb48fcc5f743df51979886bb243e2f76c81438a2d05cfc9e99acbb21352171b60b52308d02aef59e87f43e8fcc0dbde016c328a2992bca3d26d66021032f2c5ec331f5d6f622e1c59302641b36aeff10a05d25136bb33d0cbbd0852aa024f8b9304f3970aa259ab0e6ee358f2c2ddff530ea08aabb60c1c937d1098ab0afa71bd3de625f8fb9d6a5e601918c1b7090f146166ca482e7986a3c057310592873ac4d4cd306d9a2d747bde25b037b658ec6bce1b97dea80039877e52a0ec64c36407a71ff5267a69f65b5ad5428a33bae733746afe74b39b2ddfbec56f1394d7a6e49bb2de4df039b583a4f41a12f511f1204cdbc1b5eff7bf917fa120b53e52b59925b68bf41f40ebbfb622a85e8e95e40b10400cba506f82d786ec8d61f3efd45fba8e7d3cd4c0d0f265ef703bff9d7475473bdd56bc92fddf775d36370aeba9bb109cfe44c76a8ae2083191f52aaedef6bb7a37c09a0fe9e4a302186bb74afcaba27c8ed6b224f08133b32b901995cf2d278fdeefcaa8be0641f6a8b8ae4961c3353d019dffcef36e5e4e9642190ad2352bdb49e0df46936891cae5fa9f4ab754d7510c18434ffe4c5a04ec6fef7ecf96088c4c7b290b3bb753d10e64075d8794934e14a4713e281ced2712c6af0cb90296a69d83cff0ecaadd89018c54167f0b8ab066293123ec62ebf121433001f1ceb5640ff47d229f46d3e266a68be7cbf81bf20cb110a12ba71bbcf1d0b73d2c2abf27da054c132008af3aefd37b3aaf71919b2215b10826abbdd8ab197a29c691e5ad7b6bedf0d6d7f2cea9ec2621a6dc807055c2a20d3d647b004ad2de8738facca388e7fdfe302b5213e656ea31ae39bf385c8cab086a80f0636e5f40fc74869c442a06406579ba715fdee6032a208302b58fedac9e6922c984b29a69d05e961e192ab154f4cc801833ef86a4184325fb83b985ed535494c206300ca5ec8577e75bda0d996319b0649a2d7c2d5c68bef965b9a8442302f931c88fc3f3f9ad5377270003c0e108b94f3b41c7142918df2d9a5cc03175292ca3ebec4feffe1dc817b126b226127439ec78bb274c1bf3381fcd1ea4304c3920a23fde1f82ef1b6057dc07c92804bd29b3cc5ad6a6fd40081825dd917212b97482e14fae07dc20d6380336e8e17644cdad9876fbd2c2bbf676899a0a6c3372a216fd6d1b3e2e20c5320f9c3c87ef1d8df7f55735de8cd2b7e2449df4b303e239824659a3e70971fadc49a52f6c82919789e5fa3372a76f2b2bc8ce5fc91ef3793efab6f88f2eb5092f3976fd60bebb7c82110d4110c18a569e5e305d845dba23530e9420f8b1527dcfffc658e6b38abfb8f96f50a7a2b78366cfc3ce9834b42a686360f125f806cf3f7e6b1548053d54b69bdab84552f1894cf371aa174d105e6038d0866d0dabbf3be554282d1fe65993da8f431ef23a40c6d734cf10cd774e5278eed1721475d7c5939cd0f3f215845b7fe1d6163f0bc2a12eaf118e154a1a6c904fc7d7480be8de244707c17026fd31db3d6d491d3b0761436ef96245a30126545fdfbf23c7f804fd759002417bae057af0c215e46b5e5837af534eebbbc7e23ffc7235fde1309f87c56d3c192b83e407ea17eae73bb957b950bd90da3010662598c6c2e81250cd38b67335dbedf6657d8776dbe38ebb400ce8e500ec85184c29d75c849bcafcdbb0a85327d41e7034774eea884a1f08ea11dc71dc2ad20998f1a5fcd5e286fe7e40c3cd5a7703b731ab11509e4b3a1ebfe0ff0ff26ff9a737572a7e8d3b64f1ceba035e0d9734805a4178c9842b1c85e8f7e8916b812c5fe6571a99623f70c1c13ebfcb9f6b0e6a123f65c3c11f0f28f1d067de25c1a31ac32f36d48bb8086bb1452f2ce3afd73942beda0b1fd4d9a947703dc81543eafbd6505db2a96d408cfbf060cbf3ead9e1e8d6ccd95b2a37d89a01a9c27591f97a935fbb722aeda73dfaeccfa41ffe77515f4bd3d4e285ccaf7a911817a1840bd9e3cfe708b5865109e853c9172016743b9dc3e5b1b8a9df09c8c83a5f1a445bc68094b0f418725eb8ac1c4748002df123be116962df211788a3e899fe4735e4c54a21c59a0acbc4eedae5ea0ca956674bed272a00f5a776a1d684594b7fce9e86937185f39afff0a580fdb81017811a1529b19d439e7d430a5394bfcf46d252d808c9a4d8db549f8815819279ebd5b31fe5ecb43583485b57ed571ea5ab984baf155ed79e54f47421152322ea1d21ae753a6bea457e4645c367d788906e418253c5051f68c0369842dba62419daa21628e16cd3783eeacafa25db9ee6ae940b89a817d83de93408e3928a87f2c6c3fc56e6be1d0762b2e7fbc92c697f72d1cccf6c7e82f329942dfc43b3abf6d60700959f1a7f54e27f1fd0026a67d921f25438d65368e73202038068e537c4e024dd9c8c48cb06764d4c48e91acd92ef399f05a777ac56562f81b0a1b90fb50e318483859ff5baeca5d16da39fb82689514e12913b02117ec0f86eb143b00f99278ef7e061837bf2ef325fde432bd959d5deb074c5a510f45795dcdc11bdc27bacc0fd228860026978b539c0daf04c02126a97ecd6d2f218f37a2e6f8652805cb0cbd5bdf4ef3b04aafcdc4cfd61638b5007dbb8a88cc1124a09917a00ff1bef06fd6b40f98806de1eac6cdafa27285a62ae582cf781d195227f5705b630e975eec04032b8e2e69da2afd812087dcd06c003ac6de2c5bba7cc82d516b3d091abed5d817ced0cb4819c35006cea5e29f2b7ab0381e3bfd6350b0faa5898d0190294caea0dec28886bbaf4f8d91188b009295d0566fc0db9a6bb87b03889ee123b4e119452ba71756807488655fad99f5844131c1e6f17fa5244ce8fc8abe69ceb7416b8de4d0026ed751a91a9b366bba66f728629abb5089fe97ccc3a82c305d80258aaf5b5608a18d792419bc9de73db74d47bba924ee45def7f2e6045a65c33e1e7b7cb8e22ea684721cea58c877bcf790f5b9090b097d1f1302f0a703781d685a96be7e2d65d3e88a5a67c75cb219e8569b1d89dedf26eccf4ba305133a8c3aa9dd4cd28a1b02524d94579114c7e448a696fb8cb50d119d1b4d94acdeda56296a214927bf7d5943c6ef8084c4e422ca3934d45e79f69e136aa8133f68f24e1b6056dcad2e14fea31048f5943072ff4ca3b4f52a96ddc2dbb721fe8f6ccb4e772f4ba7c1293462d4fe24248dfd64447fe8145b26a842ee219093369251b22b8becc2dcafb9483a2fd5b6e3c60ecdeec89ace3416bb4067829b999b4abea12ac0a806cd05298ad0292988e5232462074895f7803837388d1e54175e72e7bb99d0711052968ec0b5a9360f0dc0baa5da3f601471b38cdd6b3807850444412fc28db85726739c8b84328ecdcd224ceb8d37fc930cd12ccf399d497a76bb66e0ce8c04f75f66296bc1a49970cc856e3ad8b72cd59ad86e93f3c6cf80f451924a2f81ef7b519dfd11df71ea4da73fbffbbe507454e8eb0455e47500dea1efe603e0d8148c55f80b2a8341d11fdd86fdf45e4948cf555bb388f635565fd480332cc0c491dd5763541a7503e5c4f7f2c660c08ce2bf933332a51d49ba83cb964ddd9613be1a8240a4d78ebf3e8022827eba3cbb7d162ad3c10518a3ff66c894abadcbbe608a48673c1ec9aa6ed26226b283887a833bd6afa37f0d6ec7ac706d270185bab211e7bb67e93dfc1311d28b98108d780bb5ba4f269170361981d2c4c0f1128d7f02058678616ef9fb0eaf2a3d5cd55a1312d269406fc0a8bb65a1388038c599d9d54b0933bbadb14e96faf23a6e74bf3356c86ac30fea7eb2af49cce9329025deb1a672e5061d8e9b595ce22ba17953c1fbaaa774e054c1d9369a0b02d01610be2e53a7a810cead06e4a02ac126e9e90d5d0ce3c4bd3464de59284e48a88082e96578e67b141d756e0489ebb80305a2ac55c965cee548d54cfcad0e34916e95b31f8aab277885f90f05cb641bfab35383afff8351fdbcbc981f7aebb83c117e02327557d893a101ed79abfb48b778660981ccae28d885740a684c636cb8cf2e293f4658fe13dd46cd2414f63c4683cce97cb3dd96818a711faf9237852fedf28144041d94e9b327431a2f0c18108c9d773380e7f47184f0ddf4d41a4664e8bf2ef3971984ff139ee2468d1df48bed782252e127874ffdcb4380e9246d5f577c8837fef98aca8f3f3de80534acc53232862f31764a08ee7e72a107d4388bc887769ad0cf02cc99d642f1da619066eaaf4ee48b2edeab2bf7b4ade69181ae947f17dd7c3ac6a112ec20d4e4fa2669d5961aec452dcd2ff6b9155a29ba47c15c152aa4b150764b871b2be8eee99dfb6112a9bbf09c3a41a7d8ee918c47de05a0f2810171394f8da0f8419225085c8db2087e84e7dda4d07a310b095d8a98f43a405ec297da5323744628ef45454c855f347dcb42f2af366b0f081c33a2afc7c2c32c612c33ac90f56aa071d6348537ad8cbbef85d66db86665d263be106d8024332f29b769474763a74e92be08b63e0a1a0636d20c9f0e5c475cac308a4a4811a34f180e84b02506338ce325d6221dad7f848232853bb5e21484c0156aa71b81008a8b1a796c2fc16bac9eefa383352919eca6e8c704a3850b50d1871e476c54e22fc58bd1cc4fda8efccea75e7344bc6bd1df50dff866e0102fc9add1113f43bd73b74303c824c6bde97e9f1d2f6be9706d82a2da301e2aca08d74b508835a5099fe5970ae4bb81ca5911582b755e5b0cb502b49275a7caef5d4d58696502fbd57451054b586bc9ebb8269c640ceac02ae122e775938423471ebc7725e8c51a3acc17d395e0a493ce9d2301ec37bf7f89c396dcbdccbe53333d5e5b046ea9e73bb917ac1eb1d483927dfcbb3e690e01b5c2a4c344b537ad6cc037f2f7c502751d322f6a6227968a74c37cf3381b27ce3689f9b4f4ad9713b949aec7e43749a47285b3a7c927f1ff329df64002cf0754bf45f6210d98e44e99756307107e0c3e536acaadefb2a24c3ba6c01c0d6428916b05fa6573c8f4119c9996a44a279554c478ad78ef5e488e53c0e6ccae412034837577cbf213db387d9e7d07c707baffed6a17abfce82c8cd5a68a8c138033553e2bff3696e4f333c8272827a8de781e1dccdc74a2e670fe8d5e9cf6c5d299a9a5df5a7d91a13eade23641dd1372bf6357cd578a4c7e0ede084ac2539cdbe5ba6d04a45d8a3c538c5b4dbeeda52127f49554b77d93dafbe113248cb631e99780274c57e47bbc6b928dadd986a75f0ab51face655edbd506844499f55c67c027a684db00c2438840b338d113e931cf92cd93e19f590fb615e59b84f2917ade0e6fcf73eef2e4c5cd0a2d7a4087312be238a1205422547d27d6be0138dddc5b7931f694b4714e342b9b01d1a28667f070839891f350005c6b65b193db713558ebff006adc2aafeebd8402c3cfd7fe5e612faf87ff42d33b68ab8ece59561ab7db48143a6168b43a263e4f9ff92c1977e8aa2aae7c3ae2ea7edc7c560c383bbad5ba49da979c7714238e56eee87ba1880d51c8b904cec934baf6226f3f4e68aa89035ece942fa0a2c657c9f8f19e1d4a8aa680bb20951ea5fdddee91f7b4c8614809d94c1b964ead2f8e168df127bcc70c507451f6adf23d6d6a8b89af1d95f113207d59644ca5c04535b950e352130c86f7cbaa2208a3f36eac03e483bd420ad943e24ccac34a16354d88baf5df76c8bd00fdb60499731c51ab8d5cf02f06142eb099f57f75f24a2bf9daffac4e414d012fdfc815341a710109f62fd2de372b66dfddad9e5e0d6aac2e9ca17ac1f40f0abe5af9f381d7968649fde03304cd80e77be96ff587939ae962515a032d0b463b2c5fc46e3eaf59f03edc4819f52adc4744217ddb3fc3e411428e198da1c6c7ac08d982d79ebdfe8405e20752d67ebcda2521dc3f311f1d50757777ac06e4842741fa282ec937f74e9bbe467e3117e2bd6523a787898b0978c30229a5ccc042e08e2bae694a6fe8af84a9d6a6c317f69e7016edacdf9048d3df3021262b3ed927288d1281e3db8e0e832b870028bced80ae810b7a095300cbec670065643f5ce64e662edb2458232277fe272ea0612dee5df475c2ceaf12e09ca79eb01fa8757881ba75a7c94044b946a6a87414ebe0e94c83ddb3b05816825d963353ff8584bc0546c43b1ffa68490ad2308da9f1f4a35ac5d17c0ca3913ead51eb946ea42fc8d2c3d2003280af2872f858e6fa38dedc209e60f5660b5207b35c2e17b410446c48e8f802c07ec57119171a370a067b5ee469d1828e3fd7e2ef5aa6d7eb00c3d7dab460f98689882eb477e2704ca7eccd6e94286489c8e70097707e9d353c7b766195ef7974ccd9bfdbbe0e6f44fa8ddac74ac526c93511b0224e5a44d3591f71c1276938296c6316fed31a1f1ec8dc436c242372e9e86c5eef7cdbf63bc06bbb07f999f743909fc0ab6b60b534de7f61ebd2afbbf1e4d2f748edb7bd9171b14de146477fc49db07df5777d83eecc1f4a37cad37dd29d06e099d108326245d11a9851a60cccb14699d0e471a29d06bb7aff5ad2e263e6ff27da36b76acf25a038ad1afc32f615b6e2f4e846f05ac406407b039b5b3bc40015fb2cdc78fb6ff29e674254a187d30baf4c2fc3adc2349054d299341e2a553d399f17597f98816c7c8e161fdabccfd95269d17aa0d5df487ecf6cbdd0e9b91c49801963d3bef894f746673c680a3c53c0bcd348eef9a807c85751ce824f906ee697478a4175129df7d6112aa8c3b5c8b53922937108511c7f90160b35b8d8393e8c82119254df0a67d997e0281ef978cbfb8128278f4f45b5a8249e5dc88e0da95487a331691ae3b37e89f2cdf13509abc34b6dba138c77a60a15f1e08ef336200e9613d9a1d33eed0a6880df2e05beeec35fd90afda63b695f99b44cb455dc9e82571ec9151fb3a8453a8831b53446bc5f8d494f92ed00541d0d9951c186cedd6bc471deb2a2970bb022eb57b1c70a2705d6f956eac897e63445acc8ec07d75aef1ee95788f6f0af935dc35bf0b461adf2787205c8e281576f2933cb2e5f9bd9f8d3033639f4278ea7a007eacfcc44065bf923c4236ccc521bdcf00ee583c9e8fa0fbd19c7f184d37d0a138f75a6b2ac9976eddf775765447d7fa20436e8cff105621ab626af502980883efd5d8b1fdfdfd8ef5a28dc840e1cd32c7e569133a2e2c02fd6731ae9f3e31f9fe196592aff965b526912553a907391e2f07fee7a1af980ab610878361e14cac23ebb9c08a8ecf7c03d5af38a08ffaf29575186497853b9e1c37a42cc3a1b81e049831054aa2c9c257260f8b267612d925332210bf379f023733cf9619819b84d9d1fa58294642f60763ae47ffcb5479285f25d6bb2e787cba8e2a828418186eddf66182d9cac2b58610b5ae07842a6f1f45855748b539a5760d133227492cb7c43fc3442be8e3eebcb48d97a14b80811d1630aafc953599859bf38041ee600758af5450abd3dfa9af133834519560a9300f9d68c49db7c3d1a25929b7db7aff2dd3dacdd5eae496d2674eac84c7917d25c6a45474fafd4fda4cf3aedb69c2a8ed29adcc805cffe246fd051e6e93c21a49e17340600d67919666dbea3449f8acb43fd63f45bca6e0410e4b006581e346fc98e0dcd4c15e9c7e37f319497d772e6f2621559b64d2a62545727cf7dc32281951a77b3d6981ca57ba44cd8ad6288b51d46fceed1ffb597281bf417b864ef901d5ce75b4e6e68292ba0352bccb3a7e479a5f668de65e30ae279b922323aa24afc76919f876565dccb723b38b821c11c8d46bfd3acafc8076bb9ee3d8145e3454b3177049919abda69cb5de4e3d6681ee0b39669b7a709626b246bede24581ace21e67b7a48601ed92d281600940b1909b24adf54187f5ceec0529bda6916a3bad88babe405dd70866741d24e7d8a9263799b9b7c09d60895c6d27d4ae3db2c60bf395adec143bad181f38618dfebf4474a50bcdef708c44f1380afc53766e0b6757736f85f5e9757768ac1724e7769939b1cc4ce10fd83b48bd3de5f6007e6a8e83256954bd790b2a4eac727972bb25137df2ec2ad9d8688746858b6d06ec5e16d20dde41c07692352fe6694506df8ec3df0ee5d7883901f3eaf2eff451453e63d497ca57aa164179231419086e4d360e8408face4496b4ccb9fc149c5277abf3d7addf19de46988d978da99c484acbe950fd49335b7bf067564c0c3822ca1d2062a619315b3484343342d7c8f96ada56bc07aa70d0e08ec90d5bafe1a3f98366bdb187a50c049f0d9b24359379afd8bd58ff4a639682e96d857360989fccb4f7d3fc7034ed0ca3ac274482bfbedaeaf66f5e1711691ad2d1d7bc076ed6460c49fab8403ef620855b520f50a5811f8b098e8f6cd89525d1e7834fc853c0b72de0654c79181f316f6b7b08a842ce30dbe966138fea97096ea50e100139378ba38377bbb222a9ca29b2cbb72b9bdbb5074526ba9d0591f15853d9db6a75923d08cfa54b21c13a1e48bfc2c0e8c8dd6a816c59611d7b13181d0a035932586bc621f56d086932e33aad05380d9361efd59cb86d97cca105958efcdc6a8983f19f1f14e2704f1830ca2ea65174450175373eaa577bd09fac3593f0ceda0255e8c8c9d73b8283cd184d372beb28b9b875a24baef3101cdfb1f3a19dcc3077489fe1e03eec6af57bce7c55e8f2151b0a7f48c78708c158f6c8e3b085cf574e50fe260e529194117ded3d4b85241d663cfe4bce1813be1ab2d40e8676a6f33395aae301687cb4a05a4ca5260c139dac4567e9e55965c85714eca50af7b3e043185b41bee8efb7073cc390fa0f2237d7b9d32a88b3dcb7af0290bc2cc568ccec1e851551f4460c3dee91ef8232ca2c7ba62e878c9a991d6aa80b81d3f19a02fc810b2c25fad6b7eb3e03842d89dfb3cad3e6cfd990c51abd539d75c3de2c0d624e24f759da80064a977ce64755d6a07afbaf87836350c55ced0f50d53a88fd54dc96d785d33dad10791ba680cefdb6fc1a4ca4f42fdc37396d5ed4462a9d6026d18b311298d56657781b9c4747c7f9734d9c334ac801e318df7847a7ea9f4af646a923374fdaa3245246659e57883830b5c75150e459280233688fff444f838089060b6a203c1382c8b12ef299273f30d98524eb0d3ee4b2a917f8ed2ddafcb564a85aebb81ba437ade89fadbb8fb5cb24a4eaef5362f75e5613a026afe9074298c23fa97026fe0852d29aef68c1271b7bde2c136a6de630bfde5c9c98f2e9e66560b31b4e33f24810c30020a8b7334e37bfd02cb40e0e56f92fe2dfdab1d211d7968b9c7f22ca351b3d78608351905d1b8a63cb32c7f23f6d18d3e7e07cf72d0cded7d9339852853a5337667d0aad9ec89adffcc7d4af00291ad74c1eae27daa89948009b0410ba4ab0b9a82d44ffa6f883650072d0c273944be3627325eab3117af6dcb81320388a91f6db3c8bcaa471b56a925db5c014e54189365e915074d217337561fbd4f1ce7241333afb20f81d5e2883ef23eedcdd0d931da11b24f87833472458e0974651e3f1c3def5f25fd18f000419a74fe77b30034cf79f0d03ec8fa1d7b7650105399811718f9ec64a84416fd57f624aedcb50899ee314b0520ab9176bae52f0a7128aa6a45fcca27ca45bb4cf3795101c566064f601ac62bd48fbecfe081b936f6fd0f18b81331f22b4c224622219be8424b4162c62abef5623df32293fbab142cbf0a2cd67e7dcc2213076491c9e13a80064f8caac285ab4f0a67d35f98207e479f349675cbc6a349f995956f544117ee6bd68a2897bad2fbd838e847fcd78534d3a80022847b197259fcba39ce893cb0b6ad853baa20d119e30cbddab3c63be7071b9dfae64f351e60e8f8ac2593041dcb6ed404589e27e696407fd5691586bab9664aa1bbf1a63f107ea32eb6f95164e56c8f04673e673dde2e1628b7c6e30c6f95fafbe489d152cb27a0d0dc3ec3e9ea199c301b4096daf75f6dd2c87e25dccf079700f8e49a95caefc977c0281c6f7edceb3a379505acd8d53a1f084039101425737109a94a88a32211b6f8801c651cf26ea9ee0a1a676498484b3fa69bebe8d3e92e705617b18be85f4cece13841f521e4ed82262b09b420f113c1d126c9f8338276ee5b6a3acc163105745a11c39e6d4c5cc972db02927b2c37f9f44980f70ebb38e27c92b39023ee9855a5ff61dbcffe413c67cc9753c15064eb05bfd39bb1815a413bcd3031463cb27b7d41ce11c6c191fd8ac456a5fb840ed7a8e169a60c3a37e84eb19e9c4cb6b1a89a77f553c526c74cf821c2d463098ef619617aefd2c7557d8da050b92ff0bdf7e259975efe475fe5f4ce7f6b3a91db107f0e6baa86d7b539502950d042071d5ee08b706aa1b0c798a2d93d14ccf7b8130933588fafad486b124bdbbddff05437827e2a2655514edd5431f2cedcd6d46441ac9217ee471ee70bc0c0c7df502bf1355bd7c4b5dff552053f1876c0b3aef84d04305bf6520c1cd42317304a1db32e721dff828af89ddabf0851e148341bbbff1ebd61f96fc2cf173ca1bbeb569e0f3f853d871421fad4a259077d2e33ee903a127ca490bfc568b8d713b8d2be1c2ecefc76e116db550f5ff53d259cf14f5f00ed99b76ec428fb9ff9949039a0a7fb0049f7ba542dd5d0fc1599f82407b28cb0d067b650c9068b00dfe4e31e98466f372f6e8652c2f0a3551234669b2c79d0ebb0fe3fcdbffa279892f2e31cc0d4cff47eca7312c21ac473cb3595c0282b2cca7f12721bebd9bb97af7f43f2e4871e3720cc975cfa6c88111f6023aa7a5fd7e39da07a27b142b4191d3d18641221cc220731837bc176a7c7929dab517e7dd087201ba339006d4e195bc1b9d15053cfb7be3580b22b0f4c3435056254a1e61eadd61a2979cb5b47615b64175fcc873f3b0518755ec8325bac1de3ac48999ad409df5f0a3a77b46b5794f16abcca8cf4b981d14efd62ed5543382a64b1ea17bea8f46a104ed90db3fb4606aa60777c7b82931684c166f4830e120beffdcf012ecf4c27ed9774fc636234b5987ebb825e6b68d7c2e5ac566f730fdff06b9638a884c23b56f9233fb0cfabd90a39835eebe0a32575de9b869337fd8637b1794f1025d710e820c49352550575ffcbec226166ac41903c688b4485c583237a0666c6a1ed8310921b5936f5bdeb3ca64abfa7014d5902c93d294cb39f6a74bd04d5fc321824c14a231ab5eaba74685017e8b821bb14ace5e07ee2c0aad7014ced092293e82000a9e95fcb134876ffc0fc1af469dde3ac79c9a52b73fe0b5ab4bc8697bfae2cf196d5d31088630ab4c597414c8efc67fa2dae751e86cdd48e1ba06e915ac0fa32bc0efc3dc11d4c1ac1b2b927cf7191331f8209421e2e39e0c17e6e3c90742299e17eecd7f7cd3b291dee84aaac32006fb8642eaec3582f36e5361c55b718f6a0af451e6988e01d039d5b243fec2cb5e6f76d43cc0ddab4fab2742c630093cd92f2b25f9d990505530b5c6f13810b7c1dc3c90815ac5ea6db7cec2e6f7d2018a82e38720fb6820d36a7ec50121d3b6a3fb1519ea30d46b2d4588f60b9a85be406592494d42c636aba6be8dbbe823ed9e83526444339dc8f707965e05188c6178c4c81c59190b2dde033fbe57be999335d2bc4679c38c3408925f29e93db3a9307ffd5fb8502edfa41a2cb970244db98df916e0e7d76f73db4d313298313f90a2c98163f0dc86552dba8584a34088d93d7ed1975a308910d10d766b5889cb33a17569b167945f5b32209bbd0ab2e7787db5bbb704cf08f881f10b46dcbb965272c200d5fd4970fd4422bb2453c14ba3095c3667e67366ca6e489f2e1b29a31872615f8ece92173ecfa912e164599dbc5937b7262beeb44132d6c250a4f815b60843ed793c7d8e578b72f0af474355ba4088a18dbd179921c88d49c39c3649a710b94513bb604ff56c670546f353cccf891c1c0b14c29023406dfe790b00da0289315204738648c12d067278463b6b3527c0577268ed2d7fc8c2393b8005f1f9a92da425e41044512876a390f83094ba6fb7f1cd0a6f7e44943ba8e322ef5e95ec5d9e373153f6a28f9e87369eacfb4382adddd13856bfedcb6a7daa4b5a47c6845b3b4ef34426c2b2af9023e044a6e1c38f4f8ea51e12428df4e4d0a0379600d95b6ba84d29ec07d07051c72863478b42808dcf8c4ad8cfb33fd3bd91f3f8618d7778731241b3970bdb1e34da495e4a1e2b380c6728aedde3b6d1ce2daac06e91a1855a0b487d013e8e9fb7eebf1727186ec011a5d9f852a0b3700955340ed1e745e64c524939262392789cd99733f712136af95869741ecbc9a82f4744ba0ef2f3edd257ecdac76368c42586fb30a6ab18053dbd37fedc6cea398d8eff9da411ce8341cce63e12d0b5d87223d9907050de9a9f252911f745946c5efc472e5c845fddc0b9bac65dfcc9ce5cd96f8b2a85c3edaca5fb926bbf57ae23d492fd510ac7515ebd7375e559e54174f6c178352195ab9f1f00b1478fb54f7c10fb6c7fdbccd93236e9dd5cd18568e3e73fc909398d06d081a3f52b058bfc345133f9bfd7c9641cabe1554df9c41ab7eb0528569cfeb0a2bd4a8980e6b8f3a8108d132157bb27d41a68b6f378751879f9ca01ef1eb8cbb177c9e3caed4b2f8921ffcd3bf13a0246609a0ba460a5d338c1008e674c2e62d2a7d7953458d05f663a149df810a0db0b3e88f3a935741a290eaad5ede73071b5d6640000c2da14a0525bff4975b8a6565a32b0addc729361fa02ded591c6668e5fbdb47e3ba17379323bb2beb086e84dac374e27c146e0e17a3ac5a06e1bc5ea1373f53be71ffcd147a53926b057959c2447fbb3143af5fcffe33310cd8a15ffdfb90d231a78e2db9986a94e0445d26f3882abd76944bd9099746b0e790a9412f1cadc1d60f95947ddcc2f74b70c8923fccc8d432930a258765272aef82f83fc758e88a1d8ba601ceead85810b8598d5ad491c2dcd8b0df5b93aed07fe5aeafd97e43095ee1b7b4a70738bf43298207013a6090e080436ede978a1ea73e8f22c3990c9332cd898ff63d8b9219e0fd367f3d1ff9d7ecd1d9d926c248cdbaf926988192859426141ad5ef74d255d7087e4be0fe6589b398e2dd2755d4d23ade2c5d10403954224e7322792ac708b44ddc3a21ccc3028c592fea4ad83eea03bd73e67d4fb77a8f66bc4361bc9b995d467617b6f025b32912bdf8fd249abbb10963d14ffb04279826476f94b64976537e74d5e5deccea6d9599e082c771ca81a3c860df89bb9938fb9c2f8e114fecdca7b149eb1e223c1016fdaca66a90d1160baa4e938d63534b80a1bfa4e764207c43b4c46fe7f5c7aad54cc89e4a8955575f731231f4f552a75aec5560b59354b9423faeb8f6075a24931f446c9b8e762078a64bc9ccc2ceee05eaeb257aaf70559a8cb702c237681ccd08559c0b6b03b23489f8bbc00afcea8477b7de3e76e6cfdd7b8be36dd733c76d28c277336cbee3e181203b7f7aa25f6e3b19dc2654cd0bfb79f7920d9cdee0c500585d045782e092d42f9bd1a5ee12515434b995a35e53fcdd17a45feea0e191240c61a2113e4710dda6bb931a704103a017d54b9663991690e02adf80b1830a54c93e94436272b692988ce8baea4e2fd2e815d7562ce620f7d643628466b68f4b613fc165f934d602cb09cee8423308cdcc1bf2b204614afb7c1dfab98e9d66c7d94c2e18ac625b0d19b4682d36cafedc9d7d82247fd296bfcd4a18d791aa8cfa543d2e04e4fabb91d7a7cef2523d3e67f1c5dc9ea22750f593fb4ac4dbd03a20d0d5320f0228e2cbfbd7828176bdfb86a6641435284a467aac2266696fbf9dfcba502101b4c4ef5c8b7bdee8046f011fad36cfa517633c62ac0f8090762e08d87d9005a57769cf7c5c17cafe7a5741e750a69ca524d632aac313b602123e12fcfdb5a1a103b77134160adcea3fb85b0447ea1266fd96252deb380a6a54706110b14460e35452bfcc8eb397f47787f4177404e7c613aa3ca9808711123d78fd8392aef2575dc71a147bbc36d7e2cffac50618456e86b3a6dc588a412d93ea8371e41c587871481cdeff1320b1050f24e3625dee4850b7e89b73c9895eb54e2be17c0a55a96d75844126baef6c05740a0936c6df05ca0bf557800d926843ae95beee7b680cd46d1fd697ac116bfa8b9eb00a54bf0af85e0991b197accfcb11ec87ad6f838ebc530b4ddae55f7a7d12c65aee54595ebcccf41b53b8bcd1a92fee85b075510a28588cea1e5122e8b2a746e502e11bccefd37f813ac483819be5b540109fe305aa4f89aad8f15008246fcdf0cc75f4b08b8558a3867d36067dead3acbaff7aa43721b7102874386ec4a59a4730c5a20ece4f898b360663fe9e89d27027d78e9db8c8d8fac256a59907db173fe998d26ab881c6f266732ffcf8a62f02d8eeac26ca477e9b95576d54f0d0ba4d38942a3d78da6c713bcf82db3c03ec30578525b1aeb9d8c30ea0c8868bc5273963866738d9cac879376f73af9d63b829580a5c2253d25d29b6f7bd2fade52f978a9b6c1831c1af710bde6ac3ce9e4022898013dd1fda2df6fcc469d0e128a3c8eb8c8f3a97cbdccbe468d40980e22d0356c41999d2f8c07d23ad2d0a93de39a126069ea283d630ffc817fef2920c83f68fa32c0b355b3ffaa90dfbc7eb0e544d4b88ccdd7a045fbe1aa195f2e956ef60e48403c01662e062a0e51d0baf9970c65df8cd6476719622f44535a30ffc72ffedccca587e7c4ef614faf2d4b909a111762e340af516dd37e00cdd539659a84e8053afb01ccc3880edc1aa3829358b473c926bbf4f786736858101dce868c3ea750c35613b7c19b4884557f39d5936ff12ec5dbcc031a53ebe793d500117cfe38e709cdea7df37401fffc6c6f09aaf3e8a37516afae8050e3eb7e1573396266e1dc510ae92065831018c2b304ee8e86f15e7f0889e9a47508611c2de57dec553b6897fecbc1824173251d4c47f59a4d4ff4a52d08bccb7b9b827268035700cde7b45d6fd337da0e10bf2be4b8daa7feb079788f2671fe6f35556dc5add9f5d8bfcd71b981c60429585aed0c9f9b31ecda92a85d3401e4db6fe83faa30ac6eb8e2b2b32982d39823d300bdd4180440bcd6b202d0e8e8072b2366a82b2c131e35e8bac3b53bc1882b7f3b9980034e1cc29b669241b42ca5ca3757fa9a7336feaf26619bf876a8919320264d6b35b52f6784067542bde37e116a5cb18e804835fb4beee88c0153d92d58ba7ded70abfa956fe24273821a7812112fff2c5a6d186ed8df55f592a4fe5477dde193e2e38b649a503ba8b68044e444a9337cd4e99d0d9469e25d315bdca62a9ecc4e2f67ed67a0c316323d1ab673fb0bc7948202d4cd0e07f5a1aae1e046416eaa528c0f83b011e1124fa60aae01480e3f2e377c0b77e93336cdf0faee38176b79b85cf747db8de79a5da47ebd6f052fba4a8397ec213e7bd860b7f7525f3911d74ff93d167ad96958db70bcf5548f79bbeb8c1117aeb94e82c34de0bd9ba0be59e735abc0c41fbfea3aad00400fd9d8bd44916824e0741b87579a6642df1a1c5e221c6053abf647244a0ce8f59b91edc78e66c3edca4e86f3fb49dd79b215cadf7496ee08ad09239883bc46289f9b32a43e68403359d49e75d361522ca5cd6b5fa828ad94fc4fcc9b6c764c253e4f92daaac3ad8f789641bd05b2630ba17d0f7cb6487599fbb70c62c129309ef79c22b5f8fccc9df1ecb8aee764680c63a5979b8687ffb9419c8a656b2589014944396221fb0a741de8e5fbbb94cc91d1fee106dde4b91733cfe25857d4d62e7e7b24b7915fced8f6a2829a9ba982699ad8f16ce6f688c7a951ae4f3c887bf32fc9acbc8681897115ed36f3080240b9e444dc8e72f1a449cf388f679ca276e6b44907627c5972b885d24ddae6c78cb12b8e76caaade6124b624a88a4f13faa48c29eb6e9cc3a1fc2380ef9b01477fa987563ccf3457be15a3a852b0a85167a94a775e59fc357542b57ace3ce36b7405bc72b67f6b0fb1dbf71f3520231928a9260d94b29b0f1bbd6c3f400cbdc154f4c4b39d84727fc9c55542ec7aec05adf0bd13bf0a088b479061f9ffca8fa9dbaef0aae92b9ccdcec415c435666a1cfbe227ab597f8917fb09bbcb7f895ea52b34566ed7b934735e383eabbb0231df4f5e7425de5747a56ca88ab691ae91b3623d9032853dfaf8c2f0d3a9c851726174d5fadc47bf9745060609bbf81a280d1b3c19d2aff63ab61c93ad4dacf56ff27b9e09328ff85c263a1d015846e52419d11f9f42d84b69edb86c9722a3651b542ab7eb7fe8deea202d4bb8c9bd8f2e7e484de9abff7b8e34ba4afa0c5730720799ca089d98fb0208ac70ce595cc6547bf7b6073deebb0beb9bce04907972b29085ca4baace9a8fbbf2a052f20b69774d2ce345722a43beb815408f086e4b3f8e1320ddf9446ef908c91eb33120ac6acc3a0f91f633571652825461281b776702d4e01e28f35abdc08d2c8c27cbcf05bd831c07b1923103c2c18f5c79110d37371cc010d82634586ce499d4c473a0c5f3f466ff851783418fd0c0b300bba98c51c3ae56572a3ab3897d0ce6c4c74f7c4ab06b46b3ee5f29a878b9d53b20d43b6057c418b183d5e2c7e5af1ef720e1baa1b2195654f43d213fea3a189f84630fc34cf9ba37f2aa31bb508114d6c8958629ef3ddbc20ff1de7d7a4ac7b940d191bf41ca72c9c850741d50471d5c9f5f55f4f74df9a85059c6f675078cefb2cf6684cee7d41d6ffe7ce64e09b248ca8e77f6c26fe3e700039fab759078147c335261fd42b2cc64abe93047fdb33147f11c3bea10832e1bb95989092f64a48613317ecbce6c05490cddc7dea4f09730d05c6db1ada827be84ec9313ba187a57b93b2a412500ba2597b6fa54315b19cc23308c35e4673a4ca59dc7a9a655e77ef9130dac743f22ee66aa2f3d332d52a50e81e0d31205499df5ef7f3c58e8b8b25f76f0f95da61a4e8931bd35b7488be6cdbe8968732af1bbb7f3766499d522e55ebb213b8b16ac53b7cfc8bfac398f2fc2586d74555a0661fc0413edcddebad983b0b0d3a3efcd2f2c27956e07b230b726d6256b60753c121defd16ee332de4428b0c981774094378f53dd000c12add774e6bd7e01749bda6c3557fa39087c8c450bc212af8c8d3b79c00f96f22f96b369bf04a4160a0408eb0dad591d9b7293624c2afc7300d47eeb82f4961498b0616d2a83bfaeaf765f2b70b29a39d3364ab091c6d33ea8fcfefc2f9e39869fa6368b23ea62713adfd382db380526f04fd00319e25a1f421679ba93f106e995ac1d77a911767771dd4a2b58660865733e97e5c8bb87fd756d26d66fed795e5820ed7cfcbe36622a388de9f98f0e71d733ff6a7a92613f7899d5730225912895567db75d18c7af60c9482784a58497827356041a4e17e8e8e8bb8b281c1509d7a6d1acb22db8a6be3482f2b7eb1e4b50f88e757aba2c193badea77df45a60cb2e1524094d3e01802c997c10f075b9b3408b32c21d005248ff66cc34bac85f4523f4d2c725665480b6ded5c00abe4cff6c2195a19b23b86236fac012f86a25b36cda8fc75e615bf186892100f5bf038bca421ed19323e426d529842d257f1dbc790d3923c19106781472b2859d7cd0f9fcca776d39a4cd892b8da8245738868abc99454954d61a99069046dbff8520bbb2ae19b57ead09b3d3430838148e609c770d080472ff8ec3d597e5688653224ff516d21c242565b8a573a6afc794aaf3a69ceab76be3038adc2594a0455c6abd5e0952e70fe7a0659b0e2ba172a92cc115124163668930baa46ce4301a468bab3ec04fe94e6fce6045e31aade89566545ea10c39ee2eb4583458e985291176edd7998bebd469e3c803fa64015a16e166cc5495cab92f9ac67dd7fb73c98cd610363e658281c626310583320cbf591adf9c73140ab89846e69d04dca6b9b23b54c1f3bc8cc5df197e68a945e937349cc724fa9a5068fdf3356a7e05a66d3961092e1a9522917c2015025d24f4da33737b938d8511c7c8101c571d75e62ba4aaf0fab784764a5fc8fbdfc4d5af9effcd78f0712b98d7521038aa034a9db234ee644f10adfc3b8dd6296559d5a15830bf243f7a968eb06d158c3fafd2c74859f7f4e15e92145fd2d4645937ebff8be3acc3d1ebdc1a2c3ce902f49b948b0d85b334dce22a2e9c55a51c32602476445adb4245973a194d466728864343062bece5e1dfad913295899e308391b7445978e1660e46fd672b1782b3e1ea3ac600aa6a56aea1e639634936485ffba788584d5bcf81edebfca6be9bafe9cca7ebc5e2ffc1a0a7389fdbf7b24970b512615b6c793c5a307559aaa8d04623b0a4fdf266c8511276a39f2062fc163ed361fa9386f2a470901ec1c2c807fb8664dfbfef9470a2d251090775cab55b95b2572f775e85128c090482d19e279e32f80c1bcd8baf8dc7fc23be8c7d98c0b0d0d4912948544e712aa90fc67db3810ed5a00f3eac723489a5834052d59e0d667dd52e17748af21a7a9f693867a6c32a2b0f5700a0593902e55c9dcde85696fedb26bb01cd52f27d4c3fcf852950fb33e1f0d689189bb40bc50a5fccdfbf2e0b2f37a2b827b0e81ee13e876d0c86186c63fa11e2ce96898a16965b569c0488da228e61cd2774200040302e658aee4e4f3934a7dcc589630eb13588d92afbea97059125e0e1df849e0140f3f7278175106ce04095478a8b1afc3ac4d3a3bd4e65d73d800409d8f5b7f087e03d030134f83384642a7e7081dc520704fe3a067edaf5d50ea7f718c508736805c826ee51dd745811dc71b4e3d4570de5a980e835391cdf6270b44478b5f56ad085d58c099393551faf35c0942cb15f9881452c1f7eca5033645fa29072a8fccc32b62acceeaae50c8f402614ac67f334707e3e0d2648ed5c12cc66240b81f95ac08e47361a6b7084eb799a3c4e107e8b3c796de047fea598a56c64f6463e2fc8bc2aa4e3500b64441c8bb1bf2b690169b58410905fc173d3feac95793573cc8778bdeef581cea2d057fccdd087f06b753e41534d06646ca354352773a1cc955e10ab7c875a05a8e06467b21818c9a64ccab5819eafbff65d4a72137aad0a578ab10c2f5b13a73572f4b96f0b88d0cde5260fd95fe619decbb58da7b8b4b38d80b4cc100ad35790d7b832aed88d9aae43dab1cf4869e758c9d34ae1717edb53bc2f022d9b0b5d32811e122cc08c03aae1f0699a1bb330d3867ec1f8ed195b1503063c0751fb82a1c352119c7ad847b3bccc016485c886b9d7a3a08a92042bf8781304d0adc573e55df9c34308c7bfd5a0b75e7676a3178649ab6f6eac39aa11724f5b7510904deb7d8e0edd9a274078286b9b8058cb2443b592d5b817d02e0f6f1b32da51392ef1e71aceb04567f41122c3c8e7cea5a612df8c21b4919ef5bcfcf8fa07a8087df5094c5f2bc00a412b76226bc36cd0dcf8f3dd38f9f936ce8339627f5be2adf3a5936111aa0be275dc6cb4b4e785c259c85dd4a8bb67ace0611f07137a676d357054d2373c6196f9b5d7a8a0e9fd97e60e8300a896116ace69216163a28d49d7b283a035ecb224225546ec9824385e12d5433c0394ad68ce1d72f42e6764484395c46b8762f49f14c1942fb913a0b2a18d1b0daf9bbcbed008ac194029cdcb7ccd656ec8aa62f91fe80e6c1c0639ba39e533c766e8cb712639003ebf12ee170d6c525c84d542dd2c04efc8a29b99742eec7057a732251b0b45cbf20ce380b57d34cb98f3ec4ff558ae48ccdf7aeae1e5637e7cbf3309a8f2730bbd59e500bca5108b557b9e1db3d32af685c62e008e228f832cf27422142d74b9a6d0b7f77f2bed3f482cc3702aa78779b3572b1362ea69309febc9e9b689b8992f7d33b6fd884adc344937e87537453583c5083ca50e97d84cfebb482189ffb16ec740fe2f21fbb8f4fe8f33860bb8bd6b8f4985596e34a0c79c66861adff7dd802cd4c79305275b97ba52d77f54a3ff6032dd433a34a5957be379b835ae8ec8fdd393d43bcab62e2300530934cc9bd2b92d8bbcffe89e424c4d356b435ce620f4f4701c9e1bb7e16cb99535342d4dd57c846489ecbd44644248b1498017d0356885010185450f7dc8f0bea4f00bcd1bbc3b4de4a6aeb60f2e2a02133f2fd284a5464983657524e5db8a7e5dbdd67600e9acd58b81d827231665be2197a61df4ceda95b78620bca6f08ae2cb1e000fc7c5d9a5b09025788284fd5a31803560ec762f4c08210216a2af3845061986ec2247e882a9af63fe0680a8bd2fa294e992c68ba6da461380bd210e0348d13df45ccbb27c04c6c8dcfd16e3166e671e28c5dbba1c312d5107965a6f276afb0f4cb2b7b8cf8fdad311c7019c4d09ee08b7ee547aa2bcd426e3f8d0a274e102c2173e5901b4e2e3b181df2d9cc260115f2ba15785080255d52ced8020d71dd1adbf3c7819b50452177f69e7730657826131af2ffc80759bb4e3dc1aa2501c87ff2c7d0af573454aa266161f881cb9c47e86f35d6a94c2fbcad84c680c9dfbc0dedbfd2d5ae14c53cce28ad8e93835d94aedd3596b004c7cd5e44af792f3b3c6e29d1ec2d30d802f122c1615a26c8f75b0e5bd086334a2e9e639c21f108d738dbf7ad605d20176a9fd2ec02b851d8300ebbf99e1092b355ba7089edc9adbf11bfaabdafe4002112a2b3bea4cc14786480afe08fbf8dcff4b706c43544572ff05bb1daeb8115385ef879c3232ebb15fc9f44dfca420cfe45c35490bd1a92162c8223498549737e2b2501c2b5a2a5739c6e021aab11fb7935b9cae25617c8b34425d0a98d993cd7ab1559344d719056c7646ba93d05cc96c19ad5511ddfb5276668abb621f11d5cea14665ef5cc3f255e40f88b18f5d388a6600de33a2780bfa003605225fd59655ebd2bd11af84e5e45f2a31475ab823beca18bce9b2c401f2f98ab3ad79a2fbb70e7ac19964973d3bc2f63f1cb4ab76b147a1b1d61ade65427bd84e0af6a9c115deb049ce4686f7038c03bea0b840317dca74dbe63b5b8e2f8fecda361ff77b6b1af18d2f1be42fd71f68622d6c396e74ea578d957e6a7326924b4ae4c66b5aef41a69b7e7f5150be10f4ec2901e3d07ca948c870ea38c24121318aa0c69eac51c49e825d13f6bb034fd07ec26552cc480873f4bf0d5fca2aa3d7574d20310baf40891e3e1c5c47451fa1b1346e1b00b8b0db6cb334ac8f037f9be110441f0ca3eaa131e58c195e89061dbc46ff9c101a08846a6509bee0f6a408b356fb8bcdeaf72b992b7a2e70f01415c2db71dcc9661585b166afe6214a78bd0e7465e6a485193d447e8a4c9a46fb90363b0d2dc5adb7589b1fb597d3ab5100957800bcdc99f8022ad1f1d93de40bf793d71a6415fece91da437c0f3cbb4bb366c9d0e4105ea676defffcc73a76c6f1326aaa9c7eb1bbc9c25ca2c164df6f6962c72f55ada61e47b6d239deb5159bb4f42550411e514a4999cc43485c63644b7aad7605ac77201abdf604f7cbbf939903252108d85372646100f61723fc077089fe29734714a279dd3ed46b9a180c6f240c2ed3eeaf94e6a72146c799492b45e4492320310732d60781f91ddf2133a47b030d63df23ffebacd36e7e3af14b19e3169e7276b91a80304bc34dce8a82f9dfafb30ac190a9afb75e0ec28e8ff4ef0b13f926a3ece503c1860e5412ee58e28503d20b1d2235fa482248105acbfd112a4481530bf910499bf9af1492384731b430ae2d791ae2e5de1639e2f30aa42d2a7107d5ce7c3355e3c09285af32aaace47657ae1e8a5479b223a7682afb0796a7545e0814c613ac6d169e9c5ad57b6f0e60ac3cf176383c65f4f60d72fe070968325666d92549232a1dc8ba80ee1b60af7316329ef6db742aa66843903cd5267ef37d5933c34ae0916430d2c3779c5bff3c73d3df14b2904eb1aa6657091017d2a72a7bca8c892b94f5dae50b614aeba3066fc2d760a5c8ae3e67efb04876a218037b76ce3bf69ebe755c46a35687729f3c9a22cb47ebfb0f403b2ce92ad9b40c01f2332b48a47d0c707d0f711c4914b197dd99a7d60eedf86006ad2c06a2b4f8be9062630dced28c099f832f0bb392f7b1fd108fef76d4c13dd578246a53620efd425fef2cfd7b38b54366bca40b4b62679ad0a0fea87e997a53891790c5a5673c4db4ef946ded7f904e82a2edf8213130696b0d54e64c5e11180ec1bbd688c0706a3c6971d87573a5f303f1cd74cb33cc4fed4feef63148626dbd1b522577b4d16a3a3dce262d378d8feed44b1204189625d839364d87cf899650f39e5b0e643368c730ad640f466095d522c9e339b6d846be0296bb14ef2b13c3346fad5891e59bda424139e7c394aed9e8e7965f7f34c6af89ca72ba4d87b6358362124b54ba4b92a16b23a1071b372716d9d858d19b13f53b9a996aef5610c6d24e48a60e86b6fe99d03c5316fbd309fa0e7ee79c4387088672bb1dd4ae1a2479663fdd32e8f910b6daeaf63c4fbccb698b3da01a430fd7c96e7fc00fbfaf08a533b2ae087f0d7640a40110144ae2d1f5dc9db5e961d21d5e5c7bf483abcadd8b8e9fac8e802352ebf707573b75be6174b027f38782a0abb2f6436c4c2d1502a396de87d4e2260404544ce6dc935b110ff4c4329f7712176ab36bea7caad1d6ff6647f0fb4a5ba2f84646bfb34da362ab9659ac06781311585a1dc1eb29d8ae4e4a904f68463e946ce8c890b760ab9f6c3408ea3665478dbb5b78351097ee369461f7b3e05fbc3090c659f082d4ea7b82646ec6fff94e233c62618c36eda54f090b8cce16fd1cdab3edf049a23469b56e64cbbbaf652666f4a4a9214f3c11c8f0cac831e7f66491d568f8e0b455d4e4a0189de03b2055b8818def217d35bf4a52defb37fdf9b88b28a2a91b30eaa109e32abf46cbdaed441f7cbdcae79a5ee95795e9e39cfd30ce83de6840dd4c526d70fd8ecedf08e88b10011cad138aec4c2f8678e3885a2f4e804375c236321d4c5c04c3e3a169a5fb13daa446442ca16b9f25e71d4134fe23098dbfc824a0f52ef43a06d2d1cb393ce8091006d4eae5114f2cbe2c953d52b787ee0d4fb5c98c3a67cee0587ca9b2dc108c332201c2c5f6449aff0ca5a13ec0b8a3f186ccde4af20174b2eec4e07f42247ac919022568a6995b07c34592fb4626ca4e92121eeb5a00915fa30679deb3c3c550d18777d23f26bc15db5f24a03ab9ad704700d5700d467309972ddd2524fd8eabb27d6c518f98343ddcf5e3dd3e5e34dd0623d6033507d7d013d055d48dfdd2656f058679770f735b5177b19752dc2f4eb894a1ea6e305f516c6504733695fef10ee38ea059f05dbbf14434d24278af6bfb263988ce544678979102ff3820992b1620f06d50cb64cd5f3b8e2cde752693035a77f9834634618ddbdc8e9ffcb7f7d28675a4ce568613d7ec2f34a880c59b8d4707479511e74dba001c1b9c0223d84b0c43fcd7acf8b81459e409451d0547fed1604be11d13e62e3f481ac4b6fdc34cdf74c7d561e06c401237152862cca3e6831c4651211316d83775c7037c45c2c42d541842bbd762c255a99af32a21e795125f1ec7b0a5c4a242b4c59192d3e7002044af0076a2ea9e4865ca8f14f3737c1f5f3a9237ce0ebee9fc9176811f8aa4f5f6b92725b6673e859de298f4c5a20d4b9c62dd9b86d53742eb97c99ab8f131ac61557099065c5667e95b3cf9ba8666902cf83d7da693a990acd463cefdfe75b4f3a12a1873c081a42fe9688ac5f20f80f9cd47d1bdc1e9ed3c8ab4e7864868b8ec2ce3eb1255dbb15c18a2baa8e1aa483ba10ba326b2075d385dc130666b3e098280302753d558aa2b5f872a0f010d37f046baaefeece7c556ed49aaa7e77c5ef2a6060b58d661a7ef024c5ddb57d82924252d23b77963217e3d9a196e7d0b9c33d361b54dc10ff4cda6ae91489a8235b70dce794d90d1016b7985dd32874d8905df07a531cd84e0495d1fee225ed8b40ff35b4c34d9de3ef83a26c074853ee6340c1fb69f353ee4c9f1492daabf9988445b6aef5f35bb23694b71f1809932d48d4f089826e8ee63482d5d6cb79b2c125dfb2c38e0fc2eefcf309db009619e6deaf0bf5fc01abe5d50faab7dc5874aecf75ff614967390c0995b53424c09e15ce3533359c6330fe5db5402a30bb192998b87966304887bd25b2aae2c817b08d504b6864d75787e7441ae78f633577a48c3ece7c82bb65245e65b683736c5c4b290521dabe888d6d07d1fba641c18a85e599b7ebc6545014d3c2a1322f9e1c771c2a6343c418ee92295a7143e45d353265bde60e5cf230b14cefe154b34874002c5a7a09e0ab3a4b0b995c7627dcea2635b36d1bd515c17a929124f1cdc177b4fb303435471a460e80a499a6b3b2a590ab08e76748610a2df1251c3ecf251ea63655a1e8d142daddef03476ffc6dfa4d6a08f7334019a4f1c482bd84f4f831cb8ff7e2887312cbe8a3332f5e182452968527009d0cf02dc0f7e028de7beafadc3a6d68205fa0b70be25c254d7e3a7b69e969cd4e4efa2ea33e93ab4302a2f1a5cb25f4fbd2af0c45714bf4318fc8b2c98fd3c250c289cc34f7cc8e7e73809459c6511a1eeea3dcdacab72a2d7cc0751bca6b403bc215e7f98548addf03077f55f90f1c61d15a4e3c50721d398a08e7096886ff80c75eb2d76e571a62646338445cb2aa2b02578d95079ed8df1848a3f619fee5d32475a0b0004b4b40f06e3e4cc50bdfd6de583b162870d0a59e1c18d2c466af8a706c1cecb0fdf37a08d88cdaae7f9e5aa477e85e1ad51a40f9171c151a1331086d8449de0f8b33bed17c0793a66f0ca5c47436ecda9d25e3d5bc9da5c70c6c869b811b123c330fa45dc64d7ee75a9fb7ccd6cfc55be39230c73c5e99f8ee403e21a0469956062d8bfb243fac968a6991e90fb2a67aa3bfcba8fe0751214a99b7b247b4160d744aed04592d4d94ac0a7a516057a117c52aa19bb7815eb0c55642b89792b7984e4bf20550ec4579b7a72759b207bfd73c462d55d1486785f7bdf2ee680cc428822dbd5438d3f1de4a967f948e3d3c5ec65bafbb5d04243c6bfb37a99c6d314885f157e50b2954b531f09333664588247d10eb230bcc4ce5abca2a5c4dbb95d0ca9acadf17cdcd57298f5b6ee7b1e9d2537d05f7106187ed132f6f945d19b31f5755265d9b4157f45d4b529b3a81ecc756c1b0396070a0da0864af55f15be8c174a6f3b4ea2b7523e72d0dcf1f92cdb471a75646a124e95b49b517206075eddcff47d4d03b2d5d7e2f4b022074095d13f0361be4cd33ff9fed3244e78b2d0c95373582c213d195301b7d045706d7a0a1b85931e8a53547ffb067f79573930e818e1b24a5069f56533873f47cb0baac6112bc5eb244f206b4db6571bb79d6202844b59386c4b81021b6547859cb8b38d03b7627d34ff7bc905bb68cd906e7f55cfe37bc48d90d3a30e2e385c8a0bfea6b618bafb398f874bbd17366e7c91dce4658098491eea5ecaa3c4d3d8b60c6692b69e1724cd9e5157feed0fa2119a5c0db0018f580aaf9e8f84dd5763bc0b59a0e2fc318c04eb9dc0f983c9ba4455c5e5cd0c86098d85276345d7de2e066000a865a1fd7619a906ab0b25a1d4ab454b69e26f4bfcf0aed24d79341ac2e3555baf929054b49ce193d8a8e251b913b3ceb6de321af3f6c49dd0ac64ef5f01df95de8d87fb9cd589f1a60b31b9c772d0657eb5a61bf20fcb4192a4c51d546bab1a11ae38f44fbb13f0b357b3bca47a38027be4943a302a50b5b6594d4cd29bdb69132ee57b38f9f6d65d2cada024b196178797e5e29ffc87097490b1fa9c59baa4951d193ea7040548ae3c72670f9d34d204e7fbd2d35098bd670f586d8dcadacd1a3bed5b809f16ddbef2eb422b31d2b65175fe5336471e1e1794b8c2bc1d9aa07e95c2212590219e8e0b94abedb52d13d2fcec2f73eeabbb78e5e2401bd51b1dc1d6fdc4adc83dfef5994a1eea01a3204cc255109645aa52b7efb8a94430f9f0ecf4cec381cfe2adc18580b24a0433dde1ef40a56d0c3f1331d4fea84799b6996deb9b0b6ecc05ba40de3fc1d631f389f681d6fa94a364e82b3f44acfe0bf3a83fdc884b54c5282266274cce657729c0dda18a54185a65524a29ab1774ac5058b3a4310133a73b0b2c7f53ffeedd709130e341f2226b4c05fb26118cc10909ed2541e61eb10b56ce9e4bc9952b97631f31d96720fb5ffcfb4803e4d8d8f386417be6eb35433123f136357fff47d2db47cfe6be0a8c780f7c8a62e9bc89f87d2a56c3b9cc4fc46773030a57b6769b15033fe74c2260c322b2c8556b95e898dd92057fef0695e6ff322b20e7cc88412d53757f6af284b75bc21835a13fb09db469c00e76467a4a955384c030cf702b10b1a77389861ee25a427be5cddb9498be6724f5d44325da2a75e0ea86c8090de01f913466d0d5d7276fd16f058665ce2c193c27b2b74bc3019c8bdd314c6eb125d8cf722d15086f69c0669db26e09a87247acb360062280cac02d439ecd13cbf2e4c42fa163c9a34afeb77de9b944d39534655ee980da6c519de8d59cda47722065c653f753ff813377a236b547312a7a11f0e544b4d23aa23b9641181496eb343ac70fc8810798f677a163720c412ff6bc536364c068801fa2ddf4681ef31cb6aa27d47ea4b9aaec7b78aee30162c2f82695997d3461291096dae4f24ec543358423aac773261d6ea530d3606b4d7698114412ff0d3190ab69e803d733cab8c2a6c3f5b3d273279ab1bcd40438eb0d0e9bac9367ad3e998421edb2815158e4079f1ed694593793789771d42ca53cd61a71bf27f43ae2fe740c7ced781b1289d9737fe743bd329ec6576fa5e87aebbbc57290e9b3bc6fc7505e5d50ab37c21f6ea53b0a8b7295ca55678ec895eb823686a9242d52b02779da962e63e8b90a6f251262068d7eff7570ae885f1fa46c39ae52eed0a44aeef10b735812db04a05034992ed380abbe4f6301aa00a37d484e35d856eb250f54eb45855330e3be7ccfd97d091041a776d897147f9f5decb5b63a10210e723761b86c730fd1254e098db81fa16a1333773455dbc47bd42ea7e3ac2848a6433a88d2ff60ed76f9b1a4af2fe5816be8ca9f3df6c0f6616b271b537d4b720631c8fb53b2c7cbeda7981bc4b0c783c32ea763bf8628487cfebaa83bcac3b263cf97a1095ad91e11d9c59cf92fe5aefda52897de4c9af5bde3409a300d04f580a608e3a2ae3743f2774102a7e912b89f52f6c42779fb2e60cff4162457ab792d1834be470333732517031f5ab1f2ad979aab64ca6455ca0fe2e45ddc7a25a3ef3cd15527c22f4c18e3d137e2e59a552874109fbe0ecd0e62efc68b6839057b10cce16fcea03a28a2b039ad1d616d447a135b2c0a0fb3b7e4fb3333b03002a95b31fa4d959aca2ff8851366b1a6dfca2acc91d989a010d9b025ed4d66fafe167493516091c419a994245d31c7821bcc4872dbdd410b34e52c3356b16d4d8ebad9bf88d926ec21779b61ce9880d543753621c21b583ab281f69f430599e74e5859537c65d237fcedc39df90c7b5a8eb4ce8fa674a10b4b19e073d5b406032c7870fee39d837b6f7af9ff532beefb6850e7eb3e28d4f85187e2a1e34b135fe8fb411ca5a73cda403c4192c7bfab14c7cae324fb872ac3075385070c9d7901e1fc8bc37fdd85972310896fd3a750daeceef797044fae855d19a4115b012e19ea1df3bda19e7d20b9d9b7155bf16318655deebe7722e24459c4e217ea1bede28dd10ee9bb7c4268d71014d80aa4a5a003f5e8fb5c6e9b4e41afe642bf3d6d65b35b3112fd3112179608931bffe19634e53d51570fedf0aa9c88d06d1935f68250d887a2f1155e950f449e76f5af061fdce9f560d58384a34a9be2be62a89ad04629d167b3ffa5c6ae02a812e20734b0d511bdd79e0e65649ceec33be0540286e7af341075234f39889d1605da8ed7095a6bec98623d4de93a07ea2b3bbf11ccfa2feb235b3684cb0959f5ea9884bbdb61cb842a4dd09856d59bbe065f8db57630afc703f0f242d91b02e03203ee99a01b065d3c929f400f4fd87e8ee33fbe75ae8c4226855cdc9eed4735523025b2b4eab61eac0b2bedc9391939e03412e05bb41883b2927700fa1317cc2e706d918345f89fb48ac36292efdc6df27d590dd2390248f94e2ca19ab48e278ef9ad862d1b45720124727e2c90511cc40efbd497cd8e23c864a20e7dc9af5618bf2c5ad667022037715e75639483eab64961fed96903ee2176f3224c2317e0a3171e5b2cb6ea07d03618c654e3456a54ed57c43954dce8d33344ce324c2bc7cab966184a209e70f3278870c38a93305081b9aae68363e5388a38474564c5c37acac6381a1f123506dd0de4872c56f8855e5a786e5994a13c6fb607ef55d75479dac28b313f6d041a9872e844ff77cff63813f2e37ab7b599ccf3abc786f8b47ba8962d4cd6c8527dd5402d896103601d5dcbf75d21ea5d597df2676bd85e2290a87a6ef63fb68813f77b37410ab43fd0929489ad0583514cc619a7a2d0463d21836b0aa823dde3309a7df07e8477a8d72aa5c770729c0c9f324856792af338c382110549057304f31cdec076055dd11e17661f18058cecb4218b2e02b96c529196641ad862c001d11d256f9701b9b399e6b97ab9c2ee8fe6ec3beab491cc63e58e70430bbef96024e18f0f69926357037d17aea22ef2809125dbc0a9b8c11eba22f725e9747f60e6d1ebd95b0a9233541c7af121fa79f920ad1b26b7c76c436d064a1ff766d7cf33535a9a9d63b9f553100a5d08fdbe0367e37e6b36802b870682839452e663d1f758ba9c77aaa5f3ce630981c6a77ce80266e3e84a60057a97ddc2b7224b7f0f15b3ac7f1e2be585f55cd396abee8d0c86a917c13e9220a863086ef68f8656c55f97816f8e626c82a5d0ddcb78f11bd9b8b655eaca307a4a87bfe8fd9faab7806845b5a121ea21f15416c9addf45279619bf5524bccd1897ba0b452c6a93316a6c2c2bf8826eed3b5b3091a3183d23b5a1155f1586793619c07962a7e41436cb0dee07ee8d1d664f8c0fdb9104dde8e3120a88efb811be22c54ca4da51df640703909ca99176cb96eda26d81d246486e0843f8d72f0497082177dcfdbb58623d8f8ce0e7526453d3068e6a673cca06ed1974236163609008f1814a13ed874a20caac0088687c1d704b933af5ea9555418853cfe1cc5e6210060317681956d904468d16f26e405fa1b357c353a5a99e84650b095e371b95e17cbbb90d5b2b09c54907bc450b98fb3971308079444933d779c3621e63789efbb2e14f9c63fbe4c521212d703335c750fa026cd72c2cdf68c58e2be5e5ea012f8dfa8079b14ad2dbbc43813cf3fd78ffd11800660682f69fa27cc657325ad1d1cdfe8f1d1474bdb8c815e28a6261b30e60162443fcf2b3400ca5cff85018ff6cf4c7e561e578027987a1f15f3b945fe8bea70413b8587d3696ed7a7dbe9b6f1e914bda66b8daa329cb4243c4d1aa15e0435a6ba83839cbbe9c9f0863605f646b31de5efec31b8d70cad723414f51966c974ed94b5af88fc831ce8d1867a9ca068db74466bc178cd61e9cec3c474e5c47eb595600a248569c032a6e4e64b8d9240fac618f617018d107a8718c0346d6cb3ce7d255a592384da139de0dae6ca6e55d946a2729eb0e36ce8a2e29540d27cefd7439072c96e86adf082e4ee1252d08da6bd022ff4172566bf49d78b2031f4bfd99b794d20cda78cab45c431f63158f9edc310f041226f4a4e013ee9964dd694c01784f540cbdbb426f705635eb62f0ceaf10e39e13e0def922e6079f81f87d1f838be55c9ae33d83061b9519527abca09002e255bd3e072703d13594b81982387b346bf2635d5ff10393c90fb7728eb2acf31f1a322fe9ddf1fee5cf00466fb11a3df4ae1069d20c405be3861722e8c64b0920ee824a7158c0946e2dced9abe43b94f10be32a361e9242798d39b08614db13f2654496795a1bcf434b73facd1a9c98489f7e542b1e693e5f82bfe79d54ae31313740562606c66e67fcee470c3becff160fa8033a8cc9dfe551d010bd9504da7c495454cdd763a0421cb7216c5da50ce4a492e786b335a4b135f2cc8a3877949556e8731c7b43c9d726f248c661c11f7b8b36b4ab47fa12d1847d5496599e0f0fd06d63cb3f77ddc9bfb990fa9d835dfd2776cae554ad9b1f128018c29b8deafbc33e369e86f90bfe8ad1b9f87a74e9a92c2841387c70eed6ecac99b7aca55079424bc8f13b20456a0dce6ae9a1854c57ff44b84922a0c634b645b54863ba400b79a9f67cca156b23aa19d3a48ef1f8c114a13c653cfcb7e41b6df50f227e374c58e7f18ea58d2cbe436b5182d5fd66e4909fe4c7d0cbbe779ba28e4988c4f503b6a9d69f51c287f432bbb7e3a355f51b552b7b11352294a59586b6a28729ecd8363ac5380b0fc78c753e695232484fa0f18775d0d149862ad40955f06569c85670c9ba9214aad19d616607f61b3e837ab53859761b408f38254ebaa2e1431f04f32392141fbdb5683cc9fe39c5e7b11d18eb0fdcc9f6b955a625a000985f2ce5cd8d16e3cd07f47dcaf38138f6b7a77057ad342b37b79f4483c8b3a35366b07ed596bc81a591fd06a31942c8355663832a8f9754a26e96563c6ae0a9391550d9d91f4be68603389d2094ebbfe0f13eb7c3c29117b76f4a5ffdf808c2946c6b817433ffe8c63564afd291c9620ed8589d10dbebae948753c439fdd9f6fcf0ecc1aaa6f5187e418e1809802214af5838122e49f8921cacf8b66f512783d4726f9f256b891e4b9a5f83a4a5d37de9611523979cc99c7ed14a61eab79c1e0d8d1c70e41989479d8589e1d5ba62240b0f2f38518b9d6aae4385aa7ee2bcca7a0c62e6d115dafbdc642d548fa18aced4badac7a84e3d5ccf4faf4c1b46114645ae4f8fae90e205e942dab7ae375118eeeeeca5b88ac2ba3c6adb93ca1baef509e31482c3600516a5a552c5f96098428f15d37dafe89174ec793e43ee406d5806250d816989161eb2f2cbb66188f15b189551be0b90da4be5a0249d59a5fdd55f98274260f072c8ba2c4ec54e0230c0827186100c11cf4c914d22fcdfacb4f28ab7caa016337dab73c9360129b682ef0673fa4a5584946a483f59b22a077e6d53c1fe7e461c906559ccef366328117fbefc2147c7d8ee756db1c8b6dbaf88a8bf34209a08c662c66343be2af87edfc04aa811e64c243a67c740b3f3b01820e6034a6a6a589d804236d6baf64a53017f488fce919e924907908ba97f429aaebe9ceff283dd026f6387c0fd3ebfc48aec56edb2a76bead4f0b4f8d07b089e73e60c98b1bf8622bb99ab19f98cdd52329544df70400981ce1ae9d27a3f60cc916e3e34b8726f05eec2d02433473d97e89ed628382fdd1205b8596c92cf1224100a92c521bcaff657abebf9c52912321669e992c6440b60be6a7b8d0b4b227f8c7fbc0b05ba5cfbde99c3a3046b1fd6a84225fbfff7cacbf0f9b2bca6baa84eac1df797ff71f5d0359a825717b40d2dd23c74a4f96b780564c04ce7214b71bddbbeefa7ef077b1e0e58c014d399a252a9ef76a57531a8e9553afa51937049434ca3693290bfb0c5bf43df25db2787471c1c51126d6d355fa28acb4878f2be6d5727b1c4e893415b5d2642d168de447090c72d12404a0d745a05bf66d6a86a9700e47b4328cad422c530c04cfdb560dd5e10bbf6abdbe24b3f216ec05b750b412b71f591b6eaa119931b8f3498b45dee099f4b29039ae96a3d71ef7db351971f09813f5bb37bf2d2d0a7b476b813eed4ae562fc1497f55805256d0b541929d01febac04d2c58ac9073f837d2f5b1ffa41354e1d3d16114dcbe6104e8c9bdf6f785213d3a4f90fe7dd3ce86f518addd79d8e2c7ca20e621493875c1d896868cb8f95e0b07a1eba8abf0c31a74bba97acab9f56a7a6bf4689c1adf5020549457521fb1720028356d605bb787d6f1e1b1708f97c89252df1b612bed1dddf753967cbca6c5c5b0405f0e20244e9eab3b9bf31bb12613173d6be34dfe8bd3ba39b1c99bd8cc3e63423a545b757392ce720530a446aac604b0a3fdcffb8a6a350d0a960f923013a4740ce4ec3382726343bb4eba2d0185d4ed05ad99d6c638e2f01a68714ffe596319f7e92e39abc2fa2a3570f4c74b4613917aaaa752ef2c5f798810b0c46803ff8e27736afa692c0b27c6eb672b9489f66af32f82c3a9e157124bc58c8b4659b7b926e9e664f569d0792285ee920560598d6bab150b29d8f2b36ec20dcbff28e41affb9a6810e97524df604fefd83485cf4bcf77a0ab33d99e7781290982c6c3e70150cb10cfab8e062aa27aebcf4c76b8c22f36ca2b25b1e73884812feb64d8227518c053d45366d86b6456f1352c7f9c562818b9455e4903beab774bea9f7e4b01680eca0584d5f4be0ebd799f3689c1178d6b9d1cac784b9cc0e3f8cc98d962d2de08e1415ad991c16ba70d0e2feb2ddd1345890a1a45abc52bff2087a134eeb90b326f3f986ca79d9bc85325e67cc3771912cefe170346ad979ebaf22f4bd17b71aa9e2355d5becd9fac838d4ad19edbe9292879547fbcd34084a47ab85ce6a89deb9781b8a252bce3789d7b839383f1ad367abb94b4cf2e256878dbab8da6fa62f2f3a6e147bb82e0ad888d8d18bec682b656566227cea1dbd8dad7637d32cc24294e15df1af1c679a9f6df2b2704880eaac543160fbceee79b28ea6584dcc82b3edb67fbdf856922f34bff3664d8e07d70cec39930849f3d7373b92e5837d6b5f9dc7161c72bcfa156d94c986f4a4b0148f2055261800f1d9a309b18d896c3c97a2d945c2edbc9d5c54850c50c27280ed7656e941c17dfd797d6520decea8e4aeb575d7fd2b597a88a86a29857b3b8115e8fa60077fbefe96dbe7b5407c9b0e046080fe61cdd6a76bd8368ccb100cc2c25b3e2ee7ffb5e5a6f64d1f5e7afac4da9eed1be2a3a645bb481b232f760e2bbfd8b1e65818aec4166e922f9fe9eb70063027517b9dd0be4d433311d5d0cd7f562fded4b650aafd13c0605bd438d0a71774e967ea9c374720d5b883d1a78e54b7dd7242afa6f2c144cf2ca8e2d83683c8b2c75a9bb02f462727b24b51d2fdfd6a933c5897a9e1918764b71bb08fdafe6972e7c415dd52eb7c4f641767978f4679d1dd85a4a98032768e527ecba6e3606b77894758d0ee9e555cc047f76a18efe88c74c62ec36ca91de9480072963eff008a1d7e774d4fa1aec23d59ae57f320f9ce8f542807afdb066d06c7612d4bbe757296285d3fd75b4b6764f6ae4c2789059fd0c2ab7720d3af056cb6932385eeece67e85d53765bdacc2bcdb7c66b1916b9c0184d418eefaba6149912dfb799984c06fee2e69160ea9167d2606494cb60db14c63e0bacd8e41fe716270b672acaf4300a8bb3ff208e086afc1758d7722bb55f25794a3559558d5e4e926da33c90d5b35a83ed00ec73270ea4b724a5ed61b732fdd2ba22897f0bd02cf13a64a3b50d0ffcf192c4f0f5001cfce68364873efd515d5b60a9d76ebc51631e8992968a4c716c878f389ca8257c2c2a5c75a75ac5f1b0b53e72d8ab47151f286450f4027cd14db64d0e41c45418f73ffb8ae9b08a9113313883c8057908e7b702f1b9fafeb06dc4aa85c1434e0cf9a72246ab38068210a48f450fa03038a9b2c6242121e6f1c452da7392184c16757f0d36bfcda843ebb640093dc29aaa13450a1496c0c5df3d33d6ad53757254602fa8972e06c031bde9f43bd90e8f5d0fd9093de6d33e9a175ea0875a9a4ba131564d11c45b0095b912c6fa1abf48787dc5172204c4cb716fd318b0dec83f60d5b22637fcf1448edceb8d9e3462f212</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½ï¼Œè¿™é‡Œéœ€è¦å¯†ç ï¼</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Orika</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç´¢å¼•ä¼˜åŒ–ç®€æ</title>
    <url>/post/45516.html</url>
    <content><![CDATA[<h1 id="MySQLç´¢å¼•ä¼˜åŒ–ç®€æ"><a href="#MySQLç´¢å¼•ä¼˜åŒ–ç®€æ" class="headerlink" title="MySQLç´¢å¼•ä¼˜åŒ–ç®€æ"></a>MySQLç´¢å¼•ä¼˜åŒ–ç®€æ</h1><h2 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h2><h3 id="å•å€¼ç´¢å¼•"><a href="#å•å€¼ç´¢å¼•" class="headerlink" title="å•å€¼ç´¢å¼•"></a>å•å€¼ç´¢å¼•</h3><blockquote>
<p>æ¦‚å¿µï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªæ•°é‡çš„åˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•å€¼ç´¢å¼•</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># å•å€¼ç´¢å¼•</span><br><span class="line"><span class="keyword">create</span> index idx_title <span class="keyword">on</span> tb_blog(title);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å”¯ä¸€ç´¢å¼•"><a href="#å”¯ä¸€ç´¢å¼•" class="headerlink" title="å”¯ä¸€ç´¢å¼•"></a>å”¯ä¸€ç´¢å¼•</h3><blockquote>
<p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†æ˜¯å…è®¸æœ‰ç©ºå€¼å­˜åœ¨</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># å”¯ä¸€ç´¢å¼•</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index idx_title <span class="keyword">on</span> tb_blog(title);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä¸»é”®ç´¢å¼•"><a href="#ä¸»é”®ç´¢å¼•" class="headerlink" title="ä¸»é”®ç´¢å¼•"></a>ä¸»é”®ç´¢å¼•</h3><blockquote>
<p>å­—æ®µè¢«è®¾ç½®ä¸ºä¸»é”®åï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ä¸ºè¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œinnodbå¼•æ“ä¸‹è¢«ç§°ä¸º<code>èšç°‡ç´¢å¼•</code></p>
</blockquote>
<h3 id="å¤åˆç´¢å¼•"><a href="#å¤åˆç´¢å¼•" class="headerlink" title="å¤åˆç´¢å¼•"></a>å¤åˆç´¢å¼•</h3><blockquote>
<p>ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨ä¸­ç´¢å¼•çš„æ•°é‡å°½é‡ä¸è¦å¤ªå¤š</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># å¤åˆç´¢å¼•</span><br><span class="line"><span class="keyword">create</span> index idx_username_email <span class="keyword">on</span> tb_user(username,email);</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹æŸä¸ªè¡¨ç´¢å¼•</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> tb_blog</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æŒ‡å®šç´¢å¼•</span><br><span class="line"><span class="keyword">drop</span> index idx_title <span class="keyword">from</span> tb_blog</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç´¢å¼•åˆ›å»ºæ—¶æœº"><a href="#ç´¢å¼•åˆ›å»ºæ—¶æœº" class="headerlink" title="ç´¢å¼•åˆ›å»ºæ—¶æœº"></a>ç´¢å¼•åˆ›å»ºæ—¶æœº</h3><blockquote>
<p>é€‚åˆåˆ›å»ºç´¢å¼•ï¼š</p>
<ul>
<li>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•</li>
<li>æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µé€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆå¤–é”®å…³ç³»å­—æ®µï¼‰</li>
<li>æŸ¥è¯¢ä¸­ä½œä¸ºæ’åºæ¡ä»¶çš„å­—æ®µé€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆæ’åºå­—æ®µåˆ›å»ºç´¢å¼•åèƒ½å¤Ÿå¤§å¹…åº¦ä½“ç”Ÿæ’åºé€Ÿåº¦ï¼‰</li>
<li>æŸ¥è¯¢ä¸­ä½œä¸ºç»Ÿè®¡æˆ–è€…åˆ†ç»„çš„å­—æ®µ</li>
</ul>
<p><strong>æ³¨æ„ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå¤åˆç´¢å¼•çš„æ€§ä»·æ¯”è¦æ¯”å•å€¼ç´¢å¼•çš„æ€§ä»·æ¯”è¦é«˜ï¼Œå¦‚æœæ¡ä»¶å…è®¸æƒ…å†µä¸‹ï¼Œå°½é‡é€‰æ‹©å¤åˆç´¢å¼•</strong></p>
<p>ä¸é€‚åˆåˆ›å»ºï¼š</p>
<ul>
<li>è¡¨æ•°æ®è¿‡å°‘</li>
<li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨æˆ–è€…å­—æ®µ</li>
<li>whereæ¡ä»¶ä¸­ç”¨ä¸å¤ªåˆ°çš„å­—æ®µ</li>
<li>è¿‡æ»¤æ€§ä¸å¥½çš„å­—æ®µï¼ˆå­—æ®µå€¼çš„è¾¨è¯†æ€§ä¸é«˜ï¼Œä¾‹å¦‚ï¼šç”¨æˆ·çš„æ€§åˆ«ï¼šç”·/å¥³ï¼Œæ–‡ç« ç±»å‹ï¼šåŸåˆ›/è½¬è½½ ç­‰ç­‰ï¼‰</li>
</ul>
</blockquote>
<h2 id="Explainæ€§èƒ½åˆ†æ"><a href="#Explainæ€§èƒ½åˆ†æ" class="headerlink" title="Explainæ€§èƒ½åˆ†æ"></a>Explainæ€§èƒ½åˆ†æ</h2><blockquote>
<p>explainåˆ†æç»“æ„å›¾ç¤ºï¼š<br><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210803085543.png" alt="explainå…³é”®å­—ç»“æ„"></p>
</blockquote>
<h3 id="å…³é”®å­—ç®€æ"><a href="#å…³é”®å­—ç®€æ" class="headerlink" title="å…³é”®å­—ç®€æ"></a>å…³é”®å­—ç®€æ</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><blockquote>
<p>æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ“ä½œè¡¨çš„é¡ºåº</p>
<ul>
<li>idå€¼ç›¸åŒï¼šä»ä¸Šè‡³ä¸‹ä¸€æ¬¡æ‰§è¡Œ</li>
<li>idå€¼ä¸åŒï¼šå¦‚æœæ˜¯å­˜åœ¨å­æŸ¥è¯¢ï¼Œidå€¼çš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</li>
<li>idå€¼åŒæ—¶å­˜åœ¨ç›¸åŒå’Œä¸åŒï¼šidå¦‚æœç›¸åŒï¼Œå¯è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šè‡³ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li>
</ul>
</blockquote>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><blockquote>
<p>æŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢</p>
<p>ç±»å‹å›¾ç¤ºï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210803134251.png" alt="æŸ¥è¯¢ç±»å‹"></p>
</blockquote>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><blockquote>
<p>è¡¨ç¤ºæ•°æ®æ¥æºäºé‚£å¼ è¡¨ï¼ˆæ²¡ä»€ä¹ˆå®é™…ä½œç”¨ï¼‰</p>
</blockquote>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><blockquote>
<p>æŸ¥è¯¢çš„è®¿é—®ç±»å‹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¼˜åŒ–æŒ‡æ ‡ï¼ŒæŒ‡æ ‡çš„å€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li>system</li>
<li>const</li>
<li>eq_ref</li>
<li><code>ref</code></li>
<li>fulltext</li>
<li>ref_or_null</li>
<li>index_merge</li>
<li>unique_subquery</li>
<li>index_subquery</li>
<li><code>range</code></li>
<li><code>index</code></li>
<li>all</li>
</ol>
<p><strong>æ³¨æ„ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° <code>range</code> çº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ° <code>ref</code> çº§åˆ«</strong></p>
</blockquote>
<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><blockquote>
<p>æ˜¾ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œå­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªã€‚</p>
<p>æ³¨æ„ï¼šæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šå­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•è¢«åˆ—å‡ºï¼Œä½†æ˜¯ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚</p>
</blockquote>
<h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><blockquote>
<p>æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œå¦‚æœä¸ºnull,åˆ™è¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ç´¢å¼•</p>
</blockquote>
<h4 id="ken-len"><a href="#ken-len" class="headerlink" title="ken_len"></a>ken_len</h4><blockquote>
<p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°çš„ç´¢å¼•çš„é•¿åº¦ã€‚</p>
<p>å«ä¹‰ï¼škey_lenå­—æ®µèƒ½å¤Ÿæ£€æŸ¥æ­¤æ¬¡æŸ¥è¯¢æ˜¯å¦å……åˆ†åˆ©ç”¨ä¸Šäº†ç´¢å¼•ã€‚key_lençš„å€¼è¶Šå¤§ï¼Œè¡¨æ˜è¯¥ç´¢å¼•ä½¿ç”¨çš„è¶Šå……åˆ†ã€‚</p>
<p>ç´¢å¼•è®¡ç®—è¯´æ˜ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210803140322.png" alt="ç´¢å¼•é•¿åº¦è®¡ç®—"></p>
</blockquote>
<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><blockquote>
<p>æ˜¾ç¤ºç´¢å¼•çš„é‚£ä¸€åˆ—è¢«ä½¿ç”¨äº†ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæ­¤å€¼æ˜¾ç¤ºä¸ºä¸€ä¸ªå¸¸æ•°ï¼Œè¡¨æ˜é‚£äº›åˆ—æˆ–è€…å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚</p>
</blockquote>
<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><blockquote>
<p>æ˜¾ç¤ºMySQLè®¤ä¸ºæ­¤æŸ¥è¯¢è¯­å¥æ‰§è¡ŒæŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ï¼Œè¶Šå°‘è¶Šå¥½ã€‚</p>
</blockquote>
<h4 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h4><blockquote>
<p>å…¶ä»–çš„é¢å¤–é‡è¦çš„ä¿¡æ¯</p>
<ul>
<li>using whereï¼šè¡¨æ˜ä½¿ç”¨äº† where æ¡ä»¶è¿‡æ»¤</li>
</ul>
<ul>
<li>using firesortï¼šMySQLä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•æ’åºã€‚æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œè¢«ç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€</li>
</ul>
<ul>
<li>using temporaryï¼šMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä¼šä½¿ç”¨ä¸´æ—¶è¡¨ä¿å­˜ç»“æœï¼Œå¸¸è§äº order by æ’åºå’Œ group by çš„åˆ†ç»„æ“ä½œä¸­</li>
</ul>
<ul>
<li>using indexï¼šä»£è¡¨è¡¨ç¤ºç›¸åº”çš„ select æ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•(Covering Index)ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ï¼ å¦‚æœåŒæ—¶å‡ºç° using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾;å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç° using whereï¼Œè¡¨æ˜ç´¢å¼•åªæ˜¯ ç”¨æ¥è¯»å–æ•°æ®è€Œéåˆ©ç”¨ç´¢å¼•æ‰§è¡ŒæŸ¥æ‰¾</li>
</ul>
<ul>
<li>using join bufferï¼šè¡¨ç¤ºä½¿ç”¨äº†è¿æ¥ç¼“å­˜</li>
</ul>
</blockquote>
<h3 id="ç´¢å¼•å¤±æ•ˆç®€æ"><a href="#ç´¢å¼•å¤±æ•ˆç®€æ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆç®€æ"></a>ç´¢å¼•å¤±æ•ˆç®€æ</h3><h4 id="å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"><a href="#å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±" class="headerlink" title="å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"></a>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</h4><blockquote>
<p>è§£é‡Šï¼šwhereåé¢éœ€è¦è¿‡æ»¤çš„å­—æ®µæŒ‰ç…§é¡ºåºï¼ˆ<code>ä¸æŒ‰ç…§é¡ºåºä¹Ÿå¯ä»¥ï¼ŒSQLä¼šè‡ªåŠ¨ä¼˜åŒ–</code>ï¼‰åœ¨ç´¢å¼•ä¸­å¯ä»¥åŒ¹é…çš„ä¸Š</p>
</blockquote>
<h4 id="æœ€å·¦å‰ç¼€è¦éµå®ˆ"><a href="#æœ€å·¦å‰ç¼€è¦éµå®ˆ" class="headerlink" title="æœ€å·¦å‰ç¼€è¦éµå®ˆ"></a>æœ€å·¦å‰ç¼€è¦éµå®ˆ</h4><blockquote>
<p>è§£é‡Šï¼š</p>
<ul>
<li><strong>å¸¦å¤´å¤§å“¥ä¸èƒ½ä¸¢ï¼š</strong>ä¸€å®šè¦æŒ‰ç…§å»ºç«‹ç´¢å¼•çš„å­—æ®µé¡ºåºè¿›è¡Œwhereåé¢è¿‡æ»¤æ¡ä»¶çš„ä¹¦å†™ï¼Œå¸¦å¤´çš„ç´¢å¼•å­—æ®µéœ€è¦å†™åœ¨æœ€å‰é¢ï¼Œå¦åˆ™åé¢å­—æ®µçš„ç´¢å¼•å…¨éƒ¨å¤±æ•ˆï¼ˆ<code>å…¨éƒ¨å¤±æ•ˆ</code>ï¼‰</li>
<li><strong>ä¸­é—´å…„å¼Ÿä¸èƒ½æ–­ï¼š</strong>è¿‡æ»¤æ¡ä»¶çš„ä¹¦å†™ä¸è¦å­—æ®µï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œé‚£ä¹ˆæ­¤å­—æ®µåé¢çš„ç´¢å¼•å­—æ®µéƒ½å°†å¤±æ•ˆï¼ˆ<code>éƒ¨åˆ†å¤±æ•ˆ</code>ï¼‰</li>
</ul>
</blockquote>
<h4 id="ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—"><a href="#ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—" class="headerlink" title="ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—"></a>ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—</h4><blockquote>
<p>ä¸è¦å†ç´¢å¼•åˆ—ä¸Šè¿›è¡Œã€<code>è®¡ç®—</code>ï¼Œ<code>å‡½æ•°</code>ï¼Œ<code>æ‰‹åŠ¨/è‡ªåŠ¨ç±»å‹è½¬æ¢</code>ã€‘æ“ä½œï¼Œå¦åˆ™ç´¢å¼•å°†å…¨éƒ¨å¤±æ•ˆ</p>
</blockquote>
<h4 id="èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ"><a href="#èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ" class="headerlink" title="èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ"></a>èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ</h4><blockquote>
<p>å¦‚æœåœ¨å¤åˆç´¢å¼•çš„æŸä¸ªå­—æ®µä¸Šä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆåé¢å­—æ®µçš„ç´¢å¼•å°†å…¨éƒ¨å¤±æ•ˆ</p>
<p><code>å»ºè®®ï¼šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå°†å¯èƒ½ä¼šç”¨åˆ°èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå°½é‡æ”¾åˆ°</code></p>
</blockquote>
<h4 id="LIKEç™¾åˆ†å†™æœ€å³"><a href="#LIKEç™¾åˆ†å†™æœ€å³" class="headerlink" title="LIKEç™¾åˆ†å†™æœ€å³"></a>LIKEç™¾åˆ†å†™æœ€å³</h4><blockquote>
<p>åªæœ‰ <code>%</code> åŒ¹é…ç¬¦å†™åœ¨å³è¾¹çš„æ—¶å€™ï¼Œç´¢å¼•æ‰ä¸ä¼šå¤±æ•ˆã€‚ç±»ä¼¼äº <code>%blog%</code>ï¼Œ<code>%blog</code> è¿™æ ·çš„åŒ¹é…ç´¢å¼•éƒ½å°†å¤±æ•ˆã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210804201544.png" alt="image-20210804201530514"></p>
</blockquote>
<h4 id="è¦†ç›–ç´¢å¼•ä¸å†™"><a href="#è¦†ç›–ç´¢å¼•ä¸å†™" class="headerlink" title="è¦†ç›–ç´¢å¼•ä¸å†™*"></a>è¦†ç›–ç´¢å¼•ä¸å†™*</h4><blockquote>
<p>æŸ¥è¯¢å­—æ®µçš„æ—¶å€™ï¼Œå¦‚æœè¿™äº›å­—æ®µå…¨éƒ¨éƒ½å­˜åœ¨äºç´¢å¼•ä¸­ï¼Œä¸€å®šä¸è¦å†™ <code>*</code> ç¬¦å·ï¼Œå°½é‡æŒ‰ç…§å­—æ®µè¿›è¡ŒæŸ¥è¯¢ã€‚</p>
</blockquote>
<h4 id="ä¸ç­‰ç©ºå€¼è¿˜æœ‰OR"><a href="#ä¸ç­‰ç©ºå€¼è¿˜æœ‰OR" class="headerlink" title="ä¸ç­‰ç©ºå€¼è¿˜æœ‰OR"></a>ä¸ç­‰ç©ºå€¼è¿˜æœ‰OR</h4><blockquote>
<p>ä¸ç­‰ç©ºå€¼è¿˜æœ‰ORï¼Œéšå¼è½¬æ¢è¦æ³¨æ„ã€‚</p>
<ul>
<li>ä¸ç­‰å·ï¼ˆ<code>!=,&lt;&gt;</code>ï¼‰ï¼šMySQLåœ¨ä½¿ç”¨ä¸ç­‰æ¡ä»¶è¿‡æ»¤æ—¶ï¼Œæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ</li>
<li><code>is not null</code>ç´¢å¼•å¤±æ•ˆï¼Œå…¨è¡¨æ‰«æ <code>is null</code>ç´¢å¼•å¤±æ•ˆ</li>
<li>ä½¿ç”¨ <code>or</code> ä½œä¸ºè¿‡æ»¤æ¡ä»¶ï¼Œæœ‰æ—¶ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå…¨è¡¨æ‰«æ<ul>
<li>å»ºè®®ï¼šå¦‚æœæ¡ä»¶å…è®¸æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>union all</code> æˆ–è€… <code>union</code> æ¥æ›¿ä»£ or</li>
</ul>
</li>
<li>é˜²æ­¢å€¼ç±»å‹çš„<code>éšå¼è½¬æ¢</code>ï¼Œä¾‹å¦‚ï¼šchar ç±»å‹éšå¼è½¬æ¢ä¸º int ç±»å‹ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
</ul>
</blockquote>
<h4 id="ç»ƒä¹ ç¤ºä¾‹"><a href="#ç»ƒä¹ ç¤ºä¾‹" class="headerlink" title="ç»ƒä¹ ç¤ºä¾‹"></a>ç»ƒä¹ ç¤ºä¾‹</h4><blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> index idx_a_b_c <span class="keyword">on</span> tb_blog(a,b,c);</span><br></pre></td></tr></tbody></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210804203127.png" alt="ç´¢å¼•ç»ƒä¹ 1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210804203049.png" alt="ç´¢å¼•ç»ƒä¹ 2"></p>
</blockquote>
<h3 id="ç´¢å¼•ä¼˜åŒ–ç®€æ"><a href="#ç´¢å¼•ä¼˜åŒ–ç®€æ" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–ç®€æ"></a>ç´¢å¼•ä¼˜åŒ–ç®€æ</h3><h4 id="å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>å…³è”æŸ¥è¯¢ä¼˜åŒ–</h4><blockquote>
<p>left joinï¼š</p>
<ul>
<li>ä¼˜åŒ–å…³è”æŸ¥è¯¢æ—¶ï¼Œåªæœ‰åœ¨è¢«é©±åŠ¨è¡¨ä¸Šåˆ›å»ºç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆ</li>
<li>left join æ—¶ï¼Œ<code>å·¦ä¾§çš„ä¸ºé©±åŠ¨è¡¨ï¼Œå³ä¾§ä¸ºè¢«é©±åŠ¨è¡¨</code></li>
</ul>
<p>inner joinï¼š</p>
<ul>
<li>inner join æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨ä¼˜åŒ–ï¼Œå°†å°ç»“æœé›†çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨</li>
</ul>
<p>æ³¨æ„ï¼šèƒ½å¤Ÿç›´æ¥å¤šè¡¨å…³è”çš„å°½é‡ç›´æ¥ä½¿ç”¨ join å…³è”ï¼Œä¸è¦ä½¿ç”¨å­æŸ¥è¯¢ï¼ˆå¾ˆéš¾ä½¿ç”¨åˆ°ç´¢å¼•ï¼‰</p>
</blockquote>
<h4 id="æ’åºåˆ†ç»„ä¼˜åŒ–"><a href="#æ’åºåˆ†ç»„ä¼˜åŒ–" class="headerlink" title="æ’åºåˆ†ç»„ä¼˜åŒ–"></a>æ’åºåˆ†ç»„ä¼˜åŒ–</h4><blockquote>
<ol>
<li>order by å½“æ²¡æœ‰ <code>where æˆ–è€… limit</code> è¿‡æ»¤æ¡ä»¶æ—¶ï¼Œä¸ä¼šä½¿ç”¨ç´¢å¼•</li>
<li>order by çš„ä¸¤ä¸ªç´¢å¼•å­—æ®µæ’åºæ—¶ï¼Œä¹¦å†™çš„é¡ºåºä¸èƒ½ä¹±ï¼Œä¾‹å¦‚ï¼šç´¢å¼•é¡ºåºï¼ša-bï¼Œé‚£ä¹ˆorder by çš„é¡ºåºå¦‚æœæ˜¯ï¼šb-aï¼Œå¿…å°†ä¼šè¿›è¡Œæ–‡ä»¶æ’åºï¼š<code>user fielsort</code></li>
<li>group by æ²¡æœ‰è¿‡æ»¤æ¡ä»¶æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ°ç´¢å¼•</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Navicat</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç»å…¸50é¢˜</title>
    <url>/post/25852.html</url>
    <content><![CDATA[<h2 id="MySQLç»å…¸50é¢˜"><a href="#MySQLç»å…¸50é¢˜" class="headerlink" title="MySQLç»å…¸50é¢˜"></a>MySQLç»å…¸50é¢˜</h2><blockquote>
<p><span class="github-emoji"><span>ğŸ¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f3a8.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ›</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f41b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>âš¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸŒµ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f335.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜»</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f63b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f370.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ¶</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f436.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸš¯</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f6af.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>â™</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2650.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ‘©</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f469.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ™</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f419.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
<p>MySQLç»å…¸50é¢˜ç»ƒä¹ é¢˜ï¼ŒæŒç»­æ›´æ–°ä¸­â€¦</p>
</blockquote>
<h3 id="è¡¨åˆå§‹åŒ–"><a href="#è¡¨åˆå§‹åŒ–" class="headerlink" title="è¡¨åˆå§‹åŒ–"></a>è¡¨åˆå§‹åŒ–</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">-- å»ºè¡¨</span><br><span class="line">-- å­¦ç”Ÿè¡¨</span><br><span class="line">CREATE TABLE `tb_student`(</span><br><span class="line">	`s_id` VARCHAR(20),</span><br><span class="line">	`s_name` VARCHAR(20) NOT NULL DEFAULT '',</span><br><span class="line">	`s_birth` VARCHAR(20) NOT NULL DEFAULT '',</span><br><span class="line">	`s_sex` VARCHAR(10) NOT NULL DEFAULT '',</span><br><span class="line">	PRIMARY KEY(`s_id`)</span><br><span class="line">);</span><br><span class="line">-- è¯¾ç¨‹è¡¨</span><br><span class="line">CREATE TABLE `tb_course`(</span><br><span class="line">	`c_id`  VARCHAR(20),</span><br><span class="line">	`c_name` VARCHAR(20) NOT NULL DEFAULT '',</span><br><span class="line">	`t_id` VARCHAR(20) NOT NULL,</span><br><span class="line">	PRIMARY KEY(`c_id`)</span><br><span class="line">);</span><br><span class="line">-- æ•™å¸ˆè¡¨</span><br><span class="line">CREATE TABLE `tb_teacher`(</span><br><span class="line">	`t_id` VARCHAR(20),</span><br><span class="line">	`t_name` VARCHAR(20) NOT NULL DEFAULT '',</span><br><span class="line">	PRIMARY KEY(`t_id`)</span><br><span class="line">);</span><br><span class="line">-- æˆç»©è¡¨</span><br><span class="line">CREATE TABLE `tb_score`(</span><br><span class="line">	`s_id` VARCHAR(20),</span><br><span class="line">	`c_id`  VARCHAR(20),</span><br><span class="line">	`s_score` INT(3),</span><br><span class="line">	PRIMARY KEY(`s_id`,`c_id`)</span><br><span class="line">);</span><br><span class="line">-- æ’å…¥å­¦ç”Ÿè¡¨æµ‹è¯•æ•°æ®</span><br><span class="line">insert into tb_student values('01' , 'èµµé›·' , '1990-01-01' , 'ç”·');</span><br><span class="line">insert into tb_student values('02' , 'é’±ç”µ' , '1990-12-21' , 'ç”·');</span><br><span class="line">insert into tb_student values('03' , 'å­™é£' , '1990-05-20' , 'ç”·');</span><br><span class="line">insert into tb_student values('04' , 'æäº‘' , '1990-08-06' , 'ç”·');</span><br><span class="line">insert into tb_student values('05' , 'å‘¨æ¢…' , '1991-12-01' , 'å¥³');</span><br><span class="line">insert into tb_student values('06' , 'å´å…°' , '1992-03-01' , 'å¥³');</span><br><span class="line">insert into tb_student values('07' , 'éƒ‘ç«¹' , '1989-07-01' , 'å¥³');</span><br><span class="line">insert into tb_student values('08' , 'ç‹èŠ' , '1990-01-20' , 'å¥³');</span><br><span class="line">-- è¯¾ç¨‹è¡¨æµ‹è¯•æ•°æ®</span><br><span class="line">insert into tb_course values('01' , 'è¯­æ–‡' , '02');</span><br><span class="line">insert into tb_course values('02' , 'æ•°å­¦' , '01');</span><br><span class="line">insert into tb_course values('03' , 'è‹±è¯­' , '03');</span><br><span class="line"></span><br><span class="line">-- æ•™å¸ˆè¡¨æµ‹è¯•æ•°æ®</span><br><span class="line">insert into tb_teacher values('01' , 'å¼ ä¸‰');</span><br><span class="line">insert into tb_teacher values('02' , 'æå››');</span><br><span class="line">insert into tb_teacher values('03' , 'ç‹äº”');</span><br><span class="line"></span><br><span class="line">-- æˆç»©è¡¨æµ‹è¯•æ•°æ®</span><br><span class="line">insert into tb_score values('01' , '01' , 80);</span><br><span class="line">insert into tb_score values('01' , '02' , 90);</span><br><span class="line">insert into tb_score values('01' , '03' , 99);</span><br><span class="line">insert into tb_score values('02' , '01' , 70);</span><br><span class="line">insert into tb_score values('02' , '02' , 60);</span><br><span class="line">insert into tb_score values('02' , '03' , 80);</span><br><span class="line">insert into tb_score values('03' , '01' , 80);</span><br><span class="line">insert into tb_score values('03' , '02' , 80);</span><br><span class="line">insert into tb_score values('03' , '03' , 80);</span><br><span class="line">insert into tb_score values('04' , '01' , 50);</span><br><span class="line">insert into tb_score values('04' , '02' , 30);</span><br><span class="line">insert into tb_score values('04' , '03' , 20);</span><br><span class="line">insert into tb_score values('05' , '01' , 76);</span><br><span class="line">insert into tb_score values('05' , '02' , 87);</span><br><span class="line">insert into tb_score values('06' , '01' , 31);</span><br><span class="line">insert into tb_score values('06' , '03' , 34);</span><br><span class="line">insert into tb_score values('07' , '02' , 89);</span><br><span class="line">insert into tb_score values('07' , '03' , 98);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="50é¢˜ç®€æ"><a href="#50é¢˜ç®€æ" class="headerlink" title="50é¢˜ç®€æ"></a>50é¢˜ç®€æ</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><blockquote>
<p><strong>æŸ¥è¯¢â€01â€è¯¾ç¨‹æ¯”â€02â€è¯¾ç¨‹æˆç»©é«˜çš„å­¦ç”Ÿçš„ä¿¡æ¯åŠè¯¾ç¨‹åˆ†æ•°</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼š</p>
<ul>
<li>åŒ…æ‹¬01æœ‰æˆç»©ï¼Œ02æ— æˆç»©çš„æƒ…å†µ</li>
<li>ç¬¬ä¸€æ¬¡ç”¨inner join æ„ä¹‰åœ¨äº01è¯¾ç¨‹å¿…é¡»æœ‰æˆç»©ï¼Œç›´æ¥è¿‡æ»¤æ‰æ²¡æœ‰01è¯¾ç¨‹æˆç»©çš„ç»Ÿè®¡åŒå­¦ï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨left joinæ„ä¹‰åœ¨äº02è¯¾ç¨‹æˆç»©å¯ä»¥ä¸ºNULLã€‚è¿™æ ·ä¹Ÿæ»¡è¶³01è¯¾ç¨‹æ¯”02è¯¾ç¨‹æˆç»©é«˜çš„æƒ…å†µ</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>inner join å†…è¿æ¥å’Œ left join å·¦è¿æ¥çš„åŒºåˆ«</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	ts.*,</span><br><span class="line">	sca.s_score AS `01_score`,</span><br><span class="line">	scb.s_score AS `02_score`</span><br><span class="line">FROM</span><br><span class="line">	tb_student ts</span><br><span class="line">	INNER JOIN tb_score sca ON ts.s_id = sca.s_id </span><br><span class="line">	AND sca.c_id = '01'</span><br><span class="line">	LEFT JOIN tb_score scb ON ts.s_id = scb.s_id </span><br><span class="line">	AND scb.c_id = '02' </span><br><span class="line">WHERE</span><br><span class="line">	sca.s_score &gt; scb.s_score </span><br><span class="line">	OR ( sca.s_score IS NOT NULL AND scb.s_score IS NULL );</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210710224325.png" alt="ç¬¬1é¢˜"></p>
<hr>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><blockquote>
<p><strong>æŸ¥è¯¢â€01â€è¯¾ç¨‹æ¯”â€02â€è¯¾ç¨‹æˆç»©ä½çš„å­¦ç”Ÿçš„ä¿¡æ¯åŠè¯¾ç¨‹åˆ†æ•°</strong></p>
<p><span class="github-emoji"><span>ğŸ‘©</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f469.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼š</p>
<ul>
<li>åŒ…æ‹¬02æœ‰æˆç»©ï¼Œ01æ— æˆç»©çš„æƒ…å†µ</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>inner join å†…è¿æ¥å’Œ left join å·¦è¿æ¥çš„åŒºåˆ«</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span>,</span><br><span class="line">       ta.s_score <span class="keyword">AS</span> `<span class="number">02</span>_score`,</span><br><span class="line">       tb.s_score <span class="keyword">AS</span> `<span class="number">01</span>_score`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">JOIN</span> tb_score ta <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> ta.s_id <span class="keyword">AND</span> ta.c_id <span class="operator">=</span> <span class="string">'02'</span></span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score tb <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> tb.s_id <span class="keyword">AND</span> tb.c_id <span class="operator">=</span> <span class="string">'01'</span></span><br><span class="line"><span class="keyword">WHERE</span> ta.s_score <span class="operator">&gt;</span> tb.s_score</span><br><span class="line">   <span class="keyword">OR</span> (ta.s_score <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> tb.s_score <span class="keyword">IS</span> <span class="keyword">NULL</span>);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711195738.png" alt="ç¬¬2é¢˜"></p>
<hr>
<h4 id="3-4"><a href="#3-4" class="headerlink" title="3-4"></a>3-4</h4><blockquote>
<p><strong>æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºç­‰äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰</strong></p>
<p><strong>æŸ¥è¯¢å¹³å‡æˆç»©å°äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼š</p>
<ul>
<li>æ ¹æ®å­¦å·åˆ†ç»„æ±‚å¹³å‡æˆç»©</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>group by â€¦ havingçš„ä½¿ç”¨</li>
<li>avg()èšåˆå‡½æ•°çš„ä½¿ç”¨</li>
<li>round(param1,param2)å‡½æ•°çš„ä½¿ç”¨</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºç­‰äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.s_id, ts.s_name, ROUND(<span class="built_in">AVG</span>(t.s_score), <span class="number">2</span>) <span class="keyword">AS</span> `avgScore`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> t.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id</span><br><span class="line"><span class="keyword">HAVING</span> `avgScore` <span class="operator">&gt;=</span> <span class="number">60</span>;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å¹³å‡æˆç»©å°äº60åˆ†çš„åŒå­¦çš„å­¦ç”Ÿç¼–å·å’Œå­¦ç”Ÿå§“åå’Œå¹³å‡æˆç»©ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.s_id, ts.s_name, ROUND(<span class="built_in">AVG</span>(t.s_score), <span class="number">2</span>) <span class="keyword">AS</span> `avgScore`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> t.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id</span><br><span class="line"><span class="keyword">HAVING</span> `avgScore` <span class="operator">&lt;</span> <span class="number">60</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711201513.png" alt="ç¬¬3é¢˜"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711201615.png" alt="ç¬¬4é¢˜"></p>
<hr>
<h4 id="5"><a href="#5" class="headerlink" title="5"></a>5</h4><blockquote>
<p><strong>æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦ç”Ÿç¼–å·ã€å­¦ç”Ÿå§“åã€é€‰è¯¾æ€»æ•°ã€æ‰€æœ‰è¯¾ç¨‹çš„æ€»æˆç»©</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>å¿…é¡»ä½¿ç”¨å¤–è¿æ¥ï¼Œå› ä¸ºæœ‰äº›åŒå­¦å¯èƒ½æ²¡æœ‰é€‰è¯¾ï¼Œä½†æ˜¯ä¹Ÿè¦è¿›è¡Œè®¡ç®—</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>count()ï¼šå½“å­—æ®µä¸ºNULLæ—¶ï¼Œä¸è®¡å…¥ç»Ÿè®¡æ•°é‡</li>
<li>IFNULL(p1,p2)ï¼šå¦‚æœp1ä¸ä¸ºNULLè¾“å‡ºå€¼ä¸ºp1ï¼Œå¦åˆ™å€¼ä¸ºp2</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦ç”Ÿç¼–å·ã€å­¦ç”Ÿå§“åã€é€‰è¯¾æ€»æ•°ã€æ‰€æœ‰è¯¾ç¨‹çš„æ€»æˆç»©</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.s_id,</span><br><span class="line">       ts.s_name,</span><br><span class="line">       <span class="built_in">COUNT</span>(t.c_id)             <span class="keyword">AS</span> `courseCount`,</span><br><span class="line">       IFNULL(<span class="built_in">SUM</span>(t.s_score), <span class="number">0</span>) <span class="keyword">AS</span> `scoreSum`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> t.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id;</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="6"><a href="#6" class="headerlink" title="6"></a>6</h4><blockquote>
<p><strong>æŸ¥è¯¢â€æâ€å§“è€å¸ˆçš„æ•°é‡</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
<ul>
<li>æŸ¥è¯¢å§“æçš„è€å¸ˆï¼Œåªéœ€è¦åŒ¹é…å§“æ°å³å¯</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>CONCAT(â€˜æâ€™, â€˜%â€™)ï¼šå³åç¼€åŒ¹é…</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(tt.t_id)</span><br><span class="line"><span class="keyword">FROM</span> tb_teacher tt</span><br><span class="line"><span class="keyword">WHERE</span> tt.t_name <span class="keyword">LIKE</span> CONCAT(<span class="string">'æ'</span>, <span class="string">'%'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711203018.png" alt="ç¬¬6é¢˜"></p>
<hr>
<h4 id="7"><a href="#7" class="headerlink" title="7"></a>7</h4><blockquote>
<p><strong>æŸ¥è¯¢å­¦è¿‡â€å¼ ä¸‰â€è€å¸ˆè¯¾ç¨‹çš„åŒå­¦çš„ä¿¡æ¯</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- å­æŸ¥è¯¢æ–¹å¼</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                  <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                  <span class="keyword">WHERE</span> t.c_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> tc.c_id</span><br><span class="line">                                   <span class="keyword">FROM</span> tb_course tc</span><br><span class="line">                                   <span class="keyword">WHERE</span> tc.t_id <span class="operator">=</span> (<span class="keyword">SELECT</span> tt.t_id</span><br><span class="line">                                                    <span class="keyword">FROM</span> tb_teacher tt</span><br><span class="line">                                                    <span class="keyword">WHERE</span> tt.t_name <span class="operator">=</span> <span class="string">'å¼ ä¸‰'</span>)));</span><br><span class="line"><span class="comment">-- è¿è¡¨æŸ¥è¯¢æ–¹å¼ï¼ˆæ¨èï¼šä¼šå¤šèµ°ä¸€æ¬¡ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> t.s_id</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_course tc <span class="keyword">ON</span> t.c_id <span class="operator">=</span> tc.c_id</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_teacher tt <span class="keyword">ON</span> tc.t_id <span class="operator">=</span> tt.t_id</span><br><span class="line"><span class="keyword">WHERE</span> tt.t_name <span class="operator">=</span> <span class="string">'å¼ ä¸‰'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -------------------------------------------explain-------------------------------------------</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711204809.png" alt="ç¬¬7é¢˜"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711205156.png" alt="explainåˆ†æ"></p>
<hr>
<h4 id="8"><a href="#8" class="headerlink" title="8"></a>8</h4><blockquote>
<p><strong>æŸ¥è¯¢æ²¡å­¦è¿‡â€å¼ ä¸‰â€è€å¸ˆæˆè¯¾çš„åŒå­¦çš„ä¿¡æ¯</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>: åŒ…æ‹¬æ²¡æœ‰é€‰è¯¾çš„åŒå­¦</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">not</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                  <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                  <span class="keyword">WHERE</span> t.c_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> tc.c_id</span><br><span class="line">                                   <span class="keyword">FROM</span> tb_course tc</span><br><span class="line">                                   <span class="keyword">WHERE</span> tc.t_id <span class="operator">=</span> (<span class="keyword">SELECT</span> tt.t_id</span><br><span class="line">                                                    <span class="keyword">FROM</span> tb_teacher tt</span><br><span class="line">                                                    <span class="keyword">WHERE</span> tt.t_name <span class="operator">=</span> <span class="string">'å¼ ä¸‰'</span>)));</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711205957.png" alt="ç¬¬8é¢˜"></p>
<hr>
<h4 id="9"><a href="#9" class="headerlink" title="9"></a>9</h4><blockquote>
<p><strong>æŸ¥è¯¢å­¦è¿‡ç¼–å·ä¸ºâ€01â€å¹¶ä¸”ä¹Ÿå­¦è¿‡ç¼–å·ä¸ºâ€02â€çš„è¯¾ç¨‹çš„åŒå­¦çš„ä¿¡æ¯</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span>,</span><br><span class="line">       ta.c_id,</span><br><span class="line">       tb.c_id</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score ta <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> ta.s_id</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score tb <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> tb.s_id</span><br><span class="line"><span class="keyword">WHERE</span> ta.c_id <span class="operator">=</span> <span class="string">'01'</span></span><br><span class="line">  <span class="keyword">AND</span> tb.c_id <span class="operator">=</span> <span class="string">'02'</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711210500.png" alt="ç¬¬9é¢˜"></p>
<hr>
<h4 id="10"><a href="#10" class="headerlink" title="10"></a>10</h4><blockquote>
<p><strong>æŸ¥è¯¢å­¦è¿‡ç¼–å·ä¸ºâ€01â€ä½†æ˜¯æ²¡æœ‰å­¦è¿‡ç¼–å·ä¸ºâ€02â€çš„è¯¾ç¨‹çš„åŒå­¦çš„ä¿¡æ¯</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                  <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                  <span class="keyword">WHERE</span> t.c_id <span class="operator">=</span> <span class="string">'01'</span>)</span><br><span class="line">  <span class="keyword">AND</span> ts.s_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                      <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                      <span class="keyword">WHERE</span> t.c_id <span class="operator">=</span> <span class="string">'02'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210711211125.png" alt="ç¬¬10é¢˜"></p>
<hr>
<h4 id="11"><a href="#11" class="headerlink" title="11"></a>11</h4><blockquote>
<p> <strong>æ²¡æœ‰å­¦ä¹ å…¨éƒ¨è¯¾ç¨‹çš„åŒå­¦</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> ts.s_id <span class="operator">=</span> t.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(ts.s_id) <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(tc.c_id) <span class="keyword">FROM</span> tb_course tc);</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="12"><a href="#12" class="headerlink" title="12"></a>12</h4><blockquote>
<p><strong>æŸ¥è¯¢è‡³å°‘æœ‰ä¸€é—¨è¯¾ä¸å­¦å·ä¸ºâ€01â€çš„åŒå­¦æ‰€å­¦ç›¸åŒçš„åŒå­¦çš„ä¿¡æ¯</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> t.s_id</span><br><span class="line">                  <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                  <span class="keyword">WHERE</span> t.c_id <span class="keyword">IN</span></span><br><span class="line">                        (<span class="keyword">SELECT</span> s.c_id</span><br><span class="line">                         <span class="keyword">FROM</span> tb_score s</span><br><span class="line">                         <span class="keyword">WHERE</span> s.s_id <span class="operator">=</span> <span class="string">''</span><span class="number">01</span><span class="string">''</span>));</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="13"><a href="#13" class="headerlink" title="13"></a>13</h4><blockquote>
<p><strong>æŸ¥è¯¢å’Œâ€01â€å·çš„åŒå­¦å­¦ä¹ çš„è¯¾ç¨‹å®Œå…¨ç›¸åŒçš„å…¶ä»–åŒå­¦çš„ä¿¡æ¯</strong></p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
<ul>
<li>æŸ¥æ‘è¯¾ç¨‹ä¿¡æ¯å®Œå…¨ç›¸åŒçš„ï¼Œåªèƒ½è¿›è¡Œæ¯”è¾ƒæ“ä½œ</li>
</ul>
<p><span class="github-emoji"><span>ğŸ‘½</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>GROUP_CONCAT()ï¼šå°†æŒ‡å®šå­—æ®µå®‰è£…ä¸€å®šçš„åˆ†éš”ç¬¦è¿›è¡Œè¿æ¥ï¼Œé»˜è®¤åˆ†éš”ç¬¦ä¸ºï¼šé€—å·ã€‚æœ‰ç‚¹ç±»ä¼¼äºjavaä¸­çš„joinæ–¹æ³•</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> t.s_id</span><br><span class="line">    <span class="keyword">FROM</span> tb_score t</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.s_id</span><br><span class="line">    <span class="keyword">HAVING</span> GROUP_CONCAT(s.c_idï¼ŒSeparator <span class="string">'-'</span>) <span class="operator">=</span> (<span class="keyword">SELECT</span> GROUP_CONCAT(s.c_idï¼ŒSeparator <span class="string">'-'</span>)</span><br><span class="line">                                   <span class="keyword">FROM</span> tb_score s</span><br><span class="line">                                   <span class="keyword">WHERE</span> s.s_id <span class="operator">=</span> <span class="string">''</span><span class="number">01</span><span class="string">''</span>))</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="14"><a href="#14" class="headerlink" title="14"></a>14</h4><blockquote>
<p><strong>æŸ¥è¯¢æ²¡å­¦è¿‡â€å¼ ä¸‰â€è€å¸ˆè®²æˆçš„ä»»ä¸€é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå§“å</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                      <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                      <span class="keyword">WHERE</span> t.c_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> tc.c_id</span><br><span class="line">                                       <span class="keyword">FROM</span> tb_course tc</span><br><span class="line">                                       <span class="keyword">WHERE</span> tc.t_id <span class="operator">=</span> (<span class="keyword">SELECT</span> tt.t_id</span><br><span class="line">                                                        <span class="keyword">FROM</span> tb_teacher tt</span><br><span class="line">                                                        <span class="keyword">WHERE</span> tt.t_name <span class="operator">=</span> <span class="string">''</span>å¼ ä¸‰<span class="string">''</span></span><br><span class="line">                                       )));</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="15"><a href="#15" class="headerlink" title="15"></a>15</h4><blockquote>
<p><strong>æŸ¥è¯¢ä¸¤é—¨åŠå…¶ä»¥ä¸Šä¸åŠæ ¼è¯¾ç¨‹çš„åŒå­¦çš„å­¦å·ï¼Œå§“ååŠå…¶å¹³å‡æˆç»©</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.s_id, ts.s_name, ROUND(<span class="built_in">AVG</span>(t.s_score), <span class="number">2</span>) <span class="keyword">AS</span> `avgScore`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> t.s_id <span class="operator">=</span> ts.s_id</span><br><span class="line"><span class="keyword">WHERE</span> ts.s_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t.s_id</span><br><span class="line">                  <span class="keyword">FROM</span> tb_score t</span><br><span class="line">                  <span class="keyword">WHERE</span> t.s_score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line">                  <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.s_id</span><br><span class="line">                  <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(t.s_id) <span class="operator">&gt;</span> <span class="number">2</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="16"><a href="#16" class="headerlink" title="16"></a>16</h4><blockquote>
<p><strong>æ£€ç´¢â€01â€è¯¾ç¨‹åˆ†æ•°å°äº60ï¼ŒæŒ‰åˆ†æ•°é™åºæ’åˆ—çš„å­¦ç”Ÿä¿¡æ¯</strong></p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ts.<span class="operator">*</span>, t.s_score</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> t.s_id <span class="operator">=</span> ts.s_id</span><br><span class="line"><span class="keyword">WHERE</span> t.c_id <span class="operator">=</span> <span class="string">'01'</span></span><br><span class="line">  <span class="keyword">AND</span> t.s_score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> t.s_score <span class="keyword">DESC</span>;</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h4 id="17"><a href="#17" class="headerlink" title="17"></a>17</h4><blockquote>
<p>æŒ‰å¹³å‡æˆç»©ä»é«˜åˆ°ä½æ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ä»¥åŠå¹³å‡æˆç»©</p>
<p><span class="github-emoji"><span>ğŸ‘¨</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f468.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>:</p>
<ul>
<li>æŸ¥è¯¢ç»“æœè¿›è¡Œ<code>è¡Œè½¬åˆ—</code>æ“ä½œ</li>
<li>å¹³å‡æˆç»©åº”è¯¥æ˜¯æŒ‰ç…§æ¯ä¸ªåŒå­¦3é—¨è¯¾ç¨‹è®¡ç®—çš„</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- æ–¹å¼ä¸€</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.s_id, ts.s_name,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> t.c_id <span class="operator">=</span> <span class="string">'01'</span> <span class="keyword">THEN</span> t.s_score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> `<span class="keyword">Language</span>`,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> t.c_id <span class="operator">=</span> <span class="string">'02'</span> <span class="keyword">THEN</span> t.s_score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> `Math`,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> t.c_id <span class="operator">=</span> <span class="string">'03'</span> <span class="keyword">THEN</span> t.s_score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> `English`,</span><br><span class="line">       IFNULL(ROUND(<span class="built_in">SUM</span>(t.s_score) <span class="operator">/</span> <span class="number">3</span>, <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">AS</span> `avgScore`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> t.s_id <span class="operator">=</span> ts.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> `avgScore` <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹å¼äºŒï¼ˆæ¨èï¼šæ¯”è¾ƒç®€æ´ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ts.s_id, ts.s_name,</span><br><span class="line">       <span class="built_in">SUM</span>(IF(t.c_id <span class="operator">=</span> <span class="string">'01'</span>, t.s_score, <span class="number">0</span>)) <span class="keyword">AS</span> `<span class="keyword">Language</span>`,</span><br><span class="line">       <span class="built_in">SUM</span>(IF(t.c_id <span class="operator">=</span> <span class="string">'02'</span>, t.s_score, <span class="number">0</span>)) <span class="keyword">AS</span> `Math`,</span><br><span class="line">       <span class="built_in">SUM</span>(IF(t.c_id <span class="operator">=</span> <span class="string">'03'</span>, t.s_score, <span class="number">0</span>)) <span class="keyword">AS</span> `English`,</span><br><span class="line">       IFNULL(ROUND(<span class="built_in">SUM</span>(t.s_score) <span class="operator">/</span> <span class="number">3</span>, <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">AS</span> `avgScore`</span><br><span class="line"><span class="keyword">FROM</span> tb_student ts</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_score t <span class="keyword">ON</span> t.s_id <span class="operator">=</span> ts.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ts.s_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> `avgScore` <span class="keyword">DESC</span>;</span><br></pre></td></tr></tbody></table></figure>
<hr>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">#--18ã€æŸ¥è¯¢å„ç§‘æˆç»©æœ€é«˜åˆ†ã€æœ€ä½åˆ†å’Œå¹³å‡åˆ†ï¼šä»¥å¦‚ä¸‹å½¢å¼æ˜¾ç¤ºï¼šè¯¾ç¨‹IDï¼Œè¯¾ç¨‹nameï¼Œæœ€é«˜åˆ†ï¼Œæœ€ä½åˆ†ï¼Œå¹³å‡åˆ†ï¼ŒåŠæ ¼ç‡ï¼Œä¸­ç­‰ç‡ï¼Œä¼˜è‰¯ç‡ï¼Œä¼˜ç§€ç‡</span><br><span class="line"># åŠæ ¼ä¸º&gt;=60ï¼Œä¸­ç­‰ä¸ºï¼š70-80ï¼Œä¼˜è‰¯ä¸ºï¼š80-90ï¼Œä¼˜ç§€ä¸ºï¼š&gt;=90</span><br><span class="line"></span><br><span class="line">SELECT tc.c_id,</span><br><span class="line">       tc.c_name,</span><br><span class="line">       MAX(ts.s_score) AS `maxScore`,</span><br><span class="line">       MIN(ts.s_score) AS `minScore`,</span><br><span class="line">       ROUND(AVG(ts.s_score), 2) AS `avgScore`,</span><br><span class="line">       ROUND(SUM(IF(ts.s_score &gt;= 60, 1, 0)) / SUM(IF(ts.s_score, 1, 0)), 2) AS `60-rate`,</span><br><span class="line">       ROUND(SUM(IF(ts.s_score &gt;= 70 AND ts.s_score &lt; 80, 1, 0)) / SUM(IF(ts.s_score, 1, 0)), 2) AS `78-rate`,</span><br><span class="line">       ROUND(SUM(IF(ts.s_score &gt;= 80 AND ts.s_score &lt; 90, 1, 0)) / SUM(IF(ts.s_score, 1, 0)), 2) AS `89-rate`,</span><br><span class="line">       ROUND(SUM(IF(ts.s_score &gt;= 90, 1, 0)) / SUM(IF(ts.s_score, 1, 0)), 2) AS `90-rate`</span><br><span class="line">FROM tb_course tc</span><br><span class="line">         LEFT JOIN tb_score ts ON ts.c_id = tc.c_id</span><br><span class="line">GROUP BY tc.c_id;</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒå®‰è£…Docker</title>
    <url>/post/8037.html</url>
    <content><![CDATA[<h2 id="Linuxç¯å¢ƒå®‰è£…Docker"><a href="#Linuxç¯å¢ƒå®‰è£…Docker" class="headerlink" title="Linuxç¯å¢ƒå®‰è£…Docker"></a>Linuxç¯å¢ƒå®‰è£…Docker</h2><blockquote>
<p>æœ¬æ¬¡é‡‡ç”¨<code>yum</code>çš„æ–¹å¼å®‰è£…Dockerå·¥å…·</p>
</blockquote>
<h3 id="1-å®‰è£…ç³»ç»Ÿå·¥å…·"><a href="#1-å®‰è£…ç³»ç»Ÿå·¥å…·" class="headerlink" title="1. å®‰è£…ç³»ç»Ÿå·¥å…·"></a>1. å®‰è£…ç³»ç»Ÿå·¥å…·</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-æ·»åŠ è½¯ä»¶æº"><a href="#2-æ·»åŠ è½¯ä»¶æº" class="headerlink" title="2. æ·»åŠ è½¯ä»¶æº"></a>2. æ·»åŠ è½¯ä»¶æº</h3><blockquote>
<p>å®‰è£…è½¯ä»¶æºä¸ºï¼šé˜¿é‡Œäº‘ä»“åº“ï¼Œé€Ÿåº¦è¾ƒå¿«</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-æ›´æ–°yumç¼“å­˜"><a href="#3-æ›´æ–°yumç¼“å­˜" class="headerlink" title="3. æ›´æ–°yumç¼“å­˜"></a>3. æ›´æ–°yumç¼“å­˜</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum makecache fast</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-å®‰è£…Docker-ce"><a href="#4-å®‰è£…Docker-ce" class="headerlink" title="4. å®‰è£…Docker-ce"></a>4. å®‰è£…Docker-ce</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum -y install docker-ce</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-å¯åŠ¨Docker"><a href="#5-å¯åŠ¨Docker" class="headerlink" title="5. å¯åŠ¨Docker"></a>5. å¯åŠ¨Docker</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></tbody></table></figure>
<p>åˆ°æ­¤ç»“æŸï¼Œå®‰è£…æˆåŠŸï¼æ‹‰å–é•œåƒï¼Œå¿«ä¹ç©è€ã€‚</p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå®‰è£…ElasticSearchå’ŒKibanaæœåŠ¡</title>
    <url>/post/65274.html</url>
    <content><![CDATA[<h2 id="Linuxå®‰è£…ElasticSearchå’ŒKibanaæœåŠ¡"><a href="#Linuxå®‰è£…ElasticSearchå’ŒKibanaæœåŠ¡" class="headerlink" title="Linuxå®‰è£…ElasticSearchå’ŒKibanaæœåŠ¡"></a>Linuxå®‰è£…ElasticSearchå’ŒKibanaæœåŠ¡</h2><blockquote>
<p>è¿™é‡Œé€‰æ‹©æ¯”è¾ƒæ–¹ä¾¿çš„Dockeræ–¹å¼è¿›è¡Œå®‰è£…ï¼ŒåŒ…æ‹¬<code>ElasticSearch</code>ã€<code>Kibana</code>ã€<code>IKåˆ†è¯å™¨</code>ç­‰æœåŠ¡</p>
<ul>
<li>SpringBootå’ŒElasticsearchç‰ˆæœ¬å…³ç³»</li>
</ul>
<blockquote>
<p>å®‰è£…Elasticsearchä¹‹å‰ï¼Œä¸€å®šè¦å†ä¸‰ç¡®è®¤å’ŒSpringBootä¸­çš„ç‰ˆæœ¬æ˜¯å¦å¯¹åº”ï¼Œå¦åˆ™ä¼šåˆä¸å…¼å®¹çš„é—®é¢˜äº§ç”Ÿã€‚</p>
</blockquote>
<p><img src="https://i.loli.net/2021/06/21/r5i41yFeORsclLE.png" alt="SpringBootå’ŒElasticsearchç‰ˆæœ¬å…³ç³»"></p>
<ul>
<li>SpringBootã€SpringCloudã€SpringCloud Alibababç‰ˆæœ¬å…³ç³»</li>
</ul>
<blockquote>
<p>ä»¥ä¸‹ç‰ˆæœ¬çš„å¯¹åº”å…³ç³»ï¼Œéƒ½æ²¡æœ‰é—®é¢˜ï¼Œå¤§å®¶å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210621212235.png" alt="SpringBootã€SpringCloudã€SpringCloud Alibababç‰ˆæœ¬å…³ç³»"></p>
</blockquote>
<h3 id="ElasticSearchå®‰è£…"><a href="#ElasticSearchå®‰è£…" class="headerlink" title="ElasticSearchå®‰è£…"></a>ElasticSearchå®‰è£…</h3><h4 id="æ‹‰å–ElasticSearché•œåƒ"><a href="#æ‹‰å–ElasticSearché•œåƒ" class="headerlink" title="æ‹‰å–ElasticSearché•œåƒ"></a>æ‹‰å–ElasticSearché•œåƒ</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker pull elasticsearch:7.13.0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨ElasticSearch"><a href="#å¯åŠ¨ElasticSearch" class="headerlink" title="å¯åŠ¨ElasticSearch"></a>å¯åŠ¨ElasticSearch</h4><blockquote>
<p><strong>æ³¨æ„ï¼šå¿…é¡»æ·»åŠ <code>-e "discovery.type=single-node"</code>å¯åŠ¨å‚æ•°ã€å•æœºæ¨¡å¼å¯åŠ¨ã€‘ï¼Œå¦åˆ™ä¼šå¯åŠ¨åè‡ªåŠ¨å…³é—­</strong></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker run --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">"discovery.type=single-node"</span> -d elasticsearch:7.13.0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ£€æŸ¥æœåŠ¡"><a href="#æ£€æŸ¥æœåŠ¡" class="headerlink" title="æ£€æŸ¥æœåŠ¡"></a>æ£€æŸ¥æœåŠ¡</h4><blockquote>
<p>æµè§ˆå™¨è®¿é—®<code>http://121.5.168.31:9200</code>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚å‡ºç°ç±»ä¼¼ä¸‹é¢çš„ä¿¡æ¯ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸã€‚</p>
</blockquote>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"name"</span> : <span class="string">"530dd7820315"</span>,</span><br><span class="line">  <span class="attr">"cluster_name"</span> : <span class="string">"docker-cluster"</span>,</span><br><span class="line">  <span class="attr">"cluster_uuid"</span> : <span class="string">"7O0fjpBJTkmn_axwmZX0RQ"</span>,</span><br><span class="line">  <span class="attr">"version"</span> : {</span><br><span class="line">    <span class="attr">"number"</span> : <span class="string">"7.13.0"</span>,</span><br><span class="line">    <span class="attr">"build_flavor"</span> : <span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"build_type"</span> : <span class="string">"docker"</span>,</span><br><span class="line">    <span class="attr">"build_hash"</span> : <span class="string">"508c38a"</span>,</span><br><span class="line">    <span class="attr">"build_date"</span> : <span class="string">"2019-06-20T15:54:18.811730Z"</span>,</span><br><span class="line">    <span class="attr">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"lucene_version"</span> : <span class="string">"8.0.0"</span>,</span><br><span class="line">    <span class="attr">"minimum_wire_compatibility_version"</span> : <span class="string">"6.8.0"</span>,</span><br><span class="line">    <span class="attr">"minimum_index_compatibility_version"</span> : <span class="string">"6.0.0-beta1"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h4><h5 id="è§£å†³è·¨åŸŸé—®é¢˜"><a href="#è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="è§£å†³è·¨åŸŸé—®é¢˜"></a>è§£å†³è·¨åŸŸé—®é¢˜</h5><blockquote>
<p>å¯åŠ¨esæœåŠ¡ï¼Œè¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹<code>elasticsearch.yml</code>æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å¯åŠ¨ä¸­çš„å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [å®¹å™¨ID] /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥configç›®å½•ï¼Œå¹¶æ‰“å¼€elasticsearch.yml</span></span><br><span class="line">vim /usr/share/elasticsearch/config/elasticsearch.yml</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>åœ¨æ–‡ä»¶ä¸­åŠ ä¸Šä¸‹é¢é…ç½®ï¼Œè§£å†³è·¨åŸŸé—®é¢˜</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">"*"</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä¿å­˜é€€å‡ºï¼Œé‡å¯å®¹å™¨</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker restart [å®¹å™¨ID]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="IKåˆ†è¯å™¨å®‰è£…"><a href="#IKåˆ†è¯å™¨å®‰è£…" class="headerlink" title="IKåˆ†è¯å™¨å®‰è£…"></a>IKåˆ†è¯å™¨å®‰è£…</h3><blockquote>
<p>è®¿é—®<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">IKåˆ†è¯å™¨å„ç‰ˆæœ¬ä¸‹è½½</a>ç½‘ç«™ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„å‹ç¼©åŒ…ã€‚</p>
</blockquote>
<p><img src="https://i.loli.net/2021/06/21/UWAm5DT7Oc41FSG.png" alt="IKåˆ†è¯å™¨å„ç‰ˆæœ¬"></p>
<blockquote>
<p>è¿›å…¥eså®¹å™¨ï¼Œåœ¨pluginsç›®å½•ä¸­è§£å‹<code>elasticsearch-analysis-ik-7.13.0.zip</code>æ–‡ä»¶ï¼Œåˆ é™¤å‹ç¼©åŒ…ã€‚å…·ä½“å¯ä»¥åœ¨Kibanaå¯è§†åŒ–ç•Œé¢ä¸­æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å°†å‹ç¼©åŒ…å¤åˆ¶è¿›å®¹å™¨ä¸­</span></span><br><span class="line">docker cp [å‹ç¼©åŒ…è·¯å¾„] [å®¹å™¨ID]:/usr/share/elasticsearch/plugins/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [å®¹å™¨ID] /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/share/elasticsearch/plugins/</span><br><span class="line"> </span><br><span class="line"><span class="comment"># åœ¨ ik-analysisç›®å½•ä¸‹è§£å‹æ–‡ä»¶</span></span><br><span class="line">unzip elasticsearch-analysis-ik-7.13.0.zip -d ik-analyzerz</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å‹ç¼©åŒ…</span></span><br><span class="line">rm -rf elasticsearch-analysis-ik-7.13.0.zip</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Kibanaå®‰è£…"><a href="#Kibanaå®‰è£…" class="headerlink" title="Kibanaå®‰è£…"></a>Kibanaå®‰è£…</h3><h4 id="æ‹‰å–Kibanaé•œåƒ"><a href="#æ‹‰å–Kibanaé•œåƒ" class="headerlink" title="æ‹‰å–Kibanaé•œåƒ"></a>æ‹‰å–Kibanaé•œåƒ</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker pull kibana:7.13.0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨KibanaæœåŠ¡"><a href="#å¯åŠ¨KibanaæœåŠ¡" class="headerlink" title="å¯åŠ¨KibanaæœåŠ¡"></a>å¯åŠ¨KibanaæœåŠ¡</h4><blockquote>
<p>å¯åŠ¨KibanaæœåŠ¡ï¼Œè®¿é—®<code>http:121.5.168.31:5601</code>ï¼Œæµ‹è¯•æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚</p>
<p>æ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ <code>--link</code>å‚æ•°ï¼Œè¿›è¡Œä¸Šé¢å¯åŠ¨çš„ElasticSearchå®¹å™¨å’ŒKibanaçš„ç»‘å®š</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker run --name kibana --link elasticsearch -p 5601:5601 -d kibana:7.13.0</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æœåŠ¡ç»¼åˆæµ‹è¯•"><a href="#æœåŠ¡ç»¼åˆæµ‹è¯•" class="headerlink" title="æœåŠ¡ç»¼åˆæµ‹è¯•"></a>æœåŠ¡ç»¼åˆæµ‹è¯•</h3><ul>
<li>åˆ†è¯å™¨æµ‹è¯•</li>
</ul>
<p><img src="https://i.loli.net/2021/06/21/ThX5Rq1b8gKEDmt.png" alt="åˆ†è¯å™¨æµ‹è¯•"></p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>ElasticSearch</tag>
        <tag>Kibana</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒå®‰è£…JDK 1.8</title>
    <url>/post/4152.html</url>
    <content><![CDATA[<h2 id="Linuxç¯å¢ƒå®‰è£…JDK-1-8"><a href="#Linuxç¯å¢ƒå®‰è£…JDK-1-8" class="headerlink" title="Linuxç¯å¢ƒå®‰è£…JDK 1.8"></a>Linuxç¯å¢ƒå®‰è£…JDK 1.8</h2><h3 id="1-æ£€æŸ¥æœåŠ¡å™¨"><a href="#1-æ£€æŸ¥æœåŠ¡å™¨" class="headerlink" title="1. æ£€æŸ¥æœåŠ¡å™¨"></a>1. æ£€æŸ¥æœåŠ¡å™¨</h3><blockquote>
<p>è¾“å…¥<code>java -version</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹æœåŠ¡éƒ¨ç½²æ˜¯å¦è‡ªå¸¦jdkï¼Œå¦‚æœæœ‰ï¼Œå…ˆå¸è½½åˆ é™¤</p>
</blockquote>
<p>åˆ é™¤æ–¹æ³•ï¼š</p>
<ol>
<li>å‘ç°æœ‰è¾“å…¥ï¼šrpm -qa | grep java æ£€æµ‹jdkçš„å®‰è£…åŒ…ï¼Œï¼ˆæ³¨æ„ï¼šrpmå‘½ä»¤ç¬¦æ²¡æœ‰æ—¶è®°å¾—ä¸‹è½½ä¸€ä¸ªè¾“å…¥ï¼šapt-get install +å‘½ä»¤åç§°ï¼‰</li>
<li>æ¥ç€è¿›è¡Œä¸€ä¸ªä¸ªåˆ é™¤åŒ…ï¼Œè¾“å…¥ï¼šrpm -e â€”nodeps +åŒ…å</li>
<li>æœ€åå†æ¬¡ï¼šrpm -qa | grep javaæ£€æŸ¥æ˜¯å¦åˆ é™¤</li>
</ol>
<h3 id="2-åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶å¤¹"><a href="#2-åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶å¤¹" class="headerlink" title="2. åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶å¤¹"></a>2. åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶å¤¹</h3><blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œlinuxçš„å®‰è£…ç¨‹åºæ”¾åœ¨ <code>/usr/local</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯æ²¡æœ‰å¼ºåˆ¶è¦æ±‚</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos local]# mkdir -p jdk</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-ä¸Šä¼ å®‰è£…åŒ…"><a href="#3-ä¸Šä¼ å®‰è£…åŒ…" class="headerlink" title="3. ä¸Šä¼ å®‰è£…åŒ…"></a>3. ä¸Šä¼ å®‰è£…åŒ…</h3><blockquote>
<p>Oracleä¸‹è½½å®˜ç½‘ï¼š<a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">ç‚¹å‡»ä¸‹è½½JDK 1.8</a></p>
<blockquote>
<p>è´¦æˆ·ï¼š<code>1985479344@qq.com</code></p>
<p>å¯†ç ï¼š<code>Oracle123</code></p>
</blockquote>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos jdk]<span class="comment"># ll</span></span><br><span class="line">total 190564</span><br><span class="line">-rw-r--r-- 1 root root 195132576 Apr 18 16:58 jdk-8u251-linux-x64.tar.gz  <span class="comment"># jdkå®‰è£…åŒ…</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-è§£å‹å®‰è£…åŒ…"><a href="#4-è§£å‹å®‰è£…åŒ…" class="headerlink" title="4. è§£å‹å®‰è£…åŒ…"></a>4. è§£å‹å®‰è£…åŒ…</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos jdk] tar -zxvf jdk-8u251-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">[root@VM-0-4-centos jdk]<span class="comment"># ll</span></span><br><span class="line">total 190568</span><br><span class="line">drwxr-xr-x 7 10143 10143      4096 Mar 12  2020 jdk1.8.0_251</span><br><span class="line">-rw-r--r-- 1 root  root  195132576 Apr 18 16:58 jdk-8u251-linux-x64.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-é…ç½®ç¯å¢ƒå˜é‡"><a href="#5-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="5. é…ç½®ç¯å¢ƒå˜é‡"></a>5. é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos jdk1.8.0_251]<span class="comment"># vim /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># System wide environment and startup programs, for login setup</span></span><br><span class="line"><span class="comment"># Functions and aliases go in /etc/bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># It's NOT a good idea to change this file unless you know what you</span></span><br><span class="line"><span class="comment"># are doing. It's much better to create a custom.sh shell script in</span></span><br><span class="line"><span class="comment"># /etc/profile.d/ to make custom changes to your environment, as this</span></span><br><span class="line"><span class="comment"># will prevent the need for merging in future updates.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pathmunge</span></span> () {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">":<span class="variable">${PATH}</span>:"</span> <span class="keyword">in</span></span><br><span class="line">        *:<span class="string">"<span class="variable">$1</span>"</span>:*)</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"<span class="variable">$2</span>"</span> = <span class="string">"after"</span> ] ; <span class="keyword">then</span></span><br><span class="line">                PATH=<span class="variable">$PATH</span>:<span class="variable">$1</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PATH=<span class="variable">$1</span>:<span class="variable">$PATH</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -x /usr/bin/id ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$EUID</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># ksh workaround</span></span><br><span class="line">        EUID=`/usr/bin/id -u`</span><br><span class="line">        UID=`/usr/bin/id -ru`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    USER=<span class="string">"`/usr/bin/id -un`"</span></span><br><span class="line">    LOGNAME=<span class="variable">$USER</span></span><br><span class="line">    MAIL=<span class="string">"/var/spool/mail/<span class="variable">$USER</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path manipulation</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$EUID</span>"</span> = <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    pathmunge /usr/sbin</span><br><span class="line">    pathmunge /usr/<span class="built_in">local</span>/sbin</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    pathmunge /usr/<span class="built_in">local</span>/sbin after</span><br><span class="line">    pathmunge /usr/sbin after</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">HOSTNAME=`/usr/bin/hostname 2&gt;/dev/null`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$HISTCONTROL</span>"</span> = <span class="string">"ignorespace"</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">export</span> HISTCONTROL=ignoreboth</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">export</span> HISTCONTROL=ignoredups</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL</span><br><span class="line"></span><br><span class="line"><span class="comment"># By default, we want umask to get set. This sets it for login shell</span></span><br><span class="line"><span class="comment"># Current threshold for system reserved uid/gids is 200</span></span><br><span class="line"><span class="comment"># You could check uidgid reservation validity in</span></span><br><span class="line"><span class="comment"># /usr/share/doc/setup-*/uidgid file</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$UID</span> -gt 199 ] &amp;&amp; [ <span class="string">"`/usr/bin/id -gn`"</span> = <span class="string">"`/usr/bin/id -un`"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">umask</span> 002</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">umask</span> 022</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /etc/profile.d/*.sh /etc/profile.d/sh.local ; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -r <span class="string">"<span class="variable">$i</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">${-#*i}</span>"</span> != <span class="string">"$-"</span> ]; <span class="keyword">then</span></span><br><span class="line">            . <span class="string">"<span class="variable">$i</span>"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            . <span class="string">"<span class="variable">$i</span>"</span> &gt;/dev/null</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> i</span><br><span class="line"><span class="built_in">unset</span> -f pathmunge       </span><br><span class="line"></span><br><span class="line"><span class="comment"># jdkç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># JAVA_HOMEï¼šjdkè§£å‹çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk/jdk1.8.0_251</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=$:CLASSPATH:<span class="variable">$JAVA_HOME</span>/lib/</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-åˆ·æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶"><a href="#6-åˆ·æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶" class="headerlink" title="6. åˆ·æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶"></a>6. åˆ·æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos jdk1.8.0_251]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="7-æ£€æŸ¥æ˜¯å¦æˆåŠŸ"><a href="#7-æ£€æŸ¥æ˜¯å¦æˆåŠŸ" class="headerlink" title="7.æ£€æŸ¥æ˜¯å¦æˆåŠŸ"></a>7.æ£€æŸ¥æ˜¯å¦æˆåŠŸ</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos jdk1.8.0_251]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_251"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_251-b08)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.251-b08, mixed mode)</span><br><span class="line"></span><br><span class="line">[root@VM-0-4-centos jdk1.8.0_251]<span class="comment"># javac</span></span><br><span class="line">Usage: javac &lt;options&gt; &lt;<span class="built_in">source</span> files&gt;</span><br><span class="line"><span class="built_in">where</span> possible options include:</span><br><span class="line">  -g                         Generate all debugging info</span><br><span class="line">  -g:none                    Generate no debugging info</span><br><span class="line">  -g:{lines,vars,<span class="built_in">source</span>}     Generate only some debugging info</span><br><span class="line">  -nowarn                    Generate no warnings</span><br><span class="line">  -verbose                   Output messages about what the compiler is doing</span><br><span class="line">  -deprecation               Output <span class="built_in">source</span> locations <span class="built_in">where</span> deprecated APIs are used</span><br><span class="line">  -classpath &lt;path&gt;          Specify <span class="built_in">where</span> to find user class files and annotation processors</span><br><span class="line">  -cp &lt;path&gt;                 Specify <span class="built_in">where</span> to find user class files and annotation processors</span><br><span class="line">  -sourcepath &lt;path&gt;         Specify <span class="built_in">where</span> to find input <span class="built_in">source</span> files</span><br><span class="line">  -bootclasspath &lt;path&gt;      Override location of bootstrap class files</span><br><span class="line">  -extdirs &lt;<span class="built_in">dirs</span>&gt;            Override location of installed extensions</span><br><span class="line">  -endorseddirs &lt;<span class="built_in">dirs</span>&gt;       Override location of endorsed standards path</span><br><span class="line">  -proc:{none,only}          Control whether annotation processing and/or compilation is <span class="keyword">done</span>.</span><br><span class="line">  -processor &lt;class1&gt;[,&lt;class2&gt;,&lt;class3&gt;...] Names of the annotation processors to run; bypasses default discovery process</span><br><span class="line">  -processorpath &lt;path&gt;      Specify <span class="built_in">where</span> to find annotation processors</span><br><span class="line">  -parameters                Generate metadata <span class="keyword">for</span> reflection on method parameters</span><br><span class="line">  -d &lt;directory&gt;             Specify <span class="built_in">where</span> to place generated class files</span><br><span class="line">  -s &lt;directory&gt;             Specify <span class="built_in">where</span> to place generated <span class="built_in">source</span> files</span><br><span class="line">  -h &lt;directory&gt;             Specify <span class="built_in">where</span> to place generated native header files</span><br><span class="line">  -implicit:{none,class}     Specify whether or not to generate class files <span class="keyword">for</span> implicitly referenced files</span><br><span class="line">  -encoding &lt;encoding&gt;       Specify character encoding used by <span class="built_in">source</span> files</span><br><span class="line">  -<span class="built_in">source</span> &lt;release&gt;          Provide <span class="built_in">source</span> compatibility with specified release</span><br><span class="line">  -target &lt;release&gt;          Generate class files <span class="keyword">for</span> specific VM version</span><br><span class="line">  -profile &lt;profile&gt;         Check that API used is available <span class="keyword">in</span> the specified profile</span><br><span class="line">  -version                   Version information</span><br><span class="line">  -<span class="built_in">help</span>                      Print a synopsis of standard options</span><br><span class="line">  -Akey[=value]              Options to pass to annotation processors</span><br><span class="line">  -X                         Print a synopsis of nonstandard options</span><br><span class="line">  -J&lt;flag&gt;                   Pass &lt;flag&gt; directly to the runtime system</span><br><span class="line">  -Werror                    Terminate compilation <span class="keyword">if</span> warnings occur</span><br><span class="line">  @&lt;filename&gt;                Read options and filenames from file</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>åˆ°æ­¤ç»“æŸï¼ŒJDKå®‰è£…åœ†æ»¡ç»“æŸã€‚</p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>JDK</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒå®‰è£…MySQL 5.7</title>
    <url>/post/1735.html</url>
    <content><![CDATA[<h2 id="Linuxç¯å¢ƒå®‰è£…MySQL-5-7"><a href="#Linuxç¯å¢ƒå®‰è£…MySQL-5-7" class="headerlink" title="Linuxç¯å¢ƒå®‰è£…MySQL 5.7"></a>Linuxç¯å¢ƒå®‰è£…MySQL 5.7</h2><blockquote>
<p>èµ„æºä¸‹è½½ï¼š</p>
<ul>
<li><p>å®˜ç½‘ï¼š<a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads">ç‚¹å‡»ä¸‹è½½MySQL 5.7</a></p>
</li>
<li><p>é€‰é¡¹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210418175130.png" alt="image-20210418175121139"></p>
</li>
</ul>
</blockquote>
<h3 id="1-åˆ›å»ºæ–‡ä»¶å¤¹"><a href="#1-åˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="1. åˆ›å»ºæ–‡ä»¶å¤¹"></a>1. åˆ›å»ºæ–‡ä»¶å¤¹</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos <span class="built_in">local</span>]<span class="comment"># mkdir mysql</span></span><br><span class="line">[root@VM-0-4-centos <span class="built_in">local</span>]<span class="comment"># ll</span></span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Aug  5  2020 bin</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 etc</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 games</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 include</span><br><span class="line">drwxr-xr-x   3 root root 4096 Apr 18 17:13 jdk</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 lib</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 lib64</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 libexec</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 18 17:45 mysql  <span class="comment"># åˆ›å»ºæˆåŠŸ</span></span><br><span class="line">drwxr-xr-x  13 root root 4096 Apr 18 15:42 qcloud</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 sbin</span><br><span class="line">drwxr-xr-x.  5 root root 4096 Mar  7  2019 share</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Apr 11  2018 src</span><br><span class="line">srwxrwxrwx   1 root root    0 Apr 18 16:10 yd.socket.server</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-ä¼ è¾“æ–‡ä»¶"><a href="#2-ä¼ è¾“æ–‡ä»¶" class="headerlink" title="2. ä¼ è¾“æ–‡ä»¶"></a>2. ä¼ è¾“æ–‡ä»¶</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos mysql]<span class="comment"># ll</span></span><br><span class="line">total 646220</span><br><span class="line">-rw-r--r-- 1 root root 661718255 Apr 18 18:11 mysql-5.7.33-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-1-è§£å‹æ–‡ä»¶"><a href="#2-1-è§£å‹æ–‡ä»¶" class="headerlink" title="2.1 è§£å‹æ–‡ä»¶"></a>2.1 è§£å‹æ–‡ä»¶</h4><blockquote>
<p>æ³¨æ„ï¼šè§£å‹æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹åŠ å‹åçš„ç›®å½•åä¸ºmysql</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">tar -xvzf mysql-5.7.33-linux-glibc2.12-x86_64.tar.gz -C /usr/<span class="built_in">local</span>/mysql/</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-åˆ›å»ºmysqlç”¨æˆ·"><a href="#3-åˆ›å»ºmysqlç”¨æˆ·" class="headerlink" title="3. åˆ›å»ºmysqlç”¨æˆ·"></a>3. åˆ›å»ºmysqlç”¨æˆ·</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql mysql</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-1åˆ›å»ºæ•°æ®ç›®å½•å¹¶æˆæƒ"><a href="#3-1åˆ›å»ºæ•°æ®ç›®å½•å¹¶æˆæƒ" class="headerlink" title="3.1åˆ›å»ºæ•°æ®ç›®å½•å¹¶æˆæƒ"></a>3.1åˆ›å»ºæ•°æ®ç›®å½•å¹¶æˆæƒ</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mkdir -p  data             <span class="comment">#åœ¨mysqlç›®å½•ä¸‹åˆ›å»ºdataç›®å½•</span></span><br><span class="line">chown mysql:mysql -R data  <span class="comment">#èµ‹äºˆæƒé™</span></span><br><span class="line"></span><br><span class="line">[root@VM-0-4-centos mysql]<span class="comment"># ll</span></span><br><span class="line">total 646500</span><br><span class="line">drwxr-xr-x  2 root  root       4096 Apr 18 18:12 bin</span><br><span class="line">drwxr-xr-x  5 mysql mysql      4096 Apr 18 18:58 data  <span class="comment"># åˆ›å»ºçš„dataç›®å½•</span></span><br><span class="line">drwxr-xr-x  2 root  root       4096 Apr 18 18:12 docs</span><br><span class="line">drwxr-xr-x  3 root  root       4096 Apr 18 18:12 include</span><br><span class="line">drwxr-xr-x  5 root  root       4096 Apr 18 18:12 lib</span><br><span class="line">-rw-r--r--  1  7161 31415    250129 Dec 10 11:01 LICENSE</span><br><span class="line">drwxr-xr-x  4 root  root       4096 Apr 18 18:12 man</span><br><span class="line">-rw-r--r--  1 root  root  661718255 Apr 18 18:11 mysql-5.7.33-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">-rw-r--r--  1  7161 31415       566 Dec 10 11:01 README</span><br><span class="line">drwxr-xr-x 28 root  root       4096 Apr 18 18:12 share</span><br><span class="line">drwxr-xr-x  2 root  root       4096 Apr 18 18:12 support-files</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#4-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="4.ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>4.ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos mysql]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment"># base config</span></span><br><span class="line">bind-address=0.0.0.0</span><br><span class="line">port=3306</span><br><span class="line"><span class="comment"># è§£é™¤group by é™åˆ¶ï¼ˆæ ¹æ®é¡¹ç›®éœ€è¦è¿›è¡Œé…ç½®ï¼‰</span></span><br><span class="line">sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line"><span class="comment"># åŸºæœ¬è·¯å¾„</span></span><br><span class="line">basedir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼šå¯ä»¥å†™ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å†™ç›¸å¯¹ä¸basedirè·¯å¾„ /data</span></span><br><span class="line">datadir=/usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line"><span class="comment"># å¿…é¡»è¿™æ ·å†™ï¼Œå¦åˆ™æŠ¥é”™</span></span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"><span class="comment"># mysqlé”™è¯¯æ—¥å¿—ç­‰ä¿¡æ¯è¾“å‡ºè·¯å¾„</span></span><br><span class="line">log-error=/usr/<span class="built_in">local</span>/mysql/data/mysql.err</span><br><span class="line">pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysql.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># character config</span></span><br><span class="line">character_set_server=utf8mb4</span><br><span class="line">symbolic-links=0</span><br><span class="line">explicit_defaults_for_timestamp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================éå¿…è¦ä¸é…ç½®é¡¹ï¼ˆå½±å“æ€§èƒ½ï¼‰=======================</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># å¼€å¯æ…¢SQLæ—¥å¿—</span></span><br><span class="line"> slow_query_log=1</span><br><span class="line"> <span class="comment"># æ…¢SQLæ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºç›®å½•</span></span><br><span class="line"> slow_query_log_file=/usr/<span class="built_in">local</span>/mysql/data/horse-slow.log</span><br><span class="line"> <span class="comment"># å®šä¹‰æ…¢SQLçš„æ—¶é—´é˜ˆå€¼</span></span><br><span class="line"> long_query_time=2</span><br><span class="line"> log_output=FILE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment"># å¼€å¯binlogæ—¥å¿—</span></span><br><span class="line"> <span class="comment"># binlogæ—¥å¿—çš„åŸºæœ¬è·¯å¾„å’Œæ–‡ä»¶åï¼Œåé¢ä¼šè¿½åŠ æ ‡è¯†æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"> log_bin=/usr/<span class="built_in">local</span>/mysql/binlog/horse-bin</span><br><span class="line"> <span class="comment"># æŒ‡å®šbinlogæ–‡ä»¶çš„ç´¢å¼•æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç®¡ç†äº†æ‰€æœ‰çš„binlogæ–‡ä»¶çš„ç›®å½•ï¼ˆéœ€è¦æå‰åœ¨æŒ‡å®šæ–‡ä»¶å¤¹å†…åˆ›å»º horse-bin.index æ–‡ä»¶ï¼Œé‡æ–°èµ‹äºˆmysqlç”¨æˆ·ç»„å’Œç”¨æˆ·æƒé™ï¼‰</span></span><br><span class="line"> log_bin_index=/usr/<span class="built_in">local</span>/mysql/binlog/horse-bin.index</span><br><span class="line"></span><br><span class="line"> <span class="comment"># éšä¾¿æŒ‡å®šä¸€ä¸ªæœåŠ¡id,é˜²æ­¢å¼€å¯binlogæ—¥å¿—åé‡å¯æŠ¥é”™ï¼ˆé›†ç¾¤æ¨¡å¼ä¸èƒ½éšæ„æŒ‡å®šï¼‰</span></span><br><span class="line"> server-id=142804</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">~                                                                                                                          </span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-åˆå§‹åŒ–æ•°æ®åº“"><a href="#5-åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="5. åˆå§‹åŒ–æ•°æ®åº“"></a>5. åˆå§‹åŒ–æ•°æ®åº“</h3><blockquote>
<p>è¿›å…¥ <code>usr/local/mysql/bin</code>ç›®å½•</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos bin]<span class="comment"># ./mysqld --defaults-file=/etc/my.cnf --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql --initialize</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æŸ¥çœ‹æ–‡ä»¶ï¼š <code>data/mysql.err</code></p>
<p>åˆå§‹å¯†ç ï¼šISocfpU5)Q05</p>
<blockquote>
<p><strong>æ³¨æ„ï¼šæœ‰äº›æ—¶å€™ä¸ä¼šç”Ÿæˆ<code>mysql.err</code>æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿›è¡Œåˆå§‹åŒ–æ•°æ®åº“çš„æ—¶å€™ï¼Œå°±ä¼šæ‰“å°å‡ºæ¥åˆå§‹å¯†ç ï¼Œæ³¨æ„ç•™æ„è§‚å¯Ÿã€‚</strong></p>
</blockquote>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos data]<span class="comment"># cat mysql.err</span></span><br><span class="line">2021-05-25T07:44:00.830896Z 0 [Warning] InnoDB: New <span class="built_in">log</span> files created, LSN=45790</span><br><span class="line">2021-05-25T07:44:00.887685Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2021-05-25T07:44:00.953891Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: f874ad02-bd2c-11eb-aad9-525400aeab38.</span><br><span class="line">2021-05-25T07:44:00.956852Z 0 [Warning] Gtid table is not ready to be used. Table <span class="string">'mysql.gtid_executed'</span> cannot be opened.</span><br><span class="line">2021-05-25T07:44:02.455187Z 0 [Warning] CA certificate ca.pem is self signed.</span><br><span class="line">2021-05-25T07:44:02.679717Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: ISocfpU5)Q05</span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-å¯åŠ¨mysqlæœåŠ¡"><a href="#6-å¯åŠ¨mysqlæœåŠ¡" class="headerlink" title="6. å¯åŠ¨mysqlæœåŠ¡"></a>6. å¯åŠ¨mysqlæœåŠ¡</h3><blockquote>
<p>å…ˆå°†mysql.serveræ”¾ç½®åˆ°/etc/init.d/mysqlä¸­ï¼Œæ‰§è¡Œ<code>service mysql start</code>å¯åŠ¨æœåŠ¡</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos support-files]<span class="comment"># cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</span></span><br><span class="line"></span><br><span class="line">[root@VM-0-4-centos support-files]<span class="comment"># service mysql start</span></span><br><span class="line">Starting MySQL. SUCCESS! </span><br><span class="line">[root@VM-0-4-centos support-files]<span class="comment"># ps -ef | grep mysql</span></span><br><span class="line">root     30343     1  0 19:08 pts/0    00:00:00 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --datadir=/usr/<span class="built_in">local</span>/mysql/data --pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysql.pid</span><br><span class="line">mysql    30558 30343  2 19:08 pts/0    00:00:00 /usr/<span class="built_in">local</span>/mysql/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --user=mysql --log-error=/usr/<span class="built_in">local</span>/mysql/data/mysql.err --pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysql.pid --socket=/tmp/mysql.sock --port=3306</span><br><span class="line">root     30616  9420  0 19:08 pts/0    00:00:00 grep --color=auto mysql</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="7-ä¿®æ”¹å¯†ç "><a href="#7-ä¿®æ”¹å¯†ç " class="headerlink" title="7. ä¿®æ”¹å¯†ç "></a>7. ä¿®æ”¹å¯†ç </h3><blockquote>
<p>åœ¨<code>/bin</code>ç›®å½•ä¸‹ï¼Œç™»å½•mysql</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@VM-0-4-centos bin]<span class="comment"># ./mysql -u root -p</span></span><br><span class="line">Enter password: åˆšåˆšçš„éšæœºç”Ÿæˆçš„å¯†ç  </span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä¿®æ”¹å¯†ç ï¼šæ‰§è¡Œä¸‹é¢æ“ä½œåï¼Œ<code>exit</code>é€€å‡ºï¼Œé‡æ–°ç™»å½•ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> password = password(<span class="string">'å¯†ç '</span>)</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> password expire never;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ–è€…ä¸‹é¢çš„æ–¹å¼ä¿®æ”¹å¯†ç </p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mysql&gt; ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'å¯†ç '</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="8-é…ç½®è¿œç¨‹é“¾æ¥"><a href="#8-é…ç½®è¿œç¨‹é“¾æ¥" class="headerlink" title="8. é…ç½®è¿œç¨‹é“¾æ¥"></a>8. é…ç½®è¿œç¨‹é“¾æ¥</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mysql&gt; use mysql  <span class="comment"># åˆ‡æ¢mysqlæ•°æ®åº“</span></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> host=<span class="string">'%'</span> <span class="built_in">where</span> user=<span class="string">'root'</span>;  <span class="comment"># è®¾ç½®rootç”¨æˆ·å…è®¸ä»»ä½•hostè¿æ¥è®¿é—®</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges <span class="comment"># åˆ·æ–°æƒé™</span></span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="9-è®¾ç½®mysqlè‡ªå¯åŠ¨"><a href="#9-è®¾ç½®mysqlè‡ªå¯åŠ¨" class="headerlink" title="9. è®¾ç½®mysqlè‡ªå¯åŠ¨"></a>9. è®¾ç½®mysqlè‡ªå¯åŠ¨</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸€æ­¥ï¼Œä¸Šé¢ç¬¬6æ­¥å·²ç»æ‰§è¡Œè¿‡å•¦ï¼Œæ‰€ä»¥è¿™é‡Œæ— æ‰€è°“å•¦</span></span><br><span class="line"><span class="comment">#&nbsp;cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</span></span><br><span class="line"></span><br><span class="line">&nbsp;<span class="comment"># chkconfig --add mysql</span></span><br><span class="line"></span><br><span class="line">&nbsp;<span class="comment"># chkconfig --level 2345 mysql on</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># é‡å¯mysqlæœåŠ¡</span></span><br><span class="line">&nbsp;<span class="comment"># service mysql restart</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="10-æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#10-æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="10. æ·»åŠ ç¯å¢ƒå˜é‡"></a>10. æ·»åŠ ç¯å¢ƒå˜é‡</h3><blockquote>
<p>æ·»åŠ ç¯å¢ƒå˜é‡åï¼Œæ‰èƒ½ä½¿ç”¨åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨mysql -uroot -pç­‰mysqlå‘½ä»¤</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š <code>vim /etc/profile</code>ï¼Œç¼–è¾‘åæ‰§è¡Œåˆ·æ–°å‘½ä»¤ï¼š<code>souce /etc/profile</code></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> MYSQL_HOME=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$MYSQL_HOME</span>/bin</span><br></pre></td></tr></tbody></table></figure>
<p>å®‰è£…åˆ°æ­¤ç»“æŸï¼Œè¿œç¨‹è¿æ¥ï¼Œå°½æƒ…äº«ç”¨å§ã€‚</p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒä¸‹å®‰è£…MongoDB 4.x</title>
    <url>/post/51047.html</url>
    <content><![CDATA[<h2 id="Linuxç¯å¢ƒä¸‹å®‰è£…MongoDB-4-x"><a href="#Linuxç¯å¢ƒä¸‹å®‰è£…MongoDB-4-x" class="headerlink" title="Linuxç¯å¢ƒä¸‹å®‰è£…MongoDB 4.x"></a>Linuxç¯å¢ƒä¸‹å®‰è£…MongoDB 4.x</h2><h3 id="1-é…ç½®yumæº"><a href="#1-é…ç½®yumæº" class="headerlink" title="1. é…ç½®yumæº"></a>1. é…ç½®yumæº</h3><blockquote>
<p>åœ¨<code>/etc/yum.repos.d/</code>ç›®å½•ä¸‹ï¼Œåˆ›å»º<code>mongodb-org-4.2.repo</code>æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">vim mongodb-org-4.2.repo</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-1-æ·»åŠ å†…å®¹"><a href="#1-1-æ·»åŠ å†…å®¹" class="headerlink" title="1.1 æ·»åŠ å†…å®¹"></a>1.1 æ·»åŠ å†…å®¹</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[mongodb-org-4.2]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/4.2/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">yum install -y mongodb-org</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-åˆ›å»ºé»˜è®¤ç›®å½•"><a href="#3-åˆ›å»ºé»˜è®¤ç›®å½•" class="headerlink" title="3. åˆ›å»ºé»˜è®¤ç›®å½•"></a>3. åˆ›å»ºé»˜è®¤ç›®å½•</h3><blockquote>
<p>mongoé…ç½®æ–‡ä»¶ä¸­é»˜è®¤é…ç½®çš„æœ‰æ•°æ®ç›®å½•<code>/var/lib/mongo</code>å’Œæ—¥å¿—ç›®å½•<code>/var/log/mongodb</code>ï¼Œä½†æ˜¯yumæ–¹å¼å®‰è£…å¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ‰€ä»¥ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹ã€‚</p>
<p><strong>æ³¨æ„ï¼šä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶æœ€å¥½ç›´æ¥å¤åˆ¶å‘½ä»¤æ‰§è¡Œï¼Œï¼ˆæ–‡ä»¶å¤¹çš„æƒé™å½’å±åº”è¯¥ä¸º <code>mongod</code>, ä¸èƒ½æ˜¯ <code>root</code>ï¼‰</strong></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mkdir -p /var/lib/mongo</span><br><span class="line">mkdir -p /var/<span class="built_in">log</span>/mongodb</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-åŸºæœ¬å‘½ä»¤"><a href="#4-åŸºæœ¬å‘½ä»¤" class="headerlink" title="4. åŸºæœ¬å‘½ä»¤"></a>4. åŸºæœ¬å‘½ä»¤</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">systemctl start mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">systemctl stop mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">systemctl restart mongod</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-è¿œç¨‹è¿æ¥"><a href="#5-è¿œç¨‹è¿æ¥" class="headerlink" title="5. è¿œç¨‹è¿æ¥"></a>5. è¿œç¨‹è¿æ¥</h3><blockquote>
<p>æŸ¥çœ‹mongodbçš„å®‰è£…ç›®å½•ï¼Œæ‰¾åˆ°<code>mongod.conf</code>é…ç½®æ–‡ä»¶ï¼Œè¿›è¡ŒåŸºæœ¬é…ç½®</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># whereis  mongod</span></span><br><span class="line">mongod: /usr/bin/mongod /etc/mongod.conf /usr/share/man/man1/mongod.1</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ç¼–è¾‘<code>/etc/mongod.conf</code>é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># vim /etc/mongod.conf </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for documentation of all options, see:</span></span><br><span class="line"><span class="comment">#   http://docs.mongodb.org/manual/reference/configuration-options/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># where to write logging data</span></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file <span class="comment"># è¾“å‡ºæ—¥å¿—ç±»å‹ä¸ºï¼šæ–‡ä»¶</span></span><br><span class="line">  logAppend: <span class="literal">true</span> <span class="comment"># ä»¥è¿½åŠ çš„æ–¹å¼è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">  path: /var/<span class="built_in">log</span>/mongodb/mongod.log <span class="comment"># æ—¥å¿—æ–‡ä»¶è¾“å‡ºè·¯å¾„</span></span><br><span class="line">  quiet: <span class="literal">true</span> <span class="comment"># å¼€å¯è¿™ä¸ªé€‰é¡¹ï¼šå¯ä»¥æœ‰æ•ˆå‡å°‘ä¸€äº›æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where and how to store data.</span></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /var/lib/mongo <span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„</span></span><br><span class="line">  journal:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line"><span class="comment">#  engine:</span></span><br><span class="line"><span class="comment">#  wiredTiger:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># how the process runs</span></span><br><span class="line">processManagement:</span><br><span class="line">  fork: <span class="literal">true</span>  <span class="comment"># fork and run in background</span></span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod.pid  <span class="comment"># location of pidfile</span></span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># network interfaces</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹ç»‘å®šIPä¸ºï¼š0.0.0.0ï¼Œè¿œç¨‹ä»»ä½•è®¾å¤‡éƒ½å¯è¿æ¥</span></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æƒé™è®¤è¯</span></span><br><span class="line">security:</span><br><span class="line">  authorization: enabled <span class="comment"># MondoDBè®¤è¯åŠŸèƒ½</span></span><br><span class="line">  javascriptEnabled: <span class="literal">false</span> <span class="comment"># æ˜¯å¦å…è®¸æ‰§è¡ŒJavaScriptè„šæœ¬</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>é˜²ç«å¢™æ˜¯å¦å…³é—­ï¼Œæˆ–è€…æ­¤ç«¯å£æ˜¯å¦è¢«æ”¾è¡Œ</li>
<li>å¼€æ”¾äº‘æœåŠ¡å™¨å®‰å…¨ç»„ç«¯å£27017</li>
</ul>
</blockquote>
<p>centos 7å…³é—­é˜²ç«å¢™å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">systemctl stop firewalld.service  <span class="comment">#åœæ­¢firewall</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service  <span class="comment">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-å¸è½½æ–¹æ³•"><a href="#6-å¸è½½æ–¹æ³•" class="headerlink" title="6. å¸è½½æ–¹æ³•"></a>6. å¸è½½æ–¹æ³•</h3><blockquote>
<p>å¦‚æœå®‰è£…æœ‰é—®é¢˜ï¼Œå¯ä»¥å¸è½½åé‡æ–°å®‰è£…ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">systemctl stop mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ä¾èµ–åŒ…</span></span><br><span class="line">yum erase $(rpm -qa | grep mongodb-org)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ•°æ®å’Œæ—¥å¿—ç›®å½•</span></span><br><span class="line">sudo rm -rf /var/<span class="built_in">log</span>/mongodb</span><br><span class="line">sudo rm -rf /var/lib/mongo</span><br></pre></td></tr></tbody></table></figure>
<p>åˆ°æ­¤ç»“æŸï¼Œå®‰è£…å®Œæ¯•ï¼</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦é…ç½®mongodbçš„å†…å­˜å ç”¨ï¼Œä½†æ˜¯é‰´äºæˆ‘è¿™å°æœåŠ¡å™¨ï¼Œèƒ½è·‘èµ·æ¥å°±å¾ˆä¸é”™å•¦ã€‚<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</blockquote>
<h3 id="7-ä¿¡æ¯é…ç½®"><a href="#7-ä¿¡æ¯é…ç½®" class="headerlink" title="7. ä¿¡æ¯é…ç½®"></a>7. ä¿¡æ¯é…ç½®</h3><blockquote>
<p>æ‰§è¡Œ<code>mongo</code>å‘½ä»¤ï¼Œè®¾ç½®ç”¨æˆ·è§’è‰²æƒé™å’Œå¯†ç </p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse /]<span class="comment"># mongo</span></span><br><span class="line">MongoDB shell version v4.2.14</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session { <span class="string">"id"</span> : UUID(<span class="string">"04441842-9937-4462-a3ed-ebc7254f2e9c"</span>) }</span><br><span class="line">MongoDB server version: 4.2.14</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.createUser({user:<span class="string">"root"</span>,<span class="built_in">pwd</span>:<span class="string">"*****"</span>,roles:[{role:<span class="string">"root"</span>,db:<span class="string">"admin"</span>}]})</span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®å®Œæˆåï¼Œç›´æ¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·è¿æ¥å³å¯ï¼ï¼ï¼</p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå®‰è£…Redis 6.2.1</title>
    <url>/post/58790.html</url>
    <content><![CDATA[<h2 id="Linuxå®‰è£…Redis-6-2-1"><a href="#Linuxå®‰è£…Redis-6-2-1" class="headerlink" title="Linuxå®‰è£…Redis 6.2.1"></a>Linuxå®‰è£…Redis 6.2.1</h2><h3 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="headerlink" title="ä¸‹è½½è§£å‹"></a>ä¸‹è½½è§£å‹</h3><blockquote>
<ol>
<li>åˆ°Rediså®˜ç½‘ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆï¼š<a href="https://redis.io/download">Reidså®˜ç½‘</a> </li>
<li>ä¸Šä¼ åˆ°<code>/usr/local/redis/</code>ç›®å½•ä¸‹å¹¶è§£å‹</li>
</ol>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis]<span class="comment"># tar -zxvf redis-6.2.1.tar.gz </span></span><br><span class="line">[root@horse redis]<span class="comment"># ll</span></span><br><span class="line">total 2388</span><br><span class="line">drwxrwxr-x 9 root root    4096 Apr 19 10:18 redis-6.2.1</span><br><span class="line">-rw-r--r-- 1 root root 2438367 Apr 19 09:14 redis-6.2.1.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<p>è§£å‹åçš„æ–‡ä»¶åœ¨<code>/usr/local/redis/redis-6.2.1</code>ç›®å½•ä¸‹ï¼Œ==å­˜å‚¨ä½ç½®ï¼Œçœ‹è‡ªå·±å¿ƒæƒ…<span class="github-emoji"><span>ğŸ˜†</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>==</p>
<h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><blockquote>
<p>æ³¨æ„ï¼šå¿…é¡»å…ˆæ‰§è¡Œ<code>gcc -v</code>æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦å®‰è£… <code>gcc</code>ç¼–è¯‘å™¨ï¼Œæ²¡æœ‰åˆ™éœ€è¦è¿›è¡Œå®‰è£…ï¼Œå¦åˆ™åé¢çš„ç¼–è¯‘å›æŠ¥é”™ã€‚(æˆ‘çš„æ˜¯å·²ç»å®‰è£…çš„äº†)</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse lib]<span class="comment"># gcc -v # æŸ¥è¯¢gccç‰ˆæœ¬</span></span><br><span class="line">ä½¿ç”¨å†…å»º specsã€‚</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper</span><br><span class="line">ç›®æ ‡ï¼šx86_64-redhat-linux</span><br><span class="line">é…ç½®ä¸ºï¼š../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux</span><br><span class="line">çº¿ç¨‹æ¨¡å‹ï¼šposix</span><br><span class="line">gcc ç‰ˆæœ¬ 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># yumæ–¹å¼å®‰è£…gccå‘½ä»¤</span></span><br><span class="line">yum install -y gcc g++ gcc-c++</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>è¿›å…¥<code>/usr/local/redis/redis-6.2.1</code>ç›®å½•ï¼Œæ‰§è¡Œç¼–è¯‘ã€‚ç¼–è¯‘åä¼šå‡ºç°<code>redis.conf</code>æ–‡ä»¶å’Œ<code>src</code>ç›®å½•ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis-6.2.1]<span class="comment"># make</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ç¼–è¯‘æˆåŠŸï¼Œè¿›å…¥<code>src</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>make install</code>è¿›è¡ŒRediså®‰è£…ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse src]<span class="comment"># make install</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="éƒ¨ç½²å¯åŠ¨"><a href="#éƒ¨ç½²å¯åŠ¨" class="headerlink" title="éƒ¨ç½²å¯åŠ¨"></a>éƒ¨ç½²å¯åŠ¨</h3><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå°†Redisæ–‡ä»¶ä¸­çš„confé…ç½®æ–‡ä»¶å’Œå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°ç»Ÿä¸€æ–‡ä»¶ä¸­ã€‚</p>
<ul>
<li>åˆ›å»º<code>bin</code>å’Œ<code>etc</code>ç›®å½•ã€‚</li>
<li>å°†<code>redis.conf</code>æ–‡ä»¶ç§»åŠ¨åˆ°<code>etc</code>ç›®å½•ä¸‹ã€‚</li>
<li>è¿›å…¥<code>src</code>ç›®å½•å°†å…¶ä»–å¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°<code>bin</code>ç›®å½•ä¸‹ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mkdir etc</span><br><span class="line">mkdir bin</span><br><span class="line"></span><br><span class="line">mv redis.conf /usr/<span class="built_in">local</span>/redis/redis-6.2.1/etc/</span><br><span class="line"></span><br><span class="line">mv mkreleasehdr.sh redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-server /usr/<span class="built_in">local</span>/redis/redis-6.2.1/bin/</span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥çœ‹ç§»åŠ¨åçš„æ–‡ä»¶</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis-6.2.1]<span class="comment"># cd etc</span></span><br><span class="line">[root@horse etc]<span class="comment"># ll</span></span><br><span class="line">total 92</span><br><span class="line">-rw-rw-r-- 1 root root 92484 Apr 19 13:55 redis.conf</span><br><span class="line">[root@horse etc]<span class="comment"># cd ../bin</span></span><br><span class="line">[root@horse bin]<span class="comment"># ll</span></span><br><span class="line">total 37316</span><br><span class="line">-rw-r--r-- 1 root root     113 Apr 21 18:59 dump.rdb</span><br><span class="line">-rwxrwxr-x 1 root root     735 Mar  2 14:14 mkreleasehdr.sh</span><br><span class="line">-rwxr-xr-x 1 root root 4833448 Apr 19 09:40 redis-benchmark</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-check-aof</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-check-rdb</span><br><span class="line">-rwxr-xr-x 1 root root 5003464 Apr 19 09:40 redis-cli</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-server</span><br></pre></td></tr></tbody></table></figure>
<p>å¯åŠ¨redisæœåŠ¡</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨binç›®å½•ä¸‹ï¼Œæ‰§è¡Œredis-server,æŒ‡å®šredis.confé…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">./redis-server[root@horse bin]<span class="comment"># ./redis-server /usr/local/redis/redis-6.2.1/etc/redis.conf</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">32336:C 19 Apr 2021 14:18:01.846 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">32336:C 19 Apr 2021 14:18:01.847 <span class="comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=32336, just started</span></span><br><span class="line">32336:C 19 Apr 2021 14:18:01.847 <span class="comment"># Configuration loaded</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.847 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">''</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 6.2.1 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._                                   </span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 32336</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">'                                           </span></span><br><span class="line"><span class="string">              `-.__.-'</span>                                               </span><br><span class="line"></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 <span class="comment"># Server initialized</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 * Loading RDB produced by version 6.2.1</span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 * RDB age 170 seconds</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç¼–è¾‘é…ç½®"><a href="#ç¼–è¾‘é…ç½®" class="headerlink" title="ç¼–è¾‘é…ç½®"></a>ç¼–è¾‘é…ç½®</h3><blockquote>
<p>ç¼–è¾‘<code>redis.conf</code>é…ç½®æ–‡ä»¶</p>
</blockquote>
<ul>
<li>æ³¨é‡Šç»‘å®šIPï¼Œå…è®¸è¿œç¨‹è¿æ¥</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># bind 127.0.0.1</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å…è®¸åå°è¿è¡Œ</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°è®¾ç½®ä¸º yes [å…è®¸åå°æŒ‚è½½è¿è¡Œ]</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ä¿®æ”¹æ¨¡å¼</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º no [éå—ä¿æŠ¤æ¨¡å¼]</span></span><br><span class="line">protected-mode no</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># reids æ—¥å¿—è¾“å‡ºä½ç½®</span></span><br><span class="line">logfile <span class="string">"/usr/local/redis/redis-6.2.1/redis.log"</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è®¾ç½®æœ€å¤§å†…å­˜,å•ä½ï¼šå­—èŠ‚ã€å¦‚æœå†…å­˜è¶³å¤Ÿï¼Œé»˜è®¤å³å¯ã€‘</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®redisæœ€å¤§å ç”¨å†…å­˜ï¼š0.75G</span></span><br><span class="line">maxmemory 268435456</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è®¾ç½®å¯†ç </li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®rediså¯†ç </span></span><br><span class="line">requirepass ******</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ä¿®æ”¹ç«¯å£ï¼ˆéå¿…é¡»<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼‰</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç«¯å£</span></span><br><span class="line">port 6380</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä»–çš„é…ç½®ï¼Œé»˜è®¤å³å¯ã€‚</p>
<h3 id="é‡å¯Reids"><a href="#é‡å¯Reids" class="headerlink" title="é‡å¯Reids"></a>é‡å¯Reids</h3><blockquote>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li><p>å…ˆå…³é—­å½“å‰æ­£åœ¨è¿è¡Œçš„Redisï¼š<code>è¿›å…¥ redis-cli å®¢æˆ·ç«¯å¹¶æ‰§è¡Œ shutdown å‘½ä»¤</code></p>
</li>
<li><p>å› ä¸ºæ˜¯è‡ªå®šä¹‰å®‰è£…çš„åŸå› ï¼Œæ‰€ä»¥é‡ç½®RedisæœåŠ¡çš„æ—¶å€™éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶<code>redis.conf</code></p>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥redisåŸç”Ÿå®¢æˆ·ç«¯</span></span><br><span class="line">redis-cli -a ***** -h 121.5.168.32 -p 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­Redis(åŸç”Ÿæ–¹å¼)</span></span><br><span class="line">shutdown</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">[root@horse bin]<span class="comment"># redis-server /usr/local/redis/redis-6.2.1/etc/redis.conf </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redis-clié…ç½®"><a href="#Redis-clié…ç½®" class="headerlink" title="Redis-clié…ç½®"></a>Redis-clié…ç½®</h3><blockquote>
<p>å°†<code>redis-cli</code>è·¯å¾„æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå³å¯åœ¨ä»»æ„è·¯å¾„ä¸‹è‡ªè¡Œ<code>redis-cli -a å¯†ç  -p 6379 -h 121.5.168.32</code></p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>æ‰“å¼€<code>/etc/profile</code>æ–‡ä»¶ï¼Œç¼–è¾‘è·¯å¾„é…ç½®</li>
<li>åˆ·æ–°ç¯å¢ƒé…ç½®ï¼š<code>source /etc/profile</code></li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># mysqlç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> MYSQL_HOME=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># redisç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> REDIS_HOME=/usr/<span class="built_in">local</span>/redis/redis-6.2.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># jdkç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># JAVA_HOMEï¼šjdkè§£å‹çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=$:CLASSPATH:<span class="variable">$JAVA_HOME</span>/lib/</span><br><span class="line"><span class="comment"># ä¸åŒæœåŠ¡è·¯å¾„ä¹‹é—´ä½¿ç”¨â€œ:â€(è‹±æ–‡å†’å·)éš”å¼€</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$MYSQL_HOME</span>/bin:<span class="variable">$REDIS_HOME</span>/bin</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Rediså¯åŠ¨è„šæœ¬"><a href="#Rediså¯åŠ¨è„šæœ¬" class="headerlink" title="Rediså¯åŠ¨è„šæœ¬"></a>Rediså¯åŠ¨è„šæœ¬</h3><blockquote>
<p>é…ç½®redisè„šæœ¬ï¼Œåœ¨ä»»æ„è·¯å¾„ä¸‹å¯åŠ¨ã€åœæ­¢redisæœåŠ¡</p>
</blockquote>
<h4 id="è„šæœ¬ç¤ºä¾‹"><a href="#è„šæœ¬ç¤ºä¾‹" class="headerlink" title="è„šæœ¬ç¤ºä¾‹"></a>è„šæœ¬ç¤ºä¾‹</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬ä»£ç ç¤ºä¾‹</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒå®‰è£…Nacos 2.0.0</title>
    <url>/post/9821.html</url>
    <content><![CDATA[<h2 id="Linuxç¯å¢ƒå®‰è£…Nacos-2-0-0"><a href="#Linuxç¯å¢ƒå®‰è£…Nacos-2-0-0" class="headerlink" title="Linuxç¯å¢ƒå®‰è£…Nacos 2.0.0"></a>Linuxç¯å¢ƒå®‰è£…Nacos 2.0.0</h2><h3 id="1-è§£å‹å®‰è£…"><a href="#1-è§£å‹å®‰è£…" class="headerlink" title="1. è§£å‹å®‰è£…"></a>1. è§£å‹å®‰è£…</h3><blockquote>
<p>nacosèµ„æºå‹ç¼©åŒ…å®˜ç½‘ä¸‹è½½å³å¯ï¼Œåœ¨<code>/usr/local/</code>ç›®å½•ä¸‹åˆ›å»º<code>nacos</code>ç›®å½•ï¼Œå‹ç¼©åŒ…ä¸Šä¼ åˆ°æ­¤ç›®å½•ä¸‹ï¼Œè§£å‹é‡å‘½åä¸ºnacos</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse nacos]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nacos</span><br><span class="line">[root@horse nacos]<span class="comment"># tar -zxvf nacos-server-2.0.0.tar.gz -C /usr/local/nacos/</span></span><br><span class="line">[root@horse nacos]<span class="comment"># ll</span></span><br><span class="line">total 89868</span><br><span class="line">drwxr-xr-x 5 root root      4096 Apr 19 13:31 bin</span><br><span class="line">drwxr-xr-x 2  502 games     4096 Apr 20 12:13 conf</span><br><span class="line">drwxr-xr-x 8 root root      4096 Apr 20 09:23 data</span><br><span class="line">-rw-r--r-- 1  502 games    16583 Mar 18 11:36 LICENSE</span><br><span class="line">drwxr-xr-x 2 root root      4096 Apr 20 10:35 logs</span><br><span class="line">-rw-r--r-- 1 root root  91974414 Apr 19 09:15 nacos-server-2.0.0.tar.gz</span><br><span class="line">-rw-r--r-- 1  502 games     1305 May 14  2020 NOTICE</span><br><span class="line">drwxr-xr-x 2 root root      4096 Apr 19 10:45 target</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-åˆ›å»ºnacosæ•°æ®åº“"><a href="#2-åˆ›å»ºnacosæ•°æ®åº“" class="headerlink" title="2. åˆ›å»ºnacosæ•°æ®åº“"></a>2. åˆ›å»ºnacosæ•°æ®åº“</h3><blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œnacosçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è‡ªå·±æŒæ¡ï¼Œå‰ææ˜¯ï¼Œæˆ‘ä»¬æŒ‰ç…§nacosçš„è§„åˆ™åˆ›å»ºæ•°æ®åº“ï¼Œé…ç½®è¿æ¥å³å¯ã€‚</p>
<p>==å¦‚æœæƒ³è¦é»˜è®¤å¤„ç†ï¼Œç›´æ¥è¿›å…¥ç¬¬4æ­¥ï¼šå¯åŠ¨nacos å³å¯==</p>
</blockquote>
<h4 id="2-1-å¯¼å…¥sqlæ–‡ä»¶"><a href="#2-1-å¯¼å…¥sqlæ–‡ä»¶" class="headerlink" title="2.1 å¯¼å…¥sqlæ–‡ä»¶"></a>2.1 å¯¼å…¥sqlæ–‡ä»¶</h4><blockquote>
<p>æ‰¾åˆ°<code>/usr/local/nacos/conf/nacos-mysql.sql</code>sqlè„šæœ¬æ–‡ä»¶ï¼Œå¯¼å…¥æ‰§è¡Œå³å¯</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210420211103.png" alt="Snipaste_2021-04-20_21-10-18"></p>
<h3 id="3-é…ç½®nacos"><a href="#3-é…ç½®nacos" class="headerlink" title="3. é…ç½®nacos"></a>3. é…ç½®nacos</h3><blockquote>
<p>åˆ›å»ºnacosæ•°æ®åº“,é…ç½®æ•°æ®åº“è¿æ¥ï¼Œå’Œjavaçš„é…ç½®æ•°æ®æºä¸€æ¨¡ä¸€æ ·ï¼ï¼ï¼</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Copyright 1999-2018 Alibaba Group Holding Ltd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤è®¿é—®è·¯å¾„</span></span><br><span class="line">server.servlet.contextPath=/nacos</span><br><span class="line"><span class="comment">### é»˜è®¤ç«¯å£å·</span></span><br><span class="line">server.port=8848</span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Network Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If prefer hostname over ip for Nacos server addresses in cluster.conf:</span></span><br><span class="line"><span class="comment"># nacos.inetutils.prefer-hostname-over-ip=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Specify local server's IP:</span></span><br><span class="line"><span class="comment"># nacos.inetutils.ip-address=</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Config Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### æ•°æ®åº“ç±»å‹é…ç½®ä¸ºMysql</span></span><br><span class="line">spring.datasource.platform=mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">### å•æœºæ¨¡å¼ï¼šæ•°æ®åº“æ•°é‡ä¸º1</span></span><br><span class="line">db.num=1</span><br><span class="line"></span><br><span class="line"><span class="comment">### naocså’Œmysqlå¤„äºåŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›¸å¯¹nacos,æ•°æ®åº“æ‰€åœ¨çš„åœ°å€IPå°±æ˜¯ï¼šlocalhost,ä¸éœ€è¦å†å†™ä¸ºå…¬ç½‘IPï¼Œä»å¤–é¢ç»•ä¸€åœˆå†å›æ¥ï¼Œæµªè´¹èµ„æº</span></span><br><span class="line">db.url.0=jdbc:mysql://localhost:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=<span class="literal">true</span>&amp;useUnicode=<span class="literal">true</span>&amp;useSSL=<span class="literal">false</span>&amp;serverTimezone=UTC</span><br><span class="line"><span class="comment"># æ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line">db.user.0=***</span><br><span class="line"><span class="comment"># æ•°æ®åº“å¯†ç </span></span><br><span class="line">db.password.0=***</span><br><span class="line"></span><br><span class="line"><span class="comment">### Connection pool configuration: hikariCP</span></span><br><span class="line"><span class="comment"># è¿æ¥æ± é…ç½®é»˜è®¤å€¼å°±å¥½</span></span><br><span class="line">db.pool.config.connectionTimeout=30000</span><br><span class="line">db.pool.config.validationTimeout=10000</span><br><span class="line">db.pool.config.maximumPoolSize=20</span><br><span class="line">db.pool.config.minimumIdle=2</span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Naming Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### Data dispatch task execution period in milliseconds:</span></span><br><span class="line"><span class="comment"># nacos.naming.distro.taskDispatchPeriod=200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Data count of batch sync task:</span></span><br><span class="line"><span class="comment"># nacos.naming.distro.batchSyncKeyCount=1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Retry delay in milliseconds if sync task failed:</span></span><br><span class="line"><span class="comment"># nacos.naming.distro.syncRetryDelay=5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### If enable data warmup. If set to false, the server would accept request without local data preparation:</span></span><br><span class="line"><span class="comment"># nacos.naming.data.warmup=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### If enable the instance auto expiration, kind like of health check of instance:</span></span><br><span class="line"><span class="comment"># nacos.naming.expireInstance=true</span></span><br><span class="line"></span><br><span class="line">nacos.naming.empty-service.auto-clean=<span class="literal">true</span></span><br><span class="line">nacos.naming.empty-service.clean.initial-delay-ms=50000</span><br><span class="line">nacos.naming.empty-service.clean.period-time-ms=30000</span><br><span class="line"></span><br><span class="line"><span class="comment">### Add in 2.0.0</span></span><br><span class="line"><span class="comment">### The interval to clean empty service</span></span><br><span class="line"><span class="comment"># nacos.naming.clean.empty-service.interval=60000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The expired time to clean empty service</span></span><br><span class="line"><span class="comment"># nacos.naming.clean.empty-service.expired-time=60000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The interval to clean expired metadata</span></span><br><span class="line"><span class="comment"># nacos.naming.clean.expired-metadata.interval=5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The expired time to clean metadata</span></span><br><span class="line"><span class="comment"># nacos.naming.clean.expired-metadata.expired-time=60000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** CMDB Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### The interval to dump external CMDB in seconds:</span></span><br><span class="line"><span class="comment"># nacos.cmdb.dumpTaskInterval=3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The interval of polling data change event in seconds:</span></span><br><span class="line"><span class="comment"># nacos.cmdb.eventTaskInterval=10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The interval of loading labels in seconds:</span></span><br><span class="line"><span class="comment"># nacos.cmdb.labelTaskInterval=300</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### If turn on data loading task:</span></span><br><span class="line"><span class="comment"># nacos.cmdb.loadDataAtStart=false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Metrics Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### Metrics for prometheus</span></span><br><span class="line"><span class="comment">#management.endpoints.web.exposure.include=*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Metrics for elastic search</span></span><br><span class="line">management.metrics.export.elastic.enabled=<span class="literal">false</span></span><br><span class="line"><span class="comment">#management.metrics.export.elastic.host=http://localhost:9200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Metrics for influx</span></span><br><span class="line">management.metrics.export.influx.enabled=<span class="literal">false</span></span><br><span class="line"><span class="comment">#management.metrics.export.influx.db=springboot</span></span><br><span class="line"><span class="comment">#management.metrics.export.influx.uri=http://localhost:8086</span></span><br><span class="line"><span class="comment">#management.metrics.export.influx.auto-create-db=true</span></span><br><span class="line"><span class="comment">#management.metrics.export.influx.consistency=one</span></span><br><span class="line"><span class="comment">#management.metrics.export.influx.compressed=true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Access Log Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If turn on the access log:</span></span><br><span class="line"><span class="comment"># å…³é—­tomcatæ—¥å¿—æ‰“å°ã€å‡å°‘å¤§é‡æ—¥å¿—çš„è¾“å‡ºï¼Œå»ºè®®å…³é—­ã€‘</span></span><br><span class="line">server.tomcat.accesslog.enabled=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The access log pattern:</span></span><br><span class="line">server.tomcat.accesslog.pattern=%h %l %u %t <span class="string">"%r"</span> %s %b %D %{User-Agent}i %{Request-Source}i</span><br><span class="line"></span><br><span class="line"><span class="comment">### The directory of access log:</span></span><br><span class="line">server.tomcat.basedir=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Access Control Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If enable spring security, this option is deprecated in 1.2.0:</span></span><br><span class="line"><span class="comment">#spring.security.enabled=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The ignore urls of auth, is deprecated in 1.2.0:</span></span><br><span class="line">nacos.security.ignore.urls=/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-ui/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**</span><br><span class="line"></span><br><span class="line"><span class="comment">### The auth system to use, currently only 'nacos' is supported:</span></span><br><span class="line">nacos.core.auth.system.type=nacos</span><br><span class="line"></span><br><span class="line"><span class="comment">### If turn on auth system</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®nacosæˆæƒ</span></span><br><span class="line">nacos.core.auth.enabled=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The token expiration in seconds:</span></span><br><span class="line">nacos.core.auth.default.token.expire.seconds=18000</span><br><span class="line"></span><br><span class="line"><span class="comment">### The default token:</span></span><br><span class="line">nacos.core.auth.default.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789</span><br><span class="line"></span><br><span class="line"><span class="comment">### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.</span></span><br><span class="line">nacos.core.auth.caching.enabled=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Since 1.4.1, Turn on/off white auth for user-agent: nacos-server, only for upgrade from old version.</span></span><br><span class="line">nacos.core.auth.enable.userAgentAuthWhite=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Since 1.4.1, worked when nacos.core.auth.enabled=true and nacos.core.auth.enable.userAgentAuthWhite=false.</span></span><br><span class="line"><span class="comment">### The two properties is the white list for auth and used by identity the request from other server.</span></span><br><span class="line">nacos.core.auth.server.identity.key=</span><br><span class="line">nacos.core.auth.server.identity.value=</span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Istio Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If turn on the MCP server:</span></span><br><span class="line">nacos.istio.mcp.server.enabled=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###*************** Add from 1.3.0 ***************###</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** Core Related Configurations ***************#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### set the WorkerID manually</span></span><br><span class="line"><span class="comment"># nacos.core.snowflake.worker-id=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Member-MetaData</span></span><br><span class="line"><span class="comment"># nacos.core.member.meta.site=</span></span><br><span class="line"><span class="comment"># nacos.core.member.meta.adweight=</span></span><br><span class="line"><span class="comment"># nacos.core.member.meta.weight=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### MemberLookup</span></span><br><span class="line"><span class="comment">### Addressing pattern category, If set, the priority is highest</span></span><br><span class="line"><span class="comment"># nacos.core.member.lookup.type=[file,address-server]</span></span><br><span class="line"><span class="comment">## Set the cluster list with a configuration file or command-line argument</span></span><br><span class="line"><span class="comment"># nacos.member.list=192.168.16.101:8847?raft_port=8807,192.168.16.101?raft_port=8808,192.168.16.101:8849?raft_port=8809</span></span><br><span class="line"><span class="comment">## for AddressServerMemberLookup</span></span><br><span class="line"><span class="comment"># Maximum number of retries to query the address server upon initialization</span></span><br><span class="line"><span class="comment"># nacos.core.address-server.retry=5</span></span><br><span class="line"><span class="comment">## Server domain name address of [address-server] mode</span></span><br><span class="line"><span class="comment"># address.server.domain=jmenv.tbsite.net</span></span><br><span class="line"><span class="comment">## Server port of [address-server] mode</span></span><br><span class="line"><span class="comment"># address.server.port=8080</span></span><br><span class="line"><span class="comment">## Request address of [address-server] mode</span></span><br><span class="line"><span class="comment"># address.server.url=/nacos/serverlist</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************** JRaft Related Configurations ***************#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Sets the Raft cluster election timeout, default value is 5 second</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.election_timeout_ms=5000</span></span><br><span class="line"><span class="comment">### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.snapshot_interval_secs=30</span></span><br><span class="line"><span class="comment">### raft internal worker threads</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.core_thread_num=8</span></span><br><span class="line"><span class="comment">### Number of threads required for raft business request processing</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.cli_service_thread_num=4</span></span><br><span class="line"><span class="comment">### raft linear read strategy. Safe linear reads are used by default, that is, the Leader tenure is confirmed by heartbeat</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.read_index_type=ReadOnlySafe</span></span><br><span class="line"><span class="comment">### rpc request timeout, default 5 seconds</span></span><br><span class="line"><span class="comment"># nacos.core.protocol.raft.data.rpc_request_timeout_ms=5000</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-å¯åŠ¨nacos"><a href="#4-å¯åŠ¨nacos" class="headerlink" title="4. å¯åŠ¨nacos"></a>4. å¯åŠ¨nacos</h3><blockquote>
<p>åœ¨<code>/usr/local/nacos/bin/</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>å•æœºæ¨¡å¼</code>å¯åŠ¨å‘½ä»¤</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse conf]<span class="comment"># cd ../bin</span></span><br><span class="line">[root@horse bin]<span class="comment"># ll</span></span><br><span class="line">total 36</span><br><span class="line">-rw-r--r-- 1 root root   717 Apr 19 10:49 derby.log</span><br><span class="line">drwxr-xr-x 2 root root  4096 Apr 19 13:31 logPath_IS_UNDEFINED</span><br><span class="line">drwxr-xr-x 2 root root  4096 Apr 19 10:49 logs</span><br><span class="line">-rwxr-xr-x 1  502 games  954 May 14  2020 shutdown.cmd</span><br><span class="line">-rwxr-xr-x 1  502 games  951 Mar 18 11:36 shutdown.sh</span><br><span class="line">-rwxr-xr-x 1  502 games 3340 Mar 18 11:36 startup.cmd</span><br><span class="line">-rwxr-xr-x 1  502 games 4923 Mar 18 11:36 startup.sh</span><br><span class="line">drwxr-xr-x 3 root root  4096 Apr 19 10:49 work</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å•æœºå¯åŠ¨</span></span><br><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></tbody></table></figure>
<p>å¯ä»¥åœ¨<code>/usr/local/nacos/logs/start.out</code>å¯åŠ¨æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse logs]<span class="comment"># tail -f start.out </span></span><br><span class="line">2021-04-20 09:04:44,653 INFO Exposing 16 endpoint(s) beneath base path <span class="string">'/actuator'</span></span><br><span class="line"></span><br><span class="line">2021-04-20 09:04:44,975 INFO Tomcat started on port(s): 8848 (http) with context path <span class="string">'/nacos'</span></span><br><span class="line"></span><br><span class="line">2021-04-20 09:04:44,986 INFO Nacos started successfully <span class="keyword">in</span> stand alone mode. use external storage</span><br><span class="line"></span><br><span class="line">2021-04-20 09:05:37,640 INFO Initializing Servlet <span class="string">'dispatcherServlet'</span></span><br><span class="line"></span><br><span class="line">2021-04-20 09:05:37,666 INFO Completed initialization <span class="keyword">in</span> 26 ms</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-è®¿é—®nacos"><a href="#5-è®¿é—®nacos" class="headerlink" title="5. è®¿é—®nacos"></a>5. è®¿é—®nacos</h3><blockquote>
<p>è®¿é—®<code>http://121.5.168.31:8848/nacos</code>åœ°å€ï¼Œè¾“å…¥é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼šnacos è¿›å…¥é…ç½®æ³¨å†Œä¸­å¿ƒã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210420212034.png" alt="Snipaste_2021-04-20_21-20-09"></p>
<p>==nacosé…ç½®ä¸­å¿ƒçš„å…·ä½“çº¦å®šè§„åˆ™ï¼Œè§åé¢çš„æ–‡ç« ==</p>
<p>åˆ°æ­¤ç»“æŸï¼</p>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Nacos</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå®‰è£…Tomcat 9.0.34</title>
    <url>/post/52210.html</url>
    <content><![CDATA[<h2 id="Linuxå®‰è£…Tomcat-9-0-34"><a href="#Linuxå®‰è£…Tomcat-9-0-34" class="headerlink" title="Linuxå®‰è£…Tomcat 9.0.34"></a>Linuxå®‰è£…Tomcat 9.0.34</h2><blockquote>
<p><strong>å®‰è£…é¡»çŸ¥ï¼š</strong>å®‰è£…Tomcatä¹‹å‰ï¼Œç³»ç»Ÿä¸­å¿…é¡»å·²ç»å®ŒæˆJDKçš„å®‰è£… ï¼Œè¯·çœ‹å…¶ä»–æ–‡ç« ï¼š <a href="http://www.horsemuzi.top/Linux/Linux%E5%AE%89%E8%A3%85Jdk/">Linuxå®‰è£…Jdk1.8</a> </p>
</blockquote>
<h3 id="ä¸‹è½½å‹ç¼©åŒ…"><a href="#ä¸‹è½½å‹ç¼©åŒ…" class="headerlink" title="ä¸‹è½½å‹ç¼©åŒ…"></a>ä¸‹è½½å‹ç¼©åŒ…</h3><blockquote>
<p>è®¿é—®Tomcatå®˜ç½‘ä¸‹è½½Tomcatå‹ç¼©åŒ…</p>
<ul>
<li><a href="https://tomcat.apache.org/download-90.cgi">Tomcatå®˜ç½‘</a></li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210706204904.png" alt="Tomcatä¸‹è½½"></p>
<h3 id="è§£å‹å®‰è£…"><a href="#è§£å‹å®‰è£…" class="headerlink" title="è§£å‹å®‰è£…"></a>è§£å‹å®‰è£…</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸ºtomcat</span></span><br><span class="line">tar -zxvf apache-tomcat-9.0.34.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å‘½å</span></span><br><span class="line">mv apache-tomcat-9.0.34 tomcat</span><br></pre></td></tr></tbody></table></figure>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><blockquote>
<p>ä¿®æ”¹ç«¯å£ï¼šè¿›å…¥<code>tomcat/conf</code>ç›®å½•ä¸‹ï¼Œç¼–è¾‘<code>server.xml</code>æ–‡ä»¶ï¼Œä¿®æ”¹å¯¹åº”ç«¯å£å·ã€‚</p>
<ul>
<li>å¦‚æœéœ€è¦å¯åŠ¨å¤šä¸ªtomcatæœåŠ¡ï¼Œå¤åˆ¶å¤šä»½é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸åŒç«¯å£å·è¿›è¡Œå¯åŠ¨å³å¯ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/tomcat/conf/server.xml</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210706205528.png" alt="Tomcatç«¯å£å·"></p>
<h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><blockquote>
<p>è¿›å…¥<code>tomcat/bin</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>./startup.sh</code>è„šæœ¬æ–‡ä»¶å³å¯ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">./startup.sh </span><br></pre></td></tr></tbody></table></figure>
<h3 id="è®¿é—®æµ‹è¯•"><a href="#è®¿é—®æµ‹è¯•" class="headerlink" title="è®¿é—®æµ‹è¯•"></a>è®¿é—®æµ‹è¯•</h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210706205938.png" alt="TomcatæœåŠ¡è®¿é—®"></p>
<blockquote>
<p>è¿è¡ŒwaråŒ…ï¼šå°†æ‰“å¥½çš„warç›´æ¥æ”¾å…¥webappsç›®å½•ä¸‹ï¼Œtomcatå¯åŠ¨ä¼šè‡ªåŠ¨è¿›è¡Œè§£å‹ï¼Œæµè§ˆå™¨ç›´æ¥è®¿é—®å³å¯ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨éš¾è®°å‘½ä»¤</title>
    <url>/post/60577.html</url>
    <content><![CDATA[<h2 id="Linuxå¸¸ç”¨éš¾è®°å‘½ä»¤"><a href="#Linuxå¸¸ç”¨éš¾è®°å‘½ä»¤" class="headerlink" title="Linuxå¸¸ç”¨éš¾è®°å‘½ä»¤"></a>Linuxå¸¸ç”¨éš¾è®°å‘½ä»¤</h2><ul>
<li><code>æŸ¥çœ‹æ¶ˆè€—å†…å­˜æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹</code></li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">ps auxw|head -1;ps auxw|sort -rn -k4|head -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ˜¾ç¤º</span></span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root      3327  0.5 38.5 3048056 726160 ?      Sl   14:24   2:13 /usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291/bin/java -Xms512m -Xmx512m -Xmn256m -Dnacos.standalone=<span class="literal">true</span> -Dnacos.member.list= -Djava.ext.dirs=/usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291/jre/lib/ext:/usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291/lib/ext -Xloggc:/usr/<span class="built_in">local</span>/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -Dloader.path=/usr/<span class="built_in">local</span>/nacos/plugins/health,/usr/<span class="built_in">local</span>/nacos/plugins/cmdb -Dnacos.home=/usr/<span class="built_in">local</span>/nacos -jar /usr/<span class="built_in">local</span>/nacos/target/nacos-server.jar --spring.config.additional-location=file:/usr/<span class="built_in">local</span>/nacos/conf/ --logging.config=/usr/<span class="built_in">local</span>/nacos/conf/nacos-logback.xml --server.max-http-header-size=524288 nacos.nacos</span><br><span class="line">mysql    14876  0.0 17.9 1182900 337868 ?      Sl   May25   4:03 /usr/<span class="built_in">local</span>/mysql/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --user=mysql --log-error=/usr/<span class="built_in">local</span>/mysql/data/mysql.err --pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysql.pid --socket=/tmp/mysql.sock --port=3306</span><br><span class="line">polkitd  23741  0.1  5.4 1757392 103336 ?      Sl   May25  19:07 /usr/<span class="built_in">local</span>/lib/erlang/erts-11.2.1/bin/beam.smp -W w -MBas ageffcbf -MHas ageffcbf -MBlmbcs 512 -MHlmbcs 512 -MMmcs 30 -P 1048576 -t 5000000 -stbt db -zdbbl 128000 -sbwt none -sbwtdcpu none -sbwtdio none -B i -- -root /usr/<span class="built_in">local</span>/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa  -noshell -noinput -s rabbit boot -boot start_sasl -lager crash_log <span class="literal">false</span> -lager handlers []</span><br><span class="line">mongod   28963  0.1  4.4 525104 82960 ?        S&lt;l  May25  21:57 /usr/bin/mongod -f /etc/mongod.conf</span><br><span class="line">root     23084  0.0  2.3 661128 43656 ?        Ssl  May25   1:05 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">root     23075  0.0  1.1 429400 21820 ?        Ssl  May25   4:44 /usr/bin/containerd</span><br><span class="line">root      1061  0.0  0.7 574288 13504 ?        Ssl  May25   0:48 /usr/bin/python2 -Es /usr/sbin/tuned -l -P</span><br><span class="line">root       366  0.0  0.5  72140 10456 ?        Ss   May25   0:30 /usr/lib/systemd/systemd-journald</span><br><span class="line">root      1063  0.0  0.5  61488 10124 ?        S&lt;Ls May25   0:00 /sbin/iscsid -f</span><br><span class="line">polkitd    507  0.0  0.3 614416  7296 ?        Ssl  May25   0:01 /usr/lib/polkit-1/polkitd --no-debug</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>æŸ¥çœ‹å½“å‰å¤„äºç›‘å¬çŠ¶æ€çš„TCPç«¯å£è¯¦ç»†ä¿¡æ¯</code></li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">netstat -nltp</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ˜¾ç¤º</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1489/sshd           </span><br><span class="line">tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      23406/docker-proxy  </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1386/master         </span><br><span class="line">tcp        0      0 0.0.0.0:5672            0.0.0.0:*               LISTEN      23422/docker-proxy  </span><br><span class="line">tcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN      28963/mongod        </span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      14876/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      21602/./redis-serve </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1489/sshd           </span><br><span class="line">tcp6       0      0 :::9848                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 :::15672                :::*                    LISTEN      23410/docker-proxy  </span><br><span class="line">tcp6       0      0 :::9849                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1386/master         </span><br><span class="line">tcp6       0      0 :::7848                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 :::5672                 :::*                    LISTEN      23426/docker-proxy  </span><br><span class="line">tcp6       0      0 :::6379                 :::*                    LISTEN      21602/./redis-serve </span><br><span class="line">tcp6       0      0 :::8848                 :::*                    LISTEN      3327/java  </span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>æ ¹æ®PIDæŸ¥è¯¢å¯¹åº”è¿›ç¨‹æ‰€åœ¨ç›®å½•</code></li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">ll /proc/PIDå·/exe</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ˜¾ç¤º</span></span><br><span class="line">[root@horse /]<span class="comment"># ll /proc/3327/exe</span></span><br><span class="line">lrwxrwxrwx 1 root root 0 Jun  3 21:52 /proc/3327/exe -&gt; /usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291/bin/java</span><br><span class="line">[root@horse /]<span class="comment"># ll /proc/14876/exe</span></span><br><span class="line">lrwxrwxrwx 1 root root 0 Jun  3 21:53 /proc/14876/exe -&gt; /usr/<span class="built_in">local</span>/mysql/bin/mysqld</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>æ ¹æ®è¿›ç¨‹åç§°æŸ¥çœ‹è¿›ç¨‹å¯åŠ¨æ—¶é—´</code></li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># netstat -nltp</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1489/sshd           </span><br><span class="line">tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      23406/docker-proxy  </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1386/master         </span><br><span class="line">tcp        0      0 0.0.0.0:5672            0.0.0.0:*               LISTEN      23422/docker-proxy  </span><br><span class="line">tcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN      28963/mongod        </span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      14876/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      21602/./redis-serve </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1489/sshd           </span><br><span class="line">tcp6       0      0 :::9848                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 :::15672                :::*                    LISTEN      23410/docker-proxy  </span><br><span class="line">tcp6       0      0 :::9849                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1386/master         </span><br><span class="line">tcp6       0      0 :::7848                 :::*                    LISTEN      3327/java           </span><br><span class="line">tcp6       0      0 :::5672                 :::*                    LISTEN      23426/docker-proxy  </span><br><span class="line">tcp6       0      0 :::6379                 :::*                    LISTEN      21602/./redis-serve </span><br><span class="line">tcp6       0      0 :::8848                 :::*                    LISTEN      3327/java           </span><br><span class="line">[root@horse ~]<span class="comment"># ps axo pid,ppid,comm,pmem,lstart | grep mysqld</span></span><br><span class="line">14661     1 mysqld_safe      0.0 Tue May 25 15:53:26 2021</span><br><span class="line">14876 14661 mysqld          19.0 Tue May 25 15:53:26 2021</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>å¯åŠ¨java -jaråå°è¿è¡Œç¨‹åº</code></li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€</span></span><br><span class="line">java -jar xxx.jar &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒ</span></span><br><span class="line">nohup java -jar xxx.jar &amp;</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨åŸºç¡€å‘½ä»¤</title>
    <url>/post/22224.html</url>
    <content><![CDATA[<h2 id="æ£€ç´¢æŸ¥è¯¢å‘½ä»¤"><a href="#æ£€ç´¢æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="æ£€ç´¢æŸ¥è¯¢å‘½ä»¤"></a>æ£€ç´¢æŸ¥è¯¢å‘½ä»¤</h2><h3 id="vi-vimæ£€ç´¢"><a href="#vi-vimæ£€ç´¢" class="headerlink" title="vi/vimæ£€ç´¢"></a>vi/vimæ£€ç´¢</h3><blockquote>
<p>åº”ç”¨åœºæ™¯: æ—¥å¿—æŸ¥è¯¢,ç²¾å‡†åŒ¹é…</p>
</blockquote>
<ul>
<li>ä½¿ç”¨ / æœç´¢</li>
</ul>
<blockquote>
<p>å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œè¾“å…¥/å…³é”®å­— å¼€å§‹è‡ªä¸Šå‘ä¸‹æœç´¢ã€‚nè·³åˆ°ä¸‹ä¸€ä¸ªï¼ŒNè·³åˆ°ä¸Šä¸€ä¸ªã€‚3nè·³åˆ°å‘ä¸‹ç¬¬ä¸‰ä¸ª</p>
<pre><code>    &gt; \c  è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™  ä¾‹å¦‚: /error\c
    &gt; \C  è¡¨ç¤ºåŒºåˆ†å¤§å°å†™    ä¾‹å¦‚: /error\C
</code></pre></blockquote>
<ul>
<li>ä½¿ç”¨ ? æœç´¢</li>
</ul>
<blockquote>
<p>å’Œ / ç±»ä¼¼ï¼Œä½†æ˜¯æ–¹å‘ç›¸å</p>
<pre><code>    &gt; \c  è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ 
    &gt; \C  è¡¨ç¤ºåŒºåˆ†å¤§å°å†™
</code></pre></blockquote>
<ul>
<li>å¯ä»¥å…ˆè®¾ç½®æœç´¢è§„åˆ™,å†ä½¿ç”¨ä¸Šé¢çš„ç¬¦å·è¿›è¡Œæœç´¢è¿›è¡Œæœç´¢</li>
</ul>
<blockquote>
<ul>
<li><p>æ˜¯å¦åŒºåˆ†å¤§å°å†™</p>
<ul>
<li>ä¸åŒºåˆ†å¤§å°å†™ï¼š<code>:set ignorecase</code></li>
<li>åŒºåˆ†å¤§å°å†™ï¼š<code>:set noignorecase</code></li>
</ul>
</li>
<li><p>æ˜¯å¦å®æ—¶æœç´¢</p>
<ul>
<li>å¼€å¯å®æ—¶æœç´¢ï¼š<code>:set incsearch</code></li>
<li>å¼€å¯åªèƒ½æœç´¢ï¼š<code>:set smartcase</code></li>
</ul>
</li>
<li><p>æ˜¯å¦æ˜¾ç¤ºè¡Œå·</p>
<ul>
<li>æ˜¾ç¤ºè¡Œå·ï¼š<code>:set number</code> æˆ–è€… <code>:set nu</code></li>
<li>å–æ¶ˆæ˜¾ç¤ºï¼š<code>:set nonumber</code> æˆ–è€… <code>:set nonu</code></li>
</ul>
</li>
<li><p>æ˜¯å¦é«˜äº®æ˜¾ç¤º</p>
<ul>
<li>æ°¸ä¹…å»é™¤æœç´¢é«˜äº®æ˜¾ç¤ºï¼š<code>:set nohls</code></li>
<li>æ¢å¤æœç´¢é«˜äº®ï¼š<code>:set hls</code></li>
<li>æš‚æ—¶å–æ¶ˆé«˜äº®ï¼ˆä¸‹æ¬¡æœç´¢æ—¶å†æ¬¡æ˜¾ç¤ºï¼‰ï¼š<code>:noh</code></li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="vimå¸¸ç”¨å†…ç½®å‘½ä»¤"><a href="#vimå¸¸ç”¨å†…ç½®å‘½ä»¤" class="headerlink" title="vimå¸¸ç”¨å†…ç½®å‘½ä»¤"></a>vimå¸¸ç”¨å†…ç½®å‘½ä»¤</h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210709162320.png" alt="vimå¸¸ç”¨å†…ç½®å‘½ä»¤"></p>
<h3 id="grepå‘½ä»¤"><a href="#grepå‘½ä»¤" class="headerlink" title="grepå‘½ä»¤"></a>grepå‘½ä»¤</h3><ul>
<li>grepç®€å•åŒ¹é…æœç´¢</li>
</ul>
<blockquote>
<p>grep -n â€˜errorâ€™ todo.txt  [æœç´¢todo.txtæ–‡ä»¶ä¸­åŒ¹é…â€™errorâ€™çš„æ‰€åœ¨è¡Œå’Œè¡Œå·]</p>
<p>grep â€“e â€œæ­£åˆ™è¡¨è¾¾å¼â€ æ–‡ä»¶å  [ä»æ–‡ä»¶å†…å®¹æŸ¥æ‰¾ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„è¡Œï¼š]</p>
<p>grep â€“i â€œè¢«æŸ¥æ‰¾çš„å­—ç¬¦ä¸²â€ æ–‡ä»¶å [æŸ¥æ‰¾æ—¶ä¸åŒºåˆ†å¤§å°å†™ï¼š]</p>
<p>grep -c â€œè¢«æŸ¥æ‰¾çš„å­—ç¬¦ä¸²â€ æ–‡ä»¶å [æŸ¥æ‰¾åŒ¹é…çš„è¡Œæ•°ï¼š]</p>
<p>grep -n â€˜errorâ€™ *.log [åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰æ‰©å±•åä¸º .log çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶æ‰¾å‡ºåŒ…å« â€œerrorâ€ çš„è¡Œ]</p>
<p><strong>ls | grep â€˜^appâ€™ è¿‡æ»¤æ–‡ä»¶ä¸­ä»¥ app å¼€å¤´çš„æ–‡ä»¶[æŸ¥è¯¢å¾ˆå¿«]</strong></p>
</blockquote>
<ul>
<li>grepå‘½ä»¤çš„  <code>ä¸</code> æˆ–è€… <code>æˆ–</code> æ“ä½œ</li>
</ul>
<blockquote>
<p>grep  -E â€˜word1|word2|word3â€™ filename  [ æŸ¥è¯¢ filename æ–‡ä»¶ä¸­ åŒ…å« Word1ï¼Œword2ï¼Œword3 ä¸­ä»»æ„ä¸€ä¸ªå…³é”®è¯çš„è¡Œ ]</p>
<p>ç®€ä¾¿å†™æ³•ï¼š</p>
<ul>
<li>egrep â€˜word1|word2|word3â€™ filename </li>
<li>awk â€˜/word1|word2|word3/â€˜ filename</li>
</ul>
<hr>
<p>grep â€˜word1â€™  filename | grep â€˜word2â€™  | grep â€˜word3â€™   [ æŸ¥è¯¢ filename æ–‡ä»¶ä¸­ åŒæ—¶åŒ…å« word1ï¼Œword2ï¼Œword3 å…³é”®è¯çš„è¡Œï¼Œï¼ˆä¹Ÿå°±æ˜¯å¤šçº§ç®¡é“ç¬¦è¿‡æ»¤æ“ä½œè€Œå·²ï¼ï¼‰]</p>
</blockquote>
<h3 id="findå‘½ä»¤"><a href="#findå‘½ä»¤" class="headerlink" title="findå‘½ä»¤"></a>findå‘½ä»¤</h3><ul>
<li>å¸¸ç”¨åŒ¹é…æœç´¢</li>
</ul>
<blockquote>
<p>find /home -name *.jar [åœ¨/homeç›®å½•ä¸‹æ ¹æ®æ–‡ä»¶åè¿›è¡ŒåŒ¹é…æŸ¥è¯¢]</p>
<p>find /home -iname horse-vue-blog.jar [åœ¨/homeç›®å½•ä¸‹æ ¹æ®æ–‡ä»¶åè¿›è¡ŒåŒ¹é…æŸ¥è¯¢(å¿½ç•¥å¤§å°å†™)]</p>
<p>find . -ctime -20 [æŸ¥è¯¢å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰æœ€è¿‘20å¤©å†…æ›´æ–°è¿‡çš„æ–‡ä»¶]</p>
</blockquote>
<h3 id="cat-more-head-tailç­‰å‘½ä»¤"><a href="#cat-more-head-tailç­‰å‘½ä»¤" class="headerlink" title="cat,more,head,tailç­‰å‘½ä»¤"></a>cat,more,head,tailç­‰å‘½ä»¤</h3><ul>
<li>å¸¸ç”¨æ“ä½œ</li>
</ul>
<blockquote>
<p>cat -nbs todo.txt [æŸ¥çœ‹æ–‡ä»¶]</p>
<p>more -s todo.txt [é€é¡µé˜…è¯»ï¼Œè€Œæœ€åŸºæœ¬çš„æŒ‡ä»¤å°±æ˜¯æŒ‰ç©ºç™½é”®ï¼ˆspaceï¼‰å°±å¾€ä¸‹ä¸€é¡µæ˜¾ç¤ºï¼ŒæŒ‰ b é”®å°±ä¼šå¾€å›ï¼ˆbackï¼‰ä¸€é¡µæ˜¾ç¤º]      </p>
<p>head -n 20 todo.txt [æŸ¥çœ‹æ–‡ä»¶çš„å¼€å¤´20è¡Œéƒ¨åˆ†å†…å®¹,é»˜è®¤ä¸ºæŸ¥çœ‹å¼€å¤´10è¡Œ]</p>
<hr>
<p>tail -f todo.log [å¾ªç¯è¯»å–todo.logæ–‡ä»¶çš„å†…å®¹]</p>
<p>tail -n 20 todo.log [æŸ¥çœ‹todo.logæ–‡ä»¶æœ«å°¾20è¡Œå†…å®¹]</p>
<p>tail -f -n 200 todo.log | perl -pe â€˜s/(å…³é”®è¯)/\e[1;31m$1\e[0m/gâ€™    [é«˜äº®å…³é”®è¯]</p>
</blockquote>
<h3 id="lesså‘½ä»¤"><a href="#lesså‘½ä»¤" class="headerlink" title="lesså‘½ä»¤"></a>lesså‘½ä»¤</h3><blockquote>
<p>å‘½ä»¤ç®€ä»‹ï¼šLinuxä¸­æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„å¼ºå¤§å·¥å…·</p>
<p>å‘½ä»¤åŠŸèƒ½ï¼šless ä¸ more ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ less å¯ä»¥éšæ„æµè§ˆæ–‡ä»¶ï¼Œè€Œ more ä»…èƒ½å‘å‰ç§»åŠ¨ï¼Œå´ä¸èƒ½å‘åç§»åŠ¨ï¼Œè€Œä¸” less åœ¨æŸ¥çœ‹ä¹‹å‰ä¸ä¼šåŠ è½½æ•´ä¸ªæ–‡ä»¶</p>
<p>å‘½ä»¤å‚æ•°ï¼š</p>
<ul>
<li>-b &lt;ç¼“å†²åŒºå¤§å°&gt; è®¾ç½®ç¼“å†²åŒºçš„å¤§å°</li>
<li>-e å½“æ–‡ä»¶æ˜¾ç¤ºç»“æŸåï¼Œè‡ªåŠ¨ç¦»å¼€</li>
<li><p>-f å¼ºè¿«æ‰“å¼€ç‰¹æ®Šæ–‡ä»¶ï¼Œä¾‹å¦‚å¤–å›´è®¾å¤‡ä»£å·ã€ç›®å½•å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</p>
</li>
<li><p>-g åªæ ‡å¿—æœ€åæœç´¢çš„å…³é”®è¯</p>
</li>
<li><p>-i å¿½ç•¥æœç´¢æ—¶çš„å¤§å°å†™</p>
</li>
<li><p>-m æ˜¾ç¤ºç±»ä¼¼moreå‘½ä»¤çš„ç™¾åˆ†æ¯”</p>
</li>
<li><p>-N æ˜¾ç¤ºæ¯è¡Œçš„è¡Œå·</p>
</li>
<li><p>-o &lt;æ–‡ä»¶å&gt; å°†less è¾“å‡ºçš„å†…å®¹åœ¨æŒ‡å®šæ–‡ä»¶ä¸­ä¿å­˜èµ·æ¥</p>
</li>
<li><p>-Q ä¸ä½¿ç”¨è­¦å‘ŠéŸ³</p>
</li>
<li><p>-s æ˜¾ç¤ºè¿ç»­ç©ºè¡Œä¸ºä¸€è¡Œ</p>
</li>
<li><p>-S è¡Œè¿‡é•¿æ—¶é—´å°†è¶…å‡ºéƒ¨åˆ†èˆå¼ƒ</p>
</li>
</ul>
<p>å¯¼èˆªå‚æ•°ï¼š</p>
<ul>
<li><p>G - ç§»åŠ¨åˆ°æœ€åä¸€è¡Œï¼ˆshift + gï¼‰</p>
</li>
<li><p>g - ç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œ</p>
</li>
<li><p>q / ZZ - é€€å‡º less å‘½ä»¤</p>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºè¡Œå·å’Œç™¾åˆ†æ¯”çš„æŸ¥çœ‹æ–‡ä»¶</span></span><br><span class="line">less -mNs tps-control.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†é¡µæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">ps -ef | less -mN</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†é¡µæŸ¥çœ‹å†å²å‘½ä»¤</span></span><br><span class="line"><span class="built_in">history</span> | less -mN</span><br></pre></td></tr></tbody></table></figure>
<h3 id="whereiså‘½ä»¤"><a href="#whereiså‘½ä»¤" class="headerlink" title="whereiså‘½ä»¤"></a>whereiså‘½ä»¤</h3><blockquote>
<p>å‘½ä»¤ç®€ä»‹ï¼šå’Œfindç›¸æ¯”ï¼ŒwhereisæŸ¥æ‰¾çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè¿™æ˜¯å› ä¸ºlinuxç³»ç»Ÿä¼šå°† ç³»ç»Ÿå†…çš„æ‰€æœ‰æ–‡ä»¶éƒ½è®°å½•åœ¨ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå½“ä½¿ç”¨whereiså’Œä¸‹é¢å³å°†ä»‹ç»çš„locateæ—¶ï¼Œä¼šä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œè€Œä¸æ˜¯åƒfindå‘½ä»¤é‚£æ ·ï¼Œé€šè¿‡éå†ç¡¬ç›˜æ¥æŸ¥æ‰¾ï¼Œæ•ˆç‡è‡ªç„¶ä¼šå¾ˆé«˜ã€‚</p>
<p>ä½†æ˜¯è¯¥æ•°æ®åº“æ–‡ä»¶å¹¶ä¸æ˜¯å®æ—¶æ›´æ–°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ—¶ä¸€æ˜ŸæœŸæ›´æ–°ä¸€æ¬¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç”¨whereiså’Œlocate æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œæœ‰æ—¶ä¼šæ‰¾åˆ°å·²ç»è¢«åˆ é™¤çš„æ•°æ®ï¼Œæˆ–è€…åˆšåˆšå»ºç«‹æ–‡ä»¶ï¼Œå´æ— æ³•æŸ¥æ‰¾åˆ°ï¼ŒåŸå› å°±æ˜¯å› ä¸ºæ•°æ®åº“æ–‡ä»¶æ²¡æœ‰è¢«æ›´æ–°ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis]<span class="comment"># whereis mysql</span></span><br><span class="line">mysql: /usr/lib64/mysql /usr/<span class="built_in">local</span>/mysql /usr/share/mysql /usr/<span class="built_in">local</span>/mysql/bin/mysql</span><br><span class="line">[root@horse redis]<span class="comment"># whereis redis</span></span><br><span class="line">redis: /usr/<span class="built_in">local</span>/redis</span><br></pre></td></tr></tbody></table></figure>
<h3 id="tarå‘½ä»¤"><a href="#tarå‘½ä»¤" class="headerlink" title="tarå‘½ä»¤"></a>tarå‘½ä»¤</h3><blockquote>
<p>å¸¸ç”¨è§£å‹ç¼©å‘½ä»¤</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#æ‰“åŒ…  tar -cvf åŒ…å  æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$tar</span> -cvf test.tar test.txt </span><br><span class="line"><span class="comment">#è§£åŒ…  tar -xvf åŒ…å </span></span><br><span class="line"><span class="variable">$tar</span> -xvf test.tar</span><br><span class="line"><span class="comment">#å‹ç¼©  tar -czvf åŒ…å æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$tar</span> -czvf test.tgr.gz test.txt</span><br><span class="line"><span class="comment">#è§£å‹  tar -xzvf åŒ…å -C è§£å‹åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line"><span class="variable">$tar</span> -xzvf test.tgr.gz -C /usr/<span class="built_in">local</span>/naocs/</span><br></pre></td></tr></tbody></table></figure>
<h3 id="duå‘½ä»¤"><a href="#duå‘½ä»¤" class="headerlink" title="duå‘½ä»¤"></a>duå‘½ä»¤</h3><blockquote>
<p>æŸ¥çœ‹æ–‡ä»¶å¤§å°</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="variable">$du</span> -h filename</span><br><span class="line"><span class="comment">#å±•ç¤ºè¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œå¤§å°ä»¥å¯è¯»æ–¹å¼å±•ç¤º</span></span><br><span class="line"><span class="variable">$du</span>  -h /</span><br><span class="line"><span class="comment">#å±•ç¤ºå½“å‰ç›®å½•å¤§å°</span></span><br><span class="line"><span class="variable">$du</span> -sh</span><br><span class="line"><span class="comment">#å±•ç¤ºå½“å‰ç›®å½•ä¸‹æ¯ä¸ªç›®å½•å¤§å°</span></span><br><span class="line"><span class="variable">$du</span> -sh ./</span><br><span class="line"><span class="comment">#æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶çš„å¤§å°ï¼Œä»¥å¯è¯»æ–¹å¼å±•ç¤º</span></span><br><span class="line"><span class="variable">$du</span> -ah /</span><br></pre></td></tr></tbody></table></figure>
<p>å…·ä½“æ“ä½œç¤ºä¾‹</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse logs]<span class="comment"># du -h remote-digest.log</span></span><br><span class="line">3.9M    remote-digest.log</span><br><span class="line">[root@horse logs]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nacos/logs</span><br><span class="line">[root@horse logs]<span class="comment"># du -h /usr/local/nacos/logs</span></span><br><span class="line">59M     /usr/<span class="built_in">local</span>/nacos/logs</span><br><span class="line">[root@horse logs]<span class="comment"># du -sh</span></span><br><span class="line">59M     .</span><br><span class="line">[root@horse logs]<span class="comment"># du -ah </span></span><br><span class="line">4.0K    ./naming-distro.log</span><br><span class="line">3.9M    ./remote-digest.log</span><br><span class="line">4.0K    ./naming-event.log.2021-05-25.0</span><br><span class="line">88K     ./nacos_gc.log.0.current</span><br><span class="line">92K     ./naming-performance.log</span><br><span class="line">4.0K    ./start.out</span><br><span class="line">2.2M    ./config-memory.log.2021-05-26.0</span><br><span class="line">0       ./nacos-address.log</span><br><span class="line">268K    ./core-auth.log.2021-05-25.0</span><br><span class="line">4.0K    ./naming-event.log</span><br><span class="line">728K    ./config-memory.log.2021-05-25.0</span><br><span class="line">4.8M    ./naming-push.log</span><br><span class="line">4.7M    ./naming-push.log.2021-05-26.0</span><br><span class="line">0       ./istio-main.log</span><br><span class="line">6.8M    ./core-auth.log</span><br><span class="line">11M     ./remote-digest.log.2021-05-27.0</span><br><span class="line">4.0K    ./naming-event.log.2021-05-26.0</span><br><span class="line">16K     ./nacos.log.2021-05-25.0</span><br><span class="line">8.0K    ./alipay-jraft.log</span><br><span class="line">3.3M    ./remote-digest.log.2021-05-25.0</span><br><span class="line">20K     ./tps-control.log</span><br><span class="line">4.0K    ./config-pull-check.log</span><br><span class="line">0       ./protocol-distro.log</span><br><span class="line">12K     ./config-trace.log</span><br><span class="line">224K    ./naming-performance.log.2021-05-27.0</span><br><span class="line">40K     ./tps-control-digest.log.2021-05-25.0</span><br><span class="line">8.0K    ./config-client-request.log.2021-05-25.0</span><br><span class="line">0       ./config-pull.log</span><br><span class="line">164K    ./naming-push.log.2021-05-25.0</span><br><span class="line">0       ./cmdb-main.log</span><br><span class="line">4.0K    ./config-trace.log.2021-05-25.0</span><br><span class="line">224K    ./naming-performance.log.2021-05-26.0</span><br><span class="line">0       ./config-notify.log</span><br><span class="line">4.0K    ./config-pull-check.log.2021-05-25.0</span><br><span class="line">12K     ./naming-server.log.2021-05-26.0</span><br><span class="line">12K     ./nacos.log</span><br><span class="line">12K     ./naming-server.log</span><br><span class="line">0       ./naming-rt.log</span><br><span class="line">4.0K    ./protocol-raft.log</span><br><span class="line">6.4M    ./core-auth.log.2021-05-26.0</span><br><span class="line">132K    ./config-client-request.log</span><br><span class="line">876K    ./tps-control-digest.log</span><br><span class="line">2.2M    ./config-memory.log.2021-05-27.0</span><br><span class="line">36K     ./nacos.log.2021-05-27.0</span><br><span class="line">4.0K    ./config-pull-check.log.2021-05-26.0</span><br><span class="line">4.0K    ./config-dump.log</span><br><span class="line">11M     ./remote-digest.log.2021-05-26.0</span><br><span class="line">880K    ./config-memory.log</span><br><span class="line">4.0K    ./remote.log</span><br><span class="line">36K     ./nacos.log.2021-05-26.0</span><br><span class="line">4.0K    ./config-server.log</span><br><span class="line">76K     ./naming-performance.log.2021-05-25.0</span><br><span class="line">4.0K    ./nacos-cluster.log</span><br><span class="line">0       ./remote-push.log</span><br><span class="line">4.0K    ./config-fatal.log</span><br><span class="line">4.0K    ./naming-raft.log</span><br><span class="line">692K    ./tps-control-digest.log.2021-05-26.0</span><br><span class="line">4.0K    ./naming-server.log.2021-05-25.0</span><br><span class="line">120K    ./config-client-request.log.2021-05-26.0</span><br><span class="line">0       ./tps-control-detail.log</span><br><span class="line">8.0K    ./config-trace.log.2021-05-26.0</span><br><span class="line">59M     .</span><br></pre></td></tr></tbody></table></figure>
<h3 id="firewallé˜²ç«å¢™"><a href="#firewallé˜²ç«å¢™" class="headerlink" title="firewallé˜²ç«å¢™"></a>firewallé˜²ç«å¢™</h3><h4 id="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€"><a href="#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€"></a>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</h4><blockquote>
<p>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</p>
<ul>
<li><code>firewall-cmd --state</code></li>
<li><code>systemctl status firewalld</code></li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span></span><br><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --state</span></span><br><span class="line">running</span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl status firewalld</span></span><br><span class="line">â— firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2021-07-03 10:13:48 CST; 2min 8s ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 1704 (firewalld)</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           â””â”€1704 /usr/bin/python2 -Es /usr/sbin/firewalld --nofork --nopid</span><br><span class="line"></span><br><span class="line">Jul 03 10:13:48 localhost.horsehost systemd[1]: Stopped firewalld - dynamic firewall daemon.</span><br><span class="line">Jul 03 10:13:48 localhost.horsehost systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">Jul 03 10:13:48 localhost.horsehost systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line">Jul 03 10:13:48 localhost.horsehost firewalld[1704]: WARNING: AllowZoneDrifting is enabled. This is considered an i...now.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="é˜²ç«å¢™çš„å¼€å¯ã€é‡å¯ã€å…³é—­"><a href="#é˜²ç«å¢™çš„å¼€å¯ã€é‡å¯ã€å…³é—­" class="headerlink" title="é˜²ç«å¢™çš„å¼€å¯ã€é‡å¯ã€å…³é—­"></a>é˜²ç«å¢™çš„å¼€å¯ã€é‡å¯ã€å…³é—­</h4><blockquote>
<p>é˜²ç«å¢™çš„å¼€å¯ã€é‡å¯ã€å…³é—­ç­‰æ“ä½œï¼ˆå…·ä½“æ•ˆæœä¸å†åšæ¼”ç¤ºï¼Œè®°å¾—å°±å¥½ï¼‰</p>
<ul>
<li>å¼€å¯<ul>
<li><code>systemctl start firewalld</code></li>
<li><code>service firewalld start</code></li>
</ul>
</li>
<li>é‡å¯<ul>
<li><code>systemctl restart firewalld</code></li>
<li><code>service firewalld restart</code></li>
</ul>
</li>
<li>å…³é—­<ul>
<li><code>systemctl stop firewalld</code></li>
<li><code>service firewalld stop</code></li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™"><a href="#æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™" class="headerlink" title="æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™"></a>æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™</h4><blockquote>
<p>æŸ¥çœ‹é˜²ç«å¢™å…¨éƒ¨è§„åˆ™ï¼š<code>firewall-cmd --list-all</code></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --list-all</span></span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens33</span><br><span class="line">  sources: </span><br><span class="line">  services: dhcpv6-client ssh</span><br><span class="line">  ports: 3306/tcp  <span class="comment"># ç›®å‰å¼€å¯çš„ç«¯å£ä¸º3306</span></span><br><span class="line">  protocols: </span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br></pre></td></tr></tbody></table></figure>
<h4 id="é˜²ç«å¢™ç«¯å£å¸¸ç”¨æ“ä½œ"><a href="#é˜²ç«å¢™ç«¯å£å¸¸ç”¨æ“ä½œ" class="headerlink" title="é˜²ç«å¢™ç«¯å£å¸¸ç”¨æ“ä½œ"></a>é˜²ç«å¢™ç«¯å£å¸¸ç”¨æ“ä½œ</h4><blockquote>
<p>æŸ¥çœ‹é˜²ç«å¢™æ‰€æœ‰å·²å¼€å¯çš„ç«¯å£ï¼š<code>firewall-cmd --list-ports</code></p>
<p>æ·»åŠ æ–°çš„ç«¯å£ï¼š<code>firewall-cmd --zone=public --add-port=12701/tcp --permanent</code></p>
<p>æ·»åŠ è¿ç»­çš„ç«¯å£ï¼š<code>firewall-cmd --zone=public --add-port=8080-8848/tcp --permanent</code></p>
<p>å…³é—­ç«¯å£ï¼š<code>firewall-cmd --zone=public --remove-port=12701/tcp --permanent</code></p>
<p>æŸ¥è¯¢æŸä¸ªç«¯å£æ˜¯å¦å¼€æ”¾ï¼š<code>firewall-cmd --query-port=6379/tcp</code></p>
<p><strong>æ³¨æ„ï¼šå¯¹äºç«¯å£çš„æ“ä½œï¼Œå¿…é¡»é‡å¯é˜²ç«å¢™æ‰èƒ½ç”Ÿæ•ˆã€‚</strong></p>
<p>å‚æ•°è§£é‡Šï¼š</p>
<ul>
<li>firwall-cmdï¼šæ˜¯Linuxæä¾›çš„æ“ä½œfirewallçš„ä¸€ä¸ªå·¥å…·</li>
<li>â€”permanentï¼šè¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹…ï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ</li>
<li>â€”add-portï¼šæ ‡è¯†æ·»åŠ çš„ç«¯å£</li>
<li>â€”remove-portï¼šæ ‡è¯†è¦ç§»é™¤çš„ç«¯å£</li>
<li>â€”query-portï¼šæ ‡è¯†è¦æŸ¥è¯¢çš„ç«¯å£</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æŸä¸ªç«¯å£æ˜¯å¦å¼€æ”¾</span></span><br><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --query-port=6379/tcp</span></span><br><span class="line">yes</span><br><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --query-port=5602/tcp</span></span><br><span class="line">no</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Vim</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³mybatis foreach in å‚æ•°è¶…1000æ¡é—®é¢˜</title>
    <url>/post/34813.html</url>
    <content><![CDATA[<h1 id="è§£å†³mybatis-foreach-in-å‚æ•°è¶…1000æ¡é—®é¢˜"><a href="#è§£å†³mybatis-foreach-in-å‚æ•°è¶…1000æ¡é—®é¢˜" class="headerlink" title="è§£å†³mybatis foreach in å‚æ•°è¶…1000æ¡é—®é¢˜"></a>è§£å†³mybatis foreach in å‚æ•°è¶…1000æ¡é—®é¢˜</h1><blockquote>
<p>mybaits ä¸­çš„foreach inçš„æŸ¥è¯¢æ—¶å€™ï¼Œä¸Šé™inçš„ä¸ªæ•°æ˜¯1000ä¸ªï¼Œå¦‚æœå‚æ•°è¶…è¿‡1000ä¸ªï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>åˆ©ç”¨<code>or</code>è¿æ¥ç¬¦æ‹¼æ¥</li>
<li>åˆ©ç”¨<code>$</code>ç¬¦å·ç›´æ¥è§£ææ­¤1000å¤šä¸ªå­—ç¬¦ä¸²å‚æ•°(æ— é•¿åº¦é™åˆ¶)</li>
</ul>
</blockquote>
<h2 id="orè¿æ¥ç¬¦æ‹¼æ¥"><a href="#orè¿æ¥ç¬¦æ‹¼æ¥" class="headerlink" title="orè¿æ¥ç¬¦æ‹¼æ¥"></a>orè¿æ¥ç¬¦æ‹¼æ¥</h2><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryBlogForeachOne"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM tb_blog tb</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        tb.is_deleted = 1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() != 0"</span>&gt;</span></span><br><span class="line">            AND tb.id IN</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"index % 999 == 998"</span>&gt;</span></span><br><span class="line">                    NULL ) OR tb.id IN (</span><br><span class="line">                <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                #{id}</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>SQLè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_blog tb <span class="keyword">where</span> tb.is_deleted<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> tb.id <span class="keyword">in</span> (<span class="string">'1'</span>,<span class="string">'2'</span>,...<span class="string">'998'</span>,<span class="keyword">NULL</span>) <span class="keyword">or</span> tb.id <span class="keyword">in</span> (<span class="string">'999'</span>,<span class="string">'1000'</span>,...,<span class="keyword">NULL</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ç¬¦å·è§£æ"><a href="#ç¬¦å·è§£æ" class="headerlink" title="$ç¬¦å·è§£æ"></a>$ç¬¦å·è§£æ</h2><blockquote>
<p><strong>å¯¹äºä½¿ç”¨<code>$</code>ç¬¦å·æ‹¼æ¥å‚æ•°ï¼Œæ²¡æœ‰ä»»ä½•é•¿åº¦é™åˆ¶ï¼Œä½†æ˜¯æœ‰SQLæ³¨å…¥çš„é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨</strong></p>
<p>å‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚å¦‚æœå‚æ•°åŸæœ¬æ˜¯ä¸ªlisté›†åˆï¼Œé‚£ä¹ˆå¿…é¡»è½¬æ¢ä¸ºå·²<code>é€—å·</code>åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="comment">// $ ç¬¦å·çš„foreach.inæŸ¥è¯¢</span></span><br><span class="line">List&lt;String&gt; ids = blogs.stream().map(Blog::getId).collect(Collectors.toList());</span><br><span class="line">    String id = String.join(<span class="string">","</span>, ids);</span><br><span class="line">    List&lt;Blog&gt; twoList = blogMapper.queryBlogForeachTwo(id);</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryBlogForeachTwo"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM tb_blog tb</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        tb.is_deleted = 1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null and id != ''"</span>&gt;</span></span><br><span class="line">            AND tb.id IN (${id});</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>SQLè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_blog tb <span class="keyword">where</span> tb.is_deleted<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> tb.id <span class="keyword">in</span> (<span class="string">'1'</span>,<span class="string">'2'</span>,...<span class="string">'1000'</span>,<span class="string">'1001'</span>,...) </span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>MybatisPlus</tag>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬”è®°ä¸­è½¬ç«™</title>
    <url>/post/64846.html</url>
    <content><![CDATA[<h2 id="ç¬”è®°ä¸­è½¬ç«™"><a href="#ç¬”è®°ä¸­è½¬ç«™" class="headerlink" title="ç¬”è®°ä¸­è½¬ç«™"></a>ç¬”è®°ä¸­è½¬ç«™</h2><hr>
<h3 id="ç”Ÿæ´»ä¸­çš„ç¬”è®°èµ„æ–™"><a href="#ç”Ÿæ´»ä¸­çš„ç¬”è®°èµ„æ–™" class="headerlink" title="ç”Ÿæ´»ä¸­çš„ç¬”è®°èµ„æ–™"></a>ç”Ÿæ´»ä¸­çš„ç¬”è®°èµ„æ–™</h3><blockquote>
<ul>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—</p>
<ul>
<li><a href="https://mabin.horsemuzi.top/RabbitMQ.pdf">RabbitMQç‚¹å‡»ä¸‹è½½</a></li>
</ul>
<hr>
</li>
<li><p>åˆ†å¸ƒå¼æ£€ç´¢å¼•æ“</p>
<ul>
<li><a href="https://mabin.horsemuzi.top/Elasticsearch.pdf">ElastisSearchç‚¹å‡»ä¸‹è½½</a></li>
</ul>
<hr>
</li>
<li><p>æ•°æ®åº“</p>
<ul>
<li><a href="http://www.horsemuzi.top/">MySQLç‚¹å‡»ä¸‹è½½</a></li>
<li><a href="http://www.horsemuzi.top/">Redisç‚¹å‡»ä¸‹è½½</a></li>
<li><a href="http://www.horsemuzi.top/">MongoDBç‚¹å‡»ä¸‹è½½</a></li>
</ul>
</li>
<li><p>SpringBootç›¸å…³</p>
<ul>
<li><a href="http://www.horsemuzi.top/">SpringBootç‚¹å‡»ä¸‹è½½</a></li>
</ul>
</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>ç”Ÿæ´»éšç¬”</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Notes</tag>
      </tags>
  </entry>
  <entry>
    <title>MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº</title>
    <url>/post/31421.html</url>
    <content><![CDATA[<h1 id="MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº"><a href="#MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº" class="headerlink" title="MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº"></a>MybatisPlusåŠ¨æ€æ·»åŠ åˆ‡æ¢æ•°æ®æº</h1><blockquote>
<p>MyabtisPlusé›†æˆDruidè¿æ¥æ± ï¼Œå®ç°æ•°æ®æºçš„åŠ¨æ€æ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢ç­‰æ“ä½œã€‚ä¸»è¦åˆ©ç”¨<code>@DS</code>æ³¨è§£å®ç°åŠ¨æ€åˆ‡æ¢ã€‚</p>
<p>åŸç†æ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨masterä¸»æ•°æ®æºåº“åˆ›å»ºä¸€ä¸ªç®¡ç†å…¶ä»–æ•°æ®æºçš„ä¿¡æ¯è¡¨ï¼Œç”¨äºå­˜å‚¨datasourceçš„å¿…è¦ä¿¡æ¯</li>
<li>å½“æ¥æ”¶è¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚çš„è‡ªå®šä¹‰å”¯ä¸€æ ‡è¯†ï¼Œåˆ°MySQLè¯»å–æ•°æ®æºä¿¡æ¯å¹¶åŠ¨æ€çš„æ·»åŠ æ•°æ®æºï¼Œ<code>ä¸€å®šç¨‹åº¦ä¸Šåˆ©ç”¨Redisè¿›è¡Œç¼“å­˜</code>ã€‚</li>
<li>åˆ©ç”¨MybatisPlusçš„<code>@DS</code>æ³¨è§£è¿›è¡ŒåŠ¨æ€åˆ‡æ¢æ•°æ®æº</li>
<li>æ ¹æ®ä¸€å®šçš„ç®—æ³•ï¼Œä¾‹å¦‚<code>lruç®—æ³•ï¼ˆæœ€å°‘ç”¨çš„æ•°æ®æºï¼‰</code>ï¼Œè¿›è¡Œåˆ é™¤æ•°æ®æºã€‚</li>
</ol>
<p><strong>MybatisPluså®˜ç½‘ï¼š<a href="[å¤šæ•°æ®æº | MyBatis-Plus](https://mybatis.plus/guide/dynamic-datasource.html">MybatisPlus</a>)</strong></p>
<p><strong>åŠ¨æ€æ•°æ®æºå®˜ç½‘ï¼š<a href="[é›†æˆDruid | åŠ¨æ€æ•°æ®æº (dynamic-datasource.com">dynamic druid datasource</a>](<a href="https://dynamic-datasource.com/guide/integration/Druid.html">https://dynamic-datasource.com/guide/integration/Druid.html</a>))</strong></p>
</blockquote>
<h2 id="1-åŸºæœ¬é…ç½®"><a href="#1-åŸºæœ¬é…ç½®" class="headerlink" title="1. åŸºæœ¬é…ç½®"></a>1. åŸºæœ¬é…ç½®</h2><h3 id="1-1-å¼•å…¥ä¾èµ–"><a href="#1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="1.1 å¼•å…¥ä¾èµ–"></a>1.1 å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- druidåŠ¨æ€æ•°æ®æºé…ç½® --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- spring boot redis --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="1-2-é…ç½®æ–‡ä»¶"><a href="#1-2-é…ç½®æ–‡ä»¶" class="headerlink" title="1.2 é…ç½®æ–‡ä»¶"></a>1.2 é…ç½®æ–‡ä»¶</h3><blockquote>
<p>å› ä¸ºè¿™é‡Œæ˜¯è¿›è¡ŒåŠ¨æ€æ·»åŠ æ•°æ®æºï¼Œæ‰€ä»¥åªéœ€è¦é…ç½®ä¸€ä¸ª<code>master</code>ä¸»åº“çš„æ•°æ®æºå³å¯ï¼Œå¦‚æœä»…ä»…æ˜¯çº¯æ­£çš„è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç›´æ¥é…ç½®é½å…¨çš„ä¸»ä»åº“<code>masterå’Œslave</code>æ•°æ®æºä¿¡æ¯ã€‚</p>
</blockquote>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dynamic-source</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># åŠ¨æ€æ•°æ®æºé›†æˆdruid</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span>  <span class="comment"># å…¨å±€druidé…ç½®</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">druid</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">druid</span></span><br><span class="line">    <span class="attr">dynamic:</span></span><br><span class="line">      <span class="attr">druid:</span></span><br><span class="line">        <span class="attr">initialSize:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">minIdle:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">maxActive:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">        <span class="attr">validationQuery:</span> <span class="string">select</span> <span class="string">'x'</span></span><br><span class="line">        <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">poolPreparedStatements:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">filters:</span> <span class="string">stat,wall</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">master:</span>  <span class="comment"># ä¸»åº“æ•°æ®æºé…ç½®</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.160:3306/dynamic_source?serverTimezone=GMT%2B8&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">          <span class="attr">druid:</span> <span class="comment"># ä¸»åº“çš„druidé…ç½®,å…·æœ‰è¦†ç›–æ€§</span></span><br><span class="line">            <span class="attr">initialSize:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">minIdle:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">maxActive:</span> <span class="number">2</span></span><br><span class="line">            <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">            <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">            <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">            <span class="attr">validationQuery:</span> <span class="string">select</span> <span class="string">'x'</span></span><br><span class="line">            <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">poolPreparedStatements:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">maxOpenPreparedStatements:</span> <span class="number">20</span></span><br><span class="line">            <span class="attr">filter:</span></span><br><span class="line">              <span class="attr">stat:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">slow-sql-millis:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">wall:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">log-violation:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">throw-exception:</span> <span class="literal">false</span></span><br><span class="line">                <span class="attr">config:</span></span><br><span class="line">                  <span class="attr">delete-where-none-check:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.160</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">10000</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">30</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">shutdown-timeout:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.horse.dynamic.model</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.horse.dynamic:</span> <span class="string">debug</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="1-3-å…¬å…±é…ç½®"><a href="#1-3-å…¬å…±é…ç½®" class="headerlink" title="1.3 å…¬å…±é…ç½®"></a>1.3 å…¬å…±é…ç½®</h3><blockquote>
<p>Constantså…¬å…±å±æ€§ç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/28 13:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æºå‚æ•°æ¨¡æ¿ï¼šåªæœ‰URLçš„ä¿¡æ¯ä¸åŒå…¶ä»–çš„éƒ½ç›¸åŒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USERNAME = <span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PASSWORD = <span class="string">"123456"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = <span class="string">"jdbc:mysql://192.168.1.153:3306/%s?serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜å‚¨æ•°æ®æºçš„ hash key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DYNAMIC_TENANT_KEY = <span class="string">"tps_dynamic_%s"</span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Redisé…ç½®ç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/10 17:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰jsonåºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>{</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ³¨å…¥æ•°æ®æº</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ—¶å°†å¯¹è±¡å…¨ç±»åä¸€èµ·ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">        mapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        <span class="comment">// mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span></span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(mapper);</span><br><span class="line"></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// key-valueç»“æ„åºåˆ—åŒ–æ•°æ®ç»“æ„</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashæ•°æ®ç»“æ„åºåˆ—åŒ–æ–¹å¼,å¿…é¡»è¿™æ ·å¦åˆ™å­˜hash å°±æ˜¯åŸºäºjdkåºåˆ—åŒ–çš„</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Sourceå®ä¾‹å¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/28 10:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName("tb_source")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Source</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4629722406932497304L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(value = "id", type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è¿æ¥æ± åç§°å¿…é¡»å”¯ä¸€ä¸”ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿æ¥æ± åç§°", example = "master")</span></span><br><span class="line">    <span class="meta">@TableField(value = "poll_name")</span></span><br><span class="line">    <span class="keyword">private</span> String pollName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "JDBC Driverä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "JDBC Driver", example = "com.mysql.jdbc.Driver")</span></span><br><span class="line">    <span class="meta">@TableField(value = "driver_class_name")</span></span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "JDBC Urlä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "JDBC Url", example = "jdbc:mysql://121.5.168.31:3306/horse_vue_blog?serverTimezone=GMT%2B8")</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "JDBC Usernameä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "JDBC Username", example = "root")</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "JDBC Passwordä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "JDBC Password", example = "******")</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// *********druidæ•°æ®æºé…ç½®ä¿¡æ¯(å¦‚æœæ·»åŠ çš„æ˜¯druidç±»å‹æ•°æ®æºï¼Œå¿…é¡»æœ‰ä¸‹é¢çš„å±æ€§ï¼Œå¦åˆ™åŒ…NPEé”™è¯¯)***********</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean lazy = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DrudConfigProperties druid;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>DrudConfigPropertieså±æ€§ç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Druidæ•°æ®æºéœ€è¦çš„éå¿…é¡»é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/28 16:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrudConfigProperties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer initialSize = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer maxActive = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer minIdle = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer maxWait = <span class="number">60000</span>;</span><br><span class="line">    <span class="keyword">private</span> Long timeBetweenEvictionRunsMillis = <span class="number">60000L</span>;</span><br><span class="line">    <span class="keyword">private</span> Long timeBetweenLogStatsMillis = <span class="number">300000L</span>;</span><br><span class="line">    <span class="keyword">private</span> Boolean testWhileIdle = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> Boolean testOnBorrow = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Boolean testOnReturn = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String validationQuery = <span class="string">"select 'x'"</span>;</span><br><span class="line">    <span class="keyword">private</span> Boolean poolPreparedStatements = <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="1-4-æ’é™¤åŸç”ŸDruidé…ç½®ç±»"><a href="#1-4-æ’é™¤åŸç”ŸDruidé…ç½®ç±»" class="headerlink" title="1.4 æ’é™¤åŸç”ŸDruidé…ç½®ç±»"></a>1.4 æ’é™¤åŸç”ŸDruidé…ç½®ç±»</h3><blockquote>
<p>ä¸è¿›è¡Œæ’é™¤çš„è¯ï¼Œç¨‹åºå¯åŠ¨æŠ¥é”™ï¼ï¼ï¼ï¼ˆä¸¤ç§æ–¹å¼é€‰å…¶ä¸€å³å¯ï¼‰</p>
</blockquote>
<p>ä¸»å¯åŠ¨ç±»æ’é™¤æ–¹å¼</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = {"com.horse.dynamic.mapper"})</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line">@SpringBootApplication(exclude = DruidDataSourceAutoConfigure.class) # æ’é™¤åŸç”ŸDruidçš„å¿«é€Ÿé…ç½®ç±»</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootDynamicSourceApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(SpringbootDynamicSourceApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ymlé…ç½®æ–‡ä»¶æ–¹å¼</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">autoconfigure:</span></span><br><span class="line">    <span class="attr">exclude:</span> <span class="string">com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="2-æœåŠ¡æ¥å£"><a href="#2-æœåŠ¡æ¥å£" class="headerlink" title="2. æœåŠ¡æ¥å£"></a>2. æœåŠ¡æ¥å£</h2><blockquote>
<p>åŸç†ï¼šæ¥æ”¶å”¯ä¸€æ ‡è¯†å‚æ•°<code>tenant</code>ï¼Œæ ¹æ®å‚æ•°åŠ¨æ€æŸ¥è¯¢ã€æ·»åŠ ã€åˆ‡æ¢æ•°æ®æºã€‚é‡ç‚¹åœ¨<code>/switch</code>æ¥å£ä¸­çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/27 18:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/dynamic/source")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicSourceController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šç”¨æ•°æ®æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DefaultDataSourceCreator dataSourceCreator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SwitchService switchService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æµ‹è¯•æŸ¥è¯¢å½“å‰æ‰€æœ‰æ•°æ®æº</span></span><br><span class="line">    <span class="meta">@GetMapping("/query/all")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">queryAllDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        DynamicRoutingDataSource dynamicAllSource = (DynamicRoutingDataSource) dataSource;</span><br><span class="line">        <span class="keyword">return</span> dynamicAllSource.getCurrentDataSources().keySet();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•æ·»åŠ ä¸€ä¸ªæ•°æ®æº</span></span><br><span class="line">    <span class="meta">@PostMapping("/add")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">add</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> Source dto)</span> </span>{</span><br><span class="line">        DataSourceProperty dataSourceProperty = <span class="keyword">new</span> DataSourceProperty();</span><br><span class="line">        BeanUtils.copyProperties(dto, dataSourceProperty);</span><br><span class="line">        DynamicRoutingDataSource ds = (DynamicRoutingDataSource) dataSource;</span><br><span class="line">        DataSource dataSource = dataSourceCreator.createDataSource(dataSourceProperty);</span><br><span class="line">        ds.addDataSource(dto.getPollName(), dataSource);</span><br><span class="line">        <span class="keyword">return</span> ds.getCurrentDataSources().keySet();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•æŸ¥è¯¢ã€æ·»åŠ ã€åˆ‡æ¢æ•°æ®æºç­‰ä¸€æ•´å¥—æµç¨‹</span></span><br><span class="line">    <span class="meta">@PostMapping("/switch")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">dynamicSwitchSource</span><span class="params">(<span class="meta">@RequestParam("tenant")</span> String tenant)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> æŸ¥è¯¢ç§Ÿæˆ·æ˜¯å¦å­˜åœ¨,æ ¡éªŒ tenant å‚æ•°åˆæ³•æ€§</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ‡æ¢æ•°æ®æº</span></span><br><span class="line">        log.info(<span class="string">" ==&gt; æ•°æ®æºåˆ‡æ¢å¼€å§‹"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> isSuccess = switchService.dynamicAddSource(tenant);</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; æ•°æ®æºåˆ‡æ¢æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            log.error(<span class="string">" ==&gt; æ•°æ®æºåˆ‡æ¢å¤±è´¥"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è¿æ¥æ•°æ®åº“æµ‹è¯•</span></span><br><span class="line">        <span class="keyword">boolean</span> bool = switchService.switchSourceUpdateCount(tenant);</span><br><span class="line">        <span class="keyword">return</span> bool ? <span class="string">"success"</span> : <span class="string">"error"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-å…·ä½“å®ç°"><a href="#3-å…·ä½“å®ç°" class="headerlink" title="3. å…·ä½“å®ç°"></a>3. å…·ä½“å®ç°</h2><blockquote>
<ul>
<li><code>dynamicAddSource</code>æ–¹æ³•ï¼š åŠ¨æ€æ·»åŠ æ•°æ®æº</li>
<li><code>switchSourceUpdateCount</code>æ–¹æ³•ï¼šåŠ¨æ€åˆ‡æ¢æ•°æ®æºï¼ˆæ ¹æ®å”¯ä¸€æ ‡è¯†ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/28 10:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwitchServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SwitchMapper</span>, <span class="title">Switch</span>&gt; <span class="keyword">implements</span> <span class="title">SwitchService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šç”¨æ•°æ®æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DefaultDataSourceCreator dataSourceCreator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Druidæ•°æ®æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DruidDataSourceCreator druidDataSourceCreator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SourceService sourceService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ‡æ¢æ•°æ®æº,è¿æ¥æ•°æ®åº“,ä¿®æ”¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * åˆ©ç”¨Springçš„SPELè¯­æ³•:åŠ¨æ€è·å–åˆ‡æ¢æ•°æ®æºçš„å”¯ä¸€æ ‡è¯†å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tenant</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DS("#tenant")</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">switchSourceUpdateCount</span><span class="params">(String tenant)</span> </span>{</span><br><span class="line">        log.info(<span class="string">" ==&gt; è¿æ¥æ•°æ®åº“æµ‹è¯•å¼€å§‹"</span>);</span><br><span class="line">        Switch currentSwitch = <span class="keyword">this</span>.getById(<span class="number">1</span>);</span><br><span class="line">        currentSwitch.setSwitchCount(currentSwitch.getSwitchCount() + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">boolean</span> update = <span class="keyword">this</span>.updateById(currentSwitch);</span><br><span class="line">        <span class="keyword">if</span> (update) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; è¿æ¥æ•°æ®åº“æµ‹è¯•æˆåŠŸ"</span>);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        }</span><br><span class="line">        log.error(<span class="string">" ==&gt; è¿æ¥æ•°æ®åº“æµ‹è¯•å¤±è´¥"</span>);</span><br><span class="line">        <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tenant ç§Ÿæˆ·å”¯ä¸€æ ‡è¯† &amp;&amp; æ•°æ®æºå”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ•°æ®æºæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dynamicAddSource</span><span class="params">(String tenant)</span> </span>{</span><br><span class="line">        <span class="comment">// æ ¹æ®keyæŸ¥è¯¢å½“å‰æ•°æ®æºä¸­æ˜¯å¦å­˜åœ¨æ­¤æ•°æ®æº,æœ‰ç›´æ¥åˆ‡æ¢</span></span><br><span class="line">        DynamicRoutingDataSource ds = (DynamicRoutingDataSource) dataSource;</span><br><span class="line">        Map&lt;String, DataSource&gt; dataSources = ds.getCurrentDataSources();</span><br><span class="line">        Set&lt;String&gt; set = dataSources.keySet();</span><br><span class="line">        <span class="keyword">if</span> (set.contains(tenant)) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; æ•°æ®æºå·²å­˜åœ¨"</span>);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        }</span><br><span class="line">        Source source;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢redis</span></span><br><span class="line">        String temp = (String) redisTemplate.opsForValue().get(String.format(Constants.DYNAMIC_TENANT_KEY, tenant));</span><br><span class="line">        source = JacksonUtils.stringToObj(temp, Source.class);</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isNotEmpty(source)) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; åŸºäºRedisç¼“å­˜æ·»åŠ æ•°æ®æº,source:{}"</span>, source);</span><br><span class="line">            addSource(source, ds);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        LambdaQueryWrapper&lt;Source&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.select(Source::getPollName, Source::getDriverClassName, Source::getUrl, Source::getUsername, Source::getPassword)</span><br><span class="line">                .eq(StringUtils.isNotBlank(tenant), Source::getPollName, tenant).last(<span class="string">"LIMIT 1"</span>);</span><br><span class="line">        source = sourceService.getOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isNotEmpty(source)) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; åŸºäºMySQLæ•°æ®æ·»åŠ æ•°æ®æº,source: {}"</span>, source);</span><br><span class="line">            <span class="comment">// addSource(source, ds, dataSourceProperty);</span></span><br><span class="line">            addDruidSource(source, ds);</span><br><span class="line">            <span class="comment">// æ•°æ®æºå­˜å…¥ç¼“å­˜</span></span><br><span class="line">            log.info(<span class="string">" ==&gt; æ•°æ®æºå¯¼å…¥Redisç¼“å­˜"</span>);</span><br><span class="line">            setRedisCache(source);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ— å½“å‰ç§Ÿæˆ·çš„æ•°æ®æºä¿¡æ¯:åŸºäºç§Ÿæˆ·å”¯ä¸€æ ‡è¯† tenant åˆ›å»ºæ–°æ•°æ®æº</span></span><br><span class="line">        Source newSource = <span class="keyword">new</span> Source();</span><br><span class="line">        newSource.setPollName(tenant);</span><br><span class="line">        newSource.setDriverClassName(Constants.DRIVER);</span><br><span class="line">        newSource.setUrl(String.format(Constants.URL, tenant));</span><br><span class="line">        newSource.setUsername(Constants.USERNAME);</span><br><span class="line">        newSource.setPassword(Constants.PASSWORD);</span><br><span class="line">        DataSourceProperty dataSourceProperty = <span class="keyword">new</span> DataSourceProperty();</span><br><span class="line">        BeanUtils.copyProperties(newSource, dataSourceProperty);</span><br><span class="line">		<span class="comment">// æ·»åŠ druidç±»å‹æ•°æ®æº</span></span><br><span class="line">        DataSource dataSource = druidDataSourceCreator.createDataSource(dataSourceProperty);</span><br><span class="line">        ds.addDataSource(newSource.getPollName(), dataSource);</span><br><span class="line">        Set&lt;String&gt; keySet = ds.getCurrentDataSources().keySet();</span><br><span class="line">        <span class="keyword">if</span> (keySet.contains(tenant)) {</span><br><span class="line">            log.info(<span class="string">" ==&gt; æ·»åŠ æ–°æ•°æ®æºæˆåŠŸ"</span>);</span><br><span class="line">            <span class="comment">// æŒä¹…åŒ–æ•°æ®æº</span></span><br><span class="line">            durance(newSource);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ é€šç”¨æ•°æ®æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ds</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addSource</span><span class="params">(Source source, DynamicRoutingDataSource ds)</span> </span>{</span><br><span class="line">        DataSourceProperty dataSourceProperty = <span class="keyword">new</span> DataSourceProperty();</span><br><span class="line">        BeanUtils.copyProperties(source, dataSourceProperty);</span><br><span class="line">        DataSource dataSource = dataSourceCreator.createDataSource(dataSourceProperty);</span><br><span class="line">        ds.addDataSource(source.getPollName(), dataSource);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ Druidæ•°æ®æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ds</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addDruidSource</span><span class="params">(Source source, DynamicRoutingDataSource ds)</span> </span>{</span><br><span class="line">        DataSourceProperty dataSourceProperty = <span class="keyword">new</span> DataSourceProperty();</span><br><span class="line">        BeanUtils.copyProperties(source, dataSourceProperty);</span><br><span class="line">        DataSource dataSource = druidDataSourceCreator.createDataSource(dataSourceProperty);</span><br><span class="line">        ds.addDataSource(source.getPollName(), dataSource);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒä¹…åŒ–æ•°æ®æºé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">durance</span><span class="params">(Source source)</span> </span>{</span><br><span class="line">        setRedisCache(source);</span><br><span class="line">        sourceService.save(source);</span><br><span class="line">        log.info(<span class="string">"==&gt; æ•°æ®æºåŒé‡æŒä¹…åŒ–æˆåŠŸ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®Redisç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setRedisCache</span><span class="params">(Source source)</span> </span>{</span><br><span class="line">        redisTemplate.opsForValue().set(String.format(Constants.DYNAMIC_TENANT_KEY, source.getPollName()),</span><br><span class="line">                JacksonUtils.objToString(source), <span class="number">300</span>, TimeUnit.SECONDS);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="4-å®éªŒç»“æœ-amp-é—ç•™é—®é¢˜"><a href="#4-å®éªŒç»“æœ-amp-é—ç•™é—®é¢˜" class="headerlink" title="4. å®éªŒç»“æœ&amp;é—ç•™é—®é¢˜"></a>4. å®éªŒç»“æœ&amp;é—ç•™é—®é¢˜</h2><blockquote>
<p>ç»è¿‡å®éªŒï¼ŒåŠ¨æ€æ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢æ•°æ®æºæµ‹è¯•åŸºæœ¬æˆåŠŸã€‚</p>
<p><strong>é—ç•™é—®é¢˜ï¼šå¦‚æœè¿›è¡Œåˆ¤æ–­æ•°æ®æºçš„åˆ é™¤æ—¶æœºï¼Œæ ¹æ®ä»€ä¹ˆæ¡ä»¶å»åˆ¤æ–­é‚£ä¸ªæ•°æ®æºåº”è¯¥è¢«ç§»é™¤ï¼Œæš‚æ—¶æ²¡æœ‰æƒ³åˆ°è§£å†³åŠæ³•ï¼Œå”¯ä¸€æƒ³åˆ°çš„å°±æ˜¯ç±»ä¼¼Redisçš„keyåˆ é™¤ç­–ç•¥<code>lruç®—æ³•</code>ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€æ ·å®ç°ã€‚</strong>ä½†æ˜¯æ•°æ®æºçš„åŠ¨æ€æ·»åŠ åˆ‡æ¢åŸºæœ¬æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œ<strong>æ¥ä¸‹æ¥éœ€è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡ä¸å¤±æ•ˆ</strong>ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>MybatisPlus</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆEasyExcel</title>
    <url>/post/38823.html</url>
    <content><![CDATA[<h1 id="SpringBootæ•´åˆEasyExcelå®ç°"><a href="#SpringBootæ•´åˆEasyExcelå®ç°" class="headerlink" title="SpringBootæ•´åˆEasyExcelå®ç°"></a>SpringBootæ•´åˆEasyExcelå®ç°</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p><strong>æ³¨æ„ï¼š</strong><a href="https://alibaba-easyexcel.github.io/quickstart/write.html">ç‚¹å‡»æŸ¥çœ‹å®˜ç½‘Demo</a></p>
<h3 id="1-å¼•å…¥pomä¾èµ–"><a href="#1-å¼•å…¥pomä¾èµ–" class="headerlink" title="1. å¼•å…¥pomä¾èµ–"></a>1. å¼•å…¥pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--easyExcel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-å®ç°åŠŸèƒ½"><a href="#2-å®ç°åŠŸèƒ½" class="headerlink" title="2. å®ç°åŠŸèƒ½"></a>2. å®ç°åŠŸèƒ½</h3><blockquote>
<ol>
<li>ç»“åˆVueå‰ç«¯ï¼Œå®ç°æµè§ˆå™¨é¡µé¢ç›´æ¥å¯¼å‡ºæ—¥å¿—æ–‡ä»¶</li>
<li>å®ç°æ–‡ä»¶çš„å¯¼å…¥</li>
</ol>
</blockquote>
<h2 id="Excelæ–‡ä»¶ä¸‹è½½"><a href="#Excelæ–‡ä»¶ä¸‹è½½" class="headerlink" title="Excelæ–‡ä»¶ä¸‹è½½"></a>Excelæ–‡ä»¶ä¸‹è½½</h2><h3 id="3-æ—¥å¿—å®ä½“ç±»"><a href="#3-æ—¥å¿—å®ä½“ç±»" class="headerlink" title="3. æ—¥å¿—å®ä½“ç±»"></a>3. æ—¥å¿—å®ä½“ç±»</h3><blockquote>
<p>å®ä½“ç±»é‡Œæœ‰è‡ªå®šä¹‰è½¬æ¢å™¨ï¼šç”¨äºJavaç±»å‹æ•°æ®å’ŒExcelç±»å‹æ•°æ®çš„è½¬æ¢ï¼Œéå¸¸ä½¿ç”¨ã€‚ç»“åˆæ³¨è§£ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„è¿›è¡ŒExcelæ–‡ä»¶å¯¼å‡ºã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ“ä½œæ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-09-08</span></span><br><span class="line"><span class="comment"> * æ³¨æ„: å®ä½“ç±»ä¸­å¦‚æœä½¿ç”¨<span class="doctag">@Accessory</span>ï¼ˆchain=trueï¼‰,é‚£ä¹ˆå¯¼å…¥çš„æ•°æ®æ— æ³•å¡«å……åˆ°å®ä¾‹ä¸­,å¯¼å‡ºæ•°æ®ä¸å—å½±å“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@TableName("tb_operational_log")</span></span><br><span class="line"><span class="meta">@ApiModel(value = "OperationalLogå¯¹è±¡", description = "æ“ä½œæ—¥å¿—ä¿¡æ¯")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationalLog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ—¥å¿—ID"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ—¥å¿—ID")</span></span><br><span class="line">    <span class="meta">@TableId(value = "id", type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œç±»å‹"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œç±»å‹")</span></span><br><span class="line">    <span class="keyword">private</span> String operType;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œæè¿°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œæè¿°")</span></span><br><span class="line">    <span class="keyword">private</span> String operDesc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œå‘˜ID"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œå‘˜ID")</span></span><br><span class="line">    <span class="keyword">private</span> String operUserId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œå‘˜åç§°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œå‘˜åç§°")</span></span><br><span class="line">    <span class="keyword">private</span> String operUserName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œæ–¹æ³•"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œæ–¹æ³•")</span></span><br><span class="line">    <span class="keyword">private</span> String operMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚æ–¹æ³•"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚æ–¹æ³•")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequWay;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = {"æ“ä½œæ—¥å¿—", "è¯·æ±‚è€—æ—¶ï¼šå•ä½-ms"}, converter = CustomRequestTimeConverter.class)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚è€—æ—¶ï¼šå•ä½-ms")</span></span><br><span class="line">    <span class="keyword">private</span> Long operRequTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚å‚æ•°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚å‚æ•°")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequParams;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚Body"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚Body")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequBody;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚IP"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚IP")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequIp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚URL"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚URL")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = {"æ“ä½œæ—¥å¿—", "æ—¥å¿—æ ‡è¯†"}, converter = CustomLogFlagConverter.class)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ—¥å¿—æ ‡è¯†: 1-admin,0-portal")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean logFlag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œçŠ¶æ€"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œçŠ¶æ€:1-æˆåŠŸ,0-å¤±è´¥")</span></span><br><span class="line">    <span class="meta">@TableField(value = "is_success")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "é€»è¾‘åˆ é™¤ 1-æœªåˆ é™¤ï¼Œ 0-åˆ é™¤")</span></span><br><span class="line">    <span class="meta">@TableField(value = "is_deleted")</span></span><br><span class="line">    <span class="meta">@TableLogic(value = "1", delval = "0")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean deleted;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = {"æ“ä½œæ—¥å¿—", "åˆ›å»ºæ—¶é—´"}, converter = CustomTimeFormatConverter.class)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-æ¥å£å’Œå…·ä½“å®ç°"><a href="#4-æ¥å£å’Œå…·ä½“å®ç°" class="headerlink" title="4.  æ¥å£å’Œå…·ä½“å®ç°"></a>4.  æ¥å£å’Œå…·ä½“å®ç°</h3><h4 id="4-1-æ¥å£"><a href="#4-1-æ¥å£" class="headerlink" title="4.1 æ¥å£"></a>4.1 æ¥å£</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@OperatingLog(operType = BlogConstants.EXPORT, operDesc = "å¯¼å‡ºæ“ä½œæ—¥å¿—,å†™å‡ºåˆ°å“åº”æµä¸­")</span></span><br><span class="line"><span class="meta">@ApiOperation(value = "å¯¼å‡ºæ“ä½œæ—¥å¿—", hidden = true)</span></span><br><span class="line"><span class="meta">@PostMapping("/oper/export")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operLogExport</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; logIds, HttpServletResponse response)</span> </span>{</span><br><span class="line">    operationalLogService.operLogExport(logIds, response);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-2-å…·ä½“å®ç°"><a href="#4-2-å…·ä½“å®ç°" class="headerlink" title="4.2 å…·ä½“å®ç°"></a>4.2 å…·ä½“å®ç°</h4><blockquote>
<ul>
<li>è‡ªå®šä¹‰å¯¼å‡ºç­–ç•¥<code>HorizontalCellStyleStrategy</code></li>
<li>è‡ªå®šä¹‰å¯¼å‡ºæ‹¦æˆªå™¨<code>CellWriteHandler</code>ï¼Œæ›´åŠ ç²¾ç¡®çš„è‡ªå®šä¹‰å¯¼å‡ºç­–ç•¥</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¼å‡ºæ“ä½œæ—¥å¿—(å¯ä»¥è€ƒè™‘åˆ†é¡µå¯¼å‡º)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> logIds</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operLogExport</span><span class="params">(List&lt;String&gt; logIds, HttpServletResponse response)</span> </span>{</span><br><span class="line">    OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        List&lt;OperationalLog&gt; operationalLogs;</span><br><span class="line">        LambdaQueryWrapper&lt;OperationalLog&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;OperationalLog&gt;()</span><br><span class="line">                .orderByDesc(OperationalLog::getGmtCreate);</span><br><span class="line">        <span class="comment">// å¦‚æœlogIdsä¸ä¸ºnull,æŒ‰ç…§idæŸ¥è¯¢ä¿¡æ¯,å¦åˆ™æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(logIds)) {</span><br><span class="line">            operationalLogs = <span class="keyword">this</span>.listByIds(logIds);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            operationalLogs = <span class="keyword">this</span>.list(queryWrapper);</span><br><span class="line">        }</span><br><span class="line">        outputStream = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å•å…ƒæ ¼æ ·å¼</span></span><br><span class="line">        HorizontalCellStyleStrategy strategy = MyCellStyleStrategy.getHorizontalCellStyleStrategy();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å…¥å“åº”è¾“å‡ºæµæ•°æ®</span></span><br><span class="line">        EasyExcel.write(outputStream, OperationalLog.class).excelType(ExcelTypeEnum.XLSX).sheet(<span class="string">"æ“ä½œä¿¡æ¯æ—¥å¿—"</span>)</span><br><span class="line">                <span class="comment">// .registerWriteHandler(new LongestMatchColumnWidthStyleStrategy()) // è‡ªé€‚åº”åˆ—å®½(ä¸æ˜¯å¾ˆé€‚åº”,æ•ˆæœå¹¶ä¸ä½³)</span></span><br><span class="line">                .registerWriteHandler(strategy) <span class="comment">// æ³¨å†Œä¸Šé¢è®¾ç½®çš„æ ¼å¼ç­–ç•¥</span></span><br><span class="line">                .registerWriteHandler(<span class="keyword">new</span> CustomCellWriteHandler()) <span class="comment">// è®¾ç½®è‡ªå®šä¹‰æ ¼å¼ç­–ç•¥</span></span><br><span class="line">                .doWrite(operationalLogs);</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.EXCEL_DATA_EXPORT_ERROR);</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        IoUtil.close(outputStream);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªå®šä¹‰å¯¼å‡ºç­–ç•¥ç®€å•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å•å…ƒæ ¼æ ·å¼ç­–ç•¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/30 8:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCellStyleStrategy</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å•å…ƒæ ¼æ ·å¼(ä»…ç”¨äºæµ‹è¯•)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ ·å¼ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HorizontalCellStyleStrategy <span class="title">getHorizontalCellStyleStrategy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// è¡¨å¤´ç­–ç•¥</span></span><br><span class="line">        WriteCellStyle headerCellStyle = <span class="keyword">new</span> WriteCellStyle();</span><br><span class="line">        <span class="comment">// è¡¨å¤´æ°´å¹³å¯¹é½å±…ä¸­</span></span><br><span class="line">        headerCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">        <span class="comment">// èƒŒæ™¯è‰²</span></span><br><span class="line">        headerCellStyle.setFillForegroundColor(IndexedColors.SKY_BLUE.getIndex());</span><br><span class="line">        WriteFont headerFont = <span class="keyword">new</span> WriteFont();</span><br><span class="line">        headerFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">14</span>);</span><br><span class="line">        headerCellStyle.setWriteFont(headerFont);</span><br><span class="line">        <span class="comment">// è‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">        headerCellStyle.setWrapped(Boolean.FALSE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†…å®¹ç­–ç•¥</span></span><br><span class="line">        WriteCellStyle contentCellStyle = <span class="keyword">new</span> WriteCellStyle();</span><br><span class="line">        <span class="comment">// è®¾ç½®æ•°æ®å…è®¸çš„æ•°æ®æ ¼å¼,è¿™é‡Œ49ä»£è¡¨æ‰€æœ‰å¯ä»¥éƒ½å…è®¸è®¾ç½®</span></span><br><span class="line">        contentCellStyle.setDataFormat((<span class="keyword">short</span>) <span class="number">49</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®èƒŒæ™¯è‰²: éœ€è¦æŒ‡å®š FillPatternType ä¸ºFillPatternType.SOLID_FOREGROUND ä¸ç„¶æ— æ³•æ˜¾ç¤ºèƒŒæ™¯é¢œè‰².å¤´é»˜è®¤äº† FillPatternTypeæ‰€ä»¥å¯ä»¥ä¸æŒ‡å®š</span></span><br><span class="line">        contentCellStyle.setFillPatternType(FillPatternType.SOLID_FOREGROUND);</span><br><span class="line">        contentCellStyle.setFillForegroundColor(IndexedColors.GREY_40_PERCENT.getIndex());</span><br><span class="line">        <span class="comment">// è®¾ç½®å†…å®¹é å·¦å¯¹é½</span></span><br><span class="line">        contentCellStyle.setHorizontalAlignment(HorizontalAlignment.LEFT);</span><br><span class="line">        <span class="comment">// è®¾ç½®å­—ä½“</span></span><br><span class="line">        WriteFont contentFont = <span class="keyword">new</span> WriteFont();</span><br><span class="line">        contentFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">12</span>);</span><br><span class="line">        contentCellStyle.setWriteFont(contentFont);</span><br><span class="line">        <span class="comment">// è®¾ç½®è‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">        contentCellStyle.setWrapped(Boolean.FALSE);</span><br><span class="line">        <span class="comment">// è®¾ç½®è¾¹æ¡†æ ·å¼å’Œé¢œè‰²</span></span><br><span class="line">        contentCellStyle.setBorderLeft(MEDIUM);</span><br><span class="line">        contentCellStyle.setBorderTop(MEDIUM);</span><br><span class="line">        contentCellStyle.setBorderRight(MEDIUM);</span><br><span class="line">        contentCellStyle.setBorderBottom(MEDIUM);</span><br><span class="line">        contentCellStyle.setTopBorderColor(IndexedColors.RED.getIndex());</span><br><span class="line">        contentCellStyle.setBottomBorderColor(IndexedColors.GREEN.getIndex());</span><br><span class="line">        contentCellStyle.setLeftBorderColor(IndexedColors.YELLOW.getIndex());</span><br><span class="line">        contentCellStyle.setRightBorderColor(IndexedColors.ORANGE.getIndex());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ ¼å¼åŠ å…¥å•å…ƒæ ¼æ ·å¼ç­–ç•¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HorizontalCellStyleStrategy(headerCellStyle, contentCellStyle);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªå®šä¹‰å¯¼å‡ºæ‹¦æˆªå™¨ç®€å•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> å®ç°CellWriteHandleræ¥å£, å®ç°å¯¹å•å…ƒæ ¼æ ·å¼çš„ç²¾ç¡®æ§åˆ¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/29 21:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCellWriteHandler</span> <span class="keyword">implements</span> <span class="title">CellWriteHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(CustomCellWriteHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeCellCreate</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Row row,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Head head, Integer columnIndex, Integer relativeRowIndex, Boolean isHead)</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•å…ƒæ ¼åˆ›å»ºä¹‹å(æ²¡æœ‰å†™å…¥å€¼)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeSheetHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeTableHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> relativeRowIndex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isHead</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCellCreate</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Cell cell,</span></span></span><br><span class="line"><span class="function"><span class="params">                                Head head, Integer relativeRowIndex, Boolean isHead)</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCellDataConverted</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       CellData cellData, Cell cell, Head head, Integer relativeRowIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       Boolean isHead)</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•å…ƒæ ¼å¤„ç†å(å·²å†™å…¥å€¼): è®¾ç½®ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„å¤´è¶…é“¾æ¥åˆ°EasyExcelçš„å®˜ç½‘(æœ¬ç³»ç»Ÿçš„å¯¼å‡ºçš„excel 0,1ä¸¤è¡Œéƒ½æ˜¯å¤´,æ‰€ä»¥åªè®¾ç½®ç¬¬ä¸€è¡Œçš„è¶…é“¾æ¥)</span></span><br><span class="line"><span class="comment">     * è¿™é‡Œå†è¿›è¡Œæ‹¦æˆªçš„å•å…ƒæ ¼æ ·å¼è®¾ç½®çš„è¯,å‰é¢è¯¥æ ·å¼å°†å…¨éƒ¨å¤±æ•ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeSheetHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeTableHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellDataList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> relativeRowIndex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isHead</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCellDispose</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 List&lt;CellData&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Boolean isHead)</span> </span>{</span><br><span class="line">        <span class="comment">// è®¾ç½®è¶…é“¾æ¥</span></span><br><span class="line">        <span class="keyword">if</span> (isHead &amp;&amp; cell.getRowIndex() == <span class="number">0</span> &amp;&amp; cell.getColumnIndex() == <span class="number">0</span>) {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; ç¬¬{}è¡Œ,ç¬¬{}åˆ—è¶…é“¾æ¥è®¾ç½®å®Œæˆ"</span>, cell.getRowIndex(), cell.getColumnIndex());</span><br><span class="line">            CreationHelper helper = writeSheetHolder.getSheet().getWorkbook().getCreationHelper();</span><br><span class="line">            Hyperlink hyperlink = helper.createHyperlink(HyperlinkType.URL);</span><br><span class="line">            hyperlink.setAddress(<span class="string">"https://github.com/alibaba/easyexcel"</span>);</span><br><span class="line">            cell.setHyperlink(hyperlink);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ç²¾ç¡®è®¾ç½®å•å…ƒæ ¼æ ¼å¼</span></span><br><span class="line">        <span class="keyword">boolean</span> bool = isHead &amp;&amp; cell.getRowIndex() == <span class="number">1</span> &amp;&amp;</span><br><span class="line">                (cell.getStringCellValue().equals(<span class="string">"è¯·æ±‚å‚æ•°"</span>) || cell.getStringCellValue().equals(<span class="string">"è¯·æ±‚Body"</span>));</span><br><span class="line">        <span class="keyword">if</span> (bool) {</span><br><span class="line">            logger.info(<span class="string">"ç¬¬{}è¡Œï¼Œç¬¬{}åˆ—å•å…ƒæ ¼æ ·å¼è®¾ç½®å®Œæˆã€‚"</span>, cell.getRowIndex(), cell.getColumnIndex());</span><br><span class="line">            <span class="comment">// è·å–å·¥ä½œç°¿</span></span><br><span class="line">            Workbook workbook = writeSheetHolder.getSheet().getWorkbook();</span><br><span class="line">            CellStyle cellStyle = workbook.createCellStyle();</span><br><span class="line"></span><br><span class="line">            Font cellFont = workbook.createFont();</span><br><span class="line">            cellFont.setBold(Boolean.TRUE);</span><br><span class="line">            cellFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">14</span>);</span><br><span class="line">            cellFont.setColor(IndexedColors.SEA_GREEN.getIndex());</span><br><span class="line">            cellStyle.setFont(cellFont);</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-3-å‰ç«¯è¯·æ±‚"><a href="#4-3-å‰ç«¯è¯·æ±‚" class="headerlink" title="4.3 å‰ç«¯è¯·æ±‚"></a>4.3 å‰ç«¯è¯·æ±‚</h4><blockquote>
<p>å‰ç«¯åœ¨åŸºäºVue+Elementçš„åŸºç¡€ä¸Šå®ç°äº†ç‚¹å‡»å¯¼å‡ºæŒ‰é’®ï¼Œåœ¨æµè§ˆå™¨é¡µé¢è¿›è¡Œä¸‹è½½ã€‚</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰¹é‡å¯¼å‡º</span></span><br><span class="line">    <span class="function"><span class="title">batchExport</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="comment">// éå†è·å–idé›†åˆåˆ—è¡¨</span></span><br><span class="line">      <span class="keyword">const</span> logIds = []</span><br><span class="line">      <span class="built_in">this</span>.multipleSelection.forEach(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">        logIds.push(item.id)</span><br><span class="line">      })</span><br><span class="line">       <span class="comment">// è¯·æ±‚åç«¯æ¥å£</span></span><br><span class="line">      axios({</span><br><span class="line">        url: <span class="built_in">this</span>.BASE_API + <span class="string">'/admin/blog/log/oper/export'</span>,</span><br><span class="line">        method: <span class="string">'post'</span>,</span><br><span class="line">        data: logIds,</span><br><span class="line">        responseType: <span class="string">'arraybuffer'</span>,</span><br><span class="line">        headers: { <span class="string">'token'</span>: getToken() }</span><br><span class="line">      }).then(<span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">        <span class="comment">// typeç±»å‹å¯ä»¥è®¾ç½®ä¸ºæ–‡æœ¬ç±»å‹ï¼Œè¿™é‡Œæ˜¯æ–°ç‰ˆexcelç±»å‹</span></span><br><span class="line">        <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([response.data], { <span class="attr">type</span>: <span class="string">'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8'</span> })</span><br><span class="line">        <span class="keyword">const</span> pdfUrl = <span class="built_in">window</span>.URL.createObjectURL(blob)</span><br><span class="line">        <span class="keyword">const</span> fileName = <span class="string">'HorseBlogæ“ä½œæ—¥å¿—'</span> <span class="comment">// ä¸‹è½½æ–‡ä»¶çš„åå­—</span></span><br><span class="line">        <span class="comment">// å¯¹äº&lt;a&gt;æ ‡ç­¾ï¼Œåªæœ‰ Firefox å’Œ Chromeï¼ˆå†…æ ¸ï¼‰æ”¯æŒ download å±æ€§</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'download'</span> <span class="keyword">in</span> <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)) {</span><br><span class="line">          <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">          link.href = pdfUrl</span><br><span class="line">          link.setAttribute(<span class="string">'download'</span>, fileName)</span><br><span class="line">          <span class="built_in">document</span>.body.appendChild(link)</span><br><span class="line">          link.click()</span><br><span class="line">          <span class="built_in">window</span>.URL.revokeObjectURL(pdfUrl) <span class="comment">// é‡Šæ”¾URL å¯¹è±¡</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">          <span class="comment">// IE æµè§ˆå™¨å…¼å®¹æ–¹æ³•</span></span><br><span class="line">          <span class="built_in">window</span>.navigator.msSaveBlob(blob, fileName)</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>æµ‹è¯•ç»“æœï¼šè¿˜è¡Œï¼ŒåŸºæœ¬å®ç°äº†é¡µé¢ä¸‹è½½çš„åŠŸèƒ½</p>
<h2 id="Excelæ–‡ä»¶å¯¼å…¥"><a href="#Excelæ–‡ä»¶å¯¼å…¥" class="headerlink" title="Excelæ–‡ä»¶å¯¼å…¥"></a>Excelæ–‡ä»¶å¯¼å…¥</h2><h3 id="5-æ–‡ä»¶è¯»å–é…ç½®"><a href="#5-æ–‡ä»¶è¯»å–é…ç½®" class="headerlink" title="5. æ–‡ä»¶è¯»å–é…ç½®"></a>5. æ–‡ä»¶è¯»å–é…ç½®</h3><blockquote>
<p>æœ¬é…ç½®åŸºäºæ³›å‹çš„æ–¹å¼ç¼–å†™ï¼Œå¯æ‰©å±•æ€§è¾ƒå¼ºã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: EasyExcelæ–‡ä»¶è¯»å–é…ç½®(ä¸èƒ½è®©springç®¡ç†)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/27 13:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExcelImportConfig</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(MyExcelImportConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯æ¬¡è¯»å–çš„æœ€å¤§æ•°æ®æ¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_BATCH_COUNT = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³›å‹beanå±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T dynamicService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯æ¥æ”¶ä»»ä½•å‚æ•°çš„æ³›å‹Listé›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°æ³¨å…¥bean(æ ¹æ®ä¼ å…¥çš„beanåŠ¨æ€æ³¨å…¥)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dynamicService</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyExcelImportConfig</span><span class="params">(T dynamicService)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.dynamicService = dynamicService;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£ææ¯æ¡æ•°æ®éƒ½è¿›è¡Œè°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(T data, AnalysisContext context)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">" ==&gt; è§£æä¸€æ¡æ•°æ®: {}"</span>, JacksonUtils.objToString(data));</span><br><span class="line">        list.add(data);</span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt; MAX_BATCH_COUNT) {</span><br><span class="line">            <span class="comment">// ä¿å­˜æ•°æ®</span></span><br><span class="line">            saveData();</span><br><span class="line">            <span class="comment">// æ¸…ç©ºlist</span></span><br><span class="line">            list.clear();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰æ•°æ®è§£æå®Œæˆå,ä¼šæ¥è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     * ä½œç”¨: é¿å…æœ€åé›†åˆä¸­å°äº MAX_BATCH_COUNT æ¡çš„æ•°æ®æ²¡æœ‰è¢«ä¿å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>{</span><br><span class="line">        saveData();</span><br><span class="line">        logger.info(<span class="string">" ==&gt; æ•°æ®è§£æå®Œæˆ &lt;=="</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜æ•°æ®: æ­£å¼åº”è¯¥æ’å…¥æ•°æ®åº“,è¿™é‡Œç”¨äºæµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span> </span>{</span><br><span class="line">        logger.info(<span class="string">" ==&gt; æ•°æ®ä¿å­˜å¼€å§‹: {}"</span>, list.size());</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">        logger.info(<span class="string">" ==&gt; æ•°æ®ä¿å­˜ç»“æŸ &lt;=="</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨è½¬æ¢å¼‚å¸¸ è·å–å…¶ä»–å¼‚å¸¸ä¸‹ä¼šè°ƒç”¨æœ¬æ¥å£ã€‚æˆ‘ä»¬å¦‚æœæ•æ‰å¹¶æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸åˆ™åœæ­¢è¯»å–ã€‚å¦‚æœè¿™é‡Œä¸æŠ›å‡ºå¼‚å¸¸åˆ™ ç»§ç»­è¯»å–ä¸‹ä¸€è¡Œã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exception</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(Exception exception, AnalysisContext context)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        logger.error(<span class="string">" ==&gt; æ•°æ®è§£æå¤±è´¥,ä½†æ˜¯ç»§ç»­è¯»å–ä¸‹ä¸€è¡Œ:{}"</span>, exception.getMessage());</span><br><span class="line">        <span class="comment">//  å¦‚æœæ˜¯æŸä¸€ä¸ªå•å…ƒæ ¼çš„è½¬æ¢å¼‚å¸¸ èƒ½è·å–åˆ°å…·ä½“è¡Œå·</span></span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ExcelDataConvertException) {</span><br><span class="line">            ExcelDataConvertException convertException = (ExcelDataConvertException) exception;</span><br><span class="line">            logger.error(<span class="string">"ç¬¬{}è¡Œï¼Œç¬¬{}åˆ—æ•°æ®è§£æå¼‚å¸¸"</span>, convertException.getRowIndex(), convertException.getColumnIndex());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-è¯»å–æµ‹è¯•"><a href="#6-è¯»å–æµ‹è¯•" class="headerlink" title="6. è¯»å–æµ‹è¯•"></a>6. è¯»å–æµ‹è¯•</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = "æ•°æ®å¯¼å…¥æµ‹è¯•", notes = "æ“ä½œæ—¥å¿—å¯¼å…¥æµ‹è¯•[OperationalLog]", hidden = true)</span></span><br><span class="line"><span class="meta">@PostMapping("/import")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">excelImport</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    EasyExcel.read(file.getInputStream(), OperationalLog.class, <span class="keyword">new</span> MyExcelImportConfig&lt;&gt;(operationalLogService))</span><br><span class="line">            .sheet().doRead();</span><br><span class="line">    <span class="keyword">return</span> R.ok().message(<span class="string">"æ–‡ä»¶å¯¼å…¥æˆåŠŸ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="7-é™„ä¸Šè‡ªå®šä¹‰å±æ€§è½¬æ¢å™¨"><a href="#7-é™„ä¸Šè‡ªå®šä¹‰å±æ€§è½¬æ¢å™¨" class="headerlink" title="7. é™„ä¸Šè‡ªå®šä¹‰å±æ€§è½¬æ¢å™¨"></a>7. é™„ä¸Šè‡ªå®šä¹‰å±æ€§è½¬æ¢å™¨</h3><blockquote>
<p>è½¬æ¢å™¨çš„å±æ€§å†…å®¹è½¬æ¢ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…ä¸šåŠ¡éœ€æ±‚è€Œå®šï¼Œè¿™é‡Œä»…ä½œä¸ºç®€å•ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰excelè½¬æ¢å™¨: å°†æ“ä½œæ—¥å¿—çš„è¯·æ±‚è€—æ—¶åŠ ä¸Šå•ä½ "ms"</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/27 10:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRequestTimeConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">Long</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ•°æ®æ—¶: å±æ€§å¯¹åº”çš„javaæ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;Long&gt; <span class="title">supportJavaTypeKey</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Long.class;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†™å…¥æ•°æ®æ—¶: excelå†…éƒ¨çš„æ•°æ®ç±»å‹,å› ä¸ºè¯·æ±‚è€—æ—¶æ˜¯longç±»å‹,å¯¹åº”excelæ˜¯NUMBERç±»å‹,ä½†æ˜¯åŠ ä¸Š"msåå¯¹åº”çš„æ˜¯STRINGç±»å‹"</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellDataTypeEnum <span class="title">supportExcelTypeKey</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> CellDataTypeEnum.STRING;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–å›è°ƒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentProperty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> globalConfiguration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">convertToJavaData</span><span class="params">(CellData cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// æˆªå–å­—ç¬¦ä¸²: "ms",è½¬æ¢ä¸ºlongç±»å‹</span></span><br><span class="line">        String value = cellData.getStringValue();</span><br><span class="line">        <span class="keyword">return</span> Long.valueOf(value.substring(<span class="number">0</span>, value.length() - <span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellData&lt;Long&gt; <span class="title">convertToExcelData</span><span class="params">(Long value, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// æ·»åŠ å­—ç¬¦ä¸²: "ms"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CellData&lt;&gt;(String.valueOf(value).concat(<span class="string">"ms"</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ ¼å¼åŒ–æ—¶é—´</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/27 14:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTimeFormatConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">Date</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;Date&gt; <span class="title">supportJavaTypeKey</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Date.class;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellDataTypeEnum <span class="title">supportExcelTypeKey</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> CellDataTypeEnum.STRING;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convertToJavaData</span><span class="params">(CellData cellData, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String value = cellData.getStringValue();</span><br><span class="line">        <span class="keyword">return</span> DateUtil.parse(value, DatePattern.NORM_DATETIME_PATTERN);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellData&lt;Date&gt; <span class="title">convertToExcelData</span><span class="params">(Date value, ExcelContentProperty contentProperty, GlobalConfiguration globalConfiguration)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CellData&lt;&gt;(DateUtil.format(value, DatePattern.NORM_DATETIME_PATTERN));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>EasyExcelç®€å•ä½¿ç”¨ï¼Œåˆ°æ­¤ç»“æŸï¼Œæ‰“å®Œæ”¶åŠŸã€‚</p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>EasyExcel</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆQuartzå®šæ—¶ä»»åŠ¡</title>
    <url>/post/51271.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´ä¸ªQuartzå®šæ—¶ä»»åŠ¡"><a href="#SpringBootæ•´ä¸ªQuartzå®šæ—¶ä»»åŠ¡" class="headerlink" title="SpringBootæ•´ä¸ªQuartzå®šæ—¶ä»»åŠ¡"></a>SpringBootæ•´ä¸ªQuartzå®šæ—¶ä»»åŠ¡</h2><h3 id="è¿è¡ŒSQLè„šæœ¬"><a href="#è¿è¡ŒSQLè„šæœ¬" class="headerlink" title="è¿è¡ŒSQLè„šæœ¬"></a>è¿è¡ŒSQLè„šæœ¬</h3><blockquote>
<ul>
<li>ä¸‹è½½Quartzçš„èµ„æºå‹ç¼©åŒ…<a href="http://www.quartz-scheduler.org/downloads/">ç‚¹å‡»ä¸‹è½½Quartz</a></li>
<li>åœ¨<code>docs/dbTables/</code>ç›®å½•ä¸‹é€‰æ‹©åˆé€‚çš„æ•°æ®åº“SQLè„šæœ¬æ‰§è¡Œ</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">#</span><br><span class="line"># <span class="keyword">In</span> your Quartz properties file, you<span class="string">'ll need to set </span></span><br><span class="line"><span class="string"># org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># By: Ron Cordell - roncordell</span></span><br><span class="line"><span class="string">#  I didn'</span>t see this anywhere, so I thought I<span class="string">'d post it here. This is the script from Quartz to create the tables in a MySQL database, modified to use INNODB instead of MYISAM.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_FIRED_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_PAUSED_TRIGGER_GRPS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_SCHEDULER_STATE;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_LOCKS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_SIMPLE_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_SIMPROP_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_CRON_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_BLOB_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_TRIGGERS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_JOB_DETAILS;</span></span><br><span class="line"><span class="string">DROP TABLE IF EXISTS QRTZ_CALENDARS;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_JOB_DETAILS(</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">DESCRIPTION VARCHAR(250) NULL,</span></span><br><span class="line"><span class="string">JOB_CLASS_NAME VARCHAR(250) NOT NULL,</span></span><br><span class="line"><span class="string">IS_DURABLE VARCHAR(1) NOT NULL,</span></span><br><span class="line"><span class="string">IS_NONCONCURRENT VARCHAR(1) NOT NULL,</span></span><br><span class="line"><span class="string">IS_UPDATE_DATA VARCHAR(1) NOT NULL,</span></span><br><span class="line"><span class="string">REQUESTS_RECOVERY VARCHAR(1) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_DATA BLOB NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,JOB_NAME,JOB_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_TRIGGERS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">DESCRIPTION VARCHAR(250) NULL,</span></span><br><span class="line"><span class="string">NEXT_FIRE_TIME BIGINT(13) NULL,</span></span><br><span class="line"><span class="string">PREV_FIRE_TIME BIGINT(13) NULL,</span></span><br><span class="line"><span class="string">PRIORITY INTEGER NULL,</span></span><br><span class="line"><span class="string">TRIGGER_STATE VARCHAR(16) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_TYPE VARCHAR(8) NOT NULL,</span></span><br><span class="line"><span class="string">START_TIME BIGINT(13) NOT NULL,</span></span><br><span class="line"><span class="string">END_TIME BIGINT(13) NULL,</span></span><br><span class="line"><span class="string">CALENDAR_NAME VARCHAR(200) NULL,</span></span><br><span class="line"><span class="string">MISFIRE_INSTR SMALLINT(2) NULL,</span></span><br><span class="line"><span class="string">JOB_DATA BLOB NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">FOREIGN KEY (SCHED_NAME,JOB_NAME,JOB_GROUP)</span></span><br><span class="line"><span class="string">REFERENCES QRTZ_JOB_DETAILS(SCHED_NAME,JOB_NAME,JOB_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_SIMPLE_TRIGGERS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">REPEAT_COUNT BIGINT(7) NOT NULL,</span></span><br><span class="line"><span class="string">REPEAT_INTERVAL BIGINT(12) NOT NULL,</span></span><br><span class="line"><span class="string">TIMES_TRIGGERED BIGINT(10) NOT NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span></span><br><span class="line"><span class="string">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_CRON_TRIGGERS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">CRON_EXPRESSION VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TIME_ZONE_ID VARCHAR(80),</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span></span><br><span class="line"><span class="string">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_SIMPROP_TRIGGERS</span></span><br><span class="line"><span class="string">  (          </span></span><br><span class="line"><span class="string">    SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">    TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">    TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">    STR_PROP_1 VARCHAR(512) NULL,</span></span><br><span class="line"><span class="string">    STR_PROP_2 VARCHAR(512) NULL,</span></span><br><span class="line"><span class="string">    STR_PROP_3 VARCHAR(512) NULL,</span></span><br><span class="line"><span class="string">    INT_PROP_1 INT NULL,</span></span><br><span class="line"><span class="string">    INT_PROP_2 INT NULL,</span></span><br><span class="line"><span class="string">    LONG_PROP_1 BIGINT NULL,</span></span><br><span class="line"><span class="string">    LONG_PROP_2 BIGINT NULL,</span></span><br><span class="line"><span class="string">    DEC_PROP_1 NUMERIC(13,4) NULL,</span></span><br><span class="line"><span class="string">    DEC_PROP_2 NUMERIC(13,4) NULL,</span></span><br><span class="line"><span class="string">    BOOL_PROP_1 VARCHAR(1) NULL,</span></span><br><span class="line"><span class="string">    BOOL_PROP_2 VARCHAR(1) NULL,</span></span><br><span class="line"><span class="string">    PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">    FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) </span></span><br><span class="line"><span class="string">    REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_BLOB_TRIGGERS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">BLOB_DATA BLOB NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">INDEX (SCHED_NAME,TRIGGER_NAME, TRIGGER_GROUP),</span></span><br><span class="line"><span class="string">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span></span><br><span class="line"><span class="string">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_CALENDARS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">CALENDAR_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">CALENDAR BLOB NOT NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,CALENDAR_NAME))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_PAUSED_TRIGGER_GRPS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,TRIGGER_GROUP))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_FIRED_TRIGGERS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">ENTRY_ID VARCHAR(95) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">TRIGGER_GROUP VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">INSTANCE_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">FIRED_TIME BIGINT(13) NOT NULL,</span></span><br><span class="line"><span class="string">SCHED_TIME BIGINT(13) NOT NULL,</span></span><br><span class="line"><span class="string">PRIORITY INTEGER NOT NULL,</span></span><br><span class="line"><span class="string">STATE VARCHAR(16) NOT NULL,</span></span><br><span class="line"><span class="string">JOB_NAME VARCHAR(200) NULL,</span></span><br><span class="line"><span class="string">JOB_GROUP VARCHAR(200) NULL,</span></span><br><span class="line"><span class="string">IS_NONCONCURRENT VARCHAR(1) NULL,</span></span><br><span class="line"><span class="string">REQUESTS_RECOVERY VARCHAR(1) NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,ENTRY_ID))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_SCHEDULER_STATE (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">INSTANCE_NAME VARCHAR(200) NOT NULL,</span></span><br><span class="line"><span class="string">LAST_CHECKIN_TIME BIGINT(13) NOT NULL,</span></span><br><span class="line"><span class="string">CHECKIN_INTERVAL BIGINT(13) NOT NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,INSTANCE_NAME))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE TABLE QRTZ_LOCKS (</span></span><br><span class="line"><span class="string">SCHED_NAME VARCHAR(120) NOT NULL,</span></span><br><span class="line"><span class="string">LOCK_NAME VARCHAR(40) NOT NULL,</span></span><br><span class="line"><span class="string">PRIMARY KEY (SCHED_NAME,LOCK_NAME))</span></span><br><span class="line"><span class="string">ENGINE=InnoDB;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_J_REQ_RECOVERY ON QRTZ_JOB_DETAILS(SCHED_NAME,REQUESTS_RECOVERY);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_J_GRP ON QRTZ_JOB_DETAILS(SCHED_NAME,JOB_GROUP);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_J ON QRTZ_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_JG ON QRTZ_TRIGGERS(SCHED_NAME,JOB_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_C ON QRTZ_TRIGGERS(SCHED_NAME,CALENDAR_NAME);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_G ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_N_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_N_G_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_NEXT_FIRE_TIME ON QRTZ_TRIGGERS(SCHED_NAME,NEXT_FIRE_TIME);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_NFT_ST ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE,NEXT_FIRE_TIME);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_NFT_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_STATE);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE_GRP ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_GROUP,TRIGGER_STATE);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_TRIG_INST_NAME ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_INST_JOB_REQ_RCVRY ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME,REQUESTS_RECOVERY);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_J_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_JG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_T_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP);</span></span><br><span class="line"><span class="string">CREATE INDEX IDX_QRTZ_FT_TG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">commit; </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-quartz--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ymlé…ç½®æ–‡ä»¶"><a href="#ymlé…ç½®æ–‡ä»¶" class="headerlink" title="ymlé…ç½®æ–‡ä»¶"></a>ymlé…ç½®æ–‡ä»¶</h3><blockquote>
<p>é¢å¤–é…ç½®ä½¿ç”¨è‡ªå®šä¹‰çš„Druidè¿æ¥æ± ï¼Œé»˜è®¤ä½¿ç”¨çš„C3p0è¿æ¥æ± </p>
</blockquote>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># quartzä¿¡æ¯é…ç½®</span></span><br><span class="line">  <span class="attr">quartz:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">org:</span></span><br><span class="line">        <span class="attr">quartz:</span></span><br><span class="line">          <span class="attr">scheduler:</span></span><br><span class="line">            <span class="attr">instanceName:</span> <span class="string">DefaultQuartzScheduler</span></span><br><span class="line">            <span class="attr">instanceId:</span> <span class="string">AUTO</span></span><br><span class="line">          <span class="attr">jobStore:</span></span><br><span class="line">            <span class="attr">class:</span> <span class="string">org.quartz.impl.jdbcjobstore.JobStoreTX</span></span><br><span class="line">            <span class="attr">driverDelegateClass:</span> <span class="string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line">            <span class="attr">tablePrefix:</span> <span class="string">QRTZ_</span></span><br><span class="line">            <span class="attr">isClustered:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">clusterCheckinInterval:</span> <span class="number">10000</span></span><br><span class="line">            <span class="attr">useProperties:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">dataSource:</span> <span class="string">myDS</span>  <span class="comment"># è‡ªå®šä¹‰æ•°æ®æºåç§°</span></span><br><span class="line">          <span class="attr">threadPool:</span></span><br><span class="line">            <span class="attr">class:</span> <span class="string">org.quartz.simpl.SimpleThreadPool</span></span><br><span class="line">            <span class="attr">threadCount:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">threadPriority:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">threadsInheritContextClassLoaderOfInitializingThread:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">dataSource:</span></span><br><span class="line">            <span class="attr">myDS:</span></span><br><span class="line">              <span class="attr">connectionProvider:</span></span><br><span class="line">                <span class="attr">class:</span> <span class="string">com.horse.service.blog.handler.DruidProviderHandler</span>  <span class="comment"># æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„druidæ•°æ®æº(classå±äºä¸‹ä¸€çº§[æœ‰ç©ºæ ¼])</span></span><br><span class="line">              <span class="attr">URL:</span> <span class="string">jdbc:mysql://localhost:3306/horse_vue_blog?serverTimezone=GMT%2B8&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">              <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">              <span class="attr">password:</span> <span class="string">****</span></span><br><span class="line">              <span class="attr">driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">              <span class="attr">maxConnection:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment"># æ•°æ®åº“æŒä¹…åŒ–</span></span><br><span class="line">    <span class="attr">job-store-type:</span> <span class="string">jdbc</span></span><br><span class="line">    <span class="attr">jdbc:</span></span><br><span class="line">      <span class="attr">initialize-schema:</span> <span class="string">never</span> <span class="comment"># å¯åŠ¨æ—¶æ˜¯å¦æ‰§è¡Œå»ºè¡¨è¯­å¥(å·²ç»å­˜åœ¨çš„ä»»åŠ¡,é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä¸ä¼šè¿›è¡Œæ¸…ç©º,å¹¶ä¸”è‡ªåŠ¨æ‹‰å–æ‰§è¡Œ)</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="è‡ªå®šä¹‰Druidæ•°æ®æº"><a href="#è‡ªå®šä¹‰Druidæ•°æ®æº" class="headerlink" title="è‡ªå®šä¹‰Druidæ•°æ®æº"></a>è‡ªå®šä¹‰Druidæ•°æ®æº</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerException;</span><br><span class="line"><span class="keyword">import</span> org.quartz.utils.ConnectionProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Druidè¿æ¥æ± çš„Quartzæ‰©å±•ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidProviderHandler</span> <span class="keyword">implements</span> <span class="title">ConnectionProvider</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¸¸é‡é…ç½®ï¼Œä¸quartz.propertiesæ–‡ä»¶çš„keyä¿æŒä¸€è‡´(å»æ‰å‰ç¼€)ï¼ŒåŒæ—¶æä¾›setæ–¹æ³•ï¼ŒQuartzæ¡†æ¶è‡ªåŠ¨æ³¨å…¥å€¼ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JDBCé©±åŠ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JDBCè¿æ¥ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String URL;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String user;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“ç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> maxConnection;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“SQLæŸ¥è¯¢æ¯æ¬¡è¿æ¥è¿”å›æ‰§è¡Œåˆ°è¿æ¥æ± ï¼Œä»¥ç¡®ä¿å®ƒä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String validationQuery;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> validateOnCheckout;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> idleConnectionValidationSeconds;</span><br><span class="line">    <span class="keyword">public</span> String maxCachedStatementsPerConnection;</span><br><span class="line">    <span class="keyword">private</span> String discardIdleConnectionsSeconds;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_DB_MAX_CONNECTIONS = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_DB_MAX_CACHED_STATEMENTS_PER_CONNECTION = <span class="number">120</span>;</span><br><span class="line">    <span class="keyword">private</span> DruidDataSource datasource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> datasource.getConnection();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        datasource.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.URL == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool could not be created: DB URL cannot be null"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.driver == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool driver could not be created: DB driver class name cannot be null!"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.maxConnection &lt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool maxConnectins could not be created: Max connections must be greater than zero!"</span>);</span><br><span class="line">        }</span><br><span class="line">        datasource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        <span class="keyword">try</span>{</span><br><span class="line">            datasource.setDriverClassName(<span class="keyword">this</span>.driver);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> SchedulerException(<span class="string">"Problem setting driver class name on datasource: "</span> + e.getMessage(), e);</span><br><span class="line">            } <span class="keyword">catch</span> (SchedulerException e1) {</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        datasource.setUrl(<span class="keyword">this</span>.URL);</span><br><span class="line">        datasource.setUsername(<span class="keyword">this</span>.user);</span><br><span class="line">        datasource.setPassword(<span class="keyword">this</span>.password);</span><br><span class="line">        datasource.setMaxActive(<span class="keyword">this</span>.maxConnection);</span><br><span class="line">        datasource.setMinIdle(<span class="number">1</span>);</span><br><span class="line">        datasource.setMaxWait(<span class="number">0</span>);</span><br><span class="line">        datasource.setMaxPoolPreparedStatementPerConnectionSize(DEFAULT_DB_MAX_CONNECTIONS);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.validationQuery != <span class="keyword">null</span>) {</span><br><span class="line">            datasource.setValidationQuery(<span class="keyword">this</span>.validationQuery);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.validateOnCheckout) {</span><br><span class="line">                datasource.setTestOnReturn(<span class="keyword">true</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                datasource.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">            }</span><br><span class="line">            datasource.setValidationQueryTimeout(<span class="keyword">this</span>.idleConnectionValidationSeconds);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDriver</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> driver;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriver</span><span class="params">(String driver)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.driver = driver;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getURL</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> URL;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setURL</span><span class="params">(String URL)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.URL = URL;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaxConnection</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> maxConnection;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxConnection</span><span class="params">(<span class="keyword">int</span> maxConnection)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.maxConnection = maxConnection;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValidationQuery</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> validationQuery;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidationQuery</span><span class="params">(String validationQuery)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.validationQuery = validationQuery;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidateOnCheckout</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> validateOnCheckout;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidateOnCheckout</span><span class="params">(<span class="keyword">boolean</span> validateOnCheckout)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.validateOnCheckout = validateOnCheckout;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIdleConnectionValidationSeconds</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> idleConnectionValidationSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdleConnectionValidationSeconds</span><span class="params">(<span class="keyword">int</span> idleConnectionValidationSeconds)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.idleConnectionValidationSeconds = idleConnectionValidationSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">getDatasource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> datasource;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDatasource</span><span class="params">(DruidDataSource datasource)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.datasource = datasource;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDiscardIdleConnectionsSeconds</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> discardIdleConnectionsSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDiscardIdleConnectionsSeconds</span><span class="params">(String discardIdleConnectionsSeconds)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.discardIdleConnectionsSeconds = discardIdleConnectionsSeconds;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="configå…¨å±€é…ç½®"><a href="#configå…¨å±€é…ç½®" class="headerlink" title="configå…¨å±€é…ç½®"></a>configå…¨å±€é…ç½®</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.quartz.SchedulerFactoryBeanCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/14 15:41</span></span><br><span class="line"><span class="comment"> * quartzè‡ªå®šä¹‰å…¨å±€é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyQuartzConfig</span> <span class="keyword">implements</span> <span class="title">SchedulerFactoryBeanCustomizer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(SchedulerFactoryBean schedulerFactoryBean)</span> </span>{</span><br><span class="line">        <span class="comment">// å»¶æ—¶å¯åŠ¨</span></span><br><span class="line">        schedulerFactoryBean.setStartupDelay(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// æœåŠ¡å™¨åŠ è½½è‡ªå¯åŠ¨</span></span><br><span class="line">        schedulerFactoryBean.setAutoStartup(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// è¦†ç›–å·²å­˜åœ¨çš„ä»»åŠ¡(ç¡®ä¿ä»»åŠ¡æ›´æ–°åŠæ—¶ç”Ÿæ•ˆ)</span></span><br><span class="line">        schedulerFactoryBean.setOverwriteExistingJobs(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Quartzä»»åŠ¡åŸºæ“"><a href="#Quartzä»»åŠ¡åŸºæ“" class="headerlink" title="Quartzä»»åŠ¡åŸºæ“"></a>Quartzä»»åŠ¡åŸºæ“</h3><blockquote>
<p>å‰å°æ¥æ”¶æ•°æ®<code>QuartzInfoVo</code>å®ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/15 11:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzInfoVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">451044673720410024L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡åç§°")</span></span><br><span class="line">    <span class="keyword">public</span> String jobName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡ç»„ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡ç»„")</span></span><br><span class="line">    <span class="keyword">public</span> String jobGroup;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡ç±»åä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡ç±»å")</span></span><br><span class="line">    <span class="keyword">public</span> String jobClassName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡æè¿°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡æè¿°")</span></span><br><span class="line">    <span class="keyword">public</span> String jobDescription;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è§¦å‘å™¨åç§°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("è§¦å‘å™¨åç§°")</span></span><br><span class="line">    <span class="keyword">public</span> String triggerName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è§¦å‘å™¨ç»„ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("è§¦å‘å™¨ç»„")</span></span><br><span class="line">    <span class="keyword">public</span> String triggerGroup;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "cronè¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("cronè¡¨è¾¾å¼")</span></span><br><span class="line">    <span class="keyword">public</span> String cronExpression;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="é¡¹ç›®å®ç°æ¥å£æœåŠ¡"><a href="#é¡¹ç›®å®ç°æ¥å£æœåŠ¡" class="headerlink" title="é¡¹ç›®å®ç°æ¥å£æœåŠ¡"></a>é¡¹ç›®å®ç°æ¥å£æœåŠ¡</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/15 11:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@Api(tags = {"Quartzè°ƒåº¦æœåŠ¡API"})</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/blog/job")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminQuartzController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QuartzService quartzService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("æ ¹æ®ä»»åŠ¡åå’Œä»»åŠ¡ç»„æŸ¥è¯¢ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@GetMapping("/query")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryJobByNameAndGroup</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> <span class="meta">@NotBlank(message = "ä»»åŠ¡åç§°[jobName]ä¸èƒ½ä¸ºç©º")</span> String jobName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@RequestParam("jobGroup")</span> <span class="meta">@NotBlank(message = "ä»»åŠ¡åç»„[jobGroup]ä¸èƒ½ä¸ºç©º")</span> String jobGroup)</span> </span>{</span><br><span class="line">        ResponseQuartzInfoVO quartzInfoVO = quartzService.queryJobByNameAndGroup(jobName, jobGroup);</span><br><span class="line">        <span class="keyword">return</span> ObjectUtils.isNotEmpty(quartzInfoVO) ? R.ok().data(<span class="string">"item"</span>, quartzInfoVO) : R.error().message(<span class="string">"èµ„æºæœªæ‰¾åˆ°"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = "åˆ†é¡µæŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨", notes = "é…åˆPageHelperåˆ†é¡µæ’ä»¶")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "page", value = "å½“å‰é¡µ", dataType = "Integer", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "limit", value = "æ¯é¡µè®°å½•æ•°", dataType = "Integer", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@GetMapping("/query/list/{page}/{limit}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryJobList</span><span class="params">(<span class="meta">@PathVariable("page")</span> Integer page, <span class="meta">@PathVariable("limit")</span> Integer limit)</span> </span>{</span><br><span class="line">        PageHelper.startPage(page, limit);</span><br><span class="line">        List&lt;ResponseQuartzInfoVO&gt; quartzInfoVOList = quartzService.queryJobList();</span><br><span class="line">        PageInfo&lt;ResponseQuartzInfoVO&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(quartzInfoVOList);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"rows"</span>, pageInfo.getList()).data(<span class="string">"total"</span>, pageInfo.getTotal());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NoRepeatSubmit</span></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.ADD, operDesc = "åˆ›å»ºè°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("åˆ›å»ºä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@PostMapping("/add")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addJob</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> QuartzInfoVo quartzInfoVo)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(quartzInfoVo)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.addJob(quartzInfoVo);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"åˆ›å»ºæˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_CREATE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE, operDesc = "æš‚åœè°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æš‚åœä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@PostMapping("/pause")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">pauseJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName, <span class="meta">@RequestParam("jobGroup")</span> String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.pauseJob(jobName, jobGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æš‚åœæˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_PAUSE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE, operDesc = "æ¢å¤è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æ¢å¤ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@PostMapping("/resume")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">resumeJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName, <span class="meta">@RequestParam("jobGroup")</span> String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.resumeJob(jobName, jobGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æ¢å¤æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_RESUME_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE, operDesc = "æ›´æ–°è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æ›´æ–°ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@PutMapping("/update")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateJob</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> QuartzInfoVo quartzInfoVo)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(quartzInfoVo)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.updateJob(quartzInfoVo.getTriggerName(), quartzInfoVo.getTriggerGroup(),</span><br><span class="line">                    quartzInfoVo.getCronExpression());</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æ›´æ–°æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_UPDATE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.REMOVE, operDesc = "åˆ é™¤è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("åˆ é™¤ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "triggerName", value = "è§¦å‘å™¨åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "triggerGroup", value = "è§¦å‘å™¨ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@DeleteMapping("/remove")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("jobGroup")</span> String jobGroup,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("triggerName")</span> String triggerName,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("triggerGroup")</span> String triggerGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup, triggerName, triggerGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.removeJob(jobName, jobGroup, triggerName, triggerGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"åˆ é™¤æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_DELETE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®šæ—¶ä»»åŠ¡å…·ä½“å®ç°"><a href="#å®šæ—¶ä»»åŠ¡å…·ä½“å®ç°" class="headerlink" title="å®šæ—¶ä»»åŠ¡å…·ä½“å®ç°"></a>å®šæ—¶ä»»åŠ¡å…·ä½“å®ç°</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.job.BaseJob;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.mapper.QuartzMapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.QuartzService;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.vo.QuartzInfoVo;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.vo.ResponseQuartzInfoVO;</span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/15 11:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzServiceImpl</span> <span class="keyword">implements</span> <span class="title">QuartzService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QuartzMapper quartzMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Scheduler scheduler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> quartzInfoVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJob</span><span class="params">(QuartzInfoVo quartzInfoVo)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// å¯åŠ¨è°ƒåº¦å™¨</span></span><br><span class="line">        scheduler.start();</span><br><span class="line">        <span class="comment">// åˆ›å»ºJobDetails</span></span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(reflectClass(quartzInfoVo.getJobClassName()).getClass())</span><br><span class="line">                .withIdentity(quartzInfoVo.getJobName(), quartzInfoVo.getJobGroup())</span><br><span class="line">                .withDescription(quartzInfoVo.getJobDescription())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// åˆ›å»ºcronæ„å»ºå™¨</span></span><br><span class="line">        CronScheduleBuilder cronSchedule = CronScheduleBuilder.cronSchedule(quartzInfoVo.getCronExpression());</span><br><span class="line">        <span class="comment">// åˆ›å»ºè§¦å‘å™¨</span></span><br><span class="line">        CronTrigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(quartzInfoVo.getTriggerName(), quartzInfoVo.getTriggerGroup())</span><br><span class="line">                .withSchedule(cronSchedule)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// å»ºç«‹å…³è”</span></span><br><span class="line">        scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æš‚åœä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pauseJob</span><span class="params">(String jobName, String jobGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        scheduler.pauseJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¢å¤ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resumeJob</span><span class="params">(String jobName, String jobGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        scheduler.resumeJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeJob</span><span class="params">(String jobName, String jobGroup, String triggerName, String triggerGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// æš‚åœè§¦å‘å™¨</span></span><br><span class="line">        scheduler.pauseTrigger(TriggerKey.triggerKey(triggerName, triggerGroup));</span><br><span class="line">        <span class="comment">// ç§»é™¤è§¦å‘å™¨ä¸­ç»‘å®šçš„ä»»åŠ¡</span></span><br><span class="line">        scheduler.unscheduleJob(TriggerKey.triggerKey(triggerName, triggerGroup));</span><br><span class="line">        <span class="comment">// åˆ é™¤ä»»åŠ¡</span></span><br><span class="line">        scheduler.deleteJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cronExpression</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateJob</span><span class="params">(String triggerName, String triggerGroup, String cronExpression)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºè§¦å‘å™¨å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">        TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroup);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¡¨è¾¾å¼æ„å»ºå™¨(åŠ¨æ€ä¿®æ”¹åä¸ç«‹å³æ‰§è¡Œ)</span></span><br><span class="line">        CronScheduleBuilder cronScheduler = CronScheduleBuilder.cronSchedule(cronExpression)</span><br><span class="line">                .withMisfireHandlingInstructionDoNothing();</span><br><span class="line">        <span class="comment">// è·å–cronç±»å‹è§¦å‘å™¨</span></span><br><span class="line">        CronTrigger trigger = (CronTrigger) scheduler.getTrigger(triggerKey);</span><br><span class="line">        <span class="comment">// æŒ‰ç…§æ–°çš„cronè¡¨è¾¾å¼é‡æ–°æ„å»ºè§¦å‘å™¨</span></span><br><span class="line">        trigger = trigger.getTriggerBuilder().withIdentity(triggerKey)</span><br><span class="line">                .withSchedule(cronScheduler)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// æŒ‰æ–°çš„triggeré‡æ–°è®¾ç½®jobæ‰§è¡Œ</span></span><br><span class="line">        scheduler.rescheduleJob(triggerKey, trigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ResponseQuartzInfoVO&gt; <span class="title">queryJobList</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> quartzMapper.queryJobList();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ä»»åŠ¡åå’Œä»»åŠ¡ç»„æŸ¥è¯¢ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseQuartzInfoVO <span class="title">queryJobByNameAndGroup</span><span class="params">(String jobName, String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> quartzMapper.queryJobByNameAndGroup(jobName, jobGroup);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„è·å–ç±»(å…¨éƒ¨è¿›è¡Œå¼ºåˆ¶è½¬æ¢æˆBaseJobå®ç°æ¥å£)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> className å®Œæ•´ç±»è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç±»å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BaseJob <span class="title">reflectClass</span><span class="params">(String className)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">return</span> (BaseJob) Class.forName(className).newInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é¡µé¢æ•ˆæœ"><a href="#é¡µé¢æ•ˆæœ" class="headerlink" title="é¡µé¢æ•ˆæœ"></a>é¡µé¢æ•ˆæœ</h3><h4 id="ä»»åŠ¡åˆ—è¡¨"><a href="#ä»»åŠ¡åˆ—è¡¨" class="headerlink" title="ä»»åŠ¡åˆ—è¡¨"></a>ä»»åŠ¡åˆ—è¡¨</h4><p><img src="https://i.loli.net/2021/05/31/HCqkTzJWA91O4f2.png" alt="ä»»åŠ¡åˆ—è¡¨"></p>
<h4 id="ä»»åŠ¡åˆ›å»º"><a href="#ä»»åŠ¡åˆ›å»º" class="headerlink" title="ä»»åŠ¡åˆ›å»º"></a>ä»»åŠ¡åˆ›å»º</h4><p><img src="https://i.loli.net/2021/05/31/VtLA59KvrTJfMd8.png" alt="ä»»åŠ¡åˆ›å»ºæ›´æ–°"></p>
<h4 id=""><a href="#" class="headerlink" title=" "></a> </h4>]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Job</tag>
        <tag>Quartz</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆRabbitMQ</title>
    <url>/post/43860.html</url>
    <content><![CDATA[<h1 id="SpringBootæ•´åˆRabbitMQ"><a href="#SpringBootæ•´åˆRabbitMQ" class="headerlink" title="SpringBootæ•´åˆRabbitMQ"></a>SpringBootæ•´åˆRabbitMQ</h1><blockquote>
<p>ä¸»è¦å®ç°RabbitMQä»¥ä¸‹ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<ul>
<li>ç®€å•æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ¼”ç¤ºdirectæ¨¡å¼ï¼‰</li>
<li>åŸºäºRabbitMQç‰¹æ€§çš„å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>åŸºäºRabbitMQç›¸å…³æ’ä»¶çš„å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—</li>
</ul>
</blockquote>
<h2 id="å…¬å…±èµ„æº"><a href="#å…¬å…±èµ„æº" class="headerlink" title="å…¬å…±èµ„æº"></a>å…¬å…±èµ„æº</h2><h3 id="1-å¼•å…¥pomä¾èµ–"><a href="#1-å¼•å…¥pomä¾èµ–" class="headerlink" title="1. å¼•å…¥pomä¾èµ–"></a>1. å¼•å…¥pomä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-é…ç½®ymlæ–‡ä»¶"><a href="#2-é…ç½®ymlæ–‡ä»¶" class="headerlink" title="2. é…ç½®ymlæ–‡ä»¶"></a>2. é…ç½®ymlæ–‡ä»¶</h3><blockquote>
<p>åŸºäºä¸Šç¯‡ã€ŠRabbitMQå®‰è£…ä¸é…ç½®ã€‹å®ç°çš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒåŸºç¡€é…ç½®ã€‚</p>
</blockquote>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">121.5</span><span class="number">.168</span><span class="number">.31</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span>    <span class="comment"># é»˜è®¤å¯çœç•¥</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/***</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">***</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">***</span> <span class="comment"># ç”¨æˆ·å¯†ç </span></span><br><span class="line">    <span class="comment"># å¼€å¯æŠ•é€’æˆåŠŸå›è°ƒ P -&gt; Exchange</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br><span class="line">    <span class="comment"># å¼€å¯æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—å¤±è´¥å›è°ƒ Exchange -&gt; Queue</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># å¼€å¯æ‰‹åŠ¨ACKç¡®è®¤æ¨¡å¼ Queue -&gt; C</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span> <span class="comment"># ä»£è¡¨æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">        <span class="comment"># ä¸€äº›åŸºæœ¬å‚æ•°çš„è®¾ç½®</span></span><br><span class="line">        <span class="attr">concurrency:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">15</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">max-attempts:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">max-concurrency:</span> <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-å…¬å…±Constantsç±»"><a href="#3-å…¬å…±Constantsç±»" class="headerlink" title="3. å…¬å…±Constantsç±»"></a>3. å…¬å…±Constantsç±»</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/23 15:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ä¸ªé…ç½®Queue,Exchange,Key(éæ³¨è§£æ–¹å¼)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_SIMPLE_QUEUE = <span class="string">"HORSE_SIMPLE_QUEUE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_SIMPLE_EXCHANGE = <span class="string">"HORSE_SIMPLE_EXCHANGE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_SIMPLE_KEY = <span class="string">"HORSE_SIMPLE_KEY"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬äºŒä¸ªé…ç½®Queue,Exchange,Keyï¼ˆæ³¨è§£æ–¹å¼ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_ANNOTATION_QUEUE = <span class="string">"HORSE_ANNOTATION_QUEUE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_ANNOTATION_EXCHANGE = <span class="string">"HORSE_ANNOTATION_EXCHANGE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_ANNOTATION_KEY = <span class="string">"HORSE_ANNOTATION_KEY"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//************************************å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—é…ç½®ä¿¡æ¯**************************</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»¶æ—¶é˜Ÿåˆ—ä¿¡æ¯é…ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DELAY_EXCHANGE = <span class="string">"HORSE_DELAY_EXCHANGE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DELAY_QUEUE = <span class="string">"HORSE_DELAY_QUEUE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DELAY_KEY = <span class="string">"HORSE_DELAY_KEY"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DEAD_EXCHANGE = <span class="string">"HORSE_DEAD_EXCHANGE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DEAD_QUEUE = <span class="string">"HORSE_DEAD_QUEUE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_DEAD_KEY = <span class="string">"HORSE_DEAD_KEY"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//**************************************å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—é…ç½®ä¿¡æ¯(æ’ä»¶ç‰ˆ)******************************</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å»¶æ—¶é˜Ÿåˆ—ä¿¡æ¯é…ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_PLUGIN_EXCHANGE = <span class="string">"HORSE_PLUGIN_EXCHANGE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_PLUGIN_QUEUE = <span class="string">"HORSE_PLUGIN_QUEUE"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HORSE_PLUGIN_KEY = <span class="string">"HORSE_PLUGIN_KEY"</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ç®€å•æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆdirectæ¨¡å¼ï¼‰"><a href="#ç®€å•æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆdirectæ¨¡å¼ï¼‰" class="headerlink" title="ç®€å•æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆdirectæ¨¡å¼ï¼‰"></a>ç®€å•æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆdirectæ¨¡å¼ï¼‰</h2><h3 id="4-RabbitTemplateæ¨¡æ¿é…ç½®"><a href="#4-RabbitTemplateæ¨¡æ¿é…ç½®" class="headerlink" title="4. RabbitTemplateæ¨¡æ¿é…ç½®"></a>4. RabbitTemplateæ¨¡æ¿é…ç½®</h3><blockquote>
<p>ä¸»è¦å®šä¹‰æ¶ˆæ¯æŠ•é€’ExchangeæˆåŠŸå›è°ƒå‡½æ•°å’Œæ¶ˆæ¯ä»ExchangeæŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥çš„å›è°ƒå‡½æ•°ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.topsun.rabbit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.operations.Bool;</span><br><span class="line"><span class="keyword">import</span> com.topsun.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CachingConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/23 14:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(RabbitConfig.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CachingConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RabbitTemplate <span class="title">rabbitTemplate</span><span class="params">()</span> </span>{</span><br><span class="line">        RabbitTemplate rabbitTemplate = <span class="keyword">new</span> RabbitTemplate(connectionFactory);</span><br><span class="line">        <span class="comment">// è§¦å‘setReturnCallbackå›è°ƒå¿…é¡»è®¾ç½®mandatory=true,å¦åˆ™Exchangeæ²¡æœ‰æ‰¾åˆ°Queueå°±ä¼šä¸¢å¼ƒæ‰æ¶ˆæ¯, è€Œä¸ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line">        rabbitTemplate.setMandatory(Boolean.TRUE);</span><br><span class="line">        <span class="comment">// è®¾ç½®åºåˆ—åŒ–æœºåˆ¶</span></span><br><span class="line">        rabbitTemplate.setMessageConverter(<span class="keyword">new</span> Jackson2JsonMessageConverter());</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯ç”±æŠ•é€’åˆ°Exchangeä¸­æ—¶è§¦å‘çš„å›è°ƒ</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt;</span><br><span class="line">                logger.info(<span class="string">"æ¶ˆæ¯å‘é€åˆ°Exchangeæƒ…å†µåé¦ˆ:å”¯ä¸€æ ‡è¯†ï¼šcorrelationData={},æ¶ˆæ¯ç¡®è®¤ï¼šack={},åŸå› ï¼šcause={}"</span>,</span><br><span class="line">                        correlationData, ack, cause)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯ç”±Exchangeå‘é€åˆ°Queueæ—¶å¤±è´¥è§¦å‘çš„å›è°ƒ</span></span><br><span class="line">        rabbitTemplate.setReturnsCallback((returnedMessage) -&gt; {</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯æ’ä»¶å½¢å¼å®ç°çš„å»¶æ—¶é˜Ÿåˆ—,åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="comment">// åŸå› : å› ä¸ºå‘é€æ–¹ç¡®å®æ²¡æœ‰æŠ•é€’åˆ°é˜Ÿåˆ—ä¸Šï¼Œåªæ˜¯åœ¨äº¤æ¢å™¨ä¸Šæš‚å­˜ï¼Œç­‰è¿‡æœŸæ—¶é—´åˆ°äº† æ‰ä¼šå‘å¾€é˜Ÿåˆ—,ä»è€Œå®ç°å»¶æ—¶é˜Ÿåˆ—çš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (Constants.HORSE_PLUGIN_EXCHANGE.equals(returnedMessage.getExchange())) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            logger.warn(<span class="string">"æ¶ˆæ¯ç”±Exchangeå‘é€åˆ°Queueæ—¶å¤±è´¥:message={},replyCode={},replyText={},exchange={},rountingKey={}"</span>,</span><br><span class="line">                    returnedMessage.getMessage(), returnedMessage.getReplyText(), returnedMessage.getReplyText(),</span><br><span class="line">                    returnedMessage.getExchange(), returnedMessage.getRoutingKey());</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//*******************************************ç›´æ¥é…ç½®ç»‘å®šå…³ç³»*****************************************</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">horseQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(Constants.HORSE_SIMPLE_QUEUE, Boolean.TRUE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æŒ‡å®šæ¨¡å¼äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">horseExchange</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(Constants.HORSE_SIMPLE_EXCHANGE, Boolean.TRUE, Boolean.FALSE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šäº¤æ¢æœº,é˜Ÿåˆ—,è·¯ç”±Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">horseBinding</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(horseQueue()).to(horseExchange()).with(Constants.HORSE_SIMPLE_KEY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-å®šä¹‰æ¶ˆæ¯ç›‘å¬å™¨"><a href="#5-å®šä¹‰æ¶ˆæ¯ç›‘å¬å™¨" class="headerlink" title="5. å®šä¹‰æ¶ˆæ¯ç›‘å¬å™¨"></a>5. å®šä¹‰æ¶ˆæ¯ç›‘å¬å™¨</h3><blockquote>
<p>åŸºäº<code>@RabbitListenerzi</code>æ³¨è§£ï¼Œå®ç°è‡ªå®šä¹‰æ¶ˆæ¯ç›‘å¬å™¨ã€‚ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>å¦‚æœåœ¨é…ç½®ç±»ä¸­å£°æ˜äº†Queueã€Excehangeä»¥åŠä»–ä»¬ç›´æ¥çš„ç»‘å®šï¼Œè¿™é‡Œç›´æ¥æŒ‡å®šé˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯ç›‘å¬</li>
<li>å¦‚æœå‰é¢ä»€ä¹ˆä¹Ÿæ²¡åšï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œç»‘å®šå®ç°æ¶ˆæ¯ç›‘å¬</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.topsun.rabbit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.topsun.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/23 14:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(MsgListener.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½®ç±»ä¸­å·²ç»å®Œæˆç»‘å®š,è¿™é‡Œç›´æ¥æ ¹æ®é˜Ÿåˆ—å€¼æ¥æ”¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListenerzi(queues = Constants.HORSE_SIMPLE_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customListener</span><span class="params">(Message message, Channel channel, String msg)</span> </span>{</span><br><span class="line">        <span class="comment">// è·å–æ¯æ¡æ¶ˆæ¯å”¯ä¸€æ ‡è¯†(ç”¨äºæ‰‹åŠ¨ACKç¡®è®¤)</span></span><br><span class="line">        <span class="keyword">long</span> tag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; customListeneræ¥æ”¶"</span> + msg);</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">            channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">" ==&gt; æ¶ˆæ¯æ¥æ”¶å¤±è´¥: {}"</span>, tag);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ³¨è§£çš„å½¢å¼è¿›è¡Œç»‘å®šæ¥æ”¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = Constants.HORSE_ANNOTATION_QUEUE, durable = "true"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = Constants.HORSE_ANNOTATION_EXCHANGE, ignoreDeclarationExceptions = "true"),</span></span><br><span class="line"><span class="meta">            key = {Constants.HORSE_ANNOTATION_KEY}</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">annotationListener</span><span class="params">(Message message, Channel channel, String msg)</span> </span>{</span><br><span class="line">        <span class="comment">// è·å–æ¯æ¡æ¶ˆæ¯å”¯ä¸€æ ‡è¯†(ç”¨äºæ‰‹åŠ¨ACKç¡®è®¤)</span></span><br><span class="line">        <span class="keyword">long</span> tag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; annotationListeneræ¥æ”¶"</span> + msg);</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">            channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">" ==&gt; æ¶ˆæ¯æ¥æ”¶å¤±è´¥: {}"</span>, tag);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-æµ‹è¯•æ¥å£"><a href="#6-æµ‹è¯•æ¥å£" class="headerlink" title="6. æµ‹è¯•æ¥å£"></a>6. æµ‹è¯•æ¥å£</h3><blockquote>
<p>è¿™é‡Œå‘é€100æ¡æ¶ˆæ¯ï¼š</p>
<ul>
<li>å¥‡æ•°æ¡åˆ°éæ³¨è§£æ–¹å¼çš„æ¶ˆæ¯ç›‘å¬å™¨</li>
<li>å¶æ•°æ¡åˆ°æ³¨è§£å¼æ¶ˆæ¯ç›‘å¬å™¨</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/rabbit")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) {</span><br><span class="line">            String msg = <span class="string">"ç¬¬"</span> + i + <span class="string">"æ¡æ¶ˆæ¯"</span>;</span><br><span class="line">            logger.info(<span class="string">"==&gt; å‘é€"</span> + msg);</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) {</span><br><span class="line">                rabbitTemplate.convertAndSend(Constants.HORSE_SIMPLE_EXCHANGE, Constants.HORSE_SIMPLE_KEY, msg, <span class="keyword">new</span> CorrelationData(String.valueOf(i)));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                rabbitTemplate.convertAndSend(Constants.HORSE_ANNOTATION_EXCHANGE, Constants.HORSE_ANNOTATION_KEY, msg, <span class="keyword">new</span> CorrelationData(String.valueOf(i)));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>ç»“æœï¼šè‡ªè¡Œæµ‹è¯•è¿‡ï¼Œéå¸¸æˆåŠŸ<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
<h2 id="å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—"><a href="#å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—"></a>å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—</h2><blockquote>
<p>åŸç†ï¼šç”Ÿäº§è€…ç”Ÿäº§ä¸€æ¡å»¶æ—¶æ¶ˆæ¯ï¼Œæ ¹æ®éœ€è¦å»¶æ—¶æ—¶é—´çš„ä¸åŒï¼Œåˆ©ç”¨ä¸åŒçš„routingkeyå°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„å»¶æ—¶é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è®¾ç½®äº†ä¸åŒçš„TTLå±æ€§ï¼Œå¹¶ç»‘å®šåœ¨åŒä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºä¸­ï¼Œæ¶ˆæ¯è¿‡æœŸåï¼Œæ ¹æ®routingkeyçš„ä¸åŒï¼Œåˆä¼šè¢«è·¯ç”±åˆ°ä¸åŒçš„æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…åªéœ€è¦ç›‘å¬å¯¹åº”çš„æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œå¤„ç†å³å¯ã€‚</p>
</blockquote>
<h3 id="7-é…ç½®ç»‘å®šç›¸å…³ä¿¡æ¯"><a href="#7-é…ç½®ç»‘å®šç›¸å…³ä¿¡æ¯" class="headerlink" title="7. é…ç½®ç»‘å®šç›¸å…³ä¿¡æ¯"></a>7. é…ç½®ç»‘å®šç›¸å…³ä¿¡æ¯</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/24 14:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayRabbitConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(DelayRabbitConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜å»¶æ—¶é˜Ÿåˆ—äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">delayExchange</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(Constants.HORSE_DELAY_EXCHANGE, Boolean.TRUE, Boolean.FALSE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">deadExchange</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(Constants.HORSE_DEAD_EXCHANGE, Boolean.TRUE, Boolean.FALSE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜å»¶æ—¶é˜Ÿåˆ— å»¶æ—¶10s(å•ä½:ms),å¹¶å°†å»¶æ—¶é˜Ÿåˆ—ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœºå’Œè·¯ç”±Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">delayQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// x-dead-letter-exchange    è¿™é‡Œå£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        args.put(<span class="string">"x-dead-letter-exchange"</span>, Constants.HORSE_DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">// x-dead-letter-routing-key  è¿™é‡Œå£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”±key</span></span><br><span class="line">        args.put(<span class="string">"x-dead-letter-routing-key"</span>, Constants.HORSE_DEAD_KEY);</span><br><span class="line">        <span class="comment">// x-message-ttl  å£°æ˜é˜Ÿåˆ—çš„TTL(è¿‡æœŸæ—¶é—´)</span></span><br><span class="line">        <span class="comment">// å¯ä»¥åœ¨è¿™é‡Œç›´æ¥å†™æ­»ï¼Œä¹Ÿå¯ä»¥è¿›è¡ŒåŠ¨æ€çš„è®¾ç½®ï¼ˆæ¨èåŠ¨æ€è®¾ç½®ï¼‰</span></span><br><span class="line">        <span class="comment">// args.put("x-message-ttl", 10000);</span></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(Constants.HORSE_DELAY_QUEUE).withArguments(args).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">deadQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(Constants.HORSE_DEAD_QUEUE, Boolean.TRUE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»¶æ—¶é˜Ÿåˆ—ç»‘å®šç®¡ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">delayBinding</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayQueue()).to(delayExchange()).with(Constants.HORSE_DELAY_KEY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šç®¡ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">deadBinding</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(deadQueue()).to(deadExchange()).with(Constants.HORSE_DEAD_KEY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//**********************************å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—é…ç½®ä¿¡æ¯(æ’ä»¶ç‰ˆ)************************************</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">pluginQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(Constants.HORSE_PLUGIN_QUEUE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å»¶æ—¶é˜Ÿåˆ—çš„äº¤æ¢æœºï¼Œå¿…é¡»æ˜¯ CustomExchange ç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * å‚æ•°å¿…é¡»ï¼Œä¸èƒ½æ”¹å˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomExchange <span class="title">customPluginExchange</span><span class="params">()</span> </span>{</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        args.put(<span class="string">"x-delayed-type"</span>, <span class="string">"direct"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomExchange(Constants.HORSE_PLUGIN_EXCHANGE, <span class="string">"x-delayed-message"</span>, Boolean.TRUE, Boolean.FALSE, args);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">pluginBinding</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(pluginQueue()).to(customPluginExchange()).with(Constants.HORSE_PLUGIN_KEY).noargs();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="8-å®šä¹‰å»¶æ—¶ç›‘å¬å™¨"><a href="#8-å®šä¹‰å»¶æ—¶ç›‘å¬å™¨" class="headerlink" title="8. å®šä¹‰å»¶æ—¶ç›‘å¬å™¨"></a>8. å®šä¹‰å»¶æ—¶ç›‘å¬å™¨</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/24 14:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayMsgListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(DelayMsgListener.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = Constants.HORSE_DEAD_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumeDeadListener</span><span class="params">(Message message, Channel channel, String msg)</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> tag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; consumeDeadListeneræ¥æ”¶"</span> + msg);</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">            channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">" ==&gt; æ¶ˆæ¯æ¥æ”¶å¤±è´¥: {}"</span>, tag);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬å»¶æ—¶é˜Ÿåˆ—(æ’ä»¶ç‰ˆ)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = Constants.HORSE_PLUGIN_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumePluginListener</span><span class="params">(Message message, Channel channel, String msg)</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> tag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            logger.info(<span class="string">" ==&gt; consumePluginListener"</span> + msg);</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">            channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">" ==&gt; æ¶ˆæ¯æ¥æ”¶å¤±è´¥: {}"</span>, tag);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="9-æµ‹è¯•æ¥å£"><a href="#9-æµ‹è¯•æ¥å£" class="headerlink" title="9. æµ‹è¯•æ¥å£"></a>9. æµ‹è¯•æ¥å£</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="comment">// åŸºäºç‰¹æ€§çš„å»¶æ—¶é˜Ÿåˆ—</span></span><br><span class="line"><span class="meta">@GetMapping("/delay/rabbit")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delayMsg</span><span class="params">(<span class="meta">@RequestParam("expire")</span> Long expire)</span> </span>{</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) {</span><br><span class="line">           String msg = <span class="string">"ç¬¬"</span> + i + <span class="string">"æ¡æ¶ˆæ¯"</span>;</span><br><span class="line">           logger.info(<span class="string">"==&gt; å‘é€"</span> + msg);</span><br><span class="line">           <span class="comment">// è¿™é‡Œå¯ä»¥åŠ¨æ€çš„è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">           rabbitTemplate.convertAndSend(Constants.HORSE_DELAY_EXCHANGE, Constants.HORSE_DELAY_KEY, msg,</span><br><span class="line">                   message -&gt; {</span><br><span class="line">                       message.getMessageProperties().setExpiration(String.valueOf(expire));</span><br><span class="line">                       <span class="keyword">return</span> message;</span><br><span class="line">                   },</span><br><span class="line">                   <span class="keyword">new</span> CorrelationData(String.valueOf(i)));</span><br><span class="line">       }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºäºæ’ä»¶çš„å»¶æ—¶é˜Ÿåˆ—</span></span><br><span class="line">   <span class="meta">@GetMapping("/delay/plugin")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delayPluginMsg</span><span class="params">(<span class="meta">@RequestParam("expire")</span> Integer expire)</span> </span>{</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) {</span><br><span class="line">           String msg = <span class="string">"ç¬¬"</span> + i + <span class="string">"æ¡æ¶ˆæ¯"</span>;</span><br><span class="line">           logger.info(<span class="string">"==&gt; å‘é€"</span> + msg);</span><br><span class="line">           <span class="comment">// åŠ¨æ€è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">           rabbitTemplate.convertAndSend(Constants.HORSE_PLUGIN_EXCHANGE, Constants.HORSE_PLUGIN_KEY, msg, message -&gt; {</span><br><span class="line">               message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);</span><br><span class="line">               message.getMessageProperties().setDelay(expire);</span><br><span class="line">               <span class="keyword">return</span> message;</span><br><span class="line">           }, <span class="keyword">new</span> CorrelationData(String.valueOf(i)));</span><br><span class="line"></span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>RabbitMQçš„åŸºç¡€ä½¿ç”¨æ¼”ç¤ºåˆ°æ­¤ç»“æŸã€‚</p>
<h2 id="RabbitMQå®‰è£…å»¶æ—¶æ’ä»¶"><a href="#RabbitMQå®‰è£…å»¶æ—¶æ’ä»¶" class="headerlink" title="RabbitMQå®‰è£…å»¶æ—¶æ’ä»¶"></a>RabbitMQå®‰è£…å»¶æ—¶æ’ä»¶</h2><blockquote>
<p>ç¤ºä¾‹æ¼”ç¤ºç¯å¢ƒï¼šDockerå®‰è£…çš„RabbitMQæœåŠ¡</p>
</blockquote>
<h3 id="æ’ä»¶ä¸‹è½½"><a href="#æ’ä»¶ä¸‹è½½" class="headerlink" title="æ’ä»¶ä¸‹è½½"></a>æ’ä»¶ä¸‹è½½</h3><blockquote>
<p><a href="[Community Plugins â€” RabbitMQ](https://www.rabbitmq.com/community-plugins.html">å»¶æ—¶æ’ä»¶ç‚¹å‡»ä¸‹è½½</a>)</p>
</blockquote>
<p><img src="https://i.loli.net/2021/05/27/nkYDxtPdCaSOMeW.png" alt="image-20210527175811822"></p>
<h3 id="è¿›å…¥RabbitMQå®¹å™¨"><a href="#è¿›å…¥RabbitMQå®¹å™¨" class="headerlink" title="è¿›å…¥RabbitMQå®¹å™¨"></a>è¿›å…¥RabbitMQå®¹å™¨</h3><blockquote>
<ul>
<li>è¿›å…¥æ­£åœ¨è¿è¡Œçš„RabbitMQå®¹å™¨ï¼ŒæŸ¥çœ‹RabbitMQçš„æ’ä»¶åˆ—è¡¨æ˜¯å¦å·²å®‰è£…æœ‰<code>å»¶æ—¶æ’ä»¶</code></li>
<li>æŠŠä¸‹è½½çš„æ’ä»¶å¤åˆ¶åˆ°<code>plugins</code>ç›®å½•ä¸‹</li>
</ul>
</blockquote>
<h4 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse lib]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED      STATUS      PORTS                                                                                                                                                 NAMES</span><br><span class="line">abe759d645e4   rabbitmq:3.8.14-management   <span class="string">"docker-entrypoint.sâ€¦"</span>   2 days ago   Up 2 days   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   horse-rabbitmq</span><br><span class="line">[root@horse lib]<span class="comment"># docker exec -it abe759d645e4 /bin/bash</span></span><br><span class="line">root@abe759d645e4:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  plugins  root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   media  opt  proc     run   srv   tmp  var</span><br><span class="line">root@abe759d645e4:/<span class="comment"># cd plugins</span></span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># ls -l</span></span><br><span class="line">total 17640</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq      59 Mar  2 16:09 README</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   13408 Mar  2 16:09 accept-0.3.5.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  106760 Mar  2 16:09 amqp10_client-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   45013 Mar  2 16:09 amqp10_common-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  414492 Mar  2 16:09 amqp_client-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   19781 Mar  2 16:09 aten-0.5.5.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq    3193 Mar  2 16:09 base64url-0.0.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  291018 Mar  2 16:09 cowboy-2.8.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  644412 Mar  2 16:09 cowlib-2.9.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   18562 Mar  2 16:09 credentials_obfuscation-2.4.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  187264 Mar  2 16:09 cuttlefish-2.6.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq 2486967 Mar  2 16:09 eetcd-0.3.3.ez</span><br><span class="line">-rw-r----- 1 root     root     3926464 May 27 09:51 erl_crash.dump</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   13844 Mar  2 16:09 gen_batch_server-0.8.4.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   69315 Mar  2 16:09 goldrush-0.1.9.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   97368 Mar  2 16:09 gun-1.3.3.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  831315 Mar  2 16:09 jose-1.11.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   99028 Mar  2 16:09 jsx-2.11.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  234145 Mar  2 16:09 lager-3.8.2.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  167726 Mar  2 16:09 observer_cli-1.6.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  223845 Mar  2 16:09 prometheus-4.6.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  388155 Mar  2 16:09 ra-1.1.8.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq 2640559 Mar  2 16:09 rabbit-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  799921 Mar  2 16:09 rabbit_common-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  257032 Mar  2 16:09 rabbitmq_amqp1_0-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   33708 Mar  2 16:09 rabbitmq_auth_backend_cache-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   17104 Mar  2 16:09 rabbitmq_auth_backend_http-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   53028 Mar  2 16:09 rabbitmq_auth_backend_ldap-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   52185 Mar  2 16:09 rabbitmq_auth_backend_oauth2-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   24363 Mar  2 16:09 rabbitmq_auth_mechanism_ssl-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   61855 Mar  2 16:09 rabbitmq_aws-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   35453 Mar  2 16:09 rabbitmq_consistent_hash_exchange-3.8.14.ez</span><br><span class="line">-rw-rw-rw- 1 root     root       43377 May 27 09:47 rabbitmq_delayed_message_exchange-3.8.0.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   27443 Mar  2 16:09 rabbitmq_event_exchange-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  261989 Mar  2 16:09 rabbitmq_federation-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   14731 Mar  2 16:09 rabbitmq_federation_management-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   26567 Mar  2 16:09 rabbitmq_jms_topic_exchange-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq 1286172 Mar  2 16:09 rabbitmq_management-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  189852 Mar  2 16:09 rabbitmq_management_agent-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  202956 Mar  2 16:09 rabbitmq_mqtt-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   28493 Mar  2 16:09 rabbitmq_peer_discovery_aws-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   58885 Mar  2 16:09 rabbitmq_peer_discovery_common-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   55973 Mar  2 16:09 rabbitmq_peer_discovery_consul-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   55273 Mar  2 16:09 rabbitmq_peer_discovery_etcd-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   30942 Mar  2 16:09 rabbitmq_peer_discovery_k8s-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   98941 Mar  2 16:09 rabbitmq_prelaunch-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   51254 Mar  2 16:09 rabbitmq_prometheus-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq    7624 Mar  2 16:09 rabbitmq_random_exchange-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   18875 Mar  2 16:09 rabbitmq_recent_history_exchange-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   49522 Mar  2 16:09 rabbitmq_sharding-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  205297 Mar  2 16:09 rabbitmq_shovel-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   27436 Mar  2 16:09 rabbitmq_shovel_management-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq  152417 Mar  2 16:09 rabbitmq_stomp-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   72740 Mar  2 16:09 rabbitmq_top-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   67968 Mar  2 16:09 rabbitmq_tracing-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   86263 Mar  2 16:09 rabbitmq_trust_store-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   49239 Mar  2 16:09 rabbitmq_web_dispatch-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   49063 Mar  2 16:09 rabbitmq_web_mqtt-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   66578 Mar  2 16:09 rabbitmq_web_mqtt_examples-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   53235 Mar  2 16:09 rabbitmq_web_stomp-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   52246 Mar  2 16:09 rabbitmq_web_stomp_examples-3.8.14.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   89840 Mar  2 16:09 ranch-1.7.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   77407 Mar  2 16:09 recon-2.5.1.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   47497 Mar  2 16:09 stdout_formatter-0.2.4.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   56943 Mar  2 16:09 syslog-3.4.5.ez</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   17588 Mar  2 16:09 sysmon_handler-1.3.0.ez</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¤åˆ¶ç§»åŠ¨æ’ä»¶"><a href="#å¤åˆ¶ç§»åŠ¨æ’ä»¶" class="headerlink" title="å¤åˆ¶ç§»åŠ¨æ’ä»¶"></a>å¤åˆ¶ç§»åŠ¨æ’ä»¶</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">docker cp /tmp/installPackage/rabbitmq_delayed_message_exchange-3.8.0.ez abe759d645e4:/plugins/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å¤åˆ¶æˆåŠŸ</span></span><br><span class="line">[root@horse /]<span class="comment"># docker exec -it abe759d645e4 /bin/bash</span></span><br><span class="line">root@abe759d645e4:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  plugins  root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   media  opt  proc     run   srv   tmp  var</span><br><span class="line">root@abe759d645e4:/<span class="comment"># cd plugins</span></span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># rabbitmq-plugins list</span></span><br><span class="line">Listing plugins with pattern <span class="string">".*"</span> ...</span><br><span class="line"> Configured: E = explicitly enabled; e = implicitly enabled</span><br><span class="line"> | Status: * = running on rabbit@abe759d645e4</span><br><span class="line"> |/</span><br><span class="line">[  ] rabbitmq_amqp1_0                  3.8.14</span><br><span class="line">[  ] rabbitmq_auth_backend_cache       3.8.14</span><br><span class="line">[  ] rabbitmq_auth_backend_http        3.8.14</span><br><span class="line">[  ] rabbitmq_auth_backend_ldap        3.8.14</span><br><span class="line">[  ] rabbitmq_auth_backend_oauth2      3.8.14</span><br><span class="line">[  ] rabbitmq_auth_mechanism_ssl       3.8.14</span><br><span class="line">[  ] rabbitmq_consistent_hash_exchange 3.8.14</span><br><span class="line"><span class="comment"># æ’ä»¶å·²å¤åˆ¶æˆåŠŸ</span></span><br><span class="line">[E*] rabbitmq_delayed_message_exchange 3.8.0</span><br><span class="line">[  ] rabbitmq_event_exchange           3.8.14</span><br><span class="line">[  ] rabbitmq_federation               3.8.14</span><br><span class="line">[  ] rabbitmq_federation_management    3.8.14</span><br><span class="line">[  ] rabbitmq_jms_topic_exchange       3.8.14</span><br><span class="line">[E*] rabbitmq_management               3.8.14</span><br><span class="line">[e*] rabbitmq_management_agent         3.8.14</span><br><span class="line">[  ] rabbitmq_mqtt                     3.8.14</span><br><span class="line">[  ] rabbitmq_peer_discovery_aws       3.8.14</span><br><span class="line">[  ] rabbitmq_peer_discovery_common    3.8.14</span><br><span class="line">[  ] rabbitmq_peer_discovery_consul    3.8.14</span><br><span class="line">[  ] rabbitmq_peer_discovery_etcd      3.8.14</span><br><span class="line">[  ] rabbitmq_peer_discovery_k8s       3.8.14</span><br><span class="line">[E*] rabbitmq_prometheus               3.8.14</span><br><span class="line">[  ] rabbitmq_random_exchange          3.8.14</span><br><span class="line">[  ] rabbitmq_recent_history_exchange  3.8.14</span><br><span class="line">[  ] rabbitmq_sharding                 3.8.14</span><br><span class="line">[  ] rabbitmq_shovel                   3.8.14</span><br><span class="line">[  ] rabbitmq_shovel_management        3.8.14</span><br><span class="line">[  ] rabbitmq_stomp                    3.8.14</span><br><span class="line">[  ] rabbitmq_top                      3.8.14</span><br><span class="line">[  ] rabbitmq_tracing                  3.8.14</span><br><span class="line">[  ] rabbitmq_trust_store              3.8.14</span><br><span class="line">[e*] rabbitmq_web_dispatch             3.8.14</span><br><span class="line">[  ] rabbitmq_web_mqtt                 3.8.14</span><br><span class="line">[  ] rabbitmq_web_mqtt_examples        3.8.14</span><br><span class="line">[  ] rabbitmq_web_stomp                3.8.14</span><br><span class="line">[  ] rabbitmq_web_stomp_examples       3.8.14</span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¼€å¯æ’ä»¶æœåŠ¡"><a href="#å¼€å¯æ’ä»¶æœåŠ¡" class="headerlink" title="å¼€å¯æ’ä»¶æœåŠ¡"></a>å¼€å¯æ’ä»¶æœåŠ¡</h3><blockquote>
<p>åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œä¸€ä¸‹ï¼Œé¿å…å‡ºé”™</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æ’ä»¶</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_delayed_message_exchange</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹"><a href="#å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹" class="headerlink" title="å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹"></a>å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹</h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210527201850.png" alt="image-20210527201840273"></p>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•´åˆæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜</title>
    <url>/post/58048.html</url>
    <content><![CDATA[<h2 id="SpringBootæ•´åˆæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜"><a href="#SpringBootæ•´åˆæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜" class="headerlink" title="SpringBootæ•´åˆæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜"></a>SpringBootæ•´åˆæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜</h2><blockquote>
<p>åŸºäºæ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼Œä½¿ç”¨æ²™ç®±ç¯å¢ƒè¿›è¡Œæ•´åˆæ“ä½œã€‚</p>
</blockquote>
<h3 id="å¼•å…¥SDKæ–‡ä»¶"><a href="#å¼•å…¥SDKæ–‡ä»¶" class="headerlink" title="å¼•å…¥SDKæ–‡ä»¶"></a>å¼•å…¥SDKæ–‡ä»¶</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ”¯ä»˜å®SDK--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.50.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é…ç½®ymlä¿¡æ¯"><a href="#é…ç½®ymlä¿¡æ¯" class="headerlink" title="é…ç½®ymlä¿¡æ¯"></a>é…ç½®ymlä¿¡æ¯</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ”¯ä»˜å®é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="attr">alipay:</span></span><br><span class="line">  <span class="attr">serverUrl:</span> <span class="string">https://openapi.alipaydev.com/gateway.do</span></span><br><span class="line">  <span class="attr">appId:</span> <span class="number">202100011766</span><span class="string">****</span></span><br><span class="line">  <span class="attr">privateKey:</span> <span class="string">MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCHOOTPFoXOeGcZgYKwXrJmh1rN6A6OlXVM6K7Qm7StJx4A6mA+lXTDbJsJl4SXpDur1UZv6I51JzEn3VUPCZeHrdWdemB1sgRo4JC5HJdj0Z3jIueevodtKe2nPMFFhFfhEfJYZucbfOnx0TCdEavlRw2HByv3Y4pYvBBqi0m2icp6dC3aixg9+EruSq5civSofIfwgTlFrcF+JuCWi1LGU3ySiRAHa6STatHLHMlVJjHHJvG4UNRKDwjSkcFhH0CSBGeNGQBMNs2My8OWZg1CwvNenXVfM9PE2zo8QoXLTs0FrY2mg9zSuJUrHKbudCbVS9qTsee4ChQtmjijk/oVAgMBAAECggEAIAbHmoy5EFfQA2h7LY6gLkxso0wM9pRLffW2Qc4/EqurHYhlVy1KxGZaqgDq9Id/YolW73ZjFzg7Gjf/x1n8O7ReXbf4VKffB3/4hv9Qk+G3xW4k8aIqrR47HVr0Y6Ses73uaiWlIwuI1S84llrzHZCgkZSPQz6eK7oPIUzwHn1VnRL484/UX4+krNv0zn11DBmQN6eMKV7Wuuv3zrFkXMkYhJfVxLxQSFq6NO3lSlhixHZdCWt/tVrTv6jA+qDTAZmpiXlJqfXe6GUlCf8ap8BK4S6X+Ld5kZCDzTodiu4UCOY6+tXSuitXmXFZoV/UbiIEuyG3v4L9zNQOm1fYQQKBgQDrAZFViMWpqLTkkNjoF62T6lMQydg2khIB/dbqnkXYEVkBLfVcd1FDSudOFAYSeV9gt/xCaGg1l2yfuAUzicZeKPxMb/PNLcvFASJfsjwZz8okVv2jR7WBXWgy19AWw7RMncLgwtw9qt/CDEbYPlKlG8oOG61ZAHS1j3sYxAQAeQKBgQCTTVXuR2aiBHT5G+RWo4/FUp6O+ro7Y2/xFRCuxr2P2QHqS4kCF4HFx2Rd89ihz1A/pTtZyNMP0uKl40pGmlPPiR2PiKGaHJyQLWNv+mTJR5SWqpTAY9S0v+HFfeFRbK1adOAnrS68vmQxJiRtTZRMnmK2UQ36EIABonpfHcP3fQKBgHnlxEcDvNO2CK6OW5R3w7d30kJhEF+uAN07l+D22++pf+tWtXCTC3nGPpiHVmb6wfhfNuATXAqAUv297CTBkD2DMOtNHr8MxCeZ4QSWZQpWd9nFraamKYXCt6u3ud41AS7EnjMLoEX0fkAfMhg0q5WtBm+u94m07NTIaed8tT6xAoGABy7yTdh1jNkiyzMtA3yeekT5LofTpSnIP72DPsK6Y9V1XnOojs2OqpJ6too5ukpd43yvVEWS5WanXueiq6bDB4/sPR+woc9bYzyTaNaRK6+t81sGPgugR+BDplnpLwtZuNuSQt0TNmkigbMWe64Y2VOwBKwXPmanl2zRAup0sBECgYB8iJkG9Ldb8st4a2A81qBH1hjoiZv4Fjljcb3MojpoBLlZjKI6WBGJCHIarEX9LOZmudIPvEDNftnTw5kAb++2JDow0mlCEFdb6LXwgr/tLERbL5QV3HD4fSt3TLxUzq10UUduQ0iQ/tk9GG8tNrgepCI3J3qXNxvcT3AUk1****</span></span><br><span class="line">  <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">json</span></span><br><span class="line">  <span class="attr">signType:</span> <span class="string">RSA2</span></span><br><span class="line">  <span class="attr">returnUrl:</span> <span class="string">http://localhost:9528</span></span><br><span class="line">  <span class="attr">notifyUrl:</span> <span class="string">http://localhost:9528</span></span><br><span class="line">  <span class="attr">publicKey:</span> <span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5n5Wb/QsFgF5rSyNwpWcyHYUuHg7shVWTNzi9UM+1wsy6UulApMK5Zti6LsE4lae05IvpfckiLJI21JamSMd4z5IEAwzexSSX1YycqgSVIF5EFOveYUdVLYTjh4gOx7xsv6vtwULQ0rdVNjvCEX9RRpVOpnSAj2axq5sxVLho3sB55/o4Z6y2W8Giv1DRBGqYF+zV+gY/j/FTRVrsvGwW1eEQrtvin/e9oPByKIxY9ByW2JUcojYt+Bfk++rCy7MraZ1ylocK8lkqm2KpiVk4Zsv2fW4t65N8AZvbIy15py3xefy3PpAbYJZxIoMdqlQzEby73CitC+auIPTiAtR1QID****</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å±æ€§æ˜ å°„é…ç½®ç±»"><a href="#å±æ€§æ˜ å°„é…ç½®ç±»" class="headerlink" title="å±æ€§æ˜ å°„é…ç½®ç±»"></a>å±æ€§æ˜ å°„é…ç½®ç±»</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/25 10:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "alipay")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipayPropeties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœåŠ¡åœ°å€(æ”¯ä»˜å®ç½‘å…³)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String serverUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå·±çš„appId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String privateKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜å®å…¬é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String publicKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–ç æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String charset;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¼å¼åŒ–æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String format;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­¾è¯ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String signType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›è°ƒåœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String returnUrl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šçŸ¥åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String notifyUrl;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆå§‹åŒ–é…ç½®ç±»"><a href="#åˆå§‹åŒ–é…ç½®ç±»" class="headerlink" title="åˆå§‹åŒ–é…ç½®ç±»"></a>åˆå§‹åŒ–é…ç½®ç±»</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alipay.api.AlipayClient;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.DefaultAlipayClient;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.request.AlipayTradePagePayRequest;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.common.AlipayPropeties;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åˆå§‹åŒ–æ”¯ä»˜å®é…ç½®é¡¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/15 16:43</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAlipayConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlipayPropeties alipayPropeties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—åˆå§‹åŒ–çš„AlipayClient</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AlipayClient <span class="title">getAlipayClient</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultAlipayClient(alipayPropeties.getServerUrl(), alipayPropeties.getAppId(),</span><br><span class="line">                alipayPropeties.getPrivateKey(), alipayPropeties.getFormat(), alipayPropeties.getCharset(),</span><br><span class="line">                alipayPropeties.getPublicKey(), alipayPropeties.getSignType());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•é¡µé¢ç”Ÿæˆå¯¹åº”çš„requestè¯·æ±‚API</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AlipayTradePagePayRequest <span class="title">getAlipayTradePagePayRequest</span><span class="params">()</span> </span>{</span><br><span class="line">        AlipayTradePagePayRequest alipayRequest = <span class="keyword">new</span> AlipayTradePagePayRequest();</span><br><span class="line">        <span class="comment">//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è°ƒå’Œé€šçŸ¥åœ°å€</span></span><br><span class="line">        alipayRequest.setReturnUrl(alipayPropeties.getReturnUrl());</span><br><span class="line">        alipayRequest.setNotifyUrl(alipayPropeties.getNotifyUrl());</span><br><span class="line">        <span class="keyword">return</span> alipayRequest;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç”Ÿæˆè®¢å•å¹¶æ”¯ä»˜é€»è¾‘"><a href="#ç”Ÿæˆè®¢å•å¹¶æ”¯ä»˜é€»è¾‘" class="headerlink" title="ç”Ÿæˆè®¢å•å¹¶æ”¯ä»˜é€»è¾‘"></a>ç”Ÿæˆè®¢å•å¹¶æ”¯ä»˜é€»è¾‘</h3><blockquote>
<p>é¡µé¢ä¼ å…¥å¿…è¦ä¿¡æ¯ï¼Œå‘èµ·è¯·æ±‚ï¼Œæ ¹æ®å“åº”ä¿¡æ¯ï¼Œç”Ÿæˆä»˜æ¬¾ç½‘é¡µæˆ–è€…äºŒç»´ç </p>
</blockquote>
<p>å‚æ•°å®ä¾‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TradeVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4097767717541192097L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è®¢å•å·ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> Double amount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "æ–‡ç« IDä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> String blogId;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç”Ÿæˆé¡µé¢</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æäº¤è®¢å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> tradeVO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> ä»˜æ¬¾äºŒç»´ç </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">submitAlipayTrade</span><span class="params">(TradeVO tradeVO)</span> </span>{</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           <span class="comment">//è·å¾—åˆå§‹åŒ–çš„AlipayClient</span></span><br><span class="line">           AlipayClient alipayClient = alipayConfig.getAlipayClient();</span><br><span class="line">           <span class="comment">//åˆ›å»ºAPIå¯¹åº”çš„request</span></span><br><span class="line">           AlipayTradePagePayRequest alipayRequest = alipayConfig.getAlipayTradePagePayRequest();</span><br><span class="line">           <span class="comment">// è®¢å•å·</span></span><br><span class="line">           String orderId = tradeVO.getOrderId();</span><br><span class="line">           Double amount = tradeVO.getAmount();</span><br><span class="line">           log.info(<span class="string">"äº¤æ˜“è®¢å•å·: {},ä»˜æ¬¾é‡‘é¢: {}"</span>, orderId, amount);</span><br><span class="line">           <span class="comment">// ç»„è£…è®¢å•å‚æ•°</span></span><br><span class="line">           Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">           map.put(<span class="string">"out_trade_no"</span>, orderId);</span><br><span class="line">           <span class="comment">// é”€å”®äº§å“ç </span></span><br><span class="line">           map.put(<span class="string">"product_code"</span>, <span class="string">"FAST_INSTANT_TRADE_PAY"</span>);</span><br><span class="line">           <span class="comment">// äº¤æ˜“é‡‘é¢,å•ä½:å…ƒ</span></span><br><span class="line">           map.put(<span class="string">"total_amount"</span>, amount);</span><br><span class="line">           <span class="comment">// è®¢å•æ ‡é¢˜</span></span><br><span class="line">           map.put(BlogConstants.SUBJECT, <span class="string">"å°é©¬åšå®¢-æ–‡ç« èµèµ"</span>);</span><br><span class="line">           <span class="comment">// è®¢å•æè¿°</span></span><br><span class="line">           map.put(BlogConstants.BODY, <span class="string">"æ—¢ç„¶é€‰æ‹©äº†è¿œæ–¹,ä¾¿åªé¡¾é£é›¨å…¼ç¨‹"</span>);</span><br><span class="line">           <span class="comment">// è®¾ç½®äºŒç»´ç æ¨¡å¼(75px)</span></span><br><span class="line">           map.put(<span class="string">"qr_pay_mode"</span>, <span class="string">"3"</span>);</span><br><span class="line">           <span class="comment">// è®¾ç½®æ¨¡å¼ä¸ºä¸æ”¯æŒèŠ±å‘—æ”¯ä»˜</span></span><br><span class="line">           map.put(<span class="string">"goods_type"</span>, <span class="string">"0"</span>);</span><br><span class="line">           <span class="comment">// è®¢å•è¶…æ—¶æ—¶é—´(10åˆ†é’Ÿ)</span></span><br><span class="line">           map.put(<span class="string">"timeout_express"</span>, <span class="string">"10m"</span>);</span><br><span class="line">           <span class="comment">// å‘é€è¯·æ±‚æ—¶é—´</span></span><br><span class="line">           map.put(<span class="string">"timestamp"</span>, DateUtil.format(<span class="keyword">new</span> Date(), DatePattern.NORM_DATETIME_PATTERN));</span><br><span class="line">           <span class="comment">// è°ƒç”¨æ¥å£ç‰ˆæœ¬</span></span><br><span class="line">           map.put(<span class="string">"version"</span>, <span class="number">1.0</span>);</span><br><span class="line">           alipayRequest.setBizContent(JacksonUtils.objToString(map));</span><br><span class="line">           <span class="comment">//è°ƒç”¨SDKç”Ÿæˆè¡¨å•å­—ç¬¦ä¸²</span></span><br><span class="line">           String payCode = alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line">           <span class="comment">// ç”Ÿæˆä»˜æ¬¾æˆåŠŸ,è®¢å•å¼‚æ­¥å…¥åº“å¹¶ä¼ è¾“åˆ°å»¶æ—¶é˜Ÿåˆ—,è®¢å•10åˆ†é’Ÿå†…ä¸ºæ”¯ä»˜,è®¢å•è¶…æ—¶</span></span><br><span class="line">           <span class="keyword">if</span> (StringUtils.isNotBlank(payCode)) {</span><br><span class="line">               asyncProvider.asyncSaveTrade(tradeVO, map);</span><br><span class="line">           }</span><br><span class="line">           <span class="keyword">return</span> payCode;</span><br><span class="line">       } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">           log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.GENERATE_PAYMENT_CODE);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>è®¢å•æŸ¥è¯¢</p>
<blockquote>
<p>æ ¹æ®è®¢å•å·[out_trade_no]æˆ–è€…äº¤æ˜“å·[trade_no]æŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥è¯¢è®¢å•çŠ¶æ€ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è®¢å•å·æŸ¥è¯¢äº¤æ˜“ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderId è®¢å•å·</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">queryTradeByOrderId</span><span class="params">(String orderId)</span> </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        AlipayClient alipayClient = alipayConfig.getAlipayClient();</span><br><span class="line">        <span class="comment">// åˆ›å»ºè®¢å•æŸ¥è¯¢å¯¹åº”çš„è¯·æ±‚API</span></span><br><span class="line">        AlipayTradeQueryRequest request = <span class="keyword">new</span> AlipayTradeQueryRequest();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        params.put(<span class="string">"out_trade_no"</span>, orderId);</span><br><span class="line">        request.setBizContent(JacksonUtils.objToString(params));</span><br><span class="line">        AlipayTradeQueryResponse response = alipayClient.execute(request);</span><br><span class="line">        log.info(<span class="string">"è®¢å•[{}]ä¿¡æ¯: {}"</span>, orderId, response.getBody());</span><br><span class="line">        <span class="comment">// è¿”å›è®¢å•çŠ¶æ€: é¡µé¢æ ¹æ®è®¢å•çŠ¶æ€è¿›è¡Œé€»è¾‘å¤„ç†</span></span><br><span class="line">        String tradeStatus = response.getTradeStatus();</span><br><span class="line">        log.info(<span class="string">"è®¢å•[{}]çŠ¶æ€: {}"</span>, orderId, tradeStatus);</span><br><span class="line">        <span class="comment">// è®¢å•çŠ¶æ€: TRADE_SUCCESS,æ›´æ–°æ•°æ®åº“è®¢å•çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(<span class="string">"TRADE_SUCCESS"</span>, tradeStatus)) {</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢è®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            LambdaQueryWrapper&lt;Trade&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(Trade::getOutTradeNo, orderId).last(<span class="string">"LIMIT 1"</span>);</span><br><span class="line">            Trade trade = Optional.ofNullable(<span class="keyword">this</span>.getOne(queryWrapper))</span><br><span class="line">                    .orElseThrow(() -&gt; <span class="keyword">new</span> BlogException(ResultCodeEnum.ORDER_NOT_EXIST));</span><br><span class="line">            <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">            Integer status = BlogConstants.TRADE_STATUS.TRADE_SUCCESS.getStatus();</span><br><span class="line">            <span class="keyword">if</span> (!status.equals(trade.getTradeStatus())) {</span><br><span class="line">                trade.setTradeNo(response.getTradeNo());</span><br><span class="line">                trade.setBuyLoginId(response.getBuyerLogonId());</span><br><span class="line">                trade.setTradeStatus(status);</span><br><span class="line">                <span class="keyword">this</span>.updateById(trade);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> tradeStatus;</span><br><span class="line">    } <span class="keyword">catch</span> (AlipayApiException e) {</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.ORDER_QUERY_ERROR);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å›è°ƒé€šçŸ¥æ¥å£ç¤ºä¾‹"><a href="#å›è°ƒé€šçŸ¥æ¥å£ç¤ºä¾‹" class="headerlink" title="å›è°ƒé€šçŸ¥æ¥å£ç¤ºä¾‹"></a>å›è°ƒé€šçŸ¥æ¥å£ç¤ºä¾‹</h3><blockquote>
<p>æ­¤å›è°ƒæ–¹æ³•ç”±æ”¯ä»˜å®å‘èµ·è¯·æ±‚,å¿…é¡»å¤–ç½‘è®¿é—®,è¿™é‡Œä»…ä»…ç”¨ä½œç¤ºä¾‹å†™æ³•</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * POSTè¯·æ±‚: æ­¤å›è°ƒæ–¹æ³•ç”±æ”¯ä»˜å®å‘èµ·è¯·æ±‚,å¿…é¡»å¤–ç½‘è®¿é—®,è¿™é‡Œä»…ä»…ç”¨ä½œç¤ºä¾‹å†™æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping("/notify/callback")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">notifyCallback</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"==&gt; ä»˜æ¬¾æˆåŠŸå¼‚æ­¥å›è°ƒé€šçŸ¥"</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//è·å–æ”¯ä»˜å®POSTè¿‡æ¥åé¦ˆä¿¡æ¯</span></span><br><span class="line">            Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String key : requestParams.keySet()) {</span><br><span class="line">                String[] values = requestParams.get(key);</span><br><span class="line">                String valueStr = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) {</span><br><span class="line">                    valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i]</span><br><span class="line">                            : valueStr + values[i] + <span class="string">","</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//ä¹±ç è§£å†³ï¼Œè¿™æ®µä»£ç åœ¨å‡ºç°ä¹±ç æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line">                <span class="comment">//valueStr = new String(valueStr.getBytes("ISO-8859-1"), "utf-8");</span></span><br><span class="line">                params.put(key, valueStr);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">boolean</span> flag = AlipaySignature.rsaCheckV1(params, alipayPropeties.getPublicKey(),</span><br><span class="line">                    alipayPropeties.getCharset(), alipayPropeties.getSignType());</span><br><span class="line">            <span class="comment">// è·å–æ”¯ä»˜å®çš„é€šçŸ¥è¿”å›å‚æ•°ï¼Œå¯å‚è€ƒæŠ€æœ¯æ–‡æ¡£ä¸­é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥å‚æ•°åˆ—è¡¨(ä»¥ä¸‹ä»…ä¾›å‚è€ƒ)</span></span><br><span class="line">            String order_no = request.getParameter(<span class="string">"out_trade_no"</span>); <span class="comment">// è·å–è®¢å•å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//			String trade_no = request.getParameter("trade_no"); // æ”¯ä»˜å®äº¤æ˜“å·</span></span><br><span class="line"><span class="comment">//			String total_amount = request.getParameter("total_amount"); // è·å–æ€»é‡‘é¢</span></span><br><span class="line"><span class="comment">//			String subject = new String(request.getParameter("subject")</span></span><br><span class="line"><span class="comment">//					.getBytes("ISO-8859-1"), "gbk");// å•†å“åç§°ã€è®¢å•åç§°</span></span><br><span class="line"><span class="comment">//			String body = "";</span></span><br><span class="line"><span class="comment">//			if (request.getParameter("body") != null) {</span></span><br><span class="line"><span class="comment">//				body = new String(request.getParameter("body").getBytes(</span></span><br><span class="line"><span class="comment">//						"ISO-8859-1"), "gbk");// å•†å“æè¿°ã€è®¢å•å¤‡æ³¨ã€æè¿°</span></span><br><span class="line"><span class="comment">//			}</span></span><br><span class="line"><span class="comment">//			String buyer_email = request.getParameter("buyer_email"); // ä¹°å®¶æ”¯ä»˜å®è´¦å·</span></span><br><span class="line"></span><br><span class="line">            String trade_status = request.getParameter(<span class="string">"trade_status"</span>); <span class="comment">// äº¤æ˜“çŠ¶æ€</span></span><br><span class="line">            <span class="comment">// è·å–æ”¯ä»˜å®çš„é€šçŸ¥è¿”å›å‚æ•°ï¼Œå¯å‚è€ƒæŠ€æœ¯æ–‡æ¡£ä¸­é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥å‚æ•°åˆ—è¡¨(ä»¥ä¸Šä»…ä¾›å‚è€ƒ)//</span></span><br><span class="line">            <span class="keyword">if</span> (flag) {</span><br><span class="line">                <span class="comment">// éªŒè¯æˆåŠŸ</span></span><br><span class="line">                <span class="comment">// ä¿å­˜æˆ–æ›´æ–°æ­¤æ¬¡èµèµè®°å½•</span></span><br><span class="line">                log.info(<span class="string">"æ”¯ä»˜å®è®¢å• {} æ”¯ä»˜æˆåŠŸ"</span>, order_no);</span><br><span class="line">                <span class="keyword">return</span> R.ok().message(<span class="string">"æ”¯ä»˜æˆåŠŸ"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> R.error().message(<span class="string">"æ”¯ä»˜å¤±è´¥"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.UNKNOWN_REASON);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GETè¯·æ±‚: ä»˜æ¬¾æˆåŠŸåŒæ­¥å›è°ƒé€šçŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/return/callback")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnRedirect</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        log.info(<span class="string">"==&gt; ä»˜æ¬¾æˆåŠŸåŒæ­¥å›è°ƒé€šçŸ¥"</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é¡µé¢ä»£ç "><a href="#é¡µé¢ä»£ç " class="headerlink" title="é¡µé¢ä»£ç "></a>é¡µé¢ä»£ç </h3><blockquote>
<p>è¿™ä¸ªåªæ˜¯ç”Ÿæˆä»˜æ¬¾ç çš„å¼¹çª—ï¼Œé€»è¾‘æ¯”è¾ƒæ··ä¹±ï¼Œå¼‚å¸¸åƒåœ¾ï¼Œå°†å°±çœ‹å§ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"> * @Author: Mr.Horse</span><br><span class="line"> * @Date: 2021-06-15 11:08:21</span><br><span class="line"> * @LastEditTime: 2021-06-18 14:57:23</span><br><span class="line"> * @Blog: http://www.horsemuzi.top</span><br><span class="line"> * @Descripttion: é€‰æ‹©èµèµé‡‘é¢å¼¹çª—é¡µ</span><br><span class="line">--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="app-container"&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      v-elDragDialog</span><br><span class="line">      :visible="dialogFormVisible"</span><br><span class="line">      :close-on-click-modal="false"</span><br><span class="line">      title="è¯·é€‰æ‹©èµèµé‡‘é¢"</span><br><span class="line">      show-close</span><br><span class="line">      @close="close()"&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;el-row :gutter="10"&gt;</span><br><span class="line">          &lt;div v-for="(item,index) in money" :key="index"&gt;</span><br><span class="line">            &lt;el-col :span="6" style="margin-bottom: 1vh;"&gt;</span><br><span class="line">              &lt;el-card&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div style="text-align: center;font-size:30px;" @click="toPay(item)"&gt;</span><br><span class="line">                  &lt;i class="el-icon-coin"&gt;&lt;/i&gt;</span><br><span class="line">                  &lt;span&gt;{{ item }}.0&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/el-card&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-row style="margin-bottom: 1.5vh;"&gt;</span><br><span class="line">          &lt;el-col :span="24"&gt;</span><br><span class="line">            &lt;el-button type="primary" size="mini" @click="openCustomMoney"&gt;å…¶ä»–é‡‘é¢&lt;/el-button&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;p v-if="isShow"&gt;</span><br><span class="line">              &lt;el-input-number v-model="customAmount" :precision="1" :step="0.5" :min="0.5"&gt;&lt;/el-input-number&gt;</span><br><span class="line">              &lt;el-button type="primary" @click="toPay(customAmount)"&gt;ç¡®å®š&lt;/el-button&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col&gt;</span><br><span class="line">            &lt;el-card&gt;</span><br><span class="line"></span><br><span class="line">              &lt;div style="text-align: center"&gt;</span><br><span class="line">                &lt;iframe</span><br><span class="line">                  :srcdoc="payHtml"</span><br><span class="line">                  sandbox="allow-forms allow-same-origin allow-scripts"</span><br><span class="line">                  frameborder="no"</span><br><span class="line">                  border="0"</span><br><span class="line">                  marginwidth="0"</span><br><span class="line">                  marginheight="0"</span><br><span class="line">                  scrolling="no"</span><br><span class="line">                  width="80"</span><br><span class="line">                  height="80"</span><br><span class="line">                  style="overflow:hidden;"&gt;</span><br><span class="line">                &lt;/iframe&gt;</span><br><span class="line">                &lt;p&gt;æ”¯ä»˜å®æ‰«ç æ”¯ä»˜&amp;ensp;</span><br><span class="line">                  &lt;span style="color: red; font-size: 30px;"&gt;{{ realMoney }}&lt;/span&gt;</span><br><span class="line">                  &amp;ensp;å…ƒ</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/el-card&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import payApi from '@/api/pay'</span><br><span class="line">import elDragDialog from '@/directive/el-drag-dialog/' // å¯æ‹–æ‹½dialog</span><br><span class="line">// å¼•å…¥iconç»„ä»¶å’Œé…ç½®</span><br><span class="line">import { DEFAULT_ICON_CONFIGS } from '@icon-park/vue'</span><br><span class="line">import { IconPark } from '@icon-park/vue/es/all'</span><br><span class="line"></span><br><span class="line">const IconConfig = { ...DEFAULT_ICON_CONFIGS, prefix: 'icon' }</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  provide() {</span><br><span class="line">    return {</span><br><span class="line">      ICON_CONFIGS: IconConfig</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  name: 'Pay',</span><br><span class="line">  directives: {</span><br><span class="line">    elDragDialog,</span><br><span class="line">    IconPark</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      money: [1, 2, 3, 4, 5, 6, 7, 8],</span><br><span class="line">      payHtml: '', // ä»˜æ¬¾è¡¨å•é¡µé¢</span><br><span class="line">      customAmount: 0, // è‡ªå®šä¹‰æ”¯ä»˜é‡‘é¢</span><br><span class="line">      isShow: false,</span><br><span class="line">      realMoney: 0, // çœŸå®æ”¯ä»˜é‡‘é¢</span><br><span class="line">      trade: {</span><br><span class="line">        blogId: '', // æ–‡ç« id</span><br><span class="line">        amount: 0, // è®¢å•é‡‘é¢</span><br><span class="line">        orderId: '' // è®¢å•å·ï¼ˆUUIDï¼‰</span><br><span class="line">      }, // è®¢å•ä¿¡æ¯</span><br><span class="line">      timer: '' // å®šæ—¶å™¨åç§°</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted() {</span><br><span class="line">    this.timer = setInterval(this.queryOrderStatus, 7000)</span><br><span class="line">  },</span><br><span class="line">  beforeDestroy() {</span><br><span class="line">    clearInterval(this.timer)</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    open(blogId) {</span><br><span class="line">      this.dialogFormVisible = true</span><br><span class="line">      if (blogId) {</span><br><span class="line">        this.trade.blogId = blogId</span><br><span class="line">      } else {</span><br><span class="line">        this.$message.error('ä»˜æ¬¾ç ç”Ÿæˆå¤±è´¥')</span><br><span class="line">      }</span><br><span class="line">      // é»˜è®¤åŸºäºç¬¬ä¸€ä¸ªé‡‘é¢å€¼ï¼Œç”ŸæˆäºŒç»´ç </span><br><span class="line">      this.toPay(this.money[0])</span><br><span class="line">    },</span><br><span class="line">    close() {</span><br><span class="line">      this.dialogFormVisible = false</span><br><span class="line">      this.resetForm()</span><br><span class="line">    },</span><br><span class="line">    resetForm() {</span><br><span class="line">      this.payHtml = ''</span><br><span class="line">      this.isShow = false</span><br><span class="line">      this.customAmount = 0.5</span><br><span class="line">      // é‡ç½®å„é¡¹å‚æ•°</span><br><span class="line">      this.trade = {</span><br><span class="line">        blogId: '',</span><br><span class="line">        amount: 0,</span><br><span class="line">        orderId: ''</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    toPay(amount) {</span><br><span class="line">      this.realMoney = amount</span><br><span class="line">      this.trade.amount = amount</span><br><span class="line">      this.trade.orderId = this.generateUUID()</span><br><span class="line">      payApi.toPayMoney(this.trade).then(response =&gt; {</span><br><span class="line">        this.payHtml = response.data.items</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    openCustomMoney() {</span><br><span class="line">      this.isShow = !this.isShow</span><br><span class="line">    },</span><br><span class="line">    // è½®è¯¢æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Œå¦‚æœæ”¯ä»˜æˆåŠŸï¼Œåˆ™å…³é—­å¼¹çª—</span><br><span class="line">    queryOrderStatus() {</span><br><span class="line">      const orderId = this.trade.orderId</span><br><span class="line">      if (orderId !== '') {</span><br><span class="line">        payApi.queryOrderByOrderId(orderId).then(response =&gt; {</span><br><span class="line">          if (response.data.status === 'TRADE_SUCCESS') {</span><br><span class="line">            this.$message.success('æ”¯ä»˜æˆåŠŸ')</span><br><span class="line">            this.close()</span><br><span class="line">          }</span><br><span class="line">        })</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    // ç”ŸæˆUUID(æ— æ¨ªçº¿)</span><br><span class="line">    generateUUID() {</span><br><span class="line">      let d = new Date().getTime()</span><br><span class="line">      if (window.performance &amp;&amp; typeof window.performance.now === 'function') {</span><br><span class="line">        d += performance.now() // use high-precision timer if available</span><br><span class="line">      }</span><br><span class="line">      const uuid = 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {</span><br><span class="line">        const r = (d + Math.random() * 16) % 16 | 0</span><br><span class="line">        d = Math.floor(d / 16)</span><br><span class="line">        return (c === 'x' ? r : (r &amp; 0x3 | 0x8)).toString(16)</span><br><span class="line">      })</span><br><span class="line">      return uuid</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h3><p><img src="https://i.loli.net/2021/06/26/CSIsNLad3MJFpAW.png" alt="ç‚¹å‡»æ”¯ä»˜å®æ‰«ç æ”¯ä»˜"></p>
<p><img src="https://i.loli.net/2021/06/26/q6AYeRNrl4V7HJw.png" alt="é€‰æ‹©é‡‘é¢ï¼Œæ‰«ç æ”¯ä»˜ï¼ˆæ²™ç®±ç¯å¢ƒï¼‰"></p>
]]></content>
      <categories>
        <category>æ”¯ä»˜å¯¹æ¥</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>alipay</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootç®€å•å®šæ—¶ä»»åŠ¡</title>
    <url>/post/59942.html</url>
    <content><![CDATA[<h1 id="SringBootç®€å•å®šæ—¶ä»»åŠ¡"><a href="#SringBootç®€å•å®šæ—¶ä»»åŠ¡" class="headerlink" title="SringBootç®€å•å®šæ—¶ä»»åŠ¡"></a>SringBootç®€å•å®šæ—¶ä»»åŠ¡</h1><h2 id="æ³¨è§£ç®€ä»‹"><a href="#æ³¨è§£ç®€ä»‹" class="headerlink" title="æ³¨è§£ç®€ä»‹"></a>æ³¨è§£ç®€ä»‹</h2><blockquote>
<p>åˆ©ç”¨SpringBootä¸­æä¾›çš„<code>@ConditionOnProperty</code>æ³¨è§£ï¼Œå®ç°é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¯å¦åŠ è½½æ³¨è§£æ‰€åœ¨çš„è¿™ä¸ªé…ç½®é¡¹ã€‚</p>
</blockquote>
<p>ymlé…ç½®å±æ€§</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å®šæ—¶ä»»åŠ¡å¼€å…³</span></span><br><span class="line"><span class="attr">schedule:</span></span><br><span class="line">	<span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨è§£è§£æ</p>
<blockquote>
<p><code>@ConditionOnProperty</code>æ³¨è§£åŸºæœ¬ä½œç”¨ï¼š</p>
<p>é€šè¿‡å±æ€§<strong>name</strong>ä»¥åŠ<strong>havingValue</strong>æ¥å®ç°çš„ï¼Œå…¶ä¸­<strong>name</strong>ç”¨æ¥ä»<strong>application.properties</strong>ä¸­è¯»å–æŸä¸ªå±æ€§å€¼ã€‚</p>
<ul>
<li><strong>å¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›false</strong>;</li>
<li><strong>å¦‚æœå€¼ä¸ä¸ºç©ºï¼Œåˆ™å°†è¯¥å€¼ä¸havingValueæŒ‡å®šçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸€æ ·åˆ™è¿”å›true;å¦åˆ™è¿”å›falseã€‚</strong></li>
<li><strong>å¦‚æœè¿”å›å€¼ä¸ºfalseï¼Œåˆ™è¯¥configurationä¸ç”Ÿæ•ˆï¼›ä¸ºtrueåˆ™ç”Ÿæ•ˆã€‚</strong></li>
</ul>
<p>æ³¨æ„ï¼š<strong>prefix</strong> è¡¨ç¤ºæŸäº›å±æ€§å€¼çš„å‰ç¼€</p>
</blockquote>
<h2 id="ä»»åŠ¡ç¤ºä¾‹"><a href="#ä»»åŠ¡ç¤ºä¾‹" class="headerlink" title="ä»»åŠ¡ç¤ºä¾‹"></a>ä»»åŠ¡ç¤ºä¾‹</h2><h3 id="Scheduleæ³¨è§£å®ç°"><a href="#Scheduleæ³¨è§£å®ç°" class="headerlink" title="@Scheduleæ³¨è§£å®ç°"></a>@Scheduleæ³¨è§£å®ç°</h3><blockquote>
<p>ç¼ºç‚¹ï¼šæ¯æ¬¡æ›´æ–°å®šæ—¶ä»»åŠ¡,åªèƒ½æ‰‹åŠ¨åœæ­¢æœåŠ¡,æ›´æ–°cronè¡¨è¾¾å¼,å†æ‰“åŒ…,é‡æ–°å¯åŠ¨æœåŠ¡,åªé€‚ç”¨äºæ›´æ–°ä¸é¢‘ç¹çš„å®šæ—¶ä»»åŠ¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/16 20:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "schedule", name = "enable", havingValue = "true")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = "0 */5 * * **")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleTask</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"==&gt; ç®€å•ä»»åŠ¡æ¼”ç¤º"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="SchedulingConfigureræ¥å£å®ç°"><a href="#SchedulingConfigureræ¥å£å®ç°" class="headerlink" title="SchedulingConfigureræ¥å£å®ç°"></a>SchedulingConfigureræ¥å£å®ç°</h3><blockquote>
<p>ç¼ºç‚¹ï¼šè™½ç„¶å®ç°äº†cronè¡¨è¾¾å¼çš„åŠ¨æ€é…ç½®,ä½†æ˜¯æ¯æ¬¡é…ç½®ä¹‹å,è¡¨è¾¾å¼ç”Ÿæ•ˆçš„æ—¶é—´æ˜¯ä¸‹æ¬¡æ‰§è¡Œæ­¤ä»»åŠ¡çš„æ—¶å€™,ä¹Ÿå°±æ˜¯è¯´,åŠ¨æ€é…ç½®ä¸èƒ½å®æ—¶ç”Ÿæ•ˆ,ç®€å•çš„å®šæ—¶ä»»åŠ¡å¯ä»¥è¿™æ ·ä½¿ç”¨,å³å¯ä»¥æ»¡è¶³éœ€æ±‚,ä½†æ˜¯ç¨å¾®å¤æ‚çš„,å®æ—¶æ€§æ¯”è¾ƒé«˜çš„,å»ºè®®ä½¿ç”¨Quartz, xxl-jobç­‰ä»»åŠ¡æ¡†æ¶</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DatePattern;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.Trigger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.SchedulingConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.config.ScheduledTaskRegistrar;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.support.CronTrigger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: {description}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/17 18:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "schedule", name = "enable", havingValue = "true")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicScheduleTask</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„cronè¡¨è¾¾å¼å¯ä»¥åŠ¨æ€çš„é…ç½®åˆ°æ•°æ®åº“ï¼ŒåŠ¨æ€è·å–å¹¶æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CRON_EXPRESSION = <span class="string">"*/5 * * * * ?"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>{</span><br><span class="line">        taskRegistrar.setTriggerTasks(<span class="keyword">this</span>.getTaskAndTriggerConfig(taskRegistrar));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;Runnable, Trigger&gt; <span class="title">getTaskAndTriggerConfig</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Map&lt;Runnable, Trigger&gt; taskMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè§¦å‘å™¨</span></span><br><span class="line">        Trigger trigger = triggerContext -&gt; {</span><br><span class="line">            CronTrigger cronTrigger = <span class="keyword">new</span> CronTrigger(CRON_EXPRESSION);</span><br><span class="line">            <span class="keyword">return</span> cronTrigger.nextExecutionTime(triggerContext);</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        Runnable runnable = () -&gt; {</span><br><span class="line">            log.info(<span class="string">" çº¿ç¨‹å: {}"</span> + Thread.currentThread().getName() + <span class="string">"  æ‰§è¡Œæ—¶é—´: {}"</span>, DateUtil.format(<span class="keyword">new</span> Date(), DatePattern.NORM_DATETIME_PATTERN));</span><br><span class="line">        };</span><br><span class="line">        taskMap.put(runnable, trigger);</span><br><span class="line">        <span class="keyword">return</span> taskMap;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="ScheduledFutureä»»åŠ¡è°ƒåº¦ï¼ˆç®€å•ç‰ˆQuartzï¼‰"><a href="#ScheduledFutureä»»åŠ¡è°ƒåº¦ï¼ˆç®€å•ç‰ˆQuartzï¼‰" class="headerlink" title="ScheduledFutureä»»åŠ¡è°ƒåº¦ï¼ˆç®€å•ç‰ˆQuartzï¼‰"></a>ScheduledFutureä»»åŠ¡è°ƒåº¦ï¼ˆç®€å•ç‰ˆQuartzï¼‰</h3><blockquote>
<p>å®ç°ç®€ä»‹ï¼šä½¿ç”¨<code>ScheduledFuture</code>ç±»ç»“åˆMysqlè¿›è¡Œå®šæ—¶ä»»åŠ¡æ•°æ®æŒä¹…åŒ–ï¼Œå®ç°å®šæ—¶ä»»åŠ¡çš„<code>å¢åˆ æ”¹æŸ¥</code>åŠŸèƒ½ï¼Œå¦‚æœè§‰å¾—ç±»ä¼¼ä¸<code>Quartz</code>ä»»åŠ¡è°ƒåº¦æ¡†æ¶è¿‡äºæ²‰é‡ï¼Œå¯ä»¥è¯•ç€è‡ªå·±å®ç°ç®€å•çš„ä»»åŠ¡è°ƒåº¦ã€‚</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºæ•°æ®åº“ï¼ˆç”¨äºæŒä¹…åŒ–cronè¡¨è¾¾å¼ç­‰å…¶ä»–ä¿¡æ¯ï¼‰</li>
<li>å®ç°ä»»åŠ¡è°ƒåº¦å¤„ç†ç±»</li>
<li>åˆ›å»ºä»»åŠ¡è°ƒåº¦ä¸šåŠ¡ç±»</li>
<li>ä»»åŠ¡è°ƒåº¦å¯åŠ¨åˆå§‹åŒ–</li>
<li>å®ç°ä»»åŠ¡è°ƒåº¦æ§åˆ¶ç±»</li>
</ol>
</blockquote>
<h4 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h4><blockquote>
<p>åˆ›å»ºä»»åŠ¡è°ƒåº¦éœ€è¦æŒä¹…åŒ–çš„å¿…è¦å±æ€§ä»¥åŠä»»åŠ¡æ‰§è¡Œæƒ…å†µçš„æ—¥å¿—è®°å½•è¡¨</p>
</blockquote>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">CREATE TABLE tb_task</span><br><span class="line">(</span><br><span class="line">    id            CHAR(19)                      NOT NULL COMMENT 'ä»»åŠ¡ID'</span><br><span class="line">        PRIMARY KEY,</span><br><span class="line">    bean_name     VARCHAR(255)                  NOT NULL COMMENT 'Beanåç§°',</span><br><span class="line">    method_name   VARCHAR(255)                  NOT NULL COMMENT 'æ–¹æ³•å',</span><br><span class="line">    method_params VARCHAR(255)                  NULL COMMENT 'æ–¹æ³•å‚æ•°',</span><br><span class="line">    cron          VARCHAR(100)                  NOT NULL COMMENT 'cronè¡¨è¾¾å¼',</span><br><span class="line">    job_remark    VARCHAR(1000)                 NULL COMMENT 'ä»»åŠ¡å¤‡æ³¨',</span><br><span class="line">    job_status    TINYINT(1) UNSIGNED DEFAULT 1 NOT NULL COMMENT 'ä»»åŠ¡çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-æš‚åœ',</span><br><span class="line">    gmt_create    DATETIME                      NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´',</span><br><span class="line">    gmt_modified  DATETIME                      NOT NULL COMMENT 'æ›´æ–°æ—¶é—´',</span><br><span class="line">    is_deleted    TINYINT(1) UNSIGNED DEFAULT 1 NOT NULL COMMENT 'é€»è¾‘åˆ é™¤',</span><br><span class="line">    version       BIGINT UNSIGNED     DEFAULT 1 NOT NULL COMMENT 'ä¹è§‚é”'</span><br><span class="line">)</span><br><span class="line">    COMMENT 'ä»»åŠ¡è°ƒåº¦ä¿¡æ¯è¡¨';</span><br><span class="line">    </span><br><span class="line">CREATE TABLE tb_task_log</span><br><span class="line">(</span><br><span class="line">    id              CHAR(19)                  NOT NULL,</span><br><span class="line">    job_id          CHAR(19)                  NOT NULL COMMENT 'ä»»åŠ¡Id',</span><br><span class="line">    bean_name       VARCHAR(128)              NOT NULL COMMENT 'beanåç§°',</span><br><span class="line">    method_name     VARCHAR(128)              NOT NULL COMMENT 'æ–¹æ³•å',</span><br><span class="line">    method_params   VARCHAR(128)              NULL COMMENT 'æ–¹æ³•å‚æ•°',</span><br><span class="line">    job_remark      VARCHAR(255)              NULL COMMENT 'ä»»åŠ¡å¤‡æ³¨',</span><br><span class="line">    job_status      TINYINT(1) UNSIGNED       NOT NULL COMMENT 'ä»»åŠ¡çŠ¶æ€',</span><br><span class="line">    executor_status VARCHAR(10)               NOT NULL COMMENT 'æ‰§è¡ŒçŠ¶æ€ï¼šsuccess-æˆåŠŸï¼Œfail-å¤±è´¥',</span><br><span class="line">    executor_time   BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT 'ä»»åŠ¡è€—æ—¶ï¼Œå•ä½ï¼šms',</span><br><span class="line">    exce_info       TEXT                      NULL COMMENT 'ä»»åŠ¡å¼‚å¸¸ä¿¡æ¯',</span><br><span class="line">    gmt_create      DATETIME                  NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´',</span><br><span class="line">    gmt_modified    DATETIME                  NOT NULL COMMENT 'æ›´æ–°æ—¶é—´',</span><br><span class="line">    CONSTRAINT tb_task_log_id_uindex</span><br><span class="line">        UNIQUE (id)</span><br><span class="line">)</span><br><span class="line">    COMMENT 'ä»»åŠ¡æ—¥å¿—ä¿¡æ¯';</span><br><span class="line"></span><br><span class="line">ALTER TABLE tb_task_log</span><br><span class="line">    ADD PRIMARY KEY (id);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ä»»åŠ¡è°ƒåº¦å®ç°ï¼ˆæ ¸å¿ƒï¼‰"><a href="#ä»»åŠ¡è°ƒåº¦å®ç°ï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="ä»»åŠ¡è°ƒåº¦å®ç°ï¼ˆæ ¸å¿ƒï¼‰"></a>ä»»åŠ¡è°ƒåº¦å®ç°ï¼ˆæ ¸å¿ƒï¼‰</h4><h5 id="ä»»åŠ¡å–æ¶ˆå®ç°ç±»"><a href="#ä»»åŠ¡å–æ¶ˆå®ç°ç±»" class="headerlink" title="ä»»åŠ¡å–æ¶ˆå®ç°ç±»"></a>ä»»åŠ¡å–æ¶ˆå®ç°ç±»</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledFuture;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å–æ¶ˆå®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/8 10:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledTask</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> ScheduledFuture&lt;?&gt; future;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆå®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>{</span><br><span class="line">        ScheduledFuture&lt;?&gt; future = <span class="keyword">this</span>.future;</span><br><span class="line">        <span class="keyword">if</span> (future != <span class="keyword">null</span>) {</span><br><span class="line">            future.cancel(<span class="keyword">true</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="ä»»åŠ¡æ³¨å†Œå®ç°ç±»"><a href="#ä»»åŠ¡æ³¨å†Œå®ç°ç±»" class="headerlink" title="ä»»åŠ¡æ³¨å†Œå®ç°ç±»"></a>ä»»åŠ¡æ³¨å†Œå®ç°ç±»</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.TaskScheduler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.config.CronTask;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: ä»»åŠ¡æ³¨å†Œç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/8 10:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CronTaskRegistrar</span> <span class="keyword">implements</span> <span class="title">DisposableBean</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(CronTaskRegistrar.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ ä»»åŠ¡çš„æ ¸å¿ƒç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskScheduler taskScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºå¹¶å‘åŒ…ä¸‹çš„Mapæ•°æ®ç»“æ„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Runnable, ScheduledTask&gt; scheduledTasks = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCronTask</span><span class="params">(CronTask cronTask)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (cronTask != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// è·å–ä»»åŠ¡æ¥å£å¯¹è±¡</span></span><br><span class="line">            Runnable task = cronTask.getRunnable();</span><br><span class="line">            <span class="comment">// å¦‚æœä»»åŠ¡å·²å­˜åœ¨,åˆ™åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> (scheduledTasks.containsKey(task)) {</span><br><span class="line">                removeCronTask(task);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// é‡æ–°å¼€å§‹æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">            scheduledTasks.put(task, scheduleCronTask(cronTask));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è°ƒåº¦ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task           ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cronExpression cronè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCronTask</span><span class="params">(Runnable task, String cronExpression)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">"å¼€å§‹æ³¨å†Œä»»åŠ¡"</span>);</span><br><span class="line">        addCronTask(<span class="keyword">new</span> CronTask(task, cronExpression));</span><br><span class="line">        logger.info(<span class="string">"ä»»åŠ¡æ³¨å†ŒæˆåŠŸ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeCronTask</span><span class="params">(Runnable task)</span> </span>{</span><br><span class="line">        logger.info(<span class="string">"å‡†å¤‡ç§»é™¤ä»»åŠ¡"</span>);</span><br><span class="line">        ScheduledTask scheduledTask = scheduledTasks.remove(task);</span><br><span class="line">        <span class="keyword">if</span> (scheduledTask != <span class="keyword">null</span>) {</span><br><span class="line">            scheduledTask.cancel();</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        logger.info(<span class="string">"ç§»é™¤ä»»åŠ¡æˆåŠŸ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cronTask</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ScheduledTask <span class="title">scheduleCronTask</span><span class="params">(CronTask cronTask)</span> </span>{</span><br><span class="line">        ScheduledTask scheduledTask = <span class="keyword">new</span> ScheduledTask();</span><br><span class="line">        scheduledTask.future = taskScheduler.schedule(cronTask.getRunnable(), cronTask.getTrigger());</span><br><span class="line">        <span class="keyword">return</span> scheduledTask;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»»åŠ¡é”€æ¯(å½“beanè¢«é”€æ¯ä¹‹å‰ï¼Œæ‰§è¡Œæ­¤æ–¹æ³•ï¼Œç»“æŸæ‰€æœ‰å®šæ—¶ä»»åŠ¡)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">for</span> (ScheduledTask task : scheduledTasks.values()) {</span><br><span class="line">            task.cancel();</span><br><span class="line">        }</span><br><span class="line">        scheduledTasks.clear();</span><br><span class="line">        logger.info(<span class="string">"å®šæ—¶ä»»åŠ¡å–æ¶ˆ..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="ä»»åŠ¡å¤šçº¿ç¨‹å¤„ç†ç±»"><a href="#ä»»åŠ¡å¤šçº¿ç¨‹å¤„ç†ç±»" class="headerlink" title="ä»»åŠ¡å¤šçº¿ç¨‹å¤„ç†ç±»"></a>ä»»åŠ¡å¤šçº¿ç¨‹å¤„ç†ç±»</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.extra.spring.SpringUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.ThreadFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.constants.BlogConstants;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.JacksonUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.entity.Task;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.entity.TaskLog;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.TaskLogService;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.TaskService;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.threads.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Runnableæ¥å£å®ç°ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/8 10:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchedulingRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(SchedulingRunnable.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadFactory threadFactory = <span class="keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="string">"InsertJobLogPool-%d"</span>).build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * beanåç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String methodName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String params;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String executorStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œè€—æ—¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long executorTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»»åŠ¡å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String exceInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¿…é¡»å®ç°æ— å‚æ„é€ å‡½æ•°,æ‰èƒ½è‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SchedulingRunnable</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SchedulingRunnable</span><span class="params">(String beanName, String methodName)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(beanName, methodName, <span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SchedulingRunnable</span><span class="params">(String beanName, String methodName, String params)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.beanName = beanName;</span><br><span class="line">        <span class="keyword">this</span>.methodName = methodName;</span><br><span class="line">        <span class="keyword">this</span>.params = params;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™å®šæ—¶ä»»åŠ¡runæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, TimeUnit.SECONDS, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>), threadFactory);</span><br><span class="line">        logger.info(<span class="string">"å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œ - beanï¼š{}ï¼Œæ–¹æ³•ï¼š{}ï¼Œå‚æ•°ï¼š{}"</span>, beanName, methodName, params);</span><br><span class="line">        <span class="comment">// ä»»åŠ¡å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è·å–beanç›®æ ‡å¯¹è±¡</span></span><br><span class="line">            Object target = SpringUtil.getBean(beanName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–æ–¹æ³•</span></span><br><span class="line">            Method method;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(params)) {</span><br><span class="line">                <span class="comment">// æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å–</span></span><br><span class="line">                method = target.getClass().getDeclaredMethod(methodName, String.class);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// æ ¹æ®æ–¹æ³•åè·å–</span></span><br><span class="line">                method = target.getClass().getDeclaredMethod(methodName);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ”¾å¼€æ–¹æ³•çš„è®¿é—®æƒé™</span></span><br><span class="line">            ReflectionUtils.makeAccessible(method);</span><br><span class="line">            <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(params)) {</span><br><span class="line">                method.invoke(target, params);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                method.invoke(target);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// ä»»åŠ¡è€—æ—¶</span></span><br><span class="line">            <span class="keyword">long</span> times = System.currentTimeMillis() - startTime;</span><br><span class="line">            logger.info(<span class="string">"å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æŸ - beanï¼š{}ï¼Œæ–¹æ³•ï¼š{}ï¼Œå‚æ•°ï¼š{}ï¼Œè€—æ—¶ï¼š{} æ¯«ç§’"</span>, beanName, methodName, params, times);</span><br><span class="line">            <span class="comment">// ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ: è®¾ç½®ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œä»»åŠ¡æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">            <span class="keyword">this</span>.executorStatus = BlogConstants.JOB_EXECUTOR_STATUS.SUCCESS.name();</span><br><span class="line">            <span class="keyword">this</span>.executorTime = times;</span><br><span class="line">            <span class="comment">// ä¿å­˜æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">            executor.execute(<span class="keyword">new</span> JobLog());</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="comment">// ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸: è®¾ç½®ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€</span></span><br><span class="line">            logger.error(String.format(<span class="string">"å®šæ—¶ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ - beanï¼š%sï¼Œæ–¹æ³•ï¼š%sï¼Œå‚æ•°ï¼š%s "</span>, beanName, methodName, params), e);</span><br><span class="line">            <span class="keyword">this</span>.executorStatus = BlogConstants.JOB_EXECUTOR_STATUS.FAIL.name();</span><br><span class="line">            <span class="keyword">this</span>.executorTime = System.currentTimeMillis() - startTime;</span><br><span class="line">            <span class="comment">// ä¿å­˜ä¸ºjsonæ ¼å¼æ•°æ®</span></span><br><span class="line">            <span class="keyword">this</span>.exceInfo = JacksonUtils.objToString(e);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">            executor.execute(<span class="keyword">new</span> JobLog());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JobLog</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskLogService taskLogService;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹ç±»ä¸­å¯ä»¥åˆ©ç”¨æ— å‚æ„é€ æ–¹æ³•,é€šè¿‡è°ƒç”¨getBeanæ–¹æ³•æ¥å®ç°beanå®ä¾‹çš„æ³¨å…¥</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">JobLog</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// HuToolå·¥å…·ç±»å®ç°beançš„è·å–</span></span><br><span class="line">            <span class="keyword">this</span>.taskService = SpringUtil.getBean(TaskService.class);</span><br><span class="line">            <span class="keyword">this</span>.taskLogService = SpringUtil.getBean(TaskLogService.class);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// æ’å…¥æ‰§è¡Œæ—¥å¿—(æ ¹æ®beanName,methodName,methodParamså¯ä»¥ç¡®å®šä¸€ä¸ªå”¯ä¸€ä»»åŠ¡)</span></span><br><span class="line">            Task task = <span class="keyword">this</span>.taskService.getOne(<span class="keyword">new</span> QueryWrapper&lt;Task&gt;().lambda()</span><br><span class="line">                    .select(Task::getId, Task::getBeanName, Task::getMethodName, Task::getMethodParams, Task::getCron</span><br><span class="line">                            , Task::getJobRemark, Task::getJobStatus)</span><br><span class="line">                    .eq(Task::getBeanName, beanName)</span><br><span class="line">                    .eq(Task::getMethodName, methodName)</span><br><span class="line">                    .eq(StringUtils.isNotBlank(params), Task::getMethodParams, params)</span><br><span class="line">                    .isNull(StringUtils.isBlank(params), Task::getMethodParams));</span><br><span class="line">            <span class="comment">// ç»„è£…ä¿¡æ¯</span></span><br><span class="line">            TaskLog taskLog = <span class="keyword">new</span> TaskLog();</span><br><span class="line">            taskLog.setJobId(task.getId())</span><br><span class="line">                    .setExecutorStatus(executorStatus)</span><br><span class="line">                    .setExecutorTime(executorTime);</span><br><span class="line">            <span class="comment">// å¦‚æœå¼‚å¸¸ä¿¡æ¯ä¸ä¸ºç©º,åˆ™ä¿å­˜æ­¤å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(exceInfo)) {</span><br><span class="line">                <span class="comment">// æˆªå–å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">                exceInfo = exceInfo.length() &gt; <span class="number">256</span> ? exceInfo.substring(<span class="number">0</span>, <span class="number">256</span>) : exceInfo;</span><br><span class="line">                taskLog.setExceInfo(exceInfo);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// å°†ä»»åŠ¡Idç½®ä¸ºç©º: é˜²æ­¢å±æ€§æ‹·è´æ—¶,ä¸¤ä¸ªidå€¼çš„ç›¸äº’æ‹·è´,é€ æˆæ•°æ®åº“æ’å…¥é”™è¯¯</span></span><br><span class="line">            task.setId(<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">// æ‹·è´å±æ€§</span></span><br><span class="line">            BeanUtils.copyProperties(task, taskLog);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ•°æ®</span></span><br><span class="line">            <span class="keyword">this</span>.taskLogService.save(taskLog);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™equalså’ŒhashCode</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        SchedulingRunnable that = (SchedulingRunnable) o;</span><br><span class="line">        <span class="keyword">if</span> (params == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> beanName.equals(that.beanName) &amp;&amp;</span><br><span class="line">                    methodName.equals(that.methodName) &amp;&amp;</span><br><span class="line">                    that.params == <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> beanName.equals(that.beanName) &amp;&amp;</span><br><span class="line">                methodName.equals(that.methodName) &amp;&amp;</span><br><span class="line">                params.equals(that.params);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (params == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> Objects.hash(beanName, methodName);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Objects.hash(beanName, methodName, params);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä¸šåŠ¡å®ç°"><a href="#ä¸šåŠ¡å®ç°" class="headerlink" title="ä¸šåŠ¡å®ç°"></a>ä¸šåŠ¡å®ç°</h3><blockquote>
<p>ç¼–å†™ä»»åŠ¡è°ƒåº¦çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œç”¨äºè¢«æ³¨å†Œå’Œè°ƒåº¦</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.job.simple;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.common.CommonProvide;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.mapper.BlogViewsMapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.SongService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: ç®€å•ä»»åŠ¡å®ä½“ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/8 15:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component("testJob")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJob</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SongService songService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BlogViewsMapper blogViewsMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯å¤©å®šæ—¶11:11æ‰§è¡Œä¸€æ¬¡åˆ é™¤æ˜¨å¤©æµè§ˆè®°å½•çš„æ“ä½œ[tb_blog_views]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobWithParams</span><span class="params">(String params)</span> </span>{</span><br><span class="line">        StopWatch watch = CommonProvide.getWatchStart();</span><br><span class="line">        log.info(<span class="string">"===&gt; å¼€å§‹æ‰§è¡Œåˆ é™¤æ˜¨æ—¥æµè§ˆè®°å½•æ“ä½œ &lt;==="</span>);</span><br><span class="line">        blogViewsMapper.removeYesterdayViewRecord();</span><br><span class="line">        watch.stop();</span><br><span class="line">        log.info(<span class="string">"===&gt; åˆ é™¤æ˜¨æ—¥æµè§ˆè®°å½•æ“ä½œæ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯å¤©11ç‚¹å®šæ—¶åˆ é™¤é‡å¤æ­Œæ›²(0 0 11 * * ?)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobNoWithParams</span><span class="params">()</span> </span>{</span><br><span class="line">        StopWatch watch = CommonProvide.getWatchStart();</span><br><span class="line">        log.info(<span class="string">"===&gt; å¼€å§‹æ‰§è¡Œåˆ é™¤é‡å¤æ­Œæ›²æ“ä½œ &lt;==="</span>);</span><br><span class="line">        songService.removeRepeatSong();</span><br><span class="line">        watch.stop();</span><br><span class="line">        log.info(<span class="string">"===&gt; åˆ é™¤é‡å¤æ­Œæ›²æ“ä½œæ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šæ—¶åˆ é™¤æ— ç‰ˆæƒçš„æ­Œæ›²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobWithParamsAndSleep</span><span class="params">(String params)</span> </span>{</span><br><span class="line">        StopWatch watch = CommonProvide.getWatchStart();</span><br><span class="line">        log.info(<span class="string">"===&gt; å¼€å§‹æ‰§è¡Œåˆ é™¤æ— ç‰ˆæƒæ­Œæ›²æ“ä½œ &lt;==="</span>);</span><br><span class="line">        songService.removeNoCopyrightSong();</span><br><span class="line">        watch.stop();</span><br><span class="line">        log.info(<span class="string">"===&gt; åˆ é™¤æ— ç‰ˆæƒæ­Œæ›²æ“ä½œæ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeMillis());</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¯åŠ¨åˆå§‹åŒ–"><a href="#å¯åŠ¨åˆå§‹åŒ–" class="headerlink" title="å¯åŠ¨åˆå§‹åŒ–"></a>å¯åŠ¨åˆå§‹åŒ–</h3><blockquote>
<p>åˆ©ç”¨<code>CommandLineRunner</code>æ¥å£ï¼Œå®ç°ä»»åŠ¡å¯åŠ¨åˆå§‹åŒ–</p>
<p>å®ç°åŸç†ï¼šä»æ•°æ®åº“ä¸­æ‹‰å–ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ï¼Œåœ¨é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­è¿›è¡Œä»»åŠ¡çš„å¾ªç¯æ³¨å†Œï¼Œå®ç°ä»»åŠ¡è°ƒåº¦çš„åˆå§‹åŒ–ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.init;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.common.CommonProvide;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.entity.Task;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.handler.CronTaskRegistrar;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.handler.SchedulingRunnable;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.TaskService;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.util.ThreadUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å®šæ—¶ä»»åŠ¡åˆå§‹åŒ–: åœ¨åº”ç”¨å¯åŠ¨å,æ‰§è¡Œçš„ä¸€æ®µä»£ç é€»è¾‘,å¹¶ä¸”åªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/11 9:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Order(1)</span> <span class="comment">// ç”¨@Orderæ³¨è§£å»è®¾ç½®å¤šä¸ªCommandLineRunnerå®ç°ç±»çš„æ‰§è¡Œé¡ºåº,valueè¶Šå°,æ‰§è¡Œé¡ºåºä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JobRunnerInit</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CronTaskRegistrar cronTaskRegistrar;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤runæ–¹æ³•å®åœ¨ä¸»çº¿ç¨‹çš„runæ–¹æ³•æ‰§è¡Œä¹‹å‰è¿›è¡Œæ‰§è¡Œçš„,å¦‚æœæ­¤runæ–¹æ³•å¼‚å¸¸,ä¼šå½±å“ä¸»çº¿ç¨‹çš„runæ–¹æ³•çš„æ‰§è¡Œå¯åŠ¨</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥,è¿™é‡Œè¦å¦å¼€è¾Ÿä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹,å³ä½¿æ‰§è¡Œå‡ºé”™,ä¹Ÿä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹ä¸šåŠ¡;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"å®šæ—¶ä»»åŠ¡åˆå§‹åŒ–å¼€å§‹..."</span>);</span><br><span class="line">        StopWatch watch = CommonProvide.getWatchStart();</span><br><span class="line">        <span class="comment">// æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">        ThreadUtils.executor.execute(<span class="keyword">new</span> JonInit());</span><br><span class="line">        watch.stop();</span><br><span class="line">        log.info(<span class="string">"å®šæ—¶ä»»åŠ¡åˆå§‹åŒ–ç»“æŸ,æ‰§è¡Œè€—æ—¶: {}ms"</span>, watch.getTotalTimeSeconds());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šæ—¶ä»»åŠ¡é€»è¾‘ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">JonInit</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">//  æŸ¥è¯¢status=trueçš„ä»»åŠ¡,å¹¶å¼€å¯ä»»åŠ¡</span></span><br><span class="line">            List&lt;Task&gt; tasks = taskService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;Task&gt;()</span><br><span class="line">                    .select(Task::getBeanName, Task::getMethodName, Task::getMethodParams, Task::getCron)</span><br><span class="line">                    .eq(Task::getJobStatus, <span class="keyword">true</span>));</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(tasks)) {</span><br><span class="line">                tasks.forEach(task -&gt; {</span><br><span class="line">                    String methodParams = task.getMethodParams();</span><br><span class="line">                    String beanName = task.getBeanName();</span><br><span class="line">                    String methodName = task.getMethodName();</span><br><span class="line">                    SchedulingRunnable job;</span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isNotBlank(methodParams)) {</span><br><span class="line">                        job = <span class="keyword">new</span> SchedulingRunnable(beanName, methodName, methodParams);</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        job = <span class="keyword">new</span> SchedulingRunnable(beanName, methodName);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">// å¼€å¯ä»»åŠ¡</span></span><br><span class="line">                    cronTaskRegistrar.addCronTask(job, task.getCron());</span><br><span class="line">                    log.info(<span class="string">"å®šæ—¶ä»»åŠ¡åˆå§‹åŒ–æˆåŠŸ - beanï¼š{}ï¼Œæ–¹æ³•ï¼š{}ï¼Œå‚æ•°ï¼š{}"</span>, beanName, methodName, methodParams);</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä»»åŠ¡è°ƒåº¦æ§åˆ¶"><a href="#ä»»åŠ¡è°ƒåº¦æ§åˆ¶" class="headerlink" title="ä»»åŠ¡è°ƒåº¦æ§åˆ¶"></a>ä»»åŠ¡è°ƒåº¦æ§åˆ¶</h3><blockquote>
<p>ç»“åˆé¡µé¢ï¼Œå®ç°ä»»åŠ¡è°ƒåº¦çš„Controlleræ§åˆ¶å±‚ï¼Œå®ç°ä»»åŠ¡è°ƒåº¦çš„å¯åŠ¨ã€æš‚å®šã€æ¢å¤ã€åˆ é™¤ç­‰æ“ä½œã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@NoRepeatSubmit</span></span><br><span class="line">   <span class="meta">@OperatingLog(operType = BlogConstants.ADD, operDesc = "åˆ›å»ºä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@ApiOperation(httpMethod = "POST", value = "å¼€å¯å®šæ—¶ä»»åŠ¡", notes = "æ ¹æ®cronè¡¨è¾¾å¼å¼€å¯ä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@PostMapping("/start")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">startTask</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> Task task)</span> </span>{</span><br><span class="line">       <span class="comment">// æ ¡éªŒå‚æ•°</span></span><br><span class="line">       <span class="keyword">if</span> (ObjectUtils.isEmpty(task)) {</span><br><span class="line">           <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// ä¿å­˜ä»»åŠ¡ä¿¡æ¯</span></span><br><span class="line">       <span class="keyword">boolean</span> success = taskService.saveJobInfo(task);</span><br><span class="line">       <span class="keyword">if</span> (!success) {</span><br><span class="line">           <span class="keyword">return</span> R.error().message(<span class="string">"ä»»åŠ¡åˆ›å»ºå¤±è´¥"</span>);</span><br><span class="line">       }</span><br><span class="line">       String cron = task.getCron();</span><br><span class="line">       String beanName = task.getBeanName();</span><br><span class="line">       String methodName = task.getMethodName();</span><br><span class="line">       String methodParams = task.getMethodParams();</span><br><span class="line">       <span class="comment">// å¼€å¯ä»»åŠ¡</span></span><br><span class="line">       <span class="keyword">if</span> (task.getJobStatus() &amp;&amp; StringUtils.isNoneBlank(beanName, methodName)) {</span><br><span class="line">           SchedulingRunnable job = getSchedulingRunnable(methodName, beanName, methodParams);</span><br><span class="line">           cronTaskRegistrar.addCronTask(job, cron);</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> R.ok().message(<span class="string">"ä»»åŠ¡åˆ›å»ºæˆåŠŸ"</span>);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiOperation(httpMethod = "GET", value = "è·å–ä»»åŠ¡ä¿¡æ¯", notes = "æ ¹æ®ä»»åŠ¡IDæŸ¥è¯¢ä»»åŠ¡ä¿¡æ¯")</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = "jobId", value = "ä»»åŠ¡ID", required = true, dataType = "String", paramType = "path")</span></span><br><span class="line">   <span class="meta">@GetMapping("/query/{jobId}")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">queryTaskById</span><span class="params">(<span class="meta">@PathVariable("jobId")</span> String jobId)</span> </span>{</span><br><span class="line">       Task task = taskService.getById(jobId);</span><br><span class="line">       <span class="keyword">return</span> R.ok().data(<span class="string">"item"</span>, task);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åªå…è®¸ä¿®æ”¹ cronè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE, operDesc = "æ›´æ–°ä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@ApiOperation(httpMethod = "PUT", value = "æ›´æ–°å®šæ—¶ä»»åŠ¡", notes = "æ ¹æ®cronè¡¨è¾¾å¼æ›´æ–°ä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@PutMapping("/edit")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">editTask</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> Task task)</span> </span>{</span><br><span class="line">       <span class="comment">// æ ¡éªŒå‚æ•°</span></span><br><span class="line">       <span class="keyword">if</span> (ObjectUtils.isEmpty(task)) {</span><br><span class="line">           <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// æ›´æ–°ä»»åŠ¡ä¿¡æ¯</span></span><br><span class="line">       <span class="keyword">boolean</span> success = taskService.updateJobInfo(task);</span><br><span class="line">       <span class="keyword">if</span> (!success) {</span><br><span class="line">           <span class="keyword">return</span> R.error().message(<span class="string">"ä»»åŠ¡ä¿®æ”¹å¤±è´¥"</span>);</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// å…ˆç§»é™¤æ—§ä»»åŠ¡,å†å¯åŠ¨æ–°ä»»åŠ¡</span></span><br><span class="line">       String cron = task.getCron();</span><br><span class="line">       String beanName = task.getBeanName();</span><br><span class="line">       String methodName = task.getMethodName();</span><br><span class="line">       String methodParams = task.getMethodParams();</span><br><span class="line">       SchedulingRunnable job = getSchedulingRunnable(methodName, beanName, methodParams);</span><br><span class="line">       cronTaskRegistrar.removeCronTask(job);</span><br><span class="line">       <span class="comment">// æ–°å¢</span></span><br><span class="line">       cronTaskRegistrar.addCronTask(job, cron);</span><br><span class="line">       <span class="keyword">return</span> R.ok().message(<span class="string">"ä»»åŠ¡ä¿®æ”¹æˆåŠŸ"</span>);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="meta">@OperatingLog(operType = BlogConstants.REMOVE, operDesc = "åˆ é™¤ä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@ApiOperation(httpMethod = "DELETE", value = "ç§»é™¤å®šæ—¶ä»»åŠ¡", notes = "æ ¹æ®ä»»åŠ¡iç§»é™¤ä»»åŠ¡è°ƒåº¦")</span></span><br><span class="line">   <span class="meta">@DeleteMapping("/remove/{jobId}")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">removeTask</span><span class="params">(<span class="meta">@PathVariable("jobId")</span> String jobId)</span> </span>{</span><br><span class="line">       Task task = taskService.getById(jobId);</span><br><span class="line">       <span class="comment">// ä»»åŠ¡æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (ObjectUtils.isEmpty(task)) {</span><br><span class="line">           <span class="keyword">return</span> R.error().message(<span class="string">"ä»»åŠ¡ä¸å­˜åœ¨"</span>);</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// æ ¡éªŒä»»åŠ¡ä¿¡æ¯</span></span><br><span class="line">       String beanName = task.getBeanName();</span><br><span class="line">       String methodName = task.getMethodName();</span><br><span class="line">       String methodParams = task.getMethodParams();</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isAnyBlank(beanName, methodName, methodParams)) {</span><br><span class="line">           <span class="keyword">return</span> R.error().message(<span class="string">"ä»»åŠ¡ç§»é™¤å¤±è´¥"</span>);</span><br><span class="line">       }</span><br><span class="line">       SchedulingRunnable job = getSchedulingRunnable(methodName, beanName, methodParams);</span><br><span class="line">       cronTaskRegistrar.removeCronTask(job);</span><br><span class="line">       <span class="comment">// ç§»é™¤æ•°æ®åº“æ•°æ®</span></span><br><span class="line">       taskService.removeJobInfoById(jobId);</span><br><span class="line">       <span class="keyword">return</span> R.ok().message(<span class="string">"ä»»åŠ¡ç§»é™¤æˆåŠŸ"</span>);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¹å˜å®šæ—¶ä»»åŠ¡çŠ¶æ€:æŸ¥è¯¢æ•°æ®åº“å¯¹åº”ä»»åŠ¡ä¿¡æ¯, statusä¸ºfalse:å¼€å¯ä»»åŠ¡,ä¸ºtrue:æš‚åœä»»åŠ¡</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE, operDesc = "æ›´æ–°ä»»åŠ¡çŠ¶æ€")</span></span><br><span class="line">   <span class="meta">@ApiOperation(httpMethod = "GET", value = "æ›´æ–°ä»»åŠ¡çŠ¶æ€", notes = "æ ¹æ®jobStatusæ›´æ–°ä»»åŠ¡çŠ¶æ€")</span></span><br><span class="line">   <span class="meta">@GetMapping("change/{jobId}")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">updateTaskStatus</span><span class="params">(<span class="meta">@PathVariable("jobId")</span> String jobId)</span> </span>{</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isBlank(jobId)) {</span><br><span class="line">           <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">       }</span><br><span class="line">       Task task = taskService.getById(jobId);</span><br><span class="line">       <span class="keyword">if</span> (ObjectUtils.isEmpty(task)) {</span><br><span class="line">           <span class="keyword">return</span> R.error().message(<span class="string">"ä»»åŠ¡ä¸å­˜åœ¨"</span>);</span><br><span class="line">       }</span><br><span class="line">       String cron = task.getCron();</span><br><span class="line">       Boolean status = task.getJobStatus();</span><br><span class="line">       String methodName = task.getMethodName();</span><br><span class="line">       String beanName = task.getBeanName();</span><br><span class="line">       String methodParams = task.getMethodParams();</span><br><span class="line"></span><br><span class="line">       SchedulingRunnable job = getSchedulingRunnable(methodName, beanName, methodParams);</span><br><span class="line">       <span class="comment">// å…³é—­ä»»åŠ¡(ç§»é™¤)</span></span><br><span class="line">       <span class="keyword">if</span> (status) {</span><br><span class="line">           <span class="comment">// ç§»é™¤</span></span><br><span class="line">           cronTaskRegistrar.removeCronTask(job);</span><br><span class="line">           <span class="comment">// æ›´æ–°statusçŠ¶æ€å€¼</span></span><br><span class="line">           taskService.updateJobInfo(<span class="keyword">new</span> Task().setId(jobId).setJobStatus(<span class="keyword">false</span>));</span><br><span class="line">           <span class="keyword">return</span> R.ok().message(<span class="string">"ä»»åŠ¡æš‚åœæˆåŠŸ"</span>);</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           <span class="comment">// å¼€å¯</span></span><br><span class="line">           cronTaskRegistrar.addCronTask(job, cron);</span><br><span class="line">           taskService.updateJobInfo(<span class="keyword">new</span> Task().setId(jobId).setJobStatus(<span class="keyword">true</span>));</span><br><span class="line">           <span class="keyword">return</span> R.ok().message(<span class="string">"ä»»åŠ¡å¼€å¯æˆåŠŸ"</span>);</span><br><span class="line">       }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è·å–Runnableä»»åŠ¡</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> methodName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> methodParams</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SchedulingRunnable <span class="title">getSchedulingRunnable</span><span class="params">(String methodName, String beanName, String methodParams)</span> </span>{</span><br><span class="line">       SchedulingRunnable job;</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isNotBlank(methodParams)) {</span><br><span class="line">           job = <span class="keyword">new</span> SchedulingRunnable(beanName, methodName, methodParams);</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           job = <span class="keyword">new</span> SchedulingRunnable(beanName, methodName);</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> job;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h3><h4 id="ä»»åŠ¡åˆ—è¡¨"><a href="#ä»»åŠ¡åˆ—è¡¨" class="headerlink" title="ä»»åŠ¡åˆ—è¡¨"></a>ä»»åŠ¡åˆ—è¡¨</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801143347.png" alt="ä»»åŠ¡åˆ—è¡¨"></p>
<h4 id="ä»»åŠ¡æ³¨å†Œ"><a href="#ä»»åŠ¡æ³¨å†Œ" class="headerlink" title="ä»»åŠ¡æ³¨å†Œ"></a>ä»»åŠ¡æ³¨å†Œ</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801143455.png" alt="ä»»åŠ¡æ³¨å†Œ"></p>
<h4 id="ä»»åŠ¡æ—¥å¿—"><a href="#ä»»åŠ¡æ—¥å¿—" class="headerlink" title="ä»»åŠ¡æ—¥å¿—"></a>ä»»åŠ¡æ—¥å¿—</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801143620.png" alt="ä»»åŠ¡æ—¥å¿—"></p>
<h4 id="ä»»åŠ¡å›¾è¡¨"><a href="#ä»»åŠ¡å›¾è¡¨" class="headerlink" title="ä»»åŠ¡å›¾è¡¨"></a>ä»»åŠ¡å›¾è¡¨</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801143732.png" alt="ä»»åŠ¡å›¾è¡¨"></p>
<h2 id="cronè¡¨è¾¾å¼ç®€æ"><a href="#cronè¡¨è¾¾å¼ç®€æ" class="headerlink" title="cronè¡¨è¾¾å¼ç®€æ"></a>cronè¡¨è¾¾å¼ç®€æ</h2><figure class="highlight crystal"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>. Seconds ï¼ˆç§’ï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>. Minutes ï¼ˆåˆ†ï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">3</span>. Hours ï¼ˆæ—¶ï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">4</span>. Day-<span class="keyword">of</span>-Month ï¼ˆå¤©ï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">5</span>. Month ï¼ˆæœˆï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">6</span>. Day-<span class="keyword">of</span>-Week ï¼ˆå‘¨ï¼‰ </span><br><span class="line"> </span><br><span class="line"><span class="number">7</span>. Year (å¹´ å¯é€‰å­—æ®µ) </span><br><span class="line"> </span><br><span class="line">Seconds (ç§’) ï¼šå¯ä»¥ç”¨æ•°å­—<span class="number">0</span>ï¼<span class="number">59</span> è¡¨ç¤ºï¼›</span><br><span class="line"> </span><br><span class="line">Minutes(åˆ†) ï¼šå¯ä»¥ç”¨æ•°å­—<span class="number">0</span>ï¼<span class="number">59</span> è¡¨ç¤ºï¼›</span><br><span class="line"> </span><br><span class="line">Hours(æ—¶) ï¼šå¯ä»¥ç”¨æ•°å­—<span class="number">0</span>-<span class="number">23</span>è¡¨ç¤ºï¼›</span><br><span class="line"> </span><br><span class="line">Day-<span class="keyword">of</span>-Month(å¤©) ï¼šå¯ä»¥ç”¨æ•°å­—<span class="number">1</span>-<span class="number">31</span> ä¸­çš„ä»»ä¸€ä¸€ä¸ªå€¼ï¼Œä½†è¦æ³¨æ„ä¸€äº›ç‰¹åˆ«çš„æœˆä»½<span class="number">2</span>æœˆä»½æ²¡æœ‰åªèƒ½<span class="number">1</span>-<span class="number">28</span>ï¼Œæœ‰äº›æœˆä»½æ²¡æœ‰<span class="number">31</span>ï¼›</span><br><span class="line"> </span><br><span class="line">Month(æœˆ) ï¼šå¯ä»¥ç”¨<span class="number">0</span>-<span class="number">11</span> æˆ–ç”¨å­—ç¬¦ä¸² â€œJAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV and DECâ€ è¡¨ç¤ºï¼›</span><br><span class="line"> </span><br><span class="line">Day-<span class="keyword">of</span>-Week(*æ¯å‘¨*)*ï¼š*å¯ä»¥ç”¨æ•°å­—<span class="number">1</span>-<span class="number">7</span>è¡¨ç¤ºï¼ˆ<span class="number">1</span> ï¼ æ˜ŸæœŸæ—¥ï¼‰æˆ–ç”¨å­—ç¬¦å£ä¸²â€œSUN, MON, TUE, WED, THU, FRI and SATâ€è¡¨ç¤ºï¼›</span><br><span class="line"> </span><br><span class="line">â€œ/â€ï¼šä¸ºç‰¹åˆ«å•ä½ï¼Œè¡¨ç¤ºä¸ºâ€œæ¯â€å¦‚â€œ<span class="number">0</span>/<span class="number">10</span>â€è¡¨ç¤ºæ¯éš”<span class="number">10</span>åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡,â€œ<span class="number">0</span>â€è¡¨ç¤ºä¸ºä»â€œ<span class="number">0</span>â€åˆ†å¼€å§‹, â€œ<span class="number">3</span>/<span class="number">20</span>â€è¡¨ç¤ºè¡¨ç¤ºæ¯éš”<span class="number">20</span>åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œâ€œ<span class="number">3</span>â€è¡¨ç¤ºä»ç¬¬<span class="number">3</span>åˆ†é’Ÿå¼€å§‹æ‰§è¡Œï¼›</span><br><span class="line"> </span><br><span class="line">â€œ?â€ï¼šè¡¨ç¤ºæ¯æœˆçš„æŸä¸€å¤©ï¼Œæˆ–ç¬¬å‘¨çš„æŸä¸€å¤©ï¼›</span><br><span class="line"> </span><br><span class="line">â€œLâ€ï¼šç”¨äºæ¯æœˆï¼Œæˆ–æ¯å‘¨ï¼Œè¡¨ç¤ºä¸ºæ¯æœˆçš„æœ€åä¸€å¤©ï¼Œæˆ–æ¯ä¸ªæœˆçš„æœ€åæ˜ŸæœŸå‡ å¦‚â€œ<span class="number">6</span>Lâ€è¡¨ç¤ºâ€œæ¯æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸäº”â€ï¼›</span><br><span class="line"> </span><br><span class="line">â€œWâ€ï¼šè¡¨ç¤ºä¸ºæœ€è¿‘å·¥ä½œæ—¥ï¼Œå¦‚â€œ<span class="number">15</span>Wâ€æ”¾åœ¨æ¯æœˆï¼ˆday-<span class="keyword">of</span>-monthï¼‰å­—æ®µä¸Šè¡¨ç¤ºä¸ºâ€œåˆ°æœ¬æœˆ<span class="number">15</span>æ—¥æœ€è¿‘çš„å·¥ä½œæ—¥â€ï¼›</span><br><span class="line"> </span><br><span class="line">â€œ<span class="comment">#â€ï¼šæ˜¯ç”¨æ¥æŒ‡å®šâ€œçš„â€æ¯æœˆç¬¬nä¸ªå·¥ä½œæ—¥,ä¾‹ åœ¨æ¯å‘¨ï¼ˆday-of-weekï¼‰è¿™ä¸ªå­—æ®µä¸­å†…å®¹ä¸ºâ€6#3â€ or â€œFRI#3â€ åˆ™è¡¨ç¤ºâ€œæ¯æœˆç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”â€ï¼›</span></span><br><span class="line"> </span><br><span class="line">â€œ*â€ ä»£è¡¨æ•´ä¸ªæ—¶é—´æ®µã€‚</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Schedule</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootç»“åˆRedisçš„bitmapå®ç°ç­¾åˆ°åŠŸèƒ½å’Œå¸ƒéš†è¿‡æ»¤å™¨</title>
    <url>/post/55036.html</url>
    <content><![CDATA[<h1 id="SpringBootç»“åˆRedisçš„bitmapå®ç°ç­¾åˆ°åŠŸèƒ½å’Œå¸ƒéš†è¿‡æ»¤å™¨"><a href="#SpringBootç»“åˆRedisçš„bitmapå®ç°ç­¾åˆ°åŠŸèƒ½å’Œå¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="SpringBootç»“åˆRedisçš„bitmapå®ç°ç­¾åˆ°åŠŸèƒ½å’Œå¸ƒéš†è¿‡æ»¤å™¨"></a>SpringBootç»“åˆRedisçš„bitmapå®ç°ç­¾åˆ°åŠŸèƒ½å’Œå¸ƒéš†è¿‡æ»¤å™¨</h1><h2 id="æ¯æœˆç­¾åˆ°"><a href="#æ¯æœˆç­¾åˆ°" class="headerlink" title="æ¯æœˆç­¾åˆ°"></a>æ¯æœˆç­¾åˆ°</h2><blockquote>
<p>ç­¾åˆ°åŠŸèƒ½éœ€æ±‚ï¼š</p>
<ul>
<li>è®°å½•æ¯ä¸ªç”¨æˆ·æ¯æœˆçš„ç­¾åˆ°æƒ…å†µï¼ˆç­¾åˆ°æˆ–è€…æœªç­¾åˆ°ã€ç­¾åˆ°æ€»å¤©æ•°ã€æ€»è¿ç»­åˆ°å¤©æ•°ç­‰ï¼‰ï¼Œè¿™é‡Œï¼ŒåŸºäºç”¨æˆ·IDï¼ˆuserIdï¼‰å’Œæ¯æœˆæ—¥æœŸï¼ˆyyyyMMï¼‰ä½œä¸ºkeyï¼Œç»“åˆRedisä¸­çš„<code>bitmap</code>æ•°æ®ç»“æ„ï¼Œå®ç°ç”¨æˆ·æ¯æœˆç­¾åˆ°æƒ…å†µè®°å½•çš„åŠŸèƒ½ã€‚</li>
</ul>
<p><strong>æœ¬æ–‡ç»“åˆä»…ä»…å®é™…ä»£ç ç‰‡æ®µï¼Œè¿›è¡Œç­¾åˆ°åŠŸèƒ½å¤ç°ï¼ˆé‡åœ¨æ ¸å¿ƒé€»è¾‘ï¼Œå› ä¸ºæ¯ä¸ªç­¾åˆ°éœ€æ±‚å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼‰</strong></p>
</blockquote>
<h3 id="ç‰‡æ®µè®²è§£"><a href="#ç‰‡æ®µè®²è§£" class="headerlink" title="ç‰‡æ®µè®²è§£"></a>ç‰‡æ®µè®²è§£</h3><h4 id="å…¬å…±ä»£ç ç‰‡æ®µ"><a href="#å…¬å…±ä»£ç ç‰‡æ®µ" class="headerlink" title="å…¬å…±ä»£ç ç‰‡æ®µ"></a>å…¬å…±ä»£ç ç‰‡æ®µ</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®requestè·å–ç»„è£…å‚æ•°key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getKey</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">    <span class="comment">// æ ¡éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    User user = commonProvide.getAdminUserByRequest(request);</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"sign:%s:%s"</span>, user.getId(), LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyyMM"</span>)));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®UserInfoè·å–ç»„è£…å‚æ•°key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userInfo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getKey</span><span class="params">(UserInfo userInfo)</span> </span>{</span><br><span class="line">    String userId = userInfo.getId();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(userId)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    log.info(<span class="string">"tokenè§£ææˆåŠŸ ==&gt; {}"</span>, userInfo);</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"sign:%s:%s"</span>, userId, LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyyMM"</span>)));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç¬¦åˆredisä½å›¾åç§»é‡çš„å€¼(ä»0å¼€å§‹çš„,æ‰€ä»¥è¿™é‡Œ-1)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Integer <span class="title">getOffset</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> LocalDate.now().getDayOfMonth() - <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å‘½ä»¤ä»£ç ç‰‡æ®µ"><a href="#å‘½ä»¤ä»£ç ç‰‡æ®µ" class="headerlink" title="å‘½ä»¤ä»£ç ç‰‡æ®µ"></a>å‘½ä»¤ä»£ç ç‰‡æ®µ</h4><h5 id="setbit"><a href="#setbit" class="headerlink" title="setbit"></a>setbit</h5><blockquote>
<p>rediså‘½ä»¤ï¼š<code>SETBIT key offset value</code></p>
<p>å‘½ä»¤å«ä¹‰ï¼šå°†åä¸ºkeyçš„ç¬¬offsetä½çš„å€¼ç½®ä¸º 1ï¼Œï¼ˆoffsetåç§»é‡ä» 0 å¼€å§‹ï¼‰</p>
<p>é€»è¾‘ç†è§£ï¼šæŠŠæ¯æœˆçš„æ¯å¤©æ˜¯å½“æœˆçš„ç¬¬å¤šå°‘å¤©è®¡ç®—å‡ºæ¥ï¼Œä½œä¸º offset åç§»é‡çš„å€¼ã€‚å¦‚æœå½“å¤©ç­¾åˆ°ï¼Œå°±æŠŠå¯¹åº”ä½çš„å€¼ç½®ä¸º 1ï¼Œå¦åˆ™é»˜è®¤å€¼å°±ä¸º 0ã€‚åé¢å¯æ ¹æ®1å’Œ0çš„å€¼å³å¯å¾—å‡ºç”¨æˆ·æ¯æœˆçš„ç­¾åˆ°æƒ…å†µã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"># è®¾ç½®å¯¹åº”åç§»é‡çš„ä½ç½®å€¼ä¸º true(ç½®ä¸º1)</span><br><span class="line"># æ³¨æ„ç»“æœè¿”å›çš„æ²¡æœ‰è®¾ç½®å€¼ä¹‹å‰çš„å€¼ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤å€¼0ï¼Œæ‰€ä»¥ï¼Œç»“æœè¿”å›å€¼ isSet æ˜¯ false</span><br><span class="line"><span class="keyword">boolean</span> isSet = redisTemplate.opsForValue().setBit(key, <span class="keyword">this</span>.getOffset(), <span class="keyword">true</span>);</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h5 id="getbit"><a href="#getbit" class="headerlink" title="getbit"></a>getbit</h5><blockquote>
<p>rediså‘½ä»¤ï¼š<code>GETBIT    key offset</code></p>
<p>å‘½ä»¤å«ä¹‰ï¼šè·å–ç¬¬ offset ä½çš„å¯¹åº”å€¼</p>
<p>é€»è¾‘ç†è§£ï¼šä½¿ç”¨setbitå‘½ä»¤è¿›è¡Œç­¾åˆ°åï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤è·å– ç”¨æˆ·å½“å‰çš„ç­¾åˆ°çŠ¶æ€ï¼ˆå·²ç­¾åˆ°ï¼šè¿”å›trueï¼Œæœªç­¾åˆ°ï¼šè¿”å›falseï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkSignIn</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForValue().getBit(<span class="keyword">this</span>.getKey(request), <span class="keyword">this</span>.getOffset());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h5 id="bitcount"><a href="#bitcount" class="headerlink" title="bitcount"></a>bitcount</h5><blockquote>
<p>rediså‘½ä»¤ï¼š<code>BITCOUNT key start end</code></p>
<p>å‘½ä»¤å«ä¹‰ï¼šæ ¹æ®keyè·å–å¯¹åº”å€¼çš„start åˆ° end èŒƒå›´å†… 1 çš„ä¸ªæ•° ï¼ˆstart ,endä¸å†™ é»˜è®¤è·å–å…¨éƒ¨èŒƒå›´ï¼Œæˆ–è€… 0 -1 ä¹Ÿè¡¨ç¤ºå…¨éƒ¨èŒƒå›´ï¼‰</p>
<p>é€»è¾‘ç†è§£ï¼šä½¿ç”¨æ­¤å‘½ä»¤è·å–ç”¨æˆ·å½“æœˆçš„æ€»ç­¾åˆ°æ•°</p>
<p>æ³¨æ„ï¼šredisTemplateå¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„æ–¹æ³•æ¥è°ƒç”¨bitcountï¼Œå¯ä»¥é€šè¿‡<code>redisTemplate.execute</code>æ¥æ‰§è¡Œbitcountæ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ¬æœˆç­¾åˆ°æ€»å¤©æ•°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">signTotalDaysOfMonth</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) cal -&gt; cal.bitCount(<span class="keyword">this</span>.getKey(request).getBytes()));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h5 id="bitfield"><a href="#bitfield" class="headerlink" title="bitfield"></a>bitfield</h5><blockquote>
<p>rediså‘½ä»¤ï¼š<code>BITFIELD key get [u/i]offset start</code></p>
<p>å‘½ä»¤å«ä¹‰ï¼š</p>
<ul>
<li>uï¼šä»£è¡¨æ— ç¬¦å·ä½</li>
<li>iï¼šä»£è¡¨æœ‰ç¬¦å·ä½</li>
<li>startï¼šä»£è¡¨ä»å“ªä¸€ä½å¼€å§‹è·å–ï¼Œ0ä»£è¡¨ä»ç¬¬ä¸€ä½å¼€å§‹è·å–</li>
<li>offsetï¼šä»£è¡¨å…±è·å–å¤šå°‘ä½çš„å€¼</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210729214304.png" alt="bitfieldå‘½ä»¤ç¤ºä¾‹"></p>
<p>é€»è¾‘ç†è§£ï¼šä½¿ç”¨ bitfield è·å–ç”¨æˆ·ç­¾åˆ°çš„æ€»å€¼ï¼Œå†æ ¹æ®å…¶ä»–çš„é€»è¾‘è¿›è¡Œè®¡ç®—è·å– æ­¤ç”¨æˆ·æ¯æœˆçš„è¿ç»­ç­¾åˆ°æƒ…å†µã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è¿ç»­ç­¾åˆ°å¤©æ•°(ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userInfo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">continuousSignDay</span><span class="params">(UserInfo userInfo)</span> </span>{</span><br><span class="line">    <span class="comment">// åç§»é‡ä» 1 å¼€å§‹</span></span><br><span class="line">    <span class="keyword">int</span> offset = <span class="keyword">this</span>.getOffset() + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è¿ç»­ç­¾åˆ°æ¬¡æ•°æ ‡è¯†,åˆå§‹å€¼ä¸º0</span></span><br><span class="line">    <span class="keyword">int</span> signCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è·å–æ­¤ç”¨æˆ·ç­¾åˆ°çš„æƒ…å†µçš„å€¼,è¿”å›çš„Listé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; list = redisTemplate.opsForValue().bitField(<span class="keyword">this</span>.getKey(userInfo),</span><br><span class="line">            BitFieldSubCommands.create().get(BitFieldSubCommands.BitFieldType.unsigned(offset)).valueAt(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(list)) {</span><br><span class="line">        <span class="comment">// åŸç†: è·å–ä½ä½è¿ç»­ä¸ä¸º0çš„ä¸ªæ•°,å°±æ˜¯è¿ç»­ç­¾åˆ°çš„æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">long</span> v = list.get(<span class="number">0</span>) == <span class="keyword">null</span> ? <span class="number">0</span> : list.get(<span class="number">0</span>);</span><br><span class="line">        log.info(<span class="string">"v == {}"</span>, v);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; offset; i++) {</span><br><span class="line">            <span class="comment">// å…ˆå³ç§»å†å·¦ç§», å¦‚æœå’ŒåŸå€¼ç›¸ç­‰ä»£è¡¨ä½ä½ä¸º0</span></span><br><span class="line">            <span class="keyword">if</span> (v &gt;&gt; <span class="number">1</span> &lt;&lt; <span class="number">1</span> == v) {</span><br><span class="line">                <span class="keyword">return</span> signCount;</span><br><span class="line">            }</span><br><span class="line">            signCount++;</span><br><span class="line">            v &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> signCount;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<p>æ ¹æ®å’Œä¸Šé¢ç±»ä¼¼çš„é€»è¾‘ï¼Œè·å–ç”¨æˆ·å½“æœˆæ¯å¤©çš„ç­¾åˆ°æƒ…å†µ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æˆªè‡³ç›®å‰å½“æœˆçš„ç­¾åˆ°æƒ…å†µ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CalendarInfoVO&gt; <span class="title">signMapInfo</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">    List&lt;CalendarInfoVO&gt; signList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="comment">// åç§»é‡ä» 1 å¼€å§‹</span></span><br><span class="line">    <span class="keyword">int</span> offset = <span class="keyword">this</span>.getOffset() + <span class="number">1</span>;</span><br><span class="line">    List&lt;Long&gt; list = redisTemplate.opsForValue().bitField(<span class="keyword">this</span>.getKey(request),</span><br><span class="line">            BitFieldSubCommands.create().get(BitFieldSubCommands.BitFieldType.unsigned(offset)).valueAt(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(list)) {</span><br><span class="line">        <span class="keyword">long</span> v = list.get(<span class="number">0</span>) == <span class="keyword">null</span> ? <span class="number">0</span> : list.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &gt; <span class="number">0</span>; i--) {</span><br><span class="line">            signList.add(<span class="keyword">new</span> CalendarInfoVO(LocalDate.now().withDayOfMonth(i).toString(),</span><br><span class="line">                    v &gt;&gt; <span class="number">1</span> &lt;&lt; <span class="number">1</span> != v ? <span class="string">"ğŸ˜€"</span> : <span class="string">"â˜ "</span>));</span><br><span class="line">            v &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> signList;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/6 20:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalendarInfoVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="bitop"><a href="#bitop" class="headerlink" title="bitop"></a>bitop</h5><blockquote>
<p>rediså‘½ä»¤ï¼š<code>bitop [add/or/xop/not] destKey keysâ€¦</code></p>
<p>å‘½ä»¤å«ä¹‰ï¼š</p>
<ul>
<li><code>and</code>ï¼šå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚ <strong>é€»è¾‘å¹¶</strong>ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> </li>
<li><code>or</code>ï¼šå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚ <strong>é€»è¾‘æˆ–</strong>ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> </li>
<li><code>xor</code>ï¼šå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚ <strong>é€»è¾‘å¼‚æˆ–</strong>ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code></li>
<li><code>not</code>ï¼šå¯¹ç»™å®š <code>key</code> æ±‚é€»è¾‘éï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> </li>
<li><strong>æ³¨æ„ï¼šé™¤ <code>not</code> æ“ä½œå¤–ï¼Œå…¶ä½™æ“ä½œéƒ½æ”¯æŒä¸€æ¬¡è¾“å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªkey</strong></li>
</ul>
<p>é€»è¾‘ç†è§£ï¼šä½¿ç”¨ ç”¨æˆ·id å»åŒ¹é…æŸ¥è¯¢ç”±è‡ªå·±ç­¾åˆ°ç”Ÿæˆçš„ bitmapå€¼ï¼Œé€šè¿‡bitopå‘½ä»¤ç»Ÿè®¡æ­¤ç”¨æˆ·çš„ç­¾åˆ°æ€»å¤©æ•°ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹ç¬¦åˆæŒ‡å®šæ ¼å¼çš„keyå€¼è¿›è¡Œæœªæ“ä½œ(å¯ä»¥ç”¨æ¥è·å–ç”¨æˆ·çš„æ€»ç­¾åˆ°å¤©æ•°)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> op  æ“ä½œç±»å‹ï¼šä¸ã€æˆ–ã€å¼‚æˆ–ã€å¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> destKey å­˜æ”¾ç»“æœçš„é”®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pattern ç”¨äºåŒ¹é…çš„key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç”¨æˆ·ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">queryUserSignInTotalDay</span><span class="params">(RedisStringCommands.BitOperation op, String destKey, String pattern)</span> </span>{</span><br><span class="line">    Set&lt;String&gt; keys = redisTemplate.keys(pattern);</span><br><span class="line">    <span class="keyword">if</span> (PublicUtil.isEmpty(keys)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[][] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[keys.size()][];</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (String key : keys) {</span><br><span class="line">        bytes[index++] = key.getBytes();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// è®¾ç½®å­˜æ”¾ç»“æœçš„key</span></span><br><span class="line">    <span class="keyword">byte</span>[] resultKey = destKey.getBytes();</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ bitop æ“ä½œ,å°†è·å–çš„ç»“æœæ”¾å…¥ resultKey ä¸­</span></span><br><span class="line">    redisTemplate.execute((RedisCallback&lt;Long&gt;) cal -&gt; cal.bitOp(op, resultKey, bytes));</span><br><span class="line">    <span class="comment">// è·å– resultKey çš„ç»“æœå€¼</span></span><br><span class="line">    <span class="keyword">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) cal -&gt; cal.bitCount(resultKey));</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="ç‰‡æ®µå°è£…"><a href="#ç‰‡æ®µå°è£…" class="headerlink" title="ç‰‡æ®µå°è£…"></a>ç‰‡æ®µå°è£…</h4><blockquote>
<p>ç”±äºä½¿ç”¨ redisTemplate.execute æ‰§è¡Œçš„ä»£ç é‡è¾ƒå¤§ï¼Œè¿™é‡Œè¿›è¡Œç®€å•çš„å°è£…ï¼Œä»¥åå¯ä»¥ç›´æ¥è°ƒç”¨å°è£…æ–¹æ³•å³å¯ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// å•¦å•¦å•¦</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h2><blockquote>
<p>Redisä¸­å¸ƒéš†è¿‡æ»¤å™¨çš„å®‰è£…è¿‡ç¨‹ï¼Œè¯·å‚è€ƒæ–‡ç« ï¼š<a href="http://www.horsemuzi.top/JAVA/SpringBootå°æ‚è®°/">SpringBootå°æ‚è®°</a> å³å¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åŸºäºredisä¸­çš„bitmapæ•°æ®ç»“æ„åº”ç”¨è€Œæ¥ã€‚</p>
</blockquote>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><blockquote>
<ul>
<li>æœ‰æ•ˆè§£å†³redisçš„<code>ç¼“å­˜ç©¿é€</code>é—®é¢˜</li>
<li>å¤§æ•°æ®é‡å»é‡åœºæ™¯ï¼ˆæŠ–éŸ³æ¨èï¼Œurlå»é‡ç­‰ç­‰ï¼‰</li>
</ul>
<p>ç®€æ´ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801131053.png" alt="å¸ƒéš†è¿‡æ»¤å™¨ç»“æ„ç®€ä»‹"></p>
</blockquote>
<h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><blockquote>
<p>å‰æœŸå‡†å¤‡ï¼š</p>
<ul>
<li>å¼•å…¥<code>guava</code>å·¥å…·åŒ…ï¼Œç¼–å†™hashå‡½æ•°æ ¸å¿ƒæ–¹æ³•</li>
<li>æ„å»ºredisTemplateç®€å•é…ç½®ï¼ˆåº”ç”¨å¼•å…¥redisæ—¶å°±å·²å®Œæˆï¼‰</li>
</ul>
</blockquote>
<h4 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>20.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ„é€ hashå¤„ç†"><a href="#æ„é€ hashå¤„ç†" class="headerlink" title="æ„é€ hashå¤„ç†"></a>æ„é€ hashå¤„ç†</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.base.Preconditions;</span><br><span class="line"><span class="keyword">import</span> com.google.common.hash.Funnel;</span><br><span class="line"><span class="keyword">import</span> com.google.common.hash.Hashing;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> å€ŸåŠ©guavaå·¥å…·åŒ…å®ç°Rediså¸ƒéš†è¿‡æ»¤å¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/28 20:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilterHelper</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> numHashFunctions;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bitSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Funnel&lt;T&gt; funnel;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> funnel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedInsertions</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fpp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BloomFilterHelper</span><span class="params">(Funnel&lt;T&gt; funnel, <span class="keyword">int</span> expectedInsertions, <span class="keyword">double</span> fpp)</span> </span>{</span><br><span class="line">        Preconditions.checkArgument(funnel != <span class="keyword">null</span>, <span class="string">"funnelä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        <span class="keyword">this</span>.funnel = funnel;</span><br><span class="line">        <span class="comment">// è®¡ç®—bitæ•°ç»„é•¿åº¦</span></span><br><span class="line">        bitSize = optimalNumOfBits(expectedInsertions, fpp);</span><br><span class="line">        <span class="comment">// è®¡ç®—hashæ–¹æ³•æ‰§è¡Œæ¬¡æ•°</span></span><br><span class="line">        numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, bitSize);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] murmurHashOffset(T value) {</span><br><span class="line">        <span class="keyword">int</span>[] offset = <span class="keyword">new</span> <span class="keyword">int</span>[numHashFunctions];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> hash64 = Hashing.murmur3_128().hashObject(value, funnel).asLong();</span><br><span class="line">        <span class="keyword">int</span> hash1 = (<span class="keyword">int</span>) hash64;</span><br><span class="line">        <span class="keyword">int</span> hash2 = (<span class="keyword">int</span>) (hash64 &gt;&gt;&gt; <span class="number">32</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= numHashFunctions; i++) {</span><br><span class="line">            <span class="keyword">int</span> nextHash = hash1 + i * hash2;</span><br><span class="line">            <span class="keyword">if</span> (nextHash &lt; <span class="number">0</span>) {</span><br><span class="line">                nextHash = ~nextHash;</span><br><span class="line">            }</span><br><span class="line">            offset[i - <span class="number">1</span>] = nextHash % bitSize;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> offset;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—bitæ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">optimalNumOfBits</span><span class="params">(<span class="keyword">long</span> n, <span class="keyword">double</span> p)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// è®¾å®šæœ€å°æœŸæœ›é•¿åº¦</span></span><br><span class="line">            p = Double.MIN_VALUE;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (-n * Math.log(p) / (Math.log(<span class="number">2</span>) * Math.log(<span class="number">2</span>)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—hashæ–¹æ³•æ‰§è¡Œæ¬¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">optimalNumOfHashFunctions</span><span class="params">(<span class="keyword">long</span> n, <span class="keyword">long</span> m)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Math.max(<span class="number">1</span>, (<span class="keyword">int</span>) Math.round((<span class="keyword">double</span>) m / n * Math.log(<span class="number">2</span>)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Beanæ³¨å…¥"><a href="#Beanæ³¨å…¥" class="headerlink" title="Beanæ³¨å…¥"></a>Beanæ³¨å…¥</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/10 17:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">// å¼€å¯åŸºäºæ³¨è§£çš„ç¼“å­˜</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰jsonåºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>{</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ³¨å…¥æ•°æ®æº</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer =</span><br><span class="line">                <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ—¶å°†å¯¹è±¡å…¨ç±»åä¸€èµ·ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">        mapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(mapper);</span><br><span class="line"></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// key-valueç»“æ„åºåˆ—åŒ–æ•°æ®ç»“æ„</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashæ•°æ®ç»“æ„åºåˆ—åŒ–æ–¹å¼,å¿…é¡»è¿™æ ·å¦åˆ™å­˜hash å°±æ˜¯åŸºäºjdkåºåˆ—åŒ–çš„</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// å¯ç”¨é»˜è®¤åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setEnableDefaultSerializer(<span class="keyword">true</span>);</span><br><span class="line">        redisTemplate.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        redisTemplate.setEnableTransactionSupport(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£ç¼“å­˜ä¿¡æ¯é…ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(LettuceConnectionFactory connectionFactory)</span> </span>{</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                <span class="comment">//è¿‡æœŸæ—¶é—´600ç§’:600ç§’åä¼šé‡æ–°è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                <span class="comment">// é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> StringRedisSerializer()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer()))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(connectionFactory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==================åˆå§‹åŒ–å¯¹å¸¸ç”¨æ•°æ®ç±»å‹çš„æ“ä½œ================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * String ç±»å‹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ValueOperations&lt;String, Object&gt; <span class="title">valueOperations</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * List ç±»å‹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListOperations&lt;String, Object&gt; <span class="title">listOperations</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set ç±»å‹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SetOperations&lt;String, Object&gt; <span class="title">setOperations</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ZSet ç±»å‹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ZSetOperations&lt;String, Object&gt; <span class="title">zSetOperations</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForZSet();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Hash ç±»å‹åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashOperations&lt;String, String, Object&gt; <span class="title">hashOperations</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæ”¾å…¥åˆ°springå®¹å™¨é‡Œé¢(åˆå§‹åŒ–é»˜è®¤æ³›å‹ä¸º String)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BloomFilterHelper&lt;String&gt; <span class="title">bloomFilterHelper</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BloomFilterHelper&lt;&gt;((Funnel&lt;String&gt;) (from, into) -&gt; into.putString(from, Charsets.UTF_8)</span><br><span class="line">                .putString(from, Charsets.UTF_8), <span class="number">1000000</span>, <span class="number">0.01</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å°è£…å¤„ç†ç±»"><a href="#å°è£…å¤„ç†ç±»" class="headerlink" title="å°è£…å¤„ç†ç±»"></a>å°è£…å¤„ç†ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Rediså®ç°å¸ƒéš†è¿‡æ»¤å™¨å¤„ç†ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/28 20:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisBloomFilterHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ValueOperations&lt;String, Object&gt; valueOperations;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç»™å®šçš„å¸ƒéš†è¿‡æ»¤å™¨æ·»åŠ å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">addByBloomFilter</span><span class="params">(BloomFilterHelper&lt;T&gt; bloomFilterHelper, String key, T value)</span> </span>{</span><br><span class="line">        Preconditions.checkArgument(bloomFilterHelper != <span class="keyword">null</span>, <span class="string">"bloomFilterHelperå®ä¾‹ä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        <span class="keyword">int</span>[] offset = bloomFilterHelper.murmurHashOffset(value);</span><br><span class="line">        log.info(<span class="string">"key: {}, value: {}"</span>, key, value);</span><br><span class="line">        Arrays.stream(offset).forEach(i -&gt; valueOperations.setBit(key, i, <span class="keyword">true</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç»™å®šçš„å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * BloomFilter å¯ä»¥ç»å¯¹åˆ¤æ–­æŸä¸ªå…ƒç´ ä¸€å®šä¸å­˜åœ¨,ä½†æ˜¯ä¸èƒ½ç»å¯¹åˆ¤æ–­æŸä¸ªä¸€å®šå­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">includeByBloomFilter</span><span class="params">(BloomFilterHelper&lt;T&gt; bloomFilterHelper, String key, T value)</span> </span>{</span><br><span class="line">        Preconditions.checkArgument(bloomFilterHelper != <span class="keyword">null</span>, <span class="string">"bloomFilterHelperä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        <span class="keyword">int</span>[] offset = bloomFilterHelper.murmurHashOffset(value);</span><br><span class="line">        log.info(<span class="string">"key: {}, value: {}"</span>, key, value);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : offset) {</span><br><span class="line">            <span class="comment">// å¦‚æœæœ‰ä¸€ä¸ªbitä½çš„å€¼ä¸æ˜¯ 1 ,é‚£ä¹ˆæ­¤å€¼ä¸€å®šä¸å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">if</span> (!valueOperations.getBit(key, i)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="æµ‹è¯•ç¤ºä¾‹"><a href="#æµ‹è¯•ç¤ºä¾‹" class="headerlink" title="æµ‹è¯•ç¤ºä¾‹"></a>æµ‹è¯•ç¤ºä¾‹</h3><h4 id="æµ‹è¯•æ­¥éª¤"><a href="#æµ‹è¯•æ­¥éª¤" class="headerlink" title="æµ‹è¯•æ­¥éª¤"></a>æµ‹è¯•æ­¥éª¤</h4><blockquote>
<ol>
<li>å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ å€¼</li>
<li>æŸ¥è¯¢æŒ‡å®šå€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = "Redisçš„å¸ƒéš†è¿‡æ»¤å™¨æ’å…¥å€¼æµ‹è¯•")</span></span><br><span class="line"><span class="meta">@GetMapping("/add/bloomValue")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">addBloomFilterValue</span><span class="params">()</span> </span>{</span><br><span class="line">    StopWatch watch = CommonProvide.getWatchStart();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">        <span class="keyword">long</span> value = RandomUtil.randomLong(<span class="number">0</span>, <span class="number">100000</span>);</span><br><span class="line">        redisBloomFilterHandler.addByBloomFilter(bloomFilterHelper, <span class="string">"bloom_test"</span>, String.valueOf(value));</span><br><span class="line">    }</span><br><span class="line">    watch.stop();</span><br><span class="line">    log.info(<span class="string">"æ’å…¥æ•°æ®: {}æ¡,å…±è€—æ—¶: {}"</span>, <span class="number">10</span>, watch.getTotalTimeMillis());</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping("/query/bloomValue")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">queryBloomFilterValue</span><span class="params">(<span class="meta">@RequestParam("value")</span> String value)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> bloom_test = redisBloomFilterHandler.includeByBloomFilter(bloomFilterHelper, <span class="string">"bloom_test"</span>, value);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">"exists"</span>, bloom_test);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h4><h5 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">2021-08-01 13:27:04 |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-8110-exec-3 |PropertySourcedRequestMappingHandlerMapping.java:69 |springfox.documentation.spring.web.PropertySourcedRequestMappingHandlerMapping |Mapped URL path [/v2/api-docs] onto method [springfox.documentation.swagger2.web.Swagger2Controller#getDocumentation(String, HttpServletRequest)]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">969775</span>, <span class="number">555786</span>, <span class="number">9443260</span>, <span class="number">272191</span>, <span class="number">686180</span>, <span class="number">9346200</span>, <span class="number">8932211</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">17359</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">360220</span>, <span class="number">2954942</span>, <span class="number">4035393</span>, <span class="number">1440671</span>, <span class="number">8431007</span>, <span class="number">4610084</span>, <span class="number">7204806</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">22388</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">5251899</span>, <span class="number">8332681</span>, <span class="number">1885834</span>, <span class="number">5024045</span>, <span class="number">8162256</span>, <span class="number">7869648</span>, <span class="number">4731437</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">49259</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">370989</span>, <span class="number">8877009</span>, <span class="number">1906419</span>, <span class="number">7341579</span>, <span class="number">6143208</span>, <span class="number">4640220</span>, <span class="number">4607778</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">60904</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">7198607</span>, <span class="number">2228155</span>, <span class="number">3603608</span>, <span class="number">8574060</span>, <span class="number">3959454</span>, <span class="number">655151</span>, <span class="number">5269757</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">63413</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">9311937</span>, <span class="number">1217360</span>, <span class="number">2707841</span>, <span class="number">4198322</span>, <span class="number">5688803</span>, <span class="number">2405773</span>, <span class="number">915292</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">85602</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">4861797</span>, <span class="number">4674016</span>, <span class="number">3763460</span>, <span class="number">6732153</span>, <span class="number">7642709</span>, <span class="number">8553265</span>, <span class="number">982548</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">19829</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">7142620</span>, <span class="number">6126652</span>, <span class="number">5110684</span>, <span class="number">5490341</span>, <span class="number">6506309</span>, <span class="number">7522277</span>, <span class="number">1908124</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">04</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">97241</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">05</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">2864099</span>, <span class="number">4312348</span>, <span class="number">8542631</span>, <span class="number">8218874</span>, <span class="number">4636105</span>, <span class="number">2540342</span>, <span class="number">729579</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">05</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">14616</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">05</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">33</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |offset: [<span class="number">621922</span>, <span class="number">2377133</span>, <span class="number">4514877</span>, <span class="number">6652621</span>, <span class="number">8790365</span>, <span class="number">8242006</span>, <span class="number">6104262</span>]</span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">05</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |RedisBloomFilterHandler.java:<span class="number">34</span> |com.horse.service.blog.handler.redis.RedisBloomFilterHandler |key: bloom_test, value: <span class="number">91111</span></span><br><span class="line"><span class="number">2021</span>-08-<span class="number">01</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">05</span> |INFO  [72dffa5e95d44090a71bb1c0151d1c71] |http-nio-<span class="number">8110</span>-exec-<span class="number">3</span> |AdminTestController.java:<span class="number">73</span> |com.horse.service.blog.controller.admin.AdminTestController |æ’å…¥æ•°æ®: <span class="number">10</span>æ¡,å…±è€—æ—¶: <span class="number">864</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h5><blockquote>
<p>æŸ¥è¯¢æ•°æ®ï¼š<code>91111</code> (åˆšåˆšå·²æ·»åŠ çš„æ•°æ®)</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801133057.png" alt="æŸ¥è¯¢å­˜åœ¨æ•°æ®"></p>
<p>æŸ¥è¯¢æ•°æ®ï¼š<code>43763</code> ï¼ˆåˆšåˆšæœªæ·»åŠ çš„æ•°æ®ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210801133320.png" alt="æŸ¥è¯¢ä¸å­˜åœ¨æ•°æ®"></p>
</blockquote>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Redis</tag>
        <tag>bitmap</tag>
        <tag>å¸ƒéš†è¿‡æ»¤å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå¤‡ä»½æ¢å¤</title>
    <url>/post/23533.html</url>
    <content><![CDATA[<h1 id="MySQLå¤‡ä»½æ¢å¤"><a href="#MySQLå¤‡ä»½æ¢å¤" class="headerlink" title="MySQLå¤‡ä»½æ¢å¤"></a>MySQLå¤‡ä»½æ¢å¤</h1><h2 id="MySQLä¸»ä»åŒæ­¥-èµ„æºåŒæ­¥"><a href="#MySQLä¸»ä»åŒæ­¥-èµ„æºåŒæ­¥" class="headerlink" title="MySQLä¸»ä»åŒæ­¥(èµ„æºåŒæ­¥)"></a>MySQLä¸»ä»åŒæ­¥(èµ„æºåŒæ­¥)</h2><h3 id="å‰æè¯´æ˜"><a href="#å‰æè¯´æ˜" class="headerlink" title="å‰æè¯´æ˜"></a>å‰æè¯´æ˜</h3><blockquote>
<p>æ­¤æ–‡æ¡£è¯´æ˜å¹¶æœªæ¶‰åŠmysqlä¸»ä»åŒæ­¥æœåŠ¡æ­å»ºè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯ä¸»ä»æœåŠ¡ä¹‹é—´æ•°æ®åŒæ­¥çš„ç®€å•æ“ä½œè¿‡ç¨‹ã€‚</p>
<p>ä¸»æœåŠ¡èŠ‚ç‚¹åç§°ï¼š<code>master</code></p>
<p>ä»æœåŠ¡èŠ‚ç‚¹åç§°ï¼š<code>slave</code></p>
</blockquote>
<h3 id="æ“ä½œè¿‡ç¨‹"><a href="#æ“ä½œè¿‡ç¨‹" class="headerlink" title="æ“ä½œè¿‡ç¨‹"></a>æ“ä½œè¿‡ç¨‹</h3><p>slaveæœåŠ¡</p>
<blockquote>
<p>åœæ­¢slaveçš„åŒæ­¥æœåŠ¡</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">stop slave</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>masteræœåŠ¡</p>
<blockquote>
<p>è¿›å…¥Mysqlå®¢æˆ·ç«¯ï¼Œé”å®šæ•°æ®åº“è¡¨</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">FLUSH TABLES WITH READ LOCK;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>masteræœåŠ¡</p>
<blockquote>
<p>å¤‡ä»½æŒ‡å®šæ•°æ®åº“ ï¼ˆyh_erpï¼‰åˆ°æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸­</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mysqldump -uroot -p yh_erp &gt; /home/backup/mysql/yh_erp_back.sql</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>masteræœåŠ¡</p>
<blockquote>
<p>copyå¤‡ä»½èµ„æºåˆ°slaveæœåŠ¡å™¨</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/backup/mysql</span><br><span class="line">scp yh_erp_back.sql root@192.168.0.71:/tmp/</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>masteræœåŠ¡</p>
<blockquote>
<p>è®°å½•masteræœåŠ¡ä¸­çš„ <code>master_log_file</code>å’Œ<code>master_log_pos</code>çš„å€¼ï¼ˆåé¢éœ€è¦ä½¿ç”¨ï¼‰</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">show master status</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>slaveæœåŠ¡</p>
<blockquote>
<p>è¿˜åŸ yh_erp æ•°æ®åº“</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">use yh_erp</span><br><span class="line">source /tmp/yh_erp_back.sql</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>slaveæœåŠ¡</p>
<blockquote>
<p>æ›´æ–°ä¸»ä»é…ç½®ï¼ˆç¬¬ä¸€æ¬¡çš„è¯éœ€è¦è¾“å…¥å¯†ç  -&gt; æœåŠ¡å™¨å¯†ç ï¼‰</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">change master to master_host = '192.168.0.70', master_user = 'root', master_port=3306, master_password='tps*yh2020', master_log_file = 'å‰é¢çš„å€¼', master_log_pos=21059059;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>slaveæœåŠ¡</p>
<blockquote>
<p>å¼€å¯åŒæ­¥æœåŠ¡</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">start slave</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>masteræœåŠ¡</p>
<blockquote>
<p>å…³é—­é”è¡¨</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>ä¸»ä»èµ„æºåŒæ­¥å®Œæˆ</p>
<h2 id="MySQLå¤‡ä»½æ¢å¤-1"><a href="#MySQLå¤‡ä»½æ¢å¤-1" class="headerlink" title="MySQLå¤‡ä»½æ¢å¤"></a>MySQLå¤‡ä»½æ¢å¤</h2><h3 id="å¤‡ä»½æ“ä½œ"><a href="#å¤‡ä»½æ“ä½œ" class="headerlink" title="å¤‡ä»½æ“ä½œ"></a>å¤‡ä»½æ“ä½œ</h3><h5 id="é’ˆå¯¹æ•°æ®åº“æ“ä½œ"><a href="#é’ˆå¯¹æ•°æ®åº“æ“ä½œ" class="headerlink" title="é’ˆå¯¹æ•°æ®åº“æ“ä½œ"></a>é’ˆå¯¹æ•°æ®åº“æ“ä½œ</h5><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># å¯¼å‡ºåŒ…æ‹¬ç³»ç»Ÿæ•°æ®åº“åœ¨å†…çš„æ‰€æœ‰æ•°æ®åº“</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="comment">--all-databases &gt;/tmp/backup.sql</span></span><br><span class="line"></span><br><span class="line"># å¯¼å‡ºdb1ã€db2ä¸¤ä¸ªæ•°æ®åº“çš„æ‰€æœ‰æ•°æ®</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="comment">--databases db1 db2 &gt;/tmp/backup.sql</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="é’ˆå¯¹è¡¨æ“ä½œ"><a href="#é’ˆå¯¹è¡¨æ“ä½œ" class="headerlink" title="é’ˆå¯¹è¡¨æ“ä½œ"></a>é’ˆå¯¹è¡¨æ“ä½œ</h5><blockquote>
<p>æ³¨æ„ï¼šå¯¼å‡ºæŒ‡å®šè¡¨åªèƒ½é’ˆå¯¹ä¸€ä¸ªæ•°æ®åº“è¿›è¡Œå¯¼å‡ºï¼Œä¸”å¯¼å‡ºçš„å†…å®¹ä¸­å’Œå¯¼å‡ºæ•°æ®åº“ä¹Ÿä¸ä¸€æ ·ï¼Œå¯¼å‡ºæŒ‡å®šè¡¨çš„å¯¼å‡ºæ–‡æœ¬ä¸­æ²¡æœ‰åˆ›å»ºæ•°æ®åº“çš„åˆ¤æ–­è¯­å¥ï¼Œåªæœ‰åˆ é™¤è¡¨-åˆ›å»ºè¡¨-å¯¼å…¥æ•°æ®</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># å¯¼å‡ºdb1æ•°æ®åº“ä¸­çš„ a1,a2ä¸¤è¡¨æ•°æ®</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="comment">--databases db1 --tables a1 a2 &gt;/tmp/backup.sql</span></span><br><span class="line"></span><br><span class="line"># å¯¼å‡ºdb1æ•°æ®åº“ä¸­çš„ a1è¡¨ä¸­ id<span class="operator">&lt;=</span><span class="number">100</span> çš„è®°å½•ï¼ˆå¦‚æœå¤šä¸ªè¡¨çš„æ¡ä»¶ç›¸åŒï¼Œå¯ä»¥åŒä¸Šå¤šè¡¨åŒæ—¶å¯¼å‡ºï¼‰</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>p<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="comment">--databases db1 --tables a1 --where='id&lt;=100' &gt;/tmp/backup.sql</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="è·¨æœåŠ¡å™¨å¯¼å‡ºæ“ä½œ"><a href="#è·¨æœåŠ¡å™¨å¯¼å‡ºæ“ä½œ" class="headerlink" title="è·¨æœåŠ¡å™¨å¯¼å‡ºæ“ä½œ"></a>è·¨æœåŠ¡å™¨å¯¼å‡ºæ“ä½œ</h5><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">#å‘½ä»¤ç¤ºä¾‹</span><br><span class="line"># æ³¨æ„ï¼šå°†h1æœåŠ¡å™¨ä¸­çš„db1æ•°æ®åº“çš„æ‰€æœ‰æ•°æ®å¯¼å…¥åˆ°h2ä¸­çš„db2æ•°æ®åº“ä¸­ï¼Œdb2çš„æ•°æ®åº“å¿…é¡»å­˜åœ¨å¦åˆ™ä¼šæŠ¥é”™</span><br><span class="line">mysqldump <span class="comment">--host=h1 -uroot -p*** --databases db1 |mysql --host=h2 -uroot -p*** db2</span></span><br><span class="line"></span><br><span class="line"># å®æˆ˜ç¤ºä¾‹</span><br><span class="line"># <span class="operator">-</span>Cå‚æ•°å¯ä»¥å¯ç”¨å‹ç¼©ä¼ é€’</span><br><span class="line">mysqldump <span class="comment">--host=192.168.0.76 -uroot -p*** -C --databases yh_erp |mysql --host=192.168.0.216 -uroot -p*** yh_erp</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><figure class="highlight txt"><table><tbody><tr><td class="code"><pre><span class="line">--all-databases  , -A</span><br><span class="line">å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases</span><br><span class="line">--all-tablespaces  , -Y</span><br><span class="line">å¯¼å‡ºå…¨éƒ¨è¡¨ç©ºé—´ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --all-tablespaces</span><br><span class="line">--no-tablespaces  , -y</span><br><span class="line">ä¸å¯¼å‡ºä»»ä½•è¡¨ç©ºé—´ä¿¡æ¯ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --no-tablespaces</span><br><span class="line">--add-drop-database</span><br><span class="line">æ¯ä¸ªæ•°æ®åº“åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®åº“è¯­å¥ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --add-drop-database</span><br><span class="line">--add-drop-table</span><br><span class="line">æ¯ä¸ªæ•°æ®è¡¨åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®è¡¨è¯­å¥ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-add-drop-tableå–æ¶ˆé€‰é¡¹)</span><br><span class="line">mysqldump  -uroot -p --all-databases  (é»˜è®¤æ·»åŠ dropè¯­å¥)</span><br><span class="line">mysqldump  -uroot -p --all-databases â€“skip-add-drop-table  (å–æ¶ˆdropè¯­å¥)</span><br><span class="line">--add-locks</span><br><span class="line">åœ¨æ¯ä¸ªè¡¨å¯¼å‡ºä¹‹å‰å¢åŠ LOCK TABLESå¹¶ä¸”ä¹‹åUNLOCK  TABLEã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-add-lockså–æ¶ˆé€‰é¡¹)</span><br><span class="line">mysqldump  -uroot -p --all-databases  (é»˜è®¤æ·»åŠ LOCKè¯­å¥)</span><br><span class="line">mysqldump  -uroot -p --all-databases â€“skip-add-locks   (å–æ¶ˆLOCKè¯­å¥)</span><br><span class="line">--allow-keywords</span><br><span class="line">å…è®¸åˆ›å»ºæ˜¯å…³é”®è¯çš„åˆ—åå­—ã€‚è¿™ç”±è¡¨åå‰ç¼€äºæ¯ä¸ªåˆ—ååšåˆ°ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --allow-keywords</span><br><span class="line">--apply-slave-statements</span><br><span class="line">åœ¨'CHANGE MASTER'å‰æ·»åŠ 'STOP SLAVE'ï¼Œå¹¶ä¸”åœ¨å¯¼å‡ºçš„æœ€åæ·»åŠ 'START SLAVE'ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --apply-slave-statements</span><br><span class="line">--character-sets-dir</span><br><span class="line">å­—ç¬¦é›†æ–‡ä»¶çš„ç›®å½•</span><br><span class="line">mysqldump  -uroot -p --all-databases  --character-sets-dir=/usr/local/mysql/share/mysql/charsets</span><br><span class="line">--comments</span><br><span class="line">é™„åŠ æ³¨é‡Šä¿¡æ¯ã€‚é»˜è®¤ä¸ºæ‰“å¼€ï¼Œå¯ä»¥ç”¨--skip-commentså–æ¶ˆ</span><br><span class="line">mysqldump  -uroot -p --all-databases  (é»˜è®¤è®°å½•æ³¨é‡Š)</span><br><span class="line">mysqldump  -uroot -p --all-databases --skip-comments   (å–æ¶ˆæ³¨é‡Š)</span><br><span class="line">--compatible</span><br><span class="line">å¯¼å‡ºçš„æ•°æ®å°†å’Œå…¶å®ƒæ•°æ®åº“æˆ–æ—§ç‰ˆæœ¬çš„MySQL ç›¸å…¼å®¹ã€‚å€¼å¯ä»¥ä¸ºansiã€mysql323ã€mysql40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_tables_optionsã€no_field_optionsç­‰ï¼Œ</span><br><span class="line">è¦ä½¿ç”¨å‡ ä¸ªå€¼ï¼Œç”¨é€—å·å°†å®ƒä»¬éš”å¼€ã€‚å®ƒå¹¶ä¸ä¿è¯èƒ½å®Œå…¨å…¼å®¹ï¼Œè€Œæ˜¯å°½é‡å…¼å®¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --compatible=ansi</span><br><span class="line">--compact</span><br><span class="line">å¯¼å‡ºæ›´å°‘çš„è¾“å‡ºä¿¡æ¯(ç”¨äºè°ƒè¯•)ã€‚å»æ‰æ³¨é‡Šå’Œå¤´å°¾ç­‰ç»“æ„ã€‚å¯ä»¥ä½¿ç”¨é€‰é¡¹ï¼š--skip-add-drop-table  --skip-add-locks --skip-comments --skip-disable-keys</span><br><span class="line">mysqldump  -uroot -p --all-databases --compact</span><br><span class="line">--complete-insert,  -c</span><br><span class="line">ä½¿ç”¨å®Œæ•´çš„insertè¯­å¥(åŒ…å«åˆ—åç§°)ã€‚è¿™ä¹ˆåšèƒ½æé«˜æ’å…¥æ•ˆç‡ï¼Œä½†æ˜¯å¯èƒ½ä¼šå—åˆ°max_allowed_packetå‚æ•°çš„å½±å“è€Œå¯¼è‡´æ’å…¥å¤±è´¥ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --complete-insert</span><br><span class="line">--compress, -C</span><br><span class="line">åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ç”¨å‹ç¼©ä¼ é€’æ‰€æœ‰ä¿¡æ¯</span><br><span class="line">mysqldump  -uroot -p --all-databases --compress</span><br><span class="line">--create-options,  -a</span><br><span class="line">åœ¨CREATE TABLEè¯­å¥ä¸­åŒ…æ‹¬æ‰€æœ‰MySQLç‰¹æ€§é€‰é¡¹ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€)</span><br><span class="line">mysqldump  -uroot -p --all-databases</span><br><span class="line">--databases,  -B</span><br><span class="line">å¯¼å‡ºå‡ ä¸ªæ•°æ®åº“ã€‚å‚æ•°åé¢æ‰€æœ‰åå­—å‚é‡éƒ½è¢«çœ‹ä½œæ•°æ®åº“åã€‚</span><br><span class="line">mysqldump  -uroot -p --databases test mysql</span><br><span class="line">--debug</span><br><span class="line">è¾“å‡ºdebugä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•ã€‚é»˜è®¤å€¼ä¸ºï¼šd:t,/tmp/mysqldump.trace</span><br><span class="line">mysqldump  -uroot -p --all-databases --debug</span><br><span class="line">mysqldump  -uroot -p --all-databases --debug=â€ d:t,/tmp/debug.traceâ€</span><br><span class="line">--debug-check</span><br><span class="line">æ£€æŸ¥å†…å­˜å’Œæ‰“å¼€æ–‡ä»¶ä½¿ç”¨è¯´æ˜å¹¶é€€å‡ºã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --debug-check</span><br><span class="line">--debug-info</span><br><span class="line">è¾“å‡ºè°ƒè¯•ä¿¡æ¯å¹¶é€€å‡º</span><br><span class="line">mysqldump  -uroot -p --all-databases --debug-info</span><br><span class="line">--default-character-set</span><br><span class="line">è®¾ç½®é»˜è®¤å­—ç¬¦é›†ï¼Œé»˜è®¤å€¼ä¸ºutf8</span><br><span class="line">mysqldump  -uroot -p --all-databases --default-character-set=utf8</span><br><span class="line">--delayed-insert</span><br><span class="line">é‡‡ç”¨å»¶æ—¶æ’å…¥æ–¹å¼ï¼ˆINSERT DELAYEDï¼‰å¯¼å‡ºæ•°æ®</span><br><span class="line">mysqldump  -uroot -p --all-databases --delayed-insert</span><br><span class="line">--delete-master-logs</span><br><span class="line">masterå¤‡ä»½ååˆ é™¤æ—¥å¿—. è¿™ä¸ªå‚æ•°å°†è‡ªåŠ¨æ¿€æ´»--master-dataã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --delete-master-logs</span><br><span class="line">--disable-keys</span><br><span class="line">å¯¹äºæ¯ä¸ªè¡¨ï¼Œç”¨/*!40000 ALTER TABLE tbl_name DISABLE KEYS */;å’Œ/*!40000 ALTER TABLE tbl_name ENABLE KEYS */;è¯­å¥å¼•ç”¨INSERTè¯­å¥ã€‚è¿™æ ·å¯ä»¥æ›´å¿«åœ°å¯¼å…¥dumpå‡ºæ¥çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨æ’å…¥æ‰€æœ‰è¡Œååˆ›å»ºç´¢å¼•çš„ã€‚è¯¥é€‰é¡¹åªé€‚åˆMyISAMè¡¨ï¼Œé»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases </span><br><span class="line">--dump-slave</span><br><span class="line">è¯¥é€‰é¡¹å°†ä¸»çš„binlogä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°å¯¼å‡ºæ•°æ®çš„æ–‡ä»¶ä¸­(show slave status)ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œå°†ä¼šä»¥CHANGE MASTERå‘½ä»¤è¾“å‡ºåˆ°æ•°æ®æ–‡ä»¶ï¼›è®¾ç½®ä¸º2æ—¶ï¼Œä¼šåœ¨changeå‰åŠ ä¸Šæ³¨é‡Šã€‚è¯¥é€‰é¡¹å°†ä¼šæ‰“å¼€--lock-all-tablesï¼Œé™¤é--single-transactionè¢«æŒ‡å®šã€‚è¯¥é€‰é¡¹ä¼šè‡ªåŠ¨å…³é—­--lock-tablesé€‰é¡¹ã€‚é»˜è®¤å€¼ä¸º0ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --dump-slave=1</span><br><span class="line">mysqldump  -uroot -p --all-databases --dump-slave=2</span><br><span class="line">--master-data</span><br><span class="line">è¯¥é€‰é¡¹å°†å½“å‰æœåŠ¡å™¨çš„binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­(show master status)ã€‚å¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼›å¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE  MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚è¯¥é€‰é¡¹å°†æ‰“å¼€--lock-all-tables é€‰é¡¹ï¼Œé™¤é--single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„--single-transactioné€‰é¡¹ï¼‰ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--lock-tablesé€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --master-data=1;</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --master-data=2;</span><br><span class="line">--events, -E</span><br><span class="line">å¯¼å‡ºäº‹ä»¶ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --events</span><br><span class="line">--extended-insert,  -e</span><br><span class="line">ä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases</span><br><span class="line">mysqldump  -uroot -p --all-databases--skip-extended-insert   (å–æ¶ˆé€‰é¡¹)</span><br><span class="line">--fields-terminated-by</span><br><span class="line">å¯¼å‡ºæ–‡ä»¶ä¸­å¿½ç•¥ç»™å®šå­—æ®µã€‚ä¸--tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äº--databaseså’Œ--all-databasesé€‰é¡¹</span><br><span class="line">mysqldump  -uroot -p test test --tab=â€/home/mysqlâ€ --fields-terminated-by=â€#â€</span><br><span class="line">--fields-enclosed-by</span><br><span class="line">è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦åŒ…è£¹ã€‚ä¸--tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äº--databaseså’Œ--all-databasesé€‰é¡¹</span><br><span class="line">mysqldump  -uroot -p test test --tab=â€/home/mysqlâ€ --fields-enclosed-by=â€#â€</span><br><span class="line">--fields-optionally-enclosed-by</span><br><span class="line">è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦é€‰æ‹©æ€§åŒ…è£¹ã€‚ä¸--tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äº--databaseså’Œ--all-databasesé€‰é¡¹</span><br><span class="line">mysqldump  -uroot -p test test --tab=â€/home/mysqlâ€  --fields-enclosed-by=â€#â€ --fields-optionally-enclosed-by  =â€#â€</span><br><span class="line">--fields-escaped-by</span><br><span class="line">è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µå¿½ç•¥ç»™å®šå­—ç¬¦ã€‚ä¸--tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äº--databaseså’Œ--all-databasesé€‰é¡¹</span><br><span class="line">mysqldump  -uroot -p mysql user --tab=â€/home/mysqlâ€ --fields-escaped-by=â€#â€</span><br><span class="line">--flush-logs</span><br><span class="line">å¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°æ—¥å¿—ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“(ä½¿ç”¨é€‰é¡¹--databasesæˆ–è€…--all-databases)ï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚é™¤ä½¿ç”¨--lock-all-tablesæˆ–è€…--master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚å› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨--lock-all-tables æˆ–è€…--master-data å’Œ--flush-logsã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --flush-logs</span><br><span class="line">--flush-privileges</span><br><span class="line">åœ¨å¯¼å‡ºmysqlæ•°æ®åº“ä¹‹åï¼Œå‘å‡ºä¸€æ¡FLUSH  PRIVILEGES è¯­å¥ã€‚ä¸ºäº†æ­£ç¡®æ¢å¤ï¼Œè¯¥é€‰é¡¹åº”è¯¥ç”¨äºå¯¼å‡ºmysqlæ•°æ®åº“å’Œä¾èµ–mysqlæ•°æ®åº“æ•°æ®çš„ä»»ä½•æ—¶å€™ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --flush-privileges</span><br><span class="line">--force</span><br><span class="line">åœ¨å¯¼å‡ºè¿‡ç¨‹ä¸­å¿½ç•¥å‡ºç°çš„SQLé”™è¯¯ã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --force</span><br><span class="line">--help</span><br><span class="line">æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</span><br><span class="line">mysqldump  --help</span><br><span class="line">--hex-blob</span><br><span class="line">ä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚</span><br><span class="line">mysqldump  -uroot -p --all-databases --hex-blob</span><br><span class="line">--host, -h</span><br><span class="line">éœ€è¦å¯¼å‡ºçš„ä¸»æœºä¿¡æ¯</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases</span><br><span class="line">--ignore-table</span><br><span class="line">ä¸å¯¼å‡ºæŒ‡å®šè¡¨ã€‚æŒ‡å®šå¿½ç•¥å¤šä¸ªè¡¨æ—¶ï¼Œéœ€è¦é‡å¤å¤šæ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªè¡¨ã€‚æ¯ä¸ªè¡¨å¿…é¡»åŒæ—¶æŒ‡å®šæ•°æ®åº“å’Œè¡¨åã€‚ä¾‹å¦‚ï¼š--ignore-table=database.table1 --ignore-table=database.table2 â€¦â€¦</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --ignore-table=mysql.user</span><br><span class="line">--include-master-host-port</span><br><span class="line">åœ¨--dump-slaveäº§ç”Ÿçš„'CHANGE  MASTER TO..'è¯­å¥ä¸­å¢åŠ 'MASTER_HOST=&lt;host&gt;ï¼ŒMASTER_PORT=&lt;port&gt;'  </span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --include-master-host-port</span><br><span class="line">--insert-ignore</span><br><span class="line">åœ¨æ’å…¥è¡Œæ—¶ä½¿ç”¨INSERT IGNOREè¯­å¥.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --insert-ignore</span><br><span class="line">--lines-terminated-by</span><br><span class="line">è¾“å‡ºæ–‡ä»¶çš„æ¯è¡Œç”¨ç»™å®šå­—ç¬¦ä¸²åˆ’åˆ†ã€‚ä¸--tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äº--databaseså’Œ--all-databasesé€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost test test --tab=â€/tmp/mysqlâ€  --lines-terminated-by=â€##â€</span><br><span class="line">--lock-all-tables,  -x</span><br><span class="line">æäº¤è¯·æ±‚é”å®šæ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€è¯»é”ï¼Œå¹¶ä¸”è‡ªåŠ¨å…³é—­--single-transaction å’Œ--lock-tables é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --lock-all-tables</span><br><span class="line">--lock-tables,  -l</span><br><span class="line">å¼€å§‹å¯¼å‡ºå‰ï¼Œé”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ  LOCALé”å®šè¡¨ä»¥å…è®¸MyISAMè¡¨å¹¶è¡Œæ’å…¥ã€‚å¯¹äºæ”¯æŒäº‹åŠ¡çš„è¡¨ä¾‹å¦‚InnoDBå’ŒBDBï¼Œ--single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸éœ€è¦é”å®šè¡¨ã€‚</span><br><span class="line">è¯·æ³¨æ„å½“å¯¼å‡ºå¤šä¸ªæ•°æ®åº“æ—¶ï¼Œ--lock-tablesåˆ†åˆ«ä¸ºæ¯ä¸ªæ•°æ®åº“é”å®šè¡¨ã€‚å› æ­¤ï¼Œè¯¥é€‰é¡¹ä¸èƒ½ä¿è¯å¯¼å‡ºæ–‡ä»¶ä¸­çš„è¡¨åœ¨æ•°æ®åº“ä¹‹é—´çš„é€»è¾‘ä¸€è‡´æ€§ã€‚ä¸åŒæ•°æ®åº“è¡¨çš„å¯¼å‡ºçŠ¶æ€å¯ä»¥å®Œå…¨ä¸åŒã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --lock-tables</span><br><span class="line">--log-error</span><br><span class="line">é™„åŠ è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯åˆ°ç»™å®šæ–‡ä»¶</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases  --log-error=/tmp/mysqldump_error_log.err</span><br><span class="line">--max_allowed_packet</span><br><span class="line">æœåŠ¡å™¨å‘é€å’Œæ¥å—çš„æœ€å¤§åŒ…é•¿åº¦ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --max_allowed_packet=10240</span><br><span class="line">--net_buffer_length</span><br><span class="line">TCP/IPå’Œsocketè¿æ¥çš„ç¼“å­˜å¤§å°ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --net_buffer_length=1024</span><br><span class="line">--no-autocommit</span><br><span class="line">ä½¿ç”¨autocommit/commit è¯­å¥åŒ…è£¹è¡¨ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --no-autocommit</span><br><span class="line">--no-create-db,  -n</span><br><span class="line">åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE DATABASE è¯­å¥ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --no-create-db</span><br><span class="line">--no-create-info,  -t</span><br><span class="line">åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLE è¯­å¥ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --no-create-info</span><br><span class="line">--no-data, -d</span><br><span class="line">ä¸å¯¼å‡ºä»»ä½•æ•°æ®ï¼Œåªå¯¼å‡ºæ•°æ®åº“è¡¨ç»“æ„ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --no-data</span><br><span class="line">--no-set-names,  -N</span><br><span class="line">ç­‰åŒäº--skip-set-charset</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --no-set-names</span><br><span class="line">--opt</span><br><span class="line">ç­‰åŒäº--add-drop-table,  --add-locks, --create-options, --quick, --extended-insert, --lock-tables,  --set-charset, --disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯,  å¯ä»¥ç”¨--skip-optç¦ç”¨.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --opt</span><br><span class="line">--order-by-primary</span><br><span class="line">å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œæˆ–è€…ç¬¬ä¸€ä¸ªå”¯ä¸€é”®ï¼Œå¯¹æ¯ä¸ªè¡¨çš„è®°å½•è¿›è¡Œæ’åºã€‚åœ¨å¯¼å‡ºMyISAMè¡¨åˆ°InnoDBè¡¨æ—¶æœ‰æ•ˆï¼Œä½†ä¼šä½¿å¾—å¯¼å‡ºå·¥ä½œèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ </span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --order-by-primary</span><br><span class="line">--password, -p</span><br><span class="line">è¿æ¥æ•°æ®åº“å¯†ç </span><br><span class="line">--pipe(windowsç³»ç»Ÿå¯ç”¨)</span><br><span class="line">ä½¿ç”¨å‘½åç®¡é“è¿æ¥mysql</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --pipe</span><br><span class="line">--port, -P</span><br><span class="line">è¿æ¥æ•°æ®åº“ç«¯å£å·</span><br><span class="line">--protocol</span><br><span class="line">ä½¿ç”¨çš„è¿æ¥åè®®ï¼ŒåŒ…æ‹¬ï¼štcp, socket, pipe, memory.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --protocol=tcp</span><br><span class="line">--quick, -q</span><br><span class="line">ä¸ç¼“å†²æŸ¥è¯¢ï¼Œç›´æ¥å¯¼å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-quickå–æ¶ˆè¯¥é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases </span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --skip-quick</span><br><span class="line">--quote-names,-Q</span><br><span class="line">ä½¿ç”¨ï¼ˆ`ï¼‰å¼•èµ·è¡¨å’Œåˆ—åã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-quote-nameså–æ¶ˆè¯¥é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --skip-quote-names</span><br><span class="line">--replace</span><br><span class="line">ä½¿ç”¨REPLACE INTO å–ä»£INSERT INTO.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --replace</span><br><span class="line">--result-file,  -r</span><br><span class="line">ç›´æ¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚è¯¥é€‰é¡¹åº”è¯¥ç”¨åœ¨ä½¿ç”¨å›è½¦æ¢è¡Œå¯¹ï¼ˆ\\r\\nï¼‰æ¢è¡Œçš„ç³»ç»Ÿä¸Šï¼ˆä¾‹å¦‚ï¼šDOSï¼ŒWindowsï¼‰ã€‚è¯¥é€‰é¡¹ç¡®ä¿åªæœ‰ä¸€è¡Œè¢«ä½¿ç”¨ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --result-file=/tmp/mysqldump_result_file.txt</span><br><span class="line">--routines, -R</span><br><span class="line">å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --routines</span><br><span class="line">--set-charset</span><br><span class="line">æ·»åŠ 'SET NAMES  default_character_set'åˆ°è¾“å‡ºæ–‡ä»¶ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-set-charsetå…³é—­é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases </span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --skip-set-charset</span><br><span class="line">--single-transaction</span><br><span class="line">è¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGIN ä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚å®ƒåªé€‚ç”¨äºå¤šç‰ˆæœ¬å­˜å‚¨å¼•æ“ï¼Œä»…InnoDBã€‚æœ¬é€‰é¡¹å’Œ--lock-tables é€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK  TABLES ä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚è¦æƒ³å¯¼å‡ºå¤§è¡¨çš„è¯ï¼Œåº”ç»“åˆä½¿ç”¨--quick é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --single-transaction</span><br><span class="line">--dump-date</span><br><span class="line">å°†å¯¼å‡ºæ—¶é—´æ·»åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-dump-dateå…³é—­é€‰é¡¹ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --skip-dump-date</span><br><span class="line">--skip-opt</span><br><span class="line">ç¦ç”¨â€“opté€‰é¡¹.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --skip-opt</span><br><span class="line">--socket,-S</span><br><span class="line">æŒ‡å®šè¿æ¥mysqlçš„socketæ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤è·¯å¾„/tmp/mysql.sock</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --socket=/tmp/mysqld.sock</span><br><span class="line">--tab,-T</span><br><span class="line">ä¸ºæ¯ä¸ªè¡¨åœ¨ç»™å®šè·¯å¾„åˆ›å»ºtabåˆ†å‰²çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ³¨æ„ï¼šä»…ä»…ç”¨äºmysqldumpå’ŒmysqldæœåŠ¡å™¨è¿è¡Œåœ¨ç›¸åŒæœºå™¨ä¸Šã€‚æ³¨æ„ä½¿ç”¨--tabä¸èƒ½æŒ‡å®š--databaseså‚æ•°</span><br><span class="line">mysqldump  -uroot -p --host=localhost test test --tab="/home/mysql"</span><br><span class="line">--tables</span><br><span class="line">è¦†ç›–--databases (-B)å‚æ•°ï¼ŒæŒ‡å®šéœ€è¦å¯¼å‡ºçš„è¡¨åï¼Œåœ¨åé¢çš„ç‰ˆæœ¬ä¼šä½¿ç”¨tableå–ä»£tablesã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --databases test --tables test</span><br><span class="line">--triggers</span><br><span class="line">å¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨--skip-triggersç¦ç”¨å®ƒã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --triggers</span><br><span class="line">--tz-utc</span><br><span class="line">åœ¨å¯¼å‡ºé¡¶éƒ¨è®¾ç½®æ—¶åŒºTIME_ZONE='+00:00' ï¼Œä»¥ä¿è¯åœ¨ä¸åŒæ—¶åŒºå¯¼å‡ºçš„TIMESTAMP æ•°æ®æˆ–è€…æ•°æ®è¢«ç§»åŠ¨å…¶ä»–æ—¶åŒºæ—¶çš„æ­£ç¡®æ€§ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --tz-utc</span><br><span class="line">--user, -u</span><br><span class="line">æŒ‡å®šè¿æ¥çš„ç”¨æˆ·åã€‚</span><br><span class="line">--verbose, --v</span><br><span class="line">è¾“å‡ºå¤šç§å¹³å°ä¿¡æ¯ã€‚</span><br><span class="line">--version, -V</span><br><span class="line">è¾“å‡ºmysqldumpç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º</span><br><span class="line">--where, -w</span><br><span class="line">åªè½¬å‚¨ç»™å®šçš„WHEREæ¡ä»¶é€‰æ‹©çš„è®°å½•ã€‚è¯·æ³¨æ„å¦‚æœæ¡ä»¶åŒ…å«å‘½ä»¤è§£é‡Šç¬¦ä¸“ç”¨ç©ºæ ¼æˆ–å­—ç¬¦ï¼Œä¸€å®šè¦å°†æ¡ä»¶å¼•ç”¨èµ·æ¥ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --where=â€ user=â€™rootâ€™â€</span><br><span class="line">--xml, -X</span><br><span class="line">å¯¼å‡ºXMLæ ¼å¼.</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --xml</span><br><span class="line">--plugin_dir</span><br><span class="line">å®¢æˆ·ç«¯æ’ä»¶çš„ç›®å½•ï¼Œç”¨äºå…¼å®¹ä¸åŒçš„æ’ä»¶ç‰ˆæœ¬ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --plugin_dir=â€/usr/local/lib/pluginâ€</span><br><span class="line">--default_auth</span><br><span class="line">å®¢æˆ·ç«¯æ’ä»¶é»˜è®¤ä½¿ç”¨æƒé™ã€‚</span><br><span class="line">mysqldump  -uroot -p --host=localhost --all-databases --default-auth=â€/usr/local/lib/plugin/&lt;PLUGIN&gt;â€</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è¿˜åŸæ“ä½œ"><a href="#è¿˜åŸæ“ä½œ" class="headerlink" title="è¿˜åŸæ“ä½œ"></a>è¿˜åŸæ“ä½œ</h3><blockquote>
<p>ä¾‹å¦‚ï¼šè¿˜åŸ/tmp/backup.sqlçš„yh_erpæ•°æ®åº“</p>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>ç›´æ¥è¿˜åŸï¼šè¿˜åŸè¿‡ç¨‹ä¸­ï¼Œä¸èƒ½æ–­å¼€è¿æ¥ï¼Œå¦åˆ™è¿˜åŸå¤±è´¥ï¼ä½†æ˜¯å¯¹äºå¤§æ–‡ä»¶SQLè¿˜åŸï¼Œç›¸å¯¹æ¯”è¾ƒç¨³å®š</li>
<li>åå°è¿˜åŸï¼šå¯¹äºå¤§æ–‡ä»¶SQLè¿˜åŸï¼Œéœ€è¦é…ç½®ä¸€äº›å‚æ•°ï¼ˆæš‚æ—¶æ²¡è¯•è¿‡ï¼Œä¸Šæ¬¡è¿˜åŸï¼Œå› ä¸ºæŸäº›å‚æ•°åŸå› ï¼ŒæŸ¥è¯¢è¶…æ—¶ï¼Œè¿˜åŸå¤±è´¥å•¦ï¼‰</li>
</ul>
</blockquote>
<h5 id="ç›´æ¥è¿˜åŸ"><a href="#ç›´æ¥è¿˜åŸ" class="headerlink" title="ç›´æ¥è¿˜åŸ"></a>ç›´æ¥è¿˜åŸ</h5><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°å‡†å¤‡è¦è¿˜åŸçš„æ•°æ®åº“ï¼ˆæ²¡æœ‰åˆ™åˆ›å»ºï¼‰</span><br><span class="line">use yh_erp;</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œè¿˜åŸæ“ä½œ</span><br><span class="line">source <span class="operator">/</span>tmp<span class="operator">/</span>backup.sql</span><br></pre></td></tr></tbody></table></figure>
<h5 id="åå°è¿˜åŸ"><a href="#åå°è¿˜åŸ" class="headerlink" title="åå°è¿˜åŸ"></a>åå°è¿˜åŸ</h5><p>ç¼–å†™è„šæœ¬</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">mysql -uroot -pTps*3@18 --database=yh_erp_import &lt; yh_erp_2201070200.sql</span><br></pre></td></tr></tbody></table></figure>
<p>èµ‹äºˆå¯æ‰§è¡Œæƒé™</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">chmod u+x import.sh</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œè„šæœ¬,åå°æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">nohup ./import_sql.sh &amp;</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>äºšè™å¤§ç™¾è´§æœåŠ¡ç¯å¢ƒæ­å»º</title>
    <url>/post/33603.html</url>
    <content><![CDATA[<h1 id="äºšè™å¤§ç™¾è´§æœåŠ¡ç¯å¢ƒæ­å»º"><a href="#äºšè™å¤§ç™¾è´§æœåŠ¡ç¯å¢ƒæ­å»º" class="headerlink" title="äºšè™å¤§ç™¾è´§æœåŠ¡ç¯å¢ƒæ­å»º"></a>äºšè™å¤§ç™¾è´§æœåŠ¡ç¯å¢ƒæ­å»º</h1><h2 id="ç¯å¢ƒéœ€æ±‚"><a href="#ç¯å¢ƒéœ€æ±‚" class="headerlink" title="ç¯å¢ƒéœ€æ±‚"></a>ç¯å¢ƒéœ€æ±‚</h2><blockquote>
<p>è¿è¡ŒæœåŠ¡éœ€è¦çš„ç³»ç»Ÿç¯å¢ƒå¦‚ä¸‹ï¼š</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>æœåŠ¡</th>
<th>ç‰ˆæœ¬ï¼ˆç‰ˆæœ¬å¯ä¸ä¸€è‡´ï¼Œå…¼å®¹å³å¯ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>Centos</td>
<td>7.x</td>
</tr>
<tr>
<td>Jdk</td>
<td>1.8</td>
</tr>
<tr>
<td>Nginx</td>
<td>1.12.x</td>
</tr>
<tr>
<td>Redis</td>
<td>4.x</td>
</tr>
<tr>
<td>Mysql</td>
<td>5.7.x</td>
</tr>
<tr>
<td>MongoDB</td>
<td>4.x</td>
</tr>
<tr>
<td>Docker</td>
<td>18.x</td>
</tr>
<tr>
<td>rabbitMQ</td>
<td>3.7.x managementï¼ˆå…·æœ‰å¯è§†åŒ–é¢æ¿ç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td>Tomcat</td>
<td>9.0.xï¼ˆwaråŒ…è¿è¡ŒæœåŠ¡ï¼Œæœ¬æ¬¡ç¯å¢ƒæš‚æœªé…ç½®ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Redisæ­å»º"><a href="#Redisæ­å»º" class="headerlink" title="Redisæ­å»º"></a>Redisæ­å»º</h2><h3 id="å®‰è£…è¦æ±‚"><a href="#å®‰è£…è¦æ±‚" class="headerlink" title="å®‰è£…è¦æ±‚"></a>å®‰è£…è¦æ±‚</h3><blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.horsemuzi.top/Linux/Linuxå®‰è£…Redis 6.2.1/">Linux å®‰è£… Redis</a></p>
<p>è¦æ±‚ï¼š</p>
<ul>
<li>ç«¯å£ï¼š16379</li>
<li>å®‰è£…æ–¹å¼ï¼šæºç å®‰è£…</li>
<li>è‡ªè¡Œæµ‹è¯•<code>redis-cli</code>å®¢æˆ·ç«¯æ˜¯å¦æ­£å¸¸</li>
</ul>
</blockquote>
<h3 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h3><h4 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="headerlink" title="ä¸‹è½½è§£å‹"></a>ä¸‹è½½è§£å‹</h4><blockquote>
<ol>
<li>åˆ°Rediså®˜ç½‘ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆï¼š<a href="https://redis.io/download">Reidså®˜ç½‘</a> </li>
<li>ä¸Šä¼ åˆ°<code>/usr/local/redis/</code>ç›®å½•ä¸‹å¹¶è§£å‹</li>
</ol>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis]<span class="comment"># tar -zxvf redis-6.2.1.tar.gz </span></span><br><span class="line">[root@horse redis]<span class="comment"># ll</span></span><br><span class="line">total 2388</span><br><span class="line">drwxrwxr-x 9 root root    4096 Apr 19 10:18 redis-6.2.1</span><br><span class="line">-rw-r--r-- 1 root root 2438367 Apr 19 09:14 redis-6.2.1.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<p>è§£å‹åçš„æ–‡ä»¶åœ¨<code>/usr/local/redis/redis-6.2.1</code>ç›®å½•ä¸‹</p>
<h4 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h4><blockquote>
<p>è¿›å…¥<code>/usr/local/redis/redis-6.2.1</code>ç›®å½•ï¼Œæ‰§è¡Œç¼–è¯‘ã€‚ç¼–è¯‘åä¼šå‡ºç°<code>redis.conf</code>æ–‡ä»¶å’Œ<code>src</code>ç›®å½•ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis-6.2.1]<span class="comment"># make</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ç¼–è¯‘æˆåŠŸï¼Œè¿›å…¥<code>src</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>make install</code>è¿›è¡ŒRediså®‰è£…ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse src]<span class="comment"># make install</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="éƒ¨ç½²å¯åŠ¨"><a href="#éƒ¨ç½²å¯åŠ¨" class="headerlink" title="éƒ¨ç½²å¯åŠ¨"></a>éƒ¨ç½²å¯åŠ¨</h4><blockquote>
<p><strong>ä¸ºäº†æ–¹ä¾¿ç®¡ç†</strong>ï¼Œå°†Redisæ–‡ä»¶ä¸­çš„confé…ç½®æ–‡ä»¶å’Œå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°ç»Ÿä¸€æ–‡ä»¶ä¸­ã€‚</p>
<ul>
<li>åˆ›å»º<code>bin</code>å’Œ<code>etc</code>ç›®å½•ã€‚</li>
<li>å°†<code>redis.conf</code>æ–‡ä»¶ç§»åŠ¨åˆ°<code>etc</code>ç›®å½•ä¸‹ã€‚</li>
<li>è¿›å…¥<code>src</code>ç›®å½•å°†å…¶ä»–å¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°<code>bin</code>ç›®å½•ä¸‹ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mkdir etc</span><br><span class="line">mkdir bin</span><br><span class="line"></span><br><span class="line">mv redis.conf /usr/<span class="built_in">local</span>/redis/redis-6.2.1/etc/</span><br><span class="line"></span><br><span class="line">mv mkreleasehdr.sh redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-server /usr/<span class="built_in">local</span>/redis/redis-6.2.1/bin/</span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥çœ‹ç§»åŠ¨åçš„æ–‡ä»¶</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse redis-6.2.1]<span class="comment"># cd etc</span></span><br><span class="line">[root@horse etc]<span class="comment"># ll</span></span><br><span class="line">total 92</span><br><span class="line">-rw-rw-r-- 1 root root 92484 Apr 19 13:55 redis.conf</span><br><span class="line">[root@horse etc]<span class="comment"># cd ../bin</span></span><br><span class="line">[root@horse bin]<span class="comment"># ll</span></span><br><span class="line">total 37316</span><br><span class="line">-rw-r--r-- 1 root root     113 Apr 21 18:59 dump.rdb</span><br><span class="line">-rwxrwxr-x 1 root root     735 Mar  2 14:14 mkreleasehdr.sh</span><br><span class="line">-rwxr-xr-x 1 root root 4833448 Apr 19 09:40 redis-benchmark</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-check-aof</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-check-rdb</span><br><span class="line">-rwxr-xr-x 1 root root 5003464 Apr 19 09:40 redis-cli</span><br><span class="line">-rwxr-xr-x 1 root root 9451144 Apr 19 09:40 redis-server</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨æµ‹è¯•"><a href="#å¯åŠ¨æµ‹è¯•" class="headerlink" title="å¯åŠ¨æµ‹è¯•"></a>å¯åŠ¨æµ‹è¯•</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨binç›®å½•ä¸‹ï¼Œæ‰§è¡Œredis-server,æŒ‡å®šredis.confé…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">./redis-server[root@horse bin]<span class="comment"># ./redis-server /usr/local/redis/redis-6.2.1/etc/redis.conf</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">32336:C 19 Apr 2021 14:18:01.846 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">32336:C 19 Apr 2021 14:18:01.847 <span class="comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=32336, just started</span></span><br><span class="line">32336:C 19 Apr 2021 14:18:01.847 <span class="comment"># Configuration loaded</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.847 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">''</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 6.2.1 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._                                   </span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 32336</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">'                                           </span></span><br><span class="line"><span class="string">              `-.__.-'</span>                                               </span><br><span class="line"></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 <span class="comment"># Server initialized</span></span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 * Loading RDB produced by version 6.2.1</span><br><span class="line">32336:M 19 Apr 2021 14:18:01.848 * RDB age 170 seconds</span><br></pre></td></tr></tbody></table></figure>
<h4 id="redis-confé…ç½®"><a href="#redis-confé…ç½®" class="headerlink" title="redis.confé…ç½®"></a>redis.confé…ç½®</h4><blockquote>
<p>ç¼–è¾‘<code>redis.conf</code>é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®æœåŠ¡éœ€æ±‚é…ç½®</p>
</blockquote>
<ul>
<li>æ³¨é‡Šç»‘å®šIPï¼Œå…è®¸è¿œç¨‹è¿æ¥</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># bind 127.0.0.1</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å…è®¸åå°è¿è¡Œ</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°è®¾ç½®ä¸º yes [å…è®¸åå°æŒ‚è½½è¿è¡Œ]</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ä¿®æ”¹æ¨¡å¼</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º no [éå—ä¿æŠ¤æ¨¡å¼]</span></span><br><span class="line">protected-mode no</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># reids æ—¥å¿—è¾“å‡ºä½ç½®</span></span><br><span class="line">logfile <span class="string">"/usr/local/redis/redis-6.2.1/redis.log"</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è®¾ç½®æœ€å¤§å†…å­˜,å•ä½ï¼šå­—èŠ‚ã€å¦‚æœå†…å­˜è¶³å¤Ÿï¼Œé»˜è®¤å³å¯ã€‘</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®redisæœ€å¤§å ç”¨å†…å­˜ï¼š0.75G</span></span><br><span class="line">maxmemory 268435456</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è®¾ç½®å¯†ç </li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®rediså¯†ç </span></span><br><span class="line">requirepass redis123</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ä¿®æ”¹ç«¯å£ï¼ˆéå¿…é¡»<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼‰</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç«¯å£</span></span><br><span class="line">port 16379</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä»–çš„é…ç½®ï¼Œé»˜è®¤å³å¯ã€‚</p>
<h4 id="é‡å¯Reids"><a href="#é‡å¯Reids" class="headerlink" title="é‡å¯Reids"></a>é‡å¯Reids</h4><blockquote>
<p>å› ä¸ºæ˜¯è‡ªå®šä¹‰å®‰è£…çš„åŸå› ï¼Œæ‰€ä»¥é‡ç½®RedisæœåŠ¡çš„æ—¶å€™éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶<code>redis.conf</code></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è¦æŒ‡å®šredis.confçš„å…·ä½“è·¯å¾„</span></span><br><span class="line">[root@horse bin]<span class="comment"># redis-server /usr/local/redis/redis-6.2.1/etc/redis.conf </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="redis-cliå®¢æˆ·ç«¯"><a href="#redis-cliå®¢æˆ·ç«¯" class="headerlink" title="redis-cliå®¢æˆ·ç«¯"></a>redis-cliå®¢æˆ·ç«¯</h3><blockquote>
<p>å°†<code>redis-cli</code>è·¯å¾„æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå³å¯åœ¨ä»»æ„è·¯å¾„ä¸‹æ‰§è¡Œ<code>redis-cli -a å¯†ç  -p ç«¯å£ -h IPåœ°å€</code>å‘½ä»¤ï¼Œè¿›å…¥redis-cliå®¢æˆ·ç«¯ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>æ‰“å¼€<code>/etc/profile</code>æ–‡ä»¶ï¼Œç¼–è¾‘è·¯å¾„é…ç½®</li>
<li>åˆ·æ–°ç¯å¢ƒé…ç½®ï¼š<code>source /etc/profile</code></li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># mysqlç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> MYSQL_HOME=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># redisç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> REDIS_HOME=/usr/<span class="built_in">local</span>/redis/redis-6.2.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># jdkç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># JAVA_HOMEï¼šjdkè§£å‹çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk/jdk1.8.0_291</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=$:CLASSPATH:<span class="variable">$JAVA_HOME</span>/lib/</span><br><span class="line"><span class="comment"># ä¸åŒæœåŠ¡è·¯å¾„ä¹‹é—´ä½¿ç”¨â€œ:â€(è‹±æ–‡å†’å·)éš”å¼€</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$MYSQL_HOME</span>/bin:<span class="variable">$REDIS_HOME</span>/bin</span><br></pre></td></tr></tbody></table></figure>
<h3 id="rediså¯åŠ¨è„šæœ¬"><a href="#rediså¯åŠ¨è„šæœ¬" class="headerlink" title="rediså¯åŠ¨è„šæœ¬"></a>rediså¯åŠ¨è„šæœ¬</h3><blockquote>
<p>éœ€æ±‚ï¼šé…ç½®redisè„šæœ¬ï¼Œåœ¨ä»»æ„è·¯å¾„ä¸‹å¿«æ·å¯åŠ¨ã€åœæ­¢redisæœåŠ¡</p>
</blockquote>
<h4 id="è„šæœ¬ä»‹ç»"><a href="#è„šæœ¬ä»‹ç»" class="headerlink" title="è„šæœ¬ä»‹ç»"></a>è„šæœ¬ä»‹ç»</h4><blockquote>
<ol>
<li><p>åœ¨<code>/etc/init.d/</code>ç›®å½•ä¸‹åˆ›å»ºè„šæœ¬ æ–‡ä»¶ redis_16379</p>
</li>
<li><p>æ ¹æ®rediså„ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œé…ç½®redis_16379è„šæœ¬æ–‡ä»¶</p>
</li>
<li><p>æ‰§è¡Œè„šæœ¬ã€</p>
<ul>
<li><p>å¼€å¯å‘½ä»¤ï¼šservice redis_16379 start</p>
</li>
<li><p>å…³é—­å‘½ä»¤ï¼šservice redis_16379 stop</p>
</li>
</ul>
</li>
</ol>
<p><strong>å‘ç‚¹ï¼š</strong></p>
<ul>
<li><p>rediså¦‚æœè®¾ç½®æœ‰å¯†ç ï¼Œåœ¨è„šæœ¬æ–‡ä»¶ä¸­ï¼Œå¿…é¡»è¿›è¡Œæ˜¾å¼å®šä¹‰ä½¿ç”¨ã€‚</p>
</li>
<li><p>ä½¿ç”¨è„šæœ¬å¼€å¯ï¼Œå¿…é¡»ä½¿ç”¨è„šæœ¬å…³é—­ï¼Œå¦åˆ™ä¼šæ— æ³•åœ¨å…³é—­redisçš„æ—¶å€™ç³»ç»Ÿè‡ªåŠ¨åˆ é™¤<code>/var/run/redis_16379.pid</code>æ–‡ä»¶ã€‚</p>
</li>
<li>å¦‚æœæœªä½¿ç”¨è„šæœ¬å…³é—­redisæœåŠ¡åï¼Œåªéœ€è¦æ‰‹åŠ¨åˆ é™¤redis_16379.pid æ–‡ä»¶å³å¯å†æ¬¡ä½¿ç”¨è„šæœ¬å¯åŠ¨ã€‚</li>
<li>è„šæœ¬æ–‡ä»¶åç§°å¯æ”¹åŠ¨ï¼Œè§åçŸ¥ä¹‰å³å¯ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯redisæœåŠ¡</span></span><br><span class="line">service redis_16379 start</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­redisæœåŠ¡</span></span><br><span class="line">service redis_16379 stop</span><br></pre></td></tr></tbody></table></figure>
<h4 id="è„šæœ¬ç¤ºä¾‹"><a href="#è„šæœ¬ç¤ºä¾‹" class="headerlink" title="è„šæœ¬ç¤ºä¾‹"></a>è„šæœ¬ç¤ºä¾‹</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬ä»£ç ç¤ºä¾‹è¯¦è§£</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#redisæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">REDISPORT=16379</span><br><span class="line"></span><br><span class="line"><span class="comment">#redis-serveræœåŠ¡ç«¯æ‰€å¤„ä½ç½®</span></span><br><span class="line">EXEC=/home/yahutest/redis-4.0.6/src/redis-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#redis-cliå®¢æˆ·ç«¯ä½ç½®</span></span><br><span class="line">CLIEXEC=/home/yahutest/redis-4.0.6/src/redis-cli</span><br><span class="line"></span><br><span class="line"><span class="comment">#redisçš„PIDæ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤åœ¨ /var/run/è·¯å¾„ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªã€redis_ç«¯å£å·.pidã€‘æ–‡ä»¶</span></span><br><span class="line">PIDFILE=/var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#redis.confçš„é…ç½®æ–‡ä»¶ä½ç½®ï¼Œéœ€å°†${REDISPORT}ä¿®æ”¹ä¸ºæ–‡ä»¶å</span></span><br><span class="line">CONF=<span class="string">"/home/yahutest/redis-4.0.6/redis.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rediså¯†ç </span></span><br><span class="line">PWD=redis123</span><br><span class="line"></span><br><span class="line"><span class="comment"># $1: æ¥æ”¶å¤–é¢ä¼ å…¥çš„å‚æ•°ï¼Œstart æˆ–è€… stop</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="variable">$PIDFILE</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDFILE</span> exists, process is already running or crashed"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Starting Redis server..."</span></span><br><span class="line">                <span class="comment"># æ‹¼æ¥å¹¶æ‰§è¡Œrediså¯åŠ¨å‘½ä»¤</span></span><br><span class="line">                <span class="variable">$EXEC</span> <span class="variable">$CONF</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Redis start success!"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        <span class="keyword">if</span> [ ! -f <span class="variable">$PIDFILE</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDFILE</span> does not exist, process is not running"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                PID=$(cat <span class="variable">$PIDFILE</span>)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Stopping ..."</span></span><br><span class="line">                <span class="comment"># æ‰§è¡Œå®¢æˆ·ç«¯å‘½ä»¤ï¼Œå…³é—­redisæœåŠ¡ï¼ˆå¦‚æœç«¯å£å·å’Œå¯†ç æœ‰é…ç½®ï¼Œè¿™é‡Œä¹Ÿè¦é‡æ–°è¿›è¡ŒæŒ‡å®šï¼Œå¦åˆ™æ— æ³•å…³é—­ï¼‰</span></span><br><span class="line">                <span class="variable">$CLIEXEC</span> -p <span class="variable">$REDISPORT</span> -a <span class="variable">$PWD</span> shutdown</span><br><span class="line">                <span class="keyword">while</span> [ -x /proc/<span class="variable">${PID}</span> ]</span><br><span class="line">                <span class="keyword">do</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">"Waiting for Redis to shutdown ..."</span></span><br><span class="line">                    sleep 1</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Redis stopp success!"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Please use start or stop as first argument"</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="MongoDBæ­å»º"><a href="#MongoDBæ­å»º" class="headerlink" title="MongoDBæ­å»º"></a>MongoDBæ­å»º</h2><h3 id="å®‰è£…è¦æ±‚-1"><a href="#å®‰è£…è¦æ±‚-1" class="headerlink" title="å®‰è£…è¦æ±‚"></a>å®‰è£…è¦æ±‚</h3><blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li>æºç å®‰è£…ï¼š<a href="https://www.cnblogs.com/wangchengyi/articles/12094967.html?d=1625712366635">centos7éƒ¨ç½²mongodb4.0.14</a></li>
<li>yumæ–¹å¼å®‰è£…ï¼š<a href="https://www.horsemuzi.top/Linux/Linuxå®‰è£…MondoDB/">Linux ç¯å¢ƒä¸‹å®‰è£… MongoDB 4.x</a></li>
</ul>
<p>è¦æ±‚ï¼š</p>
<ul>
<li>ç«¯å£ï¼š27017</li>
<li>å®‰è£…æ–¹å¼ï¼šæºç å®‰è£…</li>
<li>è‡ªè¡Œæµ‹è¯•<code>mongo</code>å®¢æˆ·ç«¯æ˜¯å¦æ­£å¸¸</li>
</ul>
</blockquote>
<h3 id="å®‰è£…è¿‡ç¨‹-1"><a href="#å®‰è£…è¿‡ç¨‹-1" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h3><h4 id="å‹ç¼©åŒ…ä¸‹è½½"><a href="#å‹ç¼©åŒ…ä¸‹è½½" class="headerlink" title="å‹ç¼©åŒ…ä¸‹è½½"></a>å‹ç¼©åŒ…ä¸‹è½½</h4><blockquote>
<p>mongodbå®˜ç½‘ï¼š<a href="https://www.mongodb.com/try/download/community">mongodbç‚¹å‡»ä¸‹è½½</a></p>
<p><img src="https://i.loli.net/2021/07/08/Jrn5G71apvlPWRt.png" alt="mongodbå®˜ç½‘"></p>
</blockquote>
<h4 id="è§£å‹åŒ…"><a href="#è§£å‹åŒ…" class="headerlink" title="è§£å‹åŒ…"></a>è§£å‹åŒ…</h4><blockquote>
<p>å°†è§£å‹èµ„æºç§»åŠ¨åˆ°<code>/usr/local/mongodb/</code>ç›®å½•ä¸‹</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">tar -zxvf mongodb-linux-x86_64-4.0.14.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç§»åŠ¨åçš„èµ„æº</span></span><br><span class="line">[root@localhost mongodb]<span class="comment"># ll</span></span><br><span class="line">æ€»ç”¨é‡ 320</span><br><span class="line">drwxr-xr-x. 2 root root   4096 7æœˆ  26 09:01 bin</span><br><span class="line">drwxr-xr-x. 3 root root   4096 7æœˆ  27 09:10 data</span><br><span class="line">drwxr-xr-x. 2 root root     49 7æœˆ  26 09:19 etc</span><br><span class="line">-rw-r--r--. 1 root root  30608 5æœˆ   3 23:08 LICENSE-Community.txt</span><br><span class="line">drwxr-xr-x. 2 root root     62 7æœˆ  26 09:19 logs</span><br><span class="line">-rw-r--r--. 1 root root  16726 5æœˆ   3 23:08 MPL-2</span><br><span class="line">-rw-r--r--. 1 root root   2581 5æœˆ   3 23:08 README</span><br><span class="line">-rw-r--r--. 1 root root  75405 5æœˆ   3 23:08 THIRD-PARTY-NOTICES</span><br><span class="line">-rw-r--r--. 1 root root 183512 5æœˆ   3 23:10 THIRD-PARTY-NOTICES.gotools</span><br><span class="line">[root@localhost mongodb]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mongodb</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="åˆ›å»ºå­˜å‚¨è·¯å¾„"><a href="#åˆ›å»ºå­˜å‚¨è·¯å¾„" class="headerlink" title="åˆ›å»ºå­˜å‚¨è·¯å¾„"></a>åˆ›å»ºå­˜å‚¨è·¯å¾„</h4><blockquote>
<p>åˆ†åˆ«åˆ›å»º<code>data</code>,<code>logs</code>,<code>etc</code>ä¸‰ä¸ªèµ„æºç›®å½•ï¼Œåˆ†åˆ«æ”¾ç½®å­˜å‚¨æ•°æ®ã€æ—¥å¿—æ–‡ä»¶ã€é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/mongodb/ data logs etc</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦ç”¨åˆ°ï¼‰</span></span><br><span class="line">touch /usr/<span class="built_in">local</span>/mongodb/logs/mongodb.log</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/mongodb/etc/mongodb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“é…ç½®å†…å®¹å¦‚ä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ•°æ®åº“è·¯å¾„</span></span><br><span class="line">dbpath=/usr/<span class="built_in">local</span>/mongodb/data</span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">logpath=/usr/<span class="built_in">local</span>/mongodb/logs/mongodb.log</span><br><span class="line"><span class="comment"># ç«¯å£å·</span></span><br><span class="line">port=27017</span><br><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">fork=<span class="literal">true</span></span><br><span class="line"><span class="comment"># å…³é—­æ—¥å¿—é€‰é¡¹ï¼ˆå¼€å¯çš„è¯ï¼ŒMongoDBçš„æ•°æ®æ“ä½œå°†ä¼šå†™å…¥åˆ°journalæ–‡ä»¶å¤¹çš„æ–‡ä»¶é‡Œï¼‰</span></span><br><span class="line">journal=<span class="literal">false</span></span><br><span class="line"><span class="comment"># ç»‘å®šæœåŠ¡IPï¼Œè‹¥ç»‘å®š127.0.0.1ï¼Œåˆ™åªèƒ½æœ¬æœºè®¿é—®ï¼›è‹¥ç»‘å®š0.0.0.0ï¼Œåˆ™æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">bind_ip=0.0.0.0</span><br><span class="line"><span class="comment"># å¼€å¯ç”¨æˆ·è®¤è¯</span></span><br><span class="line">auth=<span class="literal">true</span></span><br><span class="line"><span class="comment"># è¿‡æ»¤æ— ç”¨æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">quiet=<span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodb config</span></span><br><span class="line"><span class="built_in">export</span> MONGODB_HOME=/usr/<span class="built_in">local</span>/mongodb</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MONGODB_HOME</span>/bin</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨mongodb"><a href="#å¯åŠ¨mongodb" class="headerlink" title="å¯åŠ¨mongodb"></a>å¯åŠ¨mongodb</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æœåŠ¡</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mongodb/bin/mongod -f ../etc/mongodb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class="line">[root@localhost mongodb]<span class="comment"># ps -ef | grep mongod</span></span><br><span class="line">root      23088      1  0 7æœˆ26 ?       00:03:16 ./mongod -f ../etc/mongodb.conf</span><br><span class="line">root      36048  35049  0 09:20 pts/3    00:00:00 grep --color=auto mongod</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è´¦æˆ·è§’è‰²é…ç½®"><a href="#è´¦æˆ·è§’è‰²é…ç½®" class="headerlink" title="è´¦æˆ·è§’è‰²é…ç½®"></a>è´¦æˆ·è§’è‰²é…ç½®</h3><blockquote>
<p>é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ•°æ®åº“ï¼šdbh</li>
<li>ç”¨æˆ·ï¼šdbhUserï¼Œæƒé™ï¼š readWriteï¼ˆè¯»å†™æƒé™ï¼‰</li>
<li>å¯†ç ï¼šmongo123</li>
</ul>
<p><strong>å‘ç‚¹ï¼š</strong></p>
<ul>
<li>è¿›å…¥mongoå®¢æˆ·ç«¯ä¸­ï¼Œåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ä¸èƒ½è¿›è¡Œä¸¤æ¬¡ db.auth() æˆæƒéªŒè¯æ“ä½œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚åªéœ€è¦é€€å‡ºé‡æ–°è¿›å…¥å³å¯è§£å†³ã€‚ä¾‹å¦‚ï¼šåœ¨æŒ‡å®šå®Œ use admin å’Œç›¸åº”çš„æˆæƒå‘½ä»¤db.auth()åï¼Œå°±ä¸èƒ½åœ¨æ‰§è¡Œ use dbh å’Œ db.auth()å‘½ä»¤ï¼Œå¿…é¡»é€€å‡ºé‡æ–°è¿›å…¥æ‰è¡Œã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># zåœ¨mongoå®‰è£…binç›®å½•ä¸‹è¿›å…¥å®¢æˆ·ç«¯</span></span><br><span class="line">[root@yhgateway bin]<span class="comment"># ./mongo</span></span><br><span class="line">MongoDB shell version v4.2.14</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session { <span class="string">"id"</span> : UUID(<span class="string">"aa0f3746-0477-40be-bf31-b758d960cdee"</span>) }</span><br><span class="line">MongoDB server version: 4.2.14</span><br><span class="line"><span class="comment"># åˆ‡æ¢æ•°æ®åº“,å¦‚æœæ²¡æœ‰æ­¤æ•°æ®åº“ï¼Œåˆ™è¿›è¡Œåˆ›å»º</span></span><br><span class="line">&gt; use dbh</span><br><span class="line">switched to dbh</span><br><span class="line"><span class="comment"># åˆ›å»ºé’ˆå¯¹æŸä¸ªæ•°æ®åº“çš„ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰</span></span><br><span class="line">&gt; db.createUser({user:<span class="string">"dbhUser"</span>,<span class="built_in">pwd</span>:<span class="string">"mongo123"</span>,roles:[{role:<span class="string">"readWrite"</span>,db:<span class="string">"dbh"</span>}]})</span><br></pre></td></tr></tbody></table></figure>
<p>æµ‹è¯•é…ç½®</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢æ•°æ®åº“</span></span><br><span class="line">&gt; use dbh</span><br><span class="line">switched to db dbh</span><br><span class="line"><span class="comment"># è¿›è¡ŒæˆæƒéªŒè¯</span></span><br><span class="line">&gt; db.auth(<span class="string">"dbhUser"</span>,<span class="string">"mongo123"</span>)</span><br><span class="line">1</span><br><span class="line"><span class="comment"># æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">&gt; db.dbh.find().pretty();</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mongoå®¢æˆ·ç«¯"><a href="#mongoå®¢æˆ·ç«¯" class="headerlink" title="mongoå®¢æˆ·ç«¯"></a>mongoå®¢æˆ·ç«¯</h3><blockquote>
<p>å°†<code>mongo</code>çš„æ–‡ä»¶è·¯å¾„ï¼Œæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå³å¯åœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ<code>mongo ip:port</code>å‘½ä»¤ï¼Œè¿æ¥æŒ‡å®šç«¯å£å·çš„å®¢æˆ·ç«¯</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># redis configuration</span></span><br><span class="line"><span class="built_in">export</span> REDIS_HOME=/home/yahutest/redis-4.0.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodb configuration</span></span><br><span class="line"><span class="built_in">export</span> MONGO_HOME=/home/yahutest/mongodb-linux-x86_64-rhel70-4.2.14</span><br><span class="line"></span><br><span class="line"><span class="comment"># JDK Configuration</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java/jdk1.8.0_144</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=/usr/<span class="built_in">local</span>/java/jdk1.8.0_144/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># config        </span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$REDIS_HOME</span>/src:<span class="variable">$MONGO_HOME</span>/bin</span><br></pre></td></tr></tbody></table></figure>
<p>è¿æ¥æµ‹è¯•</p>
<blockquote>
<p>æ³¨æ„ï¼šå½“å‰ç³»ç»Ÿä¸­å·²ç»å¼€å¯ç«¯å£ä¸º <code>27017</code>çš„mongoæœåŠ¡</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šè¿æ¥27017ç«¯å£å®¢æˆ·ç«¯ ï¼ˆè¿æ¥æˆåŠŸï¼‰</span></span><br><span class="line">[root@yhgateway ~]<span class="comment"># mongo localhost:27017</span></span><br><span class="line">MongoDB shell version v4.2.14</span><br><span class="line">connecting to: mongodb://localhost:27017/<span class="built_in">test</span>?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session { <span class="string">"id"</span> : UUID(<span class="string">"094b3a80-c369-4840-b3b2-ca4bb60edecd"</span>) }</span><br><span class="line">MongoDB server version: 4.2.14</span><br><span class="line">&gt; use dbh</span><br><span class="line">switched to db dbh</span><br><span class="line">&gt; db.auth(<span class="string">"dbhUser"</span>,<span class="string">"mongo123"</span>)</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè¿æ¥3717ç«¯å£å®¢æˆ·ç«¯ ï¼ˆæ— æ­¤ç«¯å£æœåŠ¡ï¼Œæ— æ³•è¿æ¥ï¼‰</span></span><br><span class="line">[root@yhgateway ~]<span class="comment"># mongo localhost:3717</span></span><br><span class="line">MongoDB shell version v4.2.14</span><br><span class="line">connecting to: mongodb://localhost:3717/<span class="built_in">test</span>?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">2021-07-08T14:29:20.199+0800 E  QUERY    [js] Error: couldn<span class="string">'t connect to server localhost:3717, connection attempt failed: SocketException: Error connecting to localhost:3717 (127.0.0.1:3717) :: caused by :: Connection refused :</span></span><br><span class="line"><span class="string">connect@src/mongo/shell/mongo.js:353:17</span></span><br><span class="line"><span class="string">@(connect):2:6</span></span><br><span class="line"><span class="string">2021-07-08T14:29:20.200+0800 F  -        [main] exception: connect failed</span></span><br><span class="line"><span class="string">2021-07-08T14:29:20.200+0800 E  -        [main] exiting with code 1</span></span><br><span class="line"><span class="string">[root@yhgateway ~]# </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="mongoå¯åŠ¨è„šæœ¬"><a href="#mongoå¯åŠ¨è„šæœ¬" class="headerlink" title="mongoå¯åŠ¨è„šæœ¬"></a>mongoå¯åŠ¨è„šæœ¬</h3><blockquote>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨<code>/etc/init.d/</code>ç›®å½•ä¸‹åˆ›å»ºmongodæ–‡ä»¶å¹¶ç¼–è¾‘</li>
<li>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š<code>chmod 755 mongod</code></li>
<li>æŒ‡å®šå‘½ä»¤ï¼š<ol>
<li>å¼€å¯æœåŠ¡ï¼š<code>systemctl start mongod</code></li>
<li>é‡å¯æœåŠ¡ï¼š<code>systemctl restart mongod</code></li>
<li>å…³é—­æœåŠ¡ï¼š<code>systemctl stop mongod</code></li>
</ol>
</li>
</ol>
</blockquote>
<p>è„šæœ¬ç¤ºä¾‹</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#!bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodæ–‡ä»¶ç»å¯¹è·¯å¾„</span></span><br><span class="line">MONGOD=/home/yahutest/mongodb-linux-x86_64-rhel70-4.2.14/bin/mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodb.confæ–‡ä»¶ç»å¯¹è·¯å¾„</span></span><br><span class="line">CONF=/home/yahutest/mongodb/etc/mongodb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å¼€å¯æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>(){</span><br><span class="line">    <span class="variable">$MONGOD</span> --config <span class="variable">$CONF</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å…³é—­æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>(){</span><br><span class="line">    <span class="variable">$MONGOD</span> --config <span class="variable">$CONF</span> --shutdown</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®æ‰§è¡Œè„šæœ¬ä¼ å…¥çš„ å‚æ•°$1 æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line"> start)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"starting mongodb server..."</span></span><br><span class="line">  start</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"mongodb start success!"</span></span><br><span class="line"> ;;</span><br><span class="line"></span><br><span class="line">stop)</span><br><span class="line">  stop</span><br><span class="line"> ;;</span><br><span class="line"></span><br><span class="line">restart)</span><br><span class="line">  stop</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"> $<span class="string">"Please use start or restart or stop as first argument"</span></span><br><span class="line">   <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>ä¿®æ”¹æ–‡ä»¶æƒé™</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">chmod 755 mongod</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h3><blockquote>
<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨mongoè‡ªå¸¦çš„<code>mongoexport</code>å’Œ<code>mongoimport</code>å‘½ä»¤è¿›è¡Œæ•°æ®è¿ç§»ï¼ŒåŸç†ï¼šå…ˆå¯¼å‡ºé›†åˆæ•°æ®ï¼Œåœ¨å¯¼å…¥åˆ°mongoæ•°æ®åº“ä¸­ã€‚</p>
<p>æ–¹å¼äºŒï¼šä½¿ç”¨<code>mongodump</code>å’Œ<code>mongorestore</code>å‘½ä»¤è¿›è¡Œæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼ŒåŸç†ï¼šå…ˆå¤‡ä»½æ•°æ®åˆ°æŒ‡å®šä½ç½®ï¼Œå†ä»æŒ‡å®šä½ç½®æ¢å¤æ•°æ®</p>
<p>æ³¨æ„ï¼šmongodbéœ€è¦æ·»åŠ åˆ°<code>PATHç¯å¢ƒå˜é‡</code>ä¸­</p>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>mongodump æ¯” mongoexport çš„é€Ÿåº¦ç¨å¿«ï¼ˆä½¿ç”¨æ—¶æ²¡æ€ä¹ˆæ„Ÿè§‰åˆ°ï¼‰</li>
<li>mongodump å¯ä»¥backupæ•´ä¸ªæ•°æ®åº“æˆ–è€…ä¹Ÿå¯ä»¥é’ˆå¯¹æ¯ä¸ªcollectionæ“ä½œï¼Œè€Œmongoexportåªèƒ½å¯¹æ¯ä¸ªcollectionè¿›è¡Œæ“ä½œ</li>
<li>mongoexport è¾“å‡ºçš„JSONæ¯”mongodump çš„BSONå¯è¯»æ€§æ›´é«˜</li>
</ul>
<p>æ¨èä½¿ç”¨ï¼š<code>mongoexport</code>å’Œ<code>mongoimport</code>è¿›è¡Œæ•°æ®è¿ç§»</p>
</blockquote>
<h4 id="æ•°æ®å¯¼å‡º"><a href="#æ•°æ®å¯¼å‡º" class="headerlink" title="æ•°æ®å¯¼å‡º"></a>æ•°æ®å¯¼å‡º</h4><h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><blockquote>
<p>å¯¼å‡ºå‘½ä»¤ï¼š<code>mongoexport</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>-h, â€”host ï¼šä»£è¡¨è¿œç¨‹è¿æ¥çš„æ•°æ®åº“åœ°å€ï¼Œé»˜è®¤è¿æ¥æœ¬åœ°Mongoæ•°æ®åº“ï¼›</li>
<li>â€”portï¼šä»£è¡¨è¿œç¨‹è¿æ¥çš„æ•°æ®åº“çš„ç«¯å£ï¼Œé»˜è®¤è¿æ¥çš„è¿œç¨‹ç«¯å£27017ï¼›</li>
<li>-u,â€”usernameï¼šä»£è¡¨è¿æ¥è¿œç¨‹æ•°æ®åº“çš„è´¦å·ï¼Œå¦‚æœè®¾ç½®æ•°æ®åº“çš„è®¤è¯ï¼Œéœ€è¦æŒ‡å®šç”¨æˆ·è´¦å·ï¼›</li>
<li>-p,â€”passwordï¼šä»£è¡¨è¿æ¥æ•°æ®åº“çš„è´¦å·å¯¹åº”çš„å¯†ç ï¼›</li>
<li>-d,â€”dbï¼šä»£è¡¨è¿æ¥çš„æ•°æ®åº“ï¼›</li>
<li>-c,â€”collectionï¼šä»£è¡¨è¿æ¥æ•°æ®åº“ä¸­çš„é›†åˆï¼›</li>
<li>-f, â€”fieldsï¼šä»£è¡¨é›†åˆä¸­çš„å­—æ®µï¼Œå¯ä»¥æ ¹æ®è®¾ç½®é€‰æ‹©å¯¼å‡ºçš„å­—æ®µï¼›</li>
<li>â€”typeï¼šä»£è¡¨å¯¼å‡ºè¾“å‡ºçš„æ–‡ä»¶ç±»å‹ï¼ŒåŒ…æ‹¬csvå’Œjsonæ–‡ä»¶ï¼›</li>
<li>-o, â€”outï¼šä»£è¡¨å¯¼å‡ºçš„æ–‡ä»¶åï¼›</li>
<li>-q, â€”queryï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼›</li>
<li>â€”skipï¼šè·³è¿‡æŒ‡å®šæ•°é‡çš„æ•°æ®ï¼›</li>
<li>â€”limitï¼šè¯»å–æŒ‡å®šæ•°é‡çš„æ•°æ®è®°å½•ï¼›</li>
<li>â€”sortï¼šå¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œå¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šæ’åºçš„å­—æ®µï¼Œå¹¶ä½¿ç”¨ 1 å’Œ -1 æ¥æŒ‡å®šæ’åºçš„æ–¹å¼ï¼Œå…¶ä¸­ 1 ä¸ºå‡åºæ’åˆ—ï¼Œè€Œ-1æ˜¯ç”¨äºé™åºæ’åˆ—,å¦‚sort({KEY:1})ã€‚</li>
</ul>
</blockquote>
<h5 id="å‘½ä»¤ç¤ºä¾‹"><a href="#å‘½ä»¤ç¤ºä¾‹" class="headerlink" title="å‘½ä»¤ç¤ºä¾‹"></a>å‘½ä»¤ç¤ºä¾‹</h5><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡º admin åº“ä¸­ fs.files é›†åˆä¸­çš„æ•°æ®åˆ° /tmp/files.json æ–‡ä»¶ä¸­</span></span><br><span class="line">mongoexport -h localhost:27017 -u root -p mongo123 -d admin -c fs.files -o /tmp/files.json --<span class="built_in">type</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡º admin åº“ä¸­ fs.chunks é›†åˆæ•°æ®åˆ° /tmp/chunks.json æ–‡ä»¶ä¸­</span></span><br><span class="line">mongoexport -h localhost:27017 -u root -p mongo123 -d admin -c fs.chunks -o /tmp/chunks.json --<span class="built_in">type</span> json</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ•°æ®å¯¼å…¥"><a href="#æ•°æ®å¯¼å…¥" class="headerlink" title="æ•°æ®å¯¼å…¥"></a>æ•°æ®å¯¼å…¥</h4><h5 id="å‚æ•°è¯´æ˜-1"><a href="#å‚æ•°è¯´æ˜-1" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><blockquote>
<p>å¯¼å…¥å‘½ä»¤ï¼š<code>mongoimport</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>h,â€”host ï¼šä»£è¡¨è¿œç¨‹è¿æ¥çš„æ•°æ®åº“åœ°å€ï¼Œé»˜è®¤è¿æ¥æœ¬åœ°Mongoæ•°æ®åº“ï¼›</li>
<li>â€”portï¼šä»£è¡¨è¿œç¨‹è¿æ¥çš„æ•°æ®åº“çš„ç«¯å£ï¼Œé»˜è®¤è¿æ¥çš„è¿œç¨‹ç«¯å£27017ï¼›</li>
<li>-u,â€”usernameï¼šä»£è¡¨è¿æ¥è¿œç¨‹æ•°æ®åº“çš„è´¦å·ï¼Œå¦‚æœè®¾ç½®æ•°æ®åº“çš„è®¤è¯ï¼Œéœ€è¦æŒ‡å®šç”¨æˆ·è´¦å·ï¼›</li>
<li>-p,â€”passwordï¼šä»£è¡¨è¿æ¥æ•°æ®åº“çš„è´¦å·å¯¹åº”çš„å¯†ç ï¼›</li>
<li>-d,â€”dbï¼šä»£è¡¨è¿æ¥çš„æ•°æ®åº“ï¼›</li>
<li>-c,â€”collectionï¼šä»£è¡¨è¿æ¥æ•°æ®åº“ä¸­çš„é›†åˆï¼›</li>
<li>-f, â€”fieldsï¼šä»£è¡¨å¯¼å…¥é›†åˆä¸­çš„å­—æ®µï¼›</li>
<li>â€”typeï¼šä»£è¡¨å¯¼å…¥çš„æ–‡ä»¶ç±»å‹ï¼ŒåŒ…æ‹¬csvå’Œjson,tsvæ–‡ä»¶ï¼Œé»˜è®¤jsonæ ¼å¼ï¼›</li>
<li>â€”fileï¼šå¯¼å…¥çš„æ–‡ä»¶åç§°</li>
<li>â€”headerlineï¼šå¯¼å…¥csvæ–‡ä»¶æ—¶ï¼ŒæŒ‡æ˜ç¬¬ä¸€è¡Œæ˜¯åˆ—åï¼Œä¸éœ€è¦å¯¼å…¥ï¼›</li>
</ul>
</blockquote>
<h5 id="å‘½ä»¤ç¤ºä¾‹-1"><a href="#å‘½ä»¤ç¤ºä¾‹-1" class="headerlink" title="å‘½ä»¤ç¤ºä¾‹"></a>å‘½ä»¤ç¤ºä¾‹</h5><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥ /tmp/files.json æ–‡ä»¶å¯¼å…¥ admin åº“çš„ fs.files é›†åˆä¸­</span></span><br><span class="line"></span><br><span class="line">mongoimport -h localhost:27017 -u root -p mongo123 -d admin -c fs.files --file /tmp/files.json --<span class="built_in">type</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥ /tmp/chunks.json æ–‡ä»¶å¯¼å…¥ admin åº“çš„ fs.chunks é›†åˆä¸­</span></span><br><span class="line"></span><br><span class="line">mongoimport -h localhost:27017 -u root -p mongo123 -d admin -c fs.chunks --file /tmp/chunks.json --<span class="built_in">type</span> json</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ•°æ®å¤‡ä»½æ¢å¤"><a href="#æ•°æ®å¤‡ä»½æ¢å¤" class="headerlink" title="æ•°æ®å¤‡ä»½æ¢å¤"></a>æ•°æ®å¤‡ä»½æ¢å¤</h4><h5 id="æ•°æ®å¤‡ä»½"><a href="#æ•°æ®å¤‡ä»½" class="headerlink" title="æ•°æ®å¤‡ä»½"></a>æ•°æ®å¤‡ä»½</h5><h6 id="å‚æ•°ç¤ºä¾‹"><a href="#å‚æ•°ç¤ºä¾‹" class="headerlink" title="å‚æ•°ç¤ºä¾‹"></a>å‚æ•°ç¤ºä¾‹</h6><blockquote>
<p>å¤‡ä»½å‘½ä»¤ï¼š<code>mongodump</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>â€”host <hostname>&lt;:port&gt;, -h <hostname>&lt;:port&gt;  # æŒ‡å®šå¤‡ä»½çš„ä¸»æœºipå’Œç«¯å£å·ï¼Œé»˜è®¤å€¼localhost:27017 </hostname></hostname></li>
<li>â€”port # æŒ‡å®šç«¯å£å· é»˜è®¤27017 </li>
<li>â€”username <username>, -u <username> # æŒ‡å®šç”¨æˆ·å </username></username></li>
<li>â€”password <password>, -p <password> # æŒ‡å®šå¯†ç  </password></password></li>
<li>â€”authenticationDatabase <dbname> # æŒ‡å®šè®¤è¯çš„æ•°æ®åº“ </dbname></li>
<li>â€”authenticationMechanism <name> # æŒ‡å®šè®¤è¯çš„ç®—æ³• ï¼Œé»˜è®¤å€¼ SCRAM-SHA-1 </name></li>
<li>â€”db <database>, -d <database> # æŒ‡å®šå¤‡ä»½çš„æ•°æ®åº“ï¼ŒæœªæŒ‡å®šçš„è¯ï¼Œå¤‡ä»½æ‰€æœ‰çš„æ•°æ®åº“ï¼Œä½†ä¸åŒ…å«localåº“ </database></database></li>
<li>â€”collection <collection>, -c <collection> # æŒ‡å®šå¤‡ä»½çš„é›†åˆï¼ŒæœªæŒ‡å®šåˆ™å¤‡ä»½æŒ‡å®šåº“ä¸­çš„æ‰€æœ‰é›†åˆã€‚ </collection></collection></li>
<li>â€”query <json>, -q <json>  # æŒ‡å®š json ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚æ¥å¤‡ä»½æˆ‘ä»¬è¿‡æ»¤åçš„æ•°æ®ã€‚ â€”queryFile <path>  # æŒ‡å®š json æ–‡æ¡£è·¯å¾„ï¼Œä»¥è¯¥æ–‡æ¡£çš„å†…å®¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œæ¥å¤‡ä»½æˆ‘ä»¬è¿‡æ»¤åçš„æ•°æ®ã€‚ </path></json></json></li>
<li>â€”quit # é€šè¿‡æŠ‘åˆ¶ MongoDBçš„å¤åˆ¶ï¼Œè¿æ¥ç­‰æ´»åŠ¨ï¼Œæ¥å®ç°å¤‡ä»½ã€‚ </li>
<li>â€”gzip  # å¼€å¯å‹ç¼©ï¼Œ3.2ç‰ˆæœ¬åå¯ä»¥ä½¿ç”¨ï¼Œè¾“å‡ºä¸ºæ–‡ä»¶çš„è¯ä¼šå¸¦æœ‰åç¼€.gz </li>
<li>â€”out <path>, -o <path>  # è¾“å‡ºçš„ç›®å½•è·¯å¾„ï¼ˆå¦‚æœæŒ‡å®šé›†åˆçš„å¤‡ä»½ï¼Œé»˜è®¤ä¼šè¾“å‡ºçš„ç›®å½•æ ¼å¼ï¼šå½“å‰ç›®å½•/æ•°æ®åº“å/é›†åˆå.bsonï¼‰</path></path></li>
</ul>
</blockquote>
<h6 id="å‘½ä»¤ç¤ºä¾‹-2"><a href="#å‘½ä»¤ç¤ºä¾‹-2" class="headerlink" title="å‘½ä»¤ç¤ºä¾‹"></a>å‘½ä»¤ç¤ºä¾‹</h6><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º admin æ•°æ®åº“çš„ fs.files é›†åˆæ•°æ®åˆ° /tmp/ ç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line">mongodump -h 121.5.168.31:27017 -u root -p mongo123 --authenticationDatabase admin -d admin -c fs.files -o /tmp/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º admin æ•°æ®åº“çš„ fs.chunks é›†åˆæ•°æ®åˆ° /tmp/ ç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line">mongodump -h 121.5.168.31:27017 -u root -p mongo123 --authenticationDatabase admin -d admin -c fs.chunks -o /tmp/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> =============================æŸ¥çœ‹å¯¼å‡ºæ–‡ä»¶====================================</span></span><br><span class="line">[root@horse admin]# ll</span><br><span class="line">total 3820</span><br><span class="line">-rw-r--r-- 1 root root 3896395 Jul 28 14:56 fs.chunks.bson</span><br><span class="line">-rw-r--r-- 1 root root     163 Jul 28 14:55 fs.chunks.metadata.json</span><br><span class="line">-rw-r--r-- 1 root root     399 Jul 28 14:52 fs.files.bson</span><br><span class="line">-rw-r--r-- 1 root root     162 Jul 28 14:52 fs.files.metadata.json</span><br><span class="line">[root@horse admin]# pwd</span><br><span class="line">/tmp/admin</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="æ•°æ®æ¢å¤"><a href="#æ•°æ®æ¢å¤" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h5><h6 id="å‚æ•°ç¤ºä¾‹-1"><a href="#å‚æ•°ç¤ºä¾‹-1" class="headerlink" title="å‚æ•°ç¤ºä¾‹"></a>å‚æ•°ç¤ºä¾‹</h6><blockquote>
<p>æ¢å¤å‘½ä»¤ï¼š<code>mongorestore</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>â€”host <hostname>&lt;:port&gt;, -h <hostname>&lt;:port&gt;  # æŒ‡å®šæ¢å¤çš„ä¸»æœºipå’Œç«¯å£å·ï¼Œé»˜è®¤å€¼localhost:27017 </hostname></hostname></li>
<li>â€”port # æŒ‡å®šç«¯å£å· é»˜è®¤27017 </li>
<li>â€”username <username>, -u <username> # æŒ‡å®šç”¨æˆ·å </username></username></li>
<li>â€”password <password>, -p <password> # æŒ‡å®šå¯†ç  </password></password></li>
<li>â€”authenticationDatabase <dbname> # æŒ‡å®šè®¤è¯çš„æ•°æ®åº“ </dbname></li>
<li>â€”authenticationMechanism <name> # æŒ‡å®šè®¤è¯çš„ç®—æ³• ï¼Œé»˜è®¤å€¼ SCRAM-SHA-1 </name></li>
<li>â€”objcheck # å¼€å¯éªŒè¯ï¼ŒéªŒè¯è¿˜åŸæ“ä½œï¼Œç¡®ä¿æ²¡æœ‰æ— æ•ˆçš„æ–‡æ¡£æ’å…¥æ•°æ®åº“ã€‚ä¼šæœ‰è¾ƒå°çš„æ€§èƒ½å½±å“ </li>
<li>â€”oplogReplay # æ¢å¤å¤‡ä»½æ•°æ®å¹¶å°† mongodump æ‰§è¡ŒæœŸé—´çš„æ“ä½œ(è®°å½•åœ¨å¯¼å‡ºçš„æ—¥å¿—)æ¢å¤ã€‚ </li>
<li>â€”oplogLimit  # æŒ‡å®šæ¢å¤ </li>
<li>â€”oplogFile # æŒ‡å®š Oplog è·¯å¾„ </li>
<li>â€”keepIndexVersion # é˜»æ­¢mongorestoreåœ¨è¿˜åŸè¿‡ç¨‹ä¸­å°†ç´¢å¼•å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ </li>
<li>â€”restoreDbUsersAndRoles # è¿˜åŸæŒ‡å®šçš„æ•°æ®åº“ç”¨æˆ·å’Œè§’è‰²ã€‚ </li>
<li>â€”maintainInsertionOrder # é»˜è®¤å€¼ä¸ºFalse,å¦‚æœä¸º True,mongorestore å°†æŒ‰ç…§è¾“å…¥æºçš„æ–‡æ¡£é¡ºåºæ’å…¥ï¼Œå¦åˆ™æ˜¯ éšæœºæ‰§è¡Œæ’å…¥ã€‚ </li>
<li>â€”numParallelCollections int, -j int # æŒ‡å®šå¹¶è¡Œæ¢å¤çš„é›†åˆæ•°ã€‚ </li>
<li>â€”numInsertionWorkersPerCollection int # é»˜è®¤å€¼ä¸º 1ï¼ŒæŒ‡å®šæ¯ä¸ªé›†åˆæ¢å¤çš„å¹¶å‘æ•°ï¼Œå¤§æ•°æ®é‡å¯¼å…¥å¢åŠ è¯¥å€¼å¯æé«˜ æ¢å¤é€Ÿåº¦ã€‚ </li>
<li>â€”gzip # ä»å‹ç¼©æ–‡æ¡£ä¸­ æ¢å¤ã€‚ </li>
<li>â€”archive # ä»å½’æ¡£æ–‡ä»¶ä¸­æ¢å¤ã€‚ </li>
<li>â€”dir # æŒ‡å®šè¿˜åŸæ•°æ®å‚¨å­˜ç›®å½•ã€‚</li>
</ul>
</blockquote>
<h6 id="å‘½ä»¤ç¤ºä¾‹-3"><a href="#å‘½ä»¤ç¤ºä¾‹-3" class="headerlink" title="å‘½ä»¤ç¤ºä¾‹"></a>å‘½ä»¤ç¤ºä¾‹</h6><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ¢å¤ /tmp/admin/*.bson æ–‡ä»¶åˆ° admin æ•°æ®åº“ ä¸­çš„å¯¹åº”çš„ é›†åˆä¸­</span></span><br><span class="line"></span><br><span class="line">mongorestore -h 121.5.168.31:27017 -u root -p mongo123 --authenticationDatabase admin -d admin -c fs.files /tmp/admin/fs.files.bson</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤ /tmp/admin/*.bson æ–‡ä»¶åˆ° admin æ•°æ®åº“ ä¸­çš„å¯¹åº”çš„ é›†åˆä¸­</span></span><br><span class="line">mongorestore -h 121.5.168.31:27017 -u root -p mongo123 --authenticationDatabase admin -d admin -c fs.chunks /tmp/admin/fs.chunks.bson</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Dockeræ­å»º"><a href="#Dockeræ­å»º" class="headerlink" title="Dockeræ­å»º"></a>Dockeræ­å»º</h2><h3 id="å®‰è£…è¦æ±‚-2"><a href="#å®‰è£…è¦æ±‚-2" class="headerlink" title="å®‰è£…è¦æ±‚"></a>å®‰è£…è¦æ±‚</h3><blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.horsemuzi.top/Linux/Linuxå®‰è£…Docker/">Linuxå®‰è£…Docker</a></p>
<p>è¦æ±‚ï¼š</p>
<ul>
<li>å®ŒæˆDockerå®‰è£…ï¼Œèƒ½å¤Ÿå®Œæˆé•œåƒæ‹‰å–ã€è¿è¡Œçš„åŸºæœ¬æ“ä½œ</li>
</ul>
</blockquote>
<h3 id="å®‰è£…è¿‡ç¨‹-2"><a href="#å®‰è£…è¿‡ç¨‹-2" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h3><blockquote>
<p>æœ¬æ¬¡é‡‡ç”¨<code>yum</code>åœ¨çº¿å®‰è£…Dockerå·¥å…·</p>
</blockquote>
<h4 id="å®‰è£…yumå·¥å…·"><a href="#å®‰è£…yumå·¥å…·" class="headerlink" title="å®‰è£…yumå·¥å…·"></a>å®‰è£…yumå·¥å…·</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ·»åŠ è½¯ä»¶æº"><a href="#æ·»åŠ è½¯ä»¶æº" class="headerlink" title="æ·»åŠ è½¯ä»¶æº"></a>æ·»åŠ è½¯ä»¶æº</h4><blockquote>
<p>å®‰è£…è½¯ä»¶æºä¸ºï¼šé˜¿é‡Œäº‘ä»“åº“ï¼Œé€Ÿåº¦è¾ƒå¿«</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ›´æ–°yumç¼“å­˜"><a href="#æ›´æ–°yumç¼“å­˜" class="headerlink" title="æ›´æ–°yumç¼“å­˜"></a>æ›´æ–°yumç¼“å­˜</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum makecache fast</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®‰è£…Docker-ce"><a href="#å®‰è£…Docker-ce" class="headerlink" title="å®‰è£…Docker-ce"></a>å®‰è£…Docker-ce</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo yum -y install docker-ce</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨Docker"><a href="#å¯åŠ¨Docker" class="headerlink" title="å¯åŠ¨Docker"></a>å¯åŠ¨Docker</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></tbody></table></figure>
<h3 id="dockeråŸºç¡€å‘½ä»¤"><a href="#dockeråŸºç¡€å‘½ä»¤" class="headerlink" title="dockeråŸºç¡€å‘½ä»¤"></a>dockeråŸºç¡€å‘½ä»¤</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">docker version æˆ–è€… docker -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºdockerçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æŒ‡å®šé•œåƒ</span></span><br><span class="line">docker search rabbitmq</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²æ‹‰å–çš„æ‰€æœ‰é•œåƒ</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰ˆæœ¬æ‹‰å–é•œåƒï¼ˆå¦‚æœä¸æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆçš„é•œåƒï¼‰</span></span><br><span class="line">docker pull rabbitmq:3.8.14-management</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸¸ç”¨å‚æ•°è¯´æ˜</span></span><br><span class="line">--name=<span class="string">"å®¹å™¨åå­—"</span>  <span class="comment">#è®¾ç½®å¯åŠ¨å®¹å™¨çš„åå­—ï¼Œä¾‹å¦‚ï¼štomcat01,tomcat02...ï¼Œç”¨æ¥åŒºåˆ«å®¹å™¨</span></span><br><span class="line">-d  <span class="comment">#åå°æ–¹å¼è¿è¡Œ</span></span><br><span class="line">-it <span class="comment">#ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œå¹¶è¿›è¡Œå®¹å™¨è¿›è¡Œäº¤äº’æŸ¥çœ‹ä¿¡æ¯</span></span><br><span class="line">-p  <span class="comment">#ç«¯å£æ˜ å°„ï¼Œä¸‹é¢æ˜¯å‡ ç§ä¸åŒçš„æ˜ å°„ä¹¦å†™æ–¹å¼ï¼ˆæŒ‡å®šå®¹å™¨çš„æ˜ å°„ç«¯å£ï¼‰</span></span><br><span class="line">	1.ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</span><br><span class="line">	2.ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">	3.å®¹å™¨ç«¯å£</span><br><span class="line">docker run  -d --name horse-rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.8.14-management</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å·²ç»è¿è¡Œè¿‡çš„å®¹å™¨</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å·²ç»å¯åŠ¨çš„å®¹å™¨å†…éƒ¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [å®¹å™¨ID] /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ä¸»æœºæ‹·è´æ–‡ä»¶åˆ°å®¹å™¨å†…éƒ¨ï¼ˆåå‘æ‹·è´ä¹Ÿå¯ä»¥ï¼‰</span></span><br><span class="line">docker cp ä¸»æœºæ–‡ä»¶è·¯å¾„ å®¹å™¨ID:æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></tbody></table></figure>
<h2 id="RabbitMQæ­å»º"><a href="#RabbitMQæ­å»º" class="headerlink" title="RabbitMQæ­å»º"></a>RabbitMQæ­å»º</h2><h3 id="å®‰è£…è¦æ±‚-3"><a href="#å®‰è£…è¦æ±‚-3" class="headerlink" title="å®‰è£…è¦æ±‚"></a>å®‰è£…è¦æ±‚</h3><blockquote>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.horsemuzi.top/JAVA/RabbitMQå®‰è£…é…ç½®/">Linuxå®‰è£…RabbitMQ </a></p>
<p>è¦æ±‚ï¼š</p>
<ul>
<li>å®‰è£…å¸¦æœ‰å¯è§†åŒ–é…ç½®ç•Œé¢çš„rabbitmqç‰ˆæœ¬</li>
<li>å®‰è£…rabbitmqå»¶æ—¶æ’ä»¶</li>
</ul>
</blockquote>
<h3 id="å®‰è£…è¿‡ç¨‹-3"><a href="#å®‰è£…è¿‡ç¨‹-3" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h3><h4 id="æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨"><a href="#æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨" class="headerlink" title="æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨"></a>æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨</h4><blockquote>
<p>è¿›å…¥Docker Hubï¼ŒæŸ¥æ‰¾éœ€è¦ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426204759.png" alt="Snipaste_2021-04-26_20-47-38"></p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker pull rabbitmq:3.8.14-management</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG                 IMAGE ID       CREATED       SIZE</span><br><span class="line">rabbitmq     3.8.14-management   edd581f906b9   3 weeks ago   187MB</span><br></pre></td></tr></tbody></table></figure>
<p>å¯åŠ¨å®¹å™¨ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">docker run -d --name horse-rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.8.14-management</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED      STATUS      PORTS                                                                                                                                                 NAMES</span><br><span class="line">2d2dc97ed0f1   rabbitmq:3.8.14-management   <span class="string">"docker-entrypoint.sâ€¦"</span>   7 days ago   Up 2 days   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   horse-rabbitmq</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯è§†åŒ–é…ç½®"><a href="#å¯è§†åŒ–é…ç½®" class="headerlink" title="å¯è§†åŒ–é…ç½®"></a>å¯è§†åŒ–é…ç½®</h4><blockquote>
<p>å¯è§†åŒ–é¢æ¿åˆ›å»º è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·ã€äº¤æ¢æœºã€é˜Ÿåˆ—â€¦</p>
</blockquote>
<h5 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h5><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205228.png" alt="Snipaste_2021-04-26_20-51-24"></p>
<h5 id="æ·»åŠ ç”¨æˆ·"><a href="#æ·»åŠ ç”¨æˆ·" class="headerlink" title="æ·»åŠ ç”¨æˆ·"></a>æ·»åŠ ç”¨æˆ·</h5><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205351.png" alt="image_2021-04-23_17-59-01"></p>
<h5 id="æ·»åŠ è™šæ‹Ÿä¸»æœº"><a href="#æ·»åŠ è™šæ‹Ÿä¸»æœº" class="headerlink" title="æ·»åŠ è™šæ‹Ÿä¸»æœº"></a>æ·»åŠ è™šæ‹Ÿä¸»æœº</h5><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205409.png" alt="image_2021-04-23_18-00-36"></p>
<h5 id="ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº"><a href="#ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº" class="headerlink" title="ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº"></a>ç»‘å®šç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœº</h5><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210426205742.png" alt="Snipaste_2021-04-26_20-56-58"></p>
<p>é…ç½®å®Œæˆåï¼Œä½¿ç”¨é…ç½®çš„ç”¨æˆ·å’Œå¯†ç ç™»å½•å³å¯ã€‚</p>
<h3 id="å»¶æ—¶æ’ä»¶å®‰è£…"><a href="#å»¶æ—¶æ’ä»¶å®‰è£…" class="headerlink" title="å»¶æ—¶æ’ä»¶å®‰è£…"></a>å»¶æ—¶æ’ä»¶å®‰è£…</h3><blockquote>
<p>åœ¨RabbitMQå®¹å™¨ä¸­å®‰è£… å»¶æ—¶æ’ä»¶ï¼Œé¡¹ç›®ä¸­å¯ä»¥é…ç½®åŸºäºæ’ä»¶çš„å»¶æ—¶é˜Ÿåˆ—</p>
</blockquote>
<h4 id="æ’ä»¶ä¸‹è½½"><a href="#æ’ä»¶ä¸‹è½½" class="headerlink" title="æ’ä»¶ä¸‹è½½"></a>æ’ä»¶ä¸‹è½½</h4><blockquote>
<p><a href="https://www.rabbitmq.com/community-plugins.html">å»¶æ—¶æ’ä»¶ç‚¹å‡»ä¸‹è½½</a></p>
</blockquote>
<p><img src="https://i.loli.net/2021/05/27/nkYDxtPdCaSOMeW.png" alt="image-20210527175811822"></p>
<h4 id="è¿›å…¥RabbitMQå®¹å™¨"><a href="#è¿›å…¥RabbitMQå®¹å™¨" class="headerlink" title="è¿›å…¥RabbitMQå®¹å™¨"></a>è¿›å…¥RabbitMQå®¹å™¨</h4><blockquote>
<ul>
<li>è¿›å…¥æ­£åœ¨è¿è¡Œçš„RabbitMQå®¹å™¨ï¼ŒæŸ¥çœ‹RabbitMQçš„æ’ä»¶åˆ—è¡¨æ˜¯å¦å·²å®‰è£…æœ‰<code>å»¶æ—¶æ’ä»¶</code></li>
<li>æŠŠä¸‹è½½çš„æ’ä»¶å¤åˆ¶åˆ°<code>plugins</code>ç›®å½•ä¸‹</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@horse lib]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED      STATUS      PORTS                                                                                                                                                 NAMES</span><br><span class="line">abe759d645e4   rabbitmq:3.8.14-management   <span class="string">"docker-entrypoint.sâ€¦"</span>   2 days ago   Up 2 days   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   horse-rabbitmq</span><br><span class="line">[root@horse lib]<span class="comment"># docker exec -it abe759d645e4 /bin/bash</span></span><br><span class="line">root@abe759d645e4:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  plugins  root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   media  opt  proc     run   srv   tmp  var</span><br><span class="line">root@abe759d645e4:/<span class="comment"># cd plugins</span></span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># ls -l</span></span><br><span class="line">total 17640</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq      59 Mar  2 16:09 README</span><br><span class="line">-rw-r--r-- 1 rabbitmq rabbitmq   13408 Mar  2 16:09 accept-0.3.5.ez</span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¤åˆ¶ç§»åŠ¨æ’ä»¶"><a href="#å¤åˆ¶ç§»åŠ¨æ’ä»¶" class="headerlink" title="å¤åˆ¶ç§»åŠ¨æ’ä»¶"></a>å¤åˆ¶ç§»åŠ¨æ’ä»¶</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">docker cp /tmp/installPackage/rabbitmq_delayed_message_exchange-3.8.0.ez abe759d645e4:/plugins/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å¤åˆ¶æˆåŠŸ</span></span><br><span class="line">[root@horse /]<span class="comment"># docker exec -it abe759d645e4 /bin/bash</span></span><br><span class="line">root@abe759d645e4:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  plugins  root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   media  opt  proc     run   srv   tmp  var</span><br><span class="line">root@abe759d645e4:/<span class="comment"># cd plugins</span></span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># rabbitmq-plugins list</span></span><br><span class="line">Listing plugins with pattern <span class="string">".*"</span> ...</span><br><span class="line"> Configured: E = explicitly enabled; e = implicitly enabled</span><br><span class="line"> | Status: * = running on rabbit@abe759d645e4</span><br><span class="line"> |/</span><br><span class="line">[  ] rabbitmq_amqp1_0                  3.8.14</span><br><span class="line">[  ] rabbitmq_auth_mechanism_ssl       3.8.14</span><br><span class="line">[  ] rabbitmq_consistent_hash_exchange 3.8.14</span><br><span class="line"><span class="comment"># æ’ä»¶å·²å¤åˆ¶æˆåŠŸ</span></span><br><span class="line">[E*] rabbitmq_delayed_message_exchange 3.8.0</span><br><span class="line">[  ] rabbitmq_event_exchange           3.8.14</span><br><span class="line">[  ] rabbitmq_federation               3.8.14</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">root@abe759d645e4:/plugins<span class="comment"># </span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¼€å¯æ’ä»¶æœåŠ¡"><a href="#å¼€å¯æ’ä»¶æœåŠ¡" class="headerlink" title="å¼€å¯æ’ä»¶æœåŠ¡"></a>å¼€å¯æ’ä»¶æœåŠ¡</h4><blockquote>
<p>åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œä¸€ä¸‹ï¼Œé¿å…å‡ºé”™ï¼ˆè‹¥æ‰§è¡Œå‡ºé”™ï¼Œç»§ç»­æ‰§è¡Œå¼€å¯æ’ä»¶å‘½ä»¤ï¼‰</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æ’ä»¶(éœ€è¦åœ¨pluginsç›®å½•ä¸‹æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œæ³¨æ„è§‚å¯Ÿï¼Œä¸å¸¦æ’ä»¶åç¼€å“Ÿï¼)</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_delayed_message_exchange</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹"><a href="#å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹" class="headerlink" title="å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹"></a>å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210527201850.png" alt="image-20210527201840273"></p>
<h2 id="Nginxæ­å»º"><a href="#Nginxæ­å»º" class="headerlink" title="Nginxæ­å»º"></a>Nginxæ­å»º</h2><h3 id="nginxå®‰è£…"><a href="#nginxå®‰è£…" class="headerlink" title="nginxå®‰è£…"></a>nginxå®‰è£…</h3><h4 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">yum install gcc-c++ -y</span><br><span class="line"></span><br><span class="line">yum install -y openssl openssl-devel</span><br><span class="line"></span><br><span class="line">yum install -y pcre pcre-devel</span><br><span class="line"></span><br><span class="line">yum install -y zlib zlib-devel</span><br></pre></td></tr></tbody></table></figure>
<h4 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h4><blockquote>
<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœéœ€è¦å¼€å§‹httpsæ”¯æŒï¼Œè¿™é‡Œè¯·ä¸è¦ç›´æ¥æ‰§è¡Œ<code>./configure</code>ï¼Œå³ä¸è¦ç›´æ¥æ‰§è¡Œè¯¥è„šæœ¬ï¼Œè€Œæ˜¯åœ¨è¯¥è„šæœ¬åé¢åŠ ä¸ŠSSLæ¨¡å—<code>--with-http_ssl_module</code></p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹ç¼©</span></span><br><span class="line">tar -zxvf nginx-1.19.9.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.19.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œé…ç½®ï¼ˆå®‰è£…httpsæ¨¡å—ï¼Œstreamæ¨¡å—ï¼‰</span></span><br><span class="line">./configure --with-http_ssl_module --with-stream</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯åŠ¨nginx"><a href="#å¯åŠ¨nginx" class="headerlink" title="å¯åŠ¨nginx"></a>å¯åŠ¨nginx</h4><blockquote>
<p>è¿›å…¥<code>usr/local/nginx/sbin/</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>./nginx</code>å³å¯å¯åŠ¨æˆåŠŸ</p>
<p>ç›¸å…³å‘½ä»¤ï¼š</p>
<ul>
<li>æŸ¥çœ‹é…ç½®æ­£ç¡®æ€§ï¼š<code>./nginx  -t</code></li>
<li>å…³é—­nginx: <code>./nginx -s quit</code>æˆ–è€…<code>./nginx -s stop</code></li>
<li>é‡å¯nginxï¼š<code>./nginx -s reload</code></li>
</ul>
</blockquote>
<h4 id="nginxè‡ªå¯åŠ¨"><a href="#nginxè‡ªå¯åŠ¨" class="headerlink" title="nginxè‡ªå¯åŠ¨"></a>nginxè‡ªå¯åŠ¨</h4><blockquote>
<p>åœ¨<code>/etc/rc.local</code>æ–‡ä»¶ä¸­æ·»åŠ nginxçš„è·¯å¾„<code>/usr/local/nginx/sbin/nginx</code>å³å¯</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@localhost sbin]<span class="comment"># vim /etc/rc.local </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx config</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx                                           </span><br></pre></td></tr></tbody></table></figure>
<h3 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h3><h4 id="upstreamæœåŠ¡æµ"><a href="#upstreamæœåŠ¡æµ" class="headerlink" title="upstreamæœåŠ¡æµ"></a>upstreamæœåŠ¡æµ</h4><blockquote>
<p>å½“é…ç½®upstreamæµä¹‹åï¼Œnginxè‡ªåŠ¨è§¦å‘è´Ÿè½½å‡è¡¡ã€‚</p>
<p>nginxè´Ÿè½½å‡è¡¡ç­–ç•¥ä¸»è¦æœ‰3ç§ï¼š</p>
<ul>
<li>è½®è¯¢ç­–ç•¥ï¼š nginxé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
<li>æƒé‡ç­–ç•¥ï¼šåœ¨é…ç½®upstreamæœåŠ¡æµæ—¶ï¼Œæ‰‹åŠ¨é…ç½®æ¯ä¸ªæœåŠ¡åœ°å€çš„æƒé‡</li>
<li>ip_hashç­–ç•¥ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰ç…§è®¿é—® ip çš„ hash ç»“æœåˆ†é…ï¼Œè¿™æ ·åªè¦ ip è®¿é—®è¿‡å¹¶è¢«åˆ†é…è¿‡æœåŠ¡å™¨ä¹‹åï¼Œä»¥åå†æ¬¡æ–¹ä½ï¼Œåˆ†é…çš„éƒ½å°†æ˜¯åŒä¸€ä¸ªæœåŠ¡å™¨</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">http {</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">	</span><br><span class="line">	# åˆ›å»ºæœåŠ¡æµï¼ˆmyServer:è‡ªå®šä¹‰çš„æœåŠ¡æµåç§°ï¼‰</span><br><span class="line">    # é»˜è®¤è½®è¯¢ç­–ç•¥</span><br><span class="line">	upstream myServer {</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span>;</span><br><span class="line">	}</span><br><span class="line">    </span><br><span class="line">     # æƒé‡ç­–ç•¥</span><br><span class="line">	upstream myServer {</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span> weight=<span class="number">5</span></span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span> weight=<span class="number">10</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span> weight=<span class="number">8</span>;</span><br><span class="line">	}</span><br><span class="line">    </span><br><span class="line">      # ip_hashæ–¹å¼</span><br><span class="line">	upstream myServer {</span><br><span class="line">         ip_hash               # åªè¦æ·»ä¸Šè¿™ä¸€å¥ï¼Œå°±æ˜¯ip_hashåˆ†é…ç­–ç•¥</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span>;</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">    server {</span><br><span class="line">        listen       80;  # ç›‘å¬ç«¯å£</span><br><span class="line">        server_name  47.99.152.217;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line">		# åå‘ä»£ç†è½¬å‘é…ç½®(ä¸€ä¸ªserverä¸­å¯ä»¥é…ç½®å¤šä¸ªlocation)</span><br><span class="line">        location / {</span><br><span class="line">			proxy_pass http:<span class="comment">//myServer;  # è´Ÿè½½å‡è¡¡çš„æœåŠ¡æµåç§°</span></span><br><span class="line">			proxy_connect_timeout 600; # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">			proxy_read_timeout 600; # è¯·æ±‚è¯»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">        }</span><br><span class="line">		</span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        location = /50x.html {</span><br><span class="line">           root   html;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="nginx-confæ–‡ä»¶"><a href="#nginx-confæ–‡ä»¶" class="headerlink" title="nginx.confæ–‡ä»¶"></a>nginx.confæ–‡ä»¶</h4><blockquote>
<p><strong>å‘ç‚¹ï¼š</strong></p>
<ul>
<li>ç†è§£nginxä¸­<code>try_files</code> å±æ€§é…ç½®å«ä¹‰ï¼Œæ­£ç¡®é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</li>
</ul>
<p>å†…ç½®å…¨å±€å˜é‡ï¼š</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">$args ï¼šè¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string</span><br><span class="line">$content_length ï¼š è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚</span><br><span class="line">$content_type ï¼š è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚</span><br><span class="line">$document_root ï¼š å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚</span><br><span class="line">$host ï¼š è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚</span><br><span class="line">$http_user_agent ï¼š å®¢æˆ·ç«¯agentä¿¡æ¯</span><br><span class="line">$http_cookie ï¼š å®¢æˆ·ç«¯cookieä¿¡æ¯</span><br><span class="line">$limit_rate ï¼š è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚</span><br><span class="line">$request_method ï¼š å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚</span><br><span class="line">$remote_addr ï¼š å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚</span><br><span class="line">$remote_port ï¼š å®¢æˆ·ç«¯çš„ç«¯å£ã€‚</span><br><span class="line">$remote_user ï¼š å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚</span><br><span class="line">$request_filename ï¼š å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚</span><br><span class="line">$scheme ï¼š HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚</span><br><span class="line">$server_protocol ï¼š è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/<span class="number">1.0</span>æˆ–HTTP/<span class="number">1.1</span>ã€‚</span><br><span class="line">$server_addr ï¼š æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚</span><br><span class="line">$server_name ï¼š æœåŠ¡å™¨åç§°ã€‚</span><br><span class="line">$server_port ï¼š è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</span><br><span class="line">$request_uri ï¼š åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€/foo/bar.php?arg=bazâ€ã€‚</span><br><span class="line">$uri ï¼š ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚</span><br><span class="line">$document_uri ï¼š ä¸$uriç›¸åŒã€‚</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">#=====================äºšè™å¤§ç™¾è´§æµ‹è¯•é…ç½®=========================</span><br><span class="line"></span><br><span class="line"># é…ç½® keepalive_timeoutç­–ç•¥ï¼šåœ¨å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åä¿æŒè¿™ä¸ª tcp è¿æ¥çš„æ‰“å¼€çŠ¶æ€ã€‚è‹¥æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å…¶å®ƒè¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šåˆ©ç”¨è¿™ä¸ªæœªè¢«å…³é—­çš„è¿æ¥ï¼Œè€Œä¸éœ€è¦å†å»ºç«‹ä¸€ä¸ªè¿æ¥</span><br><span class="line">keepalive_timeout  <span class="number">120</span>;</span><br><span class="line">client_header_timeout <span class="number">120</span>s;</span><br><span class="line">client_body_timeout <span class="number">120</span>s;</span><br><span class="line">client_max_body_size <span class="number">100</span>m;</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦å¼€å¯å‹ç¼©ä¼ è¾“ï¼Œoffè¡¨ç¤ºå…³é—­ï¼Œonè¡¨ç¤ºå¼€å¯</span><br><span class="line">gzip on;</span><br><span class="line"># è®¾ç½®gzipå‹ç¼©ç­‰çº§ï¼Œç­‰çº§è¶Šåº•å‹ç¼©é€Ÿåº¦è¶Šå¿«æ–‡ä»¶å‹ç¼©æ¯”è¶Šå°ï¼Œåä¹‹é€Ÿåº¦è¶Šæ…¢æ–‡ä»¶å‹ç¼©æ¯”è¶Šå¤§</span><br><span class="line">gzip_comp_level <span class="number">9</span>;</span><br><span class="line"># å½“è¿”å›å†…å®¹å¤§äºæ­¤å€¼æ—¶æ‰ä¼šä½¿ç”¨gzipè¿›è¡Œå‹ç¼©,ä»¥Kä¸ºå•ä½,å½“å€¼ä¸º<span class="number">0</span>æ—¶ï¼Œæ‰€æœ‰é¡µé¢éƒ½è¿›è¡Œå‹ç¼©</span><br><span class="line">gzip_min_length <span class="number">100</span>;</span><br><span class="line"># è®¾ç½®éœ€è¦å‹ç¼©çš„MIMEç±»å‹,éè®¾ç½®å€¼ä¸è¿›è¡Œå‹ç¼©</span><br><span class="line">gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line">gzip_vary off;</span><br><span class="line"></span><br><span class="line"># å®šä¹‰updtreamæµ		</span><br><span class="line">upstream dapi-test {</span><br><span class="line">    server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">17979</span>;</span><br><span class="line">}</span><br><span class="line">upstream fapi-test{</span><br><span class="line">    server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">18000</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">server {</span><br><span class="line">    # é…ç½®nginxç›‘å¬ç«¯å£ï¼Œ</span><br><span class="line">    listen  <span class="number">8083</span>; </span><br><span class="line">    # é…ç½®nginxç›‘å¬åœ°å€ï¼Œå½“æµè§ˆå™¨è®¿é—® <span class="number">101.70</span><span class="number">.37</span><span class="number">.56</span>:<span class="number">8083</span> æ—¶ï¼Œä¼šè¢«nginxæ‹¦æˆªæ•è·å¹¶é‡æ–°è½¬å‘</span><br><span class="line">    server_name  <span class="number">101.70</span><span class="number">.37</span><span class="number">.56</span>;  </span><br><span class="line"></span><br><span class="line">    charset UTF<span class="number">-8</span>;</span><br><span class="line"></span><br><span class="line">    # è·¯å¾„é‡å†™ï¼šå°†uriè·¯å¾„é‡å†™ä¸º /dbh</span><br><span class="line">    location / {</span><br><span class="line">        rewrite / /dbh; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    # ^~ /dbh ï¼šåªåŒ¹é…ä»¥ /dbh å¼€å¤´çš„è·¯å¾„</span><br><span class="line">    # $uri: è·å–å½“å‰è·¯å¾„ä¸­çš„uriï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯ /dbh è·¯å¾„</span><br><span class="line">    # $rootï¼š è·å–å­˜æ”¾å½“å‰èµ„æºçš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ /home/yahutest/dbhweb</span><br><span class="line">    # try_files: å½“å‰é…ç½®å«ä¹‰ï¼šé¦–å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•° $uriï¼ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ $root/dbh æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿›è¡Œè½¬å‘ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œç¬¬äºŒä¸ªå‚æ•° $uri/ çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ $root/dbh/ ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†å€¼èµ‹ç»™@routerå˜é‡ï¼Œè¿›è¡Œä¸‹é¢çš„è½¬å‘æ“ä½œï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿›è¡Œè½¬å‘è®¿é—® $root/dbh/index.html èµ„æº</span><br><span class="line">    location ^~ /dbh {</span><br><span class="line">        root   /home/yahutest/dbhweb;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ @router /index.html;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    location @router{</span><br><span class="line">        rewrite ^.*$ /index.html last;</span><br><span class="line">    }</span><br><span class="line">    # åŒ¹é…é™æ€èµ„æºï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™è½¬å‘è®¿é—® $root/abc.jpg èµ„æº</span><br><span class="line">    location ^~ /abc.jpg {</span><br><span class="line">        root /home/yahutest/dbhweb;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    # åŒ¹é…æ–‡ä»¶æœåŠ¡è·¯å¾„</span><br><span class="line">    location /platform/file/ {</span><br><span class="line">        proxy_connect_timeout   <span class="number">300</span>;</span><br><span class="line">        proxy_send_timeout      <span class="number">600</span>;</span><br><span class="line">        proxy_read_timeout      <span class="number">600</span>;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Scheme  $scheme;</span><br><span class="line">        proxy_set_header X-Forwarded-Server $host;</span><br><span class="line">        # é‡å®šå‘åˆ°å·²å®šä¹‰çš„æœåŠ¡å’Œç«¯å£</span><br><span class="line">        proxy_pass http:<span class="comment">//fapi-test/viewOnline/;</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    location /v/api/ {</span><br><span class="line">        proxy_pass http:<span class="comment">//dapi-test/;</span></span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header  Host  $host;</span><br><span class="line">        proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">        proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_ignore_headers Set-Cookie;</span><br><span class="line">        proxy_hide_header Set-Cookie;</span><br><span class="line">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    error_page  <span class="number">404</span>              /<span class="number">404.</span>html;</span><br><span class="line"></span><br><span class="line">    error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line"></span><br><span class="line">    location = /<span class="number">50</span>x.html {</span><br><span class="line">        root   html;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">#==============================================</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="é…ç½®Https"><a href="#é…ç½®Https" class="headerlink" title="é…ç½®Https"></a>é…ç½®Https</h4><blockquote>
<p>å…·ä½“é…ç½®å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/duyusean/article/details/79348613">nginxé…ç½®æ”¯æŒHttpsè®¿é—®</a></p>
</blockquote>
<h2 id="jarå¯åŠ¨è„šæœ¬"><a href="#jarå¯åŠ¨è„šæœ¬" class="headerlink" title="jarå¯åŠ¨è„šæœ¬"></a>jarå¯åŠ¨è„šæœ¬</h2><blockquote>
<p>ç¼–å†™å„ä¸ªjaræœåŠ¡ä¾¿æ·å¯åŠ¨çš„è„šæœ¬</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>åœ¨<code>/usr/lib/systemd/system</code>ç›®å½•ä¸‹åˆ›å»º<code>xxx.service</code>è„šæœ¬æ–‡ä»¶</li>
<li>é…ç½®æ–‡ä»¶ä¿¡æ¯</li>
<li>æ³¨å†Œå¹¶æ‰§è¡Œè„šæœ¬<ul>
<li>æ³¨å†Œï¼š<code>systemctl enable xxx.service</code></li>
<li>æ‰§è¡Œï¼š<code>systemctl [startã€restartã€stop] xxx.service</code></li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p><strong>å‘ç‚¹ï¼š</strong></p>
<ol>
<li>jdkçš„è·¯å¾„å¿…é¡»æŒ‰ç…§é¡¹ç›®jdkå®‰è£…ç›®å½•æ­£ç¡®æŒ‡å®š</li>
</ol>
</blockquote>
<h3 id="è„šæœ¬ç¤ºä¾‹-1"><a href="#è„šæœ¬ç¤ºä¾‹-1" class="headerlink" title="è„šæœ¬ç¤ºä¾‹"></a>è„šæœ¬ç¤ºä¾‹</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line"><span class="comment"># æœåŠ¡çš„ç®€å•æè¿°</span></span><br><span class="line">Description=eureka</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="comment"># æŒ‡å®šå¯åŠ¨å•å…ƒçš„å‘½ä»¤æˆ–è€…è„šæœ¬ï¼Œå¹¶é…ç½®å¯åŠ¨ç«¯å£å·å’Œæ—¥å¿—è·¯å¾„</span></span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/java/jdk1.8.0_144/bin/java -jar -Dfile.encoding=UTF-8 \</span><br><span class="line">/home/yahutest/jars/platform-eureka-test.jar --server.port=18761 \</span><br><span class="line">--logging.file=/home/yahutest/logs/eureka.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå•å…ƒé‡è½½æ—¶æ‰§è¡Œçš„å‘½ä»¤æˆ–è€…è„šæœ¬</span></span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="comment"># è®¾ç½®æœåŠ¡ä¸ºæ‰§è¡Œå‘½ä»¤åç«‹å³å¯åŠ¨</span></span><br><span class="line">Type=simple</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="comment"># å•å…ƒè¢«å…è®¸è¿è¡Œéœ€è¦çš„å¼±ä¾èµ–æ€§å•å…ƒ</span></span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure>
<hr>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨å†Œè„šæœ¬</span></span><br><span class="line">systemctl <span class="built_in">enable</span> eureka.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">systemctl start eureka.service</span><br><span class="line">systemctl restart eureka.service</span><br><span class="line">systemctl stop eureka.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå¦‚æœæ›´æ–°äº†è„šæœ¬æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°åŠ è½½ä»¥ä¸‹è„šæœ¬</span></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¯åŠ¨é¡ºåº"><a href="#å¯åŠ¨é¡ºåº" class="headerlink" title="å¯åŠ¨é¡ºåº"></a>å¯åŠ¨é¡ºåº</h3><blockquote>
<p>ä¸€èˆ¬å¯åŠ¨é¡ºåºï¼šæ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ â€”-&gt; åº”ç”¨æœåŠ¡ â€”-&gt; ç½‘å…³æœåŠ¡</p>
</blockquote>
]]></content>
      <categories>
        <category>æœåŠ¡éƒ¨ç½²</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootå°æ‚è®°</title>
    <url>/post/18976.html</url>
    <content><![CDATA[<h2 id="Spring5"><a href="#Spring5" class="headerlink" title="Spring5"></a>Spring5</h2><h3 id="æ³¨è§£ç®€è®°"><a href="#æ³¨è§£ç®€è®°" class="headerlink" title="æ³¨è§£ç®€è®°"></a>æ³¨è§£ç®€è®°</h3><h4 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h4><ol>
<li><p>@Autowired ï¼š è‡ªåŠ¨è£…é…beanå¯¹è±¡ï¼Œé€šè¿‡byTypeæ–¹å¼åŒ¹é…å¯»æ‰¾ï¼ŒæŠŠä¸€ä¸ªbeanè‡ªåŠ¨æ³¨å…¥åˆ°å¦ä¸€ä¸ªbeanä¸­ï¼ˆspringæ³¨è§£ï¼‰<strong>æ¨è</strong></p>
</li>
<li><p>@Resource ï¼š è‡ªåŠ¨è£…é…beanå¯¹è±¡ï¼Œé€šè¿‡byNameå’ŒbyTypeä¸¤ç§æ–¹å¼ï¼ˆjavaæœ¬èº«æ³¨è§£ï¼‰</p>
</li>
<li><p>@Nullable ï¼š è‹¥å­—æ®µæ ‡è®°äº†æ­¤æ³¨è§£ï¼Œè¯´æ˜è¿™ä¸ªå­—æ®µå¯ä»¥ä¸ºç©ºï¼Œç¼–è¯‘ä¸æŠ¥é”™</p>
</li>
<li><p>@Qualifier ï¼šé€šè¿‡å”¯ä¸€æ ‡è¯†æŸä¸ªå­—æ®µï¼Œå¯¹è±¡ç­‰å…ƒç´ çš„å¯¹åº”ç»‘å®š</p>
</li>
<li><p>@Componentï¼šä¸€èˆ¬æ”¾åœ¨ç±»ä¸Šï¼Œè¯´æ˜è¿™ä¸ªç±»è¢«springå®¹å™¨è¿›è¡Œç®¡ç†ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨xmlæ–‡ä»¶ä¸­æ³¨å†Œäº†bean</p>
</li>
<li><p>@Repositoryï¼šè·Ÿ@ComponentåŠŸèƒ½å«ä¹‰ä¸€æ ·ï¼Œä¸€èˆ¬åœ¨Daoå±‚ä½¿ç”¨</p>
</li>
<li><p>@Serviceï¼šè·Ÿ@ComponentåŠŸèƒ½å«ä¹‰ä¸€æ ·ï¼Œä¸€èˆ¬åœ¨Serviceå±‚ä½¿ç”¨</p>
</li>
<li><p>@Controllerï¼šè·Ÿ@ComponentåŠŸèƒ½å«ä¹‰ä¸€æ ·ï¼Œä¸€èˆ¬åœ¨Controllerå±‚ä½¿ç”¨</p>
</li>
<li><p>@Scopeï¼šè§„å®šbeançš„ä½œç”¨åŸŸï¼Œ@Scope(â€œsingletonâ€)â€”&gt;å•ä¾‹æ¨¡å¼  @Scope(â€œprototypeâ€)â€”&gt;åŸå‹æ¨¡å¼ </p>
</li>
<li><p>```xml<br> åªæœ‰åœ¨applicationContext.xmlæ–‡ä»¶ä¸­è¿›è¡Œä¸‹é¢çš„é…ç½®ï¼Œæ‰€æœ‰çš„æ³¨è§£æ‰èƒ½ç”Ÿæ•ˆ</p>
<pre><code>    &lt;!--å¼€å¯æ³¨è§£æ”¯æŒ--&gt;
&lt;context:annotation-config/&gt;
&lt;!--æŒ‡å®šè¦æ‰«æçš„åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰æ³¨è§£æ‰ä¼šç”Ÿæ•ˆ--&gt;
&lt;context:component-scan base-package="com.mabin"/&gt;
</code></pre><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">11. @Configurationï¼šä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå’ŒapplicationContext.xmlçš„ä½œç”¨ç›¸åŒ</span><br><span class="line"></span><br><span class="line">12. @Beanï¼š æ³¨å†Œä¸€ä¸ªbeanï¼Œç›¸å½“äºä¹‹å‰çš„beanæ ‡ç­¾</span><br><span class="line"></span><br><span class="line">13. @ComponentScanï¼šåŒ…æ‰«ææ³¨è§£ï¼Œä¸ç¬¬10æ¡çš„xmlé…ç½®ä½œç”¨ç›¸åŒ</span><br><span class="line"></span><br><span class="line">14. @Importï¼šå°†å¤šä¸ªé…ç½®ç±»å¼•å…¥åˆ°ä¸€ä¸ªä¸»é…ç½®ç±»ä¸­</span><br><span class="line"></span><br><span class="line">#### AOP</span><br><span class="line"></span><br><span class="line"> 1. @Aspectï¼šä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»,æ³¨è§£åœ¨ç±»ä¸Šé¢</span><br><span class="line"></span><br><span class="line"> 2. @Pointcutï¼šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡å…¥ç‚¹,å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">    ```java</span><br><span class="line">    @Pointcut("execution(* com.example.demo.service.*.*(..))")  //è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡å…¥ç‚¹</span><br><span class="line">    public void pc1(){}</span><br></pre></td></tr></tbody></table></figure>
<p>3.@Before,@After,@Around,â€¦ç­‰ç­‰éƒ½æ˜¯ä¸€äº›åˆ‡é¢å¢å¼ºçš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œç ”ç©¶</p>
</li>
</ol>
<h4 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h4><ul>
<li>@RequestParamï¼š æäº¤çš„åŸŸåç§°å’Œå¤„ç†æ–¹æ³•çš„å‚æ•°åä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£è¿›è¡Œä¼˜åŒ–æ¥æ”¶å‚æ•°</li>
<li>@ResponseBodyï¼šæ³¨è§£åœ¨ç±»æˆ–æ–¹æ³•ä¸Šï¼Œè¿”å›å€¼ä¸ä¼šå†èµ°è§†å›¾è§£æå™¨ï¼Œè€Œä¼šç›´æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²    <strong>æ³¨æ„ï¼šå¦‚æœé¡µé¢ä¼ å…¥çš„æ˜¯jsonç­‰å¤æ‚å¯¹è±¡ç±»å‹ï¼Œcontrollerå±‚ä½¿ç”¨pojoç±»è·å–å€¼ï¼Œå¿…é¡»æ·»åŠ æ³¨è§£@ResponseBodyï¼Œå¦åˆ™pojoç±»ä¸­çš„å„ä¸ªå±æ€§ä¸ä¼šè·å–åˆ°å€¼ï¼Œå‡ä¸ºnull**</strong></li>
<li>@RestControllerï¼šç›¸å½“äº@Controllerå’Œ@ReponseBodyçš„ç»“åˆä½“ï¼ŒåŠŸèƒ½æ•ˆæœå åŠ </li>
<li>@param:daoå±‚å±æ€§å‚æ•°å¿…é¡»æ·»åŠ æ­¤æ³¨è§£ï¼Œsqlè¯­å¥å¯ä»¥å‡†ç¡®çš„è·å–åˆ°ä¼ å…¥çš„å‚æ•°å€¼ï¼Œpojoç±»å®ä½“ç±»å¯¹è±¡ä¸éœ€è¦</li>
<li>@PropertySource(value=â€classpath:xxx.propertiesâ€):å¯¼å…¥è‡ªå®šä¹‰çš„propertiesé…ç½®æ–‡ä»¶</li>
<li>@ImportSResource(locations = â€œclasspath:xxx-config.xmlâ€):åœ¨å¯åŠ¨ç±»ä¸Šé¢å¯¼å…¥è‡ªå®šä¹‰çš„xmlé…ç½®æ–‡ä»¶</li>
<li><strong>ResponseEntity&lt;T&gt;ï¼šæ­¤å¹¶éæ³¨è§£ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å“åº”æ•°æ®æ³›å‹å®ä½“ç±»ï¼Œç›¸å½“äº@Controller+@ResponseBody+@ResponseStatusä¸‰ä¸ªæ³¨è§£åŠ ä¸€èµ·çš„ä½œç”¨</strong></li>
<li><strong>æ³¨æ„ï¼š@Controller+@ResponseBody == @RestController+@ResponseStatus åŠŸèƒ½ç›¸ä¼¼ï¼Œåœºæ™¯çµæ´»ä½¿ç”¨</strong></li>
</ul>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="åŸºæœ¬SQLå‡½æ•°"><a href="#åŸºæœ¬SQLå‡½æ•°" class="headerlink" title="åŸºæœ¬SQLå‡½æ•°"></a>åŸºæœ¬SQLå‡½æ•°</h3><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- å­—ç¬¦å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">-- CONCAT () æ‹¼æ¥å­—ç¬¦</span></span><br><span class="line">	<span class="keyword">SELECT</span> CONCAT(<span class="string">'hello,'</span>,`username`) <span class="keyword">FROM</span> admin;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- LENGTH () è·å–å­—èŠ‚é•¿åº¦ï¼ˆæ•°æ®åº“ä¸­1ä¸ªæ±‰å­—è¡¨ç¤º3ä¸ªå­—èŠ‚é•¿åº¦ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> LENGTH (`username`) <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> `id`<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> LENGTH (<span class="string">'yes,æœ¨å­'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CHAR_LENGTH () è·å–å­—ç¬¦ä¸ªæ•° ï¼ˆæ•°æ®åº“ä¸­æ— è®ºä¸­è‹±æ–‡ï¼Œä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºä¸€ä¸ªé•¿åº¦ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span> (`username`) <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> `id`<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span> (<span class="string">'yes,æœ¨å­'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- SUBSTR () æˆªå–å­—ä¸² (è¿™ä¸ªç‰ˆæœ¬ç«Ÿç„¶æ²¡æœ‰è¿™ä¸ªå‡½æ•°)</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	  æ³¨æ„ï¼šèµ·å§‹ç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line"><span class="comment">	  substr(string,èµ·å§‹ç´¢å¼•,æˆªå–çš„å­—ç¬¦é•¿åº¦)</span></span><br><span class="line"><span class="comment">	  substr(string,èµ·å§‹ç´¢å¼•)  è¿™ä¸ªé»˜è®¤ä»èµ·å§‹ç´¢å¼•åˆ°æœ€å</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">SELECT</span> SUBSTR (<span class="string">'æˆ‘æ˜¯ä½ çˆ¸çˆ¸'</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- substring(string,èµ·å§‹ç´¢å¼•ï¼Œæˆªå–é•¿åº¦) ç´¢å¼•1å¼€å§‹ï¼ŒåŒ…å«å¤´å°¾</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">SUBSTRING</span>(<span class="string">'abcdefg'</span>,<span class="number">1</span>,<span class="number">3</span>) <span class="comment">-- ç»“æœï¼šabc</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">SUBSTRING</span>(<span class="string">'abcdefg'</span>,<span class="number">2</span>) <span class="comment">-- ç»“æœï¼šbcdefg</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- substring_indexï¼ˆâ€œå¾…æˆªå–æœ‰ç”¨éƒ¨åˆ†çš„å­—ç¬¦ä¸²â€ï¼Œâ€œæˆªå–æ•°æ®ä¾æ®çš„å­—ç¬¦â€ï¼Œæˆªå–å­—ç¬¦çš„ä½ç½®Nï¼‰</span></span><br><span class="line">	<span class="comment">-- Nè‹¥ä¸ºæ­£æ•°ï¼šä»£è¡¨ä»å·¦å¾€å³æ•°ï¼Œç¬¬Nä¸ªåˆ†éš”ç¬¦ä¹‹å‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">'1,2,3,4,5,6'</span>,<span class="string">','</span>,<span class="number">3</span>) <span class="keyword">AS</span> `string` <span class="comment">-- ç»“æœï¼š1,2,3</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">-- Nè‹¥ä¸ºè´Ÿæ•°ï¼šä»£è¡¨ä»å³å¾€å·¦æ•°ï¼Œç¬¬Nä¸ªåˆ†éš”ç¬¦ä¹‹åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">'1,2,3,4,5,6'</span>,<span class="string">','</span>,<span class="number">-3</span>) <span class="keyword">AS</span> `string` <span class="comment">-- ç»“æœï¼š4,5,6</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">-- FIND_IN_SET(è¦æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå­—æ®µåï¼šå¿…é¡»æ˜¯ä»¥è‹±æ–‡é€—å·åˆ†å‰²çš„å­—ç¬¦ä¸²)</span></span><br><span class="line">	<span class="comment">-- è¿”å›ç»“æœï¼šè‹¥å­˜åœ¨åˆ™è¿”å›è®°å½•ï¼Œå¦åˆ™è¿”å›null</span></span><br><span class="line">	<span class="comment">-- ç›¸è¾ƒäºlikeï¼šæ¨¡ç³ŠåŒ¹é…ï¼Œfind_in_set:å±äºç²¾ç¡®åŒ¹é…ï¼Œç±»ä¼¼äºinå‡½æ•°çš„æ•ˆæœ</span></span><br><span class="line">	<span class="keyword">SELECT</span> blog_id,blog_title <span class="keyword">FROM</span> tb_blog <span class="keyword">WHERE</span> FIND_IN_SET(<span class="string">'2'</span>,tag_ids) <span class="keyword">AND</span> deleted<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- INSTR ()è·å–å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•</span></span><br><span class="line">	<span class="keyword">SELECT</span> INSTR (<span class="string">'ä¸‰æ‰“ç™½éª¨ç²¾ä½ å¦¹å¦¹çš„ç™½éª¨ç²¾å¦¹å¦¹çš„ç™½éª¨ç²¾'</span>,<span class="string">'ç™½éª¨ç²¾'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- TRIM ()å»å‰åæŒ‡å®šçš„å­—ç¬¦ï¼ˆé»˜è®¤å»ç©ºæ ¼ï¼‰ è¿™ä¸ªå‡½æ•°ç«Ÿç„¶ä¹Ÿä¸å­˜åœ¨</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">TRIM</span> (<span class="string">'   æœ¨  å­  '</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">TRIM</span> (<span class="string">'X'</span> <span class="keyword">FROM</span> <span class="string">'xxxxxæœ¨xxxå­xxxxxxxxxxxx'</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- LPAD()/RPAD() å·¦å¡«å……/å³å¡«å……</span></span><br><span class="line">	<span class="keyword">SELECT</span> LPAD (<span class="string">'æœ¨å­'</span>,<span class="number">10</span>,<span class="string">'a'</span>); <span class="comment">-- ç»“æœï¼šaaaaaaaaæœ¨å­</span></span><br><span class="line">	<span class="keyword">SELECT</span> RPAD (<span class="string">'æœ¨å­'</span>,<span class="number">10</span>,<span class="string">'a'</span>); <span class="comment">-- ç»“æœï¼šæœ¨å­aaaaaaaa</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- UPPER()/LOWER() å˜å¤§å†™/å˜å°å†™</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">UPPER</span> (`username`) <span class="keyword">FROM</span> admin;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">LOWER</span> (`username`) <span class="keyword">FROM</span> admin;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- STRCMP () æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦å¤§å°</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	   è·Ÿjavaç±»ä¼¼ï¼Œæ¯”è¾ƒå­—æ¯çš„ASCLLç ï¼Œå¤§äºè¿”å›1ï¼Œå°äºè¿”å›-1</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">SELECT</span> STRCMP (`username`,<span class="string">'ke'</span>) <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- LEFT()/RIGHT() ä»å­—ä¸²çš„å·¦è¾¹æˆ–è€…å³è¾¹è¿›è¡Œæˆªå–æŒ‡å®šé•¿åº¦çš„å­—ä¸²</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">LEFT</span> (<span class="string">'é¸ æ‘©æ™º'</span>,<span class="number">1</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">RIGHT</span> (<span class="string">'é¸ æ‘©æ™º'</span>,<span class="number">1</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- æ•°å­¦å‡½æ•°</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- ABS() è·å–ç»å¯¹å€¼</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">ABS</span> (<span class="number">-2</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CEIL(å‘ä¸Šå–æ•´ï¼ˆè¿”å› &gt;=è¯¥å‚æ•°çš„æœ€å°æ•´æ•°ï¼‰) </span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">3.09</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- FLOOR (å‘ä¸‹å–æ•´ï¼ˆè¿”å› &lt;=è¯¥å‚æ•°çš„æœ€å¤§æ•´æ•°ï¼‰)</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">FLOOR</span> (<span class="number">3.09</span>) <span class="keyword">AS</span> a;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- ROUND() å››èˆäº”å…¥ï¼ˆå¯ä»¥è§„å®šå–å°æ•°ç‚¹åå‡ ä½ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> ROUND (<span class="number">1.56897</span>);</span><br><span class="line">	<span class="keyword">SELECT</span> ROUND (<span class="number">1.56897</span>,<span class="number">2</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- TRUNCATE() æˆªæ–­ï¼ˆä¹Ÿå°±æ˜¯ä¿ç•™å°æ•°ç‚¹åé¢å‡ ä½ï¼Œå…¶ä½™çš„å…¨éƒ¨æˆªæ‰ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.56897</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.56897</span>,<span class="number">2</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- MOD() å–ä½™ï¼ˆè¢«é™¤æ•°çš„æ­£è´Ÿå†³å®šäº†ä½™æ•°çš„æ­£è´Ÿï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">-10</span>,<span class="number">3</span>);</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="number">-10</span><span class="operator">%</span><span class="number">3</span>;</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- æ—¥æœŸå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">-- NOW() è·å–å½“å‰æ—¶é—´ï¼ˆåŒ…æ‹¬æ—¥æœŸå’Œæ—¶é—´ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> NOW();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CURDATE() è·å–å½“å‰æ—¶é—´ï¼ˆåªæœ‰æ—¥æœŸï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> CURDATE();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CURTIME() è·å–å½“å‰æ—¶é—´ï¼ˆåªæœ‰æ—¶é—´ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> CURTIME();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- DATEDIFF() è·å–è¿ä¸ªæ—¥æœŸä¹‹å·®</span></span><br><span class="line">	<span class="keyword">SELECT</span> DATEDIFF(CURDATE(),<span class="string">'1998-8-16'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- DATE_FORMAT() æ ¼å¼åŒ–æ—¥æœŸï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥æœŸæ•°å­—çš„æˆªå–ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> DATE_FORMAT(CURDATE(),<span class="string">'%Y'</span>);</span><br><span class="line">	<span class="keyword">SELECT</span> DATE_FORMAT(CURDATE(),<span class="string">'%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%iåˆ†%sç§’'</span>);</span><br><span class="line">	<span class="keyword">SELECT</span> DATE_FORMAT(CURDATE(),<span class="string">'%Y%m%d %T'</span>); <span class="comment">-- è¾“å‡ºæ ¼å¼ä¸ºï¼šyyyy-MM-dd HH:mm:ss</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- STR_TO_DATE() æŒ‰æŒ‡å®šæ ¼å¼è§£æå­—ç¬¦ä¸²ä¸ºæ ¼å¼åŒ–æ—¥å¿—ï¼ˆ1998-03-15ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">'3/15 1998'</span>,<span class="string">'%m/%d %Y'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- æ—¥æœŸç›¸åŠ å‡å‡½æ•°</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">        DATE_SUB(<span class="built_in">CURRENT_DATE</span>(),<span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">DAY</span>) <span class="keyword">as</span> a1,</span><br><span class="line">        SUBDATE(<span class="built_in">CURRENT_DATE</span>,<span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">DAY</span>) <span class="keyword">as</span> a2,</span><br><span class="line">        SUBDATE(<span class="built_in">CURRENT_DATE</span>,<span class="number">10</span>) <span class="keyword">as</span> a3,</span><br><span class="line">        DATE_ADD(<span class="built_in">CURRENT_DATE</span>,<span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">DAY</span>) a4,</span><br><span class="line">        ADDDATE(<span class="built_in">CURRENT_DATE</span>,<span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">DAY</span>) a5,</span><br><span class="line">        ADDDATE(<span class="built_in">CURRENT_DATE</span>,<span class="number">10</span>) a6</span><br><span class="line">		<span class="comment">-- ç»“æœï¼š2022-01-31 2022-01-31	2022-01-31	2022-02-20	2022-02-20	2022-02-20</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">-- æµç¨‹æ§åˆ¶å‡½æ•°</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- IFå‡½æ•°ï¼ˆç±»ä¼¼äºJavaä¸­çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> IF(<span class="number">100</span><span class="operator">&gt;</span><span class="number">99</span>,<span class="string">'yes'</span>,<span class="string">'no'</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CASEå‡½æ•°ï¼ˆ1.ç±»ä¼¼äºJavaä¸­çš„switchè¡¨è¾¾å¼ï¼‰</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	  æ¡ˆä¾‹ï¼š</span></span><br><span class="line"><span class="comment">	      æ˜¾ç¤ºï¼šéƒ¨é—¨ç¼–å·ï¼Œæ—§å·¥èµ„ï¼Œæ–°å·¥èµ„</span></span><br><span class="line"><span class="comment">	      </span></span><br><span class="line"><span class="comment">	      éƒ¨é—¨ç¼–å·æ˜¯30ï¼Œå·¥èµ„æ˜¾ç¤ºä¸º2å€</span></span><br><span class="line"><span class="comment">	      éƒ¨é—¨ç¼–å·æ˜¯50ï¼Œå·¥èµ„æ˜¾ç¤ºä¸º3å€</span></span><br><span class="line"><span class="comment">	      éƒ¨é—¨ç¼–å·æ˜¯60ï¼Œå·¥èµ„æ˜¾ç¤ºä¸º4å€</span></span><br><span class="line"><span class="comment">	      å¦åˆ™ä¸å˜</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">SELECT</span> `department_id`,`salary`,</span><br><span class="line">	<span class="keyword">CASE</span> `department_id`</span><br><span class="line">	    <span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> `salary`<span class="operator">*</span><span class="number">2</span></span><br><span class="line">	    <span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> `salary`<span class="operator">*</span><span class="number">3</span></span><br><span class="line">	    <span class="keyword">WHEN</span> <span class="number">60</span> <span class="keyword">THEN</span> `salary`<span class="operator">*</span><span class="number">4</span></span><br><span class="line">            <span class="keyword">ELSE</span> `salary`</span><br><span class="line">	    <span class="keyword">END</span> </span><br><span class="line">	<span class="keyword">AS</span> `newSalary`</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- CASEå‡½æ•°ï¼ˆ2.ç±»ä¼¼äºJavaä¸­çš„å¤šé‡ifè¯­å¥ï¼Œå®ç°åŒºé—´åˆ¤æ–­ï¼‰</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	  æ¡ˆä¾‹ï¼š</span></span><br><span class="line"><span class="comment">	      å¦‚æœå·¥èµ„&gt;20000,æ˜¾ç¤ºçº§åˆ«ä¸ºAï¼›</span></span><br><span class="line"><span class="comment">	      å·¥èµ„&gt;15000,æ˜¾ç¤ºçº§åˆ«ä¸ºBï¼›</span></span><br><span class="line"><span class="comment">	      å·¥èµ„&gt;10000,æ˜¾ç¤ºçº§åˆ«ä¸ºCï¼›</span></span><br><span class="line"><span class="comment">	      å¦åˆ™ï¼Œæ˜¾ç¤ºçº§åˆ«ä¸ºDï¼›</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">SELECT</span> `salary`,</span><br><span class="line">	<span class="keyword">CASE</span></span><br><span class="line">	    <span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">20000</span> <span class="keyword">THEN</span> <span class="string">'A'</span></span><br><span class="line">	    <span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">'B'</span></span><br><span class="line">	    <span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">'C'</span></span><br><span class="line">	    <span class="keyword">ELSE</span> <span class="string">'D'</span></span><br><span class="line">	    <span class="keyword">END</span> </span><br><span class="line">	<span class="keyword">AS</span> `grade`</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŸºæœ¬èšåˆå‡½æ•°"><a href="#åŸºæœ¬èšåˆå‡½æ•°" class="headerlink" title="åŸºæœ¬èšåˆå‡½æ•°"></a>åŸºæœ¬èšåˆå‡½æ•°</h3><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- èšåˆï¼ˆåˆ†ç»„ï¼‰å‡½æ•°ä¸åˆ†ç»„æŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">-- èšåˆå‡½æ•°æ¸…å•</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	  sun(å­—æ®µå)ï¼šæ±‚å’Œ</span></span><br><span class="line"><span class="comment">	  avg(å­—æ®µå):æ±‚å¹³å‡æ•°</span></span><br><span class="line"><span class="comment">	  max(å­—æ®µå):æ±‚æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">	  min(å­—æ®µå):æ±‚æœ€å°å€¼</span></span><br><span class="line"><span class="comment">	  count(å­—æ®µå):è®¡ç®—éç©ºå­—æ®µä¸ªæ•°</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">-- åˆ†ç»„æŸ¥è¯¢æ¡ˆä¾‹å­¦ä¹ </span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- æ¡ˆä¾‹ï¼šæ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨å‘˜å·¥çš„å¹³å‡å·¥èµ„(æˆªå–ä¸¤ä½å°æ•°ç‚¹)</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="built_in">AVG</span>(`salary`),<span class="number">2</span>) <span class="keyword">AS</span> `avgSalary`,`department_id` </span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> `department_id`;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- æ¡ˆä¾‹ï¼šæ˜¾ç¤ºæ¯ä¸ªå·¥ä½œç§ç±»çš„å¹³å‡å·¥èµ„(æˆªå–ä¸¤ä½å°æ•°ç‚¹)</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="built_in">AVG</span>(`salary`),<span class="number">2</span>) <span class="keyword">AS</span> `avgSalary`,`job_id`</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> `job_id`;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°&gt;5;ï¼ˆåˆ†ç»„åç­›é€‰ä½¿ç”¨å…³é”®å­—ï¼ˆHAVINGï¼‰åœ¨ group by åé¢è¿›è¡Œä¹¦å†™ï¼‰</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> å‘˜å·¥ä¸ªæ•°,`department_id`</span><br><span class="line">	<span class="keyword">FROM</span> employees	</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> `department_id`</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">5</span>;</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- å¤–è¿æ¥æŸ¥è¯¢ï¼ˆå·¦è¿æ¥/å³è¿æ¥ï¼‰</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	  select æŸ¥è¯¢åˆ—è¡¨</span></span><br><span class="line"><span class="comment">	  from è¡¨1 åˆ«å</span></span><br><span class="line"><span class="comment">	  left|right [outer] join è¡¨2 åˆ«å</span></span><br><span class="line"><span class="comment">	  on è¿æ¥æ¡ä»¶</span></span><br><span class="line"><span class="comment">	  [where ç­›é€‰æ¡ä»¶]</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">SELECT</span> be.id,be.name,bo.boyName</span><br><span class="line">	<span class="keyword">FROM</span> beauty be </span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo <span class="keyword">ON</span> be.`boyfriend_id`<span class="operator">=</span>bo.`id`</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- LIMIT(index1ï¼Œindex2) é™åˆ¶æŸ¥è¯¢çš„æ¡ç›®æ•°ï¼Œindex1é»˜è®¤ä¸º0</span></span><br><span class="line">	<span class="keyword">SELECT</span> be.id,be.name,bo.boyName</span><br><span class="line">	<span class="keyword">FROM</span> beauty be </span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo <span class="keyword">ON</span> be.`boyfriend_id`<span class="operator">=</span>bo.`id`</span><br><span class="line">	LIMIT <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- è”åˆæŸ¥è¯¢ï¼ˆè¡¨ä¹‹é—´æ²¡æœ‰è”ç³»ï¼Œè€Œä¸”æŸ¥è¯¢ç»“æœï¼šè‡ªåŠ¨å»é‡ï¼‰</span></span><br><span class="line">	<span class="comment">-- UNION() ç›´æ¥åœ¨ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥ä¹‹é—´å†™å…³é”®è¯unionå³å¯ï¼Œä¸€èˆ¬å¾ˆå°‘ç”¨åˆ° </span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ›æ‰£Mysql"><a href="#åŠ›æ‰£Mysql" class="headerlink" title="åŠ›æ‰£Mysql"></a>åŠ›æ‰£Mysql</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">-- limitè¯­å¥çš„å…·ä½“å«ä¹‰</span><br><span class="line">	limit y åˆ†å¥è¡¨ç¤º: è¯»å– y æ¡æ•°æ®</span><br><span class="line">limit x, y åˆ†å¥è¡¨ç¤º: è·³è¿‡ x æ¡æ•°æ®ï¼Œè¯»å– y æ¡æ•°æ®</span><br><span class="line">limit y offset x åˆ†å¥è¡¨ç¤º: è·³è¿‡ x æ¡æ•°æ®ï¼Œè¯»å– y æ¡æ•°æ®</span><br><span class="line"></span><br><span class="line">-- ifnull(expression,param)</span><br><span class="line">	-- IFNULL() å‡½æ•°ç”¨äºåˆ¤æ–­ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¦ä¸º NULLï¼Œå¦‚æœä¸º NULL åˆ™è¿”å›ç¬¬äºŒä¸ªå‚æ•°çš„å€¼(param)ï¼Œå¦‚æœä¸ä¸º NULL åˆ™è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚</span><br><span class="line">	</span><br><span class="line">-- group_concat(å±æ€§å€¼ï¼Œ[order by å±æ€§å€¼]ï¼Œ'åˆ†éš”ç¬¦'):ç”¨äºå°†group byåæ¯ç»„ä¸­ç›¸åŒå±æ€§çš„å€¼è¿æ¥èµ·æ¥</span><br><span class="line"></span><br><span class="line">-- if(boolean,value1,value2):å¦‚æœboolean=true,åˆ™å€¼ä¸ºvalue1ï¼Œå¦åˆ™å€¼ä¸ºvalue2</span><br><span class="line"></span><br><span class="line">-- case...when...then...else...end:ç›¸å½“äºif-elseå‡½æ•°</span><br><span class="line">	-- ç®€å•å‡½æ•°ç”¨æ³•ï¼šCASE [column_name] WHEN [value1] THEN [result1]... ELSE [default] END</span><br><span class="line">	-- æœç´¢å‡½æ•°ç”¨æ³•ï¼šCASE WHEN [expr] THEN [result1]... ELSE [default] END</span><br><span class="line">	-- æ³¨æ„ï¼šcase åªè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œå‰©ä¸‹çš„ case éƒ¨åˆ†ä¼šè¢«å¿½ç•¥</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>åŠ›æ‰£ç»å…¸sql</p>
<p>1.ç»å…¸æ’åé—®é¢˜ï¼ˆmysql 5.7å†™æ³•ï¼‰ï¼Œmysql 8.0ç‰ˆæœ¬ä¸­æœ‰æä¾›dense_rank()ç­‰å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼ˆè‡ªè¡Œç™¾åº¦ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213634.png" alt="image-20201011183626456"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213639.png" alt="ç»å…¸æ’åé—®é¢˜"></p>
<h3 id="MySQLç´¢å¼•ä¼˜åŒ–"><a href="#MySQLç´¢å¼•ä¼˜åŒ–" class="headerlink" title="MySQLç´¢å¼•ä¼˜åŒ–"></a>MySQLç´¢å¼•ä¼˜åŒ–</h3><blockquote>
<p>åŸºæœ¬å£è¯€ï¼š</p>
<p><strong>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±ï¼Œæœ€å·¦å‰ç¼€è¦éµå®ˆï¼›</strong></p>
<p><strong>å¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­ï¼›</strong></p>
<p><strong>ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ï¼ŒèŒƒå›´ä¹‹åå…¨å¤±æ•ˆï¼›</strong></p>
<p><strong>Likeç™¾åˆ†å†™æœ€å³ï¼Œè¦†ç›–ç´¢å¼•ä¸å†™æ˜Ÿï¼›</strong></p>
<p><strong>ä¸ç­‰éç©ºè¿˜æœ‰orï¼Œç´¢å¼•å¤±æ•ˆè¦å°‘ç”¨ï¼›</strong></p>
<p><strong>VARå¼•å·ä¸å¯ä¸¢ï¼ŒSQLé«˜çº§ä¹Ÿä¸éš¾ï¼</strong></p>
</blockquote>
<h3 id="è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹"><a href="#è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹"></a>è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹</h3><blockquote>
<p>åŸºäºhorse_vue_blog.tb_blogè¡¨æ¼”ç¤ºå®ä¾‹</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºæ— å‚å­˜å‚¨è¿‡ç¨‹(procedure)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> selectBlogList()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_blog <span class="keyword">WHERE</span> is_deleted <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹(call åç§°)</span></span><br><span class="line"><span class="keyword">CALL</span> selectBlogList();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºæœ‰å‚å­˜å‚¨è¿‡ç¨‹(å•å‚æ•°)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> selectBlog02(<span class="keyword">IN</span> views <span class="type">BIGINT</span> UNSIGNED, flag <span class="type">CHAR</span>(<span class="number">5</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_blog tb <span class="keyword">WHERE</span> tb.flag <span class="operator">=</span> flag <span class="keyword">AND</span> tb.views <span class="operator">&gt;</span> views <span class="keyword">AND</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> selectBlog02(<span class="number">40</span>, <span class="string">'åŸåˆ›'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºæœ‰è¿”å›å€¼å’Œæœ‰å‚å­˜å‚¨è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> selectBlog03(<span class="keyword">IN</span> views <span class="type">BIGINT</span> UNSIGNED, flag <span class="type">CHAR</span>(<span class="number">5</span>), <span class="keyword">OUT</span> blogCount <span class="type">INTEGER</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> recommend TINYINT UNSIGNED <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>; <span class="comment">-- å£°æ˜ä¸€ä¸ªå˜é‡</span></span><br><span class="line">    <span class="keyword">SET</span> recommend <span class="operator">=</span> <span class="literal">TRUE</span>; <span class="comment">-- å˜é‡èµ‹å€¼(è¿™ä¸¤å¥çš„åŠŸèƒ½ç›¸å½“äºset @recommend=true )</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@share</span> <span class="operator">=</span> <span class="literal">TRUE</span>; <span class="comment">-- set @å˜é‡å=å€¼ (å¯ä»¥è®¾ç½®å˜é‡çš„å€¼)</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">INTO</span> blogCount</span><br><span class="line">    <span class="keyword">FROM</span> tb_blog tb</span><br><span class="line">    <span class="keyword">WHERE</span> tb.flag <span class="operator">=</span> flag</span><br><span class="line">      <span class="keyword">AND</span> tb.views <span class="operator">&gt;</span> views</span><br><span class="line">      <span class="keyword">AND</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">AND</span> tb.is_recommend <span class="operator">=</span> recommend</span><br><span class="line">      <span class="keyword">AND</span> tb.is_share <span class="operator">=</span> <span class="variable">@share</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> blogCount, recommend, <span class="variable">@share</span>; <span class="comment">-- select @å˜é‡å (æŸ¥è¯¢è¾“å‡ºç»“æœå˜é‡åçš„å€¼)</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¾“å‡ºçš„å˜é‡åå¿…é¡»ä»¥ @ ç¬¦åˆå¼€å¤´ (ä½†å¿…é¡»æ˜¯å˜é‡ï¼Œä¸èƒ½æ˜¯å¸¸é‡)</span></span><br><span class="line"><span class="keyword">CALL</span> selectBlog03(<span class="number">35</span>, <span class="string">'åŸåˆ›'</span>, <span class="variable">@count</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŠ¨æ€ä¼ å…¥è¡¨å(å¯ä»¥è¿›è¡Œä¸€äº›å¤æ‚å­˜å‚¨è¿‡ç¨‹çš„ç¼–å†™)</span></span><br><span class="line"><span class="comment">-- ä½¿ç”¨CONCATè¿›è¡Œsqlçš„æ‹¼æ¥ï¼Œæ‹¼æ¥å¤„å¿…é¡»ç•™æœ‰ç©ºæ ¼ï¼Œæ¯”å¦‚ concat('insert into ')ï¼Œä¸ç„¶æ‹¼æ¥æ— æ³•è¯†åˆ«å‚æ•°</span></span><br><span class="line"><span class="comment">-- prepare: é¢„å¤„ç†, execute: æ‰§è¡Œ, deallocate prepare: é‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> selectBlog04(<span class="keyword">IN</span> tableName <span class="type">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@selectTable</span> <span class="operator">=</span> concat(<span class="string">'select * from horse_vue_blog.tb_'</span>, tableName, <span class="string">' tb where tb.is_deleted=1'</span>);</span><br><span class="line">    <span class="keyword">PREPARE</span> tableInfo <span class="keyword">FROM</span> <span class="variable">@selectTable</span>;</span><br><span class="line">    <span class="keyword">EXECUTE</span> tableInfo;</span><br><span class="line">    <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> tableInfo;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> selectBlog04(<span class="string">'blog'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºè¯­å¥</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> selectBlog02;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤å­˜å‚¨è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> selectBlogList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŒºåˆ«: å‡½æ•°ä¸å­˜å‚¨è¿‡ç¨‹æœ€å¤§çš„åŒºåˆ«æ˜¯å‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">-- mysqlçš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">#     <span class="number">1.</span>åˆ›å»ºå‡½æ•°ä½¿ç”¨<span class="keyword">create</span> <span class="keyword">FUNCTION</span> å‡½æ•°å(å‚æ•°) <span class="keyword">RETURNS</span> è¿”å›ç±»å‹ï¼›</span><br><span class="line">#     <span class="number">2.</span>å‡½æ•°ä½“æ”¾åœ¨<span class="keyword">begin</span>å’Œ<span class="keyword">end</span>ä¹‹é—´ï¼›</span><br><span class="line">#     <span class="number">3.</span><span class="keyword">returns</span>æŒ‡å®šå‡½æ•°çš„è¿”å›å€¼ï¼›</span><br><span class="line">#     <span class="number">4.</span>å‡½æ•°è°ƒç”¨ä½¿ç”¨ <span class="keyword">select</span> å‡½æ•°å([å‚æ•°]);</span><br><span class="line"><span class="comment">-- æ ¹æ®idæŸ¥è¯¢å¯¹åº”title</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getBlogTitle(blogId <span class="type">CHAR</span>(<span class="number">30</span>)) <span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> blogTitle <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> tb.title <span class="keyword">INTO</span> blogTitle <span class="keyword">FROM</span> tb_blog tb <span class="keyword">WHERE</span> tb.id <span class="operator">=</span> blogId <span class="keyword">AND</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">RETURN</span> blogTitle;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> getBlogTitle(<span class="string">'1303461445253976089'</span>) <span class="keyword">AS</span> title;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è§¦å‘å™¨è°ƒç”¨å­˜å‚¨è¿‡ç¨‹(æœªå®Œå¾…ç»­...)</span></span><br></pre></td></tr></tbody></table></figure>
<p>å¤æ‚SQL</p>
<blockquote>
<p>å¹³å¸¸ç»ƒä¹ çš„sqlä¸šåŠ¡é€»è¾‘ï¼Œç”Ÿæ´»éšç¬”</p>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- å¤æ‚sqlç»ƒä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æœ€è¿‘7å¤©æ•°æ®</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_category tc</span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">date</span>(tc.gmt_create) <span class="operator">&gt;=</span> date_sub(<span class="built_in">current_date</span>, <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>)</span><br><span class="line">  <span class="keyword">AND</span> is_deleted <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æœ¬å‘¨æ•°æ®</span></span><br><span class="line"><span class="comment">-- yearweek(date,model)å‡½æ•°:è·å–æŒ‡å®šæ—¥æœŸçš„å¹´ä»½å’Œè¯¥æ—¥æœŸæ‰€åœ¨çš„å‘¨æ•°(ç¬¬å‡ å‘¨)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> tb_category tc</span><br><span class="line"><span class="keyword">WHERE</span> yearweek(tc.gmt_create, <span class="number">1</span>) <span class="operator">=</span> yearweek(now(), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤åˆ†ç±»åç§°é‡å¤(name)çš„æ•°æ®,åªä¿ç•™idæœ€å°çš„é‚£æ¡(è¡¨ä¸è¦ç”¨åˆ«å,ä¾‹å¦‚ tb_category tc)</span></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> tb_category</span><br><span class="line"><span class="keyword">WHERE</span> is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">AND</span> name <span class="keyword">IN</span> (<span class="keyword">SELECT</span> nameList</span><br><span class="line">               <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> name <span class="keyword">AS</span> nameList</span><br><span class="line">                     <span class="keyword">FROM</span> tb_category</span><br><span class="line">                     <span class="keyword">WHERE</span> is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                     <span class="keyword">GROUP</span> <span class="keyword">BY</span> name</span><br><span class="line">                     <span class="keyword">HAVING</span> <span class="built_in">count</span>(name) <span class="operator">&gt;</span> <span class="number">1</span>) name_sheet) <span class="comment">-- åç§°é‡å¤çš„é‚£äº›æ•°æ®</span></span><br><span class="line">  <span class="keyword">AND</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> idList</span><br><span class="line">                 <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="built_in">min</span>(id) <span class="keyword">AS</span> idList</span><br><span class="line">                       <span class="keyword">FROM</span> tb_category</span><br><span class="line">                       <span class="keyword">WHERE</span> is_deleted <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                       <span class="keyword">GROUP</span> <span class="keyword">BY</span> name</span><br><span class="line">                       <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(name) <span class="operator">&gt;</span> <span class="number">1</span>) id_sheet); <span class="comment">-- åç§°é‡å¤å¹¶ä¸”idæœ€å°çš„é‚£äº›æ•°æ®</span></span><br><span class="line">                       </span><br><span class="line">                 </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="SpringIOC"><a href="#SpringIOC" class="headerlink" title="SpringIOC"></a>SpringIOC</h2><h4 id="1-ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œï¼ˆé»˜è®¤æ–¹å¼ï¼‰"><a href="#1-ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œï¼ˆé»˜è®¤æ–¹å¼ï¼‰" class="headerlink" title="1.ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œï¼ˆé»˜è®¤æ–¹å¼ï¼‰"></a>1.ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œï¼ˆé»˜è®¤æ–¹å¼ï¼‰</h4><h4 id="2-ä½¿ç”¨æœ‰å‚æ„é€ æ–¹å¼åˆ›å»ºå¯¹è±¡"><a href="#2-ä½¿ç”¨æœ‰å‚æ„é€ æ–¹å¼åˆ›å»ºå¯¹è±¡" class="headerlink" title="2.ä½¿ç”¨æœ‰å‚æ„é€ æ–¹å¼åˆ›å»ºå¯¹è±¡"></a>2.ä½¿ç”¨æœ‰å‚æ„é€ æ–¹å¼åˆ›å»ºå¯¹è±¡</h4><p>â€‹    2.1 å‚æ•°ç´¢å¼•ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"å°å¦®å­..."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>â€‹    2.2 å‚æ•°ç±»å‹ (ä¸å»ºè®®ä½¿ç”¨)</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"æœ¨å­..."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>â€‹    2.3 å‚æ•°åæ„å»ºï¼ˆå»ºè®®ä½¿ç”¨ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"æœ¨å­..."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>â€‹        <strong>æ€»ç»“ï¼šåªè¦åœ¨å®¹å™¨ä¸­æ³¨å†Œäº†beanï¼Œé‚£ä¹ˆåœ¨beané…ç½®æ–‡ä»¶åŠ è½½çš„æ—¶å€™ï¼Œå®¹å™¨ä¸­ç®¡ç†çš„å¯¹è±¡å°±éƒ½å·²ç»è¢«å®ä¾‹åŒ–äº†ï¼ˆå·²ç»newäº†ä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨å®ƒï¼‰</strong></p>
<h3 id="2-springåŸºæœ¬é…ç½®"><a href="#2-springåŸºæœ¬é…ç½®" class="headerlink" title="2.springåŸºæœ¬é…ç½®"></a>2.springåŸºæœ¬é…ç½®</h3><h4 id="2-1-aliasï¼ˆåˆ«åï¼‰"><a href="#2-1-aliasï¼ˆåˆ«åï¼‰" class="headerlink" title="2.1 aliasï¼ˆåˆ«åï¼‰"></a>2.1 aliasï¼ˆåˆ«åï¼‰</h4><p>ä¸æ¨èä½¿ç”¨</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¦‚æœè®¾ç½®äº†åˆ«åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åæ¥ä»å®¹å…¶ä¸­è·å–è¿™ä¸ªå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">alias</span>=<span class="string">"aliasUser"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2-Beançš„åŸºæœ¬é…ç½®"><a href="#2-2-Beançš„åŸºæœ¬é…ç½®" class="headerlink" title="2.2 Beançš„åŸºæœ¬é…ç½®"></a>2.2 Beançš„åŸºæœ¬é…ç½®</h4><p>æ¨èä½¿ç”¨</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--id:beançš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç›¸å½“äºå¯¹è±¡å User user</span></span><br><span class="line"><span class="comment">    class:å¯¹è±¡æ‰€å¯¹åº”çš„å…¨é™å®šåï¼Œç›¸å½“äºnewçš„å¯¹è±¡ new User();</span></span><br><span class="line"><span class="comment">    name:ä¹Ÿæ˜¯è®¾ç½®åˆ«åï¼Œå¯ä»¥åŒæ—¶å–å¯¹å¤šä¸ªåˆ«å</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span> <span class="attr">name</span>=<span class="string">"user2,user3,user4"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"æœ¨å­..."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-Import"><a href="#2-3-Import" class="headerlink" title="2.3 Import"></a>2.3 Import</h4><p>â€‹    ä¸€èˆ¬ç”¨äºå›¢é˜Ÿåˆä½œï¼Œå¯ä»¥å°†å¤šä¸ªxmlæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªã€‚</p>
<h3 id="3-ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰"><a href="#3-ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰" class="headerlink" title="3.ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰"></a>3.ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</h3><p>å°±æ˜¯å‘springå®¹å™¨æ³¨å…¥<strong>å®ä½“ç±»å¯¹è±¡</strong>å’Œ<strong>å®ä½“ç±»ä¸­çš„å„ç§å±æ€§çš„å€¼</strong></p>
<h4 id="3-1æ„é€ å™¨æ³¨å…¥"><a href="#3-1æ„é€ å™¨æ³¨å…¥" class="headerlink" title="3.1æ„é€ å™¨æ³¨å…¥"></a>3.1æ„é€ å™¨æ³¨å…¥</h4><p>â€‹    ä¸Šé¢çš„æœ‰å‚/æ— å‚åˆ›å»ºå¯¹è±¡å°±æ˜¯è¿™ä¸ª</p>
<h4 id="3-2-setæ³¨å…¥"><a href="#3-2-setæ³¨å…¥" class="headerlink" title="3.2 setæ³¨å…¥"></a>3.2 setæ³¨å…¥</h4><ul>
<li><strong>ä¾èµ–</strong>å«ä¹‰ï¼šbeanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨</li>
<li><strong>æ³¨å…¥</strong>å«ä¹‰ï¼šbenaå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œç”±å®¹å™¨æ¥æ³¨å…¥</li>
</ul>
<p>å„ç§ç±»å‹æ³¨å…¥å½¢å¼ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">value</span>=<span class="string">"æ­å·"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ™®é€šæ³¨å…¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"æœ¨å­"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--beanæ³¨å…¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">ref</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Listé›†åˆæ³¨å…¥å’Œseté›†åˆæ³¨å…¥ç›¸ä¼¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hobbys"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>é€ çº¸æœ¯<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>æŒ‡å—é’ˆ<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>å°åˆ·æœ¯<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>ç«è¯<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°ç»„æ³¨å…¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"books"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>æ°´æµ’ä¼ <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>è¥¿æ¸¸è®°<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>ä¸‰å›½æ¼”ä¹‰<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>çº¢æ¥¼æ¢¦<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapé›†åˆæ³¨å…¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"card"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"one"</span> <span class="attr">value</span>=<span class="string">"ä¿¡ç”¨å¡"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"two"</span> <span class="attr">value</span>=<span class="string">"å€Ÿè®°å¡"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"three"</span> <span class="attr">value</span>=<span class="string">"å‚¨è“„å¡"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Propertiesç±»å‹æ³¨å…¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"å­¦å·"</span>&gt;</span>1701110186<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"å¹´é¾„"</span>&gt;</span>23<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨å…¥ç»“æœï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Student{name=<span class="string">'æœ¨å­'</span>, </span><br><span class="line">        address=Address{address=<span class="string">'æ­å·'</span>}, </span><br><span class="line">        books=[æ°´æµ’ä¼ , è¥¿æ¸¸è®°, ä¸‰å›½æ¼”ä¹‰, çº¢æ¥¼æ¢¦], </span><br><span class="line">        hobbys=[é€ çº¸æœ¯, æŒ‡å—é’ˆ, å°åˆ·æœ¯, ç«è¯], </span><br><span class="line">        card={one=ä¿¡ç”¨å¡, two=å€Ÿè®°å¡, three=å‚¨è“„å¡}, </span><br><span class="line">        games=<span class="keyword">null</span>, (setæœªè¿›è¡Œæ³¨å…¥æ¼”ç¤º)</span><br><span class="line">        info={å­¦å·=<span class="number">1701110186</span>, å¹´é¾„=<span class="number">23</span>}}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-3-å…¶ä»–æ–¹å¼æ³¨å…¥ï¼ˆäº†è§£å³å¯ï¼‰"><a href="#3-3-å…¶ä»–æ–¹å¼æ³¨å…¥ï¼ˆäº†è§£å³å¯ï¼‰" class="headerlink" title="3.3 å…¶ä»–æ–¹å¼æ³¨å…¥ï¼ˆäº†è§£å³å¯ï¼‰"></a>3.3 å…¶ä»–æ–¹å¼æ³¨å…¥ï¼ˆäº†è§£å³å¯ï¼‰</h4><p>på‘½åç©ºé—´æ³¨å…¥ï¼ˆç›¸å½“äºsetæ³¨å…¥å¯ä»¥ç›´æ¥æ³¨å…¥å±æ€§ï¼ˆpropertyï¼‰çš„å€¼ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">xmlns:p="http://www.springframework.org/schema/p" //å¿…é¡»å¼•å…¥çº¦æŸ</span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--på‘½åç©ºé—´--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span> <span class="attr">p:username</span>ï¼ˆ<span class="attr">set</span>æ–¹æ³•ä¸­çš„<span class="attr">username</span>ï¼‰=<span class="string">"é©¬æ»¨"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>cå‘½åç©ºé—´æ³¨å…¥ï¼ˆç›¸å½“äºé€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"> xmlns:c="http://www.springframework.org/schema/c"  //å¿…é¡»å¼•å…¥çº¦æŸ</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.User"</span> <span class="attr">c:username</span>ï¼ˆæœ‰å‚æ„é€ å™¨ä¸­çš„å‚æ•°<span class="attr">username</span>ï¼‰=<span class="string">"é©¬æ»¨"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-Beanä½œç”¨åŸŸ"><a href="#4-Beanä½œç”¨åŸŸ" class="headerlink" title="4.Beanä½œç”¨åŸŸ"></a>4.Beanä½œç”¨åŸŸ</h3><p>singleton(å•ä¾‹æ¨¡å¼)ï¼šæ¯æ¬¡ä»å®¹å™¨ä¸­getä¸åŒidï¼Œè€Œå®ä½“ç±»ç›¸åŒçš„å¯¹è±¡æ—¶ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›ï¼ˆspringé»˜è®¤æœºåˆ¶ï¼‰</p>
<p>prototype(åŸå‹æ¨¡å¼)ï¼šæ¯æ¬¡ä»å®¹å™¨ä¸­getä¸åŒidï¼Œè€Œå®ä½“ç±»ç›¸åŒçš„å¯¹è±¡æ—¶ï¼Œéƒ½ä¼šé‡æ–°äº§ç”Ÿä¸€ä¸ªæ–°å¯¹è±¡ï¼›</p>
<p>requestï¼šè¯·æ±‚å®ç°ï¼Œç«‹å³æ¶ˆå¤±ï¼›</p>
<p>sessionï¼šè¯·æ±‚å®ç°ï¼Œä¿æŒç”Ÿå‘½ä¸€æ®µæ—¶é—´ï¼›</p>
<p>applicationï¼šè¯·æ±‚å®ç°ï¼Œä¸€è‡´ä¿æŒç”Ÿå‘½ï¼›</p>
<h3 id="5-Autowiredæ³¨è§£å®ç°è‡ªåŠ¨è£…é…ï¼ˆæ¨èä½¿ç”¨ï¼‰"><a href="#5-Autowiredæ³¨è§£å®ç°è‡ªåŠ¨è£…é…ï¼ˆæ¨èä½¿ç”¨ï¼‰" class="headerlink" title="5.@Autowiredæ³¨è§£å®ç°è‡ªåŠ¨è£…é…ï¼ˆæ¨èä½¿ç”¨ï¼‰"></a>5.@Autowiredæ³¨è§£å®ç°è‡ªåŠ¨è£…é…ï¼ˆæ¨èä½¿ç”¨ï¼‰</h3><p>springä»2.5å¼€å§‹æ”¯æŒæ³¨è§£</p>
<p>ä½¿ç”¨æ³¨è§£é¡»çŸ¥ï¼š</p>
<p>1.å¯¼å…¥çº¦æŸ(<strong>context</strong>)</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">xmlns:context="http://www.springframework.org/schema/context"</span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">http://www.springframework.org/schema/context/spring-context.xsd</span><br></pre></td></tr></tbody></table></figure>
<p>2.é…ç½®ï¼šå¼€å¯æ³¨è§£æ”¯æŒ</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯æ³¨è§£æ”¯æŒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>3.åŸºæœ¬ä½¿ç”¨</p>
<p>æ„å»ºAddressï¼ŒStudentå®ä½“ç±»</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯æ³¨è§£æ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address333"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Address"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address111"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Address"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">value</span>=<span class="string">"æ­å·"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"address222"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Address"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">value</span>=<span class="string">"æ¹–å·"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.mabin.pojo.Student"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = "address111")</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç»“æœï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Student(address=Address(address=æ­å·))</span><br></pre></td></tr></tbody></table></figure>
<p><strong>æ€»ç»“ï¼šå¦‚æœ@Autowiredè‡ªåŠ¨è£…é…çš„ç¯å¢ƒæ¯”è¾ƒå¤æ‚æ—¶ï¼Œè‡ªåŠ¨è£…é…æ–¹å¼æ— æ³•è¯†åˆ«åˆ° è‡ªå·±æƒ³è¦çš„beanå¯¹è±¡ï¼Œæ— æ³•åªä½¿ç”¨ä¸€ä¸ªæ³¨è§£å®Œæˆè‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆä½¿ç”¨@Qualifier(value = â€œxxxâ€) å»æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„beanè¿›è¡Œæ³¨å…¥</strong></p>
<h4 id="5-1-ç²¾åæ€»ç»“"><a href="#5-1-ç²¾åæ€»ç»“" class="headerlink" title="5.1 ç²¾åæ€»ç»“"></a>5.1 ç²¾åæ€»ç»“</h4><h5 id="5-1-2-ä¸¤ç§è‡ªåŠ¨è£…é…çš„åŸç†æ–¹å¼"><a href="#5-1-2-ä¸¤ç§è‡ªåŠ¨è£…é…çš„åŸç†æ–¹å¼" class="headerlink" title="5.1.2 ä¸¤ç§è‡ªåŠ¨è£…é…çš„åŸç†æ–¹å¼"></a>5.1.2 ä¸¤ç§è‡ªåŠ¨è£…é…çš„åŸç†æ–¹å¼</h5><p><strong>byName</strong>ï¼ˆæ ¹æ®å”¯ä¸€æ ‡è¯†idï¼Œè¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œidåå¿…é¡»å’Œå¯¹è±¡åç°åŒï¼Œå¦åˆ™æ— æ³•è‡ªåŠ¨è£…é…ï¼‰</p>
<p><strong>byType</strong>ï¼ˆæ ¹æ®xmlæ–‡ä»¶ä¸­æ‰€æœ‰çš„beanå¯¹è±¡åªæœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„åè¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè‹¥æœ‰å¤šä¸ªï¼Œåˆ™è¿™ç§æ–¹å¼ä¼šå¤±æ•ˆï¼‰</p>
<p><strong>@Autowired</strong>:ä½¿ç”¨byTypeæ–¹å¼è‡ªåŠ¨è£…é…ï¼ˆspringä¸­çš„æ³¨è§£ï¼‰<strong>å¸¸ç”¨</strong></p>
<p><strong>@Resource</strong>ï¼šä¹Ÿæ˜¯è‡ªåŠ¨è£…é…çš„æ³¨è§£ï¼Œé€šè¿‡byNameå’ŒbyTypeä¸¤ç§æ–¹å¼è‡ªåŠ¨è£…é…ï¼ˆjavaæœ¬èº«çš„æ³¨è§£ï¼‰</p>
<h3 id="ä½¿ç”¨javaConfigçš„é…ç½®ç±»å®ç°springè‡ªåŠ¨è£…é…"><a href="#ä½¿ç”¨javaConfigçš„é…ç½®ç±»å®ç°springè‡ªåŠ¨è£…é…" class="headerlink" title="ä½¿ç”¨javaConfigçš„é…ç½®ç±»å®ç°springè‡ªåŠ¨è£…é…"></a>ä½¿ç”¨javaConfigçš„é…ç½®ç±»å®ç°springè‡ªåŠ¨è£…é…</h3><p>springbootä¸­è¿™ç§é…ç½®ç±»éšå¤„å¯è§</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå’ŒapplicationContext.xmlçš„ä½œç”¨ç›¸åŒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStudentConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>  <span class="comment">//æ³¨å†Œä¸€ä¸ªbeanï¼Œç›¸å½“äºä¹‹å‰çš„beanæ ‡ç­¾ï¼Œ</span></span><br><span class="line">			 æ–¹æ³•å:ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„idå±æ€§ï¼Œ</span><br><span class="line">       		 æ–¹æ³•çš„è¿”å›å€¼:ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„<span class="class"><span class="keyword">class</span>å±æ€§</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Address</span> <span class="title">getAddress</span>() </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Address();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">(<span class="meta">@Qualifier("getAddress")</span> Address address)</span> </span>{</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setAddress(address);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="SpringAOP"><a href="#SpringAOP" class="headerlink" title="SpringAOP"></a>SpringAOP</h2><p><strong>ç›®æ ‡åŸç†ï¼šåœ¨ä¸å½±å“ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸šåŠ¡é€»è¾‘å®ç°åŠ¨æ€å¢å¼º</strong></p>
<h3 id="6-é™æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰"><a href="#6-é™æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰" class="headerlink" title="6.é™æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰"></a>6.é™æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰</h3><h5 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h5><p>1.æŠ½è±¡è§’è‰²ï¼ˆä¸€èˆ¬ç”¨æ¥å£å®ç°ï¼ŒçœŸæ˜¯è§’è‰²çš„æ“ä½œï¼ˆæˆ¿ä¸œå‡ºç§Ÿæˆ¿å±‹ï¼‰ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rent</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>2.çœŸæ˜¯è§’è‰²ï¼ˆæˆ¿ä¸œï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æˆ¿ä¸œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Host</span> <span class="keyword">implements</span> <span class="title">Rent</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"æˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>3.ä»£ç†è§’è‰²ï¼ˆä¸­ä»‹ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æˆ¿å±‹ä¸­ä»‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Rent</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿›è¡Œæˆ¿ä¸œè§’è‰²çš„ä»£ç†æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Host host)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>{</span><br><span class="line">        test1();</span><br><span class="line">        host.rent();</span><br><span class="line">        test2();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿å­"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"é¦–ä¸­ä»‹è´¹"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>4.å®¢æˆ·ç«¯è®¿é—®ä»£ç†è§’è‰²ï¼ˆæˆ‘è¦ç§Ÿæˆ¿ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Host host = <span class="keyword">new</span> Host();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æˆ¿å±‹ä¸­ä»‹ä»£ç†æˆ¿ä¸œ</span></span><br><span class="line">        Proxy proxy = <span class="keyword">new</span> Proxy(host);</span><br><span class="line">        <span class="comment">//ä¸ä¸­ä»‹å•†è®®ç§Ÿæˆ¿äº‹å®œ</span></span><br><span class="line">        proxy.rent();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä»£ç†æ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥ä½¿çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹ï¼Œä¸ç”¨å»å…³æ³¨ä¸€äº›å…¬å…±ä¸šåŠ¡</li>
<li>å…¬å…±éƒ¨åˆ†ä¸šåŠ¡äº¤ç»™ä»£ç†è§’è‰²ï¼Œå®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥</li>
<li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†</li>
</ul>
<h3 id="7-åŠ¨æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰"><a href="#7-åŠ¨æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰" class="headerlink" title="7.åŠ¨æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰"></a>7.åŠ¨æ€ä»£ç†ï¼ˆaopåŸç†ï¼‰</h3><p>åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆè°ƒç”¨å¤„ç†ç¨‹åºå®ç°ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¿™ä¸ªä»£ç å¯ä»¥ä½œä¸ºå·¥å…·ç±»ä½¿ç”¨</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyInvocationHandlere</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*è¢«ä»£ç†çš„æ¥å£*/</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTarget</span><span class="params">(Object target)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*åŠ¨æ€ç”Ÿæˆä»£ç†ç±»*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(),target.getClass().getInterfaces(),<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*å¤„ç†ä»£ç†å®ä¾‹*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        Proxy result = (Proxy) method.invoke(target, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å®¢æˆ·ç«¯ä½¿ç”¨</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//çœŸå®è§’è‰²</span></span><br><span class="line">        Host host = <span class="keyword">new</span> Host();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æˆ¿å±‹ä¸­ä»‹ä»£ç†æˆ¿ä¸œ(ä»£ç†è§’è‰²,ç°åœ¨æ²¡æœ‰ï¼Œé€šè¿‡è°ƒç”¨å¤„ç†ç¨‹åºåŠ¨æ€è·å–)</span></span><br><span class="line">        ProxyInvocationHandlereTest proxyInvocationHandlereTest = <span class="keyword">new</span> ProxyInvocationHandlereTest();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡å¤„ç†ç¨‹åºæ¥å¤„ç†æˆ‘ä»¬çš„çœŸå®å¯¹è±¡ï¼ˆè¢«ä»£ç†å¯¹è±¡ï¼‰</span></span><br><span class="line">        proxyInvocationHandlereTest.setRent(host);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä»£ç†è§’è‰²å¯¹è±¡ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰</span></span><br><span class="line">        Rent proxy = (Rent) proxyInvocationHandlereTest.getProxy();</span><br><span class="line">        <span class="comment">//ä»£ç†å¯¹è±¡å®ç°ä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">        proxy.rent();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="8-aopå…·ä½“é…ç½®ï¼ˆå¼•å…¥aopçº¦æŸï¼‰"><a href="#8-aopå…·ä½“é…ç½®ï¼ˆå¼•å…¥aopçº¦æŸï¼‰" class="headerlink" title="8.aopå…·ä½“é…ç½®ï¼ˆå¼•å…¥aopçº¦æŸï¼‰"></a>8.aopå…·ä½“é…ç½®ï¼ˆå¼•å…¥aopçº¦æŸï¼‰</h3><h4 id="8-1-ä½¿ç”¨åŸç”Ÿspring-APIæ¥å£"><a href="#8-1-ä½¿ç”¨åŸç”Ÿspring-APIæ¥å£" class="headerlink" title="8.1 ä½¿ç”¨åŸç”Ÿspring-APIæ¥å£"></a>8.1 ä½¿ç”¨åŸç”Ÿspring-APIæ¥å£</h4><p>å‰æï¼šç¼–å†™ä¸¤ä¸ªç»§æ‰¿spring-APIåŸç”Ÿæ¥å£çš„å®ç°ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeLog</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span></span>{}</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterLog</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span></span>{}    </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring - aopé…ç½®(æ–¹å¼ä¸€ï¼šä½¿ç”¨åŸç”ŸSpring-APIæ¥å£)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šexecution()--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.horse.service.impl.UserServiceImpl.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ‰§è¡Œç¯ç»•ä¸šåŠ¡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"beforeLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"afterLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="8-2-è‡ªå®šåˆ‡é¢ç±»æ–¹å¼"><a href="#8-2-è‡ªå®šåˆ‡é¢ç±»æ–¹å¼" class="headerlink" title="8.2 è‡ªå®šåˆ‡é¢ç±»æ–¹å¼"></a>8.2 è‡ªå®šåˆ‡é¢ç±»æ–¹å¼</h4><p>å‰æï¼šç¼–å†™ä¸€ä¸ªåˆ‡é¢ç±»diyAspect</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"diyAspect"</span> <span class="attr">class</span>=<span class="string">"com.horse.diy.diyAspect"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è‡ªå®šä¹‰åˆ‡é¢ï¼Œref="å¼•å…¥è‡ªå®šä¹‰çš„åˆ‡é¢ç±»"--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"diyAspect"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.horse.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="8-3æ³¨è§£å®ç°aop"><a href="#8-3æ³¨è§£å®ç°aop" class="headerlink" title="8.3æ³¨è§£å®ç°aop"></a>8.3æ³¨è§£å®ç°aop</h4><p>å‰æï¼šç¼–å†™ä¸€ä¸ªæ³¨è§£å®ç°çš„åˆ‡é¢ç±»å¹¶è¿›è¡Œbeanæ³¨å†Œï¼Œå¼€å¯aopæ³¨è§£æ”¯æŒï¼ˆé‡ç‚¹ç†è§£æ³¨è§£å«ä¹‰ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span>  <span class="comment">//ä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectAnnotation</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut("execution(* com.example.demo.service.*.*(..))")</span>  <span class="comment">//è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡å…¥ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pc1</span><span class="params">()</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šçŸ¥çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå…·ä½“ä½¿ç”¨å†ç ”ç©¶</span></span><br><span class="line">    <span class="meta">@Before(value = "pc1()")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"=====æ–¹æ³•æ‰§è¡Œå‰===="</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@After(value = "pc1()")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"=====æ–¹æ³•æ‰§è¡Œå===="</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯aopæ“ä½œçš„æ³¨è§£æ”¯æŒ--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‹“å±•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span> æ³¨è§£ï¼šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚</span><br><span class="line">execution ä¸­çš„ç¬¬ä¸€ä¸ª * è¡¨ç¤ºæ–¹æ³•è¿”å›ä»»æ„å€¼</span><br><span class="line">ç¬¬äºŒä¸ª * è¡¨ç¤º service åŒ…ä¸‹çš„ä»»æ„ç±»</span><br><span class="line">ç¬¬ä¸‰ä¸ª * è¡¨ç¤ºç±»ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œæ‹¬å·ä¸­çš„ä¸¤ä¸ªç‚¹è¡¨ç¤ºæ–¹æ³•å‚æ•°ä»»æ„ï¼Œå³è¿™é‡Œæè¿°çš„åˆ‡å…¥ç‚¹ä¸º service åŒ…ä¸‹æ‰€æœ‰ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚</span><br></pre></td></tr></tbody></table></figure>
<h4 id="8-4-Horse-Blogå®ä¾‹æ¼”ç¤ºæ³¨è§£å¼AOP-æœ€ç®€å•çš„æ¼”ç¤º"><a href="#8-4-Horse-Blogå®ä¾‹æ¼”ç¤ºæ³¨è§£å¼AOP-æœ€ç®€å•çš„æ¼”ç¤º" class="headerlink" title="8.4 Horse Blogå®ä¾‹æ¼”ç¤ºæ³¨è§£å¼AOP(æœ€ç®€å•çš„æ¼”ç¤º)"></a>8.4 Horse Blogå®ä¾‹æ¼”ç¤ºæ³¨è§£å¼AOP(æœ€ç®€å•çš„æ¼”ç¤º)</h4><p>å¼•å…¥åœºæ™¯å¯åŠ¨å™¨</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-aop--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£</p>
<blockquote>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¯¹serviceå±‚è¿›è¡Œå…¨éƒ¨æ–¹æ³•çš„åˆ‡å…¥ï¼Œä½†æ˜¯ä¸å¤Ÿæ³¨è§£åˆ‡å…¥çµæ´»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target(METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogSection {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”¨æˆ·æ“ä½œ</span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–å†™å…·ä½“åˆ‡å…¥ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 9:08</span></span><br><span class="line"><span class="comment"> * aopåˆ‡é¢ç±»:è·å–ç³»ç»Ÿåå°ç®¡ç†æ“ä½œçš„æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemOperationLog</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogService logService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOCALHOST = <span class="string">"0:0:0:0:0:0:0:1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ï¼šåœ¨æœ‰è‡ªå®šä¹‰æ³¨è§£çš„controllerå±‚æ¥å£å¤„åˆ‡å…¥aopä»£ç æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut("@annotation(com.horse.blog.annotation.LogSection)")</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">logPointcut</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åç½®é€šçŸ¥ï¼šä¿å­˜æ“ä½œæ—¥å¿—,å…·ä½“ä»€ä¹ˆç±»å‹çš„é€šçŸ¥ï¼Œå…·ä½“å†ç¡®å®š</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After("logPointcut()")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logSave</span><span class="params">(JoinPoint joinPoint)</span> </span>{</span><br><span class="line"></span><br><span class="line">        SystemLog log = <span class="keyword">new</span> SystemLog();</span><br><span class="line">        <span class="comment">//è·å–æ“ä½œæ–¹æ³•</span></span><br><span class="line">        MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line">        log.setMethod(method.getName());</span><br><span class="line">        <span class="comment">//è·å–ç”¨æˆ·æ“ä½œ</span></span><br><span class="line">        LogSection operation = method.getAnnotation(LogSection.class);</span><br><span class="line">        <span class="keyword">if</span> (operation != <span class="keyword">null</span>) {</span><br><span class="line">            String value = operation.value();</span><br><span class="line">            log.setOperation(value);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è·å–ip</span></span><br><span class="line">        ServletRequestAttributes sra = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = sra.getRequest();</span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line">        System.out.println(ip);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(LOCALHOST, ip)) {</span><br><span class="line">            ip = <span class="string">"127.0.0.1"</span>;</span><br><span class="line">        }</span><br><span class="line">        log.setAccessIp(ip);</span><br><span class="line">        <span class="comment">//è·å–ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">        User currentUser = (User) request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span> (currentUser != <span class="keyword">null</span>) {</span><br><span class="line">            log.setNickname(currentUser.getNickname());</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line">        logService.save(log);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>å…·ä½“ä¿å­˜åˆ°æ•°æ®åº“çš„æ“ä½œï¼Œæ‰§è¡Œæ“ä½œï¼Œæ­¤å¤„çœç•¥â€¦</p>
<h3 id="9-Springä¸­å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#9-Springä¸­å£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="9.Springä¸­å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>9.Springä¸­å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3><p>why?</p>
<p>å¦‚æœæ²¡æœ‰è®¾ç½®äº‹åŠ¡ï¼Œå¯èƒ½ä¼šå‡ºç°äº‹åŠ¡æäº¤ä¸ä¸€è‡´çš„æƒ…å†µï¼ˆå­˜é’±/å–é’±ï¼‰</p>
<p>åŸç†ï¼šåˆ©ç”¨aopæŠŠé…ç½®çš„äº‹åŠ¡ç»‡å…¥åˆ°ä¸šåŠ¡å±‚ï¼ˆserviceï¼‰çš„æ–¹æ³•ä¸Š</p>
<p>åœ¨xmlæ–‡ä»¶ä¸­å¤§éƒ¨åˆ†æ˜¯å›ºå®šçš„é…ç½®ã€‚</p>
<p>å‰æï¼šå¯¼å…¥çº¦æŸ</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">xmlns:tx="http://www.springframework.org/schema/tx"</span><br><span class="line">http://www.springframework.org/schema/tx</span><br><span class="line">http://www.springframework.org/schema/tx/spring-tx.xs</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="comment">&lt;!--é…ç½®springæ¡†æ¶å£°æ˜å¼äº‹åŠ¡ç®¡ç†--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--1.é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span>  //dataSourceï¼šæ˜¯å·²ç»é…ç½®çš„æ•°æ®æº</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.äº‹åŠ¡é€šçŸ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ç»™é‚£äº›æ–¹æ³•é…ç½®äº‹åŠ¡--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3.é…ç½®AOPå®ç°äº‹åŠ¡çš„ç»‡å…¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å»ºç«‹é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¹‹é—´çš„è”ç³»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.maven.ssm.services.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h2><h3 id="1-web-xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®å’Œç›¸åº”çš„ä½œç”¨"><a href="#1-web-xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®å’Œç›¸åº”çš„ä½œç”¨" class="headerlink" title="1.web.xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®å’Œç›¸åº”çš„ä½œç”¨"></a>1.web.xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®å’Œç›¸åº”çš„ä½œç”¨</h3><p><strong>DispatcherServlet</strong>:å‰ç«¯æ§åˆ¶å™¨ï¼ˆweb.xmlï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		é…ç½®DispatcherServlet:(ç”¨äºæ¥æ”¶è¯·æ±‚å¹¶è¿›è¡Œæ‹¦æˆªè¯·æ±‚ï¼Œè°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå¤„ç†å™¨é€‚é…å™¨è¿›è¡Œè§£ææ“ä½œï¼Œå¹¶å¯»æ‰¾ç›¸åº”çš„controller,æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè·å–ModelAndViewï¼Œä¹‹åå†æ¬¡è°ƒç”¨è§†å›¾è§£æå™¨(springmvc.xmlä¸­é…ç½®çš„)è¿›è¡ŒModelAndViewçš„è§£æï¼Œä¹‹åè§†å›¾è§£æå™¨å°†è§£æåçš„é€»è¾‘è§†å›¾åä¼ å›å‰ç«¯æ§åˆ¶å™¨ï¼Œå‰ç«¯æ§åˆ¶å™¨æ ¹æ®å…·ä½“çš„è§†å›¾åè°ƒç”¨ç›¸åº”çš„jspé¡µé¢ï¼Œè¿›è¡Œæ•°æ®çš„æ˜¾ç¤ºã€‚)</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åˆå§‹åŒ–å‚æ•°ï¼šé…ç½®åŠ è½½spring-mvc.xmlæ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®ï¼šå¯åŠ¨tomcatæœåŠ¡å™¨ï¼Œå°±ç«‹å³åˆ›å»ºè¯¥servletï¼ˆå›ºå®šé…ç½®ï¼‰--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>ViewResolver</strong>ï¼šè§†å›¾è§£æå™¨(spring-mvc.xml)</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®è§†å›¾è§£æå™¨å¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"internalResourceView"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JSPæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•(æ ¹æ®ç›®å½•è¿›è¡Œå…·ä½“é…ç½®) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ–‡ä»¶åç¼€å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-spring-mvcçš„æ‰§è¡ŒåŸç†å›¾ï¼ˆåªæœ‰è™šçº¿éƒ¨åˆ†éœ€è¦æˆ‘ä»¬å»åšï¼‰"><a href="#2-spring-mvcçš„æ‰§è¡ŒåŸç†å›¾ï¼ˆåªæœ‰è™šçº¿éƒ¨åˆ†éœ€è¦æˆ‘ä»¬å»åšï¼‰" class="headerlink" title="2.spring-mvcçš„æ‰§è¡ŒåŸç†å›¾ï¼ˆåªæœ‰è™šçº¿éƒ¨åˆ†éœ€è¦æˆ‘ä»¬å»åšï¼‰"></a>2.spring-mvcçš„æ‰§è¡ŒåŸç†å›¾ï¼ˆåªæœ‰è™šçº¿éƒ¨åˆ†éœ€è¦æˆ‘ä»¬å»åšï¼‰<img src="../AppData/Roaming/Typora/typora-user-images/image-20200305131753815.png" alt="image-20200305131753815"></h3><h4 id="2-1æ–‡å­—åŸç†è§£æ"><a href="#2-1æ–‡å­—åŸç†è§£æ" class="headerlink" title="2.1æ–‡å­—åŸç†è§£æ"></a>2.1æ–‡å­—åŸç†è§£æ</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1.</span> DispatcherServletè¡¨ç¤ºå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªSpringMVCçš„æ§åˆ¶ä¸­å¿ƒã€‚ç”¨æˆ·å‘å‡ºè¯·æ±‚ï¼ŒDispatcherServletæ¥æ”¶è¯·æ±‚å¹¶æ‹¦æˆªè¯·æ±‚ã€‚</span><br><span class="line">   - æˆ‘ä»¬å‡è®¾è¯·æ±‚çš„urlä¸º : [http:<span class="comment">//localhost](http://localhost/):8080/SpringMVC/hello</span></span><br><span class="line">   - **å¦‚ä¸Šurlæ‹†åˆ†æˆä¸‰éƒ¨åˆ†ï¼š**</span><br><span class="line">   - [http:<span class="comment">//localhost](http://localhost/):8080æœåŠ¡å™¨åŸŸå</span></span><br><span class="line">   - SpringMVCéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„webç«™ç‚¹</span><br><span class="line">   - helloè¡¨ç¤ºæ§åˆ¶å™¨</span><br><span class="line">   - é€šè¿‡åˆ†æï¼Œå¦‚ä¸Šurlè¡¨ç¤ºä¸ºï¼šè¯·æ±‚ä½äºæœåŠ¡å™¨localhost:<span class="number">8080</span>ä¸Šçš„SpringMVCç«™ç‚¹çš„helloæ§åˆ¶å™¨ã€‚</span><br><span class="line"><span class="number">2.</span> HandlerMappingä¸ºå¤„ç†å™¨æ˜ å°„ã€‚DispatcherServletè°ƒç”¨HandlerMapping,HandlerMappingæ ¹æ®è¯·æ±‚urlæŸ¥æ‰¾Handlerã€‚</span><br><span class="line"><span class="number">3.</span> HandlerExecutionè¡¨ç¤ºå…·ä½“çš„Handler,å…¶ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®urlæŸ¥æ‰¾æ§åˆ¶å™¨ï¼Œå¦‚ä¸Šurlè¢«æŸ¥æ‰¾æ§åˆ¶å™¨ä¸ºï¼šhelloã€‚</span><br><span class="line"><span class="number">4.</span> HandlerExecutionå°†è§£æåçš„ä¿¡æ¯ä¼ é€’ç»™DispatcherServlet,å¦‚è§£ææ§åˆ¶å™¨æ˜ å°„ç­‰ã€‚</span><br><span class="line"><span class="number">5.</span> HandlerAdapterè¡¨ç¤ºå¤„ç†å™¨é€‚é…å™¨ï¼Œå…¶æŒ‰ç…§ç‰¹å®šçš„è§„åˆ™å»æ‰§è¡ŒHandlerã€‚</span><br><span class="line"><span class="number">6.</span> Handlerè®©å…·ä½“çš„Controlleræ‰§è¡Œã€‚</span><br><span class="line"><span class="number">7.</span> Controllerå°†å…·ä½“çš„æ‰§è¡Œä¿¡æ¯è¿”å›ç»™HandlerAdapter,å¦‚ModelAndViewã€‚</span><br><span class="line"><span class="number">8.</span> HandlerAdapterå°†è§†å›¾é€»è¾‘åæˆ–æ¨¡å‹ä¼ é€’ç»™DispatcherServletã€‚</span><br><span class="line"><span class="number">9.</span> DispatcherServletè°ƒç”¨è§†å›¾è§£æå™¨(ViewResolver)æ¥è§£æHandlerAdapterä¼ é€’çš„é€»è¾‘è§†å›¾åã€‚</span><br><span class="line"><span class="number">10.</span> è§†å›¾è§£æå™¨å°†è§£æçš„é€»è¾‘è§†å›¾åä¼ ç»™DispatcherServletã€‚</span><br><span class="line"><span class="number">11.</span> DispatcherServletæ ¹æ®è§†å›¾è§£æå™¨è§£æçš„è§†å›¾ç»“æœï¼Œè°ƒç”¨å…·ä½“çš„è§†å›¾ã€‚</span><br><span class="line"><span class="number">12.</span> æœ€ç»ˆè§†å›¾å‘ˆç°ç»™ç”¨æˆ·ã€‚</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2-spring-mvc-xmlæ–‡ä»¶çš„Finalé…ç½®"><a href="#2-2-spring-mvc-xmlæ–‡ä»¶çš„Finalé…ç½®" class="headerlink" title="2.2 spring-mvc.xmlæ–‡ä»¶çš„Finalé…ç½®"></a>2.2 spring-mvc.xmlæ–‡ä»¶çš„Finalé…ç½®</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!--åªæœ‰è¿™é‡Œçš„åŒ…è·¯å¾„éœ€è¦æ›´æ”¹ï¼Œå…¶ä»–éƒ½æ˜¯å›ºå®šçš„é…ç½®--&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.maven.ssm.controller"</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--è®©spring-mvcä¸å†å»å¤„ç†.css,.js,.html,.mp3,.mp4ç­‰é™æ€èµ„æºæ–‡ä»¶--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--é…ç½®æ­¤é¡¹ä½œç”¨ï¼šé»˜è®¤å¼€å¯å¤„ç†å™¨æ˜ å°„å™¨å’Œå¤„ç†å™¨é€‚é…å™¨ï¼ˆè¿™ä¸¤ä¸ªä¸œè¥¿å¤„äºåº•å±‚ï¼‰--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--é…ç½®è§†å›¾è§£æå™¨--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"internalResourceViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--é…ç½®è¿‡æ»¤é™æ€èµ„æº(é‚£äº›é™æ€èµ„æºä¸æ‹¦æˆªï¼Œè¦åœ¨webappsè·¯å¾„ä¸‹å»ºç«‹ç›¸åº”çš„é™æ€èµ„æºæ–‡ä»¶å¤¹)--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span> <span class="attr">location</span>=<span class="string">"/css/"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span> <span class="attr">location</span>=<span class="string">"/images/"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span> <span class="attr">location</span>=<span class="string">"/js/"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-è¯·æ±‚è½¬å‘å’Œé‡å®šå‘"><a href="#2-3-è¯·æ±‚è½¬å‘å’Œé‡å®šå‘" class="headerlink" title="2.3 è¯·æ±‚è½¬å‘å’Œé‡å®šå‘"></a>2.3 è¯·æ±‚è½¬å‘å’Œé‡å®šå‘</h4><p><strong>è¯·æ±‚è½¬å‘</strong>ï¼šå¯ä»¥çœç•¥å…³é”®è¯ï¼š<strong>forward</strong>ã€‚ä½†æ˜¯éœ€è¦è§†å›¾è§£æå™¨çš„å‰åç¼€æ‹¼æ¥ï¼Œè¿›è¡Œå…·ä½“è§†å›¾çš„è®¿é—®ï¼ˆurlä¸ä¼šæ”¹å˜ï¼‰ï¼Œå¼€å¯è§†å›¾è§£æå™¨ä¹‹åï¼Œä¸éœ€è¦forwardçš„å£°æ˜ï¼Œé»˜è®¤å°±æ˜¯è¯·æ±‚è½¬å‘æ“ä½œã€‚</p>
<p><strong>é‡å®šå‘</strong>ï¼šä¸éœ€è¦è§†å›¾è§£æå™¨ ,ä½†æ˜¯éœ€è¦ä¸€ä¸ªå…³é”®è¯ï¼š<strong>redirect</strong> ã€‚å…¶æœ¬è´¨å°±æ˜¯é‡æ–°è¯·æ±‚ä¸€ä¸ªæ–°åœ°æ–¹å˜› , æ‰€ä»¥æ³¨æ„è·¯å¾„é—®é¢˜ã€‚</p>
<p>åŒæ—¶ï¼šé‡å®šå‘å¯ä»¥ç›´æ¥é‡å®šå‘åˆ°å¦ä¸€ä¸ªcontrollerè¯·æ±‚å®ç° .  æˆ‘è®¤ä¸ºï¼šé‡å®šå‘ä¸€èˆ¬ç”¨äºè®¿é—®å‡ºé”™çš„é‡å®šå‘è·³è½¬</p>
<p>æ³¨æ„ï¼šä¸‹é¢çš„é‡å®šå‘æ“ä½œæ˜¯é”™è¯¯çš„ï¼ŒWEB-INFç›®å½•ä¸‹çš„èµ„æºä¸èƒ½ç›´æ¥è¿›è¡Œé‡å®šå‘è®¿é—®</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/WEB-INF/views/test.jsp"</span>; <span class="comment">//é”™è¯¯</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect:index.jsp"</span>;  <span class="comment">//æ­£ç¡®</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSpringMVC2</span> </span>{</span><br><span class="line">    <span class="meta">@RequestMapping("/rsm2/t1")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">//è½¬å‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping("/rsm2/t2")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">//é‡å®šå‘åˆ°å¦ä¸€ä¸ªè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/index.jsp"</span>;</span><br><span class="line">        <span class="comment">//return "redirect:hello.do"; //hello.doä¸ºå¦ä¸€ä¸ªè¯·æ±‚/</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-4-ä¸­æ–‡ä¹±ç é—®é¢˜è§£å†³"><a href="#2-4-ä¸­æ–‡ä¹±ç é—®é¢˜è§£å†³" class="headerlink" title="2.4 ä¸­æ–‡ä¹±ç é—®é¢˜è§£å†³"></a>2.4 ä¸­æ–‡ä¹±ç é—®é¢˜è§£å†³</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ï¼šä¸­æ–‡ä¹±ç è¿‡æ»¤å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--åˆå§‹åŒ–ï¼šencoding(å›ºå®šå˜é‡å)çš„ç¼–ç æ–¹å¼--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-SpringMVC-Jsonç†è§£"><a href="#3-SpringMVC-Jsonç†è§£" class="headerlink" title="3.SpringMVC-Jsonç†è§£"></a>3.SpringMVC-Jsonç†è§£</h3><p>å‰åç«¯åˆ†ç¦»åŸç†:åç«¯æä¾›ç»™å‰ç«¯ä¸€ç§å¤§å®¶éƒ½ç†è§£ï¼Œéƒ½æ˜ç™½ï¼Œéƒ½ä¼šä½¿ç”¨çš„ä¸€ç§æ•°æ®ç±»å‹ï¼ˆjsonï¼‰,è¿›è¡Œå¼€å‘å¯¹æ¥å·¥ä½œã€‚</p>
<ul>
<li>åç«¯éƒ¨ç½²åç«¯ï¼šæä¾›æ¥å£ï¼Œæä¾›æ•°æ®ï¼ˆjsonï¼‰</li>
<li>jsonç±»å‹æ•°æ®ï¼šå‰åç«¯æ•°æ®äº¤æ¢çš„æ ¼å¼</li>
<li>å‰ç«¯ç‹¬ç«‹éƒ¨ç½²ï¼šè´Ÿè´£æ¸²æŸ“åç«¯æ•°æ®(json)</li>
</ul>
<h4 id="3-1ç®€å•è½¬æ¢ç¤ºä¾‹"><a href="#3-1ç®€å•è½¬æ¢ç¤ºä¾‹" class="headerlink" title="3.1ç®€å•è½¬æ¢ç¤ºä¾‹"></a>3.1ç®€å•è½¬æ¢ç¤ºä¾‹</h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">//æ²¡ä»€ä¹ˆç”¨ï¼Œåªæ˜¯çœ‹ä¸€ä¸‹å¯¹è±¡æ•°æ®å’Œjsonæ•°æ®å†™æ³•çš„ä¸åŒ</span><br><span class="line">var user = {</span><br><span class="line">            name:"é©¬æ»¨",</span><br><span class="line">            age:23,</span><br><span class="line">            sex:"ç”·"</span><br><span class="line">        };</span><br><span class="line">        //å°†jså¯¹è±¡è½¬æ¢ä¸ºjsonç±»å‹çš„å¯¹è±¡æ•°æ®</span><br><span class="line">        var json = JSON.stringify(user);</span><br><span class="line">        console.log(json);</span><br><span class="line">        console.log("===============");</span><br><span class="line">        //å°†jsonå¯¹è±¡æ•°æ®è§£æä¸ºjså¯¹è±¡</span><br><span class="line">        var js = JSON.parse(json);</span><br><span class="line">        console.log(js);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-2-åç«¯çœŸæ­£çš„jsonè½¬æ¢ä¼ è¾“"><a href="#3-2-åç«¯çœŸæ­£çš„jsonè½¬æ¢ä¼ è¾“" class="headerlink" title="3.2 åç«¯çœŸæ­£çš„jsonè½¬æ¢ä¼ è¾“"></a>3.2 åç«¯çœŸæ­£çš„jsonè½¬æ¢ä¼ è¾“</h4><h5 id="æ–¹æ³•ä¸€ï¼šjackson"><a href="#æ–¹æ³•ä¸€ï¼šjackson" class="headerlink" title="æ–¹æ³•ä¸€ï¼šjackson"></a>æ–¹æ³•ä¸€ï¼šjackson</h5><p>â€‹    1. å¼•å…¥jacksonçš„ä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Jackson(åç«¯æ•°æ®è½¬æ¢ä¸ºjsonç±»å‹æ•°æ®ä¼ è¾“åˆ°å‰ç«¯)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<ol>
<li>åœ¨spring-mvc.xmlæ–‡ä»¶ä¸­é…ç½®å›ºå®šçš„xmlé…ç½®</li>
</ol>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--jsonä¹±ç é—®é¢˜è§£å†³ï¼ˆjacksonä¾èµ–åŒ…çš„æ“ä½œï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"objectMapper"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"failOnEmptyBeans"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<ol>
<li>å¯ä»¥è¿›è¡Œjacksonçš„ç”¨æ³•å°è£…ï¼ˆå›ºå®šå·¥å…·ç±»ï¼šåŒ…æ‹¬æ—¥æœŸçš„æ ¼å¼è½¬æ¢ï¼‰</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•å³å¯*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> getJson(object,<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object,String dateFormat)</span> </span>{</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">//ä¸ä½¿ç”¨æ—¶é—´å·®çš„æ–¹å¼</span></span><br><span class="line">        mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼å¯¹è±¡</span></span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(dateFormat);</span><br><span class="line">        <span class="comment">//æŒ‡å®šæ—¥æœŸæ ¼å¼</span></span><br><span class="line">        mapper.setDateFormat(sdf);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(object);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ol>
<li>åœ¨controllerå±‚ç›´æ¥è¿›è¡Œè°ƒç”¨è¿”å›æ“ä½œ</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span> <span class="comment">//è¿”å›å€¼ä¸ä¼šå†èµ°è§†å›¾è§£æå™¨ï¼Œè€Œä¼šç›´æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="meta">@GetMapping(value = "/json")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>{</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"é©¬æ»¨"</span>,<span class="number">23</span>,<span class="string">"ç”·"</span>);</span><br><span class="line">    <span class="keyword">return</span> JSONUtils.getJson(user);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="æ–¹æ³•äºŒï¼šfastjsonï¼ˆé˜¿é‡Œå·´å·´å¼€æºå·¥å…·ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç›¸å½“äºjacksonå°è£…ä¹‹åçš„æ ·å­ï¼‰"><a href="#æ–¹æ³•äºŒï¼šfastjsonï¼ˆé˜¿é‡Œå·´å·´å¼€æºå·¥å…·ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç›¸å½“äºjacksonå°è£…ä¹‹åçš„æ ·å­ï¼‰" class="headerlink" title="æ–¹æ³•äºŒï¼šfastjsonï¼ˆé˜¿é‡Œå·´å·´å¼€æºå·¥å…·ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç›¸å½“äºjacksonå°è£…ä¹‹åçš„æ ·å­ï¼‰"></a>æ–¹æ³•äºŒï¼šfastjsonï¼ˆé˜¿é‡Œå·´å·´å¼€æºå·¥å…·ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç›¸å½“äºjacksonå°è£…ä¹‹åçš„æ ·å­ï¼‰</h5><p>å¼•å…¥pomä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--fastjson(jsonè½¬æ¢)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>å‡ ç§ç›´æ¥å¯ä»¥è¿›è¡Œè°ƒç”¨ä½¿ç”¨çš„æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//æœ€å¸¸ç”¨çš„æ–¹æ³•</span></span><br><span class="line">System.out.println(<span class="string">"*******Javaå¯¹è±¡ è½¬ JSONå­—ç¬¦ä¸²*******"</span>);</span><br><span class="line">      String str1 = JSON.toJSONString(list);</span><br><span class="line">      System.out.println(<span class="string">"JSON.toJSONString(list)==&gt;"</span>+str1);</span><br><span class="line">      String str2 = JSON.toJSONString(user1);</span><br><span class="line">      System.out.println(<span class="string">"JSON.toJSONString(user1)==&gt;"</span>+str2);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">"\n****** JSONå­—ç¬¦ä¸² è½¬ Javaå¯¹è±¡*******"</span>);</span><br><span class="line">      User jp_user1=JSON.parseObject(str2,User.class);</span><br><span class="line">      System.out.println(<span class="string">"JSON.parseObject(str2,User.class)==&gt;"</span>+jp_user1);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">"\n****** Javaå¯¹è±¡ è½¬ JSONå¯¹è±¡ ******"</span>);</span><br><span class="line">      JSONObject jsonObject1 = (JSONObject) JSON.toJSON(user2);</span><br><span class="line">      System.out.println(<span class="string">"(JSONObject) JSON.toJSON(user2)==&gt;"</span>+jsonObject1.getString(<span class="string">"name"</span>));</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">"\n****** JSONå¯¹è±¡ è½¬ Javaå¯¹è±¡ ******"</span>);</span><br><span class="line">      User to_java_user = JSON.toJavaObject(jsonObject1, User.class);</span><br><span class="line">      System.out.println(<span class="string">"JSON.toJavaObject(jsonObject1, User.class)==&gt;"</span>+to_java_user);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="10-AJAXæŠ€æœ¯æµ…æ"><a href="#10-AJAXæŠ€æœ¯æµ…æ" class="headerlink" title="10.AJAXæŠ€æœ¯æµ…æ"></a>10.AJAXæŠ€æœ¯æµ…æ</h3><p>æ³¨æ„ï¼š${pageContext.request.contextPath}è·å–çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ¯”å¦‚ï¼šlocal host:8080/ï¼Œå¦‚æœé¡¹ç›®æœ‰é¡¹ç›®åï¼Œä¹Ÿä¼šä¼šå“¦æ¸ é“é¡¹ç›®åï¼šlocal host:8080/springmvc</p>
<p> <strong>Ajaxçš„æ ¸å¿ƒ</strong>æ˜¯XMLHttpRequestå¯¹è±¡(XHR)ã€‚XHRä¸ºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚å’Œè§£ææœåŠ¡å™¨å“åº”æä¾›äº†æ¥å£ã€‚èƒ½å¤Ÿä»¥å¼‚æ­¥æ–¹å¼ä»æœåŠ¡å™¨è·å–æ–°æ•°æ®.</p>
<p><strong>ç®€å•æ¥è¯´ï¼š</strong>ajaxå°±æ˜¯åœ¨è¿™ä¸ªé¡µé¢å¯¹æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œé¡µé¢çš„è½¬å‘å’Œé‡å®šå‘æ“ä½œã€‚æœ‰ç§ä¸çŸ¥ä¸è§‰çš„æ„Ÿè§‰ï¼Œæ•°æ®å°±è·å–å¹¶å±•ç¤ºåˆ°æµè§ˆå™¨äº†ã€‚</p>
<h4 id="10-1-ajaxçš„å‚æ•°è§£æ"><a href="#10-1-ajaxçš„å‚æ•°è§£æ" class="headerlink" title="10.1 ajaxçš„å‚æ•°è§£æ"></a>10.1 ajaxçš„å‚æ•°è§£æ</h4><ul>
<li>```js<br>jQuery.ajax(â€¦)<pre><code>   éƒ¨åˆ†å‚æ•°ï¼š
          urlï¼šè¯·æ±‚åœ°å€
         typeï¼šè¯·æ±‚æ–¹å¼ï¼ŒGETã€POSTï¼ˆ1.9.0ä¹‹åç”¨methodï¼‰
      headersï¼šè¯·æ±‚å¤´
         dataï¼šè¦å‘é€çš„æ•°æ®
  contentTypeï¼šå³å°†å‘é€ä¿¡æ¯è‡³æœåŠ¡å™¨çš„å†…å®¹ç¼–ç ç±»å‹(é»˜è®¤: "application/x-www-form-urlencoded; charset=UTF-8")
        asyncï¼šæ˜¯å¦å¼‚æ­¥
      timeoutï¼šè®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
   beforeSendï¼šå‘é€è¯·æ±‚å‰æ‰§è¡Œçš„å‡½æ•°(å…¨å±€)
     completeï¼šå®Œæˆä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
      successï¼šæˆåŠŸä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
        errorï¼šå¤±è´¥ä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
      acceptsï¼šé€šè¿‡è¯·æ±‚å¤´å‘é€ç»™æœåŠ¡å™¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨å½“å‰å®¢æˆ·ç«¯è¯¾æ¥å—çš„æ•°æ®ç±»å‹
     dataTypeï¼šå°†æœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®è½¬æ¢æˆæŒ‡å®šç±»å‹
        "xml": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆxmlæ ¼å¼
       "text": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼
       "html": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼ï¼Œåœ¨æ’å…¥DOMä¸­æ—¶ï¼Œå¦‚æœåŒ…å«JavaScriptæ ‡ç­¾ï¼Œåˆ™ä¼šå°è¯•å»æ‰§è¡Œã€‚
     "script": å°è¯•å°†è¿”å›å€¼å½“ä½œJavaScriptå»æ‰§è¡Œï¼Œç„¶åå†å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼
       "json": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆç›¸åº”çš„JavaScriptå¯¹è±¡
      "jsonp": JSONP æ ¼å¼ä½¿ç”¨ JSONP å½¢å¼è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚ "myurl?callback=?" jQuery å°†è‡ªåŠ¨æ›¿æ¢ ? ä¸ºæ­£ç¡®çš„å‡½æ•°åï¼Œä»¥æ‰§è¡Œå›è°ƒå‡½æ•°
</code></pre><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">ä¸»è¦å­¦ä¹ ï¼šurl; type; data; success;å³å¯</span><br><span class="line"></span><br><span class="line">#### 10.2 ajaxå®ç°ç®€å•ç™»å½•æç¤ºæ•ˆæœ</span><br><span class="line"></span><br><span class="line">controllerå±‚ï¼š</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">	@ResponseBody</span><br><span class="line">    @PostMapping(value = "/login")</span><br><span class="line">    public String login(String username, String password) {</span><br><span class="line">        /*æ¨¡æ‹Ÿæ•°æ®åº“æ•°æ®*/</span><br><span class="line">        String message = "";</span><br><span class="line">       if (username != null) {</span><br><span class="line">           if ("mabin".equals(username)) {</span><br><span class="line">               message="OK";</span><br><span class="line">           } else {</span><br><span class="line">               message="ç”¨æˆ·åä¸æ­£ç¡®";</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">       if (password != null) {</span><br><span class="line">           if ("mabin".equals(password)) {</span><br><span class="line">               message="OK";</span><br><span class="line">           } else {</span><br><span class="line">               message="å¯†ç ä¸æ­£ç¡®";</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">        return message;  //@ResponseBodyä¼šè‡ªåŠ¨å°†messageè½¬æ¢json</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p>jspé¡µé¢ï¼š</p>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">	&lt;script&gt; </span><br><span class="line">	<span class="comment">/*ç™»é™†æ³¨å†Œæç¤ºæ•ˆæœï¼ˆå¤±å»ç„¦ç‚¹äº‹ä»¶ï¼‰*/</span></span><br><span class="line">        <span class="comment">//ç”¨æˆ·åéªŒè¯</span></span><br><span class="line">            <span class="function">function <span class="title">u</span><span class="params">()</span> </span>{</span><br><span class="line">                $.ajax({</span><br><span class="line">                    url: <span class="string">"${pageContext.request.contextPath}/login"</span>,</span><br><span class="line">                    type: <span class="string">"POST"</span>,</span><br><span class="line">                    data: {<span class="string">"username"</span>: $(<span class="string">"#username1"</span>).val()},</span><br><span class="line">                    success: function (data) {</span><br><span class="line">                        <span class="keyword">if</span> (data.toString() == <span class="string">"OK"</span>) {</span><br><span class="line">                            $(<span class="string">"#userInfo"</span>).css(<span class="string">"color"</span>,<span class="string">"green"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            $(<span class="string">"#userInfo"</span>).css(<span class="string">"color"</span>,<span class="string">"red"</span>);</span><br><span class="line">                        }</span><br><span class="line">                        $(<span class="string">"#userInfo"</span>).html(data)</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å¯†ç éªŒè¯</span></span><br><span class="line">            <span class="function">function <span class="title">p</span><span class="params">()</span> </span>{</span><br><span class="line">                $.ajax({</span><br><span class="line">                    url:<span class="string">"${pageContext.request.contextPath}/login"</span>,</span><br><span class="line">                    type:<span class="string">"POST"</span>,</span><br><span class="line">                    data:{<span class="string">"password"</span>:$(<span class="string">"#password"</span>).val()},</span><br><span class="line">                    success:function (data) {</span><br><span class="line">                        <span class="keyword">if</span> (data.toString() == <span class="string">"OK"</span>) {</span><br><span class="line">                            $(<span class="string">"#passInfo"</span>).css(<span class="string">"color"</span>,<span class="string">"green"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            $(<span class="string">"#passInfo"</span>).css(<span class="string">"color"</span>,<span class="string">"red"</span>);</span><br><span class="line">                        }</span><br><span class="line">                        $(<span class="string">"#passInfo"</span>).html(data)</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line"><span class="comment">//htmlè¡¨å•</span></span><br><span class="line">&lt;h3&gt;ç™»å½•æ³¨å†Œæç¤ºæ•ˆæœ&lt;/h3&gt;</span><br><span class="line">ç”¨æˆ·åï¼š&lt;input type=<span class="string">"text"</span> id=<span class="string">"username1"</span> placeholder=<span class="string">"è¯·è¾“å…¥ç”¨æˆ·å"</span> onblur=<span class="string">"u()"</span>/&gt;</span><br><span class="line">&lt;span id="userInfo"&gt;&lt;/span&gt;&lt;br/&gt;</span><br><span class="line">å¯†&amp;nbsp;&amp;nbsp;&amp;nbsp;ç ï¼š&lt;input type=<span class="string">"password"</span> id=<span class="string">"password"</span> placeholder=<span class="string">"è¯·è¾“å…¥å¯†ç "</span> onblur=<span class="string">"p()"</span>/&gt;</span><br><span class="line">&lt;span id="passInfo"&gt;&lt;/span&gt;&lt;br/&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="11-mvcä¸­çš„æ‹¦æˆªå™¨åŸºæœ¬ä½¿ç”¨å’Œé…ç½®"><a href="#11-mvcä¸­çš„æ‹¦æˆªå™¨åŸºæœ¬ä½¿ç”¨å’Œé…ç½®" class="headerlink" title="11.mvcä¸­çš„æ‹¦æˆªå™¨åŸºæœ¬ä½¿ç”¨å’Œé…ç½®"></a>11.mvcä¸­çš„æ‹¦æˆªå™¨åŸºæœ¬ä½¿ç”¨å’Œé…ç½®</h3><p><strong>spring-mvcä¸­çš„æ‹¦æˆªå™¨æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ˜¯åŸºäºspring AOPçš„ï¼Œä¸å¯¹ä¸šåŠ¡é€»è¾‘åšä»»ä½•æ”¹å˜ï¼Œä»è€Œå¢å¼ºä¸šåŠ¡æ•ˆæœï¼Œï¼ˆä¸€èˆ¬ç”¨äºç™»å½•æ‹¦æˆªç­‰â€¦ï¼‰</p>
<p><strong>ä¸€èˆ¬æµç¨‹</strong>ï¼šæ‹¦æˆªä»å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œåœ¨åˆ°è¾¾controllerå±‚ä¹‹å‰è¿›è¡Œä¸€äº›å¢å¼ºä¸šåŠ¡æ“ä½œï¼Œæ»¡è¶³æ¡ä»¶å°±æ”¾è¡Œï¼Œå¦åˆ™ï¼Œå†è¿›è¡Œå…¶ä»–æ“ä½œã€‚</p>
<h4 id="11-1-ç¼–å†™ä¸€ä¸ªç»§æ‰¿äº†HandlerInterceptoræ¥å£çš„æ‹¦æˆªæ‰©å±•ç±»"><a href="#11-1-ç¼–å†™ä¸€ä¸ªç»§æ‰¿äº†HandlerInterceptoræ¥å£çš„æ‹¦æˆªæ‰©å±•ç±»" class="headerlink" title="11.1 ç¼–å†™ä¸€ä¸ªç»§æ‰¿äº†HandlerInterceptoræ¥å£çš„æ‹¦æˆªæ‰©å±•ç±»"></a>11.1 ç¼–å†™ä¸€ä¸ªç»§æ‰¿äº†HandlerInterceptoræ¥å£çš„æ‹¦æˆªæ‰©å±•ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptorConfig</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœè¿”å›trueæ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè¯·æ±‚ä¼šå¾€ä¸‹èµ°ï¼Œåˆ°controllerä¸­æ‰§è¡Œç›¸åº”çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * å¦‚æœè¿”å›falseå°±ä¸æ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨,è¯·æ±‚ä¸ä¼šå†ç»§ç»­å¾€ä¸‹èµ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        System.out.println(<span class="string">"controllerè¢«è¯·æ±‚æ–¹æ³•æ‰§è¡Œä¹‹å‰"</span>);</span><br><span class="line">        <span class="comment">//è¿™é‡Œè¿›è¡Œå…·ä½“çš„é€»è¾‘åˆ¤æ–­æ“ä½œï¼Œå†³å®šæ˜¯å¦æ”¾è¡Œã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸‹é¢çš„ä¸¤ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºå†™æ‹¦æˆªæ—¥å¿—ï¼Œä¸€èˆ¬ä¸é€‚ç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        System.out.println(<span class="string">"controllerè¢«è¯·æ±‚æ–¹æ³•æ‰§è¡Œä¹‹å"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        System.out.println(<span class="string">"åœ¨dispatcherServletå¤„ç†åæ‰§è¡Œ,åšæ¸…ç†å·¥ä½œ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="11-2-spring-mvc-xmlæ–‡ä»¶ä¸­çš„åŸºæœ¬é…ç½®"><a href="#11-2-spring-mvc-xmlæ–‡ä»¶ä¸­çš„åŸºæœ¬é…ç½®" class="headerlink" title="11.2 spring-mvc.xmlæ–‡ä»¶ä¸­çš„åŸºæœ¬é…ç½®"></a>11.2 spring-mvc.xmlæ–‡ä»¶ä¸­çš„åŸºæœ¬é…ç½®</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="comment">&lt;!--é…ç½®ï¼šæ‹¦æˆªå™¨å°†è¦æ‹¦æˆªçš„è¯·æ±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®æƒ³è¦æ‹¦æˆªçš„è·¯å¾„</span></span><br><span class="line"><span class="comment">/admin/**ï¼šä»£è¡¨æ‰€æœ‰è¯·æ±‚è·¯å¾„ï¼ŒåŒ…æ‹¬æ‰€æœ‰çˆ¶è·¯å¾„ä¸‹çš„æ‰€æœ‰å±‚çš„å­è·¯å¾„(/admin/user/user1/user2/...)åé¢å¯ä»¥æ— æ•°å¤šå±‚</span></span><br><span class="line"><span class="comment">/admin/*ï¼šä»£è¡¨ä¸€ä¸ªçˆ¶è·¯å¾„çš„ä»»ä½•ä¸€ä¸ªå­è·¯ç»(/admin/user),ä»…ä»…å°±è¿™ä¸¤å±‚</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/admin/**"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ‰©å±•ç±»--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.maven.ssm.config.MyInterceptorConfig"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>
<h3 id="12-springmvcæ–‡ä»¶ä¸Šä¼ é…ç½®"><a href="#12-springmvcæ–‡ä»¶ä¸Šä¼ é…ç½®" class="headerlink" title="12 springmvcæ–‡ä»¶ä¸Šä¼ é…ç½®"></a>12 springmvcæ–‡ä»¶ä¸Šä¼ é…ç½®</h3><h4 id="12-1-å¯¼å…¥pomä¾èµ–"><a href="#12-1-å¯¼å…¥pomä¾èµ–" class="headerlink" title="12.1 å¯¼å…¥pomä¾èµ–"></a>12.1 å¯¼å…¥pomä¾èµ–</h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--æ–‡ä»¶ä¸Šä¼ --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--servlet-apiå¯¼å…¥é«˜ç‰ˆæœ¬çš„--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="12-2-ç¼–å†™é¡µé¢è¡¨å•ï¼ˆæ³¨æ„ç‚¹å¾ˆå¤šï¼‰"><a href="#12-2-ç¼–å†™é¡µé¢è¡¨å•ï¼ˆæ³¨æ„ç‚¹å¾ˆå¤šï¼‰" class="headerlink" title="12.2 ç¼–å†™é¡µé¢è¡¨å•ï¼ˆæ³¨æ„ç‚¹å¾ˆå¤šï¼‰"></a>12.2 ç¼–å†™é¡µé¢è¡¨å•ï¼ˆæ³¨æ„ç‚¹å¾ˆå¤šï¼‰</h4><p> <strong>è¦æ±‚</strong>ï¼šå‰ç«¯è¡¨å•è¦æ±‚ï¼šä¸ºäº†èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œå¿…é¡»å°†è¡¨å•çš„<strong>methodè®¾ç½®ä¸ºPOST</strong>ï¼Œå¹¶å°†<strong>enctypeè®¾ç½®ä¸ºmultipart/form-data</strong>ã€‚åªæœ‰åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æ‰ä¼šæŠŠç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ•°æ®å‘é€ç»™æœåŠ¡å™¨ï¼›</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;h3&gt;æ–‡ä»¶ä¸Šä¼ &lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">"${pageContext.request.contextPath}/upload2"</span> enctype=<span class="string">"multipart/form-data"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"upload"</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>12.3 spring-mvc.xmlæ–‡ä»¶çš„é…ç½®(å›ºå®šçš„é…ç½®)</p>
<p><strong>æ³¨æ„ç‚¹ï¼šè¿™ä¸ªbenaçš„idå¿…é¡»ä¸ºï¼šmultipartResolver ï¼Œ å¦åˆ™ä¸Šä¼ æ–‡ä»¶ä¼šæŠ¥400çš„é”™è¯¯</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ï¼šæ–‡ä»¶ä¸Šä¼ --&gt;</span><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span>  <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span>    <span class="comment">&lt;!-- è¯·æ±‚çš„ç¼–ç æ ¼å¼ï¼Œå¿…é¡»å’ŒjSPçš„pageEncodingå±æ€§ä¸€è‡´ï¼Œä»¥ä¾¿æ­£ç¡®è¯»å–è¡¨å•çš„å†…å®¹ï¼Œé»˜è®¤ä¸ºISO-8859-1 --&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>/&gt;</span>    <span class="comment">&lt;!-- ä¸Šä¼ æ–‡ä»¶å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼ˆ10485760=10Mï¼‰ --&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"10485760"</span>/&gt;</span>    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span> <span class="attr">value</span>=<span class="string">"40960"</span>/&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="12-4-controllerå±‚ä¸Šä¼ æ–¹æ³•çš„ç¼–å†™-ä¸»è¦ä½¿ç”¨äº†CommonsMulti-part-Fileè¿™ä¸ªç±»"><a href="#12-4-controllerå±‚ä¸Šä¼ æ–¹æ³•çš„ç¼–å†™-ä¸»è¦ä½¿ç”¨äº†CommonsMulti-part-Fileè¿™ä¸ªç±»" class="headerlink" title="12.4 controllerå±‚ä¸Šä¼ æ–¹æ³•çš„ç¼–å†™(ä¸»è¦ä½¿ç”¨äº†CommonsMulti part Fileè¿™ä¸ªç±»)"></a>12.4 controllerå±‚ä¸Šä¼ æ–¹æ³•çš„ç¼–å†™(ä¸»è¦ä½¿ç”¨äº†CommonsMulti part Fileè¿™ä¸ªç±»)</h4><p>CommonsMultipartFile çš„ å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><strong>String getOriginalFilename()ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„åŸå</strong></li>
<li><strong>InputStream getInputStream()ï¼šè·å–æ–‡ä»¶æµ</strong></li>
<li><strong>void transferTo(File dest)ï¼šå°†ä¸Šä¼ æ–‡ä»¶ä¿å­˜åˆ°ä¸€ä¸ªç›®å½•æ–‡ä»¶ä¸­</strong></li>
</ul>
<p>æ–¹å¼ä¸€ï¼šç¹æ‚ç‰ˆï¼Œä½†æ˜¯å¯ä»¥æ›´åŠ æ·±å…¥ç†è§£æ–‡ä»¶ä¸Šä¼ çš„åŸç†è¿‡ç¨‹ï¼Œ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//@RequestParam("file") å°†name=fileæ§ä»¶å¾—åˆ°çš„æ–‡ä»¶å°è£…æˆCommonsMultipartFile å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//æ‰¹é‡ä¸Šä¼ CommonsMultipartFileåˆ™ä¸ºæ•°ç»„å³å¯</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = "/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fileUpload</span><span class="params">(<span class="meta">@RequestParam("file")</span> CommonsMultipartFile file , HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶å : file.getOriginalFilename();</span></span><br><span class="line">        String uploadFileName = file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœæ–‡ä»¶åä¸ºç©ºï¼Œç›´æ¥å›åˆ°é¦–é¡µï¼</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">""</span>.equals(uploadFileName)){</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/index.jsp"</span>;</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"ä¸Šä¼ æ–‡ä»¶å : "</span>+uploadFileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸Šä¼ è·¯å¾„ä¿å­˜è®¾ç½®</span></span><br><span class="line">        String path = request.getSession().getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª</span></span><br><span class="line">        File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!realPath.exists()){</span><br><span class="line">            realPath.mkdir();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"ä¸Šä¼ æ–‡ä»¶ä¿å­˜åœ°å€ï¼š"</span>+realPath);</span><br><span class="line"></span><br><span class="line">        InputStream is = file.getInputStream(); <span class="comment">//æ–‡ä»¶è¾“å…¥æµ</span></span><br><span class="line">        OutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(realPath,uploadFileName)); <span class="comment">//æ–‡ä»¶è¾“å‡ºæµ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯»å–å†™å‡º</span></span><br><span class="line">        <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len=is.read(buffer))!=-<span class="number">1</span>){</span><br><span class="line">            os.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">            os.flush();</span><br><span class="line">        }</span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/index.jsp"</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>æ–¹å¼äºŒï¼šç®€å•ç‰ˆï¼Œç›´æ¥ä½¿ç”¨è¿™æ–¹æ³•è¿›è¡Œæ“ä½œï¼š<strong>void transferTo(File dest)ï¼šå°†ä¸Šä¼ æ–‡ä»¶ä¿å­˜åˆ°ä¸€ä¸ªç›®å½•æ–‡ä»¶ä¸­</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * é‡‡ç”¨file.Transferto æ¥ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping("/upload2")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String  <span class="title">fileUpload2</span><span class="params">(<span class="meta">@RequestParam("file")</span> CommonsMultipartFile file, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸Šä¼ è·¯å¾„ä¿å­˜è®¾ç½®ï¼Œå¦‚è¿‡æ²¡æœ‰è¿™ä¸ªç›®å½•ï¼Œå°±ç›´æ¥è¿›è¡Œåˆ›å»º</span></span><br><span class="line">    String path = request.getSession().getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">    File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="keyword">if</span> (!realPath.exists()){</span><br><span class="line">        realPath.mkdir();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸Šä¼ æ–‡ä»¶åœ°å€</span></span><br><span class="line">    System.out.println(<span class="string">"ä¸Šä¼ æ–‡ä»¶ä¿å­˜åœ°å€ï¼š"</span>+realPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡CommonsMultipartFileçš„æ–¹æ³•ç›´æ¥å†™æ–‡ä»¶ï¼ˆæ³¨æ„è¿™ä¸ªæ—¶å€™ï¼‰</span></span><br><span class="line">    file.transferTo(<span class="keyword">new</span> File(realPath +<span class="string">"/"</span>+ file.getOriginalFilename()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/index.jsp"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šä¼ å›¾ç‰‡å®Œæˆï¼ˆå…¶åº•å±‚åŸç†æˆ‘è¿˜ä¸ä¼šï¼‰ï¼Œ</p>
<h3 id="13-æ–‡ä»¶ä¸‹è½½-ç®€å•"><a href="#13-æ–‡ä»¶ä¸‹è½½-ç®€å•" class="headerlink" title="13 æ–‡ä»¶ä¸‹è½½(ç®€å•)"></a>13 æ–‡ä»¶ä¸‹è½½(ç®€å•)</h3><p>å‰ç«¯é¡µé¢æ›´ä¸ºç®€å•ï¼šåªéœ€è¦å°†è¦è¯·æ±‚è·¯å¾„æ”¾å…¥aæ ‡ç­¾ä¸­å³å¯ã€‚</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>æ–‡ä»¶ä¸‹è½½<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/download"</span>&gt;</span>ä¸‹è½½æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>controllerå±‚çš„æ–¹æ³•ï¼ˆåŸºæœ¬å›ºå®šï¼‰</p>
<p><strong>æ³¨æ„ï¼š</strong>åªéœ€è¦æ”¹å˜è¦ä¸‹è½½æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„å’Œå…·ä½“ä¸‹è½½æ–‡ä»¶å†…å®¹å³å¯</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–‡ä»¶çš„ä¸‹è½½ï¼šåªéœ€è¦æ”¹å˜è¦ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„å’Œå…·ä½“ä¸‹è½½å†…å®¹å³å¯</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value="/download")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">downloads</span><span class="params">(HttpServletResponse response , HttpServletRequest request)</span> <span class="keyword">throws</span> Exception</span>{</span><br><span class="line">       <span class="comment">//è¦ä¸‹è½½çš„å›¾ç‰‡åœ°å€ï¼ˆåªæœ‰è¿™é‡Œéœ€è¦æ”¹å˜ï¼‰</span></span><br><span class="line">       String  path = request.getSession().getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">       String  fileName = <span class="string">"th.jfif"</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//1ã€è®¾ç½®response å“åº”å¤´</span></span><br><span class="line">       response.reset(); <span class="comment">//è®¾ç½®é¡µé¢ä¸ç¼“å­˜,æ¸…ç©ºbuffer</span></span><br><span class="line">       response.setCharacterEncoding(<span class="string">"UTF-8"</span>); <span class="comment">//å­—ç¬¦ç¼–ç </span></span><br><span class="line">       response.setContentType(<span class="string">"multipart/form-data"</span>); <span class="comment">//äºŒè¿›åˆ¶ä¼ è¾“æ•°æ®</span></span><br><span class="line">       <span class="comment">//è®¾ç½®å“åº”å¤´</span></span><br><span class="line">       response.setHeader(<span class="string">"Content-Disposition"</span>,</span><br><span class="line">               <span class="string">"attachment;fileName="</span>+ URLEncoder.encode(fileName, <span class="string">"UTF-8"</span>));</span><br><span class="line"></span><br><span class="line">       File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">       <span class="comment">//2ã€ è¯»å–æ–‡ä»¶--è¾“å…¥æµ</span></span><br><span class="line">       InputStream input=<span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">       <span class="comment">//3ã€ å†™å‡ºæ–‡ä»¶--è¾“å‡ºæµ</span></span><br><span class="line">       OutputStream out = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">byte</span>[] buff =<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">       <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">       <span class="comment">//4ã€æ‰§è¡Œ å†™å‡ºæ“ä½œ</span></span><br><span class="line">       <span class="keyword">while</span>((index= input.read(buff))!= -<span class="number">1</span>){</span><br><span class="line">           out.write(buff, <span class="number">0</span>, index);</span><br><span class="line">           out.flush();</span><br><span class="line">       }</span><br><span class="line">       out.close();</span><br><span class="line">       input.close();</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="SpringJSP"><a href="#SpringJSP" class="headerlink" title="SpringJSP"></a>SpringJSP</h3><h3 id="1-jspåŸºç¡€è¯­æ³•"><a href="#1-jspåŸºç¡€è¯­æ³•" class="headerlink" title="1.jspåŸºç¡€è¯­æ³•"></a>1.jspåŸºç¡€è¯­æ³•</h3><h4 id="1-1-jspè¡¨è¾¾å¼-lt-gt-ç›¸å½“äºELè¡¨è¾¾å¼çš„"><a href="#1-1-jspè¡¨è¾¾å¼-lt-gt-ç›¸å½“äºELè¡¨è¾¾å¼çš„" class="headerlink" title="1.1 jspè¡¨è¾¾å¼<%= %>ç›¸å½“äºELè¡¨è¾¾å¼çš„ : ${ }"></a>1.1 jspè¡¨è¾¾å¼&lt;%= %&gt;ç›¸å½“äºELè¡¨è¾¾å¼çš„ : ${ }</h4><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--jspè¡¨è¾¾å¼ï¼šç”¨äºå°†ç¨‹åºçš„è¾“å‡ºï¼Œæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯</span><br><span class="line">    è¯­æ³•ï¼š&lt;%= å˜é‡æˆ–è€…å˜é“æ—¶%&gt;</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%= <span class="keyword">new</span> Date()%&gt; </span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-2-jspè„šæœ¬ç‰‡æ®µ"><a href="#1-2-jspè„šæœ¬ç‰‡æ®µ" class="headerlink" title="1.2 jspè„šæœ¬ç‰‡æ®µ"></a>1.2 jspè„šæœ¬ç‰‡æ®µ</h4><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--jspè„šæœ¬ç‰‡æ®µ--%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {</span><br><span class="line">        sum+=i;</span><br><span class="line">    }</span><br><span class="line">    out.print(<span class="string">"&lt;h2&gt; sum = "</span> + sum + <span class="string">"&lt;/h2&gt;"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--jspè„šæœ¬ç‰‡æ®µçš„å¤ç”¨åŸç†ï¼šåªè¦åœ¨åŒä¸€ä¸ªé¡µé¢ä¸Šçš„javaä»£ç å…¨éƒ¨éƒ½åœ¨åŒä¸€ä¸ªæ–¹æ³•é‡Œï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œç›¸äº’è°ƒç”¨--%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="comment">/*è¿™é‡Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢è„šæœ¬ç‰‡æ®µé‡Œé¢çš„æ•°æ®*/</span></span><br><span class="line">out.print(sum);</span><br><span class="line">%&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-3-åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ "><a href="#1-3-åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ " class="headerlink" title="1.3 åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ "></a>1.3 åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ </h4><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%--åµŒå…¥htmlå…ƒç´ --%&gt;</span><br><span class="line">&lt;h2&gt;hello jsp &lt;%= i%&gt;&lt;/h2&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    }</span><br><span class="line">%&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-4-jspçš„å£°æ˜-æ³¨æ„ï¼šè¯­æ³•æ ¼å¼ï¼š-lt-gt"><a href="#1-4-jspçš„å£°æ˜-æ³¨æ„ï¼šè¯­æ³•æ ¼å¼ï¼š-lt-gt" class="headerlink" title="1.4 jspçš„å£°æ˜(æ³¨æ„ï¼šè¯­æ³•æ ¼å¼ï¼š<%!       %>"></a>1.4 jspçš„å£°æ˜(æ³¨æ„ï¼šè¯­æ³•æ ¼å¼ï¼š&lt;%!       %&gt;</h4><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">function</span><span class="params">()</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"è¿™æ˜¯jspå£°æ˜è¯­æ³•ï¼Œä»»ä½•è„šæœ¬ç‰‡æ®µéƒ½å¯ä»¥è¿›è¡Œè°ƒç”¨"</span>);</span><br><span class="line">}</span><br><span class="line">%&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šjspçš„æ³¨é‡Šä¸ä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºï¼ŒHTMLçš„æ³¨é‡Šå¯ä»¥åœ¨æºä»£ç ä¸­è¿›è¡ŒæŸ¥çœ‹</p>
<h3 id="2-jspæŒ‡ä»¤"><a href="#2-jspæŒ‡ä»¤" class="headerlink" title="2.jspæŒ‡ä»¤"></a>2.jspæŒ‡ä»¤</h3><h4 id="2-1-å®šåˆ¶é”™è¯¯é¡µé¢è·³è½¬"><a href="#2-1-å®šåˆ¶é”™è¯¯é¡µé¢è·³è½¬" class="headerlink" title="2.1 å®šåˆ¶é”™è¯¯é¡µé¢è·³è½¬"></a>2.1 å®šåˆ¶é”™è¯¯é¡µé¢è·³è½¬</h4><p>æ–¹å¼ä¸€ï¼šç›´æ¥åœ¨é¡µé¢ä½¿ç”¨errorPageæŒ‡ä»¤è¿›è¡Œè‡ªå®šä¹‰</p>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--è‡ªå®šä¹‰é”™è¯¯é¡µé¢è·³è½¬--%&gt;</span><br><span class="line">&lt;%--&lt;%@ page errorPage=<span class="string">"error/500.jsp"</span> %&gt;--%&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>æ–¹å¼äºŒï¼šweb.xmlæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®(æ¨èä½¿ç”¨)</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ï¼š404é”™è¯¯é¡µé¢è·³è½¬--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/500.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2jspæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰"><a href="#2-2jspæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰" class="headerlink" title="2.2jspæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰"></a>2.2jspæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰</h4><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--jspæ ‡ç­¾ï¼š</span><br><span class="line">    jsp:include:è¿›è¡Œé¡µé¢çš„æ‹¼æ¥ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œä¸ä¸»é¡µé¢äº’ä¸å½±å“</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;jsp:include page=<span class="string">"${pageContext.request.contextPath}/error/500.jsp"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--jspæ ‡ç­¾ï¼š</span><br><span class="line">    jsp:forward:è¯·æ±‚è½¬å‘çš„ä½œç”¨ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œæºå¸¦æ•°æ®--%&gt;</span><br><span class="line">&lt;jsp:forward page=<span class="string">"jsp01.jsp"</span>&gt;</span><br><span class="line">    &lt;jsp:param name=<span class="string">"name"</span> value=<span class="string">"horse"</span>/&gt;</span><br><span class="line">    &lt;jsp:param name=<span class="string">"age"</span> value=<span class="string">"23"</span>/&gt;</span><br><span class="line">&lt;/jsp:forward&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-jspå¸¸ç”¨å†…ç½®å¯¹è±¡"><a href="#2-3-jspå¸¸ç”¨å†…ç½®å¯¹è±¡" class="headerlink" title="2.3 jspå¸¸ç”¨å†…ç½®å¯¹è±¡"></a>2.3 jspå¸¸ç”¨å†…ç½®å¯¹è±¡</h4><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--jspå†…ç½®å¯¹è±¡--%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    pageContext.setAttribute(<span class="string">"name1"</span>, <span class="string">"pageContext"</span>);  <span class="comment">//ä¿å­˜çš„æ•°æ®ï¼Œåªåœ¨è¿™ä¸ªé¡µé¢ä¸­æœ‰æ•ˆ</span></span><br><span class="line">    request.setAttribute(<span class="string">"name2"</span>, <span class="string">"request"</span>);  <span class="comment">//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œè¯·æ±‚ä¼šæºå¸¦è¿™ä¸ªæ•°æ®</span></span><br><span class="line">    session.setAttribute(<span class="string">"name3"</span>, <span class="string">"session"</span>);  <span class="comment">//ä¿å­˜çš„æ•°æ®åœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æµè§ˆå™¨åˆ°å…³é—­æµè§ˆå™¨</span></span><br><span class="line">    application.setAttribute(<span class="string">"name4"</span>, <span class="string">"application"</span>);  <span class="comment">//ä¿å­˜çš„æ•°æ®åœ¨æ•´ä¸ªæœåŠ¡å™¨è¿è¡ŒæœŸé—´æœ‰æ•ˆï¼Œä»æ‰“å¼€æœåŠ¡å™¨åˆ°å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    String name1 = (String) pageContext.getAttribute(<span class="string">"name1"</span>);</span><br><span class="line">    String name2 = (String) request.getAttribute(<span class="string">"name2"</span>);</span><br><span class="line">    String name3 = (String) session.getAttribute(<span class="string">"name3"</span>);</span><br><span class="line">    String name4 = (String) application.getAttribute(<span class="string">"name4"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;${name1}&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;${name2}&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;${name3}&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;${name4}&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>åŒºåˆ«ï¼š</p>
<p>request:å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å“åº”æ•°æ®ï¼Œå­˜åœ¨requestä¸­ï¼Œç”¨æˆ·çœ‹å®Œä¸€æ¬¡å°±æ²¡æœ‰äº†ï¼Œæ¯”å¦‚ï¼šæ–°é—»</p>
<p>sessionï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å“åº”æ•°æ®ï¼Œå­˜åœ¨sessionä¸­ï¼Œç”¨æˆ·çœ‹å®Œä¸€ä¼šè¿˜èƒ½ç”¨ï¼Œæ¯”å¦‚ï¼šè´­ç‰©è½¦</p>
<p>applicationï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å“åº”æ•°æ®ï¼Œå­˜åœ¨applicationä¸­ï¼Œä¸€ä¸ªç”¨æˆ·çœ‹å®Œäº†ï¼Œå…¶ä»–ç”¨æˆ·è¿˜èƒ½ç”¨ï¼Œæ¯”å¦‚ï¼šèŠå¤©æ•°æ®</p>
<h3 id="3-ELè¡¨è¾¾å¼"><a href="#3-ELè¡¨è¾¾å¼" class="headerlink" title="3.ELè¡¨è¾¾å¼"></a>3.ELè¡¨è¾¾å¼</h3><p>å¸¸ç”¨åŠŸèƒ½ï¼š</p>
<ul>
<li>è·å–æ•°æ® â€”&gt; ${ }</li>
<li>æ‰§è¡Œè¿ç®—</li>
<li>è·å–webå¼€å‘çš„å¸¸ç”¨å¯¹è±¡ â€”&gt;  <input type="text" name="username" value="${param.username}"></li>
<li><img src="../AppData/Roaming/Typora/typora-user-images/image-20200309211615272.png" alt="image-20200309211615272"></li>
</ul>
<h3 id="4-jstlæ ¸å¿ƒæ ‡ç­¾"><a href="#4-jstlæ ¸å¿ƒæ ‡ç­¾" class="headerlink" title="4.jstlæ ¸å¿ƒæ ‡ç­¾"></a>4.jstlæ ¸å¿ƒæ ‡ç­¾</h3><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--jstl--%&gt;</span><br><span class="line">&lt;form action=<span class="string">"index.jsp"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> value=<span class="string">"${param.username}"</span>/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--c:<span class="keyword">if</span>æ ‡ç­¾--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"${param.username == 'admin'}"</span> <span class="keyword">var</span>=<span class="string">"isAdmin"</span>&gt;</span><br><span class="line">    &lt;c:out value=<span class="string">"ä½ æ˜¯ç®¡ç†å‘˜"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line">&lt;%--c:outå¯ä»¥ä½¿ä¸€ä¸ªè‡ªé—­åˆæ ‡ç­¾--%&gt;</span><br><span class="line">&lt;c:out value=<span class="string">"${isAdmin}"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--c:setï¼šå®šä¹‰å˜é‡--%&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"score"</span> value=<span class="string">"100"</span>/&gt;\</span><br><span class="line">&lt;%--c:chooseç›¸å½“äºjavaä¸­çš„<span class="keyword">switch</span>--%&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"${score &gt;= 90}"</span>&gt;</span><br><span class="line">        &lt;c:out value=<span class="string">"ä¼˜ç§€"</span>/&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"${score &gt;= 80}"</span>&gt;</span><br><span class="line">        &lt;c:out value=<span class="string">"ä¸€èˆ¬"</span>/&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"${score &gt;= 70}"</span>&gt;</span><br><span class="line">        &lt;c:out value=<span class="string">"è‰¯å¥½"</span>/&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"${score &gt;= 60}"</span>&gt;</span><br><span class="line">        &lt;c:out value=<span class="string">"åŠæ ¼"</span>/&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--c:forEach:éå†æ•°æ®ï¼Œå‚æ•°ï¼šitems:è¦éå†çš„å¯¹è±¡ï¼Œ<span class="keyword">var</span>:æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„å˜é‡ --%&gt;</span><br><span class="line">&lt;c:forEach items=<span class="string">"${user}"</span> <span class="keyword">var</span>=<span class="string">"userList"</span>&gt;</span><br><span class="line">    &lt;c:out value=<span class="string">"${userList}"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="jstlæ ¼å¼æ ‡ç­¾-fmt"><a href="#jstlæ ¼å¼æ ‡ç­¾-fmt" class="headerlink" title="jstlæ ¼å¼æ ‡ç­¾(fmt)"></a>jstlæ ¼å¼æ ‡ç­¾(fmt)</h4><p>å…·ä½“ç”¨æ³•ï¼š</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;td&gt;&lt;fmt:formatDate value="${student.birthday}" pattern="yyyy-MM-dd"/&gt;&lt;/td&gt;</span><br><span class="line">&lt;td&gt;&lt;fmt:formatDate value="${student.grade}" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-JavaBeançš„å®šä¹‰ï¼š"><a href="#5-JavaBeançš„å®šä¹‰ï¼š" class="headerlink" title="5.JavaBeançš„å®šä¹‰ï¼š"></a>5.JavaBeançš„å®šä¹‰ï¼š</h3><ul>
<li>å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ </li>
<li>æ‰€æœ‰å±æ€§å¿…é¡»ç§æœ‰åŒ–</li>
<li>å¿…é¡»æœ‰å¯¹åº”çš„get/setæ–¹æ³•</li>
</ul>
<p>ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“çš„å­—æ®µåšæ˜ å°„</p>
<p><strong>ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„çš„å«ä¹‰</strong></p>
<h2 id="Springbootæ•´åˆ"><a href="#Springbootæ•´åˆ" class="headerlink" title="Springbootæ•´åˆ"></a>Springbootæ•´åˆ</h2><h3 id="1-springboot-shiroï¼ˆMD5åŠ å¯†ï¼‰"><a href="#1-springboot-shiroï¼ˆMD5åŠ å¯†ï¼‰" class="headerlink" title="1.springboot-shiroï¼ˆMD5åŠ å¯†ï¼‰"></a>1.springboot-shiroï¼ˆMD5åŠ å¯†ï¼‰</h3><h5 id="æ·»åŠ å¿…è¦ä¾èµ–"><a href="#æ·»åŠ å¿…è¦ä¾èµ–" class="headerlink" title="æ·»åŠ å¿…è¦ä¾èµ–"></a>æ·»åŠ å¿…è¦ä¾èµ–</h5><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--shiro--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--å¼•å…¥thymeleafå’Œshiroæ•´åˆçš„éƒ¨åˆ†ä¾èµ–--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--shiroæ•´åˆehcacheç¼“å­˜(å’Œå¯åŠ¨å™¨ä¸­çš„åŒåä¾èµ–ä¸ä¸€æ ·)--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="ç¼–å†™é…ç½®ç±»MyShiroConfig"><a href="#ç¼–å†™é…ç½®ç±»MyShiroConfig" class="headerlink" title="ç¼–å†™é…ç½®ç±»MyShiroConfig"></a>ç¼–å†™é…ç½®ç±»MyShiroConfig</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯†ç åŒ¹é…å‡­è¯ç®¡ç†å™¨ï¼ˆshiroçš„å†…ç½®MD5+saltç›å€¼åŠ å¯†ï¼‰</span></span><br><span class="line"><span class="comment">     * MD5ç®—æ³•ï¼šç®—æ³•ä¸å¯é€†ï¼Œå¦‚æœå†…å®¹ç›¸åŒï¼Œæ— è®ºåšå¤šå°‘æ¬¡MD5ç®—æ³•ç”Ÿæˆçš„ç»“æœå§‹ç»ˆä¸€è‡´ï¼Œå¤šç”¨äºåŠ å¯†å’Œç­¾åæ ¡éªŒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "hashedCredentialsMatcher")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span> </span>{</span><br><span class="line">        HashedCredentialsMatcher credentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">        <span class="comment">//æŒ‡å®šåŠ å¯†æ–¹å¼</span></span><br><span class="line">        credentialsMatcher.setHashAlgorithmName(<span class="string">"MD5"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®åŠ å¯†æ¬¡æ•°</span></span><br><span class="line">        credentialsMatcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®ç¼–ç æ–¹å¼ï¼štrue:hexç¼–ç ï¼Œfalse:base64ç¼–ç </span></span><br><span class="line">        credentialsMatcher.setStoredCredentialsHexEncoded(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> credentialsMatcher;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜ç®¡ç†å™¨ï¼ˆæœ€ç®€å•çš„ï¼Œå…¨éƒ¨æŒ‰ç…§é»˜è®¤é…ç½®ï¼Œæ²¡æœ‰åšè‡ªå®šä¹‰çš„ä¸€äº›ç¼“å­˜é€»è¾‘ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "ehCacheManager")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EhCacheManager <span class="title">ehCacheManager</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EhCacheManager();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè‡ªå®šä¹‰realm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashedCredentialsMatcher</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "myShiroRealm")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyShiroRealm <span class="title">myShiroRealm</span><span class="params">(<span class="meta">@Qualifier("hashedCredentialsMatcher")</span> HashedCredentialsMatcher hashedCredentialsMatcher,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@Qualifier("ehCacheManager")</span> EhCacheManager ehCacheManager)</span> </span>{</span><br><span class="line">        MyShiroRealm myShiroRealm = <span class="keyword">new</span> MyShiroRealm();</span><br><span class="line">        <span class="comment">//è®¾ç½®å¯†ç æ ¡éªŒåŒ¹é…å™¨</span></span><br><span class="line">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher);</span><br><span class="line">        <span class="comment">//å¼€å¯shiroçš„ç¼“å­˜ç®¡ç†:å¼€å¯ä¹‹åï¼Œå½“é¡µé¢é‡åˆ°æˆæƒçš„æ ¡éªŒæ—¶ï¼Œå°±ä¸ä¼šå†èµ°ä¸€éMyShiroRealmä¸­çš„æˆæƒæ–¹æ³•ï¼Œå¦åˆ™æ¯æ¬¡éƒ½è¦èµ°ï¼Œè€—è´¹èµ„æº</span></span><br><span class="line">        myShiroRealm.setCacheManager(ehCacheManager);</span><br><span class="line">        myShiroRealm.setCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//ä¸‹é¢çš„å†™ä¸å†™éƒ½è¡Œï¼ˆä¸»è¦ç”¨äºä¸shiro-ehcache.xmlé…ç½®æ–‡ä»¶æ­é…ï¼‰</span></span><br><span class="line">        myShiroRealm.setAuthenticationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        myShiroRealm.setAuthenticationCacheName(<span class="string">"authenticationCache"</span>);</span><br><span class="line">        myShiroRealm.setAuthorizationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">        myShiroRealm.setAuthorizationCacheName(<span class="string">"authorizationCache"</span>);</span><br><span class="line">        <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> myShiroRealm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = "defaultWebSecurityManager")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">defaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier("myShiroRealm")</span> MyShiroRealm myShiroRealm)</span> </span>{</span><br><span class="line">        DefaultWebSecurityManager defaultWebSecurityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">//ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®è‡ªå®šä¹‰realm</span></span><br><span class="line">        defaultWebSecurityManager.setRealm(myShiroRealm);</span><br><span class="line">        <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier("defaultWebSecurityManager")</span> DefaultWebSecurityManager defaultWebSecurityManager)</span> </span>{</span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è®¿é—®(åç»­ä¼šæ·»åŠ ...)</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/login"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/registered"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//å¼‚æ­¥è¯·æ±‚è·¯å¾„éªŒè¯</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/login/checkUser"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/login/checkPass"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/echarts"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//æƒé™æ§åˆ¶æ”¾è¡Œ</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/category"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/tags"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/comments"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/link"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//å¼‚æ­¥è¯·æ±‚å‘é€éªŒè¯ç </span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/code"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        <span class="comment">//ç®¡ç†å‘˜æƒé™é™å®šï¼ˆåç»­æ·»åŠ æ™®é€šç”¨æˆ·çš„æƒé™é™å®šï¼‰</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/category/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/tags/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/comments/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/link/**"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        <span class="comment">//é™åˆ¶ç³»ç»Ÿåº”ç”¨è®¿é—®</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/swagger"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/access"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/druid"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/user"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/excel"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/logExcel"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        filterMap.put(<span class="string">"/admin/logs"</span>, <span class="string">"perms[user:admin]"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æƒé™è®¤è¯è·¯å¾„</span></span><br><span class="line">        filterMap.put(<span class="string">"/admin/**"</span>, <span class="string">"authc"</span>);</span><br><span class="line">        bean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="comment">//ç™»å½•é¡µé¢è®¿é—®è·¯å¾„</span></span><br><span class="line">        bean.setLoginUrl(<span class="string">"/admin"</span>);</span><br><span class="line">        <span class="comment">//è®¿é—®å—é™ï¼šæœªæˆæƒè·³è½¬è·¯å¾„</span></span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">"/admin/unauthorized"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•´åˆShiroDialectï¼šé¿å…æ•´åˆthymeleafå’ŒshiroæŠ¥é”™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="ç¼–å†™è®¤è¯æˆæƒè§„åˆ™ç±»MyShiroRealm-å¿…é¡»ç»§æ‰¿AuthorizingRealmï¼Œå¹¶é‡å†™ç›¸åº”çš„æ–¹æ³•"><a href="#ç¼–å†™è®¤è¯æˆæƒè§„åˆ™ç±»MyShiroRealm-å¿…é¡»ç»§æ‰¿AuthorizingRealmï¼Œå¹¶é‡å†™ç›¸åº”çš„æ–¹æ³•" class="headerlink" title="ç¼–å†™è®¤è¯æˆæƒè§„åˆ™ç±»MyShiroRealm,å¿…é¡»ç»§æ‰¿AuthorizingRealmï¼Œå¹¶é‡å†™ç›¸åº”çš„æ–¹æ³•"></a>ç¼–å†™è®¤è¯æˆæƒè§„åˆ™ç±»MyShiroRealm,å¿…é¡»ç»§æ‰¿AuthorizingRealmï¼Œå¹¶é‡å†™ç›¸åº”çš„æ–¹æ³•</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•æˆæƒï¼ˆåç»­å¢åŠ æƒé™æ§åˆ¶ï¼‰</span></span><br><span class="line"><span class="comment">     * å½“ç”¨æˆ·è®¿é—®éœ€è¦æƒé™æ‰èƒ½è®¿é—®çš„è·¯å¾„æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¸ºç”¨æˆ·è®¾ç½®ç›¸å…³çš„æƒé™ï¼Œè‹¥æƒé™ä¸å¤Ÿï¼Œåˆ™è·³è½¬åˆ°401.htmlé¡µé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principals</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>{</span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰è®¤è¯ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆä»è®¤è¯å“ªé‡Œä¼ é€’è¿‡æ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼‰</span></span><br><span class="line">        User currentUser = (User) principals.getPrimaryPrincipal();</span><br><span class="line">        <span class="comment">//æˆäºˆå½“å‰ç”¨æˆ·(ç®¡ç†å‘˜)ç›¸å…³æƒé™[user:admin]</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>{</span><br><span class="line">        UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line">        User currentUser = userMapper.selectOne(<span class="keyword">new</span> QueryWrapper&lt;User&gt;().eq(<span class="string">"username"</span>, userToken.getUsername()));</span><br><span class="line">        <span class="comment">//è¿”å›null,shiroä¼šè‡ªåŠ¨å“åº”å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å½“å‰ç”¨æˆ·ä¿¡æ¯å­˜å…¥session(ç”¨äºå‰ç«¯è°ƒç”¨)</span></span><br><span class="line">        SecurityUtils.getSubject().getSession().setAttribute(<span class="string">"loginUser"</span>, currentUser);</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰ç›å€¼(å°†ç”¨æˆ·åä½œä¸ºç›å€¼)</span></span><br><span class="line">        ByteSource salt = ByteSource.Util.bytes(currentUser.getUsername());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * currentUser:å°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ç»™åé¢çš„æˆæƒæ“ä½œ</span></span><br><span class="line"><span class="comment">        * currentUser.getPassword():å¯†ç Shiroæ¡†æ¶è‡ªå·±è®¤è¯,ï¼ˆMyShiroConfigé…ç½®ç±»ä¸­è‡ªå®šä¹‰ä¼ å…¥MD5åŠ å¯†ï¼‰</span></span><br><span class="line"><span class="comment">        * salt:ä¼ å…¥è‡ªå®šä¹‰çš„ç›å€¼</span></span><br><span class="line"><span class="comment">        * this.getRealm():æ­¤è‡ªå®šä¹‰realmçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„æ„ä¹‰</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(currentUser, currentUser.getPassword(), salt, <span class="keyword">this</span>.getName());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨å†Œæ—¶ï¼šç”Ÿæˆå­˜å…¥æ•°æ®åº“çš„å¯†ç çš„å·¥å…·ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5ShiroUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆMD5å¯†ç ï¼šç”¨äºç™»å½•éªŒè¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username:ç”¨äºä½œä¸ºéšå³ç›salt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5Code</span><span class="params">(String username, String password)</span> </span>{</span><br><span class="line">        String hashAlgorithName = <span class="string">"MD5"</span>;</span><br><span class="line">        <span class="keyword">int</span> hashInteractions = <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleHash(hashAlgorithName,password, ByteSource.Util.bytes(username),hashInteractions).toHex();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h5 id="loginç™»å½•éªŒè¯"><a href="#loginç™»å½•éªŒè¯" class="headerlink" title="loginç™»å½•éªŒè¯"></a>loginç™»å½•éªŒè¯</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = "/login")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(<span class="meta">@RequestParam("username")</span> String username,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("password")</span> String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                       RedirectAttributes redirectAttributes, Model model,</span></span></span><br><span class="line"><span class="function"><span class="params">                       HttpServletRequest request)</span> </span>{</span><br><span class="line">       <span class="comment">/*è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯å¹¶å°è£…*/</span></span><br><span class="line">       UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line">       Subject subject = SecurityUtils.getSubject();</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           subject.login(token);</span><br><span class="line">           <span class="comment">//ç™»å½•åé¦–å…ˆè¿›è¡ŒéªŒè¯ç éªŒè¯</span></span><br><span class="line">           model.addAttribute(<span class="string">"image"</span>, avatar);</span><br><span class="line">           <span class="keyword">if</span> (!KaptchaUtils.checkVerifyCode(request)) {</span><br><span class="line">               redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"éªŒè¯ç é”™è¯¯"</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">           }</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"admin/index"</span>;</span><br><span class="line">       } <span class="keyword">catch</span> (UnknownAccountException e) { <span class="comment">//æ³¨æ„ï¼šä¸‹é¢å¦‚æœæ˜¯é‡å®šå‘ï¼Œè¿™é‡Œä¸é€‚ç”¨Modelï¼Œè€Œæ˜¯ä½¿ç”¨RedirectAttribute</span></span><br><span class="line">           redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"ç”¨æˆ·åä¸å­˜åœ¨"</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">       } <span class="keyword">catch</span> (IncorrectCredentialsException e) {</span><br><span class="line">           redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"å¯†ç é”™è¯¯"</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"redirect:/admin"</span>;</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>å°±æ­¤åŸºæœ¬ç®€å•é…ç½®æˆåŠŸâ€¦</p>
<h3 id="2-springboot-security-å‰åç«¯ä¸åˆ†ç¦»"><a href="#2-springboot-security-å‰åç«¯ä¸åˆ†ç¦»" class="headerlink" title="2. springboot-security(å‰åç«¯ä¸åˆ†ç¦»)"></a>2. springboot-security(å‰åç«¯ä¸åˆ†ç¦»)</h3><p>è®¾è®¡ç”¨æˆ·è§’è‰²æƒé™å…³ç³»è¡¨ï¼ˆæˆ‘è¿™é‡Œé»˜è®¤user 1&lt;â€”&gt;1è§’è‰²1&lt;â€”&gt;næƒé™permissionï¼‰ï¼Œä¸€å®šè¦å…ˆè®¾è®¡å¥½æ•°æ®è¡¨</p>
<h4 id="é¦–å…ˆï¼šå¼•å…¥pomä¾èµ–ï¼Œå¹¶é…ç½®å…·ä½“æ‰©å±•ç±»"><a href="#é¦–å…ˆï¼šå¼•å…¥pomä¾èµ–ï¼Œå¹¶é…ç½®å…·ä½“æ‰©å±•ç±»" class="headerlink" title="é¦–å…ˆï¼šå¼•å…¥pomä¾èµ–ï¼Œå¹¶é…ç½®å…·ä½“æ‰©å±•ç±»"></a>é¦–å…ˆï¼šå¼•å…¥pomä¾èµ–ï¼Œå¹¶é…ç½®å…·ä½“æ‰©å±•ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span>  <span class="comment">//å¼€å¯Securityè®¤è¯æœåŠ¡</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span>  <span class="comment">//å¼€å¯æ–¹æ³•çº§åˆ«çš„æƒé™è®¤è¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> myUserDetailsServiceImpl myUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šåŠ å¯†æ–¹å¼ï¼ˆå®˜æ–¹æ¨èï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰è§„åˆ™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> http</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        http.headers().frameOptions().sameOrigin();  <span class="comment">//è¡¨ç¤ºå…è®¸åŒæºè¯·æ±‚åŠ è½½iframe</span></span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                <span class="comment">//å…è®¸/login,/erroråŒ¿åè®¿é—®ï¼ŒåŒ…æ‹¬é™æ€èµ„æº</span></span><br><span class="line">                .antMatchers(<span class="string">"/my/**"</span>, <span class="string">"/treetable-lay/**"</span>, <span class="string">"/xadmin/**"</span>, <span class="string">"/ztree/**"</span>, <span class="string">"/login"</span>, <span class="string">"/authority"</span>).permitAll()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()<span class="comment">//å…¶ä»–è·¯å¾„è®¿é—®å‡éœ€éªŒè¯æƒé™</span></span><br><span class="line">                <span class="comment">//ç™»å½•å¤±è´¥è¿”å›æˆ–è€…æ²¡æœ‰æƒé™è·³è½¬åˆ°authority.htmlé¡µé¢		.formLogin().usernameParameter("username").passwordParameter("password").loginPage("/login")</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">"/index"</span>).failureUrl(<span class="string">"/authority"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                <span class="comment">//é€€å‡ºæˆåŠŸè¿”å›ç™»å½•é¡µé¢</span></span><br><span class="line">                .logout().logoutUrl(<span class="string">"/logout"</span>).permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();  <span class="comment">//å…³é—­csrfè·¨åŸŸ(ç›®å‰ä¸æ˜ç™½ä¸ºä»€ä¹ˆå…³é—­ï¼Ÿï¼Ÿï¼Ÿ)</span></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">//å¼•ç”¨ä¸Šé¢çš„bean--&gt;passwordEncoder</span></span><br><span class="line">        auth.userDetailsService(myUserDetailsService).passwordEncoder(passwordEncoder());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="è¿›è¡Œå…·ä½“çš„è®¤è¯æˆæƒä¸šåŠ¡é€»è¾‘"><a href="#è¿›è¡Œå…·ä½“çš„è®¤è¯æˆæƒä¸šåŠ¡é€»è¾‘" class="headerlink" title="è¿›è¡Œå…·ä½“çš„è®¤è¯æˆæƒä¸šåŠ¡é€»è¾‘"></a>è¿›è¡Œå…·ä½“çš„è®¤è¯æˆæƒä¸šåŠ¡é€»è¾‘</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myUserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserAndRoleMapper userAndRoleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionMapper permissionMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æˆæƒ</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼šæˆæƒçš„æ—¶å€™æ˜¯å¯¹è§’è‰²æˆæƒï¼Œè€Œè®¤è¯çš„æ—¶å€™åº”è¯¥åŸºäºèµ„æºï¼Œè€Œä¸æ˜¯è§’è‰²ï¼Œå› ä¸ºèµ„æºæ˜¯ä¸å˜çš„ï¼Œè€Œç”¨æˆ·çš„è§’è‰²æ˜¯ä¼šå˜çš„</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ï¼šç”¨æˆ·1&lt;--&gt;1è§’è‰²1&lt;--&gt;næƒé™(æŒ‰ç…§è‡ªå·±çš„æ•°æ®åº“è¿›è¡Œå®šä¹‰)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>{</span><br><span class="line">        User user = userService.getUserByUsername(username);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"ç”¨æˆ·ä¸å­˜åœ¨ï¼"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//èµ‹äºˆæƒé™</span></span><br><span class="line">        ArrayList&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        UserAndRole role = userAndRoleMapper.getRoleUserByUserId(user.getId());</span><br><span class="line">        List&lt;Permission&gt; permissionByRoleId = permissionMapper.getPermissionByRoleId(role.getRoleId());</span><br><span class="line">        <span class="keyword">for</span> (Permission permission : permissionByRoleId) {</span><br><span class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(permission.getPermission()));</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿”å›Userdetailsçš„å­ç±»å³å¯ï¼Œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ˆæ¨èï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> org.springframework.security.core.userdetails.User(user.getUsername(), user.getPassword(), authorities);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="ç®€å•çš„loginControlleræ§åˆ¶ç±»"><a href="#ç®€å•çš„loginControlleræ§åˆ¶ç±»" class="headerlink" title="ç®€å•çš„loginControlleræ§åˆ¶ç±»"></a>ç®€å•çš„loginControlleræ§åˆ¶ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = "/login")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = "/authority")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toError</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"authority"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = "/logout")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogout</span><span class="params">(HttpSession session)</span> </span>{</span><br><span class="line">        session.invalidate();  <span class="comment">//é€€å‡ºé”€æ¯session</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å½“è¿›è¡Œç”¨æˆ·æ·»åŠ çš„æ—¶å€™ï¼Œæ³¨æ„å¯†ç çš„åŠ å¯†æ–¹å¼è¦ä½¿ç”¨ï¼šBCryptPasswordEncoder"><a href="#å½“è¿›è¡Œç”¨æˆ·æ·»åŠ çš„æ—¶å€™ï¼Œæ³¨æ„å¯†ç çš„åŠ å¯†æ–¹å¼è¦ä½¿ç”¨ï¼šBCryptPasswordEncoder" class="headerlink" title="å½“è¿›è¡Œç”¨æˆ·æ·»åŠ çš„æ—¶å€™ï¼Œæ³¨æ„å¯†ç çš„åŠ å¯†æ–¹å¼è¦ä½¿ç”¨ï¼šBCryptPasswordEncoder"></a>å½“è¿›è¡Œç”¨æˆ·æ·»åŠ çš„æ—¶å€™ï¼Œæ³¨æ„å¯†ç çš„åŠ å¯†æ–¹å¼è¦ä½¿ç”¨ï¼šBCryptPasswordEncoder</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨äº†security,åŠ å¯†æ–¹å¼ä¸ºBCryptPasswordEncoder</span></span><br><span class="line">userAddDto.setPassword(<span class="keyword">new</span> BCryptPasswordEncoder().encode(userAddDto.getPassword().trim()));</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å‘ç‚¹ï¼š"><a href="#å‘ç‚¹ï¼š" class="headerlink" title="å‘ç‚¹ï¼š"></a>å‘ç‚¹ï¼š</h4><h5 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">      <span class="comment">//permission.getPermission()ç©¿çš„å€¼ä¸€å®šæ˜¯æ²¡æœ‰ç©ºæ ¼çš„éç©ºå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="keyword">for</span> (Permission permission : permissionByRoleId) {</span><br><span class="line">          authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(permission.getPermission()));</span><br><span class="line">      }</span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-ä¸ç®—å‘ç‚¹ï¼Œç®€å•çš„å»ºè®®"><a href="#2-ä¸ç®—å‘ç‚¹ï¼Œç®€å•çš„å»ºè®®" class="headerlink" title="2. ä¸ç®—å‘ç‚¹ï¼Œç®€å•çš„å»ºè®®"></a>2. ä¸ç®—å‘ç‚¹ï¼Œç®€å•çš„å»ºè®®</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›Userdetailsçš„å­ç±»Userå³å¯ï¼Œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ˆæ¨èï¼‰</span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> org.springframework.security.core.userdetails.User(user.getUsername(), user.getPassword(), authorities);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-sprongbootå®ç°æ–‡ä»¶ä¸Šä¼ ï¼ˆmarkdownçš„å›¾ç‰‡ä¸Šä¼ å°±åŸºäºæ­¤é…ç½®ï¼‰ï¼Œå¤ªä»–å¦ˆåƒåœ¾äº†â€¦"><a href="#3-sprongbootå®ç°æ–‡ä»¶ä¸Šä¼ ï¼ˆmarkdownçš„å›¾ç‰‡ä¸Šä¼ å°±åŸºäºæ­¤é…ç½®ï¼‰ï¼Œå¤ªä»–å¦ˆåƒåœ¾äº†â€¦" class="headerlink" title="3.sprongbootå®ç°æ–‡ä»¶ä¸Šä¼ ï¼ˆmarkdownçš„å›¾ç‰‡ä¸Šä¼ å°±åŸºäºæ­¤é…ç½®ï¼‰ï¼Œå¤ªä»–å¦ˆåƒåœ¾äº†â€¦"></a>3.sprongbootå®ç°æ–‡ä»¶ä¸Šä¼ ï¼ˆmarkdownçš„å›¾ç‰‡ä¸Šä¼ å°±åŸºäºæ­¤é…ç½®ï¼‰ï¼Œå¤ªä»–å¦ˆåƒåœ¾äº†â€¦</h3><h4 id="ä¸Šä¼ é¡µé¢file-html"><a href="#ä¸Šä¼ é¡µé¢file-html" class="headerlink" title="ä¸Šä¼ é¡µé¢file.html"></a>ä¸Šä¼ é¡µé¢file.html</h4><p><strong>æ³¨æ„ï¼šenctypeå¿…é¡»ä¸ºmultipart/form-dataï¼Œæäº¤æ–¹å¼å¿…é¡»ä¸ºpost</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">th:method</span>=<span class="string">"post"</span> <span class="attr">th:action</span>=<span class="string">"@{/file/upload}"</span>&gt;</span></span><br><span class="line">    æ–‡ä»¶:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Upload"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®ç°æ–‡ä»¶ä¸Šä¼ çš„çœŸæ­£ä¸šåŠ¡æ§åˆ¶"><a href="#å®ç°æ–‡ä»¶ä¸Šä¼ çš„çœŸæ­£ä¸šåŠ¡æ§åˆ¶" class="headerlink" title="å®ç°æ–‡ä»¶ä¸Šä¼ çš„çœŸæ­£ä¸šåŠ¡æ§åˆ¶"></a>å®ç°æ–‡ä»¶ä¸Šä¼ çš„çœŸæ­£ä¸šåŠ¡æ§åˆ¶</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping("/file")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileServiceImpl fileService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›¾ç‰‡çš„çœŸå®è·¯å¾„(æ­¤è·¯å¾„æœ€å¥½åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String FILEPATH = <span class="string">"D:/IEDA_data/springboot-web-upload/src/main/resources/static/FileUpload/"</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›¾ç‰‡çš„è®¿é—®è·¯å¾„ï¼ˆå·²ç»é…ç½®èµ„æºè·¯å¾„æ˜ å°„çš„è·¯å¾„ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String NEWFILEPATH = <span class="string">"http://localhost:8080/static/FileUpload/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping("/upload")</span></span><br><span class="line">    <span class="comment">//MultipartFileçš„å˜é‡åå¿…é¡»å’Œæ–‡ä»¶:&lt;input type="file" name="file"/&gt;ä¸­çš„nameç›¸åŒ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file, Model model)</span> </span>{</span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶åç¼€</span></span><br><span class="line">        <span class="comment">// file.getOriginalFilename()ï¼šè·å–æ–‡ä»¶çš„åŸåç§°</span></span><br><span class="line">        String suffixName = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        <span class="comment">// é‡æ–°ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼Œç”¨äºå­˜å‚¨æ•°æ®åº“</span></span><br><span class="line">        String newFileName = UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>) + suffixName;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç›®æ ‡æ–‡ä»¶æ–‡ä»¶</span></span><br><span class="line">        File dest = <span class="keyword">new</span> File(FILEPATH + newFileName);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//ä¸€æ­¥åˆ°ä½çš„ä¸Šä¼ æ–‡ä»¶æ“ä½œ</span></span><br><span class="line">            file.transferTo(dest);</span><br><span class="line">            <span class="comment">//modelåªæ˜¯ç”¨äºæµ‹è¯•å›æ˜¾</span></span><br><span class="line">            model.addAttribute(<span class="string">"imageURL"</span>, NEWFILEPATH + newFileName);</span><br><span class="line">            <span class="comment">//æµ‹è¯•ä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line">            fileService.saveImageURL(NEWFILEPATH + newFileName);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"image"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="æƒ³è¦å®ç°å›¾ç‰‡å›æ˜¾ï¼Œéœ€è¦è¿›è¡Œï¼šèµ„æºè·¯å¾„æ˜ å°„"><a href="#æƒ³è¦å®ç°å›¾ç‰‡å›æ˜¾ï¼Œéœ€è¦è¿›è¡Œï¼šèµ„æºè·¯å¾„æ˜ å°„" class="headerlink" title="æƒ³è¦å®ç°å›¾ç‰‡å›æ˜¾ï¼Œéœ€è¦è¿›è¡Œï¼šèµ„æºè·¯å¾„æ˜ å°„"></a>æƒ³è¦å®ç°å›¾ç‰‡å›æ˜¾ï¼Œéœ€è¦è¿›è¡Œï¼š<strong>èµ„æºè·¯å¾„æ˜ å°„</strong></h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">        <span class="comment">//æ³¨æ„ï¼šlocalhost:8080è¿™ä¸ªç«™ç‚¹è·¯å¾„éœ€è¦åŠ¨æ€çš„è·å–--&gt;FileUploadUtils</span></span><br><span class="line">        <span class="comment">//å½“æœåŠ¡å™¨åœ¨localhost:8080/static/FileUpload/**è·¯å¾„ä¸Šè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šåˆ°å®é™…å­˜å‚¨è·¯å¾„file:***å»å¯»æ‰¾èµ„æº(ä¸€èˆ¬å°å‹demoçš„çœŸæ˜¯å­˜å‚¨è·¯å¾„å°±åœ¨é¡¹ç›®ä¸­)</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">"/static/FileUpload/**"</span>)</span><br><span class="line">.addResourceLocations(<span class="string">"file:D:/IEDA_data/springboot-web-upload/src/main/resources/static/FileUpload/"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>åŠ¨æ€è·å–ç«™ç‚¹è·¯å¾„çš„å·¥å…·ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getImagePath</span><span class="params">(HttpServletRequest request)</span></span>{</span><br><span class="line">        String scheme = request.getScheme(); <span class="comment">// è·å–é“¾æ¥åè®®ï¼Œhttp</span></span><br><span class="line">        String serverName = request.getServerName(); <span class="comment">// è·å–æœåŠ¡å™¨åç§° localhost</span></span><br><span class="line">        <span class="keyword">int</span> serverPort = request.getServerPort(); <span class="comment">// è·å–ç«¯å£ 8080æˆ–è€…8081...</span></span><br><span class="line">        String path = scheme+<span class="string">"://"</span>+serverName+<span class="string">":"</span>+serverPort+<span class="string">"/"</span>;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„ç®€å•é…ç½®-ä¸Šä¼ æ–‡ä»¶å¤§å°"><a href="#å¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„ç®€å•é…ç½®-ä¸Šä¼ æ–‡ä»¶å¤§å°" class="headerlink" title="å¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„ç®€å•é…ç½®(ä¸Šä¼ æ–‡ä»¶å¤§å°)"></a>å¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„ç®€å•é…ç½®(ä¸Šä¼ æ–‡ä»¶å¤§å°)</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFileUploadConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MultipartConfigElement <span class="title">multipartConfigElement</span><span class="params">()</span> </span>{</span><br><span class="line">        MultipartConfigFactory factory = <span class="keyword">new</span> MultipartConfigFactory();</span><br><span class="line">        <span class="comment">//å•ä¸ªæ–‡ä»¶æœ€å¤§KB,MB</span></span><br><span class="line">        factory.setMaxFileSize(DataSize.parse(<span class="string">"10MB"</span>));</span><br><span class="line">        <span class="comment">//è®¾ç½®æ€»ä¸Šä¼ æ•°æ®æ€»å¤§å°</span></span><br><span class="line">        factory.setMaxRequestSize(DataSize.parse(<span class="string">"20MB"</span>));</span><br><span class="line">        <span class="keyword">return</span> factory.createMultipartConfig();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä»–çš„ç®€å•çš„æ•°æ®åº“å­˜å‚¨æ“ä½œï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨é¡¹ç›®ä¸­ç›´æ¥å°±è€ƒè™‘è®¾è®¡äº†ã€</p>
<h4 id="3-1-åŸºäºnginxåå‘ä»£ç†çš„å›¾ç‰‡ä¸Šä¼ "><a href="#3-1-åŸºäºnginxåå‘ä»£ç†çš„å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="3.1 åŸºäºnginxåå‘ä»£ç†çš„å›¾ç‰‡ä¸Šä¼ "></a>3.1 åŸºäº<code>nginx</code>åå‘ä»£ç†çš„å›¾ç‰‡ä¸Šä¼ </h4><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">upload:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">F:\springboot-springcloud-leyou\uploadImage\</span></span><br><span class="line">    <span class="attr">server_url:</span> <span class="string">http://image.leyou.com</span></span><br></pre></td></tr></tbody></table></figure>
<p>serviceå±‚çš„å…·ä½“å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadServiceImpl</span> <span class="keyword">implements</span> <span class="title">UploadService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; IMAGE_CATEGORIES = Arrays.asList(MimeTypeUtils.IMAGE_JPEG_VALUE,</span><br><span class="line">            MimeTypeUtils.IMAGE_PNG_VALUE, MimeTypeUtils.IMAGE_GIF_VALUE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${upload.image.path}")</span></span><br><span class="line">    <span class="keyword">private</span> String localPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${upload.image.server_url}")</span></span><br><span class="line">    <span class="keyword">private</span> String server_url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›¾ç‰‡ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadImage</span><span class="params">(MultipartFile file)</span> </span>{</span><br><span class="line">        <span class="comment">//æ ¡éªŒå›¾ç‰‡ç±»å‹(æ ¹æ®ContentTypeè¿›è¡Œæ ¡éªŒ)</span></span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">if</span> (!IMAGE_CATEGORIES.contains(file.getContentType())) {</span><br><span class="line">            LOGGER.error(<span class="string">"æ–‡ä»¶ç±»å‹ä¸åˆæ³•ï¼š{}"</span>, originalFilename);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//æ ¡éªŒå›¾ç‰‡å†…å®¹ï¼ˆé˜²æ­¢ä¼ªè£…æ–‡ä»¶æ¶æ„æ³¨å…¥ï¼‰</span></span><br><span class="line">            BufferedImage image = ImageIO.read(file.getInputStream());</span><br><span class="line">            <span class="keyword">if</span> (image == <span class="keyword">null</span>) {</span><br><span class="line">                LOGGER.error(<span class="string">"æ–‡ä»¶å†…å®¹ä¸åˆæ³•ï¼š{}"</span>, originalFilename);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ–‡ä»¶é‡å‘½åUUID</span></span><br><span class="line">            String suffix = StringUtils.substringAfterLast(originalFilename, <span class="string">"."</span>);</span><br><span class="line">            String newFileName = StringUtils.replace(UUID.randomUUID().toString(), <span class="string">"-"</span>, <span class="string">""</span>) + <span class="string">"."</span> + suffix;</span><br><span class="line">            <span class="comment">//å›¾ç‰‡ä¸Šä¼ åˆ°æœ¬åœ°æœåŠ¡å™¨å¹¶è¿”å›urlè¿›è¡Œå›æ˜¾</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> File(localPath + newFileName));</span><br><span class="line">            <span class="comment">//è¿™é‡Œçš„http://image.leyou.comä¼šè¢«nginxè½¬å‘åˆ°å­˜æ”¾å›¾ç‰‡çš„æœ¬åœ°è·¯å¾„ä¸Šå»ï¼ˆåæœŸä¼šç”¨fastDFSè¿›è¡Œå‡çº§ç»´æŠ¤ï¼‰</span></span><br><span class="line">            <span class="keyword">return</span> server_url + <span class="string">"/"</span> + newFileName;</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            LOGGER.error(<span class="string">"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ›´æ”¹hostæ–‡ä»¶ï¼š127.0.0.1    image.leyou.com </p>
</blockquote>
<p>nginxçš„åå‘ä»£ç†ï¼š</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200513225124697.png" alt="image-20200513225124697"></p>
<h4 id="3-2-åŸºäºfastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ å’Œå›æ˜¾"><a href="#3-2-åŸºäºfastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ å’Œå›æ˜¾" class="headerlink" title="3.2 åŸºäºfastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ å’Œå›æ˜¾"></a>3.2 åŸºäº<code>fastDFS</code>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ å’Œå›æ˜¾</h4><blockquote>
<p>fastDFSç¯å¢ƒå¾ˆéš¾æ­å»ºï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨Dockerä¸€é”®å®‰è£…å³å¯</p>
</blockquote>
<p>å¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--fastDFS--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.tobato<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.26.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>application.ymlçš„é…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">upload:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">server_url:</span> <span class="string">http://image.leyou.com/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#fastDFSçš„åŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="attr">fdfs:</span></span><br><span class="line">  <span class="attr">so-timeout:</span> <span class="number">1000</span> <span class="comment">#è¶…æ—¶æ—¶é—´</span></span><br><span class="line">  <span class="attr">connect-timeout:</span> <span class="number">1000</span> <span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">  <span class="attr">thumb-image:</span> <span class="comment">#ç¼©ç•¥å›¾çš„å¤§å°</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">60</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">tracker-list:</span>  <span class="comment">#trackerè¸ªè¿¹æœåŠ¡å™¨åœ°å€ï¼šä½ çš„æœåŠ¡å™¨IP+é»˜è®¤ç«¯å£22122</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.19</span><span class="number">.131</span><span class="string">:22122</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ·»åŠ æ‰©å±•ï¼ˆå®˜æ–¹è§„å®šçš„å›ºå®šæ‰©å±•ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/5/14 9:29</span></span><br><span class="line"><span class="comment"> * è§£å†³jmxé‡å¤æ³¨å†Œbeançš„é—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(FdfsClientConfig.class)</span></span><br><span class="line"><span class="meta">@EnableMBeanExport(registration = RegistrationPolicy.IGNORE_EXISTING)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastClientImporter</span> </span>{</span><br><span class="line">	<span class="comment">//é‡Œé¢ä»€ä¹ˆéƒ½ä¸ç”¨å†™ï¼Œä¸Šé¢çš„æ³¨è§£å·²ç»å®ç°ç±»æ‰©å±•é…ç½®</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯ä»¥å…ˆä½¿ç”¨æµ‹è¯•ç±»è¿›è¡Œä¸Šä¼ å›æ˜¾æµ‹è¯•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastFileStorageClient storageClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThumbImageConfig thumbImageConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›´æ¥ä¸Šä¼ å›¾ç‰‡åˆ°fastDFSå¹¶è¿”å›URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>{</span><br><span class="line">        <span class="comment">//æ‰¾ä¸€å¼ æœ¬åœ°å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"C:\\Users\\é©¬æ»¨\\Pictures\\WebBg\\th08.png"</span>);</span><br><span class="line">        <span class="comment">// ä¸Šä¼ å¹¶ä¿å­˜å›¾ç‰‡ï¼Œå‚æ•°ï¼š1-ä¸Šä¼ çš„æ–‡ä»¶æµ 2-æ–‡ä»¶çš„å¤§å° 3-æ–‡ä»¶çš„åç¼€ 4-å¯ä»¥ä¸ç®¡ä»–</span></span><br><span class="line">        StorePath storePath = <span class="keyword">this</span>.storageClient.uploadFile(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(file), file.length(), <span class="string">"png"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// å¸¦åˆ†ç»„çš„è·¯å¾„</span></span><br><span class="line">        System.out.println(storePath.getFullPath());</span><br><span class="line">        <span class="comment">// ä¸å¸¦åˆ†ç»„çš„è·¯å¾„</span></span><br><span class="line">        System.out.println(storePath.getPath());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ å›¾ç‰‡åˆ°fastDFSå¹¶ç”Ÿæˆç¼©ç•¥å›¾è¿”å›URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUploadAndCreateThumb</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>{</span><br><span class="line">        <span class="comment">//æ‰¾ä¸€å¼ æœ¬åœ°å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"C:\\Users\\é©¬æ»¨\\Pictures\\WebBg\\th08.png"</span>);</span><br><span class="line">        <span class="comment">// ä¸Šä¼ å¹¶ä¸”ç”Ÿæˆç¼©ç•¥å›¾</span></span><br><span class="line">        StorePath storePath = <span class="keyword">this</span>.storageClient.uploadImageAndCrtThumbImage(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(file), file.length(), <span class="string">"jpeg"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// å¸¦åˆ†ç»„çš„è·¯å¾„</span></span><br><span class="line">        System.out.println(storePath.getFullPath());</span><br><span class="line">        <span class="comment">// ä¸å¸¦åˆ†ç»„çš„è·¯å¾„</span></span><br><span class="line">        System.out.println(storePath.getPath());</span><br><span class="line">        <span class="comment">// è·å–ç¼©ç•¥å›¾è·¯å¾„</span></span><br><span class="line">        String path = thumbImageConfig.getThumbImagePath(storePath.getPath());</span><br><span class="line">        System.out.println(path);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä»¬å®é™…serviceå±‚çš„ä¸Šä¼ é€»è¾‘å’Œä¸€èˆ¬çš„æ–‡ä»¶ä¸Šä¼ ä¸€æ ·ï¼Œåªæ˜¯å­˜å‚¨çš„ä½ç½®ä¸åŒè€Œå·²</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadServiceImpl</span> <span class="keyword">implements</span> <span class="title">UploadService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; IMAGE_CATEGORIES = Arrays.asList(MimeTypeUtils.IMAGE_JPEG_VALUE,</span><br><span class="line">            MimeTypeUtils.IMAGE_PNG_VALUE, MimeTypeUtils.IMAGE_GIF_VALUE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${upload.image.server_url}")</span></span><br><span class="line">    <span class="keyword">private</span> String serverUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastFileStorageClient storageClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›¾ç‰‡ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadImage</span><span class="params">(MultipartFile file)</span> </span>{</span><br><span class="line">        <span class="comment">//æ ¡éªŒå›¾ç‰‡ç±»å‹(æ ¹æ®ContentTypeè¿›è¡Œæ ¡éªŒ)</span></span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">if</span> (!IMAGE_CATEGORIES.contains(file.getContentType())) {</span><br><span class="line">            LOGGER.error(<span class="string">"æ–‡ä»¶ç±»å‹ä¸åˆæ³•ï¼š{}"</span>, originalFilename);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//æ ¡éªŒå›¾ç‰‡å†…å®¹ï¼ˆé˜²æ­¢ä¼ªè£…æ–‡ä»¶æ¶æ„æ³¨å…¥ï¼‰</span></span><br><span class="line">            BufferedImage image = ImageIO.read(file.getInputStream());</span><br><span class="line">            <span class="keyword">if</span> (image == <span class="keyword">null</span>) {</span><br><span class="line">                LOGGER.error(<span class="string">"æ–‡ä»¶å†…å®¹ä¸åˆæ³•ï¼š{}"</span>, originalFilename);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ä¸Šä¼ åˆ°fastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­</span></span><br><span class="line">            String suffix = StringUtils.substringAfterLast(originalFilename, <span class="string">"."</span>);</span><br><span class="line">            <span class="comment">//è°ƒç”¨æ–‡ä»¶ä¸Šä¼ çš„æ–¹æ³•ï¼ˆäººå®¶å®¢æˆ·ç«¯é›†æˆå¥½çš„ï¼‰</span></span><br><span class="line">            StorePath storePath = storageClient.uploadFile(file.getInputStream(), file.getSize(), suffix, <span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">//ç»„è£…è®¿é—®è·¯å¾„</span></span><br><span class="line">            <span class="keyword">return</span> serverUrl + storePath.getFullPath();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            LOGGER.error(<span class="string">"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä»¬å·²ç»é…ç½®å¥½äº†ä¸Šé¢çš„hostæ–‡ä»¶è§£æå’Œnginxçš„åå‘ä»£ç†é…ç½®</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200514100853202.png" alt="image-20200514100853202"></p>
<p>åœ¨ç»è¿‡ç½‘å…³ä¹‹å‰å°±ä»£ç†åˆ°å›¾ç‰‡ä¸Šä¼ æœåŠ¡æ¨¡å—ï¼Œç„¶åä¼šè¿”å›ä¸€ä¸ªç»„è£…çš„å›¾ç‰‡è®¿é—®åœ°å€</p>
<p><a href="http://image.leyou.com/group1/â€¦">http://image.leyou.com/group1/â€¦</a>.</p>
<blockquote>
<p>æ›´æ”¹hostæ–‡ä»¶ï¼š192.168.149.131    image.leyou.com </p>
<p>é‚£ä¹ˆå°±å¯ä»¥è®¿é—®åˆ°è™šæ‹Ÿæœºä¸­çš„å›¾ç‰‡ä¿¡æ¯äº†â€¦</p>
</blockquote>
<h3 id="4-Interceptoræ‹¦æˆªå™¨æµ…æ"><a href="#4-Interceptoræ‹¦æˆªå™¨æµ…æ" class="headerlink" title="4.Interceptoræ‹¦æˆªå™¨æµ…æ"></a>4.<code>Interceptor</code>æ‹¦æˆªå™¨æµ…æ</h3><h4 id="springboot-2-x-éœ€è¦ç»§æ‰¿-WebMvcConfigurationSupportï¼Œå¹¶è¿›è¡Œé™æ€èµ„æºçš„æ‹¦æˆªæ”¾è¡Œå¤„ç†"><a href="#springboot-2-x-éœ€è¦ç»§æ‰¿-WebMvcConfigurationSupportï¼Œå¹¶è¿›è¡Œé™æ€èµ„æºçš„æ‹¦æˆªæ”¾è¡Œå¤„ç†" class="headerlink" title="springboot 2.x éœ€è¦ç»§æ‰¿ WebMvcConfigurationSupportï¼Œå¹¶è¿›è¡Œé™æ€èµ„æºçš„æ‹¦æˆªæ”¾è¡Œå¤„ç†"></a>springboot 2.x éœ€è¦ç»§æ‰¿ <strong>WebMvcConfigurationSupport</strong>ï¼Œå¹¶è¿›è¡Œé™æ€èµ„æºçš„æ‹¦æˆªæ”¾è¡Œå¤„ç†</h4><p>éœ€è¦é‡å†™ä¸¤ä¸ªæ–¹æ³• <strong>addInterceptors</strong> å’Œ <strong>addResourceHandlers</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptorConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨å…¥è‡ªå®šä¹‰æ‹¦æˆªå¤„ç†è§„åˆ™çš„bean</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyInterceptor myInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>{</span><br><span class="line">        <span class="comment">//æ‹¦æˆªæ‰€æœ‰è·¯å¾„è¯·æ±‚</span></span><br><span class="line">        registry.addInterceptor(myInterceptor).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">        <span class="comment">//æ”¾è¡Œé™æ€èµ„æºï¼ˆè·¯å¾„æ ¹æ®å…·ä½“æƒ…å†µï¼‰</span></span><br><span class="line">    registry.addResourceHandler(<span class="string">"/**"</span>).addResourceLocations(<span class="string">"classpath:/static/"</span>,<span class="string">"classpath:/public"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™çš„å®ç°ç±»"><a href="#è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™çš„å®ç°ç±»" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™çš„å®ç°ç±»"></a>è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™çš„å®ç°ç±»</h4><p>éœ€è¦ç»§æ‰¿æ¥å£ï¼š<strong>HandlerInterceptor</strong>ï¼Œå¹¶é‡å†™æœŸä¸­çš„3ä¸ªæ–¹æ³•ï¼Œä¸€èˆ¬éƒ½åªéœ€è¦æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹å‰çš„<strong>preHandle()</strong>,</p>
<p>å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå°±return trueï¼Œæ”¾è¡Œï¼Œå¦åˆ™å°±return false,ç›´æ¥æ‹¦æˆªä½ï¼Œä¸è¿›å…¥æ§åˆ¶å±‚çš„æ–¹æ³•ä¸­ã€‚</p>
<p><strong>å°çŸ¥è¯†ç‚¹ï¼šrequest.getRequestURL().toString().contains(â€œ/loginâ€); </strong>è¿™ç§æ–¹å¼å¯ä»¥è·å–è¯·æ±‚è·¯å¾„ï¼Œè¿›è¡Œå…¶ä»–æ“ä½œã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">//å¦‚æœå­˜åœ¨æŸä¸€ä¸ªcookieå’Œæ•°æ®åº“å¯¹åº”ï¼Œåˆ™å°†ä¿¡æ¯å­˜è¿›sessionä¸­</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="keyword">null</span> &amp;&amp; cookies.length != <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : cookies) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"token"</span>.equals(cookie.getName())) {</span><br><span class="line">                    String token = cookie.getValue();</span><br><span class="line">                    User user = userService.getUserByToken(token);</span><br><span class="line">                    <span class="keyword">if</span> (user != <span class="keyword">null</span>) {</span><br><span class="line">                        request.getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>ç®€å•çš„æ‹¦æˆªå™¨å°±é…ç½®å¥½äº†ã€‚</p>
<h3 id="5-springbootçš„mavençš„æµ‹è¯•ç±»æ­å»ºï¼ˆéœ€è¦è‡ªå·±æ‰‹åŠ¨æ­å»ºï¼Œä¸å°å¿ƒå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ï¼‰"><a href="#5-springbootçš„mavençš„æµ‹è¯•ç±»æ­å»ºï¼ˆéœ€è¦è‡ªå·±æ‰‹åŠ¨æ­å»ºï¼Œä¸å°å¿ƒå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ï¼‰" class="headerlink" title="5.springbootçš„mavençš„æµ‹è¯•ç±»æ­å»ºï¼ˆéœ€è¦è‡ªå·±æ‰‹åŠ¨æ­å»ºï¼Œä¸å°å¿ƒå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ï¼‰"></a>5.springbootçš„mavençš„æµ‹è¯•ç±»æ­å»ºï¼ˆéœ€è¦è‡ªå·±æ‰‹åŠ¨æ­å»ºï¼Œä¸å°å¿ƒå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ï¼‰</h3><h4 id="1-å¼•å…¥ä¾èµ–ï¼šspring-boot-starter-test"><a href="#1-å¼•å…¥ä¾èµ–ï¼šspring-boot-starter-test" class="headerlink" title="1.å¼•å…¥ä¾èµ–ï¼šspring-boot-starter-test"></a>1.å¼•å…¥ä¾èµ–ï¼š<strong>spring-boot-starter-test</strong></h4><h4 id="2-é‡è¦ï¼šæµ‹è¯•ç±»çš„åŒ…è·¯å¾„å¿…é¡»å’Œä¸»å¯åŠ¨ç±»çš„åŒ…è·¯å¾„ä¸€è‡´"><a href="#2-é‡è¦ï¼šæµ‹è¯•ç±»çš„åŒ…è·¯å¾„å¿…é¡»å’Œä¸»å¯åŠ¨ç±»çš„åŒ…è·¯å¾„ä¸€è‡´" class="headerlink" title="2.é‡è¦ï¼šæµ‹è¯•ç±»çš„åŒ…è·¯å¾„å¿…é¡»å’Œä¸»å¯åŠ¨ç±»çš„åŒ…è·¯å¾„ä¸€è‡´"></a><strong>2.é‡è¦ï¼šæµ‹è¯•ç±»çš„åŒ…è·¯å¾„å¿…é¡»å’Œä¸»å¯åŠ¨ç±»çš„åŒ…è·¯å¾„ä¸€è‡´</strong></h4><h4 id="3-æµ‹è¯•ç±»æ·»åŠ æ³¨è§£ï¼š-SpringbootTestå’Œ-RunWith-SpringRunner-class"><a href="#3-æµ‹è¯•ç±»æ·»åŠ æ³¨è§£ï¼š-SpringbootTestå’Œ-RunWith-SpringRunner-class" class="headerlink" title="3.æµ‹è¯•ç±»æ·»åŠ æ³¨è§£ï¼š**@SpringbootTestå’Œ@RunWith(SpringRunner.class)"></a>3.æµ‹è¯•ç±»æ·»åŠ æ³¨è§£ï¼š**@SpringbootTestå’Œ@RunWith(SpringRunner.class)</h4><p>è¿™æ ·æµ‹è¯•ç±»åŸºæœ¬èƒ½æ­£å¸¸å·¥ä½œâ€¦</p>
<h3 id="6-springbootæ•´åˆjspé¡µé¢æ¸²æŸ“å¼•æ“"><a href="#6-springbootæ•´åˆjspé¡µé¢æ¸²æŸ“å¼•æ“" class="headerlink" title="6.springbootæ•´åˆjspé¡µé¢æ¸²æŸ“å¼•æ“"></a>6.springbootæ•´åˆjspé¡µé¢æ¸²æŸ“å¼•æ“</h3><p>å¼•å…¥è§£æjspé¡µé¢çš„å¼•æ“ä¾èµ–(å…¶ä»–çš„ä¾èµ–éœ€è¦æ—¶å¯ä»¥è‡ªè¡Œå¼•å…¥)</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼•å…¥è§£æjspé¡µé¢çš„ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jstlæ ‡ç­¾--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨mainç›®å½•ä¸‹åˆ›å»ºwebappç›®å½•ä»¥åŠå…¶ä»–çš„å­ç›®å½•</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200617200752459.png" alt="webappç›®å½•"></p>
<p>é…ç½®æ¨¡æ¿æ¸²æŸ“çš„èµ„æºå¯»æ‰¾è·¯å¾„</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#åˆ‡æ¢è§†å›¾æ¸²æŸ“æ¨¡æ¿ä¸ºjsp</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">view:</span></span><br><span class="line">      <span class="attr">prefix:</span> <span class="string">/views</span></span><br><span class="line">      <span class="attr">suffix:</span> <span class="string">.jsp</span></span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨ideaä¸­è¿›è¡Œé…ç½®å¦ä¸€é¡¹é‡è¦çš„é…ç½®ï¼ˆå›ºå®šæ“ä½œ</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200617201117414.png" alt="æ•´åˆjspé¡µé¢"></p>
<p>è¿™æ ·è¿è¡Œé¡¹ç›®ï¼Œå³å¯è®¿é—®ç›¸åº”çš„jspé¡µé¢ï¼ï¼ï¼</p>
<h3 id="7-easyExcel"><a href="#7-easyExcel" class="headerlink" title="7.easyExcel"></a>7.easyExcel</h3><h4 id="POI"><a href="#POI" class="headerlink" title="POI"></a><code>POI</code></h4><p>å¯¼å…¥ä¾èµ–:æ ¹æ®excelçš„æ–‡ä»¶åç¼€ç±»å‹é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ä¾èµ–å³å¯ï¼ˆä¸€èˆ¬ä¸é€‚ç”¨è¿™ç§æ–¹å¼ï¼ŒeasyExcelæ›´å¥½ç”¨ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--03(xls)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--07(xlsx)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>åŸºæœ¬çš„API</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Workbook wordkbook =<span class="keyword">new</span> HSSFWorkbook();<span class="comment">//åˆ›å»ºä¸€ä¸ªWorkbookå¯¹è±¡</span></span><br><span class="line">wordkbook.createSheet();<span class="comment">//åˆ›å»ºè¡¨åï¼Œå¦‚æœä¸å†™å‚æ•°ï¼Œä¼šæœ‰é»˜è®¤å€¼</span></span><br><span class="line">Row row1=sheet.createRow(<span class="number">0</span>);<span class="comment">//æ ¹æ®é‡Œé¢çš„æ•°å­—æ‹¿åˆ°å¯¹åº”çš„è¡Œï¼Œ0é»˜è®¤ä¸ºç¬¬ä¸€è¡Œ</span></span><br><span class="line">Cell cell = row1.createCell(<span class="number">0</span>);<span class="comment">//æ ¹æ®è¡Œå¯¹è±¡åˆ›å»ºå•å…ƒæ ¼ï¼Œè¿™é‡Œ0ä¸ºç¬¬ä¸€ä¸ª</span></span><br><span class="line">cell.setCellValue(<span class="string">""</span>);<span class="comment">//å¯ä»¥ç»™å•å…ƒæ ¼èµ‹å€¼</span></span><br></pre></td></tr></tbody></table></figure>
<p>å†™å…¥æ•°æ®æµ‹è¯•æ¡ˆä¾‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH = <span class="string">"D:/IEDA_data/springboot-web-easyExcel/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrite03</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå·¥ä½œç°¿</span></span><br><span class="line">        Workbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è¡¨åçš„å·¥ä½œè¡¨</span></span><br><span class="line">        Sheet sheet = workbook.createSheet(<span class="string">"Horse Blog"</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè¡Œ</span></span><br><span class="line">        Row row = sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåˆ—(å•å…ƒæ ¼)</span></span><br><span class="line">        Cell cell = row.createCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//å†™å…¥æ•°æ®</span></span><br><span class="line">        cell.setCellValue(<span class="string">"ä»Šæ—¥è®¿é—®é‡"</span>);</span><br><span class="line">        Cell cell1 = row.createCell(<span class="number">1</span>);</span><br><span class="line">        cell1.setCellValue(<span class="string">"888"</span>);</span><br><span class="line"></span><br><span class="line">        Row row1 = sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        Cell cell2 = row1.createCell(<span class="number">0</span>);</span><br><span class="line">        cell2.setCellValue(<span class="string">"è®¿é—®æ—¶é—´"</span>);</span><br><span class="line">        Cell cell3 = row1.createCell(<span class="number">1</span>);</span><br><span class="line">        cell3.setCellValue(<span class="keyword">new</span> DateTime().toString(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¾“å‡ºæµè¿›è¡Œå†™æ•°æ®</span></span><br><span class="line">        FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(PATH + <span class="string">"access.xls"</span>));</span><br><span class="line">        workbook.write(outputStream);</span><br><span class="line">        outputStream.close();</span><br><span class="line">        System.out.println(<span class="string">"æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼ï¼ï¼"</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯03ç‰ˆæœ¬å’Œ07ç‰ˆæœ¬ä½¿ç”¨çš„APIçš„ä¸åŒ</strong>ï¼Œå…¶ä»–çš„éƒ½æ²¡æœ‰æ”¹å˜</p>
<p>POI03-HSSFWorkbook<br>POI07-XSSFWorkbook<br>SXSSF<br>HSSFï¼šExcel97-2003ç‰ˆæœ¬ï¼Œæ‰©å±•åä¸º.xlsã€‚ä¸€ä¸ªsheetæœ€å¤§è¡Œæ•°65536ï¼Œæœ€å¤§åˆ—æ•°256ã€‚</p>
<p>XSSFï¼šExcel2007ç‰ˆæœ¬å¼€å§‹ï¼Œæ‰©å±•åä¸º.xlsxã€‚ä¸€ä¸ªsheetæœ€å¤§è¡Œæ•°1048576ï¼Œæœ€å¤§åˆ—æ•°16384ã€‚</p>
<p>SXSSFï¼šæ˜¯åœ¨XSSFåŸºç¡€ä¸Šï¼ŒPOI3.8ç‰ˆæœ¬å¼€å§‹æä¾›çš„æ”¯æŒä½å†…å­˜å ç”¨çš„æ“ä½œæ–¹å¼ï¼Œæ‰©å±•åä¸º.xlsxã€‚</p>
<p>Excelç‰ˆæœ¬å…¼å®¹æ€§æ˜¯å‘ä¸‹å…¼å®¹ã€‚</p>
<blockquote>
<p>è·å–excelä¸­çš„æ•°æ®åŸç†ä¸€æ ·ï¼Œåªæ˜¯æ‰€æœ‰çš„setæ–¹æ³•å˜ä¸ºgetæ–¹æ³•è€Œå·²</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(PATH + <span class="string">"access07.xlsx"</span>);</span><br><span class="line">      Workbook workbook = <span class="keyword">new</span> XSSFWorkbook(inputStream);</span><br><span class="line">      Sheet sheet = workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">      Row row = sheet.getRow(<span class="number">0</span>);</span><br><span class="line">      Cell cell = row.getCell(<span class="number">0</span>);</span><br><span class="line">      String stringCellValue = cell.getStringCellValue();</span><br><span class="line">      System.out.println(stringCellValue + <span class="string">":"</span> + row.getCell(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">      inputStream.close();</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>åˆ¤æ–­æ•°æ®ç±»å‹å¹¶è¯»å–æ•°æ®ï¼ˆæœ€å¤æ‚çš„æ“ä½œ,ä½†æ˜¯å½¢å¼éƒ½æ˜¯å›ºå®šçš„ï¼Œä¸€èˆ¬å†™ä¸€æ¬¡å³å¯ï¼Œä¹Ÿå¯ä»¥æå–ä¸ºå·¥å…·ç±»ï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åˆ¤æ–­æ•°æ®ç±»å‹å¹¶è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRead07</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">       FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(PATH + <span class="string">"access07.xlsx"</span>);</span><br><span class="line">       Workbook workbook = <span class="keyword">new</span> XSSFWorkbook(inputStream);</span><br><span class="line">       Sheet sheet = workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">       <span class="comment">//è·å–ç¬¬ä¸€è¡Œçš„æ‰€æœ‰æ ‡é¢˜</span></span><br><span class="line">       Row rowTitle = sheet.getRow(<span class="number">0</span>);</span><br><span class="line">       <span class="keyword">if</span> (rowTitle != <span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">int</span> cellsCount = rowTitle.getPhysicalNumberOfCells();</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cellsCount; i++) {</span><br><span class="line">               Cell cell = rowTitle.getCell(i);</span><br><span class="line">               <span class="keyword">if</span> (cell != <span class="keyword">null</span>) {</span><br><span class="line">                   String cellValue = cell.getStringCellValue();</span><br><span class="line">                   System.out.print(cellValue + <span class="string">"|"</span>);</span><br><span class="line">               }</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">       System.out.println();</span><br><span class="line">       <span class="comment">//è·å–æ ‡é¢˜ä¸‹é¢çš„æ‰€æœ‰è¡Œçš„æ•°æ®ï¼ˆéœ€è¦åˆ¤æ–­ç±»å‹ï¼‰</span></span><br><span class="line">       <span class="keyword">int</span> rowsCount = sheet.getPhysicalNumberOfRows();</span><br><span class="line">       <span class="comment">//ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ‰€æœ‰ä¸º1</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> rowNum = <span class="number">1</span>; rowNum &lt; rowsCount; rowNum++) {</span><br><span class="line">           Row rowData = sheet.getRow(rowNum);</span><br><span class="line">           <span class="keyword">if</span> (rowData != <span class="keyword">null</span>) {</span><br><span class="line">               <span class="keyword">int</span> cellsCount = rowData.getPhysicalNumberOfCells();</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> cellNum = <span class="number">0</span>; cellNum &lt; cellsCount; cellNum++) {</span><br><span class="line">                   <span class="comment">//æµ‹è¯•å¯¹åº”åæ ‡æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">                   System.out.print(<span class="string">"["</span> + (rowNum + <span class="number">1</span>) + <span class="string">"-"</span> + (cellNum + <span class="number">1</span>) + <span class="string">"]"</span>);</span><br><span class="line">                   <span class="comment">//è¯»å–å¯¹åº”çš„å€¼</span></span><br><span class="line">                   Cell cell = rowData.getCell(cellNum);</span><br><span class="line">                   String cellValue = <span class="string">""</span>;</span><br><span class="line">                   <span class="keyword">if</span> (cell != <span class="keyword">null</span>) {</span><br><span class="line">                       <span class="comment">//ç±»å‹åŒ¹é…</span></span><br><span class="line">                       CellType cellTypeEnum = cell.getCellTypeEnum();</span><br><span class="line">                       <span class="keyword">switch</span> (cellTypeEnum) {</span><br><span class="line">                           <span class="keyword">case</span> STRING:</span><br><span class="line">                               cellValue = cell.getStringCellValue();</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                               cellValue = String.valueOf(cell.getBooleanCellValue());</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           <span class="comment">//æ•°å­—ï¼ˆæ—¥æœŸå’Œæ™®é€šæ•°å­—ï¼‰</span></span><br><span class="line">                           <span class="keyword">case</span> NUMERIC:</span><br><span class="line">                               <span class="comment">//åˆ¤æ–­æ˜¯å¦æ—¥æœŸå¹¶æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line">                               <span class="keyword">if</span> (DateUtil.isCellDateFormatted(cell)) {</span><br><span class="line">                                   cellValue = <span class="keyword">new</span> DateTime(cell.getDateCellValue()).toString(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">                               } <span class="keyword">else</span> {</span><br><span class="line">                                   <span class="comment">//DecimalFormat æ˜¯ NumberFormat çš„ä¸€ä¸ªå…·ä½“å­ç±»ï¼Œç”¨äºæ ¼å¼åŒ–åè¿›åˆ¶æ•°å­—ï¼ˆé˜²æ­¢æ•°å­—è¿‡å¤§è€Œå±•ç¤ºä¸ºç§‘å­¦è®¡æ•°æ³•çš„æ ·å¼ï¼‰</span></span><br><span class="line">                                   DecimalFormat decimalFormat = <span class="keyword">new</span> DecimalFormat(<span class="string">"#"</span>);</span><br><span class="line">                                   cellValue = decimalFormat.format(cell.getNumericCellValue());</span><br><span class="line">                               }</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> BLANK:</span><br><span class="line">                               System.out.println(<span class="string">"æ•°æ®ä¸ºç©º"</span>);</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> ERROR:</span><br><span class="line">                               System.out.println(<span class="string">"æ•°æ®ç±»å‹é”™è¯¯"</span>);</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">default</span>:</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                       }</span><br><span class="line">                       System.out.println(cellValue);</span><br><span class="line">                   }</span><br><span class="line">               }</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">       inputStream.close();</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="easyExcel"><a href="#easyExcel" class="headerlink" title="easyExcel"></a><code>easyExcel</code></h4><p>å¯¼å…¥ä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ³¨æ„å®ƒé‡Œé¢è‡ªå¸¦poiä¾èµ–ï¼Œæ‰€æœ‰ä¸éœ€è¦ä¸‹é¢çš„é‡å¤å¼•å…¥ï¼Œå¦‚æœé‡å¤å¸¦å…¥ä¼šæŠ¥ClassNotfound--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0-beta2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>å…ˆæ¥ä¸ªå®ä½“ç±»æ–¹ä¾¿æ’å…¥æµ‹è¯•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@TableName("tb_operational_log")</span></span><br><span class="line"><span class="meta">@ApiModel(value = "OperationalLogå¯¹è±¡", description = "æ“ä½œæ—¥å¿—ä¿¡æ¯")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationalLog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ—¥å¿—ID"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ—¥å¿—ID")</span></span><br><span class="line">    <span class="meta">@TableId(value = "id", type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œç±»å‹"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œç±»å‹")</span></span><br><span class="line">    <span class="keyword">private</span> String operType;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œæè¿°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œæè¿°")</span></span><br><span class="line">    <span class="keyword">private</span> String operDesc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œå‘˜ID"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œå‘˜ID")</span></span><br><span class="line">    <span class="keyword">private</span> String operUserId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œå‘˜åç§°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œå‘˜åç§°")</span></span><br><span class="line">    <span class="keyword">private</span> String operUserName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œæ–¹æ³•"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œæ–¹æ³•")</span></span><br><span class="line">    <span class="keyword">private</span> String operMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚å‚æ•°"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚å‚æ•°")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequParams;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚Body"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚Body")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequBody;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚IP"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚IP")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequIp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "è¯·æ±‚URL"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¯·æ±‚URL")</span></span><br><span class="line">    <span class="keyword">private</span> String operRequUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "æ“ä½œçŠ¶æ€"})</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ“ä½œçŠ¶æ€:1-æˆåŠŸ,0-å¤±è´¥")</span></span><br><span class="line">    <span class="meta">@TableField(value = "is_success")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "é€»è¾‘åˆ é™¤ 1-æœªåˆ é™¤ï¼Œ 0-åˆ é™¤")</span></span><br><span class="line">    <span class="meta">@TableField(value = "is_deleted")</span></span><br><span class="line">    <span class="meta">@TableLogic(value = "1", delval = "0")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean deleted;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty({"æ“ä½œæ—¥å¿—", "åˆ›å»ºæ—¶é—´"})</span></span><br><span class="line">    <span class="meta">@DateTimeFormat("yyyy-MM-dd HH:mm:ss")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å†™å…¥æµ‹è¯•<code>controller</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@OperatingLog(operType = BlogConstants.EXPORT, operDesc = "å¯¼å‡ºæ“ä½œæ—¥å¿—")</span></span><br><span class="line"><span class="meta">@ApiOperation("å¯¼å‡ºæ“ä½œæ—¥å¿—")</span></span><br><span class="line"><span class="meta">@ApiImplicitParam(name = "operational", value = "æ“ä½œæ—¥å¿—æ ‡è®°", type = "String", required = true)</span></span><br><span class="line"><span class="meta">@GetMapping("/oper/export/{operational}")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">operLogExport</span><span class="params">(<span class="meta">@PathVariable("operational")</span> String operational)</span> </span>{</span><br><span class="line">    operationalLogService.operLogExport(operational);</span><br><span class="line">    <span class="keyword">return</span> R.ok().message(<span class="string">"æ—¥å¿—å¯¼å‡ºæˆåŠŸ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å†™å…¥æµ‹è¯•<code>service</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¼å‡ºæ“ä½œæ—¥å¿—(å½“è¾¾åˆ°ç™¾ä¸‡çº§æ•°æ®é‡çš„æ—¶å€™,å°±è¦è€ƒè™‘å¯¼å‡ºæ•ˆç‡é—®é¢˜)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> operational</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operLogExport</span><span class="params">(String operational)</span> </span>{</span><br><span class="line">    List&lt;OperationalLog&gt; operationalLogs =             <span class="keyword">this</span>.list(newLambdaQueryWrapper&lt;OperationalLog().orderByDesc(OperationalLog::getGmtCreate));</span><br><span class="line">    <span class="comment">// æ–‡ä»¶æœ€ç»ˆè·¯å¾„:æ–‡ä»¶å¤¹è·¯å¾„+operational+å½“å‰ç³»ç»Ÿæ¯«ç§’æ•°+å½“å‰æ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">long</span> millis = System.currentTimeMillis();</span><br><span class="line">    String fileFinalPath = BlogConstants.EXPORT_FILE_PATH + operational + <span class="string">"_"</span> + millis + <span class="string">"_"</span> +</span><br><span class="line">            DateUtil.format(DateUtil.date(millis), <span class="string">"yyyy-MM-dd"</span>) + BlogConstants.EXCEL_FILE_SUFFIX;</span><br><span class="line">    EasyExcel.write(fileFinalPath, OperationalLog.class).sheet(<span class="string">"æ“ä½œä¿¡æ¯æ—¥å¿—"</span>).doWrite(operationalLogs);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>easyExcelçš„æ•°æ®è¯»å–æ“ä½œï¼šéœ€è¦ä¸€ä¸ªç›‘å¬å™¨</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æœ‰ä¸ªå¾ˆé‡è¦çš„ç‚¹ DemoDataListener ä¸èƒ½è¢«springç®¡ç†ï¼Œè¦æ¯æ¬¡è¯»å–exceléƒ½è¦new,ç„¶åé‡Œé¢ç”¨åˆ°springå¯ä»¥æ„é€ æ–¹æ³•ä¼ è¿›å»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoDataListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">DemoData</span>&gt; </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(DemoDataListener.class);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯éš”5æ¡å­˜å‚¨æ•°æ®åº“ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥3000æ¡ï¼Œç„¶åæ¸…ç†list ï¼Œæ–¹ä¾¿å†…å­˜å›æ”¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">5</span>;</span><br><span class="line">    List&lt;DemoData&gt; list = <span class="keyword">new</span> ArrayList&lt;DemoData&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡è®¾è¿™ä¸ªæ˜¯ä¸€ä¸ªDAOï¼Œå½“ç„¶æœ‰ä¸šåŠ¡é€»è¾‘è¿™ä¸ªä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªserviceã€‚å½“ç„¶å¦‚æœä¸ç”¨å­˜å‚¨è¿™ä¸ªå¯¹è±¡æ²¡ç”¨ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> DemoDAO demoDAO;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DemoDataListener</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯demoï¼Œæ‰€ä»¥éšä¾¿newä¸€ä¸ªã€‚å®é™…ä½¿ç”¨å¦‚æœåˆ°äº†spring,è¯·ä½¿ç”¨ä¸‹é¢çš„æœ‰å‚æ„é€ å‡½æ•°</span></span><br><span class="line">        demoDAO = <span class="keyword">new</span> DemoDAO();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœä½¿ç”¨äº†spring,è¯·ä½¿ç”¨è¿™ä¸ªæ„é€ æ–¹æ³•ã€‚æ¯æ¬¡åˆ›å»ºListenerçš„æ—¶å€™éœ€è¦æŠŠspringç®¡ç†çš„ç±»ä¼ è¿›æ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> demoDAO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DemoDataListener</span><span class="params">(DemoDAO demoDAO)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.demoDAO = demoDAO;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ¯ä¸€æ¡æ•°æ®è§£æéƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data    one row value. Is is same as {<span class="doctag">@link</span> AnalysisContext#readRowHolder()}</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> </span>{</span><br><span class="line">        LOGGER.info(<span class="string">"è§£æåˆ°ä¸€æ¡æ•°æ®:{}"</span>, JSON.toJSONString(data));</span><br><span class="line">        System.out.println(JSON.toJSONString(data));</span><br><span class="line">        list.add(data);</span><br><span class="line">        <span class="comment">// è¾¾åˆ°BATCH_COUNTäº†ï¼Œéœ€è¦å»å­˜å‚¨ä¸€æ¬¡æ•°æ®åº“ï¼Œé˜²æ­¢æ•°æ®å‡ ä¸‡æ¡æ•°æ®åœ¨å†…å­˜ï¼Œå®¹æ˜“OOM</span></span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt;= BATCH_COUNT) {</span><br><span class="line">            saveData();</span><br><span class="line">            <span class="comment">// å­˜å‚¨å®Œæˆæ¸…ç† list</span></span><br><span class="line">            list.clear();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰æ•°æ®è§£æå®Œæˆäº† éƒ½ä¼šæ¥è°ƒç”¨(ç›¸å½“äºAOPçš„æ–¹æ³•å¤„ç†æ•ˆæœ)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>{</span><br><span class="line">        <span class="comment">// è¿™é‡Œä¹Ÿè¦ä¿å­˜æ•°æ®ï¼Œç¡®ä¿æœ€åé—ç•™çš„æ•°æ®ä¹Ÿå­˜å‚¨åˆ°æ•°æ®åº“</span></span><br><span class="line">        saveData();</span><br><span class="line">        LOGGER.info(<span class="string">"æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ ä¸Šå­˜å‚¨æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveData</span><span class="params">()</span> </span>{</span><br><span class="line">        LOGGER.info(<span class="string">"{}æ¡æ•°æ®ï¼Œå¼€å§‹å­˜å‚¨æ•°æ®åº“ï¼"</span>, list.size());</span><br><span class="line">        demoDAO.save(list);</span><br><span class="line">        LOGGER.info(<span class="string">"å­˜å‚¨æ•°æ®åº“æˆåŠŸï¼"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç”¨äºæµ‹è¯•çš„å‡DAO</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡è®¾è¿™ä¸ªæ˜¯ä½ çš„DAOå­˜å‚¨ã€‚å½“ç„¶è¿˜è¦è¿™ä¸ªç±»è®©springç®¡ç†ï¼Œå½“ç„¶ä½ ä¸ç”¨éœ€è¦å­˜å‚¨ï¼Œä¹Ÿä¸éœ€è¦è¿™ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoDAO</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(List&lt;DemoData&gt; list)</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯mybatis,å°½é‡åˆ«ç›´æ¥è°ƒç”¨å¤šæ¬¡insert,è‡ªå·±å†™ä¸€ä¸ªmapperé‡Œé¢æ–°å¢ä¸€ä¸ªæ–¹æ³•batchInsert,æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§æ’å…¥</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¯»å–æµ‹è¯•(å¡«å…¥ç›¸åº”çš„å‚æ•°å³å¯)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">easyRead</span><span class="params">()</span> </span>{</span><br><span class="line">        String fileName = PATH + <span class="string">"easyTest.xlsx"</span>;</span><br><span class="line">        EasyExcel.read(fileName,DemoData.class,<span class="keyword">new</span> DemoDataListener()).sheet(<span class="string">"ç½‘ç«™è®¿é—®ä¿¡æ¯"</span>).doRead();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="8-springbootç»Ÿä¸€è¿”å›"><a href="#8-springbootç»Ÿä¸€è¿”å›" class="headerlink" title="8.springbootç»Ÿä¸€è¿”å›"></a>8.springbootç»Ÿä¸€è¿”å›</h3><blockquote>
<p>åˆ›å»ºè¿”å›ç»“æœæšä¸¾ç±»ResultCodeEnum</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/12/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResultCodeEnum</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŠ¶æ€ç å’Œå“åº”æ¶ˆæ¯æ ¹æ®ä¸šåŠ¡æ¥è¿›è¡Œå®šåˆ¶</span></span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="keyword">true</span>, <span class="number">20000</span>,<span class="string">"æˆåŠŸ"</span>),</span><br><span class="line">    UNKNOWN_REASON(<span class="keyword">false</span>, <span class="number">20001</span>, <span class="string">"æœªçŸ¥é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    BAD_SQL_GRAMMAR(<span class="keyword">false</span>, <span class="number">21001</span>, <span class="string">"sqlè¯­æ³•é”™è¯¯"</span>),</span><br><span class="line">    JSON_PARSE_ERROR(<span class="keyword">false</span>, <span class="number">21002</span>, <span class="string">"jsonè§£æå¼‚å¸¸"</span>),</span><br><span class="line">    PARAM_ERROR(<span class="keyword">false</span>, <span class="number">21003</span>, <span class="string">"å‚æ•°ä¸æ­£ç¡®"</span>),</span><br><span class="line"></span><br><span class="line">    FILE_UPLOAD_ERROR(<span class="keyword">false</span>, <span class="number">21004</span>, <span class="string">"æ–‡ä»¶ä¸Šä¼ é”™è¯¯"</span>),</span><br><span class="line">    FILE_DELETE_ERROR(<span class="keyword">false</span>, <span class="number">21005</span>, <span class="string">"æ–‡ä»¶åˆªé™¤é”™è¯¯"</span>),</span><br><span class="line">    EXCEL_DATA_IMPORT_ERROR(<span class="keyword">false</span>, <span class="number">21006</span>, <span class="string">"Excelæ•°æ®å¯¼å…¥é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    VIDEO_UPLOAD_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22001</span>, <span class="string">"è§†é¢‘ä¸Šä¼ è‡³é˜¿é‡Œäº‘å¤±è´¥"</span>),</span><br><span class="line">    VIDEO_UPLOAD_TOMCAT_ERROR(<span class="keyword">false</span>, <span class="number">22002</span>, <span class="string">"è§†é¢‘ä¸Šä¼ è‡³ä¸šåŠ¡æœåŠ¡å™¨å¤±è´¥"</span>),</span><br><span class="line">    VIDEO_DELETE_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22003</span>, <span class="string">"é˜¿é‡Œäº‘è§†é¢‘æ–‡ä»¶åˆ é™¤å¤±è´¥"</span>),</span><br><span class="line">    FETCH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22004</span>, <span class="string">"è·å–ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥"</span>),</span><br><span class="line">    REFRESH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22005</span>, <span class="string">"åˆ·æ–°ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥"</span>),</span><br><span class="line">    FETCH_PLAYAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22006</span>, <span class="string">"è·å–æ’­æ”¾å‡­è¯å¤±è´¥"</span>),</span><br><span class="line"></span><br><span class="line">    URL_ENCODE_ERROR(<span class="keyword">false</span>, <span class="number">23001</span>, <span class="string">"URLç¼–ç å¤±è´¥"</span>),</span><br><span class="line">    ILLEGAL_CALLBACK_REQUEST_ERROR(<span class="keyword">false</span>, <span class="number">23002</span>, <span class="string">"éæ³•å›è°ƒè¯·æ±‚"</span>),</span><br><span class="line">    FETCH_ACCESSTOKEN_FAILD(<span class="keyword">false</span>, <span class="number">23003</span>, <span class="string">"è·å–accessTokenå¤±è´¥"</span>),</span><br><span class="line">    FETCH_USERINFO_ERROR(<span class="keyword">false</span>, <span class="number">23004</span>, <span class="string">"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="keyword">false</span>, <span class="number">23005</span>, <span class="string">"ç™»å½•å¤±è´¥"</span>),</span><br><span class="line"></span><br><span class="line">    COMMENT_EMPTY(<span class="keyword">false</span>, <span class="number">24006</span>, <span class="string">"è¯„è®ºå†…å®¹å¿…é¡»å¡«å†™"</span>),</span><br><span class="line"></span><br><span class="line">    PAY_RUN(<span class="keyword">false</span>, <span class="number">25000</span>, <span class="string">"æ”¯ä»˜ä¸­"</span>),</span><br><span class="line">    PAY_UNIFIEDORDER_ERROR(<span class="keyword">false</span>, <span class="number">25001</span>, <span class="string">"ç»Ÿä¸€ä¸‹å•é”™è¯¯"</span>),</span><br><span class="line">    PAY_ORDERQUERY_ERROR(<span class="keyword">false</span>, <span class="number">25002</span>, <span class="string">"æŸ¥è¯¢æ”¯ä»˜ç»“æœé”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    ORDER_EXIST_ERROR(<span class="keyword">false</span>, <span class="number">25003</span>, <span class="string">"è¯¾ç¨‹å·²è´­ä¹°"</span>),</span><br><span class="line"></span><br><span class="line">    GATEWAY_ERROR(<span class="keyword">false</span>, <span class="number">26000</span>, <span class="string">"æœåŠ¡ä¸èƒ½è®¿é—®"</span>),</span><br><span class="line"></span><br><span class="line">    CODE_ERROR(<span class="keyword">false</span>, <span class="number">28000</span>, <span class="string">"éªŒè¯ç é”™è¯¯"</span>),</span><br><span class="line"></span><br><span class="line">    LOGIN_PHONE_ERROR(<span class="keyword">false</span>, <span class="number">28009</span>, <span class="string">"æ‰‹æœºå·ç ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_MOBILE_ERROR(<span class="keyword">false</span>, <span class="number">28001</span>, <span class="string">"è´¦å·ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_PASSWORD_ERROR(<span class="keyword">false</span>, <span class="number">28008</span>, <span class="string">"å¯†ç ä¸æ­£ç¡®"</span>),</span><br><span class="line">    LOGIN_DISABLED_ERROR(<span class="keyword">false</span>, <span class="number">28002</span>, <span class="string">"è¯¥ç”¨æˆ·å·²è¢«ç¦ç”¨"</span>),</span><br><span class="line">    REGISTER_MOBLE_ERROR(<span class="keyword">false</span>, <span class="number">28003</span>, <span class="string">"æ‰‹æœºå·å·²è¢«æ³¨å†Œ"</span>),</span><br><span class="line">    REQUEST_TOKEN_ERROR(<span class="keyword">false</span>, <span class="number">28008</span>, <span class="string">"è¯·æ±‚tokenå¤±è´¥"</span>),</span><br><span class="line">    LOGIN_AUTH(<span class="keyword">false</span>, <span class="number">28004</span>, <span class="string">"éœ€è¦ç™»å½•"</span>),</span><br><span class="line">    LOGIN_ACL(<span class="keyword">false</span>, <span class="number">28005</span>, <span class="string">"æ²¡æœ‰æƒé™"</span>),</span><br><span class="line">    SMS_SEND_ERROR(<span class="keyword">false</span>, <span class="number">28006</span>, <span class="string">"çŸ­ä¿¡å‘é€å¤±è´¥"</span>),</span><br><span class="line">    SMS_SEND_ERROR_BUSINESS_LIMIT_CONTROL(<span class="keyword">false</span>, <span class="number">28007</span>, <span class="string">"çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    ResultCodeEnum(Boolean success, Integer code, String message) {</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>åˆ›å»ºè¿”å›ç»“æœå®ä½“ç±»R.class</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = "å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœ")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "æ˜¯å¦æˆåŠŸ")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›ç ")</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›æ¶ˆæ¯")</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = "è¿”å›æ•°æ®")</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">R</span><span class="params">()</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆåŠŸ:æ— æ•°æ®è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Rå¯¹è±¡:å¯ä»¥é“¾å¼è°ƒç”¨æ­¤ç±»çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.SUCCESS.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.SUCCESS.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.SUCCESS.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”™è¯¯:æ— æ•°æ®è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Rå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.UNKNOWN_REASON.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.UNKNOWN_REASON.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.UNKNOWN_REASON.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆåŠŸ:å“åº”æšä¸¾ç±»è‡ªå®šä¹‰çš„çŠ¶æ€ç å’Œæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum  è‡ªå®šä¹‰æšä¸¾ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">setResult</span><span class="params">(ResultCodeEnum resultCodeEnum)</span></span>{</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(resultCodeEnum.getSuccess());</span><br><span class="line">        r.setCode(resultCodeEnum.getCode());</span><br><span class="line">        r.setMessage(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è¿”å›çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡è½½mapç±»å‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä½¿ç”¨å®ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Api("åå°ç®¡ç†è®²å¸ˆAPI")</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span>  <span class="comment">// å“åº”jsonç±»å‹æ•°æ®</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/edu/teacher")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("è·å–è®²å¸ˆåˆ—è¡¨")</span></span><br><span class="line">    <span class="meta">@GetMapping("/list")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">()</span> </span>{</span><br><span class="line">        List&lt;Teacher&gt; teachers = teacherService.list();</span><br><span class="line">        <span class="keyword">boolean</span> empty = CollectionUtils.isEmpty(teachers);</span><br><span class="line">        <span class="keyword">return</span> empty ? R.error().message(<span class="string">"èµ„æºæœªæ‰¾åˆ°"</span>) : R.ok().data(<span class="string">"items"</span>, teachers);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="9-springbootå¼‚å¸¸å¤„ç†-éœ€è¦å’Œç»Ÿä¸€å“åº”ç»“æœé›†åˆé…ç½®"><a href="#9-springbootå¼‚å¸¸å¤„ç†-éœ€è¦å’Œç»Ÿä¸€å“åº”ç»“æœé›†åˆé…ç½®" class="headerlink" title="9.springbootå¼‚å¸¸å¤„ç†(éœ€è¦å’Œç»Ÿä¸€å“åº”ç»“æœé›†åˆé…ç½®)"></a>9.springbootå¼‚å¸¸å¤„ç†(éœ€è¦å’Œç»Ÿä¸€å“åº”ç»“æœé›†åˆé…ç½®)</h3><blockquote>
<p>@RestControllerAdvice:æ­¤æ³¨è§£è¯´æ˜è¿™æ—¶ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†çš„ç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/7/30 15:30</span></span><br><span class="line"><span class="comment"> * åŸç†ï¼šå½“ç³»ç»Ÿæ•è·åˆ°å¼‚å¸¸æ—¶ï¼Œä¼šåŒ¹é…æœ€æ¥è¿‘çš„å¼‚å¸¸æ–¹æ³•BadSqlGrammarException.classï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±ç›´æ¥å®šä½åˆ°Exception.classçš„å¼‚å¸¸æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šç”¨å¼‚å¸¸å¤„ç†ï¼šåªè¦å‡ºç°å¼‚å¸¸ï¼Œæœ€ç»ˆåŒ¹é…çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(Exception e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.error();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç‰¹å®šå¼‚å¸¸å¤„ç†:sqlè¯­å¥é”™è¯¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BadSqlGrammarException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(BadSqlGrammarException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.BAD_SQL_GRAMMAR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç‰¹å®šå¼‚å¸¸å¤„ç†ï¼šjsonè§£æå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(HttpMessageNotReadableException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(HttpMessageNotReadableException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.JSON_PARSE_ERROR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚æ•°æ ¡éªŒå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(MethodArgumentNotValidException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼šæœ€æ–¹ä¾¿çµæ´»çš„ï¼ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ï¼šGuliException.classï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(GuliException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(GuliException e)</span> </span>{</span><br><span class="line">        log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        <span class="keyword">return</span> R.error().message(e.getMessage()).code(e.getCode());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç±»ï¼šGuliException.class</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuliException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7683466324584252019L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŠ¶æ€ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥å—çŠ¶æ€ç å’Œæ¶ˆæ¯ï¼Œå¹¶ä¸”R.error()é»˜è®¤çš„æ˜¯å¦æˆåŠŸçš„ç»“æœä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GuliException</span><span class="params">(Integer code, String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code=code;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GuliException</span><span class="params">(ResultCodeEnum resultCodeEnum)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">this</span>.code = resultCodeEnum.getCode();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™toStringæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"GuliException{"</span> +</span><br><span class="line">                <span class="string">"code="</span> + code +</span><br><span class="line">                <span class="string">"message="</span> + <span class="keyword">this</span>.getMessage() +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ•´ä½“é…ç½®ä¼˜åŒ–ï¼šè‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ä¿¡æ¯å·¥å…·ç±»ExceptionUtilsï¼šç”¨äºæ‰“å°é”™è¯¯è·Ÿè¸ªæ ˆä¿¡æ¯åˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶ä¸­</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/9/25</span></span><br><span class="line"><span class="comment"> * ç”¨äºæ‰“å°é”™è¯¯è·Ÿè¸ªæ ˆä¿¡æ¯åˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMessage</span><span class="params">(Exception e)</span> </span>{</span><br><span class="line">        StringWriter sw = <span class="keyword">null</span>;</span><br><span class="line">        PrintWriter pw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line">            pw = <span class="keyword">new</span> PrintWriter(sw);</span><br><span class="line">            <span class="comment">// å°†å‡ºé”™çš„æ ˆä¿¡æ¯è¾“å‡ºåˆ°printWriterä¸­</span></span><br><span class="line">            e.printStackTrace(pw);</span><br><span class="line">            pw.flush();</span><br><span class="line">            sw.flush();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">if</span> (sw != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    sw.close();</span><br><span class="line">                } <span class="keyword">catch</span> (IOException e1) {</span><br><span class="line">                    e1.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (pw != <span class="keyword">null</span>) {</span><br><span class="line">                pw.close();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> sw.toString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä½¿ç”¨å®ä¾‹ï¼šé‡Œé¢throwå‡ºè‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsServiceImpl</span> <span class="keyword">implements</span> <span class="title">SmsService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SendSmsUtils sendSmsUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SmsProperties smsProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€çŸ­ä¿¡éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendVerifyCode</span><span class="params">(String mobile)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(mobile) || !RegularMatchUtils.isMobile(mobile)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ6ä½éªŒè¯ç </span></span><br><span class="line">        String code = RandomUtils.generateCode(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è°ƒç”¨çŸ­ä¿¡å‘é€ä¸šåŠ¡å·¥å…·</span></span><br><span class="line">            JSONObject object = <span class="keyword">new</span> JSONObject();</span><br><span class="line">            object.put(<span class="string">"code"</span>, code);</span><br><span class="line">            sendSmsUtils.sendSms(mobile, object.toString(), smsProperties.getSignName(), smsProperties.getTemplateCode());</span><br><span class="line">            <span class="comment">// éªŒè¯ç å­˜å…¥redis:è®¾ç½®5åˆ†é’Ÿåè¿‡æœŸ</span></span><br><span class="line">            redisTemplate.opsForValue().set(mobile, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="comment">// æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œå“åº”ä¿¡æ¯æ›´åŠ æ˜ç¡®ï¼Œé”™è¯¯ä½ç½®æ›´åŠ æ˜æœ—ï¼ï¼ï¼</span></span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="comment">// é‡Œé¢ä¹Ÿå¯ä»¥æ¥æ”¶ç»Ÿä¸€ç»“æœæšä¸¾ç±»</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.SMS_SEND_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="10-SpringAop-Redisåˆ†å¸ƒå¼é”ï¼ˆé˜²é‡å¤æäº¤ï¼‰"><a href="#10-SpringAop-Redisåˆ†å¸ƒå¼é”ï¼ˆé˜²é‡å¤æäº¤ï¼‰" class="headerlink" title="10.SpringAop+Redisåˆ†å¸ƒå¼é”ï¼ˆé˜²é‡å¤æäº¤ï¼‰"></a>10.SpringAop+Redisåˆ†å¸ƒå¼é”ï¼ˆé˜²é‡å¤æäº¤ï¼‰</h3><h4 id="åˆ›å»ºæ³¨è§£"><a href="#åˆ›å»ºæ³¨è§£" class="headerlink" title="åˆ›å»ºæ³¨è§£"></a>åˆ›å»ºæ³¨è§£</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/9/27 15:10</span></span><br><span class="line"><span class="comment"> * ä¸é‡å¤æäº¤(é›†åˆredisåˆ†å¸ƒå¼é”)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NoRepeatSubmit {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è¯·æ±‚é”å®šæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lockTime</span><span class="params">()</span> <span class="keyword">default</span> 10</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="åˆ›å»ºåŠ é”-è§£é”å·¥å…·ç±»"><a href="#åˆ›å»ºåŠ é”-è§£é”å·¥å…·ç±»" class="headerlink" title="åˆ›å»ºåŠ é”/è§£é”å·¥å…·ç±»"></a>åˆ›å»ºåŠ é”/è§£é”å·¥å…·ç±»</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/9/27 15:51</span></span><br><span class="line"><span class="comment"> * åˆ†å¸ƒå¼é”å·¥å…·ç±»(ä¸æ˜¯æœ€å¥½çš„åŠ é”/è§£é”æ–¹å¼)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisLockUtils</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *åŠ é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockKey   åŠ é”é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clientId  åŠ é”å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†(é‡‡ç”¨UUID)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expireTime   é”è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(String lockKey, String clientId, <span class="keyword">long</span> expireTime)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().setIfAbsent(lockKey, clientId, expireTime, TimeUnit.SECONDS);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clientId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unLock</span><span class="params">(String lockKey, String clientId)</span> </span>{</span><br><span class="line">        String currentValue = redisTemplate.opsForValue().get(lockKey);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(currentValue) &amp;&amp; StringUtils.equals(clientId, currentValue)) {</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForValue().getOperations().delete(lockKey);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ç¼–å†™SpringAopç¯ç»•é€šçŸ¥"><a href="#ç¼–å†™SpringAopç¯ç»•é€šçŸ¥" class="headerlink" title="ç¼–å†™SpringAopç¯ç»•é€šçŸ¥"></a>ç¼–å†™SpringAopç¯ç»•é€šçŸ¥</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepeatSubmitAspect</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisLockUtils redisLockUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut("@annotation(noRepeatSubmit)")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">repeatSubmit</span><span class="params">(NoRepeatSubmit noRepeatSubmit)</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(value = "repeatSubmit(noRepeatSubmit)", argNames = "joinPoint,noRepeatSubmit")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">noRepeatSubmit</span><span class="params">(ProceedingJoinPoint joinPoint, NoRepeatSubmit noRepeatSubmit)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        <span class="comment">// è·å–é»˜è®¤é”å®šè¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="keyword">int</span> lockTime = noRepeatSubmit.lockTime();</span><br><span class="line">        <span class="comment">// è·å–è®¾ç½®é”çš„å¿…è¦å‚æ•°</span></span><br><span class="line">        ServletRequestAttributes r = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = r.getRequest();</span><br><span class="line">        <span class="comment">// è·å–token</span></span><br><span class="line">        String token = request.getHeader(BlogConstants.TOKEN);</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚çš„å…¨æ–¹æ³•å</span></span><br><span class="line">        String className = joinPoint.getTarget().getClass().getName();</span><br><span class="line">        MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        String fullMethodName = className + <span class="string">"."</span> + methodName;</span><br><span class="line">        <span class="comment">// è®¾ç½®key</span></span><br><span class="line">        String key = token + <span class="string">"_"</span> + fullMethodName;</span><br><span class="line">        String clientId = IdUtil.fastSimpleUUID();</span><br><span class="line">        <span class="comment">// å¼€å§‹åŠ é”</span></span><br><span class="line">        <span class="keyword">boolean</span> tryLock = redisLockUtils.tryLock(key, clientId, lockTime);</span><br><span class="line">        <span class="keyword">if</span> (tryLock) {</span><br><span class="line">            log.info(<span class="string">"tryLock success, key = {},clientId = {}"</span>, key, clientId);</span><br><span class="line">            Object result;</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                result = joinPoint.proceed();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                <span class="comment">// æœ€ç»ˆæ‰§è¡Œ:è§£é”</span></span><br><span class="line">                redisLockUtils.unLock(key, clientId);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            log.info(<span class="string">"tryLock fail, key = {}"</span>, key);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.REQUEST_ALREADY_SUBMIT);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="congtrollerå±‚æ·»åŠ æ³¨è§£ç¤ºä¾‹-ä¸€èˆ¬åªæ·»åŠ åœ¨postè¯·æ±‚æ¥å£ä¸Šé¢"><a href="#congtrollerå±‚æ·»åŠ æ³¨è§£ç¤ºä¾‹-ä¸€èˆ¬åªæ·»åŠ åœ¨postè¯·æ±‚æ¥å£ä¸Šé¢" class="headerlink" title="congtrollerå±‚æ·»åŠ æ³¨è§£ç¤ºä¾‹(ä¸€èˆ¬åªæ·»åŠ åœ¨postè¯·æ±‚æ¥å£ä¸Šé¢)"></a>congtrollerå±‚æ·»åŠ æ³¨è§£ç¤ºä¾‹(ä¸€èˆ¬åªæ·»åŠ åœ¨postè¯·æ±‚æ¥å£ä¸Šé¢)</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@NoRepeatSubmit</span></span><br><span class="line"><span class="meta">@OperatingLog(operType = BlogConstants.ADD,operDesc = "æ–°å¢åšå®¢")</span></span><br><span class="line"><span class="meta">@ApiOperation(value = "ä¿å­˜åšå®¢", notes = "ä¿å­˜åšå®¢,å¢åŠ ç”¨æˆ·ç§¯åˆ†")</span></span><br><span class="line"><span class="meta">@PostMapping("/save")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">saveBlog</span><span class="params">(<span class="meta">@RequestBody</span> BlogInfoVO blogInfoVO, HttpServletRequest request)</span> </span>{</span><br><span class="line">    blogService.saveBlog(blogInfoVO, request);</span><br><span class="line">    <span class="keyword">return</span> R.ok().message(<span class="string">"ä¿å­˜æˆåŠŸ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="11-Springboot-security-Jsonç‰ˆ"><a href="#11-Springboot-security-Jsonç‰ˆ" class="headerlink" title="11.Springboot-security(Jsonç‰ˆ)"></a>11.Springboot-security(Jsonç‰ˆ)</h3><h4 id="1-åˆ›å»ºå®ä½“ç±»User"><a href="#1-åˆ›å»ºå®ä½“ç±»User" class="headerlink" title="1. åˆ›å»ºå®ä½“ç±»User"></a>1. åˆ›å»ºå®ä½“ç±»User</h4><blockquote>
<p>å®ä½“ç±»Userç»§æ‰¿UserDetails</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.security.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-10-04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableName("tb_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">UserDetails</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId(value = "id", type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è´¦æˆ·æ˜¯å¦å¯ç”¨ï¼šé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è´¦æˆ·æ˜¯å¦é”å®šï¼šé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean locked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§’è‰²é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String id, String username, String password, Boolean enable, Boolean locked, List&lt;Role&gt; roles)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">        <span class="keyword">this</span>.enable = enable;</span><br><span class="line">        <span class="keyword">this</span>.locked = locked;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getEnabled</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> enable;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(Boolean enabled)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.enable = enabled;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getLocked</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> locked;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocked</span><span class="params">(Boolean locked)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.locked = locked;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">getRoles</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;Role&gt; roles)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User{"</span> +</span><br><span class="line">                <span class="string">"id='"</span> + id + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", enable="</span> + enable +</span><br><span class="line">                <span class="string">", locked="</span> + locked +</span><br><span class="line">                <span class="string">", roles="</span> + roles +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è·å–å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰è´¦æˆ·æ˜¯å¦æœªè¿‡æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰è´¦æˆ·æ˜¯å¦æœªé”å®š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> locked;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰è´¦æˆ·å¯†ç æ˜¯å¦æœªè¿‡æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰è´¦æˆ·æ˜¯å¦å¯ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> enable;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) {</span><br><span class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(role.getRoleDescription()));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è·å–å½“å‰ç”¨æˆ·çš„å¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-åˆ›å»ºUserDetailsServiceImpl"><a href="#2-åˆ›å»ºUserDetailsServiceImpl" class="headerlink" title="2.åˆ›å»ºUserDetailsServiceImpl"></a>2.åˆ›å»ºUserDetailsServiceImpl</h4><blockquote>
<p>UserDetailsServiceImplç»§æ‰¿UserDetailsService</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.security.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.entity.Role;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.entity.UserRoleRelation;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.service.UserRoleRelationService;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/4 17:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleRelationService userRoleRelationService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è´¦æˆ·ååˆ¤æ–­è¯¥è´¦æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨æ‰è¿›è¡Œç”¨æˆ·è§’è‰²ä¿¡æ¯çš„æŸ¥æ‰¾ï¼Œ</span></span><br><span class="line"><span class="comment">     *                 ç„¶åæ‰æœ‰DaoAuthenticationProvideræ ¡éªŒå¯†ç ,æ ¹æ®æ ¡éªŒäº§ç”Ÿçš„å¼‚å¸¸ä¿¡æ¯å“åº”æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>{</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        User currentUser = userService.getOne(<span class="keyword">new</span> QueryWrapper&lt;User&gt;().lambda().eq(User::getUsername, username));</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(currentUser)) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"è¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è®¾ç½®roles</span></span><br><span class="line">        List&lt;String&gt; roleIds = userRoleRelationService.list(<span class="keyword">new</span> QueryWrapper&lt;UserRoleRelation&gt;().lambda().eq(UserRoleRelation::getUserId, currentUser.getId()))</span><br><span class="line">                .stream().map(UserRoleRelation::getRoleId).collect(Collectors.toList());</span><br><span class="line">        currentUser.setRoles(roleService.list(<span class="keyword">new</span> QueryWrapper&lt;Role&gt;().lambda().in(Role::getId, roleIds)));</span><br><span class="line">        <span class="comment">// è¿”å›ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> currentUser;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-åˆ›å»ºWebSecurityConfig"><a href="#3-åˆ›å»ºWebSecurityConfig" class="headerlink" title="3.åˆ›å»ºWebSecurityConfig"></a>3.åˆ›å»ºWebSecurityConfig</h4><blockquote>
<p>WebSecurityConfigç»§æ‰¿WebSecurityConfigurerAdapter</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.security.service.impl.UserDetailsServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationFailureHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationSuccessHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.logout.LogoutSuccessHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/4 16:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsServiceImpl userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        auth.userDetailsService(userDetailsService) <span class="comment">// é…ç½®è®¤è¯æ–¹å¼å’ŒåŠ å¯†æ–¹å¼</span></span><br><span class="line">                .passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        http.authorizeRequests() </span><br><span class="line">                .antMatchers(<span class="string">"/admin/**"</span>).hasRole(<span class="string">"root"</span>) <span class="comment">// è®¿é—®adminè·¯å¾„ä¸‹çš„ä»»ä½•èµ„æºéƒ½éœ€è¦rootè§’è‰²</span></span><br><span class="line">                .anyRequest().authenticated() <span class="comment">// å…¶ä»–ä»»ä½•è·¯å¾„è¯·æ±‚éƒ½å¿…é¡»æˆæƒ</span></span><br><span class="line">                .and()</span><br><span class="line">                .exceptionHandling() <span class="comment">// å¼‚å¸¸å¤„ç†(æƒé™æ‹’ç»ã€ç™»å½•å¤±æ•ˆç­‰)</span></span><br><span class="line">               <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * è€Œåœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å‰å°ä½¿ç”¨VUEæˆ–JQç­‰ï¼‰æˆ‘ä»¬éœ€è¦çš„æ˜¯åœ¨å‰å°æ¥æ”¶åˆ°"ç”¨æˆ·æœªç™»å½•"çš„æç¤ºä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment">                 * æ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å±è”½é‡å®šå‘çš„ç™»å½•é¡µé¢ï¼Œå¹¶è¿”å›ç»Ÿä¸€çš„jsonæ ¼å¼çš„è¿”å›ä½“ã€‚</span></span><br><span class="line"><span class="comment">                 * è€Œå®ç°è¿™ä¸€åŠŸèƒ½çš„æ ¸å¿ƒå°±æ˜¯å®ç°AuthenticationEntryPointå¹¶åœ¨WebSecurityConfigä¸­æ³¨å…¥ï¼Œ</span></span><br><span class="line"><span class="comment">                 * ç„¶ååœ¨configure(HttpSecurity http)æ–¹æ³•ä¸­ã€‚</span></span><br><span class="line"><span class="comment">                 * AuthenticationEntryPointä¸»è¦æ˜¯ç”¨æ¥å¤„ç†åŒ¿åç”¨æˆ·è®¿é—®æ— æƒé™èµ„æºæ—¶çš„å¼‚å¸¸ï¼ˆå³æœªç™»å½•ï¼Œæˆ–è€…ç™»å½•çŠ¶æ€è¿‡æœŸå¤±æ•ˆï¼‰</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                .authenticationEntryPoint(<span class="keyword">new</span> AuthenticationEntryPoint() {</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException </span>{</span><br><span class="line">                         <span class="comment">// å®é™…åº”è¯¥è¿”jsonç»Ÿä¸€ç»“æœ</span></span><br><span class="line">                        response.setContentType(<span class="string">"text/json;charset=utf-8"</span>);</span><br><span class="line">                        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                        map.put(<span class="string">"status"</span>, <span class="number">403</span>);</span><br><span class="line">                        map.put(<span class="string">"msg"</span>, <span class="string">"è¯·æ£€æŸ¥æ˜¯å¦ç™»å½•"</span>);</span><br><span class="line">                        response.getWriter().write(mapper.writeValueAsString(map));</span><br><span class="line">                        response.getWriter().flush();</span><br><span class="line">                        response.getWriter().close();</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin().permitAll() <span class="comment">// é»˜è®¤ç™»å½•è·¯å¾„"/login"</span></span><br><span class="line">                .successHandler(<span class="keyword">new</span> AuthenticationSuccessHandler() { <span class="comment">// ç™»å½•æˆåŠŸåçš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication auth)</span> <span class="keyword">throws</span> IOException, ServletException </span>{</span><br><span class="line">                         <span class="comment">// å®é™…åº”è¯¥è¿”jsonç»Ÿä¸€ç»“æœ</span></span><br><span class="line">                        Object principal = auth.getPrincipal();</span><br><span class="line">                        response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">                        PrintWriter out = response.getWriter();</span><br><span class="line">                        response.setStatus(<span class="number">200</span>);</span><br><span class="line">                        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                        map.put(<span class="string">"status"</span>, <span class="number">200</span>);</span><br><span class="line">                        map.put(<span class="string">"msg"</span>, principal);</span><br><span class="line">                        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        out.write(om.writeValueAsString(map));</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> AuthenticationFailureHandler() { <span class="comment">// ç™»å½•å¤±è´¥åçš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>{</span><br><span class="line">                        <span class="comment">// å®é™…åº”è¯¥è¿”jsonç»Ÿä¸€ç»“æœ</span></span><br><span class="line">                        response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">                        PrintWriter out = response.getWriter();</span><br><span class="line">                        response.setStatus(<span class="number">401</span>);</span><br><span class="line">                        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                        map.put(<span class="string">"status"</span>, <span class="number">401</span>);</span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> LockedException) {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"è´¦æˆ·è¢«é”å®šï¼Œç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BadCredentialsException) {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"è´¦æˆ·åæˆ–å¯†ç è¾“å…¥é”™è¯¯ï¼Œç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DisabledException) {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"è´¦æˆ·è¢«ç¦ç”¨ï¼Œç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AccountExpiredException) {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"è´¦æˆ·å·²è¿‡æœŸï¼Œç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> CredentialsExpiredException) {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"å¯†ç å·²è¿‡æœŸï¼Œç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            map.put(<span class="string">"msg"</span>, <span class="string">"ç™»å½•å¤±è´¥!"</span>);</span><br><span class="line">                        }</span><br><span class="line">                        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        out.write(om.writeValueAsString(map));</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">                .and()</span><br><span class="line">                .logout().permitAll() <span class="comment">// é»˜è®¤é€€å‡ºè·¯å¾„"/logout"</span></span><br><span class="line">                .logoutSuccessHandler(<span class="keyword">new</span> LogoutSuccessHandler() { <span class="comment">// é€€å‡ºæˆåŠŸåçš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>{</span><br><span class="line">                         <span class="comment">// å®é™…åº”è¯¥è¿”jsonç»Ÿä¸€ç»“æœ</span></span><br><span class="line">                        response.setContentType(<span class="string">"text/json;charset=utf-8"</span>);</span><br><span class="line">                        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                        map.put(<span class="string">"status"</span>, <span class="number">200</span>);</span><br><span class="line">                        map.put(<span class="string">"msg"</span>, <span class="string">"é€€å‡ºæˆåŠŸ"</span>);</span><br><span class="line">                        response.getWriter().write(mapper.writeValueAsString(map));</span><br><span class="line">                        response.getWriter().flush();</span><br><span class="line">                        response.getWriter().close();</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">                .deleteCookies(<span class="string">"JSESSIONID"</span>)<span class="comment">//ç™»å‡ºä¹‹ååˆ é™¤cookie</span></span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="12-springbootæ•´åˆrabbitmqå®ç°é‚®ä»¶å‘é€"><a href="#12-springbootæ•´åˆrabbitmqå®ç°é‚®ä»¶å‘é€" class="headerlink" title="12.springbootæ•´åˆrabbitmqå®ç°é‚®ä»¶å‘é€"></a>12.springbootæ•´åˆrabbitmqå®ç°é‚®ä»¶å‘é€</h3><blockquote>
<p>å®ä¾‹æ•ˆæœï¼šæ•´åˆrabbitmqå’Œquartzå®ç°ç®€å•çš„é«˜æ•ˆç‡æ¶ˆæ¯æŠ•é€’</p>
</blockquote>
<h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><blockquote>
<p>ç”¨åˆ°çš„å·¥å…·ç±»å’Œsqlå»ºè¡¨è¯­å¥</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.common.util.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JavaType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> To0To0/10/17 1To:ToTo</span></span><br><span class="line"><span class="comment"> * jacksonåºåˆ—åŒ–å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JacksonUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="comment">// ç»Ÿä¸€æ—¥æœŸæ ¼å¼yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">objToString</span><span class="params">(T obj)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> obj <span class="keyword">instanceof</span> String ? (String) obj : objectMapper.writeValueAsString(obj);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.warn(<span class="string">"Parse object to String error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">objToStringPretty</span><span class="params">(T obj)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> obj <span class="keyword">instanceof</span> String ? (String) obj :</span><br><span class="line">                    objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(obj);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.warn(<span class="string">"Parse object to String error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, Class&lt;T&gt; clazz)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(str) || clazz == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> clazz.equals(String.class) ? (T) str : objectMapper.readValue(str, clazz);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.warn(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, TypeReference&lt;T&gt; typeReference)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(str) || typeReference == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> (T) (typeReference.getType().equals(String.class) ? str : objectMapper.readValue(str,</span><br><span class="line">                    typeReference));</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.warn(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">stringToObj</span><span class="params">(String str, Class&lt;?&gt; collectionClass, Class&lt;?&gt;... elementClasses)</span> </span>{</span><br><span class="line">        JavaType javaType = objectMapper.getTypeFactory().constructParametricType(collectionClass, elementClasses);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> objectMapper.readValue(str, javaType);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.warn(<span class="string">"Parse String to Object error"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.ExceptionUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.vo.SendMailInfoVO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.apache.bcel.classfile.Code;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/5/9 15:11</span></span><br><span class="line"><span class="comment"> * é‚®ä»¶å‘é€å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.mail.username}")</span></span><br><span class="line">    <span class="keyword">private</span> String sendUsername;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶è‡ªå®šä¹‰Mapç±»å‹çš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mapInfo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendComplateMail</span><span class="params">(Map&lt;String, Object&gt; mapInfo)</span> </span>{</span><br><span class="line">        MimeMessage mimeMessage;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®å‘ä»¶äººé‚®ç®±</span></span><br><span class="line">            helper.setFrom(sendUsername);</span><br><span class="line">            <span class="comment">//è®¾ç½®æ”¶ä»¶äººé‚®ç®±ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼‰</span></span><br><span class="line">            helper.setTo(String.valueOf(mapInfo.get(<span class="string">"to"</span>)));</span><br><span class="line">            <span class="comment">//è®¾ç½®é‚®ä»¶æ ‡é¢˜</span></span><br><span class="line">            helper.setSubject(String.valueOf(mapInfo.get(<span class="string">"title"</span>)));</span><br><span class="line">            <span class="comment">//è®¾ç½®é‚®ä»¶æ­£æ–‡</span></span><br><span class="line">            helper.setText(String.valueOf(mapInfo.get(<span class="string">"html"</span>)), <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//å¼€å§‹å‘é€</span></span><br><span class="line">            javaMailSender.send(mimeMessage);</span><br><span class="line">        } <span class="keyword">catch</span> (MessagingException e) {</span><br><span class="line">            log.error(<span class="string">"é‚®ä»¶å‘é€å¤±è´¥ï¼"</span>);</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€htmlæ¨¡æ¿é‚®ä»¶:æ¥æ”¶ç½‘é¡µå‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendTo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‘é€çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendHtmlMail</span><span class="params">(String title, String[] sendTo, String html)</span> <span class="keyword">throws</span> MessagingException </span>{</span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å‘ä»¶äººé‚®ç®±</span></span><br><span class="line">        helper.setFrom(sendUsername);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ”¶ä»¶äººé‚®ç®±ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼‰</span></span><br><span class="line">        helper.setTo(sendTo);</span><br><span class="line">        <span class="comment">//è®¾ç½®é‚®ä»¶æ ‡é¢˜</span></span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        <span class="comment">//è®¾ç½®é‚®ä»¶æ­£æ–‡</span></span><br><span class="line">        helper.setText(html, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//å¼€å§‹å‘é€</span></span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">-- æ¶ˆæ¯æŒä¹…åŒ–è¡¨ç»“æ„</span><br><span class="line">DROP TABLE IF EXISTS `tb_message_log`;</span><br><span class="line">CREATE TABLE `tb_message_log` (</span><br><span class="line">  `id` CHAR(19) NOT NULL COMMENT 'æ¶ˆæ¯å”¯ä¸€æ ‡è¯†',</span><br><span class="line">  `msg` TEXT COMMENT 'æ¶ˆæ¯å†…å®¹ï¼šjsonæ ¼å¼åŒ–',</span><br><span class="line">  `exchange` VARCHAR(255) NOT NULL COMMENT 'äº¤æ¢æœº',</span><br><span class="line">  `routing_key` VARCHAR(255) NOT NULL COMMENT 'è·¯ç”±é”®',</span><br><span class="line">  `status` INT(11) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'çŠ¶æ€: 0-æŠ•é€’ä¸­ 1-æŠ•é€’æˆåŠŸ 2-æŠ•é€’å¤±è´¥ 3-æ¶ˆè´¹æˆåŠŸ',</span><br><span class="line">  `try_count` INT(11) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'é‡è¯•æ¬¡æ•°',</span><br><span class="line">  `try_time` DATETIME DEFAULT NULL COMMENT 'é‡è¯•æ—¶é—´',</span><br><span class="line">  `gmt_create` DATETIME DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',</span><br><span class="line">  `gmt_modified` DATETIME DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',</span><br><span class="line">  `is_deleted` TINYINT(1) UNSIGNED DEFAULT '1' COMMENT 'é€»è¾‘åˆ é™¤',</span><br><span class="line">  `version` BIGINT UNSIGNED DEFAULT '1' COMMENT 'ä¹è§‚é”',</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `unq_msg_id` (`id`) USING BTREE</span><br><span class="line">) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆæ¯æŠ•é€’æ—¥å¿—';</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-å¼•å…¥pom"><a href="#1-å¼•å…¥pom" class="headerlink" title="1. å¼•å…¥pom"></a>1. å¼•å…¥pom</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-amqp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-ç¼–å†™application-ymlä¿¡æ¯é…ç½®"><a href="#2-ç¼–å†™application-ymlä¿¡æ¯é…ç½®" class="headerlink" title="2. ç¼–å†™application.ymlä¿¡æ¯é…ç½®"></a>2. ç¼–å†™application.ymlä¿¡æ¯é…ç½®</h4><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># rabbitMQä¿¡æ¯é…ç½®</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span>    <span class="comment"># é»˜è®¤å¯çœç•¥</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/horse</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">horse</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">horse</span></span><br><span class="line">    <span class="comment"># å¼€å¯æŠ•é€’æˆåŠŸå›è°ƒ P -&gt; Exchange</span></span><br><span class="line">    <span class="attr">publisher-confirms:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># å¼€å¯æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—å¤±è´¥å›è°ƒ Exchange -&gt; Queue</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># å¼€å¯æ‰‹åŠ¨ACKç¡®è®¤æ¨¡å¼ Queue -&gt; C</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span> <span class="comment"># ä»£è¡¨æ‰‹åŠ¨ACKç¡®è®¤</span></span><br><span class="line">        <span class="comment"># ä¸€äº›åŸºæœ¬å‚æ•°çš„è®¾ç½®(ä¹Ÿå¯ä»¥ä¸è®¾ç½®,é»˜è®¤å³å¯)</span></span><br><span class="line">        <span class="attr">concurrency:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">max-concurrency:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">15</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">max-attempts:</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-RabbitTemplateçš„é…ç½®"><a href="#3-RabbitTemplateçš„é…ç½®" class="headerlink" title="3. RabbitTemplateçš„é…ç½®"></a>3. RabbitTemplateçš„é…ç½®</h4><blockquote>
<p>ä¸»è¦æ˜¯é…ç½®ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼š</p>
<ul>
<li>æ¶ˆæ¯æŠ•é€’å›è°ƒå‡½æ•°:ConfirmCallback()</li>
<li>æ¶ˆæ¯ç”±Exchangeå‘é€åˆ°Queueæ—¶å¤±è´¥è§¦å‘çš„å›è°ƒå‡½æ•°ï¼šReturnCallback()</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/17 12:49</span></span><br><span class="line"><span class="comment"> * rabbitmqæ¨¡æ¿æ“ä½œbeanç»„ä»¶ç¤ºä¾‹çš„è‡ªå®šä¹‰æ³¨å…¥é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRabbitConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageLogService messageLogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CachingConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰æ¶ˆæ¯åºåˆ—åŒ–æœºåˆ¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title">converter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RabbitTemplate <span class="title">rabbitTemplate</span><span class="params">()</span> </span>{</span><br><span class="line">        RabbitTemplate rabbitTemplate = <span class="keyword">new</span> RabbitTemplate(connectionFactory);</span><br><span class="line">        <span class="comment">// è§¦å‘setReturnCallbackå›è°ƒå¿…é¡»è®¾ç½®mandatory=true,å¦åˆ™Exchangeæ²¡æœ‰æ‰¾åˆ°Queueå°±ä¼šä¸¢å¼ƒæ‰æ¶ˆæ¯, è€Œä¸ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line">        rabbitTemplate.setMandatory(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®åºåˆ—åŒ–æœºåˆ¶</span></span><br><span class="line">        rabbitTemplate.setMessageConverter(converter());</span><br><span class="line">        <span class="comment">//ç¡®è®¤æ¶ˆæ¯å‘é€æˆåŠŸï¼Œè¿˜æ˜¯å‘é€ä¸¢å¤±, ConfirmCallback  åªç¡®è®¤æ¶ˆæ¯æ˜¯å¦æ­£ç¡®åˆ°è¾¾ Exchange ä¸­</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="keyword">new</span> RabbitTemplate.ConfirmCallback() {</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ¶ˆæ¯æŠ•é€’å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> correlationData ä¸€èˆ¬å°è£…æ¶ˆæ¯å”¯ä¸€æ ‡è¯†(æ•°æ®åº“ä¸­çš„ç»„ä»¶id)</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> ack æŠ•é€’ç»“æœ:true or false</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> cause å¤±è´¥åŸå› (æŠ•é€’æˆåŠŸæ—¶:cause=null)</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> ack, String cause)</span> </span>{</span><br><span class="line">                log.info(<span class="string">"æ¶ˆæ¯å‘é€åˆ°Exchangeæƒ…å†µåé¦ˆ:å”¯ä¸€æ ‡è¯†ï¼šcorrelationData={},æ¶ˆæ¯ç¡®è®¤ï¼šack={},åŸå› ï¼šcause={}"</span>, correlationData.getId(),</span><br><span class="line">                        ack, cause);</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtils.isNotEmpty(correlationData) &amp;&amp; StringUtils.isNotBlank(correlationData.getId())) {</span><br><span class="line">                    MessageLog messageLog = <span class="keyword">new</span> MessageLog().setId(correlationData.getId());</span><br><span class="line">                    <span class="keyword">if</span> (ack) {</span><br><span class="line">                        <span class="comment">// æˆåŠŸå‘é€åˆ°Exchangeä¸­åï¼Œæ›´æ–°æ¶ˆæ¯å‘é€çš„çŠ¶æ€ä¸ºæŠ•é€’â€”â€”â€”â€”æˆåŠŸçŠ¶æ€</span></span><br><span class="line">                        messageLog.setStatus(RabbitConstants.DELIVER_SUCCESS);</span><br><span class="line">                        messageLogService.updateById(messageLog);</span><br><span class="line">                        log.info(<span class="string">"æŠ•é€’åˆ°ExchangeæˆåŠŸ"</span>);</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        <span class="comment">// å‘é€åˆ°Exchangeä¸­å¤±è´¥åï¼Œæ›´æ–°æ¶ˆæ¯å‘é€çš„çŠ¶æ€ä¸ºæŠ•é€’â€”â€”â€”â€”å¤±è´¥çŠ¶æ€</span></span><br><span class="line">                        messageLog.setStatus(RabbitConstants.DELIVER_FALSE);</span><br><span class="line">                        messageLogService.updateById(messageLog);</span><br><span class="line">                        log.info(<span class="string">"æŠ•é€’åˆ°Exchangeå¤±è´¥"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯ç”±Exchangeå‘é€åˆ°Queueæ—¶å¤±è´¥è§¦å‘çš„å›è°ƒ</span></span><br><span class="line">        rabbitTemplate.setReturnCallback(<span class="keyword">new</span> RabbitTemplate.ReturnCallback() {</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ¶ˆæ¯ä»Exchangeåˆ°Queueå¤±è´¥å›è°ƒ</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> message æ ‡è®°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> replyCode å“åº”ç </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> replyText ç›¸åº”å†…å®¹</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> exchange äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> routingKey è·¯ç”±é”®</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnedMessage</span><span class="params">(Message message, <span class="keyword">int</span> replyCode, String replyText, String exchange,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        String routingKey)</span> </span>{</span><br><span class="line">                log.warn(<span class="string">"æ¶ˆæ¯ç”±Exchangeå‘é€åˆ°Queueæ—¶å¤±è´¥:message={},replyCode={},replyText={},exchange={},rountingKey={}"</span>,</span><br><span class="line">                        message, replyCode, replyText, exchange, routingKey);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-controllerå±‚API"><a href="#4-controllerå±‚API" class="headerlink" title="4. controllerå±‚API"></a>4. controllerå±‚API</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@NoRepeatSubmit</span></span><br><span class="line"><span class="meta">@OperatingLog(operType = BlogConstants.SEND, operDesc = "é‚®ä»¶å‘é€ç®¡ç†")</span></span><br><span class="line"><span class="meta">@ApiOperation("å‘é€ç¾¤ä½“é‚®ä»¶")</span></span><br><span class="line"><span class="meta">@PostMapping("/send/mail")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">sendMailToAllUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> SendMailInfoVO sendMailInfoVO)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(sendMailInfoVO)) {</span><br><span class="line">        <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span> send = systemService.sendMailToAllUser(sendMailInfoVO);</span><br><span class="line">    <span class="keyword">return</span> send ? R.ok().message(<span class="string">"é‚®ä»¶å‘é€æˆåŠŸ"</span>) : R.error().message(<span class="string">"é‚®ä»¶å‘é€å¤±è´¥"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="4-1-VOç±»"><a href="#4-1-VOç±»" class="headerlink" title="4.1 VOç±»"></a>4.1 VOç±»</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMailInfoVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "é‚®ä»¶ä¸»é¢˜ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "é‚®ä»¶å†…å®¹ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> String html;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "é‚®ä»¶è”ç³»äººä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="keyword">private</span> String sendTo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºä¼ é€’å…¥åº“æ¶ˆæ¯idçš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String messageId;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰"><a href="#5-å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰" class="headerlink" title="5. å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰"></a>5. å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageLogService messageLogService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€ç¾¤ä½“é‚®ä»¶(åŠ æŒRabbitMQæ¶ˆæ¯æœºåˆ¶)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendMailInfoVO é‚®ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‘é€çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMailToAllUser</span><span class="params">(SendMailInfoVO sendMailInfoVO)</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœå‚æ•°å¯¹è±¡ä¸ºç©º:ç›´æ¥è¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(sendMailInfoVO)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// æ¶ˆæ¯å…¥åº“</span></span><br><span class="line">            MessageLog messageLog = <span class="keyword">new</span> MessageLog()</span><br><span class="line">                    .setMsg(JacksonUtils.objToString(sendMailInfoVO))</span><br><span class="line">                    .setExchange(RabbitConstants.EMAIL_EXCHANGE)</span><br><span class="line">                    .setRoutingKey(RabbitConstants.EMAIL_KEY);</span><br><span class="line">            messageLogService.save(messageLog);</span><br><span class="line">            <span class="comment">// å°†å…¥åº“ç”Ÿæˆçš„idå†™å…¥è¿”å›æ•°æ®ä¸­</span></span><br><span class="line">            CorrelationData correlationData = <span class="keyword">new</span> CorrelationData(messageLog.getId());</span><br><span class="line">            <span class="comment">// å°†å…¥åº“ç”Ÿæˆçš„idå†™å…¥æ¶ˆæ¯ä¸­ä¼ é€’ç»™æ¶ˆè´¹è€…</span></span><br><span class="line">            String emailInfo = JacksonUtils.objToString(sendMailInfoVO.setMessageId(messageLog.getId()));</span><br><span class="line">            <span class="comment">// å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—(æ— è®ºæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸ,éƒ½ä¸èƒ½å½±å“ä¸šåŠ¡é€»è¾‘çš„è¿è¡Œ,æ‰€ä»¥è¦æ•è·å¼‚å¸¸)</span></span><br><span class="line">            rabbitTemplate.convertAndSend(RabbitConstants.EMAIL_EXCHANGE, RabbitConstants.EMAIL_KEY, emailInfo,</span><br><span class="line">                    correlationData);</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ä»»ä½•å¼‚å¸¸è¿”å›true</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="6-ç›‘å¬æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰"><a href="#6-ç›‘å¬æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰" class="headerlink" title="6. ç›‘å¬æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰"></a>6. ç›‘å¬æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmailUtils emailUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageLogService messageLogService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£å¼RabbitMQæ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emailInfo ä¼ é€’çš„è‡ªå®šä¹‰å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            // è®¾ç½®é˜Ÿåˆ—åç§°å¹¶æŒä¹…åŒ–</span></span><br><span class="line"><span class="meta">            value = @Queue(name = RabbitConstants.EMAIL_QUEUE, durable = RabbitConstants.BOOLEAN_STRING),</span></span><br><span class="line"><span class="meta">            // æ¶ˆè´¹è€…å¯¹åº”é˜Ÿåˆ—ç»‘å®šçš„äº¤æ¢æœºï¼ˆå¿…é¡»å’Œç›¸åº”çš„ç”Ÿäº§è€…ç»‘å®šç›¸åŒçš„äº¤æ¢æœºï¼‰</span></span><br><span class="line"><span class="meta">            // ignoreDeclarationExceptions = "true":å¿½ç•¥å£°æ˜å¼‚å¸¸ï¼Œå½“äº¤æ¢æœºå·²å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†è¿›è¡Œå£°æ˜åº”è¯¥å‘ç”Ÿå¼‚å¸¸ï¼Œä½†æ˜¯è¿™é‡Œè¿›è¡Œå¿½ç•¥æ“ä½œã€‚</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = RabbitConstants.EMAIL_EXCHANGE, ignoreDeclarationExceptions =</span></span><br><span class="line"><span class="meta">                    RabbitConstants.BOOLEAN_STRING),</span></span><br><span class="line"><span class="meta">            // è®¾ç½®è·¯ç”±keyï¼Œè¯´æ˜ç”¨äºæ¥æ”¶é‚£äº›æŒ‡å®šçš„ä¿¡æ¯,å¯è®¾ç½®å¤šä¸ªè·¯ç”±Key</span></span><br><span class="line"><span class="meta">            key = {RabbitConstants.EMAIL_KEY}</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">emailListener</span><span class="params">(Message message, Channel channel, String emailInfo)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// è·å–æ¶ˆæ¯å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">        <span class="keyword">long</span> tag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="comment">// è®¾ç½®é‡è¯•æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> tryCount = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// jsonè½¬åŒ–å¯¹è±¡</span></span><br><span class="line">        SendMailInfoVO sendMailInfoVO = JacksonUtils.stringToObj(emailInfo, SendMailInfoVO.class);</span><br><span class="line">        <span class="comment">// æ ¹æ®idæŸ¥è¯¢æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">assert</span> sendMailInfoVO != <span class="keyword">null</span>;</span><br><span class="line">        String messageId = sendMailInfoVO.getMessageId();</span><br><span class="line">        MessageLog messageLog = messageLogService.getById(messageId);</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å‘é€é€»è¾‘</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtils.isNotEmpty(messageLog) &amp;&amp; !RabbitConstants.CONSUME_SUCCESS.equals(messageLog.getStatus()) &amp;&amp; messageLog.getTryCount() &lt; RabbitConstants.RESEND_MAX_TIME) {</span><br><span class="line">                tryCount = messageLog.getTryCount();</span><br><span class="line">                <span class="comment">// å‘é€é‚®ä»¶</span></span><br><span class="line">                <span class="comment">// å°†sendToè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line">                String[] sendTo = StringUtils.split(sendMailInfoVO.getSendTo(), <span class="string">","</span>);</span><br><span class="line">                <span class="comment">// è°ƒç”¨é‚®ä»¶å‘é€å·¥å…·ç±»</span></span><br><span class="line">                <span class="keyword">boolean</span> flag = emailUtils.sendHtmlMail(sendMailInfoVO.getTitle(), sendTo, sendMailInfoVO.getHtml());</span><br><span class="line">                <span class="keyword">if</span> (flag) {</span><br><span class="line">                    <span class="comment">// é‚®ä»¶å‘é€æˆåŠŸ:æ›´æ–°æ¶ˆæ¯çŠ¶æ€</span></span><br><span class="line">                    messageLogService.updateById(<span class="keyword">new</span> MessageLog().setId(messageId).setStatus(RabbitConstants.CONSUME_SUCCESS));</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                     * æ¶ˆè´¹ç¡®è®¤:åªç¡®è®¤å½“å‰è¿™ä¸€æ¡</span></span><br><span class="line"><span class="comment">                     * channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false);</span></span><br><span class="line"><span class="comment">                     * deliveryTag:è¯¥æ¶ˆæ¯çš„index</span></span><br><span class="line"><span class="comment">                     * multipleï¼šæ˜¯å¦æ‰¹é‡ true:å°†ä¸€æ¬¡æ€§ackæ‰€æœ‰å°äºdeliveryTagçš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">                     * */</span></span><br><span class="line">                    channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="comment">// å‘é€å¼‚å¸¸:é‡æ–°å‘é€ä¸‰æ¬¡</span></span><br><span class="line">            <span class="keyword">if</span> (tryCount &lt; RabbitConstants.RESEND_MAX_TIME) {</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * é‡å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¼šè¢«å†æ¬¡é‡è¯•å‘é€ï¼Œæ¯é‡è¯•ä¸€æ¬¡ï¼Œé‡è¯•æ¬¡æ•°åŠ â€œ1â€</span></span><br><span class="line"><span class="comment">                 * channel.basicNack(tag, false, true)</span></span><br><span class="line"><span class="comment">                 * deliveryTag:è¯¥æ¶ˆæ¯çš„index</span></span><br><span class="line"><span class="comment">                 * multipleï¼šæ˜¯å¦æ‰¹é‡ true:å°†ä¸€æ¬¡æ€§æ‹’ç»æ‰€æœ‰å°äºdeliveryTagçš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">                 * requeueï¼šè¢«æ‹’ç»çš„æ˜¯å¦é‡æ–°å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">                 * */</span></span><br><span class="line">                channel.basicNack(tag, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">                tryCount++;</span><br><span class="line">                messageLogService.updateById(<span class="keyword">new</span> MessageLog().setId(messageId).setTryCount(tryCount).setTryTime(<span class="keyword">new</span> Date()));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å½“èµ°åˆ°è¿™ä¸€æ­¥æ—¶,ä»£è¡¨æ¶ˆæ¯å·²è¢«æ¶ˆè´¹ï¼ˆstatus=3ï¼‰æˆ–è€… é‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™,ä¸å†æ­ç†è¿™æ¡æ¶ˆæ¯ ç­‰æƒ…å†µ-ä½†ä¸ç®¡æ˜¯å“ªç§æƒ…å†µï¼Œéƒ½éœ€è¦å°†æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œé˜²æ­¢ä¸‹æ¬¡é¡¹ç›®é‡å¯æ—¶é‡æ–°ç›‘å¬æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">// æ•°æ®åº“ä¸­å¯¹åº”æ¶ˆæ¯çŠ¶æ€æ›´æ–°ä¸º:status=4:æ¶ˆè´¹å¤±è´¥(è¿™é‡ŒæŒ‰ç…§è‡ªå·±çš„é€»è¾‘è¿›è¡Œç¼–å†™)</span></span><br><span class="line">        messageLogService.updateById(<span class="keyword">new</span> MessageLog().setId(messageId).setStatus(RabbitConstants.CONSUME_FALSE));</span><br><span class="line">        channel.basicAck(tag, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="7-quartzé‡æ–°æŠ•é€’"><a href="#7-quartzé‡æ–°æŠ•é€’" class="headerlink" title="7. quartzé‡æ–°æŠ•é€’"></a>7. quartzé‡æ–°æŠ•é€’</h4><blockquote>
<p>å‰æï¼šé¡¹ç›®ä¸­å·²ç»æ•´åˆquartz,å¦åˆ™å¯ä»¥ä½¿ç”¨@Scheduleæ¥å®ç°å®šæ—¶ä»»åŠ¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.job;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.quartz.Job;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/15 11:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseJob</span> <span class="keyword">extends</span> <span class="title">Job</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä»»åŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JobExecutionException å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.job;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.constants.RabbitConstants;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.ExceptionUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.JacksonUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.entity.MessageLog;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.MessageLogService;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.vo.SendMailInfoVO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/17 15:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageDeliveryJob</span> <span class="keyword">implements</span> <span class="title">BaseJob</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageLogService messageLogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä»»åŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JobExecutionException å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è·å–éœ€è¦é‡æ–°æŠ•é€’çš„æ¶ˆæ¯åˆ—è¡¨</span></span><br><span class="line">            List&lt;MessageLog&gt; messageLogs = messageLogService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;MessageLog&gt;()</span><br><span class="line">                    .select(MessageLog::getId, MessageLog::getExchange, MessageLog::getRoutingKey, MessageLog::getMsg)</span><br><span class="line">                    .ne(MessageLog::getStatus, RabbitConstants.CONSUME_FALSE)</span><br><span class="line">                    .ne(MessageLog::getStatus, RabbitConstants.CONSUME_SUCCESS));</span><br><span class="line">            <span class="comment">// é‡æ–°æŠ•é€’</span></span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(messageLogs)) {</span><br><span class="line">                messageLogs.forEach(messageLog -&gt; {</span><br><span class="line">                    <span class="keyword">if</span> (ObjectUtils.isNotEmpty(messageLog) &amp;&amp; StringUtils.isNoneBlank(messageLog.getExchange(),</span><br><span class="line">                            messageLog.getRoutingKey(), messageLog.getMsg())) {</span><br><span class="line">                        <span class="comment">// ç»„è£…éœ€è¦ä¼ é€’çš„ä¿¡æ¯(ä¼ é€’ç›‘å¬å™¨éœ€è¦çš„å‡ ä¸ªå¿…è¦ä¿¡æ¯)</span></span><br><span class="line">                        SendMailInfoVO sendMailInfoVO = JacksonUtils.stringToObj(messageLog.getMsg(),</span><br><span class="line">                                SendMailInfoVO.class);</span><br><span class="line">                        String emailInfo = <span class="keyword">null</span>;</span><br><span class="line">                        <span class="keyword">if</span> (ObjectUtils.isNotEmpty(sendMailInfoVO)) {</span><br><span class="line">                            sendMailInfoVO.setMessageId(messageLog.getId());</span><br><span class="line">                            emailInfo = JacksonUtils.objToString(sendMailInfoVO);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="comment">// é‡æ–°å‘é€æ¶ˆæ¯è¿›é˜Ÿåˆ—</span></span><br><span class="line">                        rabbitTemplate.convertAndSend(RabbitConstants.EMAIL_EXCHANGE, RabbitConstants.EMAIL_KEY,</span><br><span class="line">                                emailInfo, <span class="keyword">new</span> CorrelationData(messageLog.getId()));</span><br><span class="line">                        log.info(<span class="string">"é‡æ–°æŠ•é€’æˆåŠŸ:æ¶ˆæ¯id={}"</span>, messageLog.getId());</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">"é‡æ–°æŠ•é€’å¤±è´¥:"</span> + ExceptionUtils.getMessage(e));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="13-Springbootæ•´åˆQuartzå®ç°ä»»åŠ¡è°ƒåº¦"><a href="#13-Springbootæ•´åˆQuartzå®ç°ä»»åŠ¡è°ƒåº¦" class="headerlink" title="13.Springbootæ•´åˆQuartzå®ç°ä»»åŠ¡è°ƒåº¦"></a>13.Springbootæ•´åˆQuartzå®ç°ä»»åŠ¡è°ƒåº¦</h3><blockquote>
<p>å®ç°æ•°æ®æŒä¹…åŒ–ï¼Œå¹¶å®ç°è°ƒåº¦ä»»åŠ¡ç®€å•çš„åˆ›å»ºã€æš‚åœã€æ¢å¤ã€æ›´æ–°ã€åˆ é™¤ç­‰åŸºæœ¬æ“ä½œ</p>
</blockquote>
<h4 id="1-å¼•å…¥pomæ–‡ä»¶"><a href="#1-å¼•å…¥pomæ–‡ä»¶" class="headerlink" title="1. å¼•å…¥pomæ–‡ä»¶"></a>1. å¼•å…¥pomæ–‡ä»¶</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-quartz--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--druid:å¯ä»¥è®¾ç½®ä¸ºDruidæ•°æ®æ± ï¼ˆé»˜è®¤æ˜¯C3p0æ•°æ®æ± ï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-é…ç½®application-ymlä¿¡æ¯"><a href="#2-é…ç½®application-ymlä¿¡æ¯" class="headerlink" title="2. é…ç½®application.ymlä¿¡æ¯"></a>2. é…ç½®application.ymlä¿¡æ¯</h4><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment"># quartzä¿¡æ¯é…ç½®</span></span><br><span class="line">     <span class="attr">quartz:</span></span><br><span class="line">       <span class="attr">properties:</span></span><br><span class="line">         <span class="attr">org:</span></span><br><span class="line">           <span class="attr">quartz:</span></span><br><span class="line">             <span class="attr">scheduler:</span></span><br><span class="line">               <span class="attr">instanceName:</span> <span class="string">DefaultQuartzScheduler</span></span><br><span class="line">               <span class="attr">instanceId:</span> <span class="string">AUTO</span></span><br><span class="line">             <span class="attr">jobStore:</span></span><br><span class="line">               <span class="attr">class:</span> <span class="string">org.quartz.impl.jdbcjobstore.JobStoreTX</span></span><br><span class="line">               <span class="attr">driverDelegateClass:</span> <span class="string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line">               <span class="attr">tablePrefix:</span> <span class="string">QRTZ_</span></span><br><span class="line">               <span class="attr">isClustered:</span> <span class="literal">false</span></span><br><span class="line">               <span class="attr">clusterCheckinInterval:</span> <span class="number">10000</span></span><br><span class="line">               <span class="attr">useProperties:</span> <span class="literal">true</span></span><br><span class="line">               <span class="attr">dataSource:</span> <span class="string">myDS</span>  <span class="comment"># è‡ªå®šä¹‰æ•°æ®æºåç§°</span></span><br><span class="line">             <span class="attr">threadPool:</span></span><br><span class="line">               <span class="attr">class:</span> <span class="string">org.quartz.simpl.SimpleThreadPool</span></span><br><span class="line">               <span class="attr">threadCount:</span> <span class="number">10</span></span><br><span class="line">               <span class="attr">threadPriority:</span> <span class="number">5</span></span><br><span class="line">               <span class="attr">threadsInheritContextClassLoaderOfInitializingThread:</span> <span class="literal">true</span></span><br><span class="line">             <span class="attr">dataSource:</span></span><br><span class="line">               <span class="attr">myDS:</span></span><br><span class="line">                 <span class="attr">connectionProvider:</span></span><br><span class="line">                   <span class="attr">class:</span> <span class="string">com.horse.service.blog.handler.DruidProviderHandler</span>  <span class="comment"># æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„druidæ•°æ®æº</span></span><br><span class="line">                 <span class="attr">URL:</span> <span class="string">jdbc:mysql://47.99.152.217:3306/xxxx?serverTimezone=GMT%2B8&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">                 <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">                 <span class="attr">password:</span> <span class="string">mysql123</span></span><br><span class="line">                 <span class="attr">driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">                 <span class="attr">maxConnection:</span> <span class="number">10</span></span><br><span class="line">       <span class="comment"># æ•°æ®åº“æŒä¹…åŒ–</span></span><br><span class="line">       <span class="attr">job-store-type:</span> <span class="string">jdbc</span></span><br><span class="line">       <span class="attr">jdbc:</span></span><br><span class="line">         <span class="attr">initialize-schema:</span> <span class="string">never</span> <span class="comment"># å¯åŠ¨æ—¶æ˜¯å¦æ‰§è¡Œå»ºè¡¨è¯­å¥(å·²ç»å­˜åœ¨çš„ä»»åŠ¡,é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä¸ä¼šè¿›è¡Œæ¸…ç©º,å¹¶ä¸”è‡ªåŠ¨æ‹‰å–æ‰§è¡Œ)</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-ç¼–å†™Druidæ•°æ®æºé…ç½®æ–‡ä»¶"><a href="#3-ç¼–å†™Druidæ•°æ®æºé…ç½®æ–‡ä»¶" class="headerlink" title="3. ç¼–å†™Druidæ•°æ®æºé…ç½®æ–‡ä»¶"></a>3. ç¼–å†™Druidæ•°æ®æºé…ç½®æ–‡ä»¶</h4><blockquote>
<p>åŸºæœ¬ä¿æŒä¸å˜å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horse.service.blog.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerException;</span><br><span class="line"><span class="keyword">import</span> org.quartz.utils.ConnectionProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Druidè¿æ¥æ± çš„Quartzæ‰©å±•ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidProviderHandler</span> <span class="keyword">implements</span> <span class="title">ConnectionProvider</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¸¸é‡é…ç½®ï¼Œä¸quartz.propertiesæ–‡ä»¶çš„keyä¿æŒä¸€è‡´(å»æ‰å‰ç¼€)ï¼ŒåŒæ—¶æä¾›setæ–¹æ³•ï¼ŒQuartzæ¡†æ¶è‡ªåŠ¨æ³¨å…¥å€¼ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JDBCé©±åŠ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JDBCè¿æ¥ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String URL;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String user;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“ç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> maxConnection;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“SQLæŸ¥è¯¢æ¯æ¬¡è¿æ¥è¿”å›æ‰§è¡Œåˆ°è¿æ¥æ± ï¼Œä»¥ç¡®ä¿å®ƒä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String validationQuery;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> validateOnCheckout;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> idleConnectionValidationSeconds;</span><br><span class="line">    <span class="keyword">public</span> String maxCachedStatementsPerConnection;</span><br><span class="line">    <span class="keyword">private</span> String discardIdleConnectionsSeconds;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_DB_MAX_CONNECTIONS = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_DB_MAX_CACHED_STATEMENTS_PER_CONNECTION = <span class="number">120</span>;</span><br><span class="line">    <span class="keyword">private</span> DruidDataSource datasource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> datasource.getConnection();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        datasource.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.URL == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool could not be created: DB URL cannot be null"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.driver == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool driver could not be created: DB driver class name cannot be null!"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.maxConnection &lt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"DBPool maxConnectins could not be created: Max connections must be greater than zero!"</span>);</span><br><span class="line">        }</span><br><span class="line">        datasource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        <span class="keyword">try</span>{</span><br><span class="line">            datasource.setDriverClassName(<span class="keyword">this</span>.driver);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> SchedulerException(<span class="string">"Problem setting driver class name on datasource: "</span> + e.getMessage(), e);</span><br><span class="line">            } <span class="keyword">catch</span> (SchedulerException e1) {</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        datasource.setUrl(<span class="keyword">this</span>.URL);</span><br><span class="line">        datasource.setUsername(<span class="keyword">this</span>.user);</span><br><span class="line">        datasource.setPassword(<span class="keyword">this</span>.password);</span><br><span class="line">        datasource.setMaxActive(<span class="keyword">this</span>.maxConnection);</span><br><span class="line">        datasource.setMinIdle(<span class="number">1</span>);</span><br><span class="line">        datasource.setMaxWait(<span class="number">0</span>);</span><br><span class="line">        datasource.setMaxPoolPreparedStatementPerConnectionSize(DEFAULT_DB_MAX_CONNECTIONS);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.validationQuery != <span class="keyword">null</span>) {</span><br><span class="line">            datasource.setValidationQuery(<span class="keyword">this</span>.validationQuery);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.validateOnCheckout) {</span><br><span class="line">                datasource.setTestOnReturn(<span class="keyword">true</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                datasource.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">            }</span><br><span class="line">            datasource.setValidationQueryTimeout(<span class="keyword">this</span>.idleConnectionValidationSeconds);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDriver</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> driver;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriver</span><span class="params">(String driver)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.driver = driver;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getURL</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> URL;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setURL</span><span class="params">(String URL)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.URL = URL;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaxConnection</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> maxConnection;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxConnection</span><span class="params">(<span class="keyword">int</span> maxConnection)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.maxConnection = maxConnection;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValidationQuery</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> validationQuery;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidationQuery</span><span class="params">(String validationQuery)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.validationQuery = validationQuery;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidateOnCheckout</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> validateOnCheckout;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidateOnCheckout</span><span class="params">(<span class="keyword">boolean</span> validateOnCheckout)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.validateOnCheckout = validateOnCheckout;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIdleConnectionValidationSeconds</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> idleConnectionValidationSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdleConnectionValidationSeconds</span><span class="params">(<span class="keyword">int</span> idleConnectionValidationSeconds)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.idleConnectionValidationSeconds = idleConnectionValidationSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">getDatasource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> datasource;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDatasource</span><span class="params">(DruidDataSource datasource)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.datasource = datasource;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDiscardIdleConnectionsSeconds</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> discardIdleConnectionsSeconds;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDiscardIdleConnectionsSeconds</span><span class="params">(String discardIdleConnectionsSeconds)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.discardIdleConnectionsSeconds = discardIdleConnectionsSeconds;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-è‡ªå®šä¹‰ä»»åŠ¡"><a href="#4-è‡ªå®šä¹‰ä»»åŠ¡" class="headerlink" title="4. è‡ªå®šä¹‰ä»»åŠ¡"></a>4. è‡ªå®šä¹‰ä»»åŠ¡</h4><blockquote>
<p>è‡ªå®šä¹‰ï¼ˆå…·æœ‰ä¸šåŠ¡é€»è¾‘çš„ä»»åŠ¡ç±»ï¼‰å¹¶ç»§æ‰¿è‡ªå®šä¹‰çš„BaseJobæ¥å£ç±»</p>
</blockquote>
<p>BaseJobæ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseJob</span> <span class="keyword">extends</span> <span class="title">Job</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä»»åŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JobExecutionException å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä»–è‡ªå®šä¹‰ä»»åŠ¡ç±»(éšä¾¿ä¸¤ä¸ªç¤ºä¾‹)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationLogJob</span> <span class="keyword">implements</span> <span class="title">BaseJob</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OperationalLogService operationalLogService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æ‹‰å–æ“ä½œæ—¥å¿—å…¥åº“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä»»åŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JobExecutionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>{</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(BlogConstants.OPER_LOG_KEY)) {</span><br><span class="line">            Map&lt;Object, Object&gt; entries = redisTemplate.opsForHash().entries(BlogConstants.OPER_LOG_KEY);</span><br><span class="line">            Collection&lt;Object&gt; values = entries.values();</span><br><span class="line">            List&lt;OperationalLog&gt; operationalLogArrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            values.forEach(value -&gt; operationalLogArrayList.add((OperationalLog) value));</span><br><span class="line">            <span class="comment">// æ‰¹é‡ä¿å­˜æ•°æ®</span></span><br><span class="line">            operationalLogService.saveBatch(operationalLogArrayList);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ç«‹å³åˆ é™¤redisä¸­ç›¸åº”çš„æ•°æ®</span></span><br><span class="line">        redisTemplate.delete(BlogConstants.OPER_LOG_KEY);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginLogJob</span> <span class="keyword">implements</span> <span class="title">BaseJob</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginLogService loginLogService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æ‹‰å–ç™»å½•æ—¥å¿—å…¥åº“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä»»åŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JobExecutionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>{</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(BlogConstants.LOGIN_LOG_KEY)) {</span><br><span class="line">            Collection&lt;Object&gt; values = redisTemplate.opsForHash().entries(BlogConstants.LOGIN_LOG_KEY).values();</span><br><span class="line">            List&lt;LoginLog&gt; loginLogArrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            values.forEach(value -&gt; loginLogArrayList.add((LoginLog) value));</span><br><span class="line">            loginLogService.saveBatch(loginLogArrayList);</span><br><span class="line">        }</span><br><span class="line">        redisTemplate.delete(BlogConstants.LOGIN_LOG_KEY);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-controllerå±‚æ¥å£"><a href="#5-controllerå±‚æ¥å£" class="headerlink" title="5. controllerå±‚æ¥å£"></a>5. controllerå±‚æ¥å£</h4><blockquote>
<p>åŒ…æ‹¬è°ƒåº¦ä»»åŠ¡çš„åŸºæœ¬å¢åˆ æ”¹æŸ¥æ¥å£å’Œç›¸åº”çš„å‚æ•°</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api("Quartzè°ƒåº¦æœåŠ¡API")</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/blog/job")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminQuartzController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QuartzService quartzService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("æ ¹æ®ä»»åŠ¡åå’Œä»»åŠ¡ç»„æŸ¥è¯¢ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@GetMapping("/query")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryJobByNameAndGroup</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@RequestParam("jobGroup")</span> String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        ResponseQuartzInfoVO quartzInfoVO = quartzService.queryJobByNameAndGroup(jobName, jobGroup);</span><br><span class="line">        <span class="keyword">return</span> ObjectUtils.isNotEmpty(quartzInfoVO) ? R.ok().data(<span class="string">"item"</span>, quartzInfoVO) : R.error().message(<span class="string">"èµ„æºæœªæ‰¾åˆ°"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = "åˆ†é¡µæŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨", notes = "é…åˆPageHelperåˆ†é¡µæ’ä»¶")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "page", value = "å½“å‰é¡µ", dataType = "Integer", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "limit", value = "æ¯é¡µè®°å½•æ•°", dataType = "Integer", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@GetMapping("/query/list/{page}/{limit}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">queryJobList</span><span class="params">(<span class="meta">@PathVariable("page")</span> Integer page, <span class="meta">@PathVariable("limit")</span> Integer limit)</span> </span>{</span><br><span class="line">        PageHelper.startPage(page, limit);</span><br><span class="line">        List&lt;ResponseQuartzInfoVO&gt; quartzInfoVOList = quartzService.queryJobList();</span><br><span class="line">        PageInfo&lt;ResponseQuartzInfoVO&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(quartzInfoVOList);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">"rows"</span>, pageInfo.getList()).data(<span class="string">"total"</span>, pageInfo.getTotal());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NoRepeatSubmit</span></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.ADD,operDesc = "åˆ›å»ºè°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("åˆ›å»ºä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@PostMapping("/add")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addJob</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> QuartzInfoVo quartzInfoVo)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(quartzInfoVo)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.addJob(quartzInfoVo);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"åˆ›å»ºæˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_CREATE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE,operDesc = "æš‚åœè°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æš‚åœä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@PostMapping("/pause")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">pauseJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName, <span class="meta">@RequestParam("jobGroup")</span> String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.pauseJob(jobName, jobGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æš‚åœæˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_PAUSE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE,operDesc = "æ¢å¤è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æ¢å¤ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@PostMapping("/resume")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">resumeJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName, <span class="meta">@RequestParam("jobGroup")</span> String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.resumeJob(jobName, jobGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æ¢å¤æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_RESUME_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.UPDATE,operDesc = "æ›´æ–°è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("æ›´æ–°ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@PutMapping("/update")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateJob</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> QuartzInfoVo quartzInfoVo)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(quartzInfoVo)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.updateJob(quartzInfoVo.getTriggerName(), quartzInfoVo.getTriggerGroup(),</span><br><span class="line">                    quartzInfoVo.getCronExpression());</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æ›´æ–°æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_UPDATE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OperatingLog(operType = BlogConstants.REMOVE,operDesc = "åˆ é™¤è°ƒåº¦ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiOperation("åˆ é™¤ä»»åŠ¡")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobName", value = "ä»»åŠ¡åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "jobGroup", value = "ä»»åŠ¡ç»„", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "triggerName", value = "è§¦å‘å™¨åç§°", dataType = "String", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "triggerGroup", value = "è§¦å‘å™¨ç»„", dataType = "String", required = true)</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@DeleteMapping("/remove")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeJob</span><span class="params">(<span class="meta">@RequestParam("jobName")</span> String jobName,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("jobGroup")</span> String jobGroup,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("triggerName")</span> String triggerName,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="meta">@RequestParam("triggerGroup")</span> String triggerGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(jobName, jobGroup, triggerName, triggerGroup)) {</span><br><span class="line">            <span class="keyword">return</span> R.setResult(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            quartzService.removeJob(jobName, jobGroup, triggerName, triggerGroup);</span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"åˆ é™¤æˆåŠŸ"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.JOB_DELETE_FAILURE);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="5-1-VOç±»"><a href="#5-1-VOç±»" class="headerlink" title="5.1 VOç±»"></a>5.1 VOç±»</h5><blockquote>
<p>QuartzInfoVoç±»å’ŒResponseQuartzInfoVOç±»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzInfoVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡åç§°")</span></span><br><span class="line">    <span class="keyword">public</span> String jobName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡ç»„ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡ç»„")</span></span><br><span class="line">    <span class="keyword">public</span> String jobGroup;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡ç±»åä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡ç±»å")</span></span><br><span class="line">    <span class="keyword">public</span> String jobClassName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "ä»»åŠ¡æè¿°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("ä»»åŠ¡æè¿°")</span></span><br><span class="line">    <span class="keyword">public</span> String jobDescription;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è§¦å‘å™¨åç§°ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("è§¦å‘å™¨åç§°")</span></span><br><span class="line">    <span class="keyword">public</span> String triggerName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "è§¦å‘å™¨ç»„ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("è§¦å‘å™¨ç»„")</span></span><br><span class="line">    <span class="keyword">public</span> String triggerGroup;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = "cronè¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º")</span></span><br><span class="line">    <span class="meta">@ApiModelProperty("cronè¡¨è¾¾å¼")</span></span><br><span class="line">    <span class="keyword">public</span> String cronExpression;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseQuartzInfoVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String jobName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String jobGroup;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String jobClassName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String jobDescription;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String triggerName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String triggerGroup;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String cronExpression;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String triggerState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prevFireTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nextFireTime;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="6-serviceå±‚å®ç°ç±»"><a href="#6-serviceå±‚å®ç°ç±»" class="headerlink" title="6. serviceå±‚å®ç°ç±»"></a>6. serviceå±‚å®ç°ç±»</h4><blockquote>
<p>controllerå±‚å¯¹åº”æ¥å£çš„å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzServiceImpl</span> <span class="keyword">implements</span> <span class="title">QuartzService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QuartzMapper quartzMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Scheduler scheduler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> quartzInfoVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJob</span><span class="params">(QuartzInfoVo quartzInfoVo)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// å¯åŠ¨è°ƒåº¦å™¨</span></span><br><span class="line">        scheduler.start();</span><br><span class="line">        <span class="comment">// åˆ›å»ºJobDetails</span></span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(reflectClass(quartzInfoVo.getJobClassName()).getClass())</span><br><span class="line">                .withIdentity(quartzInfoVo.getJobName(), quartzInfoVo.getJobGroup())</span><br><span class="line">                .withDescription(quartzInfoVo.getJobDescription())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// åˆ›å»ºcronæ„å»ºå™¨</span></span><br><span class="line">        CronScheduleBuilder cronSchedule = CronScheduleBuilder.cronSchedule(quartzInfoVo.getCronExpression());</span><br><span class="line">        <span class="comment">// åˆ›å»ºè§¦å‘å™¨</span></span><br><span class="line">        CronTrigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(quartzInfoVo.getTriggerName(), quartzInfoVo.getTriggerGroup())</span><br><span class="line">                .withSchedule(cronSchedule)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// å»ºç«‹å…³è”</span></span><br><span class="line">        scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æš‚åœä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pauseJob</span><span class="params">(String jobName, String jobGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        scheduler.pauseJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¢å¤ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resumeJob</span><span class="params">(String jobName, String jobGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        scheduler.resumeJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerGroup</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeJob</span><span class="params">(String jobName, String jobGroup, String triggerName, String triggerGroup)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// æš‚åœè§¦å‘å™¨</span></span><br><span class="line">        scheduler.pauseTrigger(TriggerKey.triggerKey(triggerName, triggerGroup));</span><br><span class="line">        <span class="comment">// ç§»é™¤è§¦å‘å™¨ä¸­ç»‘å®šçš„ä»»åŠ¡</span></span><br><span class="line">        scheduler.unscheduleJob(TriggerKey.triggerKey(triggerName, triggerGroup));</span><br><span class="line">        <span class="comment">// åˆ é™¤ä»»åŠ¡</span></span><br><span class="line">        scheduler.deleteJob(JobKey.jobKey(jobName, jobGroup));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> triggerGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cronExpression</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateJob</span><span class="params">(String triggerName, String triggerGroup, String cronExpression)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºè§¦å‘å™¨å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">        TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroup);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¡¨è¾¾å¼æ„å»ºå™¨(åŠ¨æ€ä¿®æ”¹åä¸ç«‹å³æ‰§è¡Œ)</span></span><br><span class="line">        CronScheduleBuilder cronScheduler = CronScheduleBuilder.cronSchedule(cronExpression)</span><br><span class="line">                .withMisfireHandlingInstructionDoNothing();</span><br><span class="line">        <span class="comment">// è·å–cronç±»å‹è§¦å‘å™¨</span></span><br><span class="line">        CronTrigger trigger = (CronTrigger) scheduler.getTrigger(triggerKey);</span><br><span class="line">        <span class="comment">// æŒ‰ç…§æ–°çš„cronè¡¨è¾¾å¼é‡æ–°æ„å»ºè§¦å‘å™¨</span></span><br><span class="line">        trigger = trigger.getTriggerBuilder().withIdentity(triggerKey)</span><br><span class="line">                .withSchedule(cronScheduler)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// æŒ‰æ–°çš„triggeré‡æ–°è®¾ç½®jobæ‰§è¡Œ</span></span><br><span class="line">        scheduler.rescheduleJob(triggerKey, trigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ResponseQuartzInfoVO&gt; <span class="title">queryJobList</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> quartzMapper.queryJobList();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ä»»åŠ¡åå’Œä»»åŠ¡ç»„æŸ¥è¯¢ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobGroup</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseQuartzInfoVO <span class="title">queryJobByNameAndGroup</span><span class="params">(String jobName, String jobGroup)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> quartzMapper.queryJobByNameAndGroup(jobName, jobGroup);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„è·å–ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> className å®Œæ•´ç±»è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç±»å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BaseJob <span class="title">reflectClass</span><span class="params">(String className)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">return</span> (BaseJob) Class.forName(className).newInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="14-springbootæ•´åˆmongodb"><a href="#14-springbootæ•´åˆmongodb" class="headerlink" title="14.springbootæ•´åˆmongodb"></a>14.springbootæ•´åˆmongodb</h3><blockquote>
<p>è¿™é‡Œï¼š==ä¸»è¦æ˜¯æ•´åˆGridFsTempLateçš„æ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶æŸ¥è¯¢æ˜¾ç¤ºï¼Œæ–‡ä»¶åˆ é™¤ç­‰æ“ä½œ==</p>
<p>å…¶ä»–å¯¹äºæ–‡æ¡£çš„æ“ä½œï¼Œç›´æ¥é¢å‘ç™¾åº¦ç¼–ç </p>
</blockquote>
<h4 id="1-pomæ–‡ä»¶"><a href="#1-pomæ–‡ä»¶" class="headerlink" title="1.pomæ–‡ä»¶"></a>1.pomæ–‡ä»¶</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mongoDB--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-yamlé…ç½®"><a href="#2-yamlé…ç½®" class="headerlink" title="2. yamlé…ç½®"></a>2. yamlé…ç½®</h4><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># mongodbé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">mongo123</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-controlleræµ‹è¯•æ¥å£"><a href="#3-controlleræµ‹è¯•æ¥å£" class="headerlink" title="3.controlleræµ‹è¯•æ¥å£"></a>3.controlleræµ‹è¯•æ¥å£</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.result.R;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.ExceptionUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.common.util.utils.RenameImageUtils;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.base.exception.BlogException;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.service.BlogService;</span><br><span class="line"><span class="keyword">import</span> com.horse.service.blog.vo.ResponseBlogListVO;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.gridfs.GridFSBuckets;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.gridfs.GridFSDownloadStream;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.gridfs.model.GridFSFile;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.bson.types.ObjectId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: é¡¹ç›®æ¥å£æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/22 9:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(value = "AdminTestController", produces = MediaType.APPLICATION_JSON_VALUE, tags = "é¡¹ç›®æµ‹è¯•")</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/test")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminTestController</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GridFsTemplate gridFsTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * gridFsTemplateæ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(httpMethod = "POST", value = "æ–‡ä»¶ä¸Šä¼ å¹¶ä½¿ç”¨GirdFSå­˜å‚¨åˆ°mongoDB")</span></span><br><span class="line">    <span class="meta">@PostMapping("/upload/file")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateFile</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file, HttpServletResponse response)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶çš„æºæ–‡ä»¶å</span></span><br><span class="line">            String originalFilename = file.getOriginalFilename();</span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶æµ</span></span><br><span class="line">            InputStream inputStream = file.getInputStream();</span><br><span class="line">            <span class="comment">// æ–‡ä»¶é‡å‘½å</span></span><br><span class="line">            String newFileName = RenameImageUtils.getRandomImageName(originalFilename);</span><br><span class="line">            <span class="comment">// GirdFSTemplateä¸Šä¼ åˆ°mongodb</span></span><br><span class="line">            ObjectId objectId = gridFsTemplate.store(inputStream, newFileName, file.getContentType());</span><br><span class="line">            log.info(<span class="string">"objectId:"</span> + objectId);</span><br><span class="line">            <span class="comment">// æ ¹æ®idæŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯å¹¶è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> R.ok().message(<span class="string">"æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"</span>).data(<span class="string">"objectId"</span>, objectId.toString());</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.FILE_DELETE_ERROR);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®IDè·å–æ–‡ä»¶å¹¶è¿”å›é¡µé¢(é¡µé¢ä¸Šå¯ä»¥ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œç›¸å½“äºæ–‡ä»¶é¢„è§ˆçš„åŠŸèƒ½)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(httpMethod = "GET", value = "æ ¹æ®æ–‡ä»¶IDè·å–æ–‡ä»¶å¹¶è¿”å›è¾“å‡ºæµ")</span></span><br><span class="line">    <span class="meta">@GetMapping("/query/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFileById</span><span class="params">(<span class="meta">@PathVariable("id")</span> String id, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶(è¿™é‡Œä¹Ÿå¯ä»¥ç¡®å®šæŸä¸€ä¸ªæ•°æ®åº“ï¼Œç„¶åå†configæ–‡ä»¶æ€»å®šä¹‰bucketçš„beanå¯¹è±¡ï¼Œç„¶åç›´æ¥æ³¨å…¥å³å¯)</span></span><br><span class="line">        GridFSFile fsFile = gridFsTemplate.findOne(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).is(id)));</span><br><span class="line">        GridFSBucket gridFSBucket = GridFSBuckets.create(mongoTemplate.getDb());</span><br><span class="line">        <span class="comment">// æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (fsFile != <span class="keyword">null</span>) {</span><br><span class="line">            GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(fsFile.getObjectId());</span><br><span class="line">            <span class="comment">// åˆ›å»ºgirdFsResourceï¼Œä¼ å…¥ä¸‹è½½æµå¯¹è±¡ï¼Œè·å–æµå¯¹è±¡</span></span><br><span class="line">            GridFsResource gridFsResource = <span class="keyword">new</span> GridFsResource(fsFile, gridFSDownloadStream);</span><br><span class="line">            InputStream inputStream = gridFsResource.getInputStream();</span><br><span class="line">            <span class="comment">// å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">            OutputStream outputStream = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> count;</span><br><span class="line">            <span class="keyword">while</span> ((count = inputStream.read(bytes)) != -<span class="number">1</span>) {</span><br><span class="line">                outputStream.write(bytes);</span><br><span class="line">            }</span><br><span class="line">            inputStream.close();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ–‡ä»¶ï¼ˆæ‰¹é‡ï¼šforEachå¾ªç¯åˆ é™¤ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(httpMethod = "DELETE", value = "æ ¹æ®æ–‡ä»¶IDåˆ é™¤æ–‡ä»¶å†…å®¹")</span></span><br><span class="line">    <span class="meta">@DeleteMapping("/remove/{fileId}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeFileById</span><span class="params">(<span class="meta">@PathVariable("fileId")</span> String fileId)</span> </span>{</span><br><span class="line">        gridFsTemplate.delete(Query.query(Criteria.where(<span class="string">"_id"</span>).is(fileId)));</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">"åˆ é™¤æˆåŠŸ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><h3 id="è®¾è®¡æ¨¡å¼æ¦‚å¿µ"><a href="#è®¾è®¡æ¨¡å¼æ¦‚å¿µ" class="headerlink" title="è®¾è®¡æ¨¡å¼æ¦‚å¿µ"></a>è®¾è®¡æ¨¡å¼æ¦‚å¿µ</h3><blockquote>
<p>æœ¬è´¨ï¼šæ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…åº”ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…æ€§ã€ç»§æ‰¿æ€§å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚</p>
<p><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ä¸ƒå¤§åŸåˆ™ï¼š</strong></p>
<ol>
<li>å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li>
<li>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šç»§æ‰¿å¿…é¡»ç¡®ä¿è¶…ç±»æ‰€æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¸­ä»ç„¶æˆç«‹</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™ï¼šè¦é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é¢å‘å®ç°ç¼–ç¨‹</li>
<li>å•ä¸€èŒè´£åŸåˆ™ï¼šæ§åˆ¶ç±»çš„ç²’åº¦å¤§å°ï¼Œå°†å¯¹è±¡è§£è€¦ã€æé«˜å…¶å†…èšæ€§</li>
<li>æ¥å£éš”ç¦»åŸåˆ™ï¼šå°½é‡åšåˆ°ä¸ºå„ä¸ªç±»å»ºç«‹ä»–ä»¬éœ€è¦çš„ä¸“ç”¨æ¥å£</li>
<li>è¿ªç±³ç‰¹æ³•åˆ™ï¼šåªä¸ä½ çš„ç›´æ¥æœ‹å‹äº¤è°ˆï¼Œä¸è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯</li>
<li>åˆæˆå¤ç”¨åŸåˆ™ï¼šå°½é‡å…ˆä½¿ç”¨ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°</li>
</ol>
</blockquote>
<h3 id="åŸºæœ¬è®¾è®¡æ¨¡å¼"><a href="#åŸºæœ¬è®¾è®¡æ¨¡å¼" class="headerlink" title="åŸºæœ¬è®¾è®¡æ¨¡å¼"></a>åŸºæœ¬è®¾è®¡æ¨¡å¼</h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><blockquote>
<p>å•ä¾‹æ¨¡å¼ï¼š</p>
</blockquote>
<h4 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h4><blockquote>
<p>å·¥å‚æ¨¡å¼æœ¬è´¨ï¼š</p>
<ul>
<li>å®ä¾‹åŒ–å¯¹è±¡ä¸å†ä½¿ç”¨newå¯¹è±¡çš„æ–¹å¼ï¼Œè€Œæ˜¯ç”¨å·¥å‚æ–¹æ³•ä»£æ›¿</li>
<li>å°†é€‰æ‹©å®ç°ç±»ã€åˆ›å»ºå¯¹è±¡è¿›è¡Œç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ï¼Œä»è€Œå°†è°ƒç”¨è€…è·Ÿæˆ‘ä»¬çš„å®ç°ç±»è§£è€¦</li>
</ul>
<p>ä¸‰ç§æ¨¡å¼ï¼š</p>
<ul>
<li><strong>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆæœ€ç®€å•ã€æœ€å¸¸ç”¨ï¼‰</strong><ul>
<li>ç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ä¸­çš„ä»»æ„äº§å“ï¼ˆå¯¹äºæ–°å¢çš„äº§å“ï¼Œéœ€è¦æ‰©å±•åŸæœ‰çš„ä»£ç ï¼Œä¸å¤ªç¬¦åˆå¼€é—­åŸåˆ™ï¼‰</li>
<li>æŸç§ç¨‹åº¦ä¸Šä¸ç¬¦åˆè®¾è®¡åŸåˆ™ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨æœ€å¤šã€‚</li>
</ul>
</li>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼<ul>
<li>ç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„å›ºå®šäº§å“ï¼ˆæ”¯æŒå¢åŠ ä»»æ„äº§å“ï¼‰</li>
<li>ä¸ä¿®æ”¹å·²æœ‰ç±»çš„å‰æä¸‹ï¼Œé€šè¿‡å¢åŠ æ–°çš„å·¥å‚ç±»å®ç°å¯¹å…¶çš„æ‰©å±•</li>
</ul>
</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼<ul>
<li>å›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚ï¼Œè¯¥è¶…çº§å·¥å‚åˆè¢«ç§°ä¸ºå…¶ä»–å·¥å‚çš„å·¥å‚</li>
<li>ä¸å¯ä»¥ç®€å•çš„å¢åŠ äº§å“ï¼Œè€Œæ˜¯å¢åŠ ä¸€ä¸ªäº§å“é›†</li>
</ul>
</li>
</ul>
</blockquote>
<p>==ç¤ºä¾‹:ç®€å•å·¥å‚æ¨¡å¼==</p>
<p>Car.interface</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>CarFactory.class</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>WuLing.class</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>DaZong.class</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Restfulé£æ ¼ï¼ˆå‰åç«¯ä¸åˆ†ç¦»ï¼‰"><a href="#Restfulé£æ ¼ï¼ˆå‰åç«¯ä¸åˆ†ç¦»ï¼‰" class="headerlink" title="Restfulé£æ ¼ï¼ˆå‰åç«¯ä¸åˆ†ç¦»ï¼‰"></a>Restfulé£æ ¼ï¼ˆå‰åç«¯ä¸åˆ†ç¦»ï¼‰</h2><h3 id="åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼ˆputå’Œdeleteè¯·æ±‚ï¼‰"><a href="#åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼ˆputå’Œdeleteè¯·æ±‚ï¼‰" class="headerlink" title="åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼ˆputå’Œdeleteè¯·æ±‚ï¼‰"></a>åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼ˆputå’Œdeleteè¯·æ±‚ï¼‰</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">                   å‘é€putè¯·æ±‚ï¼Œ(ä¸‹é¢çš„æ“ä½œå°±æ˜¯è¦æŠŠpostè¯·æ±‚è½¬æ¢æˆputè¯·æ±‚)ä¿®æ”¹å‘˜å·¥æ•°æ®:</span><br><span class="line">                       <span class="number">1</span>ã€SpringMVCæˆ–springbootä¸­é…ç½®HiddenHttpMethodFilter;</span><br><span class="line">                       <span class="number">2</span>ã€é¡µé¢è¦æœ‰ä¸€ä¸ªpostè¡¨å•</span><br><span class="line">                       <span class="number">3</span>ã€åˆ›å»ºä¸€ä¸ªinputé¡¹ï¼Œname=<span class="string">"_method"</span>;valueå€¼å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼</span><br><span class="line">               --&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-HiddenHttpMethodFilterç±»è¿›è¡Œé…ç½®å¼€å¯"><a href="#1-HiddenHttpMethodFilterç±»è¿›è¡Œé…ç½®å¼€å¯" class="headerlink" title="1.HiddenHttpMethodFilterç±»è¿›è¡Œé…ç½®å¼€å¯"></a>1.HiddenHttpMethodFilterç±»è¿›è¡Œé…ç½®å¼€å¯</h4><figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">Springbooté…ç½®ï¼š</span></span><br><span class="line"><span class="comment">#å¼€å¯Springbootä¸­é…ç½®çš„HiddenHttpMethodFilterï¼Œspring boot2.0,é»˜è®¤æ˜¯falseå…³é—­çš„</span></span><br><span class="line"><span class="comment">#ç”¨äºå°†postè¯·æ±‚è½¬æ¢æˆputï¼Œdelete è¯·æ±‚çš„æ“ä½œ</span></span><br><span class="line"><span class="meta">spring.mvc.hiddenmethod.filter.enabled</span>=<span class="string">true</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">SpringMVCé…ç½®ï¼š</span><br><span class="line"><span class="comment">&lt;!-- æ”¯æŒGETã€POSTã€PUTä¸DELETEè¯·æ±‚ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-é¡µé¢åˆ›å»ºä¸€ä¸ªformè¡¨å•ï¼Œaction-â€postâ€-ä¸€èˆ¬æ¥è¯´æ›´æ–°å’Œåˆ é™¤éƒ½ä¼šæœ‰formè¡¨å•"><a href="#2-é¡µé¢åˆ›å»ºä¸€ä¸ªformè¡¨å•ï¼Œaction-â€postâ€-ä¸€èˆ¬æ¥è¯´æ›´æ–°å’Œåˆ é™¤éƒ½ä¼šæœ‰formè¡¨å•" class="headerlink" title="2.é¡µé¢åˆ›å»ºä¸€ä¸ªformè¡¨å•ï¼Œaction=â€postâ€(ä¸€èˆ¬æ¥è¯´æ›´æ–°å’Œåˆ é™¤éƒ½ä¼šæœ‰formè¡¨å•)"></a>2.é¡µé¢åˆ›å»ºä¸€ä¸ªformè¡¨å•ï¼Œaction=â€postâ€(ä¸€èˆ¬æ¥è¯´æ›´æ–°å’Œåˆ é™¤éƒ½ä¼šæœ‰formè¡¨å•)</h3><h4 id="putè¯·æ±‚ï¼ˆ-PutMappingï¼‰"><a href="#putè¯·æ±‚ï¼ˆ-PutMappingï¼‰" class="headerlink" title="putè¯·æ±‚ï¼ˆ@PutMappingï¼‰"></a>putè¯·æ±‚ï¼ˆ@PutMappingï¼‰</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">&lt;form th:action=<span class="string">"@{/emp}"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> th:value=<span class="string">"put"</span>/&gt;  <span class="comment">//è¿™è¡Œå¿…é¡»å†™</span></span><br><span class="line">            &lt;!--æ·»åŠ æäº¤è¢«ä¿®æ”¹çš„å‘˜å·¥id--&gt;</span><br><span class="line">            &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"id"</span> th:value=<span class="string">"${employee.id}"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åä¿®æ”¹æäº¤è¡¨å•å³å¯ã€‚</p>
<h4 id="deleteè¯·æ±‚ï¼ˆä¸‹é¢è¿™æ ·åˆ†å¼€å†™æ˜¯ä¸ºäº†ä¸è®©é¡µé¢å˜å½¢ï¼‰-DeleteMapping"><a href="#deleteè¯·æ±‚ï¼ˆä¸‹é¢è¿™æ ·åˆ†å¼€å†™æ˜¯ä¸ºäº†ä¸è®©é¡µé¢å˜å½¢ï¼‰-DeleteMapping" class="headerlink" title="deleteè¯·æ±‚ï¼ˆä¸‹é¢è¿™æ ·åˆ†å¼€å†™æ˜¯ä¸ºäº†ä¸è®©é¡µé¢å˜å½¢ï¼‰ @DeleteMapping"></a>deleteè¯·æ±‚ï¼ˆä¸‹é¢è¿™æ ·åˆ†å¼€å†™æ˜¯ä¸ºäº†ä¸è®©é¡µé¢å˜å½¢ï¼‰ <strong>@DeleteMapping</strong></h4><p>1.åˆ›å»ºä¸€ä¸ªbuttonåˆ é™¤æŒ‰é’®<strong>,å¹¶ä½¿ç”¨th:attr()æ·»åŠ è‡ªå®šä¹‰çš„å±æ€§ï¼ˆå°±æ˜¯åˆ é™¤æäº¤çš„urlï¼‰</strong></p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn btn-sm btn-danger deleteBtn"</span> th:attr=<span class="string">"delete_uri=@{/emp/{id}(id=${emp.id})}"</span> </span><br><span class="line">    	 value="åˆ é™¤"&gt;åˆ é™¤&lt;/button&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>2.åœ¨å¤–é¢æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªformè¡¨å•</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--åˆ é™¤æŒ‰é’®çš„è¡¨å•--&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> id=<span class="string">"deleteEmpForm"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_method"</span> value=<span class="string">"delete"</span>/&gt;  <span class="comment">//è¿™è¡Œå¿…é¡»å†™</span></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>3.ä½¿ç”¨jsè¿›è¡Œç‚¹å‡»åˆ é™¤æŒ‰é’®æäº¤è¡¨å•æ—¶é—´ç»‘å®š</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="comment">//ç»‘å®šåˆ é™¤æŒ‰é’®å•å‡»æäº¤è¡¨å•äº‹ä»¶</span></span><br><span class="line">    $(<span class="string">".deleteBtn"</span>).click(function () {</span><br><span class="line">    	<span class="comment">//ä¸ºformè¡¨å•æ·»åŠ actionå±æ€§ï¼Œurlå€¼ä»buttomæŒ‰é’®ä¸­è·å–</span></span><br><span class="line">    	<span class="comment">//ä¸€å®šè¦ä½¿ç”¨$(this)ï¼šè¡¨ç¤ºå½“å‰ç‚¹å‡»çš„é‚£ä¸ªæŒ‰é’®ï¼Œä¸èƒ½ä½¿ç”¨$(".del-btn"),è¦ä¸ç„¶å°±ä¼šé»˜è®¤åŒ¹é…ç¬¬ä¸€ä¸ªæŒ‰é’®</span></span><br><span class="line">        $(<span class="string">"#deleteEmpForm"</span>).attr(<span class="string">"action"</span>,$(<span class="keyword">this</span>).attr(<span class="string">"delete_uri"</span>)).submit();</span><br><span class="line">        <span class="comment">//å–æ¶ˆéšè—å±æ€§ï¼ˆå›ºå®šçš„ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    })</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·ç‚¹å‡»æäº¤å°±å¯ä»¥äº†ã€‚</p>
<h2 id="Swagger-uiï¼ˆå¢å¼ºç‰ˆï¼‰"><a href="#Swagger-uiï¼ˆå¢å¼ºç‰ˆï¼‰" class="headerlink" title="Swagger-uiï¼ˆå¢å¼ºç‰ˆï¼‰"></a>Swagger-uiï¼ˆå¢å¼ºç‰ˆï¼‰</h2><h4 id="1-pomæ–‡ä»¶-1"><a href="#1-pomæ–‡ä»¶-1" class="headerlink" title="1. pomæ–‡ä»¶"></a>1. pomæ–‡ä»¶</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--knife4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-å•ä½“æ¶æ„ç”¨-package"><a href="#2-å•ä½“æ¶æ„ç”¨-package" class="headerlink" title="2. å•ä½“æ¶æ„ç”¨(package)"></a>2. å•ä½“æ¶æ„ç”¨(package)</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySwaggerConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">apiAdmin</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯devç¯å¢ƒ,proçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸éœ€è¦æ¥å£æ–‡æ¡£ä¿¡æ¯*/</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">"dev"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(flag)</span><br><span class="line">                .host(<span class="string">"localhost:8080"</span>)</span><br><span class="line">                .groupName(<span class="string">"admin"</span>)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.horse.blog.controller.admin"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">apiGithub</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯devç¯å¢ƒ,proçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸éœ€è¦æ¥å£æ–‡æ¡£ä¿¡æ¯*/</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">"dev"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(flag)</span><br><span class="line">                .host(<span class="string">"localhost:8080"</span>)</span><br><span class="line">                .groupName(<span class="string">"github"</span>)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.horse.blog.controller.github"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">apiKaptcha</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯devç¯å¢ƒ,proçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸éœ€è¦æ¥å£æ–‡æ¡£ä¿¡æ¯*/</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">"dev"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(flag)</span><br><span class="line">                .host(<span class="string">"localhost:8080"</span>)</span><br><span class="line">                .groupName(<span class="string">"kaptcha"</span>)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.horse.blog.controller.kaptcha"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">apiPortal</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯devç¯å¢ƒ,proçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸éœ€è¦æ¥å£æ–‡æ¡£ä¿¡æ¯*/</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">"dev"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(flag)</span><br><span class="line">                .host(<span class="string">"localhost:8080"</span>)</span><br><span class="line">                .groupName(<span class="string">"portal"</span>)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.horse.blog.controller.portal"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">apiVue</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯devç¯å¢ƒ,proçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸éœ€è¦æ¥å£æ–‡æ¡£ä¿¡æ¯*/</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">"dev"</span>);</span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(flag)</span><br><span class="line">                .host(<span class="string">"localhost:8080"</span>)</span><br><span class="line">                .groupName(<span class="string">"vue"</span>)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.horse.blog.controller.vue"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"Horse Blog System"</span>)</span><br><span class="line">                .description(<span class="string">"Horse Blog System Interface documentation"</span>)</span><br><span class="line">                .version(<span class="string">"V2.0"</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"horse"</span>, <span class="string">"http://www.horsemuzi.top"</span>, <span class="string">"3468449362@qq.com"</span>))</span><br><span class="line">                .license(<span class="string">"æŸ¥çœ‹ã€Horse Blog 2.0ã€‘ç‰ˆæœ¬&lt;==&gt;å…¬ç½‘IPï¼šhttp:www.horsemuzi.top"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-åˆ†å¸ƒå¼æ¶æ„ï¼ˆURLï¼‰"><a href="#3-åˆ†å¸ƒå¼æ¶æ„ï¼ˆURLï¼‰" class="headerlink" title="3. åˆ†å¸ƒå¼æ¶æ„ï¼ˆURLï¼‰"></a>3. åˆ†å¸ƒå¼æ¶æ„ï¼ˆURLï¼‰</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/7/30 12:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySwaggerConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">"webApi"</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//åªæ˜¾ç¤ºapiè·¯å¾„ä¸‹çš„é¡µé¢</span></span><br><span class="line">                .paths(Predicates.and(PathSelectors.regex(<span class="string">"/api/.*"</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">adminApiConfig</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">"adminApi"</span>)</span><br><span class="line">                .apiInfo(adminApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//åªæ˜¾ç¤ºadminè·¯å¾„ä¸‹çš„é¡µé¢</span></span><br><span class="line">                .paths(Predicates.and(PathSelectors.regex(<span class="string">"/admin/.*"</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"ç½‘ç«™æ¥å£-APIæ–‡æ¡£"</span>)</span><br><span class="line">                .description(<span class="string">"æœ¬æ–‡æ¡£æè¿°äº†ç½‘ç«™å¾®æœåŠ¡æ¥å£å®šä¹‰"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"mabin"</span>, <span class="string">"http://www.horsemuzi.top"</span>, <span class="string">"3468449362@qq.com"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">adminApiInfo</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"åå°ç®¡ç†ç³»ç»Ÿ-APIæ–‡æ¡£"</span>)</span><br><span class="line">                .description(<span class="string">"æœ¬æ–‡æ¡£æè¿°äº†åå°ç®¡ç†ç³»ç»Ÿå¾®æœåŠ¡æ¥å£å®šä¹‰"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"mabin"</span>, <span class="string">"http://www.horsemuzi.top"</span>, <span class="string">"3468449362@qq.com"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¸¸ç”¨æ³¨è§£ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Api</td>
<td style="text-align:left"><strong>ä¿®é¥°æ•´ä¸ªç±»ï¼Œ</strong>æè¿°Controllerçš„ä½œç”¨</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td style="text-align:left">æè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…ä¸€ä¸ªæ¥å£ï¼ˆ<strong>ä¸»è¦æ˜¯æ¥å£</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiParam</td>
<td style="text-align:left"><strong>æ¥å£</strong>æ–¹æ³•ä¸­å•ä¸ªå‚æ•°æè¿°</td>
</tr>
<tr>
<td>@ApiModel</td>
<td style="text-align:left">ç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°ï¼ˆ<strong>æè¿°Modelå®ä½“ç±»</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td style="text-align:left">ç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œï¼ˆ<strong>æè¿°å®ä½“ç±»çš„ä¸€ä¸ªå­—æ®µ</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiResponse</td>
<td style="text-align:left">HTTPå“åº”å…¶ä¸­1ä¸ªæè¿°ï¼ˆ<strong>å¯¹äºå“åº”çš„code,å’Œç›¸åº”çš„messageå«ä¹‰çš„æè¿°</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiResponses</td>
<td style="text-align:left">HTTPå“åº”æ•´ä½“æè¿°ï¼ˆ<strong>æ­¤æ³¨è§£æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰çš„@ApiResponseæ³¨è§£æè¿°</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiIgnore</td>
<td style="text-align:left">ä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPI</td>
</tr>
<tr>
<td>@ApiError</td>
<td style="text-align:left">å‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>@ApiImplicitParam</td>
<td style="text-align:left">ä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼ˆ<strong>å¯¹è¯·æ±‚å‚æ•°çš„name:å‚æ•°åç§°ï¼Œå¿…é¡»ä¸€è‡´ï¼Œvalue:å‚æ•°å«ä¹‰ï¼Œtype:å‚æ•°ç±»å‹</strong>ï¼‰</td>
</tr>
<tr>
<td>@ApiImplicitParams</td>
<td style="text-align:left">å¤šä¸ªè¯·æ±‚å‚æ•°ï¼ˆ<strong>é‡Œé¢æ˜¯å¤šä¸ª@ApiImplicitParamå¯¹æ¯ä¸ªå‚æ•°çš„æè¿°</strong>ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h2 id="MybatisåŠ¨æ€SQL"><a href="#MybatisåŠ¨æ€SQL" class="headerlink" title="MybatisåŠ¨æ€SQL"></a>MybatisåŠ¨æ€SQL</h2><h3 id="setæ ‡ç­¾"><a href="#setæ ‡ç­¾" class="headerlink" title="setæ ‡ç­¾"></a>setæ ‡ç­¾</h3><blockquote>
<p>set å…ƒç´ ä¼šåŠ¨æ€å‰ç½® SET å…³é”®å­—ï¼ŒåŒæ—¶åˆ é™¤æ‰æœ€åä¸€ä¸ªsetå±æ€§è¯­å¥çš„é€—å·</p>
<p>ä¾‹å¦‚ï¼šå› ä¸ºç”¨çš„æ˜¯â€œifâ€å…ƒç´ ï¼Œè‹¥æœ€åä¸€ä¸ªâ€œifâ€æ²¡æœ‰åŒ¹é…ä¸Šè€Œå‰é¢çš„åŒ¹é…ä¸Šï¼ŒSQL è¯­å¥çš„æœ€åå°±ä¼šæœ‰ä¸€ä¸ªé€—å·é—ç•™</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateBySet"</span> <span class="attr">parameterType</span>=<span class="string">"com.horse.service.blog.entity.Blog"</span>&gt;</span></span><br><span class="line">    UPDATE tb_blog tb</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"blog.title != null and blog.title != ''"</span>&gt;</span></span><br><span class="line">            tb.title = #{blog.title},</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"blog.version == null"</span>&gt;</span></span><br><span class="line">            tb.version = tb.version + 1</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    WHERE tb.id = #{blog.id}</span><br><span class="line">      and tb.is_deleted = 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡ŒSQL:</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># è‡ªåŠ¨åˆ é™¤æ‰äº†titleåé¢çš„é€—å·</span><br><span class="line">UPDATE tb_blog tb <span class="keyword">SET</span> tb.title <span class="operator">=</span> ? <span class="keyword">WHERE</span> tb.id <span class="operator">=</span> ? <span class="keyword">and</span> tb.is_deleted <span class="operator">=</span> </span><br></pre></td></tr></tbody></table></figure>
<h3 id="chooseæ ‡ç­¾"><a href="#chooseæ ‡ç­¾" class="headerlink" title="chooseæ ‡ç­¾"></a>chooseæ ‡ç­¾</h3><blockquote>
<p>æœ‰æ—¶æˆ‘ä»¬ä¸æƒ³åº”ç”¨åˆ°æ‰€æœ‰çš„æ¡ä»¶ï¼Œè€Œåªæƒ³ä»ä¸­æ‹©å…¶ä¸€é¡¹ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒMyBatis æä¾›äº† choose å…ƒç´ ï¼Œå®ƒæœ‰ç‚¹åƒ Java ä¸­çš„ switch è¯­å¥ã€‚åªè¦æœ‰ä¸€é¡¹æ¡ä»¶æ»¡è¶³è¦æ±‚ï¼Œå°±ä¸å†æ‰§è¡Œåé¢æ¡ä»¶çš„åˆ¤æ–­å•¦ã€‚</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlogByChoose"</span> <span class="attr">parameterType</span>=<span class="string">"com.horse.service.blog.entity.Blog"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">"com.horse.service.blog.entity.Blog"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM tb_blog tb</span><br><span class="line">            WHERE tb.is_deleted = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"blog.title != null and blog.title != ''"</span>&gt;</span></span><br><span class="line">            AND tb.title LIKE #{blog.title}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"blog.version != null"</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[</span><br><span class="line">            AND tb.version &gt;= 1</span><br><span class="line">            ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            AND tb.id = #{blog.id}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡ŒSQL:</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># titleæ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥åé¢çš„æ¡ä»¶ä¸åœ¨è¿›è¡Œåˆ¤æ–­ï¼Œç›´æ¥æ‰§è¡Œ<span class="keyword">sql</span>è¯­å¥ï¼Œå¦‚æœä¸¤ä¸ª<span class="keyword">when</span>æ ‡ç­¾ä¸­çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆç›´æ¥æ‰§è¡Œotherwiseæ ‡ç­¾ä¸­çš„å†…å®¹</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_blog tb <span class="keyword">WHERE</span> tb.is_deleted <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> tb.title <span class="keyword">LIKE</span> ?</span><br></pre></td></tr></tbody></table></figure>
<h3 id="trimæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰"><a href="#trimæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰" class="headerlink" title="trimæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰"></a>trimæ ‡ç­¾ï¼ˆä¸å¸¸ç”¨ï¼‰</h3><blockquote>
<p>å¸¸ç”¨å±æ€§ï¼š</p>
<ul>
<li>prefix=â€whereâ€   ç»™ç¬¬ä¸€ç¬¦åˆæ¡ä»¶çš„è¯­å¥ åŠ ä¸Šå‰ç¼€where</li>
<li>prefixOverrides=â€andâ€  å°†æœ€åä¸€æ¡è¯­å¥çš„ å‰ç¼€and è¦†ç›–</li>
<li>suffix=â€andâ€   ç»™ç¬¬ä¸€ç¬¦åˆæ¡ä»¶çš„è¯­å¥ åŠ ä¸Šåç¼€ and</li>
<li>suffixOverrides=â€andâ€   å°†æœ€åä¸€æ¡è¯­å¥çš„åç¼€ and </li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlogByTrim"</span> <span class="attr">parameterType</span>=<span class="string">"com.horse.service.blog.entity.Blog"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">// è¡¨ç¤ºç»™ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è¯­å¥å‰åŠ  whereï¼ŒæŠŠæœ€åä¸€ä¸ªè¯­å¥çš„suffixOverrides="and" æŒ‡å®šçš„and è¦†ç›–æ‰</span><br><span class="line">        SELECT *</span><br><span class="line">        FROM tb_blog tb</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">prefixOverrides</span>=<span class="string">"or"</span> <span class="attr">suffixOverrides</span>=<span class="string">"and"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"blog.title != null and blog.title != ''"</span>&gt;</span></span><br><span class="line">                tb.title LIKE #{blog.title} AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"blog.id != null and blog.id != ''"</span>&gt;</span></span><br><span class="line">                tb.id = #{blog.id} AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡ŒSQL:</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"># è‡ªåŠ¨åœ¨æ·»åŠ ä¸€ä¸ª<span class="keyword">where</span>å‰ç¼€ï¼Œè¦†ç›–æœ€åä¸€ä¸ªè¯­å¥çš„åç¼€</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_blog tb <span class="keyword">where</span> tb.title <span class="keyword">LIKE</span> ? <span class="keyword">AND</span> tb.id <span class="operator">=</span> ? </span><br></pre></td></tr></tbody></table></figure>
<h3 id="foreachå¾ªç¯æ ‡ç­¾"><a href="#foreachå¾ªç¯æ ‡ç­¾" class="headerlink" title="foreachå¾ªç¯æ ‡ç­¾"></a>foreachå¾ªç¯æ ‡ç­¾</h3><blockquote>
<p>å¸¸ç”¨å±æ€§ï¼š</p>
<ul>
<li>collection: è¦éå†çš„é›†åˆï¼ˆlistï¼Œsetï¼Œmapç­‰ï¼‰</li>
<li>item: è¦éå†çš„é›†åˆå…ƒç´ </li>
<li>indexï¼šå…ƒç´ åœ¨é›†åˆä¸­çš„ç´¢å¼•ï¼ˆå¦‚æœæ˜¯mapé›†åˆï¼Œindexæ ‡è¯†å…ƒç´ çš„å¯¹åº”çš„keyï¼‰</li>
<li>openï¼šéå†ä»¥ä»€ä¹ˆå¼€å¤´ æ¯”å¦‚ open=â€and id in (â€œ</li>
<li>sepratorï¼š éå†å‡ºæ¥çš„å…ƒç´ ä»¥ä»€ä¹ˆåˆ†éš”</li>
<li>endï¼š éå†ä»¥ä»€ä¹ˆç»“æŸ end=â€)â€</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">  //æ‰¹é‡æ’å…¥</span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveCategoryAndBrand"</span> <span class="attr">parameterType</span>=<span class="string">"long"</span>&gt;</span></span><br><span class="line">       insert into tb_category_brand (category_id, brand_id) values</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"cids"</span> <span class="attr">item</span>=<span class="string">"cid"</span> <span class="attr">index</span>=<span class="string">"index"</span>  <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">           (#{cid},#{brandId})</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">//æ‰¹é‡åˆ é™¤</span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteStockBySkuId"</span> <span class="attr">parameterType</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">       delete from tb_stock where sku_id in</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"skuIds"</span> <span class="attr">item</span>=<span class="string">"skuId"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">           #{skuId}</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">//æ‰¹é‡æŸ¥è¯¢å’Œæ‰¹é‡åˆ é™¤ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨å…³é”®å­—ï¼šin</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ ‘å½¢ç»“æ„ï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰"><a href="#æ ‘å½¢ç»“æ„ï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰" class="headerlink" title="æ ‘å½¢ç»“æ„ï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰"></a>æ ‘å½¢ç»“æ„ï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">//é›†åˆåµŒå¥—æŸ¥è¯¢ï¼šæ ‘å½¢ç»“æ„çš„é‚£ç§æ•°æ®æŸ¥è¯¢ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„streamæµè¿›è¡Œæ•°æ®æ“ä½œ...ï¼‰    </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"subjectTreeVo"</span> <span class="attr">type</span>=<span class="string">"com.horse.service.edu.entity.vo.SubjectTreeVo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"title"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sort"</span> <span class="attr">property</span>=<span class="string">"sort"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"children"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">ofType</span>=<span class="string">"com.horse.service.edu.entity.vo.SubjectTreeVo"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">"listNestedSubject"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listNestedSubject"</span> <span class="attr">resultMap</span>=<span class="string">"subjectTreeVo"</span>&gt;</span></span><br><span class="line">        select id,title,sort from edu_subject where parent_id=#{parentId}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ¨¡æ‹Ÿåœºæ™¯ï¼šè€å¸ˆå¯¹å­¦ç”Ÿï¼šä¸€å¯¹å¤šå…³ç³»ï¼Œå­¦ç”Ÿå¤šè€å¸ˆï¼šå¤šå¯¹ä¸€</p>
<p>æ³¨æ„ï¼šå…¶å®å…³ç³»æ˜¯ä¸å‡†ç¡®çš„ï¼Œè€å¸ˆå’Œå­¦ç”Ÿåº”è¯¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè¿™é‡Œé‡ç‚¹æ˜¯æ¨¡æ‹Ÿåœºæ™¯å…³ç³»ï¼Œç†è§£å³å¯ã€‚</p>
</blockquote>
<h3 id="collectionæ ‡ç­¾"><a href="#collectionæ ‡ç­¾" class="headerlink" title="collectionæ ‡ç­¾"></a>collectionæ ‡ç­¾</h3><blockquote>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ä¸€å¯¹å¤šå•æ¡æ•°æ®æŸ¥è¯¢<ul>
<li>collectionåµŒå¥—ç»“æœæŸ¥è¯¢æ–¹å¼é€‚ç”¨</li>
</ul>
</li>
<li>ä¸€å¯¹å¤šåˆ†é¡µï¼ˆå¤šæ¡ï¼‰æ•°æ®æŸ¥è¯¢<ul>
<li>collectionçš„åµŒå¥—ç»“æœæ–¹å¼ä¹Ÿå¯ä»¥åšï¼ˆæ¨èä½¿ç”¨ï¼‰</li>
<li>collectionçš„åµŒå¥—å­æŸ¥è¯¢æ–¹å¼é€‚ç”¨ï¼ˆä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼‰</li>
</ul>
</li>
</ul>
</blockquote>
<p>xmlæ–‡ä»¶</p>
<p>==æ¨èä½¿ç”¨çš„æ–¹å¼ï¼ˆæå…¶é‡è¦çš„ä½¿ç”¨æ–¹æ³•ï¼‰==</p>
<blockquote>
<p>åˆ†é¡µæŸ¥è¯¢åšå®¢åˆ—è¡¨ï¼Œæ¯ä¸ªåšå®¢å¯¹åº”æ ‡ç­¾æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"blogOneToManyTagMap"</span> <span class="attr">type</span>=<span class="string">"responseBlogListVO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tb_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_title"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_picture"</span> <span class="attr">property</span>=<span class="string">"picture"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_flag"</span> <span class="attr">property</span>=<span class="string">"flag"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_views"</span> <span class="attr">property</span>=<span class="string">"views"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tc_id"</span> <span class="attr">property</span>=<span class="string">"categoryId"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tc_name"</span> <span class="attr">property</span>=<span class="string">"categoryName"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tbc_description"</span> <span class="attr">property</span>=<span class="string">"description"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_publish"</span> <span class="attr">property</span>=<span class="string">"publish"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tb_create"</span> <span class="attr">property</span>=<span class="string">"gmtCreate"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"tags"</span> <span class="attr">ofType</span>=<span class="string">"tag"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tt_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tt_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogListByPage"</span> <span class="attr">resultMap</span>=<span class="string">"blogOneToManyTagMap"</span>&gt;</span></span><br><span class="line">        select blog.id           as tb_id,</span><br><span class="line">               blog.title        as tb_title,</span><br><span class="line">               blog.picture      as tb_picture,</span><br><span class="line">               blog.flag         as tb_flag,</span><br><span class="line">               blog.views        as tb_views,</span><br><span class="line">               blog.is_publish   as tb_publish,</span><br><span class="line">               blog.gmt_create   as tb_create,</span><br><span class="line">               tc.id           as tc_id,</span><br><span class="line">               tc.name         as tc_name,</span><br><span class="line">               tbc.description as tbc_description,</span><br><span class="line">               tt.id           as tt_id,</span><br><span class="line">               tt.name         as tt_name</span><br><span class="line">        from (</span><br><span class="line">        select id,title,picture,flag,views,is_publish,gmt_create,category_id from tb_blog</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            is_deleted=1</span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null and title != ''"</span>&gt;</span></span><br><span class="line">                and title like concat('%',#{title},'%')</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        limit #{page},#{limit}</span><br><span class="line">        ) blog left JOIN tb_category tc</span><br><span class="line">                           ON blog.category_id = tc.id</span><br><span class="line">                 LEFT JOIN tb_blog_content tbc</span><br><span class="line">                           ON blog.id = tbc.blog_id</span><br><span class="line">                 LEFT JOIN tb_blog_tag tbt</span><br><span class="line">                           ON blog.id = tbt.blog_id</span><br><span class="line">                 LEFT JOIN tb_tag tt</span><br><span class="line">                           ON tbt.tag_id = tt.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä»–çš„ç®€å•æ–¹å¼</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åµŒå¥—ç»“æœæ–¹å¼ ï¼ˆæ¨èä½¿ç”¨ï¼‰--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"oneToMany"</span> <span class="attr">type</span>=<span class="string">"com.horse.blog.entity.Teacher"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"TId"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"TName"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"TAge"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"studentList"</span> <span class="attr">ofType</span>=<span class="string">"com.horse.blog.entity.Student"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SName"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SAge"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"oneTeacherToManyStudent"</span> <span class="attr">parameterType</span>=<span class="string">"long"</span> <span class="attr">resultMap</span>=<span class="string">"oneToMany"</span>&gt;</span></span><br><span class="line">       select tt.id as TId,tt.name as tName,tt.age as TAge,ts.name as SName,ts.age as SAge</span><br><span class="line">       from tb_teacher tt</span><br><span class="line">                inner join tb_teacher_student_relation ttsr on tt.id = ttsr.tid</span><br><span class="line">                inner join tb_student ts on ttsr.sid = ts.id</span><br><span class="line">       where tt.id = #{id}</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--åµŒå¥—å­æŸ¥è¯¢æ–¹å¼ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œå®é™…å·¥ä½œä¸­æŸ¥è¯¢æ•ˆç‡æä½ï¼‰--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"oneToManyTwo"</span> <span class="attr">type</span>=<span class="string">"com.horse.blog.entity.Teacher"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> // IDçš„å‡ºå¤„</span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"studentList"</span> <span class="attr">ofType</span>=<span class="string">"com.horse.blog.entity.Student"</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">select</span>=<span class="string">"getStudent"</span>/&gt;</span> // è¿™é‡Œçš„idæ¥æºå°±æ˜¯ä¸Šé¢çš„id,è€Œä¸”idçš„åå­—è¦ç›¸åŒ</span><br><span class="line">       </span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"oneTeacherToManyStudentTwo"</span> <span class="attr">resultMap</span>=<span class="string">"oneToManyTwo"</span>&gt;</span></span><br><span class="line">       select * from tb_teacher</span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null and id != ''"</span>&gt;</span></span><br><span class="line">               id=#{id}</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getStudent"</span> <span class="attr">resultType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">       select ts.* from tb_teacher tt</span><br><span class="line">                inner join tb_teacher_student_relation ttsr on tt.id = ttsr.tid</span><br><span class="line">                inner join tb_student ts on ttsr.sid = ts.id</span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null and id != ''"</span>&gt;</span></span><br><span class="line">               tt.id=#{id}  // è¿™é‡Œçš„idæ¥è‡ªä¸Šä¸€ä¸ªæŸ¥è¯¢å‡ºæ¥çš„è€å¸ˆçš„id</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>mapperæ–‡ä»¶</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="function">Teacher <span class="title">oneTeacherToManyStudent</span><span class="params">(<span class="meta">@Param("id")</span> <span class="keyword">long</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Teacher <span class="title">oneTeacherToManyStudentTwo</span><span class="params">(<span class="meta">@Param("id")</span> <span class="keyword">long</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">getStudent</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="associationæ ‡ç­¾"><a href="#associationæ ‡ç­¾" class="headerlink" title="associationæ ‡ç­¾"></a>associationæ ‡ç­¾</h3><p>xmlæ–‡ä»¶</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åµŒå¥—ç»“æœæ–¹å¼ ï¼ˆæ¨èä½¿ç”¨ï¼‰--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ManyToOne"</span> <span class="attr">type</span>=<span class="string">"com.horse.blog.entity.Student"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"SId"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SName"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"SAge"</span> <span class="attr">property</span>=<span class="string">"age"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">javaType</span>=<span class="string">"com.horse.blog.entity.Teacher"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"TName"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"TAge"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"ManyStudentToOneTeacher"</span> <span class="attr">resultMap</span>=<span class="string">"ManyToOne"</span>&gt;</span></span><br><span class="line">       select ts.id as SId, ts.name SName, ts.age SAge, tt.name as TName, tt.age as TAge</span><br><span class="line">       from tb_student ts</span><br><span class="line">        inner join tb_teacher_student_relation ttsr on ts.id = ttsr.sid</span><br><span class="line">        inner join tb_teacher tt on tt.id = ttsr.tid</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">&lt;!--åµŒå¥—å­æŸ¥è¯¢æ–¹å¼--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ManyToOneTwo"</span> <span class="attr">type</span>=<span class="string">"com.horse.blog.entity.Student"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">javaType</span>=<span class="string">"com.horse.blog.entity.Teacher"</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">select</span>=<span class="string">"getTeacher"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"ManyStudentToOneTeacherTwo"</span> <span class="attr">resultMap</span>=<span class="string">"ManyToOneTwo"</span>&gt;</span></span><br><span class="line">       select * from tb_student</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeacher"</span> <span class="attr">resultType</span>=<span class="string">"teacher"</span>&gt;</span></span><br><span class="line">       select tt.id,tt.name,tt.age from tb_student ts</span><br><span class="line">        inner join tb_teacher_student_relation ttsr on ts.id = ttsr.sid</span><br><span class="line">        inner join tb_teacher tt on tt.id = ttsr.tid</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null and id != ''"</span>&gt;</span></span><br><span class="line">                ts.id=#{id}  // è¿™é‡Œçš„idæ˜¯æ¥è‡ªä¸Šä¸€ä¸ªæŸ¥è¯¢çš„æ‰€æœ‰å­¦ç”Ÿçš„é›†åˆä¸­çš„id</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>mapperæ–‡ä»¶</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">ManyStudentToOneTeacher</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">ManyStudentToOneTeacherTwo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Teacher <span class="title">getTeacher</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="streamæµé›†åˆåµŒå¥—æŸ¥è¯¢"><a href="#streamæµé›†åˆåµŒå¥—æŸ¥è¯¢" class="headerlink" title="streamæµé›†åˆåµŒå¥—æŸ¥è¯¢"></a>streamæµé›†åˆåµŒå¥—æŸ¥è¯¢</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è¯¾ç¨‹åˆ†ç±»çš„åµŒå¥—ä¿¡æ¯(åªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“ï¼Œæ•ˆç‡æ›´é«˜)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Subject&gt; <span class="title">listSubject</span><span class="params">()</span> </span>{</span><br><span class="line">    List&lt;Subject&gt; subjects = <span class="keyword">this</span>.list();</span><br><span class="line">    <span class="keyword">return</span> subjects.stream().filter(subject -&gt; StringUtils.equals(subject.getParentId(), <span class="string">"0"</span>))</span><br><span class="line">            .map(subject -&gt; subject.setChildren(getChildren(subject, subjects)))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Subject&gt; <span class="title">getChildren</span><span class="params">(Subject subject, List&lt;Subject&gt; subjects)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> subjects.stream().filter(subject1 -&gt; StringUtils.equals(subject1.getParentId(), subject.getId()))</span><br><span class="line">            .map(subject1 -&gt; subject1.setChildren(getChildren(subject1, subjects)))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="MPåŸºç¡€é…ç½®"><a href="#MPåŸºç¡€é…ç½®" class="headerlink" title="MPåŸºç¡€é…ç½®"></a>MPåŸºç¡€é…ç½®</h2><h3 id="mybatis-plusä»£ç ç”Ÿæˆå™¨"><a href="#mybatis-plusä»£ç ç”Ÿæˆå™¨" class="headerlink" title="mybatis-plusä»£ç ç”Ÿæˆå™¨"></a>mybatis-plusä»£ç ç”Ÿæˆå™¨</h3><p><strong>æ³¨æ„ï¼šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¼•å…¥ç›¸åº”ä¾èµ–å³å¯</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * mybatis-plusä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">       <span class="comment">// éœ€è¦æ„å»ºä¸€ä¸ª ä»£ç è‡ªåŠ¨ç”Ÿæˆå™¨ å¯¹è±¡</span></span><br><span class="line">       AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line">       <span class="comment">// 1ã€å…¨å±€é…ç½®</span></span><br><span class="line">       GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">       <span class="comment">//å°½é‡åœ¨ä¸€ä¸ªæ–°çš„å·¥ç¨‹ä¸­ä½¿ç”¨ï¼Œåœ¨moduleä¸­ä½¿ç”¨ä¼šæœ‰â€œå¥‡æ•ˆâ€</span></span><br><span class="line">       String projectPath = System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line">       gc.setOutputDir(projectPath + <span class="string">"/src/main/java"</span>);</span><br><span class="line">       gc.setAuthor(<span class="string">"horse"</span>);</span><br><span class="line">       gc.setOpen(<span class="keyword">false</span>);</span><br><span class="line">       gc.setFileOverride(<span class="keyword">false</span>); <span class="comment">// æ˜¯å¦è¦†ç›–</span></span><br><span class="line">       gc.setServiceName(<span class="string">"%sService"</span>); <span class="comment">// å»Serviceçš„Iå‰ç¼€</span></span><br><span class="line">       gc.setBaseResultMap(<span class="keyword">true</span>);  <span class="comment">//æ˜¯å¦å¼€å¯xmlæ–‡ä»¶ä¸­çš„resultMapæ˜ å°„</span></span><br><span class="line">       gc.setBaseColumnList(<span class="keyword">true</span>); <span class="comment">//æ˜¯å¦å¼€å¯xmlæ–‡ä»¶ä¸­çš„sqlä¸­çš„æ–‡ä»¶å</span></span><br><span class="line">       gc.setIdType(IdType.ASSIGN_ID);  <span class="comment">// æ³¨æ„æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥ï¼Œè¿›è¡Œç›¸åº”çš„è®¾ç½®</span></span><br><span class="line">       gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">       <span class="comment">//æ˜¯å¦è‡ªåŠ¨é…ç½®swaggeræ³¨è§£</span></span><br><span class="line">       gc.setSwagger2(<span class="keyword">true</span>);</span><br><span class="line">       mpg.setGlobalConfig(gc);</span><br><span class="line">       <span class="comment">//2ã€è®¾ç½®æ•°æ®æº</span></span><br><span class="line">       DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">       dsc.setUrl(<span class="string">"jdbc:mysql://47.99.152.217:3306/horse_vue_blog?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf"</span> +</span><br><span class="line">               <span class="string">"-8"</span> +</span><br><span class="line">               <span class="string">"&amp;serverTimezone=GMT%2B8"</span>);</span><br><span class="line">       dsc.setDriverName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">       dsc.setUsername(<span class="string">"root"</span>);</span><br><span class="line">       dsc.setPassword(<span class="string">"mysql123"</span>);</span><br><span class="line">       dsc.setDbType(DbType.MYSQL);</span><br><span class="line">       mpg.setDataSource(dsc);</span><br><span class="line">       <span class="comment">//3ã€åŒ…çš„é…ç½®</span></span><br><span class="line">       PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">       <span class="comment">//ä¸‹é¢ä¸¤ä¸ªåŠ èµ·æ¥ç”Ÿæˆï¼šcom.horse.service.blogçš„åŒ…å</span></span><br><span class="line">       pc.setModuleName(<span class="string">"blog"</span>);</span><br><span class="line">       pc.setParent(<span class="string">"com.horse.service"</span>);</span><br><span class="line"></span><br><span class="line">       pc.setEntity(<span class="string">"entity"</span>);</span><br><span class="line">       pc.setMapper(<span class="string">"mapper"</span>);</span><br><span class="line">       pc.setXml(<span class="string">"mapper.mapper"</span>);</span><br><span class="line">       pc.setService(<span class="string">"service"</span>);</span><br><span class="line">       pc.setServiceImpl(<span class="string">"service.impl"</span>);</span><br><span class="line">       pc.setController(<span class="string">"controller"</span>);</span><br><span class="line">       mpg.setPackageInfo(pc);</span><br><span class="line">       <span class="comment">//4ã€ç­–ç•¥é…ç½®</span></span><br><span class="line">       StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">       strategy.setTablePrefix(<span class="string">"tb_"</span>); <span class="comment">//å»æ‰è¡¨å‰ç¼€</span></span><br><span class="line">       strategy.setInclude(<span class="string">"tb_announcement"</span>);</span><br><span class="line">       <span class="comment">// è®¾ç½®è¦æ˜ å°„çš„è¡¨å(å¯ä»¥å†™å¤šä¸ª)ï¼šä¹Ÿå¯ä»¥çœç•¥ä¸å†™å…·ä½“ç”Ÿæˆé‚£äº›è¡¨ï¼Œå°±è¡¨ç¤ºç”Ÿæˆå½“å‰æ•°æ®åº“ä¸­çš„å…¨éƒ¨è¡¨</span></span><br><span class="line">       strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">       strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">       strategy.setEntityLombokModel(<span class="keyword">true</span>); <span class="comment">// è‡ªåŠ¨lombokï¼›</span></span><br><span class="line">       <span class="comment">// é€»è¾‘åˆ é™¤å­—æ®µé…ç½®</span></span><br><span class="line">       strategy.setLogicDeleteFieldName(<span class="string">"is_deleted"</span>);</span><br><span class="line">       <span class="comment">// è‡ªåŠ¨å¡«å……é…ç½®</span></span><br><span class="line">       TableFill gmtCreate = <span class="keyword">new</span> TableFill(<span class="string">"gmt_create"</span>, FieldFill.INSERT);</span><br><span class="line">       TableFill gmtModified = <span class="keyword">new</span> TableFill(<span class="string">"gmt_modified"</span>, FieldFill.INSERT_UPDATE);</span><br><span class="line">       ArrayList&lt;TableFill&gt; tableFills = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       tableFills.add(gmtCreate);</span><br><span class="line">       tableFills.add(gmtModified);</span><br><span class="line">       strategy.setTableFillList(tableFills);</span><br><span class="line">       <span class="comment">// ä¹è§‚é”å­—æ®µé…ç½®</span></span><br><span class="line">       strategy.setVersionFieldName(<span class="string">"version"</span>);</span><br><span class="line">       strategy.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">       strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">       mpg.setStrategy(strategy);</span><br><span class="line">       <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">       mpg.execute();</span><br><span class="line"></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mybatis-pluså¸¸ç”¨æ’ä»¶é…ç½®"><a href="#mybatis-pluså¸¸ç”¨æ’ä»¶é…ç½®" class="headerlink" title="mybatis-pluså¸¸ç”¨æ’ä»¶é…ç½®"></a>mybatis-pluså¸¸ç”¨æ’ä»¶é…ç½®</h3><blockquote>
<p>è¿™é‡Œæ³¨å…¥beanå³å¯ï¼Œéœ€è¦æ­é…ç›¸åº”â€œæ³¨è§£â€ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€»è¾‘åˆ é™¤ï¼ˆé«˜ç‰ˆæœ¬å¯ä¸é…ç½®beanï¼‰</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ISqlInjector <span class="title">sqlInjector</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * SQLæ‰§è¡Œæ•ˆç‡æ’ä»¶ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile({"dev", "test"})</span><span class="comment">// è®¾ç½® dev test ç¯å¢ƒå¼€å¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PerformanceInterceptor <span class="title">performanceInterceptor</span><span class="params">()</span> </span>{</span><br><span class="line">        PerformanceInterceptor performanceInterceptor = <span class="keyword">new</span> PerformanceInterceptor();</span><br><span class="line">        performanceInterceptor.setMaxTime(<span class="number">50</span>).setFormat(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> performanceInterceptor;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¹è§‚é”æ’ä»¶ï¼ˆæ³¨æ„ï¼šåœ¨æ‰§è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠversionçš„å€¼æŸ¥å‡ºæ¥èµ‹å€¼ï¼Œæ‰èƒ½è§¦å‘ä¹è§‚é”æ“ä½œï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OptimisticLockerInterceptor <span class="title">optimisticLockerInterceptor</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OptimisticLockerInterceptor();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è‡ªåŠ¨å¡«å……é…ç½®"><a href="#è‡ªåŠ¨å¡«å……é…ç½®" class="headerlink" title="è‡ªåŠ¨å¡«å……é…ç½®"></a>è‡ªåŠ¨å¡«å……é…ç½®</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/20 21:47</span></span><br><span class="line"><span class="comment"> * è‡ªåŠ¨å¡«å……å¤„ç†é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">"createTime"</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">"updateTime"</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">"updateTime"</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mybatis-pluså’Œpagehelperåˆ†é¡µæ’ä»¶çš„jarå†²çªè§£å†³"><a href="#mybatis-pluså’Œpagehelperåˆ†é¡µæ’ä»¶çš„jarå†²çªè§£å†³" class="headerlink" title="mybatis-pluså’Œpagehelperåˆ†é¡µæ’ä»¶çš„jarå†²çªè§£å†³"></a><strong>mybatis-pluså’Œpagehelperåˆ†é¡µæ’ä»¶çš„jarå†²çªè§£å†³</strong></h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--pagehelper:ç§»é™¤æ‰org.mybatis:mybatis-spring:1.3.2,é¿å…å†²çª--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="MPè‡ªå®šä¹‰XMLæ–‡ä»¶å’ŒQueryWrapperçš„ç»“åˆä½¿ç”¨"><a href="#MPè‡ªå®šä¹‰XMLæ–‡ä»¶å’ŒQueryWrapperçš„ç»“åˆä½¿ç”¨" class="headerlink" title="MPè‡ªå®šä¹‰XMLæ–‡ä»¶å’ŒQueryWrapperçš„ç»“åˆä½¿ç”¨"></a>MPè‡ªå®šä¹‰XMLæ–‡ä»¶å’ŒQueryWrapperçš„ç»“åˆä½¿ç”¨</h3><blockquote>
<p>æ³¨æ„ï¼šä¸»è¦å°±æ˜¯äº†è§£å›ºå®šå½¢å¼å³å¯</p>
</blockquote>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200808194839654.png" alt="image-20200808194839654"></p>
<p>ä¾¿äºç²˜è´´å¤åˆ¶</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„ï¼šä¸€å®šè¦å¼•å…¥æ­£ç¡®çš„jaråŒ…</span></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.Wrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Constants;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;CourseCollectVo&gt; <span class="title">listCollects</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper query)</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">// æ³¨æ„ï¼šä¸€èˆ¬sqlä¸­å°½é‡å†å‡ºç°whereå…³é”®å­—       </span><br><span class="line">            ${ew.customSqlSegment}</span><br><span class="line">// å¦‚æœå‰é¢å·²ç»å‡ºç°äº†whereå…³é”®å­—ï¼Œé‚£ä¹ˆä¸‹é¢å°±è¦ä½¿ç”¨</span><br><span class="line">			${ew.sqlSegment}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="MPå¸¸ç”¨æ“ä½œ"><a href="#MPå¸¸ç”¨æ“ä½œ" class="headerlink" title="MPå¸¸ç”¨æ“ä½œ"></a>MPå¸¸ç”¨æ“ä½œ</h2><h3 id="MPçš„andå’Œorçš„åµŒå¥—"><a href="#MPçš„andå’Œorçš„åµŒå¥—" class="headerlink" title="MPçš„andå’Œorçš„åµŒå¥—"></a>MPçš„andå’Œorçš„åµŒå¥—</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// A or (B and C)</span></span><br><span class="line">.eq(<span class="string">"a"</span>, <span class="string">"A"</span>).or(i -&gt; i.eq(<span class="string">"b"</span>, <span class="string">"B"</span>).eq(<span class="string">"c"</span>, <span class="string">"C"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// A or (B or C)</span></span><br><span class="line">.eq(<span class="string">"a"</span>, <span class="string">"A"</span>).or(i -&gt; i.eq(<span class="string">"b"</span>, <span class="string">"B"</span>).or().eq(<span class="string">"c"</span>, <span class="string">"C"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// A and (B and C)</span></span><br><span class="line">.eq(<span class="string">"a"</span>, <span class="string">"A"</span>).and(i -&gt; i.eq(<span class="string">"b"</span>, <span class="string">"B"</span>).eq(<span class="string">"c"</span>, <span class="string">"C"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// A and (B or C)</span></span><br><span class="line">.eq(<span class="string">"a"</span>, <span class="string">"A"</span>).and(i -&gt; i.eq(<span class="string">"b"</span>, <span class="string">"B"</span>).or().eq(<span class="string">"c"</span>, <span class="string">"C"</span>));</span><br></pre></td></tr></tbody></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Picture&gt; <span class="title">queryPictureList</span><span class="params">(Long page, Long limit, QueryPictureVO queryPictureVO)</span> </span>{</span><br><span class="line">        <span class="comment">// æ„å»ºæŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        LambdaQueryWrapper&lt;Picture&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isNotEmpty(queryPictureVO)) {</span><br><span class="line">            String searchKey = queryPictureVO.getSearchKey();</span><br><span class="line">            String beginDate = queryPictureVO.getBeginDate();</span><br><span class="line">            String endDate = queryPictureVO.getEndDate();</span><br><span class="line">            queryWrapper.select(Picture::getId, Picture::getName, Picture::getAddress, Picture::getSite,</span><br><span class="line">                    Picture::getDescription, Picture::getGmtCreate)</span><br><span class="line">                    .ge(beginDate != <span class="keyword">null</span>, Picture::getGmtCreate, beginDate)</span><br><span class="line">                    .le(endDate != <span class="keyword">null</span>, Picture::getGmtCreate, endDate)</span><br><span class="line">                	<span class="comment">// å¯èƒ½ä¸ºç©ºæ—¶ï¼Œä¸è¦å¿˜è®°â€œæ–­è¨€â€æ“ä½œ</span></span><br><span class="line">                    .and(StringUtils.isNotBlank(searchKey), </span><br><span class="line">                         wrapper -&gt; wrapper.likeRight(Picture::getName, searchKey)</span><br><span class="line">                            .or().likeRight(Picture::getSite, searchKey)</span><br><span class="line">                            .or().likeRight(Picture::getDescription, searchKey));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.page(<span class="keyword">new</span> Page&lt;&gt;(page, limit), queryWrapper);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="MPå­—æ®µç½®ä¸ºnullæ³¨æ„ç‚¹"><a href="#MPå­—æ®µç½®ä¸ºnullæ³¨æ„ç‚¹" class="headerlink" title="MPå­—æ®µç½®ä¸ºnullæ³¨æ„ç‚¹"></a>MPå­—æ®µç½®ä¸ºnullæ³¨æ„ç‚¹</h3><blockquote>
<p>é—®é¢˜ç‚¹ï¼šMybatis-plusåœ¨æ›´æ–°çš„æ—¶å€™åšäº†nullåˆ¤æ–­ï¼Œé»˜è®¤ä¸æ›´æ–°ä¸ºnullçš„ä¼ å‚å­—æ®µï¼Œæ‰€ä»¥åœ¨ä¸å†™xmlæ–‡ä»¶çš„å‰æä¸‹ï¼Œä»£ç å±‚é¢è¿›è¡Œå­—æ®µç½®ä¸º null çš„æ“ä½œéœ€è¦è¿›è¡Œæ³¨æ„å†™æ³•ã€‚</p>
</blockquote>
<h4 id="é—®é¢˜å±•ç¤º"><a href="#é—®é¢˜å±•ç¤º" class="headerlink" title="é—®é¢˜å±•ç¤º"></a>é—®é¢˜å±•ç¤º</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰çš„éœ€è¦æ›´æ–°çš„æ•°æ®é›†åˆ</span></span><br><span class="line">List&lt;PaymentGoods&gt; paymentGoods = <span class="keyword">this</span>.listByIds(idList);</span><br><span class="line"><span class="comment">// éå† æ›´æ–°å­—æ®µå€¼</span></span><br><span class="line">paymentGoods.forEach(good -&gt; good.setStatus(<span class="number">0</span>)</span><br><span class="line">                     .setReal_pay_amount(BigDecimal.ZERO)</span><br><span class="line">                     .setReal_pay_date(<span class="keyword">null</span>)</span><br><span class="line">                     .setRed_rush_back(<span class="number">1</span>));</span><br><span class="line"><span class="comment">// æ‰§è¡Œæ›´æ–°</span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šè¿™æ ·æ›´æ–°ï¼Œè§£æçš„SQL,ä¸Šé¢ç½®ä¸º null çš„å­—æ®µï¼Œå°†ä¸ä¼šè¿›è¡ŒSQLè§£æï¼Œmybatis-plusé»˜è®¤æ›´æ–°ç­–ç•¥å¯¼è‡´</span></span><br><span class="line"><span class="keyword">this</span>.updateBatchById(paymentGoods);</span><br></pre></td></tr></tbody></table></figure>
<p>SQLè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">UPDATE erp_payment_goods </span><br><span class="line"><span class="keyword">SET</span> status<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">real_pay_amount<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">red_rush_back<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> (pay_id <span class="keyword">IN</span> (<span class="string">'2486378'</span>,<span class="string">'2485840'</span>,<span class="string">'2485844'</span>));</span><br></pre></td></tr></tbody></table></figure>
<h4 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h4><blockquote>
<p>åœ¨éœ€è¦æ›´æ–°çš„å­—æ®µä¸­è°ƒæ•´éªŒè¯æ³¨è§£</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(strategy=FieldStrategy.NOT_EMPTY)</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ”¹å˜æ›´æ–°å†™æ³•ï¼Œèƒ½å®ç°çš„3ç§æ–¹å¼å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼ˆå­—æ®µå†™æ­»ï¼Œä¸æ˜“æ‹“å±•ç»´æŠ¤ï¼Œä¸æ¨èï¼‰</span></span><br><span class="line"><span class="keyword">this</span>.update(<span class="keyword">new</span> UpdateWrapper&lt;PaymentGoods&gt;()</span><br><span class="line">            .set(<span class="string">"status"</span>,<span class="number">0</span>)</span><br><span class="line">            .set(<span class="string">"real_pay_date"</span>,<span class="keyword">null</span>)</span><br><span class="line">            .in(<span class="string">"pay_id"</span>,idList));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2 ï¼ˆå¦ä¸€ç§æ–¹å¼çš„UpdateWrapperï¼‰</span></span><br><span class="line"><span class="keyword">this</span>.update(<span class="keyword">null</span>, Wrappers.&lt;PaymentGoods&gt;lambdaUpdate()</span><br><span class="line">            .set(PaymentGoods::getStatus,<span class="number">0</span>)</span><br><span class="line">            .set(PaymentGoods::getReal_pay_amount,BigDecimal.ZERO)</span><br><span class="line">            .set(PaymentGoods::getReal_pay_date,<span class="keyword">null</span>)</span><br><span class="line">            .set(PaymentGoods::getRed_rush_back,<span class="number">1</span>)</span><br><span class="line">            .in(PaymentGoods::getPay_id,idList));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼3 ï¼ˆLambdaUpdateWrapperæ–¹å¼ï¼Œæ¨èä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">this</span>.update(<span class="keyword">new</span> LambdaUpdateWrapper&lt;PaymentGoods&gt;()</span><br><span class="line">            .set(PaymentGoods::getStatus,<span class="number">0</span>)</span><br><span class="line">            .set(PaymentGoods::getReal_pay_amount,BigDecimal.ZERO)</span><br><span class="line">            .set(PaymentGoods::getReal_pay_date,<span class="keyword">null</span>)</span><br><span class="line">            .set(PaymentGoods::getRed_rush_back,<span class="number">1</span>)</span><br><span class="line">            .in(PaymentGoods::getPay_id,idList));</span><br></pre></td></tr></tbody></table></figure>
<p>SQLè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">UPDATE erp_payment_goods </span><br><span class="line"><span class="keyword">SET</span> status<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">real_pay_amount<span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">real_pay_date<span class="operator">=</span><span class="keyword">null</span>,</span><br><span class="line">red_rush_back<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> (pay_id <span class="keyword">IN</span> (<span class="string">'2486378'</span>,<span class="string">'2485840'</span>,<span class="string">'2485844'</span>));</span><br></pre></td></tr></tbody></table></figure>
<h2 id="RedisåŸºç¡€"><a href="#RedisåŸºç¡€" class="headerlink" title="RedisåŸºç¡€"></a>RedisåŸºç¡€</h2><h3 id="1-å…¬å…±å‘½ä»¤"><a href="#1-å…¬å…±å‘½ä»¤" class="headerlink" title="1.å…¬å…±å‘½ä»¤"></a>1.å…¬å…±å‘½ä»¤</h3><figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">DEL key</span><br><span class="line">DUMP keyï¼šåºåˆ—åŒ–ç»™å®škeyï¼Œè¿”å›è¢«åºåˆ—åŒ–çš„å€¼</span><br><span class="line">EXISTS keyï¼šæ£€æŸ¥keyæ˜¯å¦å­˜åœ¨</span><br><span class="line">EXPIRE key secondï¼šä¸ºkeyè®¾å®šè¿‡æœŸæ—¶é—´</span><br><span class="line">TTL keyï¼šè¿”å›keyå‰©ä½™æ—¶é—´</span><br><span class="line">PERSIST keyï¼šç§»é™¤keyçš„è¿‡æœŸæ—¶é—´ï¼Œkeyå°†æŒä¹…ä¿å­˜</span><br><span class="line">KEY patternï¼šæŸ¥è¯¢æ‰€æœ‰ç¬¦å·ç»™å®šæ¨¡å¼çš„key</span><br><span class="line">RANDOM keyï¼šéšæœºè¿”å›ä¸€ä¸ªkey</span><br><span class="line">RANAME key newkeyï¼šä¿®æ”¹keyçš„åç§°</span><br><span class="line">MOVE key dbï¼šç§»åŠ¨keyè‡³æŒ‡å®šæ•°æ®åº“ä¸­</span><br><span class="line">TYPE keyï¼šè¿”å›keyæ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œä¸å†è¿›è¡Œå‘½ä»¤æ–¹é¢çš„ç¬”è®°ï¼Œè¯¦æƒ…åšå®¢ï¼š(<strong>ctrl+ç‚¹å‡»</strong>)</p>
<p><a href="https://blog.csdn.net/qq_33423418/article/details/101351944/">https://blog.csdn.net/qq_33423418/article/details/101351944/</a></p>
<h3 id="2-redisTemplateæ•´åˆ"><a href="#2-redisTemplateæ•´åˆ" class="headerlink" title="2.redisTemplateæ•´åˆ"></a>2.redisTemplateæ•´åˆ</h3><p>å¼•å…¥pomä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring boot redisç¼“å­˜å¼•å…¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- lecttuce ç¼“å­˜è¿æ¥æ± --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªå®šä¹‰åºåˆ—åŒ–æœºåˆ¶</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰jsonåºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>{</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ³¨å…¥æ•°æ®æº</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(mapper);</span><br><span class="line">        </span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// key-valueç»“æ„åºåˆ—åŒ–æ•°æ®ç»“æ„</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashæ•°æ®ç»“æ„åºåˆ—åŒ–æ–¹å¼,å¿…é¡»è¿™æ ·å¦åˆ™å­˜hash å°±æ˜¯åŸºäºjdkåºåˆ—åŒ–çš„</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// å¯ç”¨é»˜è®¤åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setEnableDefaultSerializer(<span class="keyword">true</span>);</span><br><span class="line">        redisTemplate.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        redisTemplate.setEnableTransactionSupport(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜é…ç½®(å¯é€‰é…ç½®)</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼šé…ç½®æ­¤é¡¹ä¸»è¦æ˜¯æ–¹ä¾¿ä½¿ç”¨ç¼“å­˜æ³¨è§£çš„æ—¶å€™ç»Ÿä¸€è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœä¸ç”¨ç¼“å­˜æ³¨è§£ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç¨‹åºä¸­å®šä¹‰è¿‡æœŸæ—¶é—´ï¼Œæ›´åŠ çµæ´»ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(LettuceConnectionFactory connectionFactory)</span> </span>{</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                <span class="comment">//è¿‡æœŸæ—¶é—´600ç§’:600ç§’åä¼šé‡æ–°è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                <span class="comment">// é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> StringRedisSerializer()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer()))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(connectionFactory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®ymlä¿¡æ¯</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">   <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">lettuce:</span></span><br><span class="line">        <span class="attr">pool:</span></span><br><span class="line">          <span class="attr">max-wait:</span> <span class="number">10000</span></span><br><span class="line">          <span class="attr">max-idle:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">max-active:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">min-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">shutdown-timeout:</span> <span class="number">100</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨å…¥ä½¿ç”¨</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="SSMé…ç½®æ–‡ä»¶"><a href="#SSMé…ç½®æ–‡ä»¶" class="headerlink" title="SSMé…ç½®æ–‡ä»¶"></a>SSMé…ç½®æ–‡ä»¶</h2><h3 id="application-xml"><a href="#application-xml" class="headerlink" title="application.xml"></a>application.xml</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> </span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Spring configuration file<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è¯»å–datasource.propertiesä¸­çš„æ•°æ®åº“é…ç½®ä¿¡æ¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:database-conf/datasource.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ•°æ®åº“é©±åŠ¨ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"${c3p0.driverClass}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ•°æ®åº“çš„url --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"${c3p0.jdbcUrl}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"${c3p0.user}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥æ•°æ®åº“çš„å¯†ç  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${c3p0.password}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åˆå§‹åŒ–è¿æ¥æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span> <span class="attr">value</span>=<span class="string">"${c3p0.initialPoolSize}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æœ€å¤§è¿æ¥æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"${c3p0.maxPoolSize}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æœ€å°è¿æ¥æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"${c3p0.minPoolSize}"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿æ¥çš„ç”Ÿå­˜æ—¶é—´ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span> <span class="attr">value</span>=<span class="string">"${c3p0.maxIdleTime}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®Springäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åŸç†:æ§åˆ¶æ•°æ®æº --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯äº‹åŠ¡æ³¨è§£æ‰«æ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- MyBatisä¸Springæ•´åˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥æ•°æ®æº --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šMapperæ˜ å°„æ–‡ä»¶ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:mapper/*.xml"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šMyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:/mybatis-conf/mybatis-config.xml"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥æ’ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"plugins"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- å¼•å…¥MyBaitsåˆ†é¡µæ’ä»¶ --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- æŒ‡å®šæ•°æ®åº“ç±»å‹ --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>helperDialct=mysql<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯Mapperæ¥å£æ‰«æå™¨: æ‰«æDaoå±‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.ssm.student.dao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯Spring IOCæ³¨è§£æ‰«æå™¨: æ‰«æServieå±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ssm.student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸ºsqlæ˜ å°„æ–‡ä»¶ä¸­çš„è¾“å…¥/è¾“å‡ºå‚æ•°è®¾ç½®ç±»å‹åˆ«å --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.ssm.student.bean"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="springmvc-config-xml"><a href="#springmvc-config-xml" class="headerlink" title="springmvc-config.xml"></a>springmvc-config.xml</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Spring-MVC configuration file<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯ç”¨æ³¨è§£æ‰«æå™¨: æ‰«æè¢«@Controlleræ³¨è§£çš„ç±» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.ssm.student.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åŠ è½½æ³¨è§£é©±åŠ¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¤„ç†é™æ€èµ„æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ‹¦æˆªå™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/h-ui/**"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/easyui/**"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/system/login"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/system/get_cpacha"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.ssm.student.interceptor.LoginInterceptor"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šè¯·æ±‚ç¼–ç æ ¼å¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šæŒ‡å®šå…è®¸ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å€¼(20MB) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"20971520"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®è§†å›¾è§£æå™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/view/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¯åŠ¨Spring --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯åŠ¨Spring: åŠ è½½Springæ ¸å¿ƒé…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ³¨æ„: ä½¿ç”¨classpath:path(é˜²æ­¢å¼‚å¸¸:FileNotFoundException) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-conf/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- é…ç½®Spring MVCç¼–ç è¿‡æ»¤å™¨ (è§£æä¸­æ–‡ä¹±ç é…ç½®)--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å¯åŠ¨Spring: é…ç½®åŠ è½½Springæ–‡ä»¶çš„ç›‘å¬å™¨ï¼ˆå°½é‡é…ç½®è¿™ä¸€é¡¹ï¼‰ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å¯åŠ¨Spring MVC --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®Spring MVCçš„å‰ç«¯æ ¸å¿ƒæ§åˆ¶å™¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring_mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åŠ è½½Spring MVCé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-conf/springmvc-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æœåŠ¡å™¨å¯åŠ¨åç«‹å³åŠ è½½Spring MVCé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring_mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Logæ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#Logæ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="Logæ—¥å¿—é…ç½®æ–‡ä»¶"></a>Logæ—¥å¿—é…ç½®æ–‡ä»¶</h2><h3 id="logback-config-xml"><a href="#logback-config-xml" class="headerlink" title="logback-config.xml"></a>logback-config.xml</h3><p>ç›´æ¥åœ¨springbootçš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å³å¯ï¼š</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">logging.config</span>=<span class="string">classpath:log/logback-spring.xml</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- %mè¾“å‡ºçš„ä¿¡æ¯,%pæ—¥å¿—çº§åˆ«,%tçº¿ç¨‹å,%dæ—¥æœŸ,%cç±»çš„å…¨å,%iç´¢å¼•ã€ä»æ•°å­—0å¼€å§‹é€’å¢ã€‘,,, --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- appenderæ˜¯configurationçš„å­èŠ‚ç‚¹ï¼Œæ˜¯è´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶ã€‚ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ConsoleAppenderï¼šæŠŠæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d %p (%file:%line\)- %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ§åˆ¶å°ä¹Ÿè¦ä½¿ç”¨UTF-8ï¼Œä¸è¦ä½¿ç”¨GBKï¼Œå¦åˆ™ä¼šä¸­æ–‡ä¹±ç  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- RollingFileAppenderï¼šæ»šåŠ¨è®°å½•æ–‡ä»¶ï¼Œå…ˆå°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶æ—¶ï¼Œå°†æ—¥å¿—è®°å½•åˆ°å…¶ä»–æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä»¥ä¸‹çš„å¤§æ¦‚æ„æ€æ˜¯ï¼š1.å…ˆæŒ‰æ—¥æœŸå­˜æ—¥å¿—ï¼Œæ—¥æœŸå˜äº†ï¼Œå°†å‰ä¸€å¤©çš„æ—¥å¿—æ–‡ä»¶åé‡å‘½åä¸ºXXX%æ—¥æœŸ%ç´¢å¼•ï¼Œæ–°çš„æ—¥å¿—ä»ç„¶æ˜¯sys.log --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--             2.å¦‚æœæ—¥æœŸæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å½“å‰æ—¥å¿—çš„æ–‡ä»¶å¤§å°è¶…è¿‡1KBæ—¶ï¼Œå¯¹å½“å‰æ—¥å¿—è¿›è¡Œåˆ†å‰² é‡å‘½å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"syslog"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span>&gt;</span>communityLog/community.log<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- rollingPolicy:å½“å‘ç”Ÿæ»šåŠ¨æ—¶ï¼Œå†³å®š RollingFileAppender çš„è¡Œä¸ºï¼Œæ¶‰åŠæ–‡ä»¶ç§»åŠ¨å’Œé‡å‘½åã€‚ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- TimeBasedRollingPolicyï¼š æœ€å¸¸ç”¨çš„æ»šåŠ¨ç­–ç•¥ï¼Œå®ƒæ ¹æ®æ—¶é—´æ¥åˆ¶å®šæ»šåŠ¨ç­–ç•¥ï¼Œæ—¢è´Ÿè´£æ»šåŠ¨ä¹Ÿè´Ÿè´£å‡ºå‘æ»šåŠ¨ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ´»åŠ¨æ–‡ä»¶çš„åå­—ä¼šæ ¹æ®fileNamePatternçš„å€¼ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ”¹å˜ä¸€æ¬¡ --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ–‡ä»¶åï¼šlog/sys.2017-12-05.0.log --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>communityLog/community.%d.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ¯äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¯¥æ—¥å¿—æ–‡ä»¶çš„ä¿å­˜æœŸé™ä¸º30å¤© --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>10<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>  <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- maxFileSize:è¿™æ˜¯æ´»åŠ¨æ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯10MB,æœ¬ç¯‡è®¾ç½®ä¸º1KBï¼Œåªæ˜¯ä¸ºäº†æ¼”ç¤º --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- patternèŠ‚ç‚¹ï¼Œç”¨æ¥è®¾ç½®æ—¥å¿—çš„è¾“å…¥æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d %p (%file:%line\)- %m%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è®°å½•æ—¥å¿—çš„ç¼–ç  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡ºæ—¥å¿—çº§åˆ« --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šé¡¹ç›®ä¸­æŸä¸ªåŒ…ï¼Œå½“æœ‰æ—¥å¿—æ“ä½œè¡Œä¸ºæ—¶çš„æ—¥å¿—è®°å½•çº§åˆ« --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- com.appleyä¸ºæ ¹åŒ…ï¼Œä¹Ÿå°±æ˜¯åªè¦æ˜¯å‘ç”Ÿåœ¨è¿™ä¸ªæ ¹åŒ…ä¸‹é¢çš„æ‰€æœ‰æ—¥å¿—æ“ä½œè¡Œä¸ºçš„æƒé™éƒ½æ˜¯DEBUG --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- çº§åˆ«ä¾æ¬¡ä¸ºã€ä»é«˜åˆ°ä½ã€‘ï¼šFATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.web.community"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"syslog"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="SpringCloudå¾®æœåŠ¡ï¼ˆä¹ä¼˜å•†åŸï¼‰"><a href="#SpringCloudå¾®æœåŠ¡ï¼ˆä¹ä¼˜å•†åŸï¼‰" class="headerlink" title="SpringCloudå¾®æœåŠ¡ï¼ˆä¹ä¼˜å•†åŸï¼‰"></a>SpringCloudå¾®æœåŠ¡ï¼ˆä¹ä¼˜å•†åŸï¼‰</h2><h3 id="é¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„å·¥å…·é›†"><a href="#é¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„å·¥å…·é›†" class="headerlink" title="é¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„å·¥å…·é›†"></a>é¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„å·¥å…·é›†</h3><p><code>QSå·¥å…·</code></p>
<blockquote>
<p>QSæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>npm install qs --save</code>æ¥å®‰è£…ã€‚ä¸è¿‡æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å·²ç»é›†æˆäº†ï¼Œå¤§å®¶æ— éœ€å®‰è£…</p>
</blockquote>
<p>qsä¸»è¦æœ‰ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>
<blockquote>
<p>æŸ¥è¯¢å­—ç¬¦ä¸²ï¼šå¯ä»¥ç®€å•ç†è§£ä¸ºæˆ‘ä»¬å‰åç«¯ä¸åˆ†ç¦»é¡¹ç›®ä¸­æäº¤è¡¨å•æ—¶ä¼ é€’çš„æ•°æ®ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªjsonå¯¹è±¡ï¼Œè€Œæ˜¯ä»…ä»…æœ€ä¸ºæ™®é€šè¡¨å•è¯·æ±‚æ–¹æ³•ã€‚</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å°†å¯¹è±¡è½¬æ¢ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class="line">qs.stringify(person) è½¬æ¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æŸ¥è¯¢å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡</span></span><br><span class="line">qs.parse(string) è½¬æ¢æˆjsonå¯¹è±¡</span><br></pre></td></tr></tbody></table></figure>
<p><code>åœ¨æœ¬é¡¹ç›®ä¸­ä½¿ç”¨qså·¥å…·çš„åŸå› </code>ï¼š</p>
<p>åœ¨å¢åŠ brandæ•°æ®æ—¶ï¼Œä¼ é€’ç»™åå°çš„æ˜¯è¿™æ ·çš„å¯¹è±¡params:{name:xxx, letter:xxx, image:xxx ,cids:xxx},è€Œåå°ä¸­è®¾è®¡çš„Brandå®ä½“ç±»ä¸­æ²¡æœ‰cidså±æ€§ï¼Œæ‰€æœ‰æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨@RequestBodyï¼ˆBrand brandï¼‰çš„æ–¹å¼æ¥æ”¶å‚æ•°ï¼Œè™½ç„¶å¯ä»¥åˆ›å»ºä¸€ä¸ªDTOæ¥æ”¶å‚æ•°ï¼Œä½†ä¸æ˜¯æœ€ä¼˜ç¾çš„è§£å†³æ–¹å¼ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°†paramså¯¹è±¡è½¬å˜ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåœ¨axios</p>
<p><code>å®è´¨</code>ï¼šæˆ‘ä»¬ä¸€èˆ¬åœ¨ä½¿ç”¨axiosæ—¶ï¼Œæœ‰ä¸€ä¸‹åŸåˆ™ï¼š</p>
<p>axioså¤„ç†è¯·æ±‚ä½“çš„åŸåˆ™ä¼šæ ¹æ®è¯·æ±‚æ•°æ®çš„æ ¼å¼æ¥å®šï¼š</p>
<ul>
<li><p>å¦‚æœè¯·æ±‚ä½“æ˜¯å¯¹è±¡ï¼šä¼šè½¬ä¸ºjsonå¯¹è±¡å‘é€ï¼Œä¹Ÿå°±æ˜¯åå°éœ€è¦ä½¿ç”¨@RequestBodyçš„æ–¹å¼æ¥æ”¶</p>
</li>
<li><p>å¦‚æœè¯·æ±‚ä½“æ˜¯Stringï¼šä¼šä½œä¸ºæ™®é€šè¡¨å•è¯·æ±‚å‘é€ï¼Œä½†éœ€è¦æˆ‘ä»¬è‡ªå·±ä¿è¯Stringçš„æ ¼å¼æ˜¯é”®å€¼å¯¹ã€‚</p>
<p>å¦‚ï¼šname=jack&amp;age=12</p>
</li>
</ul>
<h3 id="åŸºæœ¬è¯·æ±‚å“åº”æ•°æ®ç»“æ„å›¾"><a href="#åŸºæœ¬è¯·æ±‚å“åº”æ•°æ®ç»“æ„å›¾" class="headerlink" title="åŸºæœ¬è¯·æ±‚å“åº”æ•°æ®ç»“æ„å›¾"></a>åŸºæœ¬è¯·æ±‚å“åº”æ•°æ®ç»“æ„å›¾</h3><p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/springboot.png" alt="springboot"></p>
<h3 id="ä»¥ä¹ä¼˜å•†åŸä¸ºä¾‹æ•´åˆç®€å•çš„å¾®æœåŠ¡æ¶æ„ã€"><a href="#ä»¥ä¹ä¼˜å•†åŸä¸ºä¾‹æ•´åˆç®€å•çš„å¾®æœåŠ¡æ¶æ„ã€" class="headerlink" title="ä»¥ä¹ä¼˜å•†åŸä¸ºä¾‹æ•´åˆç®€å•çš„å¾®æœåŠ¡æ¶æ„ã€"></a>ä»¥ä¹ä¼˜å•†åŸä¸ºä¾‹æ•´åˆç®€å•çš„å¾®æœåŠ¡æ¶æ„ã€</h3><h4 id="1-åˆ›å»ºmavençˆ¶å·¥ç¨‹-ä¸»è¦æ˜¯ä¾èµ–ç®¡ç†"><a href="#1-åˆ›å»ºmavençˆ¶å·¥ç¨‹-ä¸»è¦æ˜¯ä¾èµ–ç®¡ç†" class="headerlink" title="1.åˆ›å»ºmavençˆ¶å·¥ç¨‹(ä¸»è¦æ˜¯ä¾èµ–ç®¡ç†)"></a>1.åˆ›å»ºmavençˆ¶å·¥ç¨‹(ä¸»è¦æ˜¯ä¾èµ–ç®¡ç†)</h4><p><strong>æ³¨æ„ï¼šçˆ¶å·¥ç¨‹çš„æ‰“åŒ…æ–¹å¼ï¼špom  å­å·¥ç¨‹çš„æ‰“åŒ…æ–¹å¼ï¼šjarï¼Œå¹¶ä¸”springbootå’Œspringcloudçš„ç‰ˆæœ¬ä¸€å®šè¦å¯¹åº”**</strong></p>
<p>åŸºæœ¬pom.xmlå¯¼å…¥</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.parent<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-web-leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--pomæ‰“åŒ…æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!--è‡ªåŠ¨å¼•å…¥çš„å­å·¥ç¨‹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>springboot-web-registry<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>springboot-web-geteway<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>springboot-web-item<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>springboot-web-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--pomç‰ˆæœ¬ç®¡ç†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">springcloud.version</span>&gt;</span>Hoxton.SR3<span class="tag">&lt;/<span class="name">springcloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">springboot.version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">springboot.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.starter.version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">mybatis.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.starter.version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">druid.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pageHelper.starter.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">pageHelper.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastDFS.version</span>&gt;</span>1.26.2<span class="tag">&lt;/<span class="name">fastDFS.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper.starter.vertion</span>&gt;</span>2.1.5<span class="tag">&lt;/<span class="name">mapper.starter.vertion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">leyou.latest.version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">leyou.latest.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring-boot--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${springboot.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring-cloud--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${springcloud.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mybatiså¯åŠ¨å™¨ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mybatis.starter.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mapperå¯åŠ¨å™¨--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mapper.starter.vertion}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åˆ†é¡µåŠ©æ‰‹å¯åŠ¨å™¨ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${pageHelper.starter.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mysql.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${druid.starter.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--fastDFS--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.tobato<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${fastDFS.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lombok.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--logå’Œæµ‹è¯•ç›¸å…³--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--log4j--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${log4j.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${junit.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-åˆ›å»ºä»¥Eurekaä¸ºä¸­å¿ƒçš„æ³¨å†ŒæœåŠ¡ä¸­å¿ƒ"><a href="#2-åˆ›å»ºä»¥Eurekaä¸ºä¸­å¿ƒçš„æ³¨å†ŒæœåŠ¡ä¸­å¿ƒ" class="headerlink" title="2.åˆ›å»ºä»¥Eurekaä¸ºä¸­å¿ƒçš„æ³¨å†ŒæœåŠ¡ä¸­å¿ƒ"></a>2.åˆ›å»ºä»¥Eurekaä¸ºä¸­å¿ƒçš„æ³¨å†ŒæœåŠ¡ä¸­å¿ƒ</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Eureka:ç”¨äºæä¾›æ³¨å†ŒæœåŠ¡ï¼ˆæ³¨æ„ï¼š2.xç‰ˆæœ¬è¦å¼•å…¥ä¸‹é¢çš„ä¾èµ–ï¼‰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--è«åå¥‡å¦™çš„ä¾èµ–ï¼Œä½†æ˜¯JDK1.8ä¹‹åçš„å¿…é¡»è¿›è¡Œå¯¼å…¥ï¼Œå¦åˆ™æŠ¥é”™--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>application.ymlé…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šé¡¹ç›®å</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">leyou-registry</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šEurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#æœåŠ¡ç«¯å®ä¾‹</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>  <span class="comment"># è¡¨ç¤ºæ˜¯å¦å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>    <span class="comment"># falseè¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://${eureka.instance.hostname}:10086/eureka/</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">10000</span></span><br></pre></td></tr></tbody></table></figure>
<p>åˆ›å»ºä¸»å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/3/27 17:06</span></span><br><span class="line"><span class="comment"> * å¼€å¯eurekaæ³¨å†ŒæœåŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistryApplication</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(RegistryApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-åˆ›å»ºåŸºäºZuulçš„ç½‘å…³æœåŠ¡å·¥ç¨‹"><a href="#3-åˆ›å»ºåŸºäºZuulçš„ç½‘å…³æœåŠ¡å·¥ç¨‹" class="headerlink" title="3.åˆ›å»ºåŸºäºZuulçš„ç½‘å…³æœåŠ¡å·¥ç¨‹"></a>3.åˆ›å»ºåŸºäºZuulçš„ç½‘å…³æœåŠ¡å·¥ç¨‹</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥Eurekaå®¢æˆ·ç«¯æœåŠ¡ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Zuulç½‘å…³è·¯ç”±æœåŠ¡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>application.yml</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">leyou-geteway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10086/eureka/</span></span><br><span class="line">    <span class="attr">registry-fetch-interval-seconds:</span> <span class="number">5</span>    <span class="comment">#æ‹‰å–æœåŠ¡çš„é—´éš”æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šZuulç½‘å…³æœåŠ¡åŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/api</span>  <span class="comment">#ç½‘å…³å‰ç¼€</span></span><br><span class="line">  <span class="comment">#é…ç½®ç½‘å…³è·¯ç”±</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">item-service:</span> <span class="string">/item/**</span> <span class="comment">#è·¯ç”±åˆ°å•†å“çš„å¾®æœåŠ¡(item-servicesæ˜¯æä¾›å•†å“å¾®æœåŠ¡æ¨¡å—è¢«å®šä¹‰çš„çš„åå­—),ç›®å‰åªæœ‰ä¸€ä¸ªå¾®æœåŠ¡æ¨¡å—ï¼Œåç»­ä¹Ÿæ˜¯ä»¥è¿™ç§æ–¹å¼åŠ å…¥</span></span><br></pre></td></tr></tbody></table></figure>
<p>ä¸»å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/3/27 17:51</span></span><br><span class="line"><span class="comment"> * å¼€å¯zuulä»£ç†æœåŠ¡(æ³¨æ„æ³¨è§£)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeteWayApplication</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(GeteWayApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é¢å¤–æ·»åŠ Configï¼šç”¨äºè§£å†³ajaxè¯·æ±‚çš„è·¨åŸŸé—®é¢˜ï¼ˆåˆšå¼€å§‹å¯ä»¥ä¸é…ç½®ï¼ŒåæœŸåœ¨é…ç½®ä¹Ÿä¸€æ ·ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/3/28 20:27</span></span><br><span class="line"><span class="comment"> * åœ¨ç½‘å…³æœåŠ¡Moduleä¸­é…ç½®CorsFilter:è§£å†³æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è·¨åŸŸè¯·æ±‚é—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCorsFilterConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼šå¹¶ä¸æ˜¯è¿™ä¸ªåŒ…ï¼šorg.apache.catalina.filters.CorsFilterã€‚è€Œæ˜¯ï¼Œspring-mvcæ¡†æ¶ä¸­çš„åŒ…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–corsé…ç½®å¯¹è±¡</span></span><br><span class="line">        CorsConfiguration configuration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸçš„åŸŸåï¼ˆä¹Ÿå°±æ˜¯å…è®¸åœ¨è¿™ä¸ªåŸŸåè¯·æ±‚ä¸‹çš„æœåŠ¡ä¸­è¿›è¡Œå¦å¤–çš„åŸŸåè®¿é—®ï¼‰ï¼Œæ³¨æ„ï¼šå¦‚æœæƒ³è¦æºå¸¦Cookieï¼Œè¿™é‡Œçš„å‚æ•°ä¸èƒ½å†™â€œ*â€,å¿…é¡»å†™å…·ä½“çš„åŸŸå</span></span><br><span class="line">        configuration.addAllowedOrigin(<span class="string">"http://manage.leyou.com"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ˜¯å¦å…è®¸æºå¸¦Cookie</span></span><br><span class="line">        configuration.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹æ³•ï¼šä¸€èˆ¬ä¸ºGET,POST,PUT,DELETEç­‰ã€‚ã€‚ã€‚ æ³¨æ„ï¼š"*" ä»£è¡¨æ‰€æœ‰</span></span><br><span class="line">        configuration.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸æºå¸¦çš„é¢è¯·æ±‚å¤´ä¿¡æ¯ æ³¨æ„ï¼š"*" ä»£è¡¨æ‰€æœ‰</span></span><br><span class="line">        configuration.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–corsé…ç½®æºå¯¹è±¡</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configurationSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        <span class="comment">//ä»£è¡¨æ‰€æœ‰è·¯å¾„çš„è¯·æ±‚éƒ½å°†ç»è¿‡ä¸Šé¢é…ç½®çš„ä¸€ç³»åˆ—è¿‡æ»¤ï¼Œæœ€ç»ˆå†³å®šæ˜¯å¦å…è®¸è¿™ä¸ªè¯·æ±‚è¿›è¡Œè·¨åŸŸèµ„æºè®¿é—®</span></span><br><span class="line">        configurationSource.registerCorsConfiguration(<span class="string">"/**"</span>, configuration);</span><br><span class="line">        <span class="comment">//è¿”å›CorsFilterå®ä¾‹ï¼Œå‚æ•°ï¼šä¸Šé¢é…ç½®çš„corsé…ç½®æºå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configurationSource);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-åˆ›å»ºç”¨äºç®¡ç†å¾®æœåŠ¡é›†ç¾¤çš„å¾®æœåŠ¡çˆ¶å·¥ç¨‹ï¼ˆspringboot-web-itemï¼‰"><a href="#4-åˆ›å»ºç”¨äºç®¡ç†å¾®æœåŠ¡é›†ç¾¤çš„å¾®æœåŠ¡çˆ¶å·¥ç¨‹ï¼ˆspringboot-web-itemï¼‰" class="headerlink" title="4.åˆ›å»ºç”¨äºç®¡ç†å¾®æœåŠ¡é›†ç¾¤çš„å¾®æœåŠ¡çˆ¶å·¥ç¨‹ï¼ˆspringboot-web-itemï¼‰"></a>4.åˆ›å»ºç”¨äºç®¡ç†å¾®æœåŠ¡é›†ç¾¤çš„å¾®æœåŠ¡çˆ¶å·¥ç¨‹ï¼ˆspringboot-web-itemï¼‰</h4><h5 id="4-1-åˆ›å»ºç”¨äºå­˜æ”¾å®ä½“ç±»çš„module-springboot-web-interface-å°†éœ€è¦ä¸æ•°æ®åº“è¿›è¡Œormæ˜ å°„çš„pojoå®ä½“ç±»æ”¾åœ¨æ­¤æ¨¡å—å³å¯"><a href="#4-1-åˆ›å»ºç”¨äºå­˜æ”¾å®ä½“ç±»çš„module-springboot-web-interface-å°†éœ€è¦ä¸æ•°æ®åº“è¿›è¡Œormæ˜ å°„çš„pojoå®ä½“ç±»æ”¾åœ¨æ­¤æ¨¡å—å³å¯" class="headerlink" title="4.1 åˆ›å»ºç”¨äºå­˜æ”¾å®ä½“ç±»çš„module(springboot-web-interface),å°†éœ€è¦ä¸æ•°æ®åº“è¿›è¡Œormæ˜ å°„çš„pojoå®ä½“ç±»æ”¾åœ¨æ­¤æ¨¡å—å³å¯"></a><strong>4.1 åˆ›å»ºç”¨äºå­˜æ”¾å®ä½“ç±»çš„module(springboot-web-interface),å°†éœ€è¦ä¸æ•°æ®åº“è¿›è¡Œormæ˜ å°„çš„pojoå®ä½“ç±»æ”¾åœ¨æ­¤æ¨¡å—å³å¯</strong></h5><h5 id="4-2-åˆ›å»ºçœŸæ­£çš„å¾®æœåŠ¡æ¨¡å—ï¼ˆå…¶å®ä¸ä¸€ä¸ªspringbootå·¥ç¨‹demoæ²¡ä»€ä¹ˆåŒºåˆ«ï¼‰"><a href="#4-2-åˆ›å»ºçœŸæ­£çš„å¾®æœåŠ¡æ¨¡å—ï¼ˆå…¶å®ä¸ä¸€ä¸ªspringbootå·¥ç¨‹demoæ²¡ä»€ä¹ˆåŒºåˆ«ï¼‰" class="headerlink" title="4.2 åˆ›å»ºçœŸæ­£çš„å¾®æœåŠ¡æ¨¡å—ï¼ˆå…¶å®ä¸ä¸€ä¸ªspringbootå·¥ç¨‹demoæ²¡ä»€ä¹ˆåŒºåˆ«ï¼‰"></a>4.2 åˆ›å»ºçœŸæ­£çš„å¾®æœåŠ¡æ¨¡å—ï¼ˆå…¶å®ä¸ä¸€ä¸ªspringbootå·¥ç¨‹demoæ²¡ä»€ä¹ˆåŒºåˆ«ï¼‰</h5><p>pom.xml</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-web-item<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.item<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.service<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-item-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥è‡ªå®šä¹‰module(è¿™ä¸€ç‚¹éå¸¸é‡è¦)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.interface<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-item-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-web-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥Eurekaå®¢æˆ·ç«¯æœåŠ¡ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbcå¯åŠ¨å™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--druidå¯åŠ¨å™¨(å’Œä¸Šé¢é‚£ä¸ªç”¨ä¸€ä¸ªå³å¯)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapperå¯åŠ¨å™¨ï¼ˆç®€åŒ–mybatisï¼Œå¯ä»¥å’ŒåŸç”Ÿçš„mybaitsç»“åˆä½¿ç”¨ï¼‰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--actuator:æä¾›æµ‹è¯•æ¥å£--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>application.yml</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">item-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/leyou?serverTimezone=UTC&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">mysql123</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">50</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment">#é…ç½®ï¼šDruidæ•°æ®æºé¡µé¢ç›‘æ§(é…ç½®ä¹‹åå¯ä»¥ç›´æ¥åœ¨é¡µé¢æŸ¥çœ‹SQLç›‘æ§)</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">druid</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">druid</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">"*.js,*.gif,*.css,*.png,*.ico,/druid/*"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šæ³¨å†Œä¸­å¿ƒåœ°å€ï¼ˆæŒ‡æ˜è¿™é‡Œçš„æœåŠ¡å‘é‚£ä¸ªæœåŠ¡ä¸­å¿ƒè¿›è¡Œæ³¨å†Œï¼‰</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10086/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">20</span>  <span class="comment">#è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">5</span> <span class="comment">#å¿ƒè·³æ—¶é—´ï¼ˆé—´éš”5ç§’è¿›è¡Œä¸€æ¬¡è¿é€šï¼Œç¡®ä¿æœåŠ¡ä»ç„¶åœ¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šå¼•å…¥mybatisç›¸å…³é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.item.entity.pojo</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ï¼šæ—¥å¿—ç›¸å…³</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">classpath:log/logback-spring.xml</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æ•´ä½“ç»“æ„ç›®å½•</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200330120951466.png" alt="springboot-item-service"></p>
<p><strong>æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯springboot+é€šç”¨mapperç”¨äºè¿›åŒ–mybaitsçš„sqlè¯­å¥ç¼–å†™ï¼Œæœ€ä¸‹é¢çš„xxxMapper.xmlæ–‡ä»¶è¿˜æ˜¯åŸç”Ÿçš„mapperé…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºè¡¥å……è§£å†³é€šç”¨mapperä¸èƒ½è§£å†³çš„å¤šè¡¨æ“ä½œå’Œå…¶ä»–ä¸€äº›åŠ¨æ€sqlçš„çš„é—®é¢˜</strong></p>
<h4 id="5-openFeignçš„åŸºæœ¬ä½¿ç”¨ï¼ˆspringboot-web-searchæœç´¢æ¨¡å—ï¼‰"><a href="#5-openFeignçš„åŸºæœ¬ä½¿ç”¨ï¼ˆspringboot-web-searchæœç´¢æ¨¡å—ï¼‰" class="headerlink" title="5.openFeignçš„åŸºæœ¬ä½¿ç”¨ï¼ˆspringboot-web-searchæœç´¢æ¨¡å—ï¼‰"></a>5.openFeignçš„åŸºæœ¬ä½¿ç”¨ï¼ˆspringboot-web-searchæœç´¢æ¨¡å—ï¼‰</h4><p>å¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--item-interfaceå¾®æœåŠ¡module--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.interface<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-item-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-web-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--eurekaå®¢æˆ·ç«¯--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--openfeign:ç”¨äºè°ƒå–itemå¾®æœåŠ¡æ¨¡å—çš„æ•°æ®--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–å†™é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">search-service</span></span><br><span class="line"><span class="comment">#é…ç½®ï¼šelasticsearchåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">elasticsearch:</span></span><br><span class="line">      <span class="attr">cluster-name:</span> <span class="string">elasticsearch</span></span><br><span class="line">      <span class="attr">cluster-nodes:</span> <span class="number">192.168</span><span class="number">.149</span><span class="number">.131</span><span class="string">:9300</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span>  <span class="comment">#è‡ªåŠ¨è¿‡æ»¤jsonæ•°æ®nullå­—æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">5</span>  <span class="comment">#æ¯éš”5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">20</span>  <span class="comment">#20ç§’ä¸å‘é€å°±è¿‡æœŸ</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://${eureka.instance.hostname}:10086/eureka/</span></span><br><span class="line">    <span class="attr">registry-fetch-interval-seconds:</span> <span class="number">10</span>  <span class="comment">#æ‹‰å–æ•°æ®çš„é—´éš”ï¼ˆä¿æŒæ•°æ®ä¸æ–­çº¿ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š<strong>@EnableFeignClients</strong> </p>
<p><strong>ç¼–å†™Clientå®¢æˆ·ç«¯æ¥å£ GoodsClient</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = "item-service")</span>  <span class="comment">//å£°æ˜è¿™æ˜¯ä¸€ä¸ªfeignå®¢æˆ·ç«¯æ¥å£ï¼Œnameçš„ç”¨äºæŒ‡å‘æœåŠ¡æ¨¡å—çš„åå­—ï¼ˆæŒ‡æ˜è°ƒç”¨é‚£ä¸ªæ¨¡å—ä¸­çš„æ¥å£ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodsClient</span> <span class="keyword">extends</span> <span class="title">GoodsApi</span> </span>{</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p> <strong>GoodsApiï¼šè¢«æŠ½å–å‡ºæ¥æ”¾åœ¨å…¬å…±æ¨¡å—çš„æ¥å£ç±»</strong>(é‡Œé¢æ•´åˆå¥½äº†æ–¹æ³•æŒ‡å‘çš„urlåœ°å€ï¼Œè¢«clientå®¢æˆ·ç«¯ç»§æ‰¿ï¼Œç›´æ¥è¿›è¡Œè°ƒç”¨å³å¯ï¼Œè‡³äºurlçš„åŒ¹é…æ‰§è¡Œæœ‰åˆ«çš„æœåŠ¡æ¨¡å—è¿›è¡Œ)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodsApi</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®spuIdæŸ¥è¯¢spuDetailçš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/spu/detail/{spuId}")</span></span><br><span class="line">    <span class="function">SpuDetail <span class="title">querySpuDetailBySpuId</span><span class="params">(<span class="meta">@PathVariable("spuId")</span> Long spuId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®spuIdæŸ¥è¯¢å•†å“çš„skuå‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/sku/list")</span></span><br><span class="line">    <span class="function">List&lt;Sku&gt; <span class="title">querySkusBySpuId</span><span class="params">(<span class="meta">@RequestParam("id")</span> Long spuId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ¡ä»¶æŸ¥è¯¢å•†å“åˆ—è¡¨åˆ†é¡µç»“æœé›†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> saleable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/spu/page")</span></span><br><span class="line">    <span class="function">PageResults&lt;SpuBo&gt; <span class="title">queryGoodsByPage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "key", required = false)</span> String key,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "saleable", required = false)</span> Boolean saleable,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "page", defaultValue = "1")</span> Integer page,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "rows", defaultValue = "5")</span> Integer rows)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å“ç‰Œå¯¹è±¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/brand/{id}")</span></span><br><span class="line">    <span class="function">Brand <span class="title">queryBranById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»ï¼ˆCategoryï¼‰ä¸»é”®é›†åˆidså¾ªç¯æŸ¥è¯¢åˆ†ç±»çš„åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/category")</span></span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">queryCategoryNameByIds</span><span class="params">(<span class="meta">@RequestParam("ids")</span> List&lt;Long&gt; ids)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç»„IDï¼ˆgroup_idï¼‰æŸ¥è¯¢å…·ä½“çš„è§„æ ¼å‚æ•°</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼šå¦‚æœé¡µé¢æ²¡ä¼ é€’å‚æ•°ï¼Œåˆ™å‚æ•°ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> gid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/spec/params")</span></span><br><span class="line">    <span class="function">List&lt;SpecParam&gt; <span class="title">querySpecParams</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "gid", required = false)</span> Long gid,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "cid", required = false)</span> Long cid,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "generic", required = false)</span> Boolean generic,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = "searching", required = false)</span> Boolean searching)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢spuä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/spu/{id}")</span></span><br><span class="line">    <span class="function">Spu <span class="title">querySpuById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»IdæŸ¥è¯¢åˆ†ç»„å’Œæ¯ä¸ªåˆ†ç»„é‡Œçš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/spec/group/param/{cid}")</span></span><br><span class="line">    <span class="function">List&lt;SpecGroup&gt; <span class="title">queryGroupsWithParams</span><span class="params">(<span class="meta">@PathVariable("cid")</span> Long cid)</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><strong>ç„¶åç›´æ¥å°†clientå®¢æˆ·ç«¯è¿›è¡Œbeanæ³¨å…¥ï¼Œç›´æ¥è°ƒç”¨ç»§æ‰¿è€Œæ¥çš„æ¥å£æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘åˆ«çš„å®ç°</strong></p>
<h4 id="6-Elasticsearchåˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿçš„æ•´åˆä½¿ç”¨-linuxä¸­å®‰è£…elasticsearchå’Œå¯¹åº”çš„ikåˆ†è¯å™¨"><a href="#6-Elasticsearchåˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿçš„æ•´åˆä½¿ç”¨-linuxä¸­å®‰è£…elasticsearchå’Œå¯¹åº”çš„ikåˆ†è¯å™¨" class="headerlink" title="6.Elasticsearchåˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿçš„æ•´åˆä½¿ç”¨(linuxä¸­å®‰è£…elasticsearchå’Œå¯¹åº”çš„ikåˆ†è¯å™¨)"></a>6.Elasticsearchåˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿçš„æ•´åˆä½¿ç”¨(linuxä¸­å®‰è£…elasticsearchå’Œå¯¹åº”çš„ikåˆ†è¯å™¨)</h4><p>å¼•å…¥pomä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--elasticsearchï¼ˆæ³¨æ„ç‰ˆæœ¬å†²çª,æˆ‘è¿™é‡Œelasticsearchï¼š7.50æˆ–è€…6.8.6ï¼ˆæ­£åœ¨ç”¨çš„ï¼‰ï¼Œå¯¹åº”å¯åŠ¨å™¨ï¼šæœ€å¥½è¾ƒæ–°ä¸€ç‚¹ï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>application.ymlé…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">elasticsearch:</span></span><br><span class="line">      <span class="attr">cluster-name:</span> <span class="string">elasticsearch</span>  <span class="comment">#æ–°ç‰ˆæœ¬ä¸å†™ä¹Ÿå¯ä»¥</span></span><br><span class="line">      <span class="attr">cluster-nodes:</span> <span class="number">192.168</span><span class="number">.149</span><span class="number">.131</span><span class="string">:9300</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span>  <span class="comment">#è‡ªåŠ¨è¿‡æ»¤jsonæ•°æ®nullå­—æ®µ</span></span><br></pre></td></tr></tbody></table></figure>
<p>å…·ä½“ä¸šåŠ¡é€»è¾‘è§ä»£ç â€¦</p>
<h4 id="7-rabbitmqå®ç°æ•°æ®åŒæ­¥ï¼šæ•°æ®åº“æ•°æ®å’Œelastisearchçš„æ•°æ®åŒæ­¥æ›´æ–°ï¼ˆä»¥elasticsearchæœç´¢ä¸ºä¾‹ï¼‰"><a href="#7-rabbitmqå®ç°æ•°æ®åŒæ­¥ï¼šæ•°æ®åº“æ•°æ®å’Œelastisearchçš„æ•°æ®åŒæ­¥æ›´æ–°ï¼ˆä»¥elasticsearchæœç´¢ä¸ºä¾‹ï¼‰" class="headerlink" title="7.rabbitmqå®ç°æ•°æ®åŒæ­¥ï¼šæ•°æ®åº“æ•°æ®å’Œelastisearchçš„æ•°æ®åŒæ­¥æ›´æ–°ï¼ˆä»¥elasticsearchæœç´¢ä¸ºä¾‹ï¼‰"></a>7.rabbitmqå®ç°æ•°æ®åŒæ­¥ï¼šæ•°æ®åº“æ•°æ®å’Œelastisearchçš„æ•°æ®åŒæ­¥æ›´æ–°ï¼ˆä»¥elasticsearchæœç´¢ä¸ºä¾‹ï¼‰</h4><p>ç”Ÿäº§è€…ï¼šå½“ç”Ÿäº§è€…å‘ç”Ÿæ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰æ”¹å˜æ•°æ®çš„åŠ¨ä½œæ—¶ï¼Œå‘é€æ¶ˆæ¯å¹¶æºå¸¦ä¿¡æ¯åˆ°æŒ‡å®šçš„äº¤æ¢æœºï¼ˆexchangeï¼‰ï¼Œ</p>
<p>æ¶ˆè´¹è€…(å•†å“æœç´¢æœåŠ¡å’Œthymeleafæ¨¡æ¿å¼•æ“é¡µé¢é™æ€åŒ–)ï¼šæ¥æ”¶æ¶ˆæ¯å’Œæºå¸¦çš„ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œæ•°æ®çš„æ›´æ–°ï¼Œæœ€ç»ˆè¾¾åˆ°ï¼šåªè¦æ•°æ®åº“çš„ä¿¡æ¯æ”¹å˜ï¼Œå…¶ä¾èµ–æ•°æ®åº“ä¿¡æ¯çš„å¾®æœåŠ¡æ¨¡å—ä¸­çš„æ•°æ®ä¿¡æ¯ä¹Ÿè¿›è¡ŒåŒæ­¥æ›´æ–°çš„æ•ˆæœã€‚</p>
<p>å¼•å…¥pomä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--springboot-amqpï¼ˆæ•°æ®åŒæ­¥ï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#rabbitmqåŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="attr">rabbitmq:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.149</span><span class="number">.131</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">  <span class="attr">virtual-host:</span> <span class="string">/leyou</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">leyou</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">leyou</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">exchange:</span> <span class="string">LEYOU.ITEM.EXCHANGE</span>  <span class="comment">#æŒ‡å®šé»˜è®¤äº¤æ¢æœºï¼ˆåœ¨å…·ä½“å‘é€æ¶ˆæ¯æ—¶ä¸éœ€è¦å†è¡ŒæŒ‡å®šäº¤æ¢æœºï¼‰</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç”Ÿäº§è€…è¿›è¡Œçš„æ“ä½œï¼š</p>
<p>å½“å•†å“ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåœ¨è¿›è¡Œæœ¬åœ°æ•°æ®åº“çš„æ›´æ–°çš„åŒæ—¶ï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¿¡æ¯</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½å–çš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(String type, Long id)</span> </span>{</span><br><span class="line">    <span class="comment">/*å¯¹äºå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼šè¦try-catchï¼Œæ— è®ºæ¶ˆæ¯å‘é€æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¸èƒ½å½±å“ä¸šåŠ¡æœ¬æ¥çš„é€»è¾‘*/</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">/*convertAndSendï¼ˆè·¯ç”±çš„keyï¼Œæºå¸¦çš„ä¿¡æ¯ï¼Œå…·ä½“çœ‹æºç ï¼‰*/</span></span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">"item."</span> + type, id);</span><br><span class="line">    } <span class="keyword">catch</span> (AmqpException e) {</span><br><span class="line">        log.info(<span class="string">"æ¶ˆæ¯å‘é€å¤±è´¥=&gt;æ¶ˆæ¯ç±»å‹ï¼š{},å•†å“IDï¼š{}"</span>, <span class="string">"item."</span> + type, id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ•°æ®æ›´æ–°æ—¶ï¼Œå‘é€ä¿¡æ¯(åœ¨è¿™é‡Œï¼Œæ–°å¢å•†å“çš„åŒæ—¶ï¼Œå‘é€æ¶ˆæ¯)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢å•†å“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> spuBo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveGoods</span><span class="params">(SpuBo spuBo)</span> </span>{</span><br><span class="line">    <span class="comment">//æ–°å¢spu</span></span><br><span class="line">    Date date = <span class="keyword">new</span> Date();</span><br><span class="line">    spuBo.setId(<span class="keyword">null</span>)</span><br><span class="line">            .setSaleable(<span class="keyword">true</span>)</span><br><span class="line">            .setValid(<span class="keyword">true</span>)</span><br><span class="line">            .setCreateTime(date)</span><br><span class="line">            .setLastUpdateTime(date);</span><br><span class="line">    spuMapper.insertSelective(spuBo);</span><br><span class="line">    <span class="comment">//æ–°å¢spu_detail</span></span><br><span class="line">    SpuDetail spuDetail = spuBo.getSpuDetail()</span><br><span class="line">            .setSpuId(spuBo.getId());</span><br><span class="line">    spuDetailMapper.insertSelective(spuDetail);</span><br><span class="line">    <span class="comment">//æ–°å¢skuå’Œstock</span></span><br><span class="line">    saveSkuAndStock(spuBo, date);</span><br><span class="line">    <span class="comment">//å‘é€å¢åŠ å•†å“çš„æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—====================ã€‹çœ‹è¿™é‡Œï¼Œå‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">    sendMsg(<span class="string">"insert"</span>, spuBo.getId());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ¶ˆè´¹è€…ï¼šè¦è¿›è¡Œç›‘å¬ï¼Œå½“ç›‘å¬åˆ°æ¶ˆæ¯æ—¶ï¼Œå°±è·å–æ­¤æ¶ˆæ¯ä¿¡æ¯ï¼Œè¿›è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ›´æ–°è‡ªå·±çš„ä¿¡æ¯</p>
<p>æ³¨è§£çš„è§£æï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    		//æ¶ˆè´¹è€…ç»‘å®šçš„å…·ä½“é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line"><span class="meta">            value = @Queue(name = "LEYOU.SEARCH.SAVE.QUEUE", durable = "true"),</span></span><br><span class="line"><span class="meta">    		//æ¶ˆè´¹è€…å¯¹åº”é˜Ÿåˆ—ç»‘å®šçš„äº¤æ¢æœºï¼ˆå¿…é¡»å’Œç›¸åº”çš„ç”Ÿäº§è€…ç»‘å®šç›¸åŒçš„äº¤æ¢æœºï¼‰</span></span><br><span class="line"><span class="meta">    // ignoreDeclarationExceptions = "true":å¿½ç•¥å£°æ˜å¼‚å¸¸ï¼Œå½“äº¤æ¢æœºå·²å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†è¿›è¡Œå£°æ˜åº”è¯¥å‘ç”Ÿå¼‚å¸¸ï¼Œä½†æ˜¯è¿™é‡Œè¿›è¡Œå¿½ç•¥æ“ä½œã€‚</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = "LEYOU.ITEM.EXCHANGE", ignoreDeclarationExceptions = "true", type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    		//è®¾ç½®è·¯ç”±keyï¼Œè¯´æ˜ç”¨äºæ¥æ”¶é‚£äº›ä¿¡æ¯</span></span><br><span class="line"><span class="meta">            key = {"item.insert", "item.update"}</span></span><br></pre></td></tr></tbody></table></figure>
<p>åˆ›å»ºrabbitç›‘å¬ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsListener</span> </span>{</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SearchService searchService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = "LEYOU.SEARCH.SAVE.QUEUE", durable = "true"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = "LEYOU.ITEM.EXCHANGE", ignoreDeclarationExceptions = "true", type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">            key = {"item.insert", "item.update"}</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        searchService.save(id);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>å®ç°è¿™ä¸ªè‡ªå®šä¹‰çš„saveæ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥elasticsearchçš„æ•°æ®(æ ¹æ®idæŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ–°å¢æˆ–æ›´æ–°åçš„ä¿¡æ¯ï¼Œå†é‡æ–°å†²å…¥elasticsearchä¸­ï¼Œè¾¾åˆ°æ•°æ®åŒæ­¥çš„æ•ˆæœ)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">    Spu spu = <span class="keyword">this</span>.goodsClient.querySpuById(id);</span><br><span class="line">    Goods goods = <span class="keyword">this</span>.buildGoods(spu);</span><br><span class="line">    <span class="keyword">this</span>.goodsRepository.save(goods);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸»è¦æ˜¯å®ç°æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶å³å¯ï¼Œå…·ä½“æ›´æ–°å’Œæ–°å¢å°±æ˜¯å‰é¢çš„é€»è¾‘è€Œå·²â€¦</p>
<p>8.ç”¨æˆ·æ³¨å†Œçš„å‚æ•°æ ¡éªŒ</p>
<p>ä¾èµ–ï¼šwebå¯åŠ¨å™¨å†…ç½®çš„ä¾èµ–(å¦‚æœå¼•å…¥webå¯åŠ¨å™¨ä¹‹åå°±ä¸éœ€è¦å†å¼•å…¥ä¸‹é¢çš„äº†)</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Hibernate Validator</strong>æ˜¯Hibernateæä¾›çš„ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼éå¸¸æ–¹ä¾¿çš„å®ç°æœåŠ¡ç«¯çš„æ•°æ®æ ¡éªŒ</p>
<p><strong>å…·ä½“æ³¨è§£å«ä¹‰å’Œç”¨æ³•ï¼š</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Constraint</strong></th>
<th style="text-align:left"><strong>è¯¦ç»†ä¿¡æ¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>@Valid</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ£€æŸ¥æ­¤å¯¹è±¡çš„æ‰€æœ‰å­—æ®µå€¼</td>
</tr>
<tr>
<td><strong>@Null</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null</td>
</tr>
<tr>
<td><strong>@NotNull</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null</td>
</tr>
<tr>
<td><strong>@AssertTrue</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true</td>
</tr>
<tr>
<td><strong>@AssertFalse</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false</td>
</tr>
<tr>
<td><strong>@Min(value)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</td>
</tr>
<tr>
<td><strong>@Max(value)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</td>
</tr>
<tr>
<td><strong>@DecimalMin(value)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</td>
</tr>
<tr>
<td><strong>@DecimalMax(value)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</td>
</tr>
<tr>
<td><strong>@Size(max, min)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</td>
</tr>
<tr>
<td><strong>@Digits (integer, fraction)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</td>
</tr>
<tr>
<td><strong>@Past</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</td>
</tr>
<tr>
<td><strong>@Future</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</td>
</tr>
<tr>
<td><strong>@Pattern(value)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</td>
</tr>
<tr>
<td><strong>@Email</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€</td>
</tr>
<tr>
<td><strong>@Length</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</td>
</tr>
<tr>
<td><strong>@NotEmpty</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º</td>
</tr>
<tr>
<td><strong>@Range</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</td>
</tr>
<tr>
<td><strong>@NotBlank</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º</td>
</tr>
<tr>
<td><strong>@URL(protocol=,host=, port=,regexp=, flags=)</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„url</td>
</tr>
<tr>
<td><strong>@CreditCardNumber</strong></td>
<td style="text-align:left">è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²å¿…é¡»é€šè¿‡Luhnæ ¡éªŒç®—æ³•ï¼Œé“¶è¡Œå¡ï¼Œä¿¡ç”¨å¡ç­‰å·ç ä¸€èˆ¬éƒ½ç”¨Luhnè®¡ç®—åˆæ³•æ€§</td>
</tr>
</tbody>
</table>
</div>
<p>ä½¿ç”¨å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Table(name = "tb_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Length(min = 4, max = 30, message = "ç”¨æˆ·ååªèƒ½åœ¨4~30ä½ä¹‹é—´")</span></span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">// ç”¨æˆ·å</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Length(min = 4, max = 30, message = "å¯†ç åªèƒ½åœ¨4~30ä½ä¹‹é—´")</span></span><br><span class="line">    <span class="keyword">private</span> String password;<span class="comment">// å¯†ç </span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern(regexp = "^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\\d{8}$", message = "æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®")</span></span><br><span class="line">    <span class="keyword">private</span> String phone;<span class="comment">// ç”µè¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date created;<span class="comment">// åˆ›å»ºæ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String salt;<span class="comment">// å¯†ç çš„ç›å€¼</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="8-é˜¿é‡Œå¤§äºï¼šçŸ­ä¿¡å¾®æœåŠ¡-æ•´åˆrabbitmqå’Œredis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å’ŒçŸ­ä¿¡éªŒè¯ç 5åˆ†é’Ÿå¤±æ•ˆ"><a href="#8-é˜¿é‡Œå¤§äºï¼šçŸ­ä¿¡å¾®æœåŠ¡-æ•´åˆrabbitmqå’Œredis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å’ŒçŸ­ä¿¡éªŒè¯ç 5åˆ†é’Ÿå¤±æ•ˆ" class="headerlink" title="8.é˜¿é‡Œå¤§äºï¼šçŸ­ä¿¡å¾®æœåŠ¡(æ•´åˆrabbitmqå’Œredis,å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å’ŒçŸ­ä¿¡éªŒè¯ç 5åˆ†é’Ÿå¤±æ•ˆ)"></a>8.é˜¿é‡Œå¤§äºï¼šçŸ­ä¿¡å¾®æœåŠ¡(æ•´åˆrabbitmqå’Œredis,å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å’ŒçŸ­ä¿¡éªŒè¯ç 5åˆ†é’Ÿå¤±æ•ˆ)</h4><h5 id="8-1-å‰ç«¯è®¿é—®-è·å–æ‰‹æœºå·ç "><a href="#8-1-å‰ç«¯è®¿é—®-è·å–æ‰‹æœºå·ç " class="headerlink" title="8.1 å‰ç«¯è®¿é—®(è·å–æ‰‹æœºå·ç )"></a>8.1 å‰ç«¯è®¿é—®(è·å–æ‰‹æœºå·ç )</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚å‘é€çŸ­ä¿¡éªŒè¯ç (ç»™å®šå‚æ•°ï¼šæ‰‹æœºå·å’Œæ ¹æ®æ‰‹æœºå·éšæœºç”Ÿæˆçš„éªŒè¯ç ä¼ å…¥æ¶ˆæ¯é˜Ÿåˆ—)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> phone</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping("/code")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">sendVerifyCode</span><span class="params">(<span class="meta">@RequestParam("phone")</span> String phone)</span> </span>{</span><br><span class="line">    Boolean bool = userService.sendVerifyCode(phone);</span><br><span class="line">    <span class="keyword">if</span> (bool == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (!bool) {</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.badRequest().build();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="8-2-ä¸šåŠ¡é€»è¾‘ï¼šå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å‘é€å’Œredisçš„å…·ä½“è®¾ç½®"><a href="#8-2-ä¸šåŠ¡é€»è¾‘ï¼šå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å‘é€å’Œredisçš„å…·ä½“è®¾ç½®" class="headerlink" title="8.2 ä¸šåŠ¡é€»è¾‘ï¼šå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å‘é€å’Œredisçš„å…·ä½“è®¾ç½®"></a>8.2 ä¸šåŠ¡é€»è¾‘ï¼šå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å‘é€å’Œredisçš„å…·ä½“è®¾ç½®</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="comment">//rediså­˜å‚¨ç”¨æˆ·æ³¨å†ŒéªŒè¯çš„çš„å‰ç¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX = <span class="string">"user:verify:"</span>;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚å‘é€çŸ­ä¿¡éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">sendVerifyCode</span><span class="params">(String phone)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(phone)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ­£åˆ™æ ¡éªŒæ‰‹æœºå·æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">if</span> (!phone.matches(<span class="string">"^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\\d{8}$"</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ ¹æ®æ‰‹æœºå·ç”Ÿæˆ6ä½éªŒè¯ç (å·¥å…·ç±»ç›´æ¥ç”Ÿæˆ)</span></span><br><span class="line">        String code = NumberUtils.generateCode(<span class="number">6</span>);</span><br><span class="line">        Map&lt;String, String&gt; msg = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        msg.put(<span class="string">"phone"</span>, phone);</span><br><span class="line">        msg.put(<span class="string">"code"</span>, code);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//å‘é€æ¶ˆæ¯åˆ°rabbitmqæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ‰§è¡Œè½¬æ¢å™¨å’Œè·¯ç”±key,å¹¶å‘é€msgæ¶ˆæ¯åˆ°ç›‘å¬æœåŠ¡ç«¯ï¼‰</span></span><br><span class="line">            amqpTemplate.convertAndSend(<span class="string">"LEYOU.SMS.EXCHANGE"</span>, <span class="string">"sms.verify.code"</span>, msg);</span><br><span class="line">            <span class="comment">//ä¿å­˜éªŒè¯ç æ•°æ®åˆ°redisä¸­(äº”åˆ†é’Ÿä¹‹åè¿‡æœŸ)</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(KEY_PREFIX + phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">        } <span class="keyword">catch</span> (AmqpException e) {</span><br><span class="line">            log.info(<span class="string">"çŸ­ä¿¡éªŒè¯ç ï¼š{}å‘é€å¤±è´¥"</span>, code);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h5 id="8-3ç›‘å¬æœåŠ¡ç«¯ï¼š-ç›‘å¬rabbitmqæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–msgå¹¶å‘é€çŸ­ä¿¡"><a href="#8-3ç›‘å¬æœåŠ¡ç«¯ï¼š-ç›‘å¬rabbitmqæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–msgå¹¶å‘é€çŸ­ä¿¡" class="headerlink" title="8.3ç›‘å¬æœåŠ¡ç«¯ï¼š ç›‘å¬rabbitmqæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–msgå¹¶å‘é€çŸ­ä¿¡"></a>8.3ç›‘å¬æœåŠ¡ç«¯ï¼š ç›‘å¬rabbitmqæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–msgå¹¶å‘é€çŸ­ä¿¡</h5><p>å…·ä½“æ“ä½œï¼šå¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>é˜¿é‡Œäº‘è®¿é—®å¯†åŒ™å‚æ•°é…ç½®(å‚æ•°ä¸å¯æ³„æ¼)</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#å‚æ•°é…ç½®ï¼ˆå…·ä½“é…ç½®ç™»å½•é˜¿é‡Œäº‘æŸ¥æ‰¾ï¼‰</span></span><br><span class="line"><span class="attr">sms</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">service</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">accessKeyId</span>: <span class="string">LTAI4FpAkxvHDrQ2ZoBnBz**</span></span><br><span class="line">    <span class="attr">accessKeySecret</span>: <span class="string">MWCPkhImiyoklFEelO6m4d50gwao**</span></span><br><span class="line">    <span class="attr">signName</span>: <span class="string">è‡ªç”±å•†åŸ</span></span><br><span class="line">    <span class="attr">verifyCodeTemplate</span>: <span class="string">SMS_187261429</span></span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªæˆ‘å°è£…çš„å‘é€çŸ­ä¿¡çš„å·¥å…·ç±»ï¼ˆæ ¹æ®é˜¿é‡Œäº‘ç»™çš„å›ºå®šæ¨¡æŒ‰ä¿®æ”¹ï¼‰</p>
<p>è·å–å‚æ•°çš„javabean</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "sms.service")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsProperties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String signName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String verifyCodeTemplate;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/7 9:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SmsProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendSmsUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IAcsClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆè‡ªåŠ¨æ³¨å…¥å±æ€§é…ç½®ç±»ï¼ˆSmsPropertiesï¼‰å¥½åƒè·å–ä¸åˆ°å€¼ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SendSmsUtils</span><span class="params">(SmsProperties smsProperties)</span> </span>{</span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(</span><br><span class="line">                <span class="string">"cn-hangzhou"</span>,</span><br><span class="line">                smsProperties.getAccessKeyId(),</span><br><span class="line">                smsProperties.getAccessKeySecret());</span><br><span class="line">        client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResponse <span class="title">sendSms</span><span class="params">(String telephone, String param, String signName, String templateId)</span> <span class="keyword">throws</span> ClientException </span>{</span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">        request.setSysDomain(<span class="string">"dysmsapi.aliyuncs.com"</span>);</span><br><span class="line">        request.setSysVersion(<span class="string">"2017-05-25"</span>);</span><br><span class="line">        request.setSysAction(<span class="string">"SendSms"</span>);</span><br><span class="line">        <span class="comment">// æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç </span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, telephone);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡ç­¾ååç§°ã€‚è¯·åœ¨æ§åˆ¶å°ç­¾åç®¡ç†é¡µé¢ç­¾ååç§°ä¸€åˆ—æŸ¥çœ‹ï¼ˆå¿…é¡»æ˜¯å·²æ·»åŠ ã€å¹¶é€šè¿‡å®¡æ ¸çš„çŸ­ä¿¡ç­¾åï¼‰ã€‚</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, signName);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, templateId);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡æ¨¡æ¿å˜é‡å¯¹åº”çš„å®é™…å€¼ï¼ŒJSONæ ¼å¼ã€‚</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, param);</span><br><span class="line"></span><br><span class="line">        CommonResponse commonResponse = client.getCommonResponse(request);</span><br><span class="line">        log.info(<span class="string">"å‘é€çŸ­ä¿¡ç»“æœï¼š{}"</span>, commonResponse.getData());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> commonResponse;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>æœåŠ¡ç«¯ç›‘å¬å¹¶å‘é€çŸ­ä¿¡æ¶ˆæ¯</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SmsProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SendSmsUtils sendSmsUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SmsProperties smsProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬çŸ­ä¿¡æœåŠ¡è¯·æ±‚ï¼ˆrabbitmqï¼‰è¿›è¡ŒçŸ­ä¿¡å‘é€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//æ³¨æ„ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = "LEYOU.SMS.QUEUE", durable = "true"),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = "LEYOU.SMS.EXCHANGE", ignoreDeclarationExceptions = "true", type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">            key = {"sms.verify.code"})</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenSms</span><span class="params">(Map&lt;String, String&gt; msg)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(msg)) {</span><br><span class="line">            <span class="comment">// æ”¾å¼ƒå¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        String phone = msg.get(<span class="string">"phone"</span>);</span><br><span class="line">        String code = msg.get(<span class="string">"code"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(phone, code)) {</span><br><span class="line">            <span class="comment">// æ”¾å¼ƒå¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯(codeçš„ç±»å‹å¿…é¡»æ—¶jsonå­—ç¬¦ä¸²)</span></span><br><span class="line">        JsonObject jsonObject = <span class="keyword">new</span> JsonObject();</span><br><span class="line">        jsonObject.addProperty(<span class="string">"code"</span>, code);</span><br><span class="line">        <span class="comment">//å¡«å…¥å‚æ•°æ‰‹æœºå·phoneå’Œç”Ÿæˆçš„éªŒè¯ç code</span></span><br><span class="line">        CommonResponse commonResponse = <span class="keyword">this</span>.sendSmsUtils.sendSms(phone, jsonObject.toString(), smsProperties.getSignName(),</span><br><span class="line">                smsProperties.getVerifyCodeTemplate());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="9-ç®€å•çŸ­ä¿¡éªŒè¯ç "><a href="#9-ç®€å•çŸ­ä¿¡éªŒè¯ç " class="headerlink" title="9.ç®€å•çŸ­ä¿¡éªŒè¯ç "></a>9.ç®€å•çŸ­ä¿¡éªŒè¯ç </h4><p>åŸºæœ¬å·¥ä½œå’Œå‰é¢8çš„ä¸€æ ·(å»é™¤äº†rabbitmqçš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œæ›´åŠ ç®€æ´æ–¹ä¾¿)</p>
<p>controllerå±‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = "å¼‚æ­¥è¯·æ±‚éªŒè¯ç ", notes = "å“åº”å¼‚æ­¥è¯·æ±‚ï¼Œè°ƒç”¨å‘é€éªŒè¯ç æœåŠ¡")</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="meta">@GetMapping("/code")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">sendCode</span><span class="params">(<span class="meta">@RequestParam("phone")</span> String phone, RedirectAttributes redirectAttributes)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isBlank(phone)) {</span><br><span class="line">           redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"éªŒè¯ç è·å–å¤±è´¥ï¼Œè¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ï¼"</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"redirect:/admin/registered"</span>;</span><br><span class="line">       }</span><br><span class="line">       String message;</span><br><span class="line">       <span class="comment">//å‘é€éªŒè¯ç </span></span><br><span class="line">       <span class="keyword">boolean</span> sendStatus = userService.sendVerifyCode(phone);</span><br><span class="line">       <span class="keyword">if</span> (sendStatus) {</span><br><span class="line">           message = <span class="string">"éªŒè¯ç å‘é€æˆåŠŸ"</span>;</span><br><span class="line">           <span class="keyword">return</span> message;</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           message = <span class="string">"éªŒè¯ç å‘é€å¤±è´¥"</span>;</span><br><span class="line">           <span class="keyword">return</span> message;</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>serviceå±‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGISTERED_KEY = <span class="string">"user:registered:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒæ‰‹æœºå·ï¼Œå®ç°å‘é€éªŒè¯ç ï¼ˆredis:5åˆ†é’Ÿè¿‡æœŸï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@exception</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendVerifyCode</span><span class="params">(String phone)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(phone)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!phone.matches(<span class="string">"^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\\d{8}$"</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä½¿ç”¨å·¥å…·ç±»ï¼šæ ¹æ®æ‰‹æœºå·ç”Ÿæˆ6ä½éªŒè¯ç </span></span><br><span class="line">        String code = NumberUtils.generateCode(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line"></span><br><span class="line">            JsonObject object = <span class="keyword">new</span> JsonObject();</span><br><span class="line">            object.addProperty(<span class="string">"code"</span>, code);</span><br><span class="line">            <span class="comment">//è°ƒç”¨å‘é€éªŒè¯ç æœåŠ¡</span></span><br><span class="line">            CommonResponse commonResponse = sendSmsUtils.sendSms(phone, object.toString(), smsProperties.getSignName(),</span><br><span class="line">                    smsProperties.getVerifyCodeTemplate());</span><br><span class="line">            <span class="comment">//å­˜å…¥redis:5åˆ†é’Ÿè¿‡æœŸæ—¶é—´</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(REGISTERED_KEY + phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.info(<span class="string">"çŸ­ä¿¡éªŒè¯ç :{}å‘é€å¤±è´¥"</span>, code);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å‘é€çŸ­ä¿¡çš„å·¥å…·ç±»sendSmsUtils</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SmsProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendSmsUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IAcsClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆè‡ªåŠ¨æ³¨å…¥å±æ€§é…ç½®ç±»ï¼ˆSmsPropertiesï¼‰å¥½åƒè·å–ä¸åˆ°å€¼ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SendSmsUtils</span><span class="params">(SmsProperties smsProperties)</span> </span>{</span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(</span><br><span class="line">                <span class="string">"cn-hangzhou"</span>,</span><br><span class="line">                smsProperties.getAccessKeyId(),</span><br><span class="line">                smsProperties.getAccessKeySecret());</span><br><span class="line">        client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResponse <span class="title">sendSms</span><span class="params">(String telephone, String param, String signName, String templateId)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">        request.setSysDomain(<span class="string">"dysmsapi.aliyuncs.com"</span>);</span><br><span class="line">        request.setSysVersion(<span class="string">"2017-05-25"</span>);</span><br><span class="line">        request.setSysAction(<span class="string">"SendSms"</span>);</span><br><span class="line">        <span class="comment">// æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç </span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, telephone);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡ç­¾ååç§°ã€‚è¯·åœ¨æ§åˆ¶å°ç­¾åç®¡ç†é¡µé¢ç­¾ååç§°ä¸€åˆ—æŸ¥çœ‹ï¼ˆå¿…é¡»æ˜¯å·²æ·»åŠ ã€å¹¶é€šè¿‡å®¡æ ¸çš„çŸ­ä¿¡ç­¾åï¼‰ã€‚</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, signName);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, templateId);</span><br><span class="line">        <span class="comment">// çŸ­ä¿¡æ¨¡æ¿å˜é‡å¯¹åº”çš„å®é™…å€¼ï¼ŒJSONæ ¼å¼ã€‚</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, param);</span><br><span class="line"></span><br><span class="line">        CommonResponse commonResponse = client.getCommonResponse(request);</span><br><span class="line">        log.info(<span class="string">"å‘é€çŸ­ä¿¡ç»“æœï¼š{}"</span>, commonResponse.getData());</span><br><span class="line">        <span class="keyword">return</span> commonResponse;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="VueåŸºç¡€"><a href="#VueåŸºç¡€" class="headerlink" title="VueåŸºç¡€"></a>VueåŸºç¡€</h2><h3 id="vueå…¥é—¨ç¬”è®°"><a href="#vueå…¥é—¨ç¬”è®°" class="headerlink" title="vueå…¥é—¨ç¬”è®°"></a><code>vue</code>å…¥é—¨ç¬”è®°</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset="UTF-8"&gt;</span><br><span class="line">    &lt;title&gt;Hello&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .active {</span><br><span class="line">        color: red;</span><br><span class="line">    }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--vueå¯¹è±¡çš„htmlæ¨¡æ¿--&gt;</span><br><span class="line">&lt;div id="app"&gt;</span><br><span class="line">    &lt;!--è°ƒç”¨è®¡ç®—å±æ€§--&gt;</span><br><span class="line">    &lt;span&gt;ç°åœ¨æ—¶é—´æ˜¯ï¼š{{birth}}&lt;/span&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!--æœç´¢ç›‘å¬watch--&gt;</span><br><span class="line">    &lt;input type="text" v-model="search" placeholder="è§¦å‘ç›‘å¬äº‹ä»¶..."&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!--v-model=æ•°æ®æ¨¡å‹ï¼šåŒå‘ç»‘å®šï¼Œå¯ä»¥åŒæ—¶æ”¹å˜æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®å€¼--&gt;</span><br><span class="line">    &lt;input type="text" v-model="num"/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!--v-on:å¯ä»¥è®¾ç½®ç›‘å¬é”®ç›˜äº‹ä»¶ï¼Œå¹¶ä¸”æä¾›äº†æŒ‰é”®ä¿®é¥°ç¬¦å’Œç›¸åº”çš„åˆ«å--&gt;</span><br><span class="line">    &lt;input type="text" v-model="num" @keyup.enter="submit"/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!--v-on:äº‹ä»¶å="jsè¡¨è¾¾å¼æˆ–è€…æ–¹æ³•å"ï¼šç»‘å®šäº‹ä»¶ï¼Œå¯ä»¥ç®€å†™æˆï¼š@click="insc--&gt;</span><br><span class="line">    &lt;input type="button" value="é¼ æ ‡å·¦é”®ç‚¹å‡»äº‹ä»¶.." @click="insc"/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type="button" value="é¼ æ ‡å·¦é”®ç‚¹å‡»äº‹ä»¶ï¼ˆå¹¶ä½¿ç”¨ï¼ˆpreventï¼‰å–æ¶ˆé»˜è®¤ç‚¹å‡»äº‹ä»¶ï¼‰.." @contextmenu.prevent="insc"/&gt;</span><br><span class="line">    &lt;!--{{}}:èŠ±æ‹¬å·é‡Œé¢æœ¬è´¨ä¸Šï¼šjsè¡¨è¾¾å¼ï¼Œé‡Œé¢ä¹Ÿå¯ä»¥è¿›è¡Œé€»è¾‘è¿ç®—--&gt;</span><br><span class="line">    &lt;!--å•å‘ç»‘å®šï¼šå£°æ˜å¼æ¸²æŸ“ï¼Œåªèƒ½ä»æ•°æ®æ¨¡å‹ä¸­è·å–æ•°æ®ï¼Œä¸èƒ½æ”¹å˜æ•°æ®æ¨¡å‹ä¸­çš„å€¼--&gt;</span><br><span class="line">    &lt;h2&gt;æˆ‘æ˜¯{{name}}ï¼Œæˆ‘æœ‰{{num}}ä¸‡å…ƒ&lt;/h2&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;!--&lt;span v-text="name"&gt;&lt;/span&gt;:å°†æ•°æ®è¾“å‡ºåˆ°å…ƒç´ å†…éƒ¨ï¼Œç›¸å½“äºth:text,ä¼šè¿›è¡Œhtmlçš„æ ‡ç­¾è½¬ä¹‰ï¼ˆæ¨èä½¿ç”¨ï¼‰--&gt;</span><br><span class="line">    &lt;!--&lt;span v-html="name"&gt;&lt;/span&gt;:å°†æ•°æ®è¾“å‡ºåˆ°å…ƒç´ å†…éƒ¨ï¼Œç›¸å½“äºth:utext,ä¸ä¼šè¿›è¡Œhtmlçš„æ ‡ç­¾è½¬ä¹‰ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨--&gt;</span><br><span class="line">    &lt;h2&gt;æˆ‘æ˜¯&lt;span v-text="name"&gt;&lt;/span&gt;ï¼Œæˆ‘æœ‰&lt;span v-text="num"&gt;&lt;/span&gt;ä¸‡å…ƒ&lt;/h2&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;!--v-model:å¤æ‚ç±»å‹çš„åŒå‘ç»‘å®šï¼Œæ ¹æ®æ‰€é€‰é¡¹çš„å€¼æ¥åˆ¤å®šæ•°æ®æ¨¡å‹æ˜¯æ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼Œæˆ–booleanç±»å‹çš„å€¼ï¼Œå¹¶ä¸”åªæœ‰èƒ½åœ¨é¡µé¢è¿›è¡Œæ›´æ”¹æ•°æ®çš„å…ƒç´ æ‰èƒ½è¿›è¡ŒåŒå‘ç»‘å®š--&gt;</span><br><span class="line">    &lt;input type="checkbox" value="meizu" v-model="language"/&gt;é­…æ—&lt;br/&gt;</span><br><span class="line">    &lt;input type="checkbox" value="oppo" v-model="language"/&gt;OPPO&lt;br/&gt;</span><br><span class="line">    &lt;input type="checkbox" value="vivo" v-model="language"/&gt;VIVO&lt;br/&gt;</span><br><span class="line">    æ‚¨é€‰è´­äº†&lt;span v-text="language.join(',')"&gt;&lt;/span&gt;æ‰‹æœº</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;br/&gt;</span><br><span class="line">    &lt;h3&gt;éå†æ•°ç»„&lt;/h3&gt;</span><br><span class="line">    &lt;ul v-for="(user,index) in users" :key="index" v-if="user.sex == 'woman'"&gt;</span><br><span class="line">        &lt;li v-text="index+1"&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li v-html="user.name"&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li v-text="user.age"&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li v-text="user.sex"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;!--éå†å¯¹è±¡(å¯ä»¥æ‹¿åˆ°å¯¹è±¡ä¸­çš„keyå’Œå¯¹åº”çš„valueå’Œindex)  :key="index"ä½œç”¨ï¼šæé«˜æ¸²æŸ“æ•ˆç‡ï¼Œå…·ä½“ä¸çŸ¥é“ä»€ä¹ˆç”¨--&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li v-for="(val,key,index) in user" :key="index"&gt;{{index+1}}--{{key}}--{{val}}&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;!--v-if="è¡¨è¾¾å¼"(æ¨èä½¿ç”¨ï¼Œä¸¤ä¸ªæ•ˆæœç›¸åŒï¼Œä½†æ•ˆç‡æ›´é«˜)--&gt;</span><br><span class="line">    &lt;input type="button" value="ç‚¹å‡»éšè—æˆ–æ˜¾ç¤º" @click="show=!show"&gt;&lt;br&gt;</span><br><span class="line">    &lt;span v-if="show"&gt;èƒ½çœ‹åˆ°æˆ‘ï¼Œè¯´æ˜æˆ‘æ˜¯true&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;!--v-show="è¡¨è¾¾å¼"--&gt;</span><br><span class="line">    &lt;span v-show="show"&gt;èƒ½çœ‹åˆ°æˆ‘ï¼Œè¯´æ˜æˆ‘æ˜¯true&lt;/span&gt;&lt;br&gt;</span><br><span class="line">    &lt;!--v-bindçš„åŸºæœ¬ä½¿ç”¨åœºæ™¯ï¼š</span><br><span class="line">        ï¼ˆæ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ¿€æ´»æ ·å¼æ˜¾ç¤ºï¼‰å¦‚æœåº“å­˜å¤§äº0ï¼Œå°±æ¿€æ´»åŠ å…¥è´­ç‰©è½¦æŒ‰é’®çš„æ ·å¼ æˆ–è€…</span><br><span class="line">        ä¹Ÿå¯ä»¥è¿›è¡Œå±æ€§çš„ç»‘å®šï¼Œç»‘å®šä¹‹åï¼Œæ¨¡æ¿å°±ä¼šå…ˆåˆ°æ•°æ®æ¨¡å‹ä¸­å¯»æ‰¾å¯¹åº”åç§°çš„å±æ€§å€¼ï¼Œè‹¥æœ‰å°±æ¸²æŸ“æ˜¾ç¤ºå‡ºæ¥</span><br><span class="line">        åŠ¨æ€æ ·å¼ï¼ˆv-bind:classï¼‰å’Œé™æ€æ ·å¼ï¼ˆclassï¼‰å¯ä»¥å…±å­˜ï¼Œ</span><br><span class="line">         --&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;input type="text" v-model="store" placeholder="åº“å­˜æ•°é‡..."/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type="button" v-bind:class="{active: store &gt; 0}" class="" v-bind:value="buttonValue"/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--å¼•å…¥vueèµ„æº--&gt;</span><br><span class="line">&lt;script src="node_modules/vue/dist/vue.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    /*åˆ›å»ºVueå®ä¾‹*/</span><br><span class="line">    const app = new Vue({</span><br><span class="line">        el: "#app",  //é€‰æ‹©å™¨ï¼šæ‰€é€‰æ‹©çš„å®¹å™¨å°±æ˜¯æ­¤vueå®ä¾‹æ‰€åœ¨çš„å®¹å™¨</span><br><span class="line">        data: {     //å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆé‡Œé¢å…¨éƒ¨éƒ½æ˜¯è‡ªå®šä¹‰çš„å„ç§æ•°æ®æ¨¡å‹ï¼‰</span><br><span class="line">            name: "æœ¨å­",</span><br><span class="line">            num: 300,</span><br><span class="line">            language: [],</span><br><span class="line">            /*æ•°ç»„*/</span><br><span class="line">            users: [</span><br><span class="line">                {name: '&lt;span style="color: red;"&gt;java&lt;/span&gt;', age: 23, sex: 'man'},</span><br><span class="line">                {name: '&lt;span style="color: red;"&gt;php&lt;/span&gt;', age: 22, sex: 'woman'},</span><br><span class="line">                {name: '&lt;span style="color: red;"&gt;c++&lt;/span&gt;', age: 20, sex: 'man'},</span><br><span class="line">                {name: '&lt;span style="color: red;"&gt;javaScript&lt;/span&gt;', age: 18, sex: 'woman'},</span><br><span class="line">                {name: '&lt;span style="color: red;"&gt;python&lt;/span&gt;', age: 9, sex: 'man'},</span><br><span class="line">            ],</span><br><span class="line">            /*å¯¹è±¡*/</span><br><span class="line">            user: {</span><br><span class="line">                name: 'java',</span><br><span class="line">                age: 23,</span><br><span class="line">                sex: 'man'</span><br><span class="line">            },</span><br><span class="line">            /*å¸ƒå°”ç±»å‹æ•°æ®*/</span><br><span class="line">            show: true,</span><br><span class="line">            store: 0,</span><br><span class="line">            buttonValue: "åŠ å…¥è´­ç‰©è½¦",</span><br><span class="line">            birthday: 1529032123201, //æ¯«ç§’å€¼</span><br><span class="line">            search: "",</span><br><span class="line">        },</span><br><span class="line">        /*ç›‘å¬ï¼šé‡Œé¢çš„æ–¹æ³•åå¿…é¡»å’Œç»‘å®šçš„v-model="search"çš„æ•°æ®æ¨¡å‹çš„åå­—ä¸€æ ·ï¼ŒnewData:å‘ç”Ÿå˜åŒ–ä¹‹åçš„å€¼ï¼ŒoldData:æ”¾ç”Ÿå˜åŒ–ä¹‹å‰çš„å€¼*/</span><br><span class="line">        watch: {</span><br><span class="line">            search(newData, oldData) {</span><br><span class="line">                //å‘é€axiosè¯·æ±‚åˆ°åå°è·å–æ•°æ®</span><br><span class="line">                console.log(newData + "==" + oldData);</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            insc() {</span><br><span class="line">                /*this:ç›¸å½“äºvueå®ä¾‹å¯¹è±¡ï¼šå¯ä»¥æ“ä½œæ­¤vueå®ä¾‹é‡Œé¢çš„ä»»ä½•å†…å®¹*/</span><br><span class="line">                this.num += 5;</span><br><span class="line">            },</span><br><span class="line">            submit() {</span><br><span class="line">                alert("æäº¤æˆåŠŸ...");</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        /*è®¡ç®—å±æ€§ï¼šå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªå±æ€§ã€‚é‡Œé¢çš„æ–¹æ³•å¿…é¡»è¦æœ‰è¿”å›å€¼,å¹¶ä¸”è‡ªç”¨å½“æ–¹æ³•ä¸­çš„dateå‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°è¿›è¡Œè®¡ç®—ç»“æœï¼Œï¼ˆä¸æ™®é€šå‡½æ•°æœ‰æœ¬è´¨åŒºåˆ«ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´æ•ˆç‡æ›´é«˜*/</span><br><span class="line">        computed: {</span><br><span class="line">            birth() {</span><br><span class="line">                const date = new Date(this.birthday);</span><br><span class="line">                return date.getFullYear() + "å¹´" + date.getMonth() + "æœˆ" + date.getDay() + "æ—¥";</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        /*created()ï¼šåˆ›å»ºvueå®ä¾‹ä¹‹åï¼ŒåŠ è½½æ•°æ®æ¨¡æ¿ä¹‹å‰è¢«æ‰§è¡Œçš„é’©å­å‡½æ•°(ä¸€èˆ¬ç”¨äºå‘é€axiosè¯·æ±‚åˆ°æœåŠ¡å™¨è·å–æ•°æ®)*/</span><br><span class="line">        created() {</span><br><span class="line">            //axios</span><br><span class="line">            this.num = 10000; //è¿™é‡Œå°±ç›¸å½“äºnum=10000è¦†ç›–äº†åˆ›å»ºå®ä¾‹æ—¶å£°æ˜çš„num=300æ•°æ®æ¨¡å‹çš„å€¼ï¼ˆå£°æ˜æ—¶çš„numçš„ä¼˜å…ˆçº§æ›´é«˜ï¼‰</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶"><a href="#å…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶" class="headerlink" title="å…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶"></a><code>å…¨å±€ç»„ä»¶</code>å’Œ<code>å±€éƒ¨ç»„ä»¶</code></h3><p>å…¨å±€ç»„ä»¶ï¼šåœ¨å½“å‰é¡µé¢çš„ä»»æ„ä¸€ä¸ªè¢«vueç»‘å®šçš„divä¸­ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¯¥å…¨å±€ç»„ä»¶</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"component"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä»¥å®šä¹‰çš„ç»„ä»¶åæ¥æ¸²æŸ“æ˜¾ç¤ºç»„ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">counter</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">/*å…¨å±€å­ç»„ä»¶:å¿…é¡»å¸è½½vueå®ä¾‹çš„ä¸Šé¢ï¼Œè€Œä¸”æ˜¯ç›´æ¥è¢«Vueç±»å£°æ˜çš„ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆ*/</span></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">"counter"</span>, {</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template: "<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">'num++'</span>&gt;</span>ç‚¹å‡»numåŠ 1 -- num=</span><span class="template-variable">{{<span class="name">num</span>}}</span><span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span>",</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">/*æ³¨æ„ï¼šcomponentç»„ä»¶ä¸­dataå°±æ˜¯ä¸ªå‡½æ•°ï¼Œå…¶returnçš„è¿”å›å€¼æ‰æ˜¯æ•°æ®æ¨¡å‹*/</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">            <span class="comment">//å¿…é¡»ä½¿ç”¨returnè¿”å›ä¹‹åï¼Œæ‰è¯´æ˜åœ¨dataä¸­æ³¨å†Œäº†ä»¥å’Œnumå±æ€§ï¼Œè¦å’ŒVueå®ä¾‹ä¸­çš„dataå±æ€§å†™æ³•åŒºåˆ«</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> {</span></span><br><span class="line">                num: 0,</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"><span class="javascript">    <span class="comment">/*çˆ¶ç»„ä»¶*/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vue = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">        el: <span class="string">"#component"</span>,</span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            num: <span class="number">0</span>,  <span class="comment">//è¿™é‡Œçš„numå¹¶ä¸æ˜¯å­ç»„ä»¶ä¸­num,</span></span></span><br><span class="line">        },</span><br><span class="line">    });</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>å±€éƒ¨ç»„ä»¶ï¼šåªèƒ½åœ¨å½“å‰å±€éƒ¨ç»„ä»¶æ‰€åœ¨çš„divä¸­æ‰èƒ½ä½¿ç”¨è¯¥å±€éƒ¨ç»„ä»¶</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"component"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tiny</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">/*å±€éƒ¨å­ç»„ä»¶ï¼šå¿…é¡»æ˜¾å¼å¼•å…¥vueå®ä¾‹ä¸­æ‰èƒ½è¿›è¡Œä½¿ç”¨ï¼Œå¹¶ä¸”ä¸èƒ½å’Œå…¨å±€å­ç»„ä»¶ä¸€å—ä½¿ç”¨ï¼Œä¼šè¢«è¦†ç›–*/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> smallComponent = {</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template: "<span class="tag">&lt;<span class="name">span</span>&gt;</span>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯</span><span class="template-variable">{{<span class="name">name</span>}}</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span>",</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">                name: <span class="string">"åˆ˜å¾·å"</span>,</span></span><br><span class="line">            };</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"><span class="javascript">    <span class="comment">/*çˆ¶ç»„ä»¶*/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vue = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">        el: <span class="string">"#component"</span>,</span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            num: <span class="number">0</span>,  <span class="comment">//è¿™é‡Œçš„numå¹¶ä¸æ˜¯å­ç»„ä»¶ä¸­num,</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        <span class="comment">/*å£°æ˜æ³¨å†Œå±€éƒ¨å­ç»„ä»¶*/</span></span></span><br><span class="line">        components: {</span><br><span class="line"><span class="javascript">            <span class="comment">//key(åœ¨é¡µé¢ä½¿ç”¨çš„ç»„ä»¶å)--value(è¯´æ˜æ˜¯å“ªä¸ªå±€éƒ¨å­ç»„ä»¶)</span></span></span><br><span class="line">            tiny: smallComponent,</span><br><span class="line">       }</span><br><span class="line">    });</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>çˆ¶å­ç»„ä»¶é€šä¿¡</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"component"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--@increvent="incr()":çˆ¶ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶ï¼ˆåå­—éšä¾¿å†™ï¼‰è°ƒç”¨è‡ªå·±çš„å‡½æ•°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">counter</span> <span class="attr">:num1</span>=<span class="string">"num"</span> @<span class="attr">increvent</span>=<span class="string">"incr()"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    /*çˆ¶å‘å­ä¼ é€’ä¿¡æ¯(å•å‘é€šä¿¡)</span><br><span class="line">    * é¦–å…ˆï¼šçˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰å±æ€§ï¼ˆå±æ€§åä»»æ„ï¼Œå±æ€§å€¼æ˜¯è¦ä¼ é€’çš„æ•°æ®ï¼‰</span><br><span class="line">    * ä¹‹åï¼šå­ç»„ä»¶é€šè¿‡propsï¼ˆæ˜¯ä¸ªæ•°ç»„ï¼‰æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®ï¼ˆé€šè¿‡è‡ªå®šä¹‰çš„å±æ€§åï¼‰</span><br><span class="line">    * </span><br><span class="line"><span class="javascript">    * å­å‘çˆ¶é€šä¿¡ï¼š<span class="built_in">this</span>.$emit(<span class="string">"çˆ¶ç»„ä»¶ä¸­çš„è‡ªå®šä¹‰äº‹ä»¶å"</span>)</span></span><br><span class="line">    * */</span><br><span class="line"><span class="javascript">    <span class="comment">/*å…¨å±€å­ç»„ä»¶:å¿…é¡»å¸è½½vueå®ä¾‹çš„ä¸Šé¢ï¼Œè€Œä¸”æ˜¯ç›´æ¥è¢«Vueç±»å£°æ˜çš„ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆ*/</span></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">"counter"</span>, {</span></span><br><span class="line"><span class="javascript">        props: [<span class="string">"num1"</span>],</span></span><br><span class="line"><span class="javascript">        <span class="comment">/*å¦ä¸€ç§å†™æ³•:ç†è§£å³å¯ï¼Œå¹¶æ²¡æœ‰çœŸå®çš„çº¦æŸåŠ›*/</span></span></span><br><span class="line">/*        props: {</span><br><span class="line">            num1: {</span><br><span class="line"><span class="javascript">                type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">                <span class="keyword">default</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">                required: <span class="literal">true</span></span></span><br><span class="line">            }</span><br><span class="line">        },*/</span><br><span class="line"><span class="handlebars"><span class="xml">        template: "<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">'sonFun'</span>&gt;</span>ç‚¹å‡»numåŠ 1 -- num=</span><span class="template-variable">{{<span class="name">num1</span>}}</span><span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span>",</span></span></span><br><span class="line">        methods: {</span><br><span class="line"><span class="javascript">            <span class="comment">//é€šè¿‡è§¦å‘å­ç»„ä»¶çš„æ–¹æ³•ï¼Œè¿™æ ·å†™å¯ä»¥è§¦å‘è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼Œå®ç°å­ç»„ä»¶çš„å˜åŒ–è§¦å‘è°ƒç”¨çˆ¶ç»„ä»¶ï¼Œè¿›è€Œè¾¾åˆ°åŒæ­¥å˜åŒ–çš„æ•ˆæœ</span></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">sonFun</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">                <span class="comment">//this.$emit("çˆ¶ç»„ä»¶ä¸­çš„è‡ªå®šä¹‰äº‹ä»¶å"):å›ºå®šå†™æ³•</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.$emit(<span class="string">"increvent"</span>);</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"><span class="javascript">    <span class="comment">/*çˆ¶ç»„ä»¶*/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vue = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">        el: <span class="string">"#component"</span>,</span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            num: <span class="number">0</span>,  <span class="comment">//è¿™é‡Œçš„numç”¨äºä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨</span></span></span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">incr</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.num++;</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a><code>vue-router</code></h3><p>1.å®‰è£…<code>vue-router</code>ç»„ä»¶</p>
<blockquote>
<p>npm install vue-router â€”save  (æœ¬åœ°å®‰è£…)</p>
</blockquote>
<p>2.vueé¡µé¢å¼•å…¥vue-router</p>
<blockquote>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾å¼çš„å£°æ˜ä½¿ç”¨ç»„ä»¶</span></span><br><span class="line">Vue.use(VueRouter);</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>3.ç¼–å†™è·¯ç”±é…ç½®</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//å¼•å…¥è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> Content <span class="keyword">from</span> <span class="string">'../components/content'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'../components/home'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®å¯¼å‡ºè·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter({</span><br><span class="line">  <span class="comment">//ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚urlä¸Šé¢ä¸ä¼šå‡ºç°"#"å·</span></span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  <span class="comment">//åç§°éƒ½æ˜¯å›ºå®šçš„å†™æ³•</span></span><br><span class="line">  routes: [</span><br><span class="line">    {</span><br><span class="line">      <span class="comment">//é…ç½®è·¯ç”±è·¯å¾„</span></span><br><span class="line">      path: <span class="string">'/content'</span>,</span><br><span class="line">      <span class="comment">//è‡ªå®šä¹‰è·¯ç”±çš„åå­—</span></span><br><span class="line">      name: <span class="string">'content'</span>,</span><br><span class="line">      <span class="comment">//é…ç½®è¯¥è·¯ç”±è·¯å¾„è¦è·³è½¬çš„ç»„ä»¶é¡µé¢</span></span><br><span class="line">      component: Content</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">//é…ç½®çš„å¦ä¸€ä¸ªè·¯ç”±</span></span><br><span class="line">    {</span><br><span class="line">      path: <span class="string">'/home'</span>,</span><br><span class="line">      name: <span class="string">'home'</span>,</span><br><span class="line">      component: Home</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æ‰©å±•ï¼šåœ¨é¡µé¢é‡Œç›´æ¥è¿›è¡Œé¡µé¢è·³è½¬ï¼ˆä¾‹å¦‚loginç™»å½•é¡µæ ¡éªŒæˆåŠŸè·³è½¬mainé¦–é¡µï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ vue-router è·¯ç”±åˆ°æŒ‡å®šé¡µé¢ï¼Œè¯¥æ–¹å¼ç§°ä¹‹ä¸ºç¼–ç¨‹å¼å¯¼èˆª</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">"/main"</span>);  <span class="comment">//å¯ä»¥å›é€€åˆ°ä¸Šä¸€çº§é¡µé¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//pushæ–¹æ³•ä¼šå‘ history æ ˆæ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•ï¼Œè€Œreplaceæ–¹æ³•æ˜¯æ›¿æ¢å½“å‰çš„é¡µé¢ï¼Œ</span></span><br><span class="line">ä¸ä¼šå‘ history æ ˆæ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•</span><br><span class="line">&lt;router-link to="/05" replace&gt;05&lt;/router-link&gt;</span><br><span class="line"><span class="comment">// ä¸€èˆ¬ä½¿ç”¨replaceæ¥åš404é¡µé¢</span></span><br><span class="line"><span class="keyword">this</span>.$router.replace(<span class="string">'/'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// é¡µé¢è·¯ç”±è·³è½¬ å‰è¿›æˆ–è€…åé€€</span></span><br><span class="line"><span class="keyword">this</span>.$router.go(-<span class="number">1</span>) <span class="comment">// åé€€</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>æ‰©å±•ï¼šåµŒå¥—è·¯ç”±å¹¶ä¼ é€’å‚æ•°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">     path: <span class="string">'/main'</span>,</span><br><span class="line">     name: <span class="string">'Main'</span>,</span><br><span class="line">     component: Main,</span><br><span class="line">     <span class="comment">//åµŒå¥—è·¯ç”±å¹¶å¼€å¯å‚æ•°æ¥æ”¶åŠŸèƒ½</span></span><br><span class="line">     props: <span class="keyword">true</span>,</span><br><span class="line">    <span class="comment">//childred:è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåµŒå¥—è·¯ç”±ï¼Œ/:id/:username:ç»‘å®šä¼ é€’çš„å‚æ•°</span></span><br><span class="line">     children: [</span><br><span class="line">       {path: <span class="string">'/user/profile/:id/:username'</span>, name: <span class="string">'userProfile'</span>, component: userProfile, props: <span class="keyword">true</span>},</span><br><span class="line">       {path: <span class="string">'/user/list'</span>, name: <span class="string">'userList'</span>, component: userList,},</span><br><span class="line">     ]</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p><code>é¡µé¢åµŒå¥—è·¯ç”±çš„è·³è½¬å†™æ³•</code>:æ³¨æ„å‚æ•°ä¼ é€’çš„å†™æ³•</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">"1-1"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--åµŒå¥—è·¯ç”±å¿…é¡»ä½¿ç”¨v-bindç»‘å®šå¯¹è±¡ï¼Œnameï¼šä¼ é€’ç›¸åº”çš„ç»„ä»¶åï¼Œ params:ä¼ é€’å‚æ•°--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"{name: 'userProfile',params: {id:1,username:'é©¬æ»¨'}}"</span>&gt;</span>ä¸ªäººä¿¡æ¯<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">"1-2"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/user/list"</span>&gt;</span>ç”¨æˆ·åˆ—è¡¨<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ¥æ”¶å‚æ•°å¹¶å±•ç¤ºçš„ä¸¤ç§æ–¹æ³•ï¼š</p>
<p><span class="github-emoji"><span>ğŸ…°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f170.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>åŸç”Ÿæ–¹æ³•å±•ç¤º</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  //ç›´æ¥ä½¿ç”¨$route.params.å…·ä½“å‚æ•°å</span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>{{$route.params.id}}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>{{$route.params.username}}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji"><span>ğŸ…±</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f171.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä¸Šé¢è·¯ç”±é…ç½®çš„props:trueå°±æ˜¯ä¸ºè¿™é‡Œæ¥æ”¶å‚æ•°åšå‡†å¤‡çš„</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">å…ˆåœ¨è·³è½¬åçš„å±•ç¤ºé¡µé¢æ¥æ”¶å‚æ•°ï¼Œå†è¿›è¡Œå±•ç¤º</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="comment">//propsè¿›è¡Œå‚æ•°æ¥æ”¶</span></span></span><br><span class="line"><span class="javascript">    name: <span class="string">"userProfile"</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">'id'</span>, <span class="string">'username'</span>],</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>{{id}}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>{{username}}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>routerå’Œrouteçš„åŒºåˆ«ï¼š</code></p>
<blockquote>
<p>1.routeræ˜¯VueRouterçš„ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡Vue.use(VueRouter)å’ŒVueRouteræ„é€ å‡½æ•°å¾—åˆ°ä¸€ä¸ªrouterçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­æ˜¯ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡ï¼Œä»–åŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±åŒ…å«äº†è®¸å¤šå…³é”®çš„å¯¹è±¡å’Œå±æ€§ã€‚</p>
<p>ä¸¾ä¾‹ï¼šhistoryå¯¹è±¡</p>
<p>$router.push({path:â€™homeâ€™});æœ¬è´¨æ˜¯å‘historyæ ˆä¸­æ·»åŠ ä¸€ä¸ªè·¯ç”±ï¼Œåœ¨æˆ‘ä»¬çœ‹æ¥æ˜¯ åˆ‡æ¢è·¯ç”±ï¼Œä½†æœ¬è´¨æ˜¯åœ¨æ·»åŠ ä¸€ä¸ªhistoryè®°å½•</p>
<p>æ–¹æ³•ï¼š</p>
<p>$router.replace({path:â€™homeâ€™});//æ›¿æ¢è·¯ç”±ï¼Œæ²¡æœ‰å†å²è®°å½•</p>
<p>2.routeæ˜¯ä¸€ä¸ªè·³è½¬çš„è·¯ç”±å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªè·¯ç”±éƒ½ä¼šæœ‰ä¸€ä¸ªrouteå¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå±€éƒ¨çš„å¯¹è±¡ï¼Œå¯ä»¥è·å–å¯¹åº”çš„name,path,params,queryç­‰</p>
</blockquote>
<p><code>é‡å®šå‘</code>è·¯ç”±é…ç½®:ç®€å•ç²—æš´</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">, {</span><br><span class="line">      path: <span class="string">'/goHome'</span>,</span><br><span class="line">      name: <span class="string">'goHome'</span>,</span><br><span class="line">      <span class="comment">/*é‡å®šå‘åˆ°ä¸Šé¢å·²ç»é…ç½®çš„/mainè·¯ç”±è·¯å¾„*/</span></span><br><span class="line">      redirect: <span class="string">'/main'</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><code>404é¡µé¢è·³è½¬</code>ï¼šä¸€å®šæ”¾åˆ°è·¯ç”±é…ç½®çš„æœ€ä¸‹æ–¹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> notFound from <span class="string">'../view/404'</span></span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">      <span class="comment">/*å¦‚æœä¸Šé¢æ²¡æœ‰åŒ¹é…çš„è·¯å¾„ï¼Œå°±èµ°è¿™ä¸ªpath  *ä»£è¡¨ä»»æ„è·¯å¾„:*/</span></span><br><span class="line">      path: <span class="string">'*'</span>,</span><br><span class="line">      name: <span class="string">'notFound'</span>,</span><br><span class="line">      component: notFound,</span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure>
<p>4.åœ¨å”¯ä¸€å…¥å£æ–‡ä»¶main.jså¼€å¯routerè·¯ç”±åŠŸèƒ½</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å› ä¸ºrouteræ–‡ä»¶å¤¹ä¸‹é¢åªæœ‰ä¸€ä¸ªè·¯ç”±æ–‡ä»¶index.jsï¼Œæ‰€ä»¥è¿™é‡Œå¼•å…¥æ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨æ‰«æé‡Œé¢çš„index.jsæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//main.jsï¼šæ˜¯æ•´ä¸ªå‰ç«¯å·¥ç¨‹çš„å…¥å£ï¼Œé…ç½®çš„æ‰€æœ‰ä¸œè¥¿éƒ½éœ€è¦åœ¨è¿™é‡Œè¿›è¡Œå¯ç”¨</span></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  <span class="comment">//å¯åŠ¨é…ç½®å¥½çš„è·¯ç”±(åªéœ€è¦è¿™æ ·ç®€å•çš„å£°æ˜ä¸€ä¸‹å³å¯)</span></span><br><span class="line">  router,</span><br><span class="line"></span><br><span class="line">  components: {</span><br><span class="line">    App,</span><br><span class="line">  },</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>5.é…ç½®å’Œå¼€å¯é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨æ˜¾ç¤ºçš„é¡µé¢è¿›è¡Œç›¸å…³çš„è·³è½¬ç¼–å†™å’Œå±•ç¤º</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;h1&gt;horse blog&lt;/h1&gt;</span><br><span class="line">    &lt;!--router-linkï¼šç›¸å½“äºhtmlä¸­çš„aæ ‡ç­¾ï¼Œç”¨äºé“¾æ¥è·³è½¬--&gt;</span><br><span class="line">    &lt;router-link to="/home"&gt;é¦–é¡µ&lt;/router-link&gt;</span><br><span class="line">    &lt;router-link to="/content"&gt;å†…å®¹é¡µ&lt;/router-link&gt;</span><br><span class="line">    &lt;!--router-viewï¼šå±•ç¤ºè§†å›¾ï¼šå±•ç¤ºç”±è·¯ç”±è€Œè¿›è¡Œè·³è½¬ä¹‹åçš„é¡µé¢å†…å®¹--&gt;</span><br><span class="line">    &lt;router-view/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>routeræ›´å¤šçš„è·¯ç”±é…ç½®ç”¨æ³•(æ•´åˆElement UI)</p>
<p><code>main.jsä¸­é…ç½®</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¼å…¥elementUI</span></span><br><span class="line"><span class="keyword">import</span> ElementUI from <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//å®‰è£…ElementUI</span></span><br><span class="line">Vue.use(ElementUI);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//å¯ç”¨Element UI(å›ºå®šå†™æ³•)</span></span><br><span class="line"> render: h =&gt; h(App)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="vue-axioså°è£…"><a href="#vue-axioså°è£…" class="headerlink" title="vue-axioså°è£…"></a><code>vue-axios</code>å°è£…</h3><blockquote>
<p>æœ¬åœ°å®‰è£…axios: npm install axios</p>
</blockquote>
<p>å°è£…ä¸ºrequest.jsæ–‡ä»¶</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> { Message } <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">'js-cookie'</span>  <span class="comment">// cookieçš„æ“ä½œnpmåŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºaxioså®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create({</span><br><span class="line">  baseURL: <span class="string">'http://localhost:9110'</span>,  <span class="comment">// axiosçš„åŸºç¡€è·¯å¾„ï¼šæ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šå¸¦ä¸Šå’Œè‡ªå®šä¹‰çš„è·¯ç”±æ‹¼æ¥</span></span><br><span class="line">  timeout: <span class="number">5000</span> <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// http request æ‹¦æˆªå™¨</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">    <span class="comment">// requestå‘é€è¯·æ±‚æ—¶å¯ä»¥åšçš„ä¸€äº›é…ç½®ï¼šä¾‹å¦‚ï¼šheadersæºå¸¦tokenè¿›è¡Œé‰´æƒè®¿é—®ç­‰ç­‰...</span></span><br><span class="line">  config =&gt; {</span><br><span class="line">    <span class="comment">// å¦‚æœcookieä¸­åŒ…å«token</span></span><br><span class="line">    <span class="keyword">if</span> (cookie.get(<span class="string">'token'</span>)) {</span><br><span class="line">      <span class="comment">// åˆ™å‘é€åç«¯apiè¯·æ±‚çš„æ—¶å€™æºå¸¦token</span></span><br><span class="line">      config.headers[<span class="string">'token'</span>] = cookie.get(<span class="string">'token'</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  },</span><br><span class="line">  error =&gt; {</span><br><span class="line">    <span class="built_in">console</span>.log(error) <span class="comment">// æ§åˆ¶å°æ‰“å°é”™è¯¯ä¿¡æ¯ï¼šå¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  }</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// response æ‹¦æˆªå™¨</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  response =&gt; {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * codeä¸ºé20000æ˜¯æŠ›é”™ å¯ç»“åˆè‡ªå·±ä¸šåŠ¡è¿›è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> res = response.data</span><br><span class="line">    <span class="keyword">if</span> (res.code === <span class="number">20000</span>) { <span class="comment">// æˆåŠŸ</span></span><br><span class="line">      <span class="keyword">return</span> response.data</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (res.code === <span class="number">23004</span>) { <span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥</span></span><br><span class="line">      <span class="comment">// æ¸…é™¤cookie</span></span><br><span class="line">      cookie.set(<span class="string">'token'</span>, <span class="string">''</span>, { <span class="attr">domain</span>: <span class="string">'localhost'</span> })</span><br><span class="line">      <span class="keyword">return</span> response.data <span class="comment">// ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (res.code === <span class="number">25000</span>) { <span class="comment">// æ”¯ä»˜ä¸­</span></span><br><span class="line">      <span class="keyword">return</span> response.data <span class="comment">// ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (res.code === <span class="number">28004</span>) { <span class="comment">// é‰´æƒå¤±è´¥:è·³è½¬åˆ°ç™»å½•é¡µ</span></span><br><span class="line">      <span class="built_in">window</span>.location.href = <span class="string">'/login'</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      Message({</span><br><span class="line">        message: res.message,</span><br><span class="line">        type: <span class="string">'error'</span>,</span><br><span class="line">        duration: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      })</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'error'</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></tbody></table></figure>
<p>å¼•å…¥å’Œä½¿ç”¨:åœ¨å…¶ä»–çš„jsæ–‡ä»¶ä¸­è¿›è¡Œå¼•å…¥å¹¶ä½¿ç”¨ï¼Œç„¶åå¼•å…¥è¯¥jsæ–‡ä»¶åœ¨é¡µé¢è¿›è¡Œè°ƒç”¨apiæ¥å£</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// @ ç¬¦å·åœ¨build/webpack.base.conf.js ä¸­é…ç½® è¡¨ç¤º 'src' è·¯å¾„</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="comment">// è·å–è®²å¸ˆåˆ—è¡¨</span></span><br><span class="line">  <span class="function"><span class="title">list</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> request({</span><br><span class="line">      url: <span class="string">'/admin/edu/teacher/list'</span>,</span><br><span class="line">      method: <span class="string">'get'</span></span><br><span class="line">    })</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// åˆ†é¡µæŸ¥è¯¢è®²å¸ˆåˆ—è¡¨</span></span><br><span class="line">  <span class="function"><span class="title">pageList</span>(<span class="params">page, limit, selectObj</span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> request({</span><br><span class="line">      url: <span class="string">`/admin/edu/teacher/list/<span class="subst">${page}</span>/<span class="subst">${limit}</span>`</span>,</span><br><span class="line">      method: <span class="string">'get'</span>,</span><br><span class="line">      params: selectObj <span class="comment">// paramsï¼šä¼ è¾“è¡¨å•æˆ–è€…URLæ‹¼æ¥æ•°æ®çš„æäº¤æ–¹å¼</span></span><br><span class="line">    })</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// æ ¹æ®IDåˆ é™¤è®²å¸ˆä¿¡æ¯</span></span><br><span class="line">  <span class="function"><span class="title">removeById</span>(<span class="params">id</span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> request({</span><br><span class="line">      url: <span class="string">`/admin/edu/teacher/remove/<span class="subst">${id}</span>`</span>,</span><br><span class="line">      method: <span class="string">'delete'</span></span><br><span class="line">    })</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// ä¿å­˜è®²å¸ˆä¿¡æ¯</span></span><br><span class="line">  <span class="function"><span class="title">save</span>(<span class="params">teacher</span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> request({</span><br><span class="line">      url: <span class="string">'/admin/edu/teacher/save'</span>,</span><br><span class="line">      method: <span class="string">'post'</span>,</span><br><span class="line">      data: teacher<span class="comment">// dataï¼šä¼ è¾“jsonç±»å‹çš„æ•°æ®</span></span><br><span class="line">    })</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="vueåŸºç¡€"><a href="#vueåŸºç¡€" class="headerlink" title="vueåŸºç¡€"></a>vueåŸºç¡€</h3><h4 id="5-1-computedè®¡ç®—å±æ€§ï¼šä»–çœŸçš„å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œåªæ˜¯å†™æ³•å’Œå‡½æ•°ä¸€æ ·è€Œå·²"><a href="#5-1-computedè®¡ç®—å±æ€§ï¼šä»–çœŸçš„å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œåªæ˜¯å†™æ³•å’Œå‡½æ•°ä¸€æ ·è€Œå·²" class="headerlink" title="5.1 computedè®¡ç®—å±æ€§ï¼šä»–çœŸçš„å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œåªæ˜¯å†™æ³•å’Œå‡½æ•°ä¸€æ ·è€Œå·²"></a>5.1 <code>computed</code>è®¡ç®—å±æ€§ï¼šä»–çœŸçš„å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œåªæ˜¯å†™æ³•å’Œå‡½æ•°ä¸€æ ·è€Œå·²</h4><p><strong>æ³¨æ„</strong>ï¼šè®¡ç®—å±æ€§ç›¸å½“äºæŠŠå¸¸ç”¨çš„å‡½æ•°è®¡ç®—çš„ç»“æœç¼“å­˜èµ·æ¥ï¼Œå½“å†æ¬¡è¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œä¸å†æ‰§è¡Œå‡½æ•°ï¼Œè€Œç›´æ¥è¿”å›ç¼“å­˜çš„è®¡ç®—ç»“æœï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å·®å€¼è¡¨è¾¾å¼è°ƒç”¨æ—¶ï¼šï¼Œè¿™æ ·è°ƒç”¨</p>
<blockquote>
<p>computedå’Œmethodsä¸­çš„æ–¹æ³•åä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">computed: {</span><br><span class="line">    getCurrentTimeTest2() {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-2-watchç›‘æ§"><a href="#5-2-watchç›‘æ§" class="headerlink" title="5.2  watchç›‘æ§"></a>5.2  <code>watch</code>ç›‘æ§</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›‘æ§å±æ€§ï¼šé€šè¿‡watchç»™å±æ€§ï¼ˆresultï¼›ä¸Šé¢dataå®šä¹‰çš„å±æ€§ï¼‰ç»‘å®šå‡½æ•°ï¼Œå½“å±æ€§çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘è¯¥å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥æ¥æ”¶	 ä¸¤ä¸ªå‚æ•°newValueï¼šå±æ€§æ”¹å˜åçš„å€¼ï¼ŒoldValue:å±æ€§æ”¹å˜å‰çš„å€¼</span></span><br><span class="line">        watch: {</span><br><span class="line">            result: function (newValue, oldValue) {</span><br><span class="line">                console.log(<span class="string">"result:"</span> + <span class="keyword">this</span>.result);</span><br><span class="line">                console.log(newValue + <span class="string">"==="</span> + oldValue);</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-3-vueæ”¹å˜æ ·å¼ï¼šä¸€å®šæ¡ä»¶ä¸‹æ¿€æ´»classä¸­çš„æ ·å¼"><a href="#5-3-vueæ”¹å˜æ ·å¼ï¼šä¸€å®šæ¡ä»¶ä¸‹æ¿€æ´»classä¸­çš„æ ·å¼" class="headerlink" title="5.3  vueæ”¹å˜æ ·å¼ï¼šä¸€å®šæ¡ä»¶ä¸‹æ¿€æ´»classä¸­çš„æ ·å¼"></a>5.3  <code>vueæ”¹å˜æ ·å¼</code>ï¼šä¸€å®šæ¡ä»¶ä¸‹æ¿€æ´»classä¸­çš„æ ·å¼</h4><h5 id="1-ç®€å•ä½¿ç”¨"><a href="#1-ç®€å•ä½¿ç”¨" class="headerlink" title="1.ç®€å•ä½¿ç”¨"></a>1.ç®€å•ä½¿ç”¨</h5><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--v-bindçš„åŸºæœ¬ä½¿ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment">      ï¼ˆæ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ¿€æ´»æ ·å¼æ˜¾ç¤ºï¼‰å¦‚æœåº“å­˜å¤§äº0ï¼Œå°±æ¿€æ´»åŠ å…¥è´­ç‰©è½¦æŒ‰é’®çš„æ ·å¼ æˆ–è€…</span></span><br><span class="line"><span class="comment">      ä¹Ÿå¯ä»¥è¿›è¡Œå±æ€§çš„ç»‘å®šï¼Œç»‘å®šä¹‹åï¼Œæ¨¡æ¿å°±ä¼šå…ˆåˆ°æ•°æ®æ¨¡å‹ä¸­å¯»æ‰¾å¯¹åº”åç§°çš„å±æ€§å€¼ï¼Œè‹¥æœ‰å°±æ¸²æŸ“æ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line"><span class="comment">      åŠ¨æ€æ ·å¼ï¼ˆv-bind:classï¼‰å’Œé™æ€æ ·å¼ï¼ˆclassï¼‰å¯ä»¥å…±å­˜ï¼Œ</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"store"</span> <span class="attr">placeholder</span>=<span class="string">"åº“å­˜æ•°é‡..."</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">v-bind:class</span>=<span class="string">"{active: store &gt; 0}"</span> <span class="attr">class</span>=<span class="string">"test"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">v-bind:value</span>=<span class="string">"buttonValue"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-ç»“åˆè®¡ç®—å±æ€§ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰"><a href="#2-ç»“åˆè®¡ç®—å±æ€§ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰" class="headerlink" title="2.ç»“åˆè®¡ç®—å±æ€§ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰"></a>2.ç»“åˆè®¡ç®—å±æ€§ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰</h5><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">     &lt;style&gt;</span><br><span class="line">        .test {</span><br><span class="line">            height: 300px;</span><br><span class="line">            width: 300px;</span><br><span class="line">            background-color: red;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        .color {</span><br><span class="line">            background-color: teal;</span><br><span class="line">        }</span><br><span class="line">   &lt;/style&gt; </span><br><span class="line"><span class="comment">//ç‚¹å‡»æŒ‰é’®è§¦å‘å‡½æ•°æ”¹å˜boolçš„å€¼ï¼Œå¹¶ä¸”è§¦å‘è®¡ç®—å±æ€§changeStyleçš„å€¼ï¼Œä»è€Œå®ç°è®¡ç®—å±æ€§æ”¹å˜vueæ ·å¼çš„æ•ˆæœ</span></span><br><span class="line">&lt;div :class="changeStyle" class="test"&gt;æˆ‘æ˜¯div&lt;/div&gt;</span><br><span class="line">    &lt;button type="button" v-model="bool" @click="changeBool"&gt;ç‚¹å‡»æ”¹å˜é¢œè‰²&lt;/button&gt;</span><br><span class="line">        </span><br><span class="line">        data: {</span><br><span class="line">            bool: <span class="keyword">false</span></span><br><span class="line">        },</span><br><span class="line"></span><br><span class="line"> methods: {</span><br><span class="line">            changeBool() {</span><br><span class="line">                <span class="keyword">this</span>.bool = !<span class="keyword">this</span>.bool;</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        <span class="comment">//è®¡ç®—å±æ€§</span></span><br><span class="line">        computed: {</span><br><span class="line">            changeStyle() {</span><br><span class="line">                <span class="comment">//æ³¨æ„ï¼šreturn {é‡Œé¢è¿”å›çš„å¯¹åº”å€¼çš„jsonå­—ç¬¦ä¸²}</span></span><br><span class="line">                <span class="keyword">return</span> {</span><br><span class="line">                    color: <span class="keyword">this</span>.bool</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        },</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-æ•°ç»„è¯­æ³•ï¼šclassç»‘å®šå¤šä¸ªæ ·å¼"><a href="#3-æ•°ç»„è¯­æ³•ï¼šclassç»‘å®šå¤šä¸ªæ ·å¼" class="headerlink" title="3.æ•°ç»„è¯­æ³•ï¼šclassç»‘å®šå¤šä¸ªæ ·å¼"></a>3.æ•°ç»„è¯­æ³•ï¼šclassç»‘å®šå¤šä¸ªæ ·å¼</h5><p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200506104130100.png" alt="æ•°ç»„è¯­æ³•"></p>
<h5 id="4-styleæ”¹å˜æ ·å¼ï¼šä¹Ÿå¯ä»¥ç»“åˆè®¡ç®—å±æ€§"><a href="#4-styleæ”¹å˜æ ·å¼ï¼šä¹Ÿå¯ä»¥ç»“åˆè®¡ç®—å±æ€§" class="headerlink" title="4.styleæ”¹å˜æ ·å¼ï¼šä¹Ÿå¯ä»¥ç»“åˆè®¡ç®—å±æ€§"></a>4.styleæ”¹å˜æ ·å¼ï¼šä¹Ÿå¯ä»¥ç»“åˆè®¡ç®—å±æ€§</h5><p><strong>æ³¨æ„ï¼šå±æ€§åç§°å¿…é¡»ç”¨<code>é©¼å³°å‘½å</code>çš„æ–¹å¼ä¹¦å†™ï¼Œstyleé‡Œçš„å†…å®¹æ˜¯ä¸€ä¸ªjsoné”®å€¼å¯¹ï¼Œæ‰€ä»¥ç”¨{ }åŒ…è£¹</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼å’Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼--&gt;</span><br><span class="line">&lt;div :style="{backgroundColor:colorActive,fontSize:fontActive*2 + 'px'}" class="test"&gt; æˆ‘æ˜¯ä½ å‘ä¹Ÿ&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">    data: {</span><br><span class="line">            colorActive: <span class="string">'green'</span>,</span><br><span class="line">            fontActive: <span class="number">20</span>,</span><br><span class="line">        },</span><br></pre></td></tr></tbody></table></figure>
<h5 id="5-styleçš„æ•°ç»„ç”¨æ³•"><a href="#5-styleçš„æ•°ç»„ç”¨æ³•" class="headerlink" title="5.styleçš„æ•°ç»„ç”¨æ³•"></a>5.styleçš„æ•°ç»„ç”¨æ³•</h5><p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200506105440820.png" alt="æ•°ç»„ç”¨æ³•"></p>
<h3 id="6-vueè¿›é˜¶"><a href="#6-vueè¿›é˜¶" class="headerlink" title="6.vueè¿›é˜¶"></a>6.vueè¿›é˜¶</h3><p> <code>Vueå®ä¾‹ç”¨æ³•</code></p>
<blockquote>
<p> å¯ä»¥é€šè¿‡ä¸€ä¸ªVueå¯¹è±¡ï¼ˆvm1ï¼‰å»æ“ä½œå¦å¤–ä¸€ä¸ªVue(vm2)å¯¹è±¡ï¼šä¹Ÿå°±æ˜¯å¯ä»¥åœ¨vm1å®ä¾‹å¯¹è±¡ä¸­è°ƒç”¨vm2å®ä¾‹å¯¹è±¡ä¸­çš„dataå±æ€§å’Œmethodsä¸­çš„æ–¹æ³•ç­‰ç­‰ã€‚</p>
</blockquote>
<p><code>vueå®ä¾‹å±æ€§</code></p>
<blockquote>
<p>åœ¨Vueä¸­ç›´æ¥é€šè¿‡å¯¹è±¡.å±æ€§çš„æ–¹å¼è°ƒç”¨çš„å±æ€§ï¼Œéƒ½æ˜¯dataæˆ–è€…computedä¸­çš„å±æ€§ï¼Œå®ƒä»¬ä»…ä»…è¢«ç§°ä¸ºå±æ€§ï¼Œè€Œåœ¨Vueå¯¹è±¡ä¸­çš„el,data,computed,â€¦ç­‰ä¹Ÿç§°ä¸ºå±æ€§ï¼Œä½†è¿™æ˜¯Vueçš„<code>å®ä¾‹å±æ€§</code>ï¼Œé€šè¿‡vm1.$dataçš„æ–¹å¼è¿›è¡Œè°ƒç”¨</p>
</blockquote>
<p><code>refçš„ä½¿ç”¨ï¼šç›¸å½“äºidå±æ€§</code></p>
<blockquote>
<p>åœ¨vueä¸­ä¸€èˆ¬ä½¿ç”¨refå±æ€§æ¥ä»£æ›¿idå±æ€§ï¼ˆidå±æ€§åå­—ç›¸åŒæ—¶ä¸æŠ¥é”™ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è°ƒç”¨å…¨å±€å®ä¾‹å±æ€§$refsæ¥è·å–å½“å‰é¡µé¢ä¸­refæ ‡è¯†çš„æŸä¸ªdomå…ƒç´ </p>
</blockquote>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">"mybtn1"</span> @<span class="attr">click</span>=<span class="string">"btnClick1"</span>&gt;</span>java<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">"mybtn2"</span> @<span class="attr">click</span>=<span class="string">"btnClick2"</span>&gt;</span>vue<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    methods: {</span><br><span class="line">        btnClick1() {</span><br><span class="line">//è¿™æ ·å°±å¯ä»¥è·å–æŒ‡å®šdomå…ƒç´ </span><br><span class="line">            this.$refs.mybtn1.innerHTML="æˆ‘æ˜¯æŒ‰é’®"</span><br><span class="line">        },</span><br><span class="line">        btnClick2() {</span><br><span class="line">            this.$refs.mybtn2.innerHTML="æˆ‘æ˜¯å¦ä¸€ä¸ªæŒ‰é’®"</span><br><span class="line">        }</span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure>
<h4 id="6-1æ³¨å†Œå…¨å±€ç»„ä»¶"><a href="#6-1æ³¨å†Œå…¨å±€ç»„ä»¶" class="headerlink" title="6.1æ³¨å†Œå…¨å±€ç»„ä»¶"></a>6.1æ³¨å†Œå…¨å±€ç»„ä»¶</h4><p>åœ¨å”¯ä¸€å…¥å£æ–‡ä»¶<code>main.js</code>ä¸­è¿›è¡Œå…¨å±€ç»„ä»¶çš„æ³¨å†Œï¼Œæ³¨å†Œä¹‹åç»„ä»¶å¯ä»¥åœ¨æ•´ä¸ªé¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> header <span class="keyword">from</span> <span class="string">'./components/header'</span></span><br><span class="line"><span class="keyword">import</span> bottom <span class="keyword">from</span> <span class="string">'./components/bottom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*æ³¨å†Œå…¨å±€ç»„ä»¶*/</span></span><br><span class="line">Vue.component(<span class="string">"myHeader"</span>, header);</span><br><span class="line">Vue.component(<span class="string">"myBottom"</span>, bottom);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="6-2æ³¨å†Œå±€éƒ¨ç»„ä»¶"><a href="#6-2æ³¨å†Œå±€éƒ¨ç»„ä»¶" class="headerlink" title="6.2æ³¨å†Œå±€éƒ¨ç»„ä»¶"></a>6.2æ³¨å†Œå±€éƒ¨ç»„ä»¶</h4><p>åœ¨æƒ³è¦ä½¿ç”¨æŸç»„ä»¶çš„vueä¸­è¿›è¡Œæœ¬åœ°å±€éƒ¨æ³¨å†Œç»„ä»¶ï¼Œé‚£ä¹ˆæ­¤ç»„ä»¶åªèƒ½åœ¨å½“å‰vueé¡µé¢æ‰èƒ½è¢«ä½¿ç”¨ï¼Œå’Œå…¨å±€ç»„ä»¶ä¸åŒ</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*æ³¨å†Œå±€éƒ¨ç»„ä»¶*/</span></span><br><span class="line">  <span class="keyword">import</span> bottom <span class="keyword">from</span> <span class="string">'./components/bottom'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">    name: <span class="string">'App'</span>,</span><br><span class="line">    <span class="comment">//å¿…é¡»æ˜¾å¼çš„å£°æ˜æ³¨å†Œæ­¤ç»„ä»¶</span></span><br><span class="line">    components: {</span><br><span class="line">        <span class="string">'myBottom'</span>: bottom,</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="7-ç¬¦å·"><a href="#7-ç¬¦å·" class="headerlink" title="7.@ç¬¦å·"></a>7.<code>@</code>ç¬¦å·</h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//@:ç›¸å½“äºsrcç›®å½•ï¼Œ      </span></span><br><span class="line">alias: {</span><br><span class="line">        <span class="string">'@'</span>: resolve(<span class="string">'src'</span>)</span><br><span class="line">      }</span><br><span class="line"><span class="comment">//ä¹Ÿå°±ç›¸å½“äºåœ¨srcè·¯å¾„ä¸‹è¿›è¡Œèµ„æºå¯»æ‰¾</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'@/styles/index.scss'</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Elasticseatchå‘½ä»¤è¯­æ³•"><a href="#Elasticseatchå‘½ä»¤è¯­æ³•" class="headerlink" title="Elasticseatchå‘½ä»¤è¯­æ³•"></a>Elasticseatchå‘½ä»¤è¯­æ³•</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…å…¨éƒ¨</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"match_all"</span>: {}</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å°†å­—æ®µè¿›è¡Œåˆ†è¯åå†è¿›è¡ŒåŒ¹é…æŸ¥è¯¢</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"match"</span>: {</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"å°ç±³ç”µè§†"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¤šä¸ªå­—æ®µå±æ€§åŒ¹é…åŒä¸€ä¸ªè¯æ¡ï¼ˆä¹Ÿå°±æ˜¯å¢åŠ äº†åŒ¹é…å­—æ®µï¼‰</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"multi_match"</span>: {</span><br><span class="line">      <span class="string">"query"</span>: <span class="string">"å°ç±³"</span>,</span><br><span class="line">      <span class="string">"fields"</span>: [<span class="string">"title"</span>,<span class="string">"brand"</span>,<span class="string">"category"</span>]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//è¯æ¡ç²¾ç¡®åŒ¹é…ï¼ˆè¿™é‡Œçš„è¯æ¡ä¸ä¼šè¢«åˆ†è¯ï¼Œè€Œæ˜¯æ‹¿è¿™ä¸ªè¯æ¡æ•´ä½“å»åŒ¹é…è¯¥å­—æ®µå±æ€§è¢«åˆ†è¯åçš„æ‰€æœ‰è¯æ¡ï¼‰</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"term"</span>: {</span><br><span class="line">      <span class="string">"title"</span>: {</span><br><span class="line">        <span class="string">"value"</span>: <span class="string">"ç´«ç±³"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¤šè¯æ¡åŒ¹é…ï¼ˆå¢åŠ äº†åŒ¹é…çš„è¯æ¡æ•°è€Œå·²ï¼‰</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"terms"</span>: {</span><br><span class="line">      <span class="string">"title"</span>: [</span><br><span class="line">        <span class="string">"å°ç±³"</span>,</span><br><span class="line">        <span class="string">"ç”µè§†"</span></span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//_sourceï¼šè§„å®šæŸ¥è¯¢çš„è¿”å›å­—æ®µ</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"_source"</span>: [<span class="string">"title"</span>,<span class="string">"price"</span>,<span class="string">"images"</span>],</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"match_all"</span>: {}</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¸ƒå°”æŸ¥è¯¢ï¼ˆboolï¼‰:è‡ªå·±ä½“ä¼šå§...</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"bool"</span>: {</span><br><span class="line">      <span class="string">"must"</span>: [</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"match"</span>: {</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"å°ç±³"</span></span><br><span class="line">          }</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"match"</span>: {</span><br><span class="line">            <span class="string">"brand"</span>: <span class="string">"å°ç±³"</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"must_not"</span>: [</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"match"</span>: {</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"æ‰‹æœº"</span></span><br><span class="line">          }</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"term"</span>: {</span><br><span class="line">            <span class="string">"category"</span>: {</span><br><span class="line">              <span class="string">"value"</span>: <span class="string">"ç”µ"</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"should"</span>: [</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"match"</span>: {</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"ç”µè§†"</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//è¯æ¡æ¨¡ç³ŠåŒ¹é…ï¼ˆå°±ç›¸å½“äºè¯æ¡å¯ä»¥å­˜åœ¨åå·®å€¼çš„termæŸ¥è¯¢ï¼ˆåå·®å€¼æœ€å¤§ä¸ºï¼š2ï¼‰ï¼‰</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"fuzzy"</span>: {</span><br><span class="line">      <span class="string">"title"</span>: {</span><br><span class="line">        <span class="string">"value"</span>: <span class="string">"å°ç±³"</span>,</span><br><span class="line">        <span class="string">"fuzziness"</span>: <span class="number">1</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¯¹ç»“æœé›†è¿›è¡Œè¿‡æ»¤çš„æ“ä½œï¼šä¸å½±å“è¯„åˆ†ç­‰...(ä¸€èˆ¬éƒ½æ˜¯ä¸boolæŸ¥è¯¢é›†åˆä½¿ç”¨)</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"bool"</span>: {</span><br><span class="line">      <span class="string">"must"</span>: [</span><br><span class="line">        {</span><br><span class="line">          <span class="string">"match"</span>: {</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"å°ç±³"</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"filter"</span>: {</span><br><span class="line">          <span class="string">"range"</span>: {</span><br><span class="line">            <span class="string">"price"</span>: {</span><br><span class="line">              <span class="string">"gte"</span>: <span class="number">333</span>,</span><br><span class="line">              <span class="string">"lte"</span>: <span class="number">7777</span></span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¤šæŸ¥è¯¢ç»“æœé›†è¿›è¡Œæ’åºæ“ä½œ</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: {</span><br><span class="line">    <span class="string">"match"</span>: {</span><br><span class="line">      <span class="string">"title"</span>: <span class="string">"å°ç±³æ‰‹æœº"</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"sort"</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="string">"_score"</span>: {</span><br><span class="line">        <span class="string">"order"</span>: <span class="string">"asc"</span></span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      <span class="string">"price"</span>: {</span><br><span class="line">        <span class="string">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br><span class="line"><span class="comment">//èšåˆä¸ºæ¡¶ï¼šå°±ç›¸å½“äºsqlä¸­çš„group byå’Œèšåˆå‡½æ•°æ··åˆä½¿ç”¨çš„æ•ˆæœå·®ä¸å¤š</span></span><br><span class="line"><span class="comment">//ä¸‹é¢æ˜¯ï¼šä¸€ä¸ªæ¡¶åˆåµŒå¥—äº†ä¸€ä¸ªåº¦é‡ï¼ˆèšåˆå‡½æ•°ï¼‰å’Œä¸€ä¸ªæ¡¶çš„å®ä¾‹ï¼ˆæ³¨æ„è§‚å¯Ÿæ‘†æ”¾ä½ç½®å³å¯...ï¼‰</span></span><br><span class="line">GET item/_search</span><br><span class="line">{</span><br><span class="line">  <span class="string">"size"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"aggs"</span>: {</span><br><span class="line">    <span class="string">"items"</span>: {</span><br><span class="line">      <span class="string">"terms"</span>: {</span><br><span class="line">        <span class="string">"field"</span>: <span class="string">"brand"</span></span><br><span class="line">      },</span><br><span class="line">      <span class="string">"aggs"</span>: {</span><br><span class="line">        <span class="string">"avgCount"</span>: {</span><br><span class="line">          <span class="string">"avg"</span>: {</span><br><span class="line">            <span class="string">"field"</span>: <span class="string">"price"</span></span><br><span class="line">          }</span><br><span class="line">        },</span><br><span class="line">        <span class="string">"category"</span>:{</span><br><span class="line">          <span class="string">"terms"</span>: {</span><br><span class="line">            <span class="string">"field"</span>: <span class="string">"category"</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//æŸ¥çœ‹ç´¢å¼•çš„æ˜ å°„è§„åˆ™</span></span><br><span class="line">GET item/_mappings</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ†è¯å™¨çš„ä½¿ç”¨</span></span><br><span class="line">POST _analyze </span><br><span class="line">{</span><br><span class="line">  <span class="string">"analyzer"</span>:<span class="string">"ik_max_word"</span>,</span><br><span class="line">  <span class="string">"text"</span>:<span class="string">"å°ç±³ç”µè§†"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="å¾®æœåŠ¡æ¶æ„ï¼ˆåŸºäºè°·ç²’å•†åŸï¼‰"><a href="#å¾®æœåŠ¡æ¶æ„ï¼ˆåŸºäºè°·ç²’å•†åŸï¼‰" class="headerlink" title="å¾®æœåŠ¡æ¶æ„ï¼ˆåŸºäºè°·ç²’å•†åŸï¼‰"></a>å¾®æœåŠ¡æ¶æ„ï¼ˆåŸºäºè°·ç²’å•†åŸï¼‰</h2><p><strong>æ€»ç»“åŸºæœ¬çš„ç»„ä»¶æ¶æ„å’ŒåŸç†<span class="github-emoji"><span>âš¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></strong></p>
<h3 id="1-nacos-æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼ˆç±»ä¼¼äºeurekaï¼Œä½†æ›´åŠ å¼ºæ‚ï¼‰"><a href="#1-nacos-æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼ˆç±»ä¼¼äºeurekaï¼Œä½†æ›´åŠ å¼ºæ‚ï¼‰" class="headerlink" title="1. nacos:æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼ˆç±»ä¼¼äºeurekaï¼Œä½†æ›´åŠ å¼ºæ‚ï¼‰"></a>1. nacos:æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼ˆç±»ä¼¼äºeurekaï¼Œä½†æ›´åŠ å¼ºæ‚ï¼‰</h3><p><strong>nacosæœåŠ¡å™¨ï¼šæˆ‘åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…è¿è¡Œçš„</strong></p>
<p><span class="github-emoji"><span>ğŸ…°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f170.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-cloud-starter-alibaba-nacos-discovery:æ³¨å†Œä¸­å¿ƒï¼Œç›¸å½“äºeurekaçš„ä½œç”¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos-config:é…ç½®ä¸­å¿ƒï¼ˆæ¯”eurekaå¤šçš„åŠŸèƒ½ï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji"><span>ğŸ…±</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f171.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><strong>ä¸»å¯åŠ¨ç±»å¼€å¯æ³¨è§£@EnableDiscoveryClient</strong></p>
<p><span class="github-emoji"><span>â°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/23f0.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>é…ç½®æ–‡ä»¶è¿›è¡Œç›¸å…³é…ç½®</p>
<p>æ³¨å†Œä¸­å¿ƒï¼šä¸€èˆ¬åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-gateway</span></span><br><span class="line"><span class="string">//ä¸€èˆ¬ç›´æ¥é…ç½®ä¸€ä¸ªæœåŠ¡ä¸­å¿ƒçš„ç«¯å£å·å³å¯ï¼Œå…¶ä»–çš„éƒ½æ˜¯é»˜è®¤é…ç½®</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.149</span><span class="number">.131</span><span class="string">:8848</span></span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®ä¸­å¿ƒï¼šå¿…é¡»åœ¨å›ºå®šçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®bootstrap.propertiesæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#nacosé…ç½®ä¸­å¿ƒï¼šé»˜è®¤ä½¿ç”¨ bootstrap.properties é…ç½®æ–‡ä»¶è¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œå›ºå®šåç§°</span></span><br><span class="line"><span class="comment">#æœåŠ¡æ¨¡å—åç§°(å¿…é¡»å†™)</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">gulimall-gateway</span></span><br><span class="line"><span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">192.168.149.131:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹é¢ä¸¤ä¸ªé…ç½®è¦æ ¹æ®nacosé…ç½®ä¸­å¿ƒè‡ªå®šä¹‰å‘½åç©ºé—´å’Œåˆ†ç»„çš„ä¿¡æ¯è¿›è¡Œå…·ä½“é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ä¸­å¿ƒè‡ªå®šä¹‰å‘½åç©ºé—´ID</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">ed956bca-39b5-4731-8065-8c35192eab58</span></span><br><span class="line"><span class="comment">#é…ç½®ä¸­å¿ƒè‡ªå®šä¹‰åˆ†ç»„åç§°</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.group</span>=<span class="string">dev</span></span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®ä¸­å¿ƒæ˜¾ç¤ºï¼š</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200421210311066.png" alt="é…ç½®ä¸­å¿ƒé…ç½®"></p>
<p>ç›´æ¥å¯åŠ¨æœåŠ¡ï¼Œå°±ç›´æ¥å¯ä»¥åœ¨nacosçš„ç½‘é¡µçœ‹è§æ­¤æœåŠ¡å·²åœ¨æ³¨å†Œä¸­å¿ƒä¸­ã€‚</p>
<h3 id="2-springcloud-gateway-ç½‘å…³ä¸­å¿ƒï¼ˆç±»ä¼¼äºZuul-æ›´å¤æ‚è€Œå¼ºæ‚ï¼‰"><a href="#2-springcloud-gateway-ç½‘å…³ä¸­å¿ƒï¼ˆç±»ä¼¼äºZuul-æ›´å¤æ‚è€Œå¼ºæ‚ï¼‰" class="headerlink" title="2. springcloud-gateway:ç½‘å…³ä¸­å¿ƒï¼ˆç±»ä¼¼äºZuul,æ›´å¤æ‚è€Œå¼ºæ‚ï¼‰"></a>2. springcloud-gateway:ç½‘å…³ä¸­å¿ƒï¼ˆç±»ä¼¼äºZuul,æ›´å¤æ‚è€Œå¼ºæ‚ï¼‰</h3><p>å¼•å…¥pom,å¹¶ä¸”æ³¨å†ŒæœåŠ¡åˆ°nacosæ³¨å†Œä¸­å¿ƒï¼ˆåˆ‡è®°ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-cloud-gateway--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>ç¼–å†™é…ç½®æ–‡ä»¶ï¼šç½‘å…³æœåŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯æ¥æ”¶è¯·æ±‚ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ“ä½œï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡æ¨¡å—</strong></p>
<p>é…ç½®çŸ¥è¯†å¾ˆå¤šï¼šå…·ä½“å‚ç…§springcloudçš„å®˜æ–¹æ–‡æ¡£æ…¢æ…¢å­¦ä¹ </p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‹é¢æ˜¯å¸¸ç”¨çš„é…ç½®ï¼š(æœ‰äº›é…ç½®çš„å†™æ³•å‰ææ˜¯ï¼šå·²ç»å°†gatewayæœåŠ¡æ³¨å†Œåˆ°nacosï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰ä¸­äº†)</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">          <span class="comment"># é…ç½®gatewayå¯ä»¥å‘ç°nacosä¸­çš„å¾®æœåŠ¡</span></span><br><span class="line">          <span class="attr">discovery:</span></span><br><span class="line">        	<span class="attr">locator:</span></span><br><span class="line">        	  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">routes:</span></span><br><span class="line">            <span class="comment">#è·¯ç”±åˆ°gulimall-productæœåŠ¡æ¨¡å—</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span>  <span class="comment">#è·¯ç”±çš„åç§°éšä¾¿ï¼ˆè§åçŸ¥ä¹‰ï¼‰</span></span><br><span class="line">              <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span>  <span class="comment">#ä»¥è´Ÿè½½å‡è¡¡çš„æ¨¡å¼ï¼ˆlb://xxxï¼‰è·¯ç”±åˆ°é‚£ä¸ªæœåŠ¡æ¨¡å—ï¼ˆå¿…é¡»å†™æœåŠ¡æ¨¡å—åç§°ï¼‰</span></span><br><span class="line">              <span class="comment">#é…ç½®è¯´æ˜æ‹¦æˆªä»€ä¹ˆæ ·çš„è·¯å¾„è¯·æ±‚</span></span><br><span class="line">              <span class="attr">predicates:</span>      </span><br><span class="line">                <span class="bullet">-</span> <span class="string">Path=/api/product/**</span>  </span><br><span class="line">              <span class="comment">#è·¯å¾„é‡å†™(åŠ¨æ€æˆªå–è·¯å¾„ï¼šæˆªå–å’Œè½¬å‘çš„å¾®æœåŠ¡æ¨¡å—controllerå±‚çš„è¯·æ±‚è·¯å¾„ç›¸åŒçš„è·¯å¾„)</span></span><br><span class="line">              <span class="comment">#===ä¸é‡å†™è·¯å¾„ä¹Ÿæ²¡äº‹çš„ï¼ˆåªè¦ç½‘å…³æœåŠ¡ä¸å®šä¹‰åŸºç¡€è·¯å¾„/api,é‚£ä¹ˆå°±ä¸ç”¨è·¯å¾„é‡å†™ï¼‰===</span></span><br><span class="line">              <span class="attr">filters:</span></span><br><span class="line">               	<span class="comment">#ä¾‹ï¼š/api/brand/list,æˆªå–é‡å†™æˆï¼š/brand/list(å½¢å¼ä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼ŒçŸ¥è¯†è·¯å¾„å‚æ•°å’Œæˆªå–çš„ä¸ä¸€æ ·)</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}</span> </span><br><span class="line"></span><br><span class="line">            <span class="comment">#ç¬¬ä¸‰æ–¹æœåŠ¡æ¨¡å—ï¼ˆoss...ï¼‰</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">third_party_route</span></span><br><span class="line">              <span class="attr">uri:</span> <span class="string">lb://gulimall-third-party</span></span><br><span class="line">              <span class="attr">predicates:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">              <span class="attr">filters:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;.*),/$\{segment}</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#å‰ç«¯é¡¹ç›®ï¼šå¸¦æœ‰/apiå‰ç¼€çš„å…¨éƒ¨è·¯ç”±åˆ°renren-fastè·¯å¾„ï¼ˆlb:è´Ÿè½½å‡è¡¡çš„è¿›è¡Œè·¯ç”±ï¼‰</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">              <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">              <span class="attr">predicates:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">              <span class="comment">#è·¯å¾„é‡å†™</span></span><br><span class="line">              <span class="attr">filters:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="gatewayç»Ÿä¸€è§£å†³è·¨åŸŸé—®é¢˜"><a href="#gatewayç»Ÿä¸€è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="gatewayç»Ÿä¸€è§£å†³è·¨åŸŸé—®é¢˜"></a>gatewayç»Ÿä¸€è§£å†³è·¨åŸŸé—®é¢˜</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.pattern.PathPatternParser;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mabin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/14 15:25</span></span><br><span class="line"><span class="comment"> * ç½‘å…³æœåŠ¡ç»Ÿä¸€è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsWebFilter <span class="title">corsWebFilter</span><span class="params">()</span> </span>{</span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        config.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line">        config.addAllowedOrigin(<span class="string">"*"</span>);</span><br><span class="line">        config.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource(<span class="keyword">new</span> PathPatternParser());</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">"/**"</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsWebFilter(source);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="gatewayé…ç½®å…¨å±€è¿‡æ»¤å™¨"><a href="#gatewayé…ç½®å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="gatewayé…ç½®å…¨å±€è¿‡æ»¤å™¨"></a>gatewayé…ç½®å…¨å±€è¿‡æ»¤å™¨</h4><h5 id="tokené‰´æƒå®ä¾‹"><a href="#tokené‰´æƒå®ä¾‹" class="headerlink" title="tokené‰´æƒå®ä¾‹"></a><code>tokené‰´æƒå®ä¾‹</code></h5><p>éœ€è¦ç”¨åˆ°çš„pomä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç½‘å…³é‰´æƒæ‰€éœ€ä¾èµ–:åŸºäºtoken--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--é‡Œé¢æœ‰JWTUtilså·¥å…·ç±»ï¼šä½ æ‡‚çš„...--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.horse.college<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ’é™¤spring-boot-starter-webï¼Œå¦åˆ™å’Œgatewayä¸­çš„webfluxå†²çª--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--å°†éšç€spring-boot-starter-webæ’é™¤çš„servlet-apiæ·»åŠ å›æ¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthGlobalFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤è¯·æ±‚è·¯å¾„ä¸­éœ€è¦é‰´æƒçš„è·¯å¾„:è¿›è¡Œtokençš„é‰´å®š(å­˜åœ¨ä¸å¦æˆ–è€…æ˜¯æ­£ç¡®ä¸å¦)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>{</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚è·¯å¾„path</span></span><br><span class="line">        ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">        String path = request.getURI().getPath();</span><br><span class="line">        <span class="comment">// åŒ¹é…è·¯ç”±</span></span><br><span class="line">        AntPathMatcher antPathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">        <span class="keyword">if</span> (antPathMatcher.match(<span class="string">"/api/**/auth/**"</span>, path)) {</span><br><span class="line">            List&lt;String&gt; tokenList = request.getHeaders().get(<span class="string">"token"</span>);</span><br><span class="line">            <span class="comment">// tokenæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(tokenList)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.out(exchange.getResponse());</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// tokenæ˜¯å¦æ­£ç¡®</span></span><br><span class="line">            <span class="keyword">if</span> (!JwtUtils.checkJwtTToken(tokenList.get(<span class="number">0</span>))) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.out(exchange.getResponse());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// tokenæ­£å¸¸:æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰å½“å‰è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å“åº”ä¿¡æ¯çš„è¾…åŠ©ç±»(å°±æ˜¯è¿”å›è‡ªå®šä¹‰ç»„è£…çš„ä¿¡æ¯çš„)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Mono&lt;Void&gt; <span class="title">out</span><span class="params">(ServerHttpResponse response)</span> </span>{</span><br><span class="line">        DataBuffer buffer = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Map&lt;String, Object&gt; paramsMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            paramsMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            paramsMap.put(<span class="string">"code"</span>, <span class="number">28004</span>);</span><br><span class="line">            paramsMap.put(<span class="string">"data"</span>, <span class="string">""</span>);</span><br><span class="line">            paramsMap.put(<span class="string">"message"</span>, <span class="string">"é‰´æƒå¤±è´¥"</span>);</span><br><span class="line">            ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">            String message = mapper.writeValueAsString(paramsMap);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] bytes = message.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">            buffer = response.bufferFactory().wrap(bytes);</span><br><span class="line">            <span class="comment">//æŒ‡å®šç¼–ç ï¼Œå¦åˆ™åœ¨æµè§ˆå™¨ä¸­ä¼šä¸­æ–‡ä¹±ç </span></span><br><span class="line">            response.getHeaders().add(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=UTF-8"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¾“å‡ºhttpå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(buffer));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é¡µé¢çš„ä¼˜åŒ–:å“åº”æ‹¦æˆªå™¨åˆ¤æ–­æ˜¯å¦å‡ºç°è‡ªå®šä¹‰çš„é‰´æƒå¤±è´¥é”™è¯¯ç </p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (res.code === <span class="number">28004</span>) { <span class="comment">// é‰´æƒå¤±è´¥:è·³è½¬åˆ°ç™»å½•é¡µ</span></span><br><span class="line">     <span class="built_in">window</span>.location.href = <span class="string">'/login'</span></span><br><span class="line">     <span class="keyword">return</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç™»å½•æ–¹æ³•çš„ä¼˜åŒ–ï¼šç™»å½•åæŒ‰æ¡ä»¶è¿”å›åŸæ¥é¡µé¢ã€</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ç™»å½•</span></span><br><span class="line">    <span class="function"><span class="title">submitLogin</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="comment">// è°ƒç”¨è¿œç¨‹æœåŠ¡æ¥å£,è·å–token</span></span><br><span class="line">      loginApi.login(<span class="built_in">this</span>.user).then(<span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">        <span class="comment">// å°†tokenå†™å…¥cookieä¸­</span></span><br><span class="line">        cookie.set(<span class="string">'token'</span>, response.data.token, { <span class="attr">domain</span>: <span class="string">'localhost'</span> })</span><br><span class="line">        <span class="comment">// å¦‚æœä¸Šä¸€é¡µæ˜¯æ³¨å†Œé¡µ:ç™»å½•ç›´æ¥è¿›å…¥é¦–é¡µ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">document</span>.referrer.indexOf(<span class="string">'register'</span>) !== -<span class="number">1</span>) { <span class="comment">// jsåŸç”Ÿæ–¹æ³•:æŸ¥è¯¢å½“å‰é¡µé¢çš„ä¸Šä¸€é¡µçš„è·¯å¾„pathæ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²,æ²¡æœ‰åˆ™è¿”å›-1</span></span><br><span class="line">          <span class="built_in">this</span>.$router.push({ <span class="attr">path</span>: <span class="string">'/'</span> })</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">          <span class="comment">// å¦‚æœä¸Šä¸€é¡µä¸æ˜¯æ³¨å†Œé¡µ:ç™»å½•ç›´æ¥è¿”å›ä¸Šä¸€é¡µ</span></span><br><span class="line">          history.go(-<span class="number">1</span>)</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>å…·ä½“ä½œç”¨ä¸»è¦åœ¨é…ç½®è½¬å‘è¿™ä¸€å—ã€‚ã€‚ã€‚</p>
<h3 id="3-OSSæœåŠ¡æ¨¡å—ï¼ˆå¿…é¡»æå‰é…ç½®å¥½è‡ªå·±çš„ossæœåŠ¡å™¨ï¼Œä¸€å®šè¦é…ç½®è·¨åŸŸé—®é¢˜ï¼‰"><a href="#3-OSSæœåŠ¡æ¨¡å—ï¼ˆå¿…é¡»æå‰é…ç½®å¥½è‡ªå·±çš„ossæœåŠ¡å™¨ï¼Œä¸€å®šè¦é…ç½®è·¨åŸŸé—®é¢˜ï¼‰" class="headerlink" title="3. OSSæœåŠ¡æ¨¡å—ï¼ˆå¿…é¡»æå‰é…ç½®å¥½è‡ªå·±çš„ossæœåŠ¡å™¨ï¼Œä¸€å®šè¦é…ç½®è·¨åŸŸé—®é¢˜ï¼‰"></a>3. OSSæœåŠ¡æ¨¡å—ï¼ˆå¿…é¡»æå‰é…ç½®å¥½è‡ªå·±çš„ossæœåŠ¡å™¨ï¼Œä¸€å®šè¦é…ç½®è·¨åŸŸé—®é¢˜ï¼‰</h3><p>æ–‡ä»¶ä¸Šä¼ åŸç†ï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ¬åœ°åº”ç”¨æœåŠ¡å™¨è·å–ç­¾åï¼ˆå…³äºossæœåŠ¡å™¨ä¸Šä¼ çš„å…·ä½“é…ç½®ä¿¡æ¯ï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯å†å¸¦ç€ç­¾åæŠŠæ–‡ä»¶ä¸Šä¼ åˆ°OSSæœåŠ¡å™¨ä¸Šé¢ï¼ˆ<strong>å¥½å¤„ï¼šé¿å…é˜¿é‡Œäº‘çš„å¯†åŒ™ä¿¡æ¯æš´æ¼åœ¨å‰ç«¯é¡µé¢</strong>ï¼‰</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200421212621298.png" alt="image-20200421212621298"></p>
<p>å¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨-OSS--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>å¿…è¦çš„å‚æ•°é…ç½®application.yml</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="comment">#osså¯¹è±¡å­˜å‚¨</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span>	</span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> <span class="string">*******</span>   <span class="comment">#é˜¿é‡Œäº‘çš„è®¿é—®keyï¼ˆå¤§å®¶éƒ½æ‡‚ï¼‰</span></span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">********</span> <span class="comment">#é˜¿é‡Œäº‘çš„è®¿é—®key</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-hangzhou.aliyuncs.com</span>  <span class="comment">#ossæœåŠ¡å™¨çš„æ‰€åœ¨åŒºåŸŸ</span></span><br><span class="line">        <span class="attr">bucket:</span> <span class="string">gulimall-horse</span>  <span class="comment">#åˆ›å»ºçš„å­˜å‚¨å®¹å™¨bucketçš„åç§°</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åé…ç½®å¤„ç†å‰ç«¯è·å–ç­¾åè¯·æ±‚çš„æ–¹æ³•(åŸºæœ¬ä¸ç”¨ä¿®æ”¹)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OSSController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OSS ossClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.oss.endpoint}")</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.oss.bucket}")</span></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.access-key}")</span></span><br><span class="line">    <span class="keyword">private</span> String accessId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®¢æˆ·ç«¯è¯·æ±‚åº”ç”¨æœåŠ¡å™¨è·å–ç­¾åï¼Œç”¨äºä¼ è¾“æ–‡ä»¶åˆ°oss</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping("/oss/policy")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">policy</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‹¼æ¥å¤„bucketçš„åŸŸåï¼ˆä¹Ÿå°±æ˜¯ossæœåŠ¡å™¨çš„è·¯å¾„ï¼‰</span></span><br><span class="line">        String host = <span class="string">"https://"</span> + bucket + <span class="string">"."</span> + endpoint;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶æŒ‡å®šçš„å‰ç¼€ï¼ˆä¹Ÿå°±æ˜¯ç›¸åº”çš„æ–‡ä»¶å¤¹ï¼‰ã€‚</span></span><br><span class="line">        String prefix = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        String dir = prefix + <span class="string">"/"</span>;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; respMap = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">long</span> expireTime = <span class="number">30</span>;</span><br><span class="line">            <span class="keyword">long</span> expireEndTime = System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            Date expiration = <span class="keyword">new</span> Date(expireEndTime);</span><br><span class="line">            PolicyConditions policyConds = <span class="keyword">new</span> PolicyConditions();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line"></span><br><span class="line">            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="keyword">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">            String encodedPolicy = BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            String postSignature = ossClient.calculatePostSignature(postPolicy);</span><br><span class="line"></span><br><span class="line">            respMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">            respMap.put(<span class="string">"accessid"</span>, accessId);</span><br><span class="line">            respMap.put(<span class="string">"policy"</span>, encodedPolicy);</span><br><span class="line">            respMap.put(<span class="string">"signature"</span>, postSignature);</span><br><span class="line">            respMap.put(<span class="string">"dir"</span>, dir);</span><br><span class="line">            respMap.put(<span class="string">"host"</span>, host);</span><br><span class="line">            respMap.put(<span class="string">"expire"</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">"data"</span>, respMap);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åå‰ç«¯è·å–å“åº”ä¹‹åï¼Œå¸¦ç€æ–‡ä»¶å’Œç­¾åè¿›è¡Œä¸Šä¼ æ“ä½œå³å¯â€¦</p>
<h4 id="3-1-é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶ä¸Šä¼ "><a href="#3-1-é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="3.1 é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶ä¸Šä¼ "></a>3.1 é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶ä¸Šä¼ </h4><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">oss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">    <span class="attr">keyid:</span> <span class="string">LTAI4G5VED5k6BKQUFhCZe**</span></span><br><span class="line">    <span class="attr">keysecret:</span> <span class="string">INHwRHY7a8MNlR0jsReJYXJ4kQP**</span></span><br><span class="line">    <span class="attr">bucketname:</span> <span class="string">gulimall-horse</span></span><br></pre></td></tr></tbody></table></figure>
<p>å±æ€§å°è£…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "aliyun.oss")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssProperties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bucketname;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>serviceå±‚ä¸šåŠ¡é€»è¾‘</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title">FileService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OssProperties ossProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµçš„å½¢å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> module è‡ªå®šä¹‰ï¼šä¸Šä¼ çš„æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> originFileName æ–‡ä»¶çš„åŸå§‹å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯è®¿é—®çš„URLåœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(InputStream inputStream, String <span class="keyword">module</span>, String originFileName)</span> </span>{</span><br><span class="line">        </span><br><span class="line">        String endpoint = ossProperties.getEndpoint();</span><br><span class="line">        String keyid = ossProperties.getKeyid();</span><br><span class="line">        String keysecret = ossProperties.getKeysecret();</span><br><span class="line">        String bucketname = ossProperties.getBucketname();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­osså®ä¾‹æ˜¯å¦å­˜åœ¨ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨åˆ™è·å–</span></span><br><span class="line">        OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, keyid, keysecret);</span><br><span class="line">        <span class="keyword">if</span> (!ossClient.doesBucketExist(bucketname)) {</span><br><span class="line">            <span class="comment">//åˆ›å»ºbucket</span></span><br><span class="line">            ossClient.createBucket(bucketname);</span><br><span class="line">            <span class="comment">//è®¾ç½®osså®ä¾‹çš„è®¿é—®æƒé™ï¼šå…¬å…±è¯»</span></span><br><span class="line">            ossClient.setBucketAcl(bucketname, CannedAccessControlList.PublicRead);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ„å»ºæ—¥æœŸè·¯å¾„ï¼šavatar/2019/02/26/æ–‡ä»¶å</span></span><br><span class="line">        String folder = DateTimeFormatter.ofPattern(<span class="string">"yyyy/MM/dd"</span>).format(LocalDateTime.now());</span><br><span class="line">        <span class="comment">//æ–‡ä»¶åï¼šuuid.æ‰©å±•å</span></span><br><span class="line">        String fileName = IdUtil.simpleUUID();</span><br><span class="line">        String fileExtension = originFileName.substring(originFileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        <span class="comment">//æ–‡ä»¶ç›¸å¯¹Bucketçš„å…¨è·¯å¾„å</span></span><br><span class="line">        String key = <span class="keyword">module</span> + <span class="string">"/"</span> + folder + <span class="string">"/"</span> + fileName + fileExtension;</span><br><span class="line">        <span class="comment">//æ–‡ä»¶ä¸Šä¼ è‡³é˜¿é‡Œäº‘</span></span><br><span class="line">        ossClient.putObject(ossProperties.getBucketname(), key, inputStream);</span><br><span class="line">        <span class="comment">// å…³é—­OSSClientã€‚</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        <span class="comment">//è¿”å›urlåœ°å€</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"https://"</span> + bucketname + <span class="string">"."</span> + endpoint + <span class="string">"/"</span> + key;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>controllerå±‚çš„APIæ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Api("é˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ ")</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/admin/oss/file")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileService fileService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("æ–‡ä»¶ä¸Šä¼ ")</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams({</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "file", value = "æ–‡ä»¶", required = true),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = "module", value = "æ¨¡å—", required = true, type = "String")</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="meta">@PostMapping("/upload")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam("file")</span> MultipartFile file, <span class="meta">@RequestParam("module")</span> String <span class="keyword">module</span>)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        InputStream inputStream = file.getInputStream();</span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        String upload = fileService.upload(inputStream, <span class="keyword">module</span>, originalFilename);</span><br><span class="line">        <span class="keyword">return</span> StringUtils.isBlank(upload) ? R.error().message(<span class="string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"</span>) : R.ok().message(<span class="string">"æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"</span>).data(<span class="string">"url"</span>, upload);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-2-é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶åˆ é™¤"><a href="#3-2-é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶åˆ é™¤" class="headerlink" title="3.2 é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶åˆ é™¤"></a>3.2 é˜¿é‡Œäº‘ç®€å•çš„æ–‡ä»¶åˆ é™¤</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é˜¿é‡Œäº‘åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> url æ–‡ä»¶çš„å…¨è·¯å¾„å</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeFileByUrl</span><span class="params">(String url)</span> </span>{</span><br><span class="line"></span><br><span class="line">       String endpoint = ossProperties.getEndpoint();</span><br><span class="line">       String keyid = ossProperties.getKeyid();</span><br><span class="line">       String keysecret = ossProperties.getKeysecret();</span><br><span class="line">       String bucketname = ossProperties.getBucketname();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚</span></span><br><span class="line">       OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, keyid, keysecret);</span><br><span class="line">       <span class="comment">//æ‹¼æ¥æ–‡ä»¶çš„è®¿é—®é“¾æ¥</span></span><br><span class="line">       String host = <span class="string">"https://"</span> + bucketname + <span class="string">"."</span> + endpoint + <span class="string">"/"</span>;</span><br><span class="line">       <span class="comment">//è·å–æ–‡ä»¶çš„ç›¸å¯¹å…¨è·¯å¾„å</span></span><br><span class="line">       String objectName = url.substring(host.length());</span><br><span class="line">       <span class="comment">// åˆ é™¤æ–‡ä»¶ã€‚</span></span><br><span class="line">       ossClient.deleteObject(bucketname, objectName);</span><br><span class="line">       <span class="comment">// å…³é—­OSSClientã€‚</span></span><br><span class="line">       ossClient.shutdown();</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-3-é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘ä¸Šä¼ "><a href="#3-3-é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘ä¸Šä¼ " class="headerlink" title="3.3 é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘ä¸Šä¼ "></a>3.3 é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘ä¸Šä¼ </h4><p>åŸºæœ¬ä¿¡æ¯é…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">vod:</span></span><br><span class="line">    <span class="attr">keyid:</span> <span class="string">LTAI4G5VED5k6BKQUFhCZe**</span></span><br><span class="line">    <span class="attr">keysecret:</span> <span class="string">INHwRHY7a8MNlR0jsReJYXJ4kQPt**</span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰è½¬ç æ¨¡ç‰ˆç»„IDï¼ˆå¯ä¸é…ç½®ï¼‰</span></span><br><span class="line">    <span class="attr">templateGroupId:</span> <span class="string">8c76f35af529d4db22ca54243a54eebf</span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰å·¥ä½œæµIDï¼ˆå¯ä¸é…ç½®ï¼‰</span></span><br><span class="line">    <span class="attr">workflowId:</span> <span class="string">c0c6b6e7215bca533bec938e0d880824</span></span><br></pre></td></tr></tbody></table></figure>
<p>å±æ€§è·å–é…ç½®ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "aliyun.vod")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VodProperties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String templateGroupId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String workflowId;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æŠ½å–çš„åˆå§‹åŒ–å®¢æˆ·ç«¯å·¥å…·ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliyunVodSDKUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§†é¢‘ç‚¹æ’­æµ‹è¯•:åˆå§‹åŒ–client</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accessKeyId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accessKeySecret</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultAcsClient <span class="title">initVodClient</span><span class="params">(String accessKeyId, String accessKeySecret)</span> </span>{</span><br><span class="line">        <span class="comment">// ç‚¹æ’­æœåŠ¡æ¥å…¥åŒºåŸŸ(ä¸€èˆ¬é»˜è®¤ä¸å˜)</span></span><br><span class="line">        String regionId = <span class="string">"cn-shanghai"</span>;</span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(regionId, accessKeyId, accessKeySecret);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç®€å•è§†é¢‘ä¸Šä¼ (controllerå±‚æä¾›ä¸€ä¸ªæ–‡ä»¶æµå’Œä¸€ä¸ªæ–‡ä»¶åˆå§‹åå³å¯)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VodProperties vodProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶æµå¼è§†é¢‘ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> originalFileName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  é˜¿é‡Œäº‘è¿”å›çš„ä¸Šä¼ æˆåŠŸçš„è§†é¢‘ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadVod</span><span class="params">(InputStream inputStream, String originalFileName)</span> </span>{</span><br><span class="line"></span><br><span class="line">        String title = StringUtils.substring(originalFileName, <span class="number">0</span>, originalFileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä¸Šä¼ è§†é¢‘:</span></span><br><span class="line"><span class="comment">         * æ³¨æ„:title:å»é™¤æ‰©å±•åçš„æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        UploadStreamRequest request = <span class="keyword">new</span> UploadStreamRequest(vodProperties.getKeyid(), vodProperties.getKeysecret(),</span><br><span class="line">                title, originalFileName, inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºä»¥ä¸‹ä¸¤ä¸ªè®¾ç½®ä¼šäº§ç”Ÿè´¹ç”¨,æ‰€ä»¥å¼€å‘é˜¶æ®µå¯ä»¥å…ˆæ³¨é‡Šæ‰,ç”Ÿäº§ç¯å¢ƒå†å¼€å¯æ³¨é‡Š</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ¿ç»„ID(å¯é€‰):è‡ªå®šä¹‰çš„è½¬ç æ¨¡æ¿</span></span><br><span class="line"><span class="comment">//        request.setTemplateGroupId(vodProperties.getTemplateGroupId());</span></span><br><span class="line">        <span class="comment">// å·¥ä½œæµID(å¯é€‰):æ™ºèƒ½å®¡æ ¸æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//        request.setWorkflowId(vodProperties.getWorkflowId());</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¼€å§‹ä¸Šä¼ </span></span><br><span class="line">        UploadVideoImpl uploader = <span class="keyword">new</span> UploadVideoImpl();</span><br><span class="line">        UploadStreamResponse response = uploader.uploadStream(request);</span><br><span class="line">        <span class="comment">// è·å–VideoId</span></span><br><span class="line">        String videoId = response.getVideoId();</span><br><span class="line">        <span class="comment">//æ²¡æœ‰æ­£ç¡®çš„è¿”å›videoIdåˆ™è¯´æ˜ä¸Šä¼ å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(videoId)) {</span><br><span class="line">            log.error(<span class="string">"é˜¿é‡Œäº‘ä¸Šä¼ å¤±è´¥ï¼š"</span> + response.getCode() + <span class="string">" - "</span> + response.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.VIDEO_UPLOAD_ALIYUN_ERROR);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> videoId;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-4-é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘åˆ é™¤-amp-amp-æ‰¹é‡åˆ é™¤"><a href="#3-4-é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘åˆ é™¤-amp-amp-æ‰¹é‡åˆ é™¤" class="headerlink" title="3.4 é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘åˆ é™¤&amp;&amp;æ‰¹é‡åˆ é™¤"></a>3.4 é˜¿é‡Œäº‘ç®€å•çš„è§†é¢‘åˆ é™¤&amp;&amp;æ‰¹é‡åˆ é™¤</h4><p>æ ¹æ®è§†é¢‘IDå•ä¸ªåˆ é™¤</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®viedoIdåˆ é™¤è§†é¢‘ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClientException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeVodByVideoId</span><span class="params">(String videoId)</span> <span class="keyword">throws</span> ClientException </span>{</span><br><span class="line">        DefaultAcsClient client = AliyunVodSDKUtils.initVodClient(</span><br><span class="line">                vodProperties.getKeyid(),</span><br><span class="line">                vodProperties.getKeysecret());</span><br><span class="line">        DeleteVideoRequest request = <span class="keyword">new</span> DeleteVideoRequest();</span><br><span class="line">        request.setVideoIds(videoId);</span><br><span class="line">        client.getAcsResponse(request);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰¹é‡åˆ é™¤ï¼ˆä¼ å…¥è§†é¢‘IDæŒ‰è¦æ±‚æ‹¼æ¥çš„å­—ç¬¦ä¸²ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤é˜¿é‡Œäº‘è§†é¢‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoIdList</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeVideoByIdList</span><span class="params">(List&lt;String&gt; videoIdList)</span> <span class="keyword">throws</span> ClientException </span>{</span><br><span class="line">        DefaultAcsClient client = AliyunVodSDKUtils.initVodClient(</span><br><span class="line">                vodProperties.getKeyid(),</span><br><span class="line">                vodProperties.getKeysecret());</span><br><span class="line">        DeleteVideoRequest request = <span class="keyword">new</span> DeleteVideoRequest();</span><br><span class="line">        <span class="comment">// æ‹¼æ¥å¤šä¸ªID,å½¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> size = videoIdList.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) {</span><br><span class="line">            stringBuilder.append(videoIdList.get(i));</span><br><span class="line">            <span class="keyword">if</span> (size - <span class="number">1</span> == i || size % <span class="number">20</span> == <span class="number">19</span>) {</span><br><span class="line">                <span class="comment">// æ”¯æŒä¼ å…¥å¤šä¸ªID,å¤šä¸ªç”¨é€—å·åˆ†éš”,æ¯æ¬¡äº§å‡ºIDä¸èƒ½è¶…è¿‡20ä¸ª</span></span><br><span class="line">                request.setVideoIds(stringBuilder.toString());</span><br><span class="line">                client.getAcsResponse(request);</span><br><span class="line">                <span class="comment">// é‡ç½®stringBuilder:ä¸‹æ¬¡å¾ªç¯ä½¿ç”¨</span></span><br><span class="line">                stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">20</span> &lt; <span class="number">19</span>) {</span><br><span class="line">                stringBuilder.append(<span class="string">","</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-springbootæ•´åˆä¸ƒç‰›äº‘å®ç°osså¯¹è±¡å­˜å‚¨å¹¶å›æ˜¾"><a href="#4-springbootæ•´åˆä¸ƒç‰›äº‘å®ç°osså¯¹è±¡å­˜å‚¨å¹¶å›æ˜¾" class="headerlink" title="4. springbootæ•´åˆä¸ƒç‰›äº‘å®ç°osså¯¹è±¡å­˜å‚¨å¹¶å›æ˜¾"></a>4. springbootæ•´åˆä¸ƒç‰›äº‘å®ç°osså¯¹è±¡å­˜å‚¨å¹¶å›æ˜¾</h3><p>å¼•å…¥pom</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸ƒç‰›é…ç½®ä¾èµ–--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸ƒç‰›äº‘ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>[7.2.0, 7.2.99]<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>happy-dns-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–å†™åŸºæœ¬é…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸ƒç‰›äº‘åŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="comment"># bucketæ˜¯åˆ›å»ºçš„å­˜å‚¨ç©ºé—´å</span></span><br><span class="line"><span class="comment"># pathå¯¹åº”å­˜å‚¨ç©ºé—´çš„è®¿é—®åŸŸå(å½“å‰æ˜¯æµ‹è¯•åŸŸå)</span></span><br><span class="line"><span class="attr">qiniu:</span></span><br><span class="line">  <span class="attr">accessKey:</span> <span class="string">JMqFBotOcQWbyYtJvugcwNS_qmndHhdW1WqhWu_O</span></span><br><span class="line">  <span class="attr">secretKey:</span> <span class="string">yh_Hm51wY61g7Rj6CT_XXtU0SiWWLaCvPUMSD0c5</span></span><br><span class="line">  <span class="attr">bucket:</span> <span class="string">horse-blog</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">q9pedukg4.bkt.clouddn.com</span></span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–å†™configæ‰©å±•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(QiniuProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QiniuFileConfig</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QiniuProperties qiniuProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åä¸œæœºæˆ¿,é…ç½®è‡ªå·±ç©ºé—´æ‰€åœ¨çš„åŒºåŸŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> com.qiniu.storage.<span class="function">Configuration <span class="title">qiniuConfig</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> com.qiniu.storage.Configuration(Zone.zone0());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸€ä¸ªä¸ƒç‰›ä¸Šä¼ å·¥å…·å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UploadManager <span class="title">uploadManager</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UploadManager(qiniuConfig());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯ä¿¡æ¯å®ä¾‹ï¼šç”¨äºè·å–ä¸Šä¼ å‡­è¯,ç›¸å½“äºtokenä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Auth <span class="title">auth</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Auth.create(qiniuProperties.getAccessKey(), qiniuProperties.getSecretKey());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸ƒç‰›ç©ºé—´ç®¡ç†å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BucketManager <span class="title">bucketManager</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BucketManager(auth(), qiniuConfig());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Gson <span class="title">gson</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Gson();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®æ–‡ä»¶è¯»å–ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "qiniu")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QiniuProperties</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ•´åˆä¸Šä¼ çš„æ–¹æ³•ï¼ˆæœ¬ä¾‹ç»“åˆmarkdownä¸Šä¼ å›¾ç‰‡è¿›è¡Œæ¼”ç¤ºï¼‰</p>
<p>serviceå±‚å°è£…çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(QiNiuProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadFileServiceImpl</span> <span class="keyword">implements</span> <span class="title">UploadFileService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QiNiuProperties qiNiuProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›æ–‡ä»¶ä¸Šä¼ ç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadManager uploadManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›è®¤è¯ç®¡ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Auth auth;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç©ºé—´ç®¡ç†å™¨:ç”¨äºåˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BucketManager bucketManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸Šä¼ å‡­è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getUploadToken</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.auth.uploadToken(qiNiuProperties.getBucket(), <span class="keyword">null</span>, <span class="number">3600</span>, <span class="keyword">null</span>);</span><br><span class="line">    }   </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»¥æµçš„å½¢å¼ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶é‡å‘½å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> QiniuException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadFile</span><span class="params">(InputStream inputStream, String fileName)</span> <span class="keyword">throws</span> QiniuException </span>{</span><br><span class="line">        Response response = <span class="keyword">this</span>.uploadManager.put(inputStream, fileName, getUploadToken(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">int</span> retry = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (response.needRetry() &amp;&amp; retry &lt; <span class="number">3</span>) {</span><br><span class="line">            response = <span class="keyword">this</span>.uploadManager.put(inputStream, fileName, getUploadToken(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">            retry++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è§£æç»“æœ:æ ¹æ®è¿”å›çš„è·¯å¾„å¯ä»¥ç›´æ¥è®¿é—®ä¸Šä¼ çš„èµ„æºè¿›è¡Œå›æ˜¾æ“ä½œ</span></span><br><span class="line">        DefaultPutRet putRet = JSON.parseObject(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">        String returnPath = <span class="string">"http://"</span> + qiniuProperties.getPath() + <span class="string">"/"</span> + putRet.key;</span><br><span class="line">        log.info(<span class="string">"æ–‡ä»¶åç§°={}"</span>, returnPath);</span><br><span class="line">        <span class="keyword">return</span> returnPath;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›äº‘åˆ é™¤æ–‡ä»¶ï¼ˆå•ä¸ªåˆ é™¤ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶å(ä¸æ˜¯æ–‡ä»¶å¤–é“¾)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFile</span><span class="params">(String fileName)</span> <span class="keyword">throws</span> QiniuException </span>{</span><br><span class="line">        <span class="keyword">this</span>.bucketManager.delete(qiNiuProperties.getBucket(), fileName);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>controllerå±‚è¿›è¡Œè°ƒç”¨ï¼ˆè¿™é‡Œä»…ä»…æ˜¯markdownçš„ç”¨æ³•ï¼Œå¯èƒ½ä¸å°½ç›¸åŒï¼Œçµæ´»è¿ç”¨ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="meta">@ApiOperation(value = "markdownå›¾ç‰‡ä¸Šä¼ ", notes = "ä¾èµ–äºä¸ƒç‰›äº‘å®ç°å›¾ç‰‡ä¸Šå‡ºå›æ˜¾")</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="meta">@PostMapping("/imageUpload")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> JSONObject <span class="title">imageUpload</span><span class="params">(<span class="meta">@RequestParam(value = "editormd-image-file")</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">       JSONObject res = <span class="keyword">new</span> JSONObject();</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           FileInputStream inputStream = (FileInputStream) file.getInputStream();</span><br><span class="line">           String imagePath = blogService.uploadFile(inputStream, FileNameUtils.generateFileName(file));  <span class="comment">//FileNameUtilsï¼šé‡å‘½åæ–‡ä»¶å·¥å…·ç±»</span></span><br><span class="line">           res.put(<span class="string">"url"</span>, imagePath);</span><br><span class="line">           res.put(<span class="string">"success"</span>, <span class="number">1</span>);</span><br><span class="line">           res.put(<span class="string">"message"</span>, <span class="string">"ä¸Šä¼ æˆåŠŸï¼"</span>);</span><br><span class="line">       } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">           res.put(<span class="string">"success"</span>, <span class="number">0</span>);</span><br><span class="line">           res.put(<span class="string">"message"</span>, <span class="string">"ä¸Šä¼ å¤±è´¥ï¼"</span>);</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation("ä¸ƒç‰›äº‘åˆ é™¤æ–‡ä»¶")</span></span><br><span class="line">   <span class="meta">@PostMapping("/inner/delete")</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">deleteFile</span><span class="params">(<span class="meta">@RequestBody</span> String fileName)</span> </span>{</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           uploadFileService.deleteFile(fileName);</span><br><span class="line">           <span class="keyword">return</span> R.ok().message(<span class="string">"ä¸ƒç‰›äº‘åˆ é™¤æˆåŠŸ"</span>);</span><br><span class="line">       } <span class="keyword">catch</span> (QiniuException e) {</span><br><span class="line">           log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BlogException(ResultCodeEnum.FILE_DELETE_ERROR);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªå®šä¹‰é‡å‘½åå·¥å…·ç±»ï¼ˆå¥½è¾£é¸¡å•Šï¼ï¼ï¼ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileNameUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›¾ç‰‡é‡å‘½å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateFileName</span><span class="params">(MultipartFile file)</span> </span>{</span><br><span class="line">        String fileName = file.getOriginalFilename();</span><br><span class="line">        <span class="comment">// è·å–åç¼€</span></span><br><span class="line">        String suffix = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        <span class="comment">// è¿”å›é‡å‘½å(é›ªèŠ±ç®—æ³•å”¯ä¸€ID)</span></span><br><span class="line">        <span class="keyword">return</span> IdUtil.createSnowflake(<span class="number">1</span>, <span class="number">1</span>).nextIdStr() + suffix;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="JSåŸºç¡€"><a href="#JSåŸºç¡€" class="headerlink" title="JSåŸºç¡€"></a>JSåŸºç¡€</h2><p><code>this</code>ï¼šé»˜è®¤æŒ‡å‘è°ƒç”¨å®ƒçš„é‚£ä¸ªå¯¹è±¡ï¼Œ</p>
<h2 id="ES6çš„æ–°ç‰¹æ€§"><a href="#ES6çš„æ–°ç‰¹æ€§" class="headerlink" title="ES6çš„æ–°ç‰¹æ€§"></a>ES6çš„æ–°ç‰¹æ€§</h2><h3 id="è§£æ„è¡¨è¾¾å¼"><a href="#è§£æ„è¡¨è¾¾å¼" class="headerlink" title="è§£æ„è¡¨è¾¾å¼"></a><code>è§£æ„è¡¨è¾¾å¼</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*ç»“æ„è¡¨è¾¾å¼è§£æ„æ•°ç»„*/</span></span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>];</span><br><span class="line"><span class="keyword">const</span> [x, y, z] = array;</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br><span class="line"><span class="built_in">console</span>.log(y);</span><br><span class="line"><span class="built_in">console</span>.log(z);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = {</span><br><span class="line">    name: <span class="string">'é©¬æ»¨'</span>,</span><br><span class="line">    age: <span class="number">23</span>,</span><br><span class="line">    sex: <span class="string">'ç”·'</span></span><br><span class="line">};</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"================================"</span>);</span><br><span class="line"><span class="comment">/*ç»“æ„è¡¨è¾¾å¼è§£æ„å¯¹è±¡ï¼Œç®­å¤´å‡½æ•°çš„åŸºæœ¬åº”ç”¨*/</span></span><br><span class="line"><span class="keyword">let</span> fun2 = <span class="function">(<span class="params">{name, age, sex}</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">    <span class="built_in">console</span>.log(age);</span><br><span class="line">    <span class="built_in">console</span>.log(sex);</span><br><span class="line">};</span><br><span class="line">fun2(person);</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200513090859817.png" alt="image-20200513090859817"></p>
<h3 id="å‡½æ•°çš„ä¼˜åŒ–"><a href="#å‡½æ•°çš„ä¼˜åŒ–" class="headerlink" title="å‡½æ•°çš„ä¼˜åŒ–"></a><code>å‡½æ•°çš„ä¼˜åŒ–</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> fun3 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> {</span><br><span class="line">    <span class="comment">//åœ¨è¿™ä¸ªå‡½æ•°ä¸­åº”è¯¥åˆ¤æ–­bæ˜¯å¦ä¸ºç©ºï¼Œä¼ ç»Ÿçš„å†™æ³•æ˜¯è¿™æ ·çš„</span></span><br><span class="line">    <span class="keyword">if</span> (b == <span class="literal">null</span>) {</span><br><span class="line">        b = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æˆ–è€…è¿™æ ·å†™(å«ä¹‰æ˜¯ï¼šè‹¥bä¸ä¸ºç©ºï¼Œåˆ™bå°±æ˜¯trueï¼Œé‚£ä¹ˆb=b,è‹¥bä¸ºç©ºï¼Œåˆ™bå°±æ˜¯falseï¼Œé‚£ä¹ˆb=1)</span></span><br><span class="line">    b = b || <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a / b);</span><br><span class="line">};</span><br><span class="line"><span class="comment">//å‚æ•°bä¸ä¼ å€¼ï¼Œå°±ä¸ºç©ºï¼Œè¿›è¡Œæµ‹è¯•</span></span><br><span class="line">fun3(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//es6æ–°è¯­æ³•ï¼šç›´æ¥åœ¨å‚æ•°ä¸Šé¢è¿›è¡Œä¼˜åŒ–åˆ¤æ–­ï¼šè‹¥bä¸ºç©ºï¼Œé‚£ä¹ˆb=1,è‹¥ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¸åšåˆ¤æ–­</span></span><br><span class="line"><span class="keyword">let</span> fun3 = <span class="function">(<span class="params">a, b = <span class="number">1</span></span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(a / b);</span><br><span class="line">};</span><br><span class="line"><span class="comment">//å‚æ•°bä¸ä¼ å€¼ï¼Œå°±ä¸ºç©ºï¼Œè¿›è¡Œæµ‹è¯•</span></span><br><span class="line">fun3(<span class="number">10</span>);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mapå‡½æ•°"><a href="#mapå‡½æ•°" class="headerlink" title="mapå‡½æ•°"></a><code>mapå‡½æ•°</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*mapå‡½æ•°*/</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="comment">//mapä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼šæŠŠåŸæ•°ç»„ä¸­çš„å„ä¸ªå…ƒç´ éƒ½ç”¨æ­¤å‡½æ•°å¤„ç†ï¼Œç„¶ååœ¨è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå’Œjavaä¸­streamæµä¸­çš„mapå‡½æ•°å«ä¹‰ä¸€æ ·</span></span><br><span class="line"><span class="keyword">let</span> anies = arr.map(<span class="function"><span class="params">a</span> =&gt;</span> a * <span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(anies);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200513093333214.png" alt="image-20200513093333214"></p>
<h3 id="reduceå‡½æ•°"><a href="#reduceå‡½æ•°" class="headerlink" title="reduceå‡½æ•°"></a><code>reduceå‡½æ•°</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*reduceå‡½æ•°ï¼šæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼ˆå¿…é¡»ï¼‰å’Œä¸€ä¸ªåˆå§‹å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">    * ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå‡½æ•°å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">    *   ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ¬¡reduceå¤„ç†çš„ç»“æœ</span></span><br><span class="line"><span class="comment">    *   ç¬¬äºŒä¸ªç»“æœæ˜¯æ•°ç»„ä¸­è¦å¤„ç†çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">    * ç¬¬äºŒä¸ªå‚æ•°ï¼šåˆå§‹å€¼</span></span><br><span class="line"><span class="comment">    *   å¦‚æœæœ‰åˆå§‹å€¼ï¼Œé‚£ä¹ˆå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°åˆšå¼€å§‹çš„å€¼å°±æ˜¯åˆå§‹å€¼ï¼Œä¹‹åå›å¤æ­£å¸¸</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">    <span class="comment">//æ²¡æœ‰åˆå§‹å€¼(è¿™é‡Œå°±ç›¸å½“äºç´¯ä¹˜è¿ç®—)</span></span><br><span class="line">    <span class="keyword">let</span> reduce = arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a * b);</span><br><span class="line">    <span class="built_in">console</span>.log(reduce);</span><br><span class="line">    <span class="comment">//æœ‰åˆå§‹å€¼</span></span><br><span class="line">    <span class="keyword">let</span> number = arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a * b, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(number);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200513094409522.png" alt="image-20200513094409522"></p>
<h3 id="Objectå¯¹è±¡çš„æ‰©å±•"><a href="#Objectå¯¹è±¡çš„æ‰©å±•" class="headerlink" title="Objectå¯¹è±¡çš„æ‰©å±•"></a><code>Objectå¯¹è±¡çš„æ‰©å±•</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*Objecté¡¶çº§å¯¹è±¡çš„æ‰©å±•:å°±ç›¸å½“äºjavaä¸­çš„mapé‡Œé¢çš„è·å–é”®å€¼å¯¹çš„æ–¹æ³•*/</span></span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡ä¸­æ‰€æœ‰çš„keyï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> keys = <span class="built_in">Object</span>.keys(person);</span><br><span class="line"><span class="built_in">console</span>.log(keys);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡ä¸­æ‰€æœ‰çš„valueï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> values = <span class="built_in">Object</span>.values(person);</span><br><span class="line"><span class="built_in">console</span>.log(values);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡ä¸­æ‰€æœ‰çš„key:valueï¼Œè¿”å›ä¸€ä¸ªäºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> entries = <span class="built_in">Object</span>.entries(person);</span><br><span class="line"><span class="built_in">console</span>.log(entries);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newPerson = {</span><br><span class="line">    height: <span class="number">180</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//å°†ä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§copyåˆ°å¦ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­</span></span><br><span class="line"><span class="keyword">let</span> assign = <span class="built_in">Object</span>.assign(newPerson, person);</span><br><span class="line"><span class="built_in">console</span>.log(assign);</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200513095641368.png" alt="image-20200513095641368"></p>
<p><code>æ•°ç»„çš„æ–¹æ³•æ‰©å±•</code></p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * æ•°ç»„æ‰©å±•æ–¹æ³•</span></span><br><span class="line"><span class="comment">   * find(callback)ï¼šä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°æ®å¹¶è¿”å›</span></span><br><span class="line"><span class="comment">   *   å…·ä½“:æ‰€æœ‰çš„æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œæ­¤å›è°ƒå‡½æ•°ï¼Œç›´åˆ°æ‰¾å‡ºç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸ºtrueçš„æˆå‘˜å¹¶è¿”å›ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å›undefined</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">   <span class="built_in">console</span>.log(arr.find(<span class="function"><span class="params">a</span> =&gt;</span> a === <span class="number">3</span>));</span><br><span class="line">è¾“å‡ºç»“æœæ˜¯ï¼š<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="UIæ¡†æ¶ï¼šLayUI"><a href="#UIæ¡†æ¶ï¼šLayUI" class="headerlink" title="UIæ¡†æ¶ï¼šLayUI"></a>UIæ¡†æ¶ï¼šLayUI</h2><h3 id="å›¾æ ‡"><a href="#å›¾æ ‡" class="headerlink" title="å›¾æ ‡"></a><code>å›¾æ ‡</code></h3><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ç§æ˜¾ç¤ºå›¾æ ‡çš„æ–¹å¼</span></span><br><span class="line">&lt;%--ä½¿ç”¨æ ·å¼å¼•ç”¨--%&gt;</span><br><span class="line">&lt;i class="layui-icon layui-icon-face-smile" style="font-size: 30px;color: red;"&gt;&lt;/i&gt;</span><br><span class="line">&lt;%--ä½¿ç”¨unicodeå¼•ç”¨--%&gt;</span><br><span class="line">&lt;i class="layui-icon" style="font-size: 30px;color: silver;"&gt;&amp;#xe677;&lt;/i&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æŒ‰é’®"><a href="#æŒ‰é’®" class="headerlink" title="æŒ‰é’®"></a><code>æŒ‰é’®</code></h3><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--åªè¦æ˜¯å®¹å™¨æ ‡ç­¾(a,span,buttom,...å¸¸ç”¨æ ‡ç­¾éƒ½å¯ä»¥)å°±å¯ä»¥æ‰¿è½½å®šä¹‰æŒ‰é’®å±æ€§--%&gt;</span><br><span class="line">&lt;button class="layui-btn layui-btn-radius layui-btn-sm layui-btn-normal"&gt;ç™¾æ­æŒ‰é’®&lt;/button&gt;</span><br><span class="line">&lt;a href=<span class="string">"http://www.horsemuzi.top"</span>&gt;</span><br><span class="line">    &lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-btn layui-btn-warm"</span>&gt;</span><br><span class="line">        &lt;i class="layui-icon layui-icon-app"&gt; åº”ç”¨&lt;/i&gt;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-btn layui-btn-danger layui-btn-sm"</span>&gt;</span><br><span class="line">    &lt;i class="layui-icon layui-icon-android"&gt;&lt;/i&gt;å®‰å“</span><br><span class="line">&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼ˆJqueryï¼‰</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">/*ä½¿ç”¨layuiä¸­çš„æŸä¸ªç»„ä»¶å¿…é¡»è¿›è¡Œæ³¨å†Œï¼Œæ‰èƒ½ä½¿ç”¨*/</span></span><br><span class="line">    layui.use([<span class="string">"jquery"</span>], function () {</span><br><span class="line">        <span class="keyword">var</span> $ = layui.jquery;</span><br><span class="line">		...å…·ä½“ç»‘å®šæ“ä½œ...</span><br><span class="line">        $(<span class="string">".layui-btn"</span>).click(function () {</span><br><span class="line">            alert($(<span class="keyword">this</span>).html());</span><br><span class="line">        })</span><br><span class="line">    })</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a><code>å¯¼èˆª</code></h3><p>ä½¿ç”¨ä¹‹å‰ä¸€å®šè¦å…ˆåŠ è½½elementç»„ä»¶(å¦åˆ™åŠ¨æ€æ•ˆæœæ— æ³•æ¸²æŸ“)</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">layui.use([<span class="string">"element"</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> element = layui.element;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç›¸å…³æ ·å¼</p>
<ul>
<li>æ–¹å‘ï¼š<ul>
<li>æ°´å¹³æ–¹å‘ï¼ˆé»˜è®¤ï¼‰</li>
<li>å‚ç›´æ–¹å‘ <code>layui-nav-tree</code>ï¼šå°±åªä¼šå æœ‰å½“å‰å®¹å™¨å¤§å°</li>
<li>å‚ç›´ä¾§è¾¹æ <code>layui-nav-treeå’Œlayui-nav-side</code>:ä¼šå æœ‰å½“å‰å±å¹•çš„å…¨éƒ¨é«˜åº¦</li>
</ul>
</li>
<li>å…¶ä»–æ ·å¼<ul>
<li><code>layui-nav-item</code>:ä»£è¡¨å¯¼èˆªèœå•çš„ä¸€ä¸ªå­é¡¹<ul>
<li><code>layui-nav-child</code>:å­é¡¹ç›®ä¸­çš„å­é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯äºŒçº§èœå•ï¼‰</li>
</ul>
</li>
<li><code>layui-nav-itemed</code>ï¼šé»˜è®¤å±•å¼€å½“å‰èœå•äºŒçº§èœå•</li>
<li><code>layui-this</code>:ä»£è¡¨å½“å‰é€‰ä¸­çš„èœå•é¡¹</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav layui-bg-cyan"</span>&gt;</span><br><span class="line">        &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav-item layui-this"</span>&gt;</span><br><span class="line">            &lt;a href="javascript:;"&gt;é¦–é¡µ&lt;span class="layui-badge"&gt;10&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav-item"</span>&gt;</span><br><span class="line">            &lt;a href="javascript:;"&gt;ç±»å‹&lt;span class="layui-badge-dot"&gt;&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav-item"</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">"javascript:;"</span>&gt;&lt;img src=<span class="string">"http://q9pedukg4.bkt.clouddn.com/0e12747b-2582-48b2-8d89-62c87e0ddffc.jpg"</span></span><br><span class="line">                                        <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav-img"</span></span><br><span class="line">                                        alt="æ— æ³•åŠ è½½"/&gt;æˆ‘&lt;/a&gt;</span><br><span class="line">            &lt;dl <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-nav-child"</span>&gt;</span><br><span class="line">                &lt;dd&gt;&lt;a href="javascript:;"&gt;ç¼–è¾‘èµ„æ–™&lt;/a&gt;&lt;/dd&gt;</span><br><span class="line">                &lt;dd&gt;&lt;a href="javascript:;"&gt;æ›´æ¢å¤´åƒ&lt;/a&gt;&lt;/dd&gt;</span><br><span class="line">                &lt;dd&gt;&lt;a href="javascript:;"&gt;å…³äºåšä¸»&lt;/a&gt;&lt;/dd&gt;</span><br><span class="line">            &lt;/dl&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="é€‰é¡¹å¡"><a href="#é€‰é¡¹å¡" class="headerlink" title="é€‰é¡¹å¡"></a><code>é€‰é¡¹å¡</code></h3><p>ç›¸å…³æ ·å¼</p>
<ul>
<li><code>layui-tab</code>:ä»£è¡¨ä¸€ä¸ªé€‰é¡¹å¡<ul>
<li><code>layui-tab-title</code>:ä»£è¡¨é€‰é¡¹å¡çš„æ ‡é¢˜<ul>
<li><code>layui-this</code>:å¯åŠ¨é€‰ä¸­</li>
</ul>
</li>
<li><code>layui-tab-content</code>:ä»£è¡¨é€‰é¡¹å¡æ ‡é¢˜æ‰€å¯¹åº”çš„å†…å®¹åŒ…è£…ä½“<ul>
<li><code>layui-tab-item</code>:å…·ä½“çš„å†…å®¹</li>
<li><code>layui-show</code>:å¯åŠ¨æ˜¾ç¤º</li>
</ul>
</li>
</ul>
</li>
<li><code>lay-allowClose="true"</code>ï¼šæ˜¯å¦å¯åŠ¨å…³é—­æŒ‰é’®</li>
<li><code>lay-filter='demo'</code>:layuiä¸­å¯ä»¥å®šä½æ‰¾åˆ°å…ƒç´ çš„å±æ€§ï¼Œå’Œé€‰æ‹©å™¨å·®ä¸å¤š</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-tab  layui-tab-brief"</span> lay-allowClose=<span class="string">"true"</span> lay-filter=<span class="string">"demoTab"</span>&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-tab-title"</span>&gt;</span><br><span class="line">        &lt;li class="layui-this myTab" lay-id="1"&gt;ç”¨æˆ·ç®¡ç†&lt;/li&gt;</span><br><span class="line">        &lt;li lay-id="2" class="myTab"&gt;æƒé™ç®¡ç†&lt;/li&gt;</span><br><span class="line">        &lt;li lay-id="3" class="myTab"&gt;æ—¥å¿—ç®¡ç†&lt;/li&gt;</span><br><span class="line">        &lt;li lay-id="4" class="myTab"&gt;å•†å“ç®¡ç†&lt;/li&gt;</span><br><span class="line">        &lt;li lay-id="5" class="myTab"&gt;å“ç‰Œç®¡ç†&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-tab-content"</span>&gt;</span><br><span class="line">        &lt;div class="layui-tab-item layui-show"&gt;å†…å®¹1&lt;/div&gt;</span><br><span class="line">        &lt;div class="layui-tab-item"&gt;å†…å®¹2&lt;/div&gt;</span><br><span class="line">        &lt;div class="layui-tab-item"&gt;å†…å®¹3&lt;/div&gt;</span><br><span class="line">        &lt;div class="layui-tab-item"&gt;å†…å®¹4&lt;/div&gt;</span><br><span class="line">        &lt;div class="layui-tab-item"&gt;å†…å®¹5&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-btn-group"</span>&gt;</span><br><span class="line">    &lt;button class="layui-btn layui-btn-radius layui-btn-sm layui-btn-normal" id="addTab"&gt;å¢åŠ ä¸€ä¸ªé€‰é¡¹å¡&lt;/button&gt;</span><br><span class="line">    &lt;button class="layui-btn layui-btn-radius layui-btn-sm layui-btn-normal" id="changeTab"&gt;åˆ‡æ¢é€‰é¡¹å¡&lt;/button&gt;</span><br><span class="line">    &lt;button class="layui-btn layui-btn-radius layui-btn-sm layui-btn-normal" id="deleteTab"&gt;åˆ é™¤ä¸€ä¸ªé€‰é¡¹å¡&lt;/button&gt;</span><br><span class="line">    &lt;button class="layui-btn layui-btn-radius layui-btn-sm layui-btn-normal" id="deleteAll"&gt;åˆ é™¤å¤šä¸ªé€‰é¡¹å¡&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">/*ä½¿ç”¨layuiä¸­çš„ç»„ä»¶å¿…é¡»è¿›è¡Œæ³¨å†Œ*/</span></span><br><span class="line">    layui.use([<span class="string">"jquery"</span>, <span class="string">"element"</span>], function () {</span><br><span class="line">        let $ = layui.jquery;</span><br><span class="line">        let element = layui.element;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*åŠ¨æ€é€‰é¡¹å¡æ“ä½œ*/</span></span><br><span class="line">        $(<span class="string">"#addTab"</span>).click(function () {</span><br><span class="line">            <span class="comment">//å¢åŠ é€‰é¡¹å¡</span></span><br><span class="line">            element.tabAdd(<span class="string">'demoTab'</span>, {</span><br><span class="line">                    title: <span class="string">'å½’æ¡£å±•ç¤º'</span>,</span><br><span class="line">                    content: <span class="string">'&lt;h1&gt;å½’æ¡£å†…å®¹&lt;/h1&gt;'</span></span><br><span class="line">                }</span><br><span class="line">            )</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        $(<span class="string">"#changeTab"</span>).click(function () {</span><br><span class="line">            åˆ‡æ¢é€‰é¡¹å¡</span><br><span class="line">            element.tabChange(<span class="string">'demoTab'</span>, <span class="string">"3"</span>);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        $(<span class="string">"#deleteTab"</span>).click(function () {</span><br><span class="line">            <span class="comment">//åˆ é™¤é€‰é¡¹å¡</span></span><br><span class="line">            element.tabDelete(<span class="string">'demoTab'</span>, <span class="string">"4"</span>);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤æ‰€æœ‰é€‰é¡¹å¡</span></span><br><span class="line">        $(<span class="string">"#deleteAll"</span>).click(function () {</span><br><span class="line">            <span class="comment">//è·å–æ‰€æœ‰çš„liæ ‡ç­¾</span></span><br><span class="line">            let lis = $(<span class="string">".myTab"</span>);</span><br><span class="line">            <span class="comment">//index:é›†åˆç´¢å¼•ï¼Œvalue:æ¯ä¸ªliå¯¹è±¡</span></span><br><span class="line">            $.each(lis, function (index, value) {</span><br><span class="line">                <span class="comment">//è·å–æ¯ä¸ªliå¯¹è±¡çš„lay-id</span></span><br><span class="line">                let layId = value.getAttribute(<span class="string">"lay-id"</span>);</span><br><span class="line">                element.tabDelete(<span class="string">'demoTab'</span>, layId);</span><br><span class="line">            })</span><br><span class="line">        })</span><br><span class="line">    })</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è¿›åº¦æ¡"><a href="#è¿›åº¦æ¡" class="headerlink" title="è¿›åº¦æ¡"></a><code>è¿›åº¦æ¡</code></h3><p>ç›¸å…³æ ·å¼ï¼š</p>
<ul>
<li><code>layui-progress</code>:ä»£è¡¨è¿›åº¦æ¡<ul>
<li><code>layui-progress-bar</code>ï¼šä»£è¡¨è¿›åº¦æ¡é‡Œé¢çš„div</li>
<li><code>lay-percent="30%"</code>:ä»£è¡¨è¿›åº¦æ¡è¿›åº¦</li>
</ul>
</li>
<li><code>layui-progress-big</code>:ä»£è¡¨å¤§å°ºå¯¸è¿›åº¦æ¡ï¼ˆæ–‡æœ¬æ•°å­—åœ¨è¿›åº¦æ¡é‡Œé¢æ˜¾ç¤ºï¼‰</li>
<li><code>lay-showPercent="yes"</code>ï¼šæ˜¯å¦å¼€å¯æ–‡æœ¬æ•°å­—ç­‰æ˜¾ç¤º</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-progress layui-progress-big"</span> lay-showPercent=<span class="string">"yes"</span>&gt;</span><br><span class="line">    &lt;div class="layui-progress-bar layui-bg-blue" lay-percent="30%" &gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200507151923493.png" alt="image-20200507151923493"></p>
<h3 id="é¢æ¿"><a href="#é¢æ¿" class="headerlink" title="é¢æ¿"></a><code>é¢æ¿</code></h3><p>å¡ç‰‡é¢æ¿å¾ˆç®€å•ï¼Œä¸‹é¢æ˜¯æ‰‹é£ç´é¢æ¿ï¼ˆå±•å¼€ä¸€ä¸ªé¢æ¿ï¼Œå°±å…³é—­ä¸Šä¸€ä¸ªé¢æ¿ï¼‰</p>
<p>ç›¸å…³æ ·å¼ï¼š</p>
<ul>
<li><code>layui-collapse</code>:ä»£è¡¨ä¸€ä¸ªé¢æ¿<ul>
<li><code>layui-colla-item</code>ï¼šä»£è¡¨ä¸€ä¸ªé¢æ¿é¡¹<ul>
<li><code>layui-colla-title</code>ï¼šä¸€ä¸ªé¢æ¿é¡¹æ ‡é¢˜</li>
<li><code>layui-colla-content</code>ï¼šä¸€ä¸ªé¢æ¿é¡¹å†…å®¹</li>
</ul>
</li>
</ul>
</li>
<li><code>lay-accordion</code>ï¼šå¼€å¯æ‰‹é£ç´æ¨¡å¼</li>
</ul>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%--æ‰‹é£ç´é¢æ¿--%&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-collapse"</span> lay-accordion lay-filter=<span class="string">"test"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-colla-item"</span>&gt;</span><br><span class="line">        &lt;h2 class="layui-colla-title"&gt;é¢æ¿æ ‡é¢˜1&lt;/h2&gt;</span><br><span class="line">        &lt;div class="layui-colla-content"&gt;é¢æ¿å†…å®¹1&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-colla-item"</span>&gt;</span><br><span class="line">        &lt;h2 class="layui-colla-title"&gt;é¢æ¿æ ‡é¢˜2&lt;/h2&gt;</span><br><span class="line">        &lt;div class="layui-colla-content layui-show"&gt;é¢æ¿å†…å®¹2&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-colla-item"</span>&gt;</span><br><span class="line">        &lt;h2 class="layui-colla-title"&gt;é¢æ¿æ ‡é¢˜3&lt;/h2&gt;</span><br><span class="line">        &lt;div class="layui-colla-content"&gt;é¢æ¿å†…å®¹3&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€è·å–é¢æ¿ä¿¡æ¯:å½“æŠ˜å é¢æ¿ç‚¹å‡»å±•å¼€æˆ–æ”¶ç¼©æ—¶è§¦å‘ï¼Œå›è°ƒå‡½æ•°è¿”å›ä¸€ä¸ªobjectå‚æ•°ï¼Œæºå¸¦ä¸‰ä¸ªæˆå‘˜</span></span><br><span class="line">        element.on(<span class="string">'collapse(test)'</span>,function (data) {</span><br><span class="line">            console.log(data.show); <span class="comment">//å¾—åˆ°å½“å‰é¢æ¿çš„å±•å¼€çŠ¶æ€ï¼Œtrueæˆ–è€…false</span></span><br><span class="line">            console.log(data.title.html()); <span class="comment">//è·å–å½“å‰æ ‡é¢˜åŒºåŸŸä¸­çš„htmlæ ‡ç­¾ä¸­çš„å†…å®¹</span></span><br><span class="line">            console.log(data.content.html());<span class="comment">//è·å–å½“å‰å†…å®¹åŒºåŸŸä¸­çš„htmlæ ‡ç­¾ä¸­çš„å†…å®¹</span></span><br><span class="line">        })</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ—¶é—´çº¿"><a href="#æ—¶é—´çº¿" class="headerlink" title="æ—¶é—´çº¿"></a><code>æ—¶é—´çº¿</code></h3><p>ç›¸å…³æ ·å¼ï¼š</p>
<ul>
<li><code>layui-timeline</code>:ä»£è¡¨ä¸€ä¸ªæ—¶é—´çº¿<ul>
<li><code>layui-timeline-item</code>ï¼šä»£è¡¨æ—¶é—´çº¿ä¸­çš„ä¸€é¡¹<ul>
<li><code>layui-timeline-axis</code>ï¼šä»£è¡¨è¿™æ˜¯æ—¶é—´çº¿ä¸­çš„ä¸€ä¸ªè½´ç‚¹å’Œç«–çº¿ï¼ˆå¯ä»¥ä½¿ç”¨å›¾æ ‡ï¼Œå¥½çœ‹ï¼‰</li>
<li><code>layui-timeline-content</code>ï¼šé¡¹ä¸­çš„å†…å®¹<ul>
<li><code>layui-timeline-title</code>:å†…å®¹ä¸­æ ‡é¢˜ï¼ˆç®€å•çš„å†…å®¹æ ‡é¢˜ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;fieldset <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-elem-field layui-field-title"</span> style=<span class="string">"margin-top: 30px;"</span>&gt;</span><br><span class="line">    &lt;legend&gt;åšå®¢å½’æ¡£&lt;/legend&gt;</span><br><span class="line">&lt;/fieldset&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline"</span>&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-item"</span>&gt;</span><br><span class="line">        &lt;i class="layui-icon layui-icon-fire layui-timeline-axis"&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-content layui-text"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-title"</span>&gt;</span><br><span class="line">                é’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-item"</span>&gt;</span><br><span class="line">        &lt;i class="layui-icon layui-icon-face-smile layui-timeline-axis"&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-content layui-text"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-title"</span>&gt;</span><br><span class="line">                é’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-item"</span>&gt;</span><br><span class="line">        &lt;i class="layui-icon layui-icon-face-smile layui-timeline-axis"&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-content layui-text"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-title"</span>&gt;</span><br><span class="line">                é’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-item"</span>&gt;</span><br><span class="line">        &lt;i class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop layui-timeline-axis"&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-content layui-text"</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-timeline-title"</span>&gt;</span><br><span class="line">                é’¢é“æ˜¯æ€æ ·ç‚¼æˆçš„</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ¨ç”»-ä¸é‡è¦"><a href="#åŠ¨ç”»-ä¸é‡è¦" class="headerlink" title="åŠ¨ç”»(ä¸é‡è¦)"></a><code>åŠ¨ç”»(ä¸é‡è¦)</code></h3><ul>
<li><code>layui-anim</code>ï¼šä»£è¡¨åŠ¨ç”»<ul>
<li><code>layui-anim-rotate</code>ï¼šæ—‹è½¬ä¸€åœˆ</li>
<li><code>layui-anim-loop</code>:å¾ªç¯æ—‹è½¬</li>
<li>â€¦è¿˜æœ‰å¥½å‡ ä¸ªï¼Œå…·ä½“æ–‡æ¡£æŸ¥çœ‹</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">&lt;i class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop"&gt;&lt;/i&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ»‘å—"><a href="#æ»‘å—" class="headerlink" title="æ»‘å—"></a><code>æ»‘å—</code></h3><figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;div id="sliderDiv"&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">/*æ»‘å—çš„åŸºæœ¬æ ·å¼å±æ€§*/</span></span><br><span class="line">        slider.render({</span><br><span class="line">            elem: <span class="string">"#sliderDiv"</span>,</span><br><span class="line">            value: <span class="number">6</span>, <span class="comment">//åˆå§‹å€¼</span></span><br><span class="line">            min: <span class="number">0</span>,    <span class="comment">//æœ€å°å€¼</span></span><br><span class="line">            max: <span class="number">50</span>,   <span class="comment">//æœ€å¤§å€¼</span></span><br><span class="line">            step: <span class="number">3</span>,  <span class="comment">//è®¾ç½®æ­¥é•¿</span></span><br><span class="line">            showstep: <span class="keyword">true</span>, <span class="comment">//å¼€å¯ä»¥æ­¥é•¿ä¸ºåŸºç¡€çš„é—´éš”ç‚¹</span></span><br><span class="line">            setTips: function (data) {   <span class="comment">//è‡ªå®šä¹‰æç¤ºä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">return</span> data + <span class="string">'%'</span>;</span><br><span class="line">            },</span><br><span class="line">            theme: <span class="string">'#1c97f5'</span>,  <span class="comment">//è‡ªå®šä¹‰é¢œè‰²</span></span><br><span class="line">            input: <span class="keyword">true</span>,  <span class="comment">//å¼€å¯inputè¾“å…¥æ¡†</span></span><br><span class="line">        })</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ—¶é—´å’Œæ—¥æœŸé€‰æ‹©å™¨"><a href="#æ—¶é—´å’Œæ—¥æœŸé€‰æ‹©å™¨" class="headerlink" title="æ—¶é—´å’Œæ—¥æœŸé€‰æ‹©å™¨"></a><code>æ—¶é—´å’Œæ—¥æœŸé€‰æ‹©å™¨</code></h3><p>ä¸€èˆ¬æ¥è¯´ï¼šé»˜è®¤çš„å°±å¤Ÿä½¿ç”¨äº†</p>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-inline"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"dateTime"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input"</span> placeholder=<span class="string">"yyyy-MM-dd"</span>/&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*æ—¥æœŸå’Œæ—¶é—´é€‰æ‹©å™¨*/</span></span><br><span class="line">        laydate.render({</span><br><span class="line">            elem: <span class="string">'#dateTime'</span>, <span class="comment">//ç»‘å®šå…ƒç´ </span></span><br><span class="line">            type: <span class="string">'datetime'</span>,  <span class="comment">//æ—¥æœŸçš„ç±»å‹...</span></span><br><span class="line">            range: <span class="keyword">true</span>,   <span class="comment">//å¼€å¯å·¦å³é¢æ¿èŒƒå›´é€‰æ‹©</span></span><br><span class="line">            format: <span class="string">'yyyy-MM-dd'</span>,  <span class="comment">//æ˜¾ç¤ºæ ¼å¼åŒ–ç±»å‹</span></span><br><span class="line">            value: <span class="keyword">new</span> Date(),  <span class="comment">//è®¾ç½®è‡ªåŠ¨å¡«å……åˆå§‹å€¼ï¼šå½“å‰æ—¶é—´æˆ–å…¶ä»–</span></span><br><span class="line">            min: <span class="string">'2020-05-06'</span>,  <span class="comment">//èŒƒå›´æœ€å°å€¼</span></span><br><span class="line">            max: <span class="string">'2020-05-30'</span>,  <span class="comment">//èŒƒå›´æœ€å¤§å€¼</span></span><br><span class="line">            lang: <span class="string">'cn'</span>,    <span class="comment">//è®¾ç½®è¯­è¨€</span></span><br><span class="line">            calendar: <span class="keyword">true</span>, <span class="comment">//æ˜¯å¦å¼ºè°ƒé»˜è®¤èŠ‚å‡æ—¥</span></span><br><span class="line">            <span class="comment">//....è¿˜æœ‰å¥½å¤š</span></span><br><span class="line">        })</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è¡¨å•å…ƒç´ "><a href="#è¡¨å•å…ƒç´ " class="headerlink" title="è¡¨å•å…ƒç´ "></a><code>è¡¨å•å…ƒç´ </code></h3><ul>
<li><code>layui-form</code>:ä»£è¡¨ä¸€ä¸ªformè¡¨å•<ul>
<li><code>layui-form-item</code>ï¼šä»£è¡¨è¡¨å•ä¸­çš„ä¸€é¡¹</li>
</ul>
</li>
</ul>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;form <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form"</span> action=<span class="string">"#"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form-item"</span>&gt;</span><br><span class="line">        &lt;label class="layui-form-label"&gt;ç”¨æˆ·å&lt;/label&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-inline"</span>&gt;</span><br><span class="line">            <span class="comment">//requiredï¼šæ³¨å†Œæµè§ˆå™¨æ‰€è§„å®šçš„å¿…å¡«å­—æ®µ</span></span><br><span class="line">			<span class="comment">//lay-verifyï¼šæ³¨å†Œformæ¨¡å—éœ€è¦éªŒè¯çš„ç±»å‹</span></span><br><span class="line">            &lt;input type=<span class="string">"text"</span> name=<span class="string">"title"</span> required lay-verify=<span class="string">"required"</span> placeholder=<span class="string">"è¯·è¾“å…¥æ ‡é¢˜"</span> autocomplete=<span class="string">"off"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input"</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form-item"</span>&gt;</span><br><span class="line">        &lt;label class="layui-form-label"&gt;é€‰æ‹©æ¡†&lt;/label&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-inline"</span>&gt;</span><br><span class="line">            <span class="comment">//lay-search æ¥å¼€å¯æœç´¢åŒ¹é…åŠŸèƒ½</span></span><br><span class="line">            &lt;select name=<span class="string">"city"</span> lay-verify=<span class="string">"required"</span> lay-search&gt;</span><br><span class="line">                &lt;option value=""&gt;&lt;/option&gt;</span><br><span class="line">                &lt;option value="0"&gt;åŒ—äº¬&lt;/option&gt;</span><br><span class="line">                &lt;option value="1"&gt;ä¸Šæµ·&lt;/option&gt;</span><br><span class="line">                &lt;option value="2"&gt;å¹¿å·&lt;/option&gt;</span><br><span class="line">                &lt;option value="3"&gt;æ·±åœ³&lt;/option&gt;</span><br><span class="line">                &lt;option value="4"&gt;æ­å·&lt;/option&gt;</span><br><span class="line">            &lt;/select&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form-item"</span>&gt;</span><br><span class="line">        <span class="comment">//è®¾ç½®value="1"å¯è‡ªå®šä¹‰å€¼ï¼Œå¦åˆ™é€‰ä¸­æ—¶è¿”å›çš„å°±æ˜¯é»˜è®¤çš„on</span></span><br><span class="line">        &lt;label class="layui-form-label"&gt;å¤é€‰æ¡†&lt;/label&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-block"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"like[write]"</span> title=<span class="string">"å†™ä½œ"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"like[read]"</span> title=<span class="string">"é˜…è¯»"</span> checked&gt;</span><br><span class="line">            &lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"like[dai]"</span> title=<span class="string">"å‘å‘†"</span> disabled&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form-item"</span>&gt;</span><br><span class="line">        &lt;label class="layui-form-label"&gt;å¼€å…³&lt;/label&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-block"</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">"checkbox"</span> value=<span class="string">"1"</span> name=<span class="string">"switch"</span> lay-skin=<span class="string">"switch"</span> lay-text=<span class="string">"ON|OFF"</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">	<span class="comment">//å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</span></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-form-item layui-form-text"</span>&gt;</span><br><span class="line">        &lt;label class="layui-form-label"&gt;ç¼–è¾‘å™¨&lt;/label&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-input-block"</span>&gt;</span><br><span class="line">            &lt;textarea class="layui-textarea layui-hide" name="content" lay-verify="content" id="LAY_demo_editor"&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script src="resources/layui/layui.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    layui.use([<span class="string">'form'</span>,<span class="string">'element'</span>,<span class="string">'jquery'</span>,<span class="string">'layedit'</span>], function () {</span><br><span class="line">        let form = layui.form;</span><br><span class="line">        let element = layui.element;</span><br><span class="line">        let jquery = layui.jquery;</span><br><span class="line">        let layedit = layui.layedit;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆè¿™æ ·å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ‰èƒ½ç®€å•ä½¿ç”¨ï¼Œä½†æ˜¯å›¾ç‰‡ä¸Šä¼ ä»éœ€è¦é¢å¤–é…ç½®ï¼‰</span></span><br><span class="line">        let editIndex = layedit.build(<span class="string">'LAY_demo_editor'</span>);</span><br><span class="line">    })</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è¡¨å•å¯¹è±¡æ“ä½œ"><a href="#è¡¨å•å¯¹è±¡æ“ä½œ" class="headerlink" title="è¡¨å•å¯¹è±¡æ“ä½œ"></a><code>è¡¨å•å¯¹è±¡æ“ä½œ</code></h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*ç›‘å¬è¡¨å•æäº¤*/</span></span><br><span class="line">      form.on(<span class="string">'submit(demo1)'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{</span><br><span class="line">          <span class="built_in">console</span>.log(data.elem) <span class="comment">//è¢«æ‰§è¡Œäº‹ä»¶çš„å…ƒç´ DOMå¯¹è±¡ï¼Œä¸€èˆ¬ä¸ºbuttonå¯¹è±¡</span></span><br><span class="line">          <span class="built_in">console</span>.log(data.form) <span class="comment">//è¢«æ‰§è¡Œæäº¤çš„formå¯¹è±¡ï¼Œä¸€èˆ¬åœ¨å­˜åœ¨formæ ‡ç­¾æ—¶æ‰ä¼šè¿”å›</span></span><br><span class="line">          <span class="built_in">console</span>.log(data.field) <span class="comment">//å½“å‰å®¹å™¨çš„å…¨éƒ¨è¡¨å•å­—æ®µï¼Œåå€¼å¯¹å½¢å¼ï¼š{name: value}</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨ajaxæäº¤</span></span><br><span class="line">          <span class="comment">// $.post({})</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//å–æ¶ˆè¡¨å•é»˜è®¤æäº¤è¡Œä¸ºã€‚</span></span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="layerå¼¹å‡ºå±‚ï¼ˆé‡ç‚¹ï¼‰"><a href="#layerå¼¹å‡ºå±‚ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="layerå¼¹å‡ºå±‚ï¼ˆé‡ç‚¹ï¼‰"></a><code>layerå¼¹å‡ºå±‚ï¼ˆé‡ç‚¹ï¼‰</code></h3><h4 id="layer-alert-å¼¹å‡ºå±‚"><a href="#layer-alert-å¼¹å‡ºå±‚" class="headerlink" title="layer.alert():å¼¹å‡ºå±‚"></a><code>layer.alert()</code>:å¼¹å‡ºå±‚</h4><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*layer.alert()*/</span></span><br><span class="line">      $(<span class="string">"#btn1"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">          <span class="comment">//å„ç§å›¾æ ‡çš„å«ä¹‰</span></span><br><span class="line">          layer.alert(<span class="string">"ä¿®æ”¹æˆåŠŸ"</span>, {<span class="attr">icon</span>: <span class="number">1</span>});</span><br><span class="line">          layer.alert(<span class="string">"ä¿®æ”¹å¤±è´¥"</span>,{<span class="attr">icon</span>:<span class="number">2</span>});</span><br><span class="line">          layer.alert(<span class="string">"ç¡®å®šåˆ é™¤"</span>,{<span class="attr">icon</span>:<span class="number">3</span>});</span><br><span class="line">          layer.alert(<span class="string">"é”å®šæˆåŠŸ"</span>,{<span class="attr">icon</span>:<span class="number">4</span>});</span><br><span class="line">          layer.alert(<span class="string">"å“­è„¸"</span>,{<span class="attr">icon</span>:<span class="number">5</span>});</span><br><span class="line">          layer.alert(<span class="string">"ç¬‘è„¸"</span>,{<span class="attr">icon</span>:<span class="number">6</span>});</span><br><span class="line">          layer.alert(<span class="string">"æ„Ÿå¹å·"</span>,{<span class="attr">icon</span>:<span class="number">7</span>});</span><br><span class="line"></span><br><span class="line">          <span class="comment">//ä¹Ÿå¯ä»¥æœ‰å›è°ƒå‡½æ•°index:æ˜¯è¿™ä¸ªå¼¹å‡ºå±‚çš„ç´¢å¼•</span></span><br><span class="line">          layer.alert(<span class="string">"è·³è½¬æˆåŠŸ"</span>, {<span class="attr">icon</span>: <span class="number">1</span>}, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>{</span><br><span class="line">              alert(<span class="string">"OK"</span>);</span><br><span class="line">              layer.close(index);</span><br><span class="line">          })</span><br><span class="line">      })</span><br></pre></td></tr></tbody></table></figure>
<h4 id="layer-confirm-ï¼šè¯¢é—®å±‚"><a href="#layer-confirm-ï¼šè¯¢é—®å±‚" class="headerlink" title="layer.confirm()ï¼šè¯¢é—®å±‚"></a><code>layer.confirm()</code>ï¼šè¯¢é—®å±‚</h4><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*layer.confirm():å¸¸ç”¨äºåˆ é™¤è¯¢é—®æ“ä½œ*/</span></span><br><span class="line">     $(<span class="string">"#btn2"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">         layer.confirm(<span class="string">"ç¡®å®šåˆ é™¤ï¼Ÿ"</span>, {<span class="attr">icon</span>: <span class="number">3</span>, <span class="attr">title</span>: <span class="string">"æç¤º"</span>}, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>{</span><br><span class="line">             layer.alert(<span class="string">"åˆ é™¤æˆåŠŸ"</span>, {<span class="attr">icon</span>: <span class="number">1</span>});</span><br><span class="line">             layer.close(index);</span><br><span class="line">         })</span><br><span class="line">     })</span><br></pre></td></tr></tbody></table></figure>
<h4 id="layer-prompt-è¾“å…¥å±‚"><a href="#layer-prompt-è¾“å…¥å±‚" class="headerlink" title="layer.prompt():è¾“å…¥å±‚"></a><code>layer.prompt()</code>:è¾“å…¥å±‚</h4><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//formType: 1, //è¾“å…¥æ¡†ç±»å‹ï¼Œæ”¯æŒ0ï¼ˆæ–‡æœ¬ï¼‰é»˜è®¤1ï¼ˆå¯†ç ï¼‰2ï¼ˆå¤šè¡Œæ–‡æœ¬ï¼‰</span></span><br><span class="line"><span class="comment">//value: '', //åˆå§‹æ—¶çš„å€¼ï¼Œé»˜è®¤ç©ºå­—ç¬¦</span></span><br><span class="line"><span class="comment">//maxlength: 140, //å¯è¾“å…¥æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤500</span></span><br><span class="line"></span><br><span class="line">      $(<span class="string">"#btn3"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">          layer.prompt({</span><br><span class="line">              formType: <span class="number">2</span>,</span><br><span class="line">              value: <span class="string">'æ–‡æœ¬åˆå§‹å€¼'</span>,</span><br><span class="line">              title: <span class="string">'è¯·è¾“å…¥ä¿¡æ¯...'</span>,</span><br><span class="line">              area: [<span class="string">'800px'</span>, <span class="string">'350px'</span>] <span class="comment">//è‡ªå®šä¹‰æ–‡æœ¬åŸŸå®½é«˜</span></span><br><span class="line">          },<span class="function"><span class="keyword">function</span> (<span class="params">value, index, elem</span>) </span>{</span><br><span class="line">              alert(value);</span><br><span class="line">              layer.close(index);</span><br><span class="line">          })</span><br><span class="line">      })</span><br></pre></td></tr></tbody></table></figure>
<h4 id="layer-msg-æ¶ˆæ¯æç¤º"><a href="#layer-msg-æ¶ˆæ¯æç¤º" class="headerlink" title="layer.msg():æ¶ˆæ¯æç¤º"></a><code>layer.msg()</code>:æ¶ˆæ¯æç¤º</h4><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">$(<span class="string">"#btn5"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">//é»˜è®¤3ç§’è‡ªåŠ¨å…³é—­</span></span><br><span class="line">    layer.msg(<span class="string">"Hello"</span>, {<span class="attr">icon</span>: <span class="number">6</span>}, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        layer.alert(<span class="string">"yes"</span>);</span><br><span class="line">    })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h4 id="layer-tips-å¸é™„å±‚"><a href="#layer-tips-å¸é™„å±‚" class="headerlink" title="layer.tips():å¸é™„å±‚"></a><code>layer.tips()</code>:å¸é™„å±‚</h4><p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200507213634619.png" alt="æ•ˆæœ"></p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">$(<span class="string">"#btn6"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">//å¿…é¡»æŒ‡å®šåœ¨é‚£ä¸ªæŒ‰é’®å¸é™„</span></span><br><span class="line">    layer.tips(<span class="string">'æç¤º'</span>, <span class="string">"#btn6"</span>, {</span><br><span class="line">        <span class="comment">//1:ä¸Šï¼›2:å³ï¼›3:ä¸‹ï¼›4:å·¦</span></span><br><span class="line">        tips: <span class="number">2</span></span><br><span class="line">    })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h4 id="layer-openï¼šåŸç”Ÿå¼¹å‡ºå±‚"><a href="#layer-openï¼šåŸç”Ÿå¼¹å‡ºå±‚" class="headerlink" title="layer.openï¼šåŸç”Ÿå¼¹å‡ºå±‚"></a><code>layer.open</code>ï¼šåŸç”Ÿå¼¹å‡ºå±‚</h4><h5 id="type-0æƒ…å†µ"><a href="#type-0æƒ…å†µ" class="headerlink" title="type=0æƒ…å†µ"></a>type=0æƒ…å†µ</h5><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*åŸç”Ÿå¼¹å‡ºæ–¹å¼ï¼šé€šè¿‡é…ç½®å‚æ•°å®ç°æ•ˆæœï¼Œå…¶ä»–çš„å¼¹å‡ºå±‚ä¹Ÿéƒ½æ˜¯åŸºäºæ­¤å°è£…çš„*/</span></span><br><span class="line">       $(<span class="string">"#button1"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">           <span class="keyword">let</span> openIndex = layer.open({</span><br><span class="line">               type: <span class="number">0</span>,   <span class="comment">//è®¾ç½®å¼¹å‡ºç±»å‹ï¼šé»˜è®¤ä¸º0ï¼Œ1ï¼šé¡µé¢å±‚ï¼Œ2ï¼šiframeå±‚</span></span><br><span class="line">               title: <span class="string">'æç¤º'</span>, <span class="comment">//æ ‡é¢˜</span></span><br><span class="line">               content: <span class="string">'è·³è½¬æˆåŠŸ'</span>, <span class="comment">//å†…å®¹</span></span><br><span class="line">               skin: <span class="string">'layui-layer-lan'</span>, <span class="comment">//çš®è‚¤ï¼ˆé»˜è®¤æœ€å¥½çœ‹ï¼‰</span></span><br><span class="line">               area: [<span class="string">'300px'</span>, <span class="string">'200px'</span>], <span class="comment">//å®½é«˜</span></span><br><span class="line">               offset: <span class="string">'auto'</span>, <span class="comment">//å¼¹å‡ºä½ç½®ï¼Œé»˜è®¤å±…ä¸­</span></span><br><span class="line">               icon: <span class="number">1</span>, <span class="comment">//åªå¯¹type=0æœ‰æ•ˆ</span></span><br><span class="line">               btn: [<span class="string">'æ·»åŠ '</span>, <span class="string">'ä¿®æ”¹'</span>],  <span class="comment">//å¯ä»¥æ·»åŠ æ— é™å¤šä¸ªæŒ‰é’®</span></span><br><span class="line">               yes: <span class="function"><span class="keyword">function</span> (<span class="params">index, layero</span>) </span>{  <span class="comment">//æŒ‰é’®1çš„å›è°ƒæ˜¯yesï¼Œè€Œä»æŒ‰é’®2å¼€å§‹ï¼Œåˆ™å›è°ƒä¸ºbtn2: function(){}ï¼Œä»¥æ­¤ç±»æ¨</span></span><br><span class="line">                   alert(layero + <span class="string">"æŒ‰é’®1å›è°ƒ"</span>);</span><br><span class="line">                   layer.close(index)</span><br><span class="line">               },</span><br><span class="line">               btn2: <span class="function"><span class="keyword">function</span> (<span class="params">index, layero</span>) </span>{</span><br><span class="line">                   alert(layero + <span class="string">"æŒ‰é’®2å›è°ƒ"</span>);</span><br><span class="line">                   layer.close(index);</span><br><span class="line">               },</span><br><span class="line">               cancel: <span class="function"><span class="keyword">function</span> (<span class="params">index, layero</span>) </span>{</span><br><span class="line">                   alert(index + <span class="string">"å…³é—­æ—¶å›è°ƒ"</span>);</span><br><span class="line">               },</span><br><span class="line">               closeBtn: <span class="number">2</span>,  <span class="comment">//å³ä¸Šè§’å…³é—­æŒ‰é’®çš„æ ·å¼ï¼Œé»˜è®¤æ˜¯1</span></span><br><span class="line">               time: <span class="number">10000</span>,  <span class="comment">//è®¾ç½®å¤šå°‘æ¯«ç§’å…³é—­</span></span><br><span class="line">               anim: <span class="number">1</span>,  <span class="comment">//å¼¹çª—çš„å‡ºåœºåŠ¨ç”»ï¼Œå…±0-6ç§ï¼Œé»˜è®¤æ–¹å¼0</span></span><br><span class="line"></span><br><span class="line">               maxmin: <span class="literal">true</span>,  <span class="comment">//æ˜¯å¦è®¾ç½®å³ä¸Šè§’æœ€å¤§åŒ–ï¼Œæœ€å°åŒ–æŒ‰é’®ï¼Œåªå¯¹ç±»å‹1ï¼Œ2æœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">               success: <span class="function"><span class="keyword">function</span> (<span class="params">layero, index</span>) </span>{</span><br><span class="line">                   <span class="built_in">console</span>.log(index + <span class="string">"å¼¹å‡ºåå›è°ƒ"</span>);</span><br><span class="line">               },</span><br><span class="line">           });</span><br><span class="line">           <span class="built_in">console</span>.log(openIndex);</span><br><span class="line">       })</span><br></pre></td></tr></tbody></table></figure>
<h5 id="type-1æƒ…å†µ"><a href="#type-1æƒ…å†µ" class="headerlink" title="type=1æƒ…å†µ"></a>type=1æƒ…å†µ</h5><blockquote>
<p>åŒºåˆ«ï¼šcontent: $(â€œ#myDivâ€), //å†…å®¹å¯ä»¥æ˜¯é¡µé¢ä¸­çš„ä¸€æ®µhtmlä»£ç ï¼Œ</p>
<div id="myDivâ€>å¡«å……çš„å†…å®¹â€¦</div>

</blockquote>
<figure class=" highlight="" js"=""><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*åŸç”Ÿå¼¹å‡ºæ–¹å¼ï¼šé€šè¿‡é…ç½®å‚æ•°å®ç°æ•ˆæœï¼Œå…¶ä»–çš„å¼¹å‡ºå±‚ä¹Ÿéƒ½æ˜¯åŸºäºæ­¤å°è£…çš„*/</span></span><br><span class="line">        $(<span class="string">"#button1"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">let</span> openIndex = layer.open({</span><br><span class="line">                type: <span class="number">1</span>,   <span class="comment">//è®¾ç½®å¼¹å‡ºç±»å‹ï¼šé»˜è®¤ä¸º0ï¼Œ1ï¼šé¡µé¢å±‚ï¼Œ2ï¼šiframeå±‚</span></span><br><span class="line">                title: <span class="string">'æç¤º'</span>, <span class="comment">//æ ‡é¢˜</span></span><br><span class="line">                content: $(<span class="string">"#myDiv"</span>), <span class="comment">//å†…å®¹å¯ä»¥æ˜¯éƒ¨åˆ†é¡µé¢</span></span><br><span class="line">                closeBtn: <span class="number">2</span>,  <span class="comment">//å³ä¸Šè§’å…³é—­æŒ‰é’®çš„æ ·å¼ï¼Œé»˜è®¤æ˜¯1</span></span><br><span class="line">                time: <span class="number">10000</span>,  <span class="comment">//è®¾ç½®å¤šå°‘æ¯«ç§’å…³é—­</span></span><br><span class="line">                anim: <span class="number">1</span>,  <span class="comment">//å¼¹çª—çš„å‡ºåœºåŠ¨ç”»ï¼Œå…±0-6ç§ï¼Œé»˜è®¤æ–¹å¼0</span></span><br><span class="line">                maxmin: <span class="literal">true</span>,  <span class="comment">//æ˜¯å¦è®¾ç½®å³ä¸Šè§’æœ€å¤§åŒ–ï¼Œæœ€å°åŒ–æŒ‰é’®ï¼Œåªå¯¹ç±»å‹1ï¼Œ2æœ‰æ•ˆ                </span></span><br><span class="line">            });</span><br><span class="line">        })</span><br><span class="line"></span><br></pre></td></tr></tbody></table>
<h5 id="type-2æƒ…å†µï¼ˆå¸¸ç”¨ï¼‰"><a href="#type-2æƒ…å†µï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="type=2æƒ…å†µï¼ˆå¸¸ç”¨ï¼‰"></a>type=2æƒ…å†µï¼ˆå¸¸ç”¨ï¼‰</h5><blockquote>
<p>content: â€˜<a href="http://localhost:8080/simple.jsp">http://localhost:8080/simple.jsp</a>â€˜, //å†…å®¹ä»£è¡¨url</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*åŸç”Ÿå¼¹å‡ºæ–¹å¼ï¼šé€šè¿‡é…ç½®å‚æ•°å®ç°æ•ˆæœï¼Œå…¶ä»–çš„å¼¹å‡ºå±‚ä¹Ÿéƒ½æ˜¯åŸºäºæ­¤å°è£…çš„*/</span></span><br><span class="line">        $(<span class="string">"#button1"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">let</span> openIndex = layer.open({</span><br><span class="line">                type: <span class="number">2</span>,   <span class="comment">//è®¾ç½®å¼¹å‡ºç±»å‹ï¼šé»˜è®¤ä¸º0ï¼Œ1ï¼šé¡µé¢å±‚ï¼Œ2ï¼šiframeå±‚</span></span><br><span class="line">                title: <span class="string">'æç¤º'</span>, <span class="comment">//æ ‡é¢˜</span></span><br><span class="line">                content: <span class="string">'http://localhost:8080/simple.jsp'</span>, <span class="comment">//å†…å®¹ä»£è¡¨url</span></span><br><span class="line">                skin: <span class="string">'layui-layer-lan'</span>, <span class="comment">//çš®è‚¤ï¼ˆé»˜è®¤æœ€å¥½çœ‹ï¼‰</span></span><br><span class="line">                area: [<span class="string">'300px'</span>, <span class="string">'200px'</span>], <span class="comment">//å®½é«˜</span></span><br><span class="line">                offset: <span class="string">'auto'</span>, <span class="comment">//å¼¹å‡ºä½ç½®ï¼Œé»˜è®¤å±…ä¸­</span></span><br><span class="line">                closeBtn: <span class="number">2</span>,  <span class="comment">//å³ä¸Šè§’å…³é—­æŒ‰é’®çš„æ ·å¼ï¼Œé»˜è®¤æ˜¯1</span></span><br><span class="line">                time: <span class="number">10000</span>,  <span class="comment">//è®¾ç½®å¤šå°‘æ¯«ç§’å…³é—­</span></span><br><span class="line">                anim: <span class="number">1</span>,  <span class="comment">//å¼¹çª—çš„å‡ºåœºåŠ¨ç”»ï¼Œå…±0-6ç§ï¼Œé»˜è®¤æ–¹å¼0</span></span><br><span class="line">                maxmin: <span class="literal">true</span>,  <span class="comment">//æ˜¯å¦è®¾ç½®å³ä¸Šè§’æœ€å¤§åŒ–ï¼Œæœ€å°åŒ–æŒ‰é’®ï¼Œåªå¯¹ç±»å‹1ï¼Œ2æœ‰æ•ˆ   </span></span><br><span class="line">            });</span><br><span class="line">        })</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ•°æ®è¡¨æ ¼"><a href="#æ•°æ®è¡¨æ ¼" class="headerlink" title="æ•°æ®è¡¨æ ¼"></a><code>æ•°æ®è¡¨æ ¼</code></h3><h4 id="tableåŸºæœ¬æ­å»º"><a href="#tableåŸºæœ¬æ­å»º" class="headerlink" title="tableåŸºæœ¬æ­å»º"></a>tableåŸºæœ¬æ­å»º</h4><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è¢«åº”ç”¨çš„ä¸Šæ–¹å·¥å…·æ æŒ‰é’®</span></span><br><span class="line">&lt;div style=<span class="string">"display: none"</span> id=<span class="string">"btnTools"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-btn-group"</span>&gt;</span><br><span class="line">        &lt;button class="layui-btn layui-btn-sm layui-btn-normal"&gt;æ·»åŠ &lt;/button&gt;</span><br><span class="line">        &lt;button class="layui-btn layui-btn-sm layui-btn-warm"&gt;ç¼–è¾‘&lt;/button&gt;</span><br><span class="line">        &lt;button class="layui-btn layui-btn-sm layui-btn-danger"&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¢«å¼•ç”¨çš„å³ä¾§å·¥å…·æ æŒ‰é’®</span></span><br><span class="line">&lt;script type=<span class="string">"text/html"</span> id=<span class="string">"barDemo"</span>&gt;</span><br><span class="line">    &lt;a class="layui-btn layui-btn-xs" lay-event="edit"&gt;ç¼–è¾‘&lt;/a&gt;</span><br><span class="line">    &lt;a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"&gt;åˆ é™¤&lt;/a&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"layui-hide"</span> id=<span class="string">"tableId"</span> lay-filter=<span class="string">"tableFilter"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    layui.use([<span class="string">'form'</span>, <span class="string">'element'</span>, <span class="string">'jquery'</span>, <span class="string">'layedit'</span>, <span class="string">'layer'</span>, <span class="string">'table'</span>], function () {</span><br><span class="line">        let form = layui.form;</span><br><span class="line">        let element = layui.element;</span><br><span class="line">        let $ = layui.jquery;</span><br><span class="line">        let layedit = layui.layedit;</span><br><span class="line">        let layer = layui.layer;</span><br><span class="line">        let table = layui.table;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*è¡¨æ ¼æ¸²æŸ“çš„åŸºæœ¬å‚æ•°åŠå«ä¹‰*/</span></span><br><span class="line">        table.render({</span><br><span class="line">            elem: <span class="string">'#tableId'</span>  <span class="comment">//æ¸²æŸ“çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">            , url: <span class="string">'resources/json/user.json'</span>  <span class="comment">//æ•°æ®æ¥å£çœ‹ï¼Œç”¨äºè·å–æ•°æ®</span></span><br><span class="line">            , title: <span class="string">'ç”¨æˆ·æ•°æ®è¡¨'</span>  <span class="comment">//æ•°æ®å¯¼å‡ºæ—¶çš„æ ‡é¢˜ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰</span></span><br><span class="line">            , page: <span class="keyword">true</span>  <span class="comment">//æ˜¯å¦å¼€å¯åˆ†é¡µ</span></span><br><span class="line">            , toolbar: <span class="string">'#btnTools'</span> <span class="comment">//å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰å·¥å…·æ¡</span></span><br><span class="line">            , defaultToolbar: [<span class="string">'filter'</span>, <span class="string">'print'</span>]  <span class="comment">//è‡ªç”±é…ç½®å¤´éƒ¨å·¥å…·æ å³ä¾§çš„å›¾æ ‡æŒ‰é’®</span></span><br><span class="line">            , cellMinWidth: <span class="number">90</span>   <span class="comment">//è®¾ç½®åˆ—çš„æœ€å°é»˜è®¤å®½åº¦ï¼ˆä¸€èˆ¬é»˜è®¤å³å¯ï¼‰</span></span><br><span class="line">            , done: function (res, curr, count) {   <span class="comment">//è¡¨æ ¼æ•°æ®æ¸²æŸ“å®Œæ¯•çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">                console.log(res); <span class="comment">//åå°urlè¿”å›çš„jsonæ•°æ®</span></span><br><span class="line">                console.log(curr); <span class="comment">//å½“å‰é¡µæ˜¯ç¬¬å‡ é¡µb</span></span><br><span class="line">                console.log(count); <span class="comment">//æ•°æ®æ€»æ¡æ•°</span></span><br><span class="line">            }</span><br><span class="line">            , totalRow: <span class="keyword">true</span>  <span class="comment">//å¼€å¯åˆå¹¶è¡Œ</span></span><br><span class="line">            , limit: <span class="number">20</span>  <span class="comment">//è®¾ç½®æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°ï¼Œé»˜è®¤ä¸º10</span></span><br><span class="line">            , limits: [<span class="number">20</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">80</span>, <span class="number">100</span>] <span class="comment">//</span></span><br><span class="line">            , cols: [[     <span class="comment">//å…·ä½“åˆ—æ•°æ®</span></span><br><span class="line">                {type: <span class="string">'checkbox'</span>, fixed: <span class="string">'left'</span>}  <span class="comment">//æ˜¾ç¤ºå·¦ä¾§å¤é€‰æ¡†ï¼ˆå¤šç”¨äºæ‰¹é‡å‚æ•°çš„Idç¡®å®šï¼‰</span></span><br><span class="line">                , {field: <span class="string">'id'</span>, title: <span class="string">'ID'</span>, width: <span class="number">80</span>, unresize: <span class="keyword">true</span>}</span><br><span class="line">                , {field: <span class="string">'username'</span>, title: <span class="string">'ç”¨æˆ·å'</span>, width: <span class="number">120</span>,}</span><br><span class="line">                , {</span><br><span class="line">                    field: <span class="string">'email'</span>, title: <span class="string">'é‚®ç®±'</span>, width: <span class="number">150</span>, templet: function (res) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">'&lt;em&gt;'</span> + res.email + <span class="string">'&lt;/em&gt;'</span></span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                , {</span><br><span class="line">                    field: <span class="string">'sex'</span>, title: <span class="string">'æ€§åˆ«'</span>, width: <span class="number">80</span>, align: <span class="string">'center'</span>, templet: function (row) {</span><br><span class="line">                        <span class="keyword">return</span> row.sex == <span class="string">'1'</span> ? <span class="string">'ç”·'</span> : <span class="string">'å¥³'</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                , {field: <span class="string">'city'</span>, title: <span class="string">'åŸå¸‚'</span>, width: <span class="number">100</span>}</span><br><span class="line">                , {field: <span class="string">'sign'</span>, title: <span class="string">'ç­¾å'</span>}</span><br><span class="line">                , {field: <span class="string">'experience'</span>, title: <span class="string">'ç§¯åˆ†'</span>, width: <span class="number">80</span>, totalRow: <span class="keyword">true</span>, align: <span class="string">'center'</span>}</span><br><span class="line">                , {field: <span class="string">'ip'</span>, title: <span class="string">'IP'</span>, width: <span class="number">120</span>}</span><br><span class="line">                , {field: <span class="string">'logins'</span>, title: <span class="string">'ç™»å…¥æ¬¡æ•°'</span>, width: <span class="number">100</span>, totalRow: <span class="keyword">true</span>}</span><br><span class="line">                , {field: <span class="string">'joinTime'</span>, title: <span class="string">'åŠ å…¥æ—¶é—´'</span>, width: <span class="number">120</span>}</span><br><span class="line">                , {field: <span class="string">"right"</span>, title: <span class="string">'æ“ä½œ'</span>, toolbar: <span class="string">"#barDemo"</span>, width: <span class="number">150</span>, align: <span class="string">'center'</span>}</span><br><span class="line">            ]]</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="tableäº‹ä»¶ç›‘å¬"><a href="#tableäº‹ä»¶ç›‘å¬" class="headerlink" title="tableäº‹ä»¶ç›‘å¬"></a>tableäº‹ä»¶ç›‘å¬</h4><p>ç›‘å¬å¤´éƒ¨å·¥å…·æ ï¼ˆ<code>toolbar</code>ï¼‰</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200508105237057.png" alt="image-20200508105237057"></p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›‘å¬å¤´å·¥å…·æ äº‹ä»¶</span></span><br><span class="line">      table.on(<span class="string">'toolbar(tableFilter)'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>{</span><br><span class="line">          <span class="keyword">switch</span> (obj.event) {</span><br><span class="line">              <span class="keyword">case</span> <span class="string">'add'</span>:</span><br><span class="line">                  layer.msg(<span class="string">'æ·»åŠ '</span>, {<span class="attr">icon</span>: <span class="number">1</span>});</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">'batchDelete'</span>:</span><br><span class="line">                  layer.msg(<span class="string">'æ‰¹é‡åˆ é™¤'</span>, {<span class="attr">icon</span>: <span class="number">5</span>});</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">      });</span><br></pre></td></tr></tbody></table></figure>
<p>ç›‘å¬å¤é€‰æ¡†äº‹ä»¶ï¼ˆ<code>checkbox</code>ï¼‰:ä¸»è¦ç”¨äºæ‰¹é‡åˆ é™¤</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›‘å¬å¤é€‰æ¡†äº‹ä»¶</span></span><br><span class="line">      table.on(<span class="string">'checkbox(tableFilter)'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>{</span><br><span class="line">          <span class="built_in">console</span>.log(obj.checked); <span class="comment">//å½“å‰æ˜¯å¦é€‰ä¸­çŠ¶æ€</span></span><br><span class="line">          <span class="built_in">console</span>.log(obj.data); <span class="comment">//é€‰ä¸­è¡Œçš„ç›¸å…³æ•°æ®</span></span><br><span class="line">          <span class="built_in">console</span>.log(obj.type); <span class="comment">//å¦‚æœè§¦å‘çš„æ˜¯å…¨é€‰ï¼Œåˆ™ä¸ºï¼šallï¼Œå¦‚æœè§¦å‘çš„æ˜¯å•é€‰ï¼Œåˆ™ä¸ºï¼šone</span></span><br><span class="line">      });</span><br></pre></td></tr></tbody></table></figure>
<p>ç›‘å¬è¡Œå·¥å…·äº‹ä»¶ï¼ˆ<code>tool</code>ï¼‰</p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200508111024139.png" alt="image-20200508111024139"></p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›‘å¬è¡Œå·¥å…·äº‹ä»¶</span></span><br><span class="line">     table.on(<span class="string">'tool(tableFilter)'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>{</span><br><span class="line">         <span class="keyword">let</span> data = obj.data; <span class="comment">//è·å¾—å½“å‰è¡Œæ•°æ®</span></span><br><span class="line">         <span class="keyword">let</span> layEvent = obj.event; <span class="comment">//è·å¾— lay-event å¯¹åº”çš„å€¼</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (layEvent === <span class="string">'edit'</span>) {</span><br><span class="line">             layer.alert(<span class="string">"è·³è½¬æˆåŠŸ"</span>, {<span class="attr">icon</span>: <span class="number">1</span>}, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>{</span><br><span class="line">                 layer.close(index);</span><br><span class="line">                 <span class="comment">//è·³è½¬ç¼–è¾‘é¡µé¢</span></span><br><span class="line">             })</span><br><span class="line">         }</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (layEvent === <span class="string">'del'</span>) {</span><br><span class="line">             layer.confirm(<span class="string">"ç¡®å®šåˆ é™¤ï¼Ÿ"</span>, {<span class="attr">icon</span>: <span class="number">3</span>}, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>{</span><br><span class="line">                 layer.close(index);</span><br><span class="line">                 <span class="comment">//å‘æœåŠ¡å™¨å‘é€ç›¸å…³è¯·æ±‚å’Œæ•°æ®</span></span><br><span class="line">             })</span><br><span class="line">         }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a><code>æ–‡ä»¶ä¸Šä¼ </code></h3><p>ä¸»è¦æ˜¯åˆ©ç”¨uploadæ¨¡å—ï¼Œå®˜ç½‘è‡ªè¡ŒæŸ¥çœ‹ã€‚ã€‚ã€‚</p>
<h3 id="ç¬¬ä¸‰æ–¹æ‰©å±•æ’ä»¶dtree"><a href="#ç¬¬ä¸‰æ–¹æ‰©å±•æ’ä»¶dtree" class="headerlink" title="ç¬¬ä¸‰æ–¹æ‰©å±•æ’ä»¶dtree"></a>ç¬¬ä¸‰æ–¹æ‰©å±•æ’ä»¶<code>dtree</code></h3><h4 id="åŸºæœ¬ä½¿ç”¨-å› ä¸ºæ˜¯ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ‰€ä»¥è¦å¼•å…¥äººå®¶çš„æ ·å¼èµ„æº"><a href="#åŸºæœ¬ä½¿ç”¨-å› ä¸ºæ˜¯ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ‰€ä»¥è¦å¼•å…¥äººå®¶çš„æ ·å¼èµ„æº" class="headerlink" title="åŸºæœ¬ä½¿ç”¨:å› ä¸ºæ˜¯ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ‰€ä»¥è¦å¼•å…¥äººå®¶çš„æ ·å¼èµ„æº"></a>åŸºæœ¬ä½¿ç”¨:å› ä¸ºæ˜¯ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ‰€ä»¥è¦å¼•å…¥äººå®¶çš„æ ·å¼èµ„æº</h4><p>å…·ä½“ç›‘å¬æ–¹æ³•å’Œå…¶ä»–è·å–å€¼çš„æ–¹æ³•å»æ–‡æ¡£æŸ¥çœ‹</p>
<blockquote>
<p><a href="http://www.wisdomelon.com/DTreeHelper/">http://www.wisdomelon.com/DTreeHelper/</a></p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"> &lt;!--dtreeæ ‘å½¢ç»„ä»¶--&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"resources/layui_ext/dtree/dtree.css"</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"resources/layui_ext/dtree/font/dtreefont.css"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--æ ‘å½¢ç»„ä»¶--&gt;</span><br><span class="line">&lt;ul id=<span class="string">"demoTree"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"dtree"</span> data-id=<span class="string">"0"</span>&gt;&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">"resources/layui/layui.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    layui.extend({</span><br><span class="line">        dtree: <span class="string">'resources/layui_ext/dist/dtree'</span>  <span class="comment">//å¼•å…¥dtree.jså¹¶è¿›è¡Œå¼•ç”¨ï¼ˆä¸éœ€è¦å¸¦åç¼€ï¼‰</span></span><br><span class="line">    }).use([<span class="string">'form'</span>, <span class="string">'element'</span>, <span class="string">'jquery'</span>, <span class="string">'layer'</span>, <span class="string">'dtree'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">let</span> form = layui.form;</span><br><span class="line">        <span class="keyword">let</span> element = layui.element;</span><br><span class="line">        <span class="keyword">let</span> $ = layui.jquery;</span><br><span class="line">        <span class="keyword">let</span> layer = layui.layer;</span><br><span class="line">        <span class="keyword">let</span> dtree = layui.dtree;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> DemoTree = dtree.render({</span><br><span class="line">            elem: <span class="string">"#demoTree"</span>,</span><br><span class="line">            url: <span class="string">"resources/json/asyncTree1.json"</span> <span class="comment">// ä½¿ç”¨urlåŠ è½½jsonæ•°æ®ï¼Œä¸€èˆ¬æ˜¯ä»æœåŠ¡å™¨è·å–ï¼ˆå¯ä¸dataåŠ è½½åŒæ—¶å­˜åœ¨ï¼‰</span></span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="DockeråŸºç¡€"><a href="#DockeråŸºç¡€" class="headerlink" title="DockeråŸºç¡€"></a>DockeråŸºç¡€</h2><h3 id="DockeråŸºæœ¬æ“ä½œå‘½ä»¤"><a href="#DockeråŸºæœ¬æ“ä½œå‘½ä»¤" class="headerlink" title="DockeråŸºæœ¬æ“ä½œå‘½ä»¤"></a>DockeråŸºæœ¬æ“ä½œå‘½ä»¤</h3><h4 id="cmderè¿œç¨‹è¿æ¥"><a href="#cmderè¿œç¨‹è¿æ¥" class="headerlink" title="cmderè¿œç¨‹è¿æ¥"></a>cmderè¿œç¨‹è¿æ¥</h4><blockquote>
<p>cmderè¿œç¨‹è¿æ¥æœåŠ¡å™¨ï¼šssh &lt;username&gt;@<ipåœ°å€>ï¼Œç„¶åæŒ‰è¦æ±‚è¾“å…¥å¯†ç å³å¯</ipåœ°å€></p>
<p>ä¾‹å¦‚ï¼š<code>ssh root@192.168.149.131</code></p>
</blockquote>
<h4 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker version  #æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">docker info     #æ˜¾ç¤ºdockerçš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">docker --help #æŸ¥è¯¢dockeræ‰€æœ‰å‘½ä»¤</span><br></pre></td></tr></tbody></table></figure>
<h4 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h4><p><code>docker images</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker images  #åˆ—å‡ºæ‰€æœ‰é•œåƒ</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/redis      latest              44d36d2c2374        3 months ago        98.2 MB</span><br><span class="line">docker.io/rabbitmq   3-management        6a98e7057e36        3 months ago        181 MB</span><br><span class="line">docker.io/mysql      5.7                 db39680b63ac        4 months ago        437 MB</span><br><span class="line">[root@centos7-mabin ~]# docker images -aq  #ç»„åˆå‚æ•°ï¼šåˆ—å‡ºæ‰€æœ‰é•œåƒçš„ID</span><br><span class="line">44d36d2c2374</span><br><span class="line">6a98e7057e36</span><br><span class="line">db39680b63ac</span><br></pre></td></tr></tbody></table></figure>
<p><code>docker search</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker search mysql    #æœç´¢æŒ‡å®šé•œåƒ</span><br><span class="line">INDEX       NAME                                        DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">docker.io   docker.io/mysql                             MySQL is a widely used, open-source relati...   9504      [OK]       </span><br><span class="line">docker.io   docker.io/mariadb                           MariaDB is a community-developed fork of M...   3446      [OK]       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7-mabin ~]# docker search mysql --filter=STARS=5000  #è¿‡æ»¤æ”¶è—æ•°å¤§äº5000çš„mysqlé•œåƒ</span><br><span class="line">INDEX       NAME              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">docker.io   docker.io/mysql   MySQL is a widely used, open-source relati...   9504      [OK]       </span><br></pre></td></tr></tbody></table></figure>
<p><code>docker pull</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker pull mysql:5.7  #æŒ‡å®šç‰ˆæœ¬æ‹‰å–é•œåƒï¼ˆå¦‚æœä¸æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆçš„é•œåƒï¼‰</span><br></pre></td></tr></tbody></table></figure>
<p><code>docker rmi</code>å’Œ<code>docker rm</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">å¦‚æœæ‹‰å–çš„é•œåƒå·²ç»è¿è¡Œè¿‡äº†ï¼Œé‚£ä¹ˆåˆ é™¤æ—¶ï¼Œå°±è¦å…ˆåˆ é™¤è¿è¡Œå½¢æˆçš„å®¹å™¨ï¼Œç„¶åæ‰èƒ½åˆ é™¤é•œåƒ</span><br><span class="line">[root@centos7-mabin ~]# docker rm -f 184ef6d36701     #å¼ºåˆ¶åˆ é™¤å®¹å™¨</span><br><span class="line"></span><br><span class="line">[root@centos7-mabin ~]# docker rmi -f 184ef6d36722  #å¼ºåˆ¶åˆ é™¤é•œåƒ</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ‰¹é‡åˆ é™¤é•œåƒéªšæ“ä½œ</span></span><br><span class="line">[root@centos7-mabin ~]# docker rmi -f $(docker images -aq)  # $(æŸ¥è¯¢å‡ºæ‰€æœ‰é•œåƒçš„ID)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h4><p><code>docker run</code>:å®¹å™¨è¿è¡Œ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker run [å¯é€‰å‚æ•°] imageID</span><br><span class="line"></span><br><span class="line">docker run -d --name horse-rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.8.14-management</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¸¸ç”¨å‚æ•°è¯´æ˜</span></span><br><span class="line">--name="å®¹å™¨åå­—"  #è®¾ç½®å¯åŠ¨å®¹å™¨çš„åå­—ï¼Œä¾‹å¦‚ï¼štomcat01,tomcat02...ï¼Œç”¨æ¥åŒºåˆ«å®¹å™¨</span><br><span class="line">-d  #åå°æ–¹å¼è¿è¡Œ</span><br><span class="line">-it #ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œå¹¶è¿›è¡Œå®¹å™¨è¿›è¡Œäº¤äº’æŸ¥çœ‹ä¿¡æ¯</span><br><span class="line">-p  #ç«¯å£æ˜ å°„ï¼Œä¸‹é¢æ˜¯å‡ ç§ä¸åŒçš„æ˜ å°„ä¹¦å†™æ–¹å¼ï¼ˆæŒ‡å®šå®¹å™¨çš„æ˜ å°„ç«¯å£ï¼‰</span><br><span class="line">	1.ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</span><br><span class="line">	2.ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">	3.å®¹å™¨ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æµ‹è¯•ï¼šå¯åŠ¨centosé•œåƒï¼Œå¹¶è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@centos7-mabin ~]# docker run -it 470671670cac /bin/bash</span><br><span class="line">[root@0e4c0367ab83 /]# ls   #æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„centosï¼Œå’Œå¤–é¢çš„linuxç³»ç»Ÿæ²¡æœ‰ä»»ä½•å…³ç³»</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">é€€å‡ºå®¹å™¨</span></span><br><span class="line">[root@0e4c0367ab83 /]# exit  #é€€å‡ºå®¹å™¨ï¼Œå®¹å™¨åœæ­¢</span><br><span class="line">					 #ctrl+p+q  :é€€å‡ºå®¹å™¨ï¼Œå®¹å™¨ä¸åœæ­¢</span><br></pre></td></tr></tbody></table></figure>
<p><code>docker ps</code>ï¼šå®¹å™¨ç®¡ç†</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker ps [å‘½ä»¤å‚æ•°]</span></span><br><span class="line">	-a:åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨å’Œå·²ç»è¿è¡Œè¿‡çš„å®¹å™¨</span><br><span class="line">	-n=?:æ˜¾ç¤ºå‡ ä¸ªæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ï¼ˆä»¥åˆ›å»ºæ—¶é—´å€’åºï¼‰</span><br><span class="line">	-q:åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·ID</span><br><span class="line"><span class="meta">#</span><span class="bash">å‘½ä»¤æµ‹è¯•</span></span><br><span class="line">[root@centos7-mabin ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@centos7-mabin ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES</span><br><span class="line">0e4c0367ab83        470671670cac        "/bin/bash"              9 minutes ago       Exited (127) 53 seconds ago                       sleepy_euler</span><br><span class="line">184ef6d36701        6a98e7057e36        "docker-entrypoint..."   3 months ago        Exited (0) 5 weeks ago                            myrabbitmq</span><br><span class="line">2437f68c42ef        docker.io/redis     "docker-entrypoint..."   3 months ago        Exited (0) 2 months ago                           myredis</span><br><span class="line">ae7234cc1a73        mysql:5.7           "docker-entrypoint..."   4 months ago        Exited (0) 4 days ago                             mysqlTest01</span><br><span class="line">[root@centos7-mabin ~]# docker ps -n=2</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                       PORTS               NAMES</span><br><span class="line">0e4c0367ab83        470671670cac        "/bin/bash"              13 minutes ago      Exited (127) 4 minutes ago                       sleepy_euler</span><br><span class="line">184ef6d36701        6a98e7057e36        "docker-entrypoint..."   3 months ago        Exited (0) 5 weeks ago                           myrabbitmq</span><br><span class="line">[root@centos7-mabin ~]# docker ps -n=2 -aq</span><br><span class="line">0e4c0367ab83</span><br><span class="line">184ef6d36701</span><br></pre></td></tr></tbody></table></figure>
<p><code>docker rm</code>ï¼šå®¹å™¨åˆ é™¤</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker rm å®¹å™¨id  #ç§»é™¤åªé€å®¹å™¨ï¼Œæ­£åœ¨è¿è¡Œçš„ç§»é™¤ä¸æ‰</span><br><span class="line">docker rm -f $(docker ps -aq) #å¼ºåˆ¶ç§»é™¤æ‰€æœ‰å®¹å™¨ï¼ˆå¸¸ç”¨ï¼‰</span><br><span class="line">docker ps -aq | xarqs docker rm  #ä¹Ÿå¯ä»¥ç§»é™¤æ‰€æœ‰å®¹å™¨ï¼ˆä¸å¸¸ç”¨ï¼‰</span><br></pre></td></tr></tbody></table></figure>
<p><code>å®¹å™¨å¯åŠ¨</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker start å®¹å™¨id  #å¯åŠ¨å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨id #é‡å¯å®¹å™¨</span><br><span class="line">docker stop å®¹å™¨id  #åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker kill å®¹å™¨id #å¼ºåˆ¶æ€æ­»å®¹å™¨</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¸¸ç”¨å®ä¾‹å‘½ä»¤"><a href="#å¸¸ç”¨å®ä¾‹å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å®ä¾‹å‘½ä»¤"></a>å¸¸ç”¨å®ä¾‹å‘½ä»¤</h4><p>æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker logs -tf --tail 20 2437f68c42ef</span><br><span class="line">	-tf: æ˜¾ç¤ºæ—¥å¿—</span><br><span class="line">	--tails [number]:æ˜¾ç¤ºnumberæ¡æœ€æ–°æ—¥å¿—ä¿¡æ¯</span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥çœ‹å®¹å™¨ä¸­è¿›è¡Œä¿¡æ¯</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker top 0e4c0367ab83  #æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ä¿¡æ¯ï¼ˆå¸¸ç”¨äº docker kill [PID]çš„æ€æ­»è¿›ç¨‹ï¼‰</span><br><span class="line">UID                 PID                 PPID                C                   STIME               </span><br><span class="line">root                12291               12274               0                   09:18             </span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥çœ‹å®¹å™¨çš„å…ƒæ•°æ®ï¼ˆè¶…çº§è¯¦ç»†ä¿¡æ¯ï¼‰</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin ~]# docker inspect 0e4c0367ab83  </span><br><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        "Id": "0e4c0367ab83eb2f979e1f8f14becf161d81ae5a17fe1318aabf2fffe8c88916",</span><br><span class="line">        "Created": "2020-05-17T00:40:40.162351518Z",</span><br><span class="line">        "Path": "/bin/bash",</span><br><span class="line">        "Args": [],</span><br><span class="line">        "State": {</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 12291,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2020-05-17T01:18:21.812846334Z",</span><br><span class="line">            "FinishedAt": "2020-05-17T00:48:53.872787718Z"</span><br><span class="line">        },</span><br><span class="line">        "Image": "sha256:470671670cac686c7cf0081e0b37da2e9f4f768ddc5f6a26102ccd1c6954c1ee",</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/0e4c0367ab83eb2f979e1f8f14becf161d81ae5a17fe1318aabf2fffe8c88916/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/0e4c0367ab83eb2f979e1f8f14becf161d81ae5a17fe1318aabf2fffe8c88916/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/0e4c0367ab83eb2f979e1f8f14becf161d81ae5a17fe1318aabf2fffe8c88916/hosts",</span><br><span class="line">        "LogPath": "",</span><br><span class="line">        "Name": "/sleepy_euler",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "MountLabel": "system_u:object_r:svirt_sandbox_file_t:s0:c385,c902",</span><br><span class="line">        "ProcessLabel": "system_u:system_r:svirt_lxc_net_t:s0:c385,c902",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": {</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": {</span><br><span class="line">                "Type": "journald",</span><br><span class="line">                "Config": {}</span><br><span class="line">            },</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": {},</span><br><span class="line">            "RestartPolicy": {</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            },</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "docker-runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": null,</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DiskQuota": 0,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": -1,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": 0,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0</span><br><span class="line">        },</span><br><span class="line">        "GraphDriver": {</span><br><span class="line">            "Name": "overlay2",</span><br><span class="line">            "Data": {</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/2bb04fec7fd4ae227daa977fc2602bd9091600ae502a50bf2340887cc3053688-init/diff:/var/lib/docker/overlay2/df7e7e32a5bd73cf65a5175fe19448941dc3f9909ff6a258919c07ea12f259fd/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/2bb04fec7fd4ae227daa977fc2602bd9091600ae502a50bf2340887cc3053688/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/2bb04fec7fd4ae227daa977fc2602bd9091600ae502a50bf2340887cc3053688/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/2bb04fec7fd4ae227daa977fc2602bd9091600ae502a50bf2340887cc3053688/work"</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        "Mounts": [],</span><br><span class="line">        "Config": {</span><br><span class="line">            "Hostname": "0e4c0367ab83",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": true,</span><br><span class="line">            "AttachStdout": true,</span><br><span class="line">            "AttachStderr": true,</span><br><span class="line">            "Tty": true,</span><br><span class="line">            "OpenStdin": true,</span><br><span class="line">            "StdinOnce": true,</span><br><span class="line">            "Env": [</span><br><span class="line">                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/bash"</span><br><span class="line">            ],</span><br><span class="line">            "Image": "470671670cac",</span><br><span class="line">            "Volumes": null,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": {</span><br><span class="line">                "org.label-schema.build-date": "20200114",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS",</span><br><span class="line">                "org.opencontainers.image.created": "2020-01-14 00:00:00-08:00",</span><br><span class="line">                "org.opencontainers.image.licenses": "GPL-2.0-only",</span><br><span class="line">                "org.opencontainers.image.title": "CentOS Base Image",</span><br><span class="line">                "org.opencontainers.image.vendor": "CentOS"</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        "NetworkSettings": {</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "9340199ec1197854d5306a91bfee1bf1bf62c574af92563b4216307f1a6f8c72",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": {},</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/9340199ec119",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "ef96e7ca5c54367d224b566bc03f77967f74c56104529d3caab7901330544e1d",</span><br><span class="line">            "Gateway": "172.17.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.17.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">            "Networks": {</span><br><span class="line">                "bridge": {</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "da11f83661a873c30bffbef389ae9e770b8965a0428efafce495e2407c91d313",</span><br><span class="line">                    "EndpointID": "ef96e7ca5c54367d224b566bc03f77967f74c56104529d3caab7901330544e1d",</span><br><span class="line">                    "Gateway": "172.17.0.1",</span><br><span class="line">                    "IPAddress": "172.17.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:11:00:02"</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<h4 id="è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨"><a href="#è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨" class="headerlink" title="è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨"></a>è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ–¹å¼ä¸€ï¼šè¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥å†é‡Œé¢è¿›è¡Œæ“ä½œï¼ˆæ¨èä½¿ç”¨ï¼‰</span></span><br><span class="line">[root@centos7-mabin ~]# docker exec -it 0e4c0367ab83 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ–¹å¼äºŒï¼šè¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ç»ˆç«¯</span></span><br><span class="line">[root@centos7-mabin ~]# docker attach 0e4c0367ab83</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"><a href="#ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š" class="headerlink" title="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"></a>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker cp å®¹å™¨id:æ–‡ä»¶è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æµ‹è¯•</span></span><br><span class="line">[root@0e4c0367ab83 home]# touch test.java  #è¿›å…¥å®¹å™¨æ–°å»ºæ–‡ä»¶</span><br><span class="line">[root@0e4c0367ab83 home]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@0e4c0367ab83 home]# exit  </span><br><span class="line">exit</span><br><span class="line">[root@centos7-mabin ~]# docker cp 0e4c0367ab83:/home/test.java /home  #æ‹·è´æ–‡ä»¶ï¼ˆåå‘æ‹·è´æ–‡ä»¶ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">[root@centos7-mabin ~]# cd /home</span><br><span class="line">[root@centos7-mabin home]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 root  root    44 Jul  3  2019 DataShells</span><br><span class="line">drwxr-xr-x. 2 root  root    23 Apr 11 10:29 junit</span><br><span class="line">drwx------. 5 leyou leyou  172 Apr 13 15:35 leyou</span><br><span class="line">drwx------. 2 mabin mabin   83 Jun 28  2019 mabin</span><br><span class="line">drwxr-xr-x. 3 root  root  4096 Jun 27  2019 newdisk</span><br><span class="line">drwx------. 2  1001 mabin   83 Jun 26  2019 shasha</span><br><span class="line">drwxr-xr-x. 2 root  root    76 Apr 13 19:06 test</span><br><span class="line">-rw-r--r--. 1 root  root     0 May 17 09:35 test.java   #æ–‡ä»¶æ‹·è´æˆåŠŸ</span><br></pre></td></tr></tbody></table></figure>
<h4 id="dockeréƒ¨ç½²å¸¸ç”¨ç¯å¢ƒå®ä¾‹"><a href="#dockeréƒ¨ç½²å¸¸ç”¨ç¯å¢ƒå®ä¾‹" class="headerlink" title="dockeréƒ¨ç½²å¸¸ç”¨ç¯å¢ƒå®ä¾‹"></a>dockeréƒ¨ç½²å¸¸ç”¨ç¯å¢ƒå®ä¾‹</h4><p>nginx</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin home]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">Trying to pull repository docker.io/library/nginx ... </span><br><span class="line">latest: Pulling from docker.io/library/nginx</span><br><span class="line">afb6ec6fdc1c: Pull complete </span><br><span class="line">b90c53a0b692: Pull complete </span><br><span class="line">11fa52a0fdc0: Pull complete </span><br><span class="line">Digest: sha256:30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097</span><br><span class="line">Status: Downloaded newer image for docker.io/nginx:latest</span><br><span class="line">[root@centos7-mabin home]# docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/nginx      latest              9beeba249f3e        29 hours ago        127 MB</span><br><span class="line">[root@centos7-mabin home]# docker run -d --name=nginx01 -p 10010:80 9beeba249f3e  #æ³¨æ„ç«¯å£æ˜ å°„</span><br><span class="line">7b4ff9f48ab1ed734ea451f4403fde2e3e304c4376e5d43b8c0ef372c49e1506</span><br><span class="line">[root@centos7-mabin home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES</span><br><span class="line">7b4ff9f48ab1        9beeba249f3e        "nginx -g 'daemon ..."   5 seconds ago       Up 4 seconds        0.0.0.0:10010-&gt;80/tcp   nginx01</span><br><span class="line">[root@centos7-mabin home]# curl localhost:10010 #åˆ©ç”¨curlè¯·æ±‚webæœåŠ¡å™¨ï¼Œæµ‹è¯•æ˜¯å¦å¼€å¯æˆåŠŸï¼Œç›´æ¥æµè§ˆå™¨è®¿é—®ä¹Ÿè¡Œ</span><br></pre></td></tr></tbody></table></figure>
<h4 id="docker-commité•œåƒ"><a href="#docker-commité•œåƒ" class="headerlink" title="docker commité•œåƒ"></a>docker commité•œåƒ</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker commit [...] ï¼šæäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒå‰¯æœ¬</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å’Œgitçš„æäº¤å‘½ä»¤ç±»ä¼¼</span></span><br><span class="line">docker commit -m="æäº¤çš„æè¿°ä¿¡æ¯" -a="ä½œè€…" å®¹å™¨id  ç›®æ ‡é•œåƒå:[TAG]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="dockerå®¹å™¨æ•°æ®å·-æ•°æ®åŒæ­¥æŠ€æœ¯"><a href="#dockerå®¹å™¨æ•°æ®å·-æ•°æ®åŒæ­¥æŠ€æœ¯" class="headerlink" title="dockerå®¹å™¨æ•°æ®å·(æ•°æ®åŒæ­¥æŠ€æœ¯)"></a>dockerå®¹å™¨æ•°æ®å·(æ•°æ®åŒæ­¥æŠ€æœ¯)</h3><blockquote>
<p>åŠŸèƒ½ï¼šå®¹å™¨æ•°æ®çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œï¼Œå®¹å™¨é—´ä¹Ÿå¯ä»¥æ•°æ®å…±äº«ï¼Œä¾‹å¦‚mysqlç­‰</p>
</blockquote>
<h4 id="ä½¿ç”¨æ•°æ®å·"><a href="#ä½¿ç”¨æ•°æ®å·" class="headerlink" title="ä½¿ç”¨æ•°æ®å·"></a>ä½¿ç”¨æ•°æ®å·</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤ -v [ä¸»æœºç›®å½•åœ°å€:å®¹å™¨ç›®å½•åœ°å€] æ¥è¿›è¡ŒæŒ‚è½½</span></span><br><span class="line">		--privileged=true:å®¹å™¨è¿è¡Œæ—¶ï¼Œç»™å®¹å™¨åŠ ä¸Šç‰¹æƒï¼Œä¸ç„¶æ²¡æœ‰æ“ä½œæŒ‚è½½çš„ç›®å½•çš„æƒé™</span><br><span class="line">[root@centos7-mabin test]# docker run -it -v /home/test:/home --privileged=true centos /bin/bash  </span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213142.png" alt="å®¹å™¨å¯åŠ¨æŒ‚è½½æˆåŠŸ"></p>
<p>æ•°æ®æŒä¹…åŒ–å’ŒåŒæ­¥æ•ˆæœ</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213153.png" alt="image-20200517140752038"></p>
<p>åå‘æ“ä½œä¹Ÿå¯ä»¥å®ç°æ•°æ®åŒæ­¥ï¼ˆç›¸å½“äºv-modelçš„åŒå‘ç»‘å®šæ€æƒ³ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213157.png" alt="image-20200517141025043"></p>
<blockquote>
<p>å¥½å¤„ï¼šæˆ‘ä»¬ä»¥ååªéœ€è¦ä¿®æ”¹æœ¬åœ°æ•°æ®ï¼Œå°±å¯ä»¥å®ç°å®¹å™¨æ•°æ®çš„è‡ªåŠ¨åŒæ­¥äº†</p>
</blockquote>
<h4 id="åŒ¿åæŒ‚è½½å’Œå…·åæŒ‚è½½å’ŒæŒ‡å®šè·¯å¾„æŒ‚è½½"><a href="#åŒ¿åæŒ‚è½½å’Œå…·åæŒ‚è½½å’ŒæŒ‡å®šè·¯å¾„æŒ‚è½½" class="headerlink" title="åŒ¿åæŒ‚è½½å’Œå…·åæŒ‚è½½å’ŒæŒ‡å®šè·¯å¾„æŒ‚è½½"></a>åŒ¿åæŒ‚è½½å’Œå…·åæŒ‚è½½å’ŒæŒ‡å®šè·¯å¾„æŒ‚è½½</h4><p>é€šè¿‡<code>docker inspect å®¹å™¨id</code>ï¼šæ¥æŸ¥çœ‹æŒ‚è½½çš„å…·ä½“ä¿¡æ¯</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">åŒ¿åæŒ‚è½½ï¼ˆ-v å®¹å™¨å†…è·¯å¾„ï¼‰</span></span><br><span class="line">[root@centos7-mabin test]# docker run -it -v /home --privileged=true centos /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å…·åæŒ‚è½½ï¼ˆ-v å·åç§°:å®¹å™¨å†…è·¯å¾„ï¼‰</span></span><br><span class="line">[root@centos7-mabin test]# docker run -it -v centos:/home --privileged=true centos /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŒ‡å®šè·¯å¾„æŒ‚è½½ï¼ˆ-v å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„ï¼‰</span></span><br><span class="line">[root@centos7-mabin test]# docker run -it -v /home/test:/home --privileged=true centos /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ³¨æ„ï¼šæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å…·åæŒ‚è½½å’ŒæŒ‡å®šè·¯å¾„æŒ‚è½½çš„æ–¹å¼</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‹“å±•ï¼š</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">é€šè¿‡ -v å·åï¼šå®¹å™¨å†…è·¯å¾„:ro æˆ–è€…rw æ¥æ”¹å˜æŒ‚è½½æ–‡ä»¶çš„è¯»å†™æƒé™</span><br><span class="line"><span class="meta">#</span><span class="bash"> ro:åªè¯» (åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œæ•°æ®ï¼Œå®¹å™¨å†…éƒ¨æ— æ³•è¿›è¡Œæ“ä½œ)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rw:å¯è¯»å†™</span></span><br><span class="line">[root@centos7-mabin test]# docker run -it -v centos:/home:rw --privileged=true centos /bin/bash</span><br><span class="line">[root@centos7-mabin test]# docker run -it -v centos:/home:ro --privileged=true centos /bin/bash</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ•°æ®å·å®¹å™¨-è¿™é‡Œä»‹ç»å¤šä¸ªå®¹å™¨é—´çš„æ•°æ®åŒæ­¥"><a href="#æ•°æ®å·å®¹å™¨-è¿™é‡Œä»‹ç»å¤šä¸ªå®¹å™¨é—´çš„æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®å·å®¹å™¨(è¿™é‡Œä»‹ç»å¤šä¸ªå®¹å™¨é—´çš„æ•°æ®åŒæ­¥)"></a>æ•°æ®å·å®¹å™¨(è¿™é‡Œä»‹ç»å¤šä¸ªå®¹å™¨é—´çš„æ•°æ®åŒæ­¥)</h4><p><code>valumes-form</code>:å®¹å™¨é—´æŒ‚è½½å®ç°æ•°æ®åŒæ­¥</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å®ç°å®¹å™¨centos01å’Œå®¹å™¨centos02ï¼Œå®¹å™¨centos03ä¹‹é—´çš„æ•°æ®åŒæ­¥</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å®¹å™¨centos01ä½œä¸ºçˆ¶æ•°æ®å·å®¹å™¨ï¼Œå°†æ•°æ®æŒ‚è½½åŒæ­¥åˆ°æœ¬åœ°æŒä¹…åŒ–</span></span><br><span class="line">[root@centos7-mabin test]# docker run --name=centos01 -it -v centos:/home --privileged=true centos /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash">é€šè¿‡å‘½ä»¤ ã€valumes-form centos01ã€‘  å°†å®¹å™¨centos02å’Œ03,åˆ†åˆ«æŒ‚è½½åˆ°centos01ä¸Šé¢</span></span><br><span class="line">[root@centos7-mabin test]# docker run --name=centos02 -it -v centos:/home valumes-form centos01 --privileged=true centos /bin/bash</span><br><span class="line"></span><br><span class="line">[root@centos7-mabin test]# docker run --name=centos03 -it -v centos:/home valumes-form centos01 --privileged=true centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è¿™æ ·æ“ä½œä¹‹åï¼šå¯ä»¥å®ç°å¤šä¸ªå®¹å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œå¹¶ä¸”çˆ¶å®¹å™¨åˆ é™¤åï¼Œå­å®¹å™¨åŒæ­¥çš„æ•°æ¶ˆå¤±ï¼ˆæ‹·è´åŸç†ï¼‰</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><blockquote>
<p>dockerfile:ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ–‡ä»¶ï¼Œå®è´¨æ˜¯ä¸€ä¸ªå‘½ä»¤å‚æ•°è„šæœ¬</p>
</blockquote>
<p>é•œåƒæ„å»ºæ­¥éª¤ï¼š</p>
<ol>
<li>ç¼–å†™ä¸€ä¸ªdockerfileæ–‡ä»¶</li>
<li>docker buildæ„å»ºæˆä¸ºä¸€ä¸ªé•œåƒ</li>
<li>docker run è¿è¡Œé•œåƒ</li>
<li>docker pushå‘å¸ƒé•œåƒï¼ˆDockerHubæˆ–è€…é˜¿é‡Œäº‘åˆ›åº“ï¼‰</li>
</ol>
<h4 id="DockerFileå¸¸ç”¨åŸºæœ¬æŒ‡ä»¤-å¤§å†™"><a href="#DockerFileå¸¸ç”¨åŸºæœ¬æŒ‡ä»¤-å¤§å†™" class="headerlink" title="DockerFileå¸¸ç”¨åŸºæœ¬æŒ‡ä»¤(å¤§å†™)"></a>DockerFileå¸¸ç”¨åŸºæœ¬æŒ‡ä»¤(å¤§å†™)</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">FROM		#åŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹</span><br><span class="line">MAINTAINER  #é•œåƒæ˜¯è°å†™çš„ï¼šå§“å+é‚®ç®±</span><br><span class="line">RUN		    #é•œåƒè¿è¡Œçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤</span><br><span class="line">ADD			#æ·»åŠ å±‚ï¼Œä¾‹å¦‚ï¼šåœ¨æ„å»ºé•œåƒçš„æ—¶å€™æ·»åŠ tomcat,jdkç­‰ï¼Œæ·»åŠ ç›¸å…³å‹ç¼©åŒ…ä¼šè‡ªåŠ¨è§£å‹ï¼Œ</span><br><span class="line">WORKDIR     #æŒ‡å®šé•œåƒçš„å·¥ä½œç›®å½•</span><br><span class="line">VOLUME      #é…ç½®é•œåƒæŒ‚è½½çš„ç›®å½•</span><br><span class="line">EXPOSE		#æš´æ¼ç«¯å£é…ç½®</span><br><span class="line">CMD			#æŒ‡å®šå®¹å™¨è¿è¡Œå¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”è‡ªç”±æœ€åä¸€æ¡è®¾ç½®çš„æœ‰æ•ˆï¼ˆç›¸å½“äºå‘½ä»¤æ›¿ä»£ï¼‰</span><br><span class="line">ENTRYPOINT  #æŒ‡å®šå®¹å™¨è¿è¡Œå¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤</span><br><span class="line">ONBUILD     #åŸºç¡€æŒ‡ä»¤</span><br><span class="line">COPY		#ç±»ä¼¼ADDï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">ENV			#æ„å»ºé•œåƒçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®æˆ˜æµ‹è¯•"><a href="#å®æˆ˜æµ‹è¯•" class="headerlink" title="å®æˆ˜æµ‹è¯•"></a>å®æˆ˜æµ‹è¯•</h4><blockquote>
<p>åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„centos</p>
</blockquote>
<p>æ„å»ºdockerfileæ–‡ä»¶</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.ç¼–å†™æ–‡ä»¶</span></span><br><span class="line">[root@centos7-mabin dockerfile]# cat dockerfile-centos </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER horse-3468449362@qq.com</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim      #centos-8 yumä¼šå‡ºé”™ï¼Œé¢å¤–é…ç½®ï¼ˆè‡ªå·±ç™¾åº¦ï¼‰</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 10010</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo "----end----"</span><br><span class="line">CMD /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2.é€šè¿‡ä¸Šé¢çš„æ–‡ä»¶æ„å»ºé•œåƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">docker build -f dockerfileæ–‡ä»¶è·¯å¾„ -t è‡ªå®šä¹‰é•œåƒå:[TAG]</span></span><br><span class="line">[root@centos7-mabin dockerfile]# docker build -f dockerfile-centos -t mycentos:1.0 .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3.è¿è¡Œç”Ÿæˆçš„dockeré•œåƒ</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213204.png" alt="image-20200517164629575"></p>
<blockquote>
<p>æ„å»ºè‡ªå·±çš„tomcatæœåŠ¡å™¨</p>
</blockquote>
<p>1.å‡†å¤‡tomcat,jdkçš„å®‰è£…åŒ…</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213207.png" alt="image-20200517170618249"></p>
<p>2.ç¼–å†™dockerfileæ–‡ä»¶ï¼Œ</p>
<blockquote>
<p>å®˜æ–¹å‘½å â€œ<strong>Dockerfile</strong>â€ ï¼šå½“æ‰§è¡Œbuildå‘½ä»¤æ—¶ï¼Œä¼šè‡ªåŠ¨å»å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¸å†éœ€è¦-fè¿›è¡ŒæŒ‡å®šè·¯å¾„äº†</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin tar-gz]# cat Dockerfile </span><br><span class="line">FROM centos:centos7.7.1908</span><br><span class="line">MAINTAINER horse-3468449362@qq.com</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u251-linux-x64.tar.gz /usr/local</span><br><span class="line">ADD apache-tomcat-9.0.34.tar.gz /usr/local</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/1.8.0_251</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.34</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.34</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.34/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.34/bin/logs/catalina.out</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>3.æ„å»ºé•œåƒ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å› ä¸ºæ–‡ä»¶åå­—å«åšDockerfileï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œä¸éœ€è¦å†è¿›è¡Œç›®å½•æŒ‡å®š</span></span><br><span class="line">[root@centos7-mabin tar-gz]# docker build -t mytomcat .</span><br></pre></td></tr></tbody></table></figure>
<p>4.å¯åŠ¨é•œåƒå¹¶æŒ‚è½½å®¹å™¨å·</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin tar-gz]# docker run -d --name=myTomcat -p 8080:8080 -v /home/tar-gz/tomcat/test:/usr/local/apache-tomcat-9.0.34/webapps/test -v /home/tar-gz/tomcat/log:/usr/local/apache-tomcat-9.0.34/logs 708ee5fb9ff8</span><br></pre></td></tr></tbody></table></figure>
<p>5.å¦‚æœè¦å‘å¸ƒé¡¹ç›®ï¼Œå°±å¯ä»¥ç›´æ¥å°†é¡¹ç›®çš„waråŒ…æ”¾å…¥æœ¬åœ°çš„<code>/home/tar-gz/tomcat/test</code>ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥åŒæ­¥åˆ°webappsç›®å½•ä¸‹ï¼Œç›´æ¥å¯ä»¥è¿›è¡Œè®¿é—®ã€‚</p>
<p><code>ä½†æ˜¯æˆ‘çš„æµ‹è¯•å¤±è´¥äº†ã€‚ã€‚ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</code></p>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><blockquote>
<p>â€‹    çº¿æ€§ç»“æ„ï¼šé¡ºåºå­˜å‚¨ç»“æ„ï¼ˆæ•°ç»„ï¼‰å’Œé“¾å¼å­˜å‚¨ç»“æ„ï¼ˆé“¾è¡¨ï¼‰</p>
</blockquote>
<p><strong>å¸¸è§çš„çº¿æ€§ç»“æ„</strong>ï¼šæ•°ç»„ï¼Œé˜Ÿåˆ—ï¼Œé“¾è¡¨ï¼Œæ ˆ</p>
<p><strong>éçº¿æ€§ç»“æ„</strong>ï¼šäºŒç»´æ•°ç»„ï¼Œå¤šç»´æ•°ç»„ï¼Œå¹¿ä¹‰è¡¨ï¼Œæ ‘ç»“æ„ï¼Œå›¾ç»“æ„</p>
<h3 id="ç¨€ç–æ•°ç»„"><a href="#ç¨€ç–æ•°ç»„" class="headerlink" title="ç¨€ç–æ•°ç»„"></a><code>ç¨€ç–æ•°ç»„</code></h3><blockquote>
<p>ç¨€ç–æ•°ç»„ï¼šå½“ä¸€ä¸ªæ•°ç»„ä¸­å¤§éƒ¨åˆ†å…ƒç´ ä¸º0ï¼Œæˆ–è€…ä¸ºåŒä¸€ä¸ªå€¼çš„æ•°ç»„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¨€ç–æ•°ç»„æ¥ä¿å­˜è¯¥æ•°ç»„</p>
</blockquote>
<p>å¤„ç†æ–¹æ³•ï¼š</p>
<ol>
<li>è®°å½•æ•°ç»„ä¸­ä¸€å…±æœ‰å‡ è¡Œå‡ åˆ—ï¼Œæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼</li>
<li>æŠŠå…·æœ‰ä¸åŒå€¼çš„å…ƒç´ çš„è¡Œåˆ—å’Œç›¸åº”çš„å€¼è®°å½•åœ¨ä¸€ä¸ªå°è§„æ¨¡çš„æ–°æ•°ç»„ä¸­ï¼Œä»è€Œè¾¾åˆ°è¯´å°ç¨‹åºè§„æ¨¡çš„æ•ˆæœ</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213212.png" alt="ç¨€ç–æ•°ç»„è½¬æ¢å›¾è§£"></p>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_PATH = <span class="string">"D:\\IEDA_data\\LanQiaoBei\\file\\sparse.data"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç¨€ç–æ•°ç»„æ£‹ç›˜æ¡ˆä¾‹æµ‹è¯•ï¼šäºŒç»´æ•°ç»„&lt;==&gt;ç¨€ç–æ•°ç»„ çš„ç›¸äº’è½¬æ¢</span></span><br><span class="line"><span class="comment">         * 0ï¼šæ²¡æœ‰å€¼ï¼Œ1ï¼šè“æ£‹å­ï¼Œ2ï¼šé»‘æ£‹å­</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå¹¶è®¾ç½®è“é»‘æ£‹å­çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span>[][] chessArr1 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">11</span>][<span class="number">11</span>];</span><br><span class="line">        chessArr1[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        chessArr1[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">2</span>;</span><br><span class="line">        chessArr1[<span class="number">4</span>][<span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†äºŒç»´æ•°ç»„è½¬åŒ–ä¸ºç¨€ç–æ•°ç»„</span></span><br><span class="line">        <span class="comment">//1.éå†äºŒç»´æ•°ç»„ï¼Œè·å–æ•°ç»„ä¸­é0æ•°æ®çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">int</span> zero = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] ints : chessArr1) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> anInt : ints) {</span><br><span class="line">                <span class="keyword">if</span> (anInt != <span class="number">0</span>) {</span><br><span class="line">                    zero++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//2.åˆ›å»ºå¯¹åº”çš„ç¨€ç–æ•°ç»„sparseAr[zero+1][3]</span></span><br><span class="line">        <span class="keyword">int</span> sparseArr[][] = <span class="keyword">new</span> <span class="keyword">int</span>[zero + <span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line">        <span class="comment">//ç»™ç¨€ç–æ•°ç»„ç¬¬ä¸€è¡Œèµ‹åˆå§‹å€¼</span></span><br><span class="line">        sparseArr[<span class="number">0</span>][<span class="number">0</span>] = chessArr1.length;</span><br><span class="line">        sparseArr[<span class="number">0</span>][<span class="number">1</span>] = chessArr1[<span class="number">0</span>].length;</span><br><span class="line">        sparseArr[<span class="number">0</span>][<span class="number">2</span>] = zero;</span><br><span class="line">        <span class="comment">//3.å°†äºŒç»´æ•°ç»„çš„æœ‰æ•ˆæ•°æ®å­˜å…¥åˆ°ç¨€ç–æ•°ç»„ä¸­</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">//ç”¨äºè®°å½•æ˜¯ç¬¬å‡ ä¸ªæœ‰æ•ˆæ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chessArr1.length; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; chessArr1[i].length; j++) {</span><br><span class="line">                <span class="keyword">if</span> (chessArr1[i][j] != <span class="number">0</span>) {</span><br><span class="line">                    count++;</span><br><span class="line">                    sparseArr[count][<span class="number">0</span>] = i;</span><br><span class="line">                    sparseArr[count][<span class="number">1</span>] = j;</span><br><span class="line">                    sparseArr[count][<span class="number">2</span>] = chessArr1[i][j];</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"==============è·å–ç¨€ç–æ•°ç»„å¹¶ä¿å­˜ç¨€ç–æ•°ç»„åˆ°ç£ç›˜=============="</span>);</span><br><span class="line">        BufferedWriter writer = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(FILE_PATH)));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span>[] ints : sparseArr) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> sparse : ints) {</span><br><span class="line">                    System.out.printf(<span class="string">"%d\t"</span>, sparse);</span><br><span class="line">                    writer.write(sparse + <span class="string">","</span>);</span><br><span class="line">                }</span><br><span class="line">                writer.write(<span class="string">"\n"</span>);</span><br><span class="line">                writer.flush();</span><br><span class="line">                System.out.println();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">if</span> (writer != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    writer.close();</span><br><span class="line">                } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"==============è¯»å–ç£ç›˜æ–‡ä»¶(åˆ©ç”¨listé›†åˆå­˜æ”¾å…ƒç´ )å¹¶è¿˜åŸäºŒç»´æ•°ç»„=============="</span>);</span><br><span class="line">        BufferedReader reader = <span class="keyword">null</span>;</span><br><span class="line">        String line;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(FILE_PATH)));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) {</span><br><span class="line">                String[] split = line.split(<span class="string">","</span>);</span><br><span class="line">                <span class="keyword">for</span> (String s : split) {</span><br><span class="line">                    list.add(Integer.parseInt(s));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">if</span> (reader != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    reader.close();</span><br><span class="line">                } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"ç£ç›˜è¯»å–è½¬åŒ–ç¨€ç–æ•°ç»„..."</span>);</span><br><span class="line">        <span class="keyword">int</span>[][] sparseArr1 = <span class="keyword">new</span> <span class="keyword">int</span>[list.get(<span class="number">2</span>) + <span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i += <span class="number">3</span>) {</span><br><span class="line">            sparseArr1[j][<span class="number">0</span>] = list.get(i);</span><br><span class="line">            sparseArr1[j][<span class="number">1</span>] = list.get(i + <span class="number">1</span>);</span><br><span class="line">            sparseArr1[j][<span class="number">2</span>] = list.get(i + <span class="number">2</span>);</span><br><span class="line">            j++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] ints : sparseArr1) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> chess : ints) {</span><br><span class="line">                System.out.printf(<span class="string">"%d\t"</span>, chess);</span><br><span class="line">            }</span><br><span class="line">            System.out.println();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹è¿˜åŸ..."</span>);</span><br><span class="line">        <span class="comment">//å°†ç¨€ç–æ•°ç»„è¿˜åŸä¸ºäºŒä½æ•°ç»„</span></span><br><span class="line">        <span class="comment">//1.å…ˆè¯»å–ç¨€ç–æ•°ç»„çš„ç¬¬ä¸€è¡Œæ•°æ®ï¼Œå¹¶åˆ›å»ºåŸå§‹çš„äºŒç»´æ•°ç»„</span></span><br><span class="line">        <span class="keyword">int</span>[][] chessArr2 = <span class="keyword">new</span> <span class="keyword">int</span>[sparseArr1[<span class="number">0</span>][<span class="number">0</span>]][sparseArr1[<span class="number">0</span>][<span class="number">1</span>]];</span><br><span class="line">        <span class="comment">//2.è¯»å–ç¨€ç–æ•°ç»„çš„åå‡ è¡Œæ•°æ®ï¼Œå¹¶èµ‹å€¼ç»™äºŒç»´æ•°æ®å³å¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; sparseArr1.length; i++) {</span><br><span class="line">            chessArr2[sparseArr1[i][<span class="number">0</span>]][sparseArr1[i][<span class="number">1</span>]] = sparseArr1[i][<span class="number">2</span>];</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] ints : chessArr2) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> chess : ints) {</span><br><span class="line">                System.out.printf(<span class="string">"%d\t"</span>, chess);</span><br><span class="line">            }</span><br><span class="line">            System.out.println();</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213232.png" alt="è¿è¡Œç»“æœ"></p>
<h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a><code>é“¾è¡¨</code></h3><h4 id="å•å‘é“¾è¡¨"><a href="#å•å‘é“¾è¡¨" class="headerlink" title="å•å‘é“¾è¡¨"></a><code>å•å‘é“¾è¡¨</code></h4><p><strong>é“¾è¡¨ç»“æ„ç‰¹ç‚¹</strong></p>
<ul>
<li>é“¾è¡¨æ˜¯ä»¥èŠ‚ç‚¹çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œæ˜¯é“¾å¼å­˜å‚¨çš„å½¢å¼</li>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªdataåŸŸï¼Œä¸€ä¸ªnextåŸŸï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li>
<li>é“¾è¡¨çš„å„ä¸ªèŠ‚ç‚¹ä¸ä¸€å®šæ˜¯è¿ç»­çš„</li>
<li>é“¾è¡¨åˆ†ä¸ºå¸¦å¤´ç»“ç‚¹å’Œæ²¡æœ‰å¤´èŠ‚ç‚¹çš„é“¾è¡¨(å¤´èŠ‚ç‚¹ä¸€èˆ¬ä¸å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯æ ‡è¯†è‡ªå·±æ˜¯å¤´èŠ‚ç‚¹)ï¼Œè¿™ä¸ªæ ¹æ®å®é™…æƒ…å†µæ¥ç¡®å®šå®šä¹‰</li>
</ul>
<p>javaä»£ç å®ç°å•é¡¹é“¾è¡¨çš„å¢åˆ æ”¹æŸ¥å’Œ<code>å‡ ä¸ªç®€å•çš„é¢è¯•é¢˜</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//å•å‘é“¾è¡¨æµ‹è¯•</span></span><br><span class="line">        HeroNode hero1 = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"å®‹æ±Ÿ"</span>, <span class="string">"åŠæ—¶é›¨"</span>);</span><br><span class="line">        HeroNode hero2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"å´ç”¨"</span>, <span class="string">"æ™ºå¤šæ˜Ÿ"</span>);</span><br><span class="line">        HeroNode hero3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"å¢ä¿Šä¹‰"</span>, <span class="string">"ç‰éº’éºŸ"</span>);</span><br><span class="line">        HeroNode hero4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"ä¸€ä¸ˆé’"</span>, <span class="string">"æ‰ˆä¸‰å¨˜"</span>);</span><br><span class="line"></span><br><span class="line">        SinglyLinkedList singlyLinkedList = <span class="keyword">new</span> SinglyLinkedList();</span><br><span class="line">        <span class="comment">//æ·»åŠ é“¾è¡¨ï¼ˆå¹¶æŒ‰åºå·æ’åºæ’å…¥ï¼‰</span></span><br><span class="line">        singlyLinkedList.addHeroNodeByOrder(hero3);</span><br><span class="line">        singlyLinkedList.addHeroNodeByOrder(hero4);</span><br><span class="line">        singlyLinkedList.addHeroNodeByOrder(hero2);</span><br><span class="line">        singlyLinkedList.addHeroNodeByOrder(hero1);</span><br><span class="line">        System.out.println(<span class="string">"============æ·»åŠ å============"</span>);</span><br><span class="line">        singlyLinkedList.listHeroNode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€†åºæ‰“å°é“¾è¡¨èŠ‚ç‚¹ï¼ˆä¸ç ´åé“¾è¡¨ç»“æ„ï¼‰</span></span><br><span class="line">        System.out.println(<span class="string">"============é€†åºæ‰“å°å============"</span>);</span><br><span class="line">        singlyLinkedList.reversePrint(singlyLinkedList.getHead());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é“¾è¡¨åè½¬ï¼ˆç ´åé“¾è¡¨ç»“æ„ï¼‰</span></span><br><span class="line">        System.out.println(<span class="string">"============åè½¬å============"</span>);</span><br><span class="line">        singlyLinkedList.reverseHeroNode(singlyLinkedList.getHead());</span><br><span class="line">        singlyLinkedList.listHeroNode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿®æ”¹èŠ‚ç‚¹</span></span><br><span class="line">        singlyLinkedList.updateHeroNode(<span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"æ—å†²"</span>, <span class="string">"è±¹å­å¤´"</span>));</span><br><span class="line">        System.out.println(<span class="string">"============ä¿®æ”¹å============"</span>);</span><br><span class="line">        singlyLinkedList.listHeroNode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">        singlyLinkedList.deleteHeroNode(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">"============åˆ é™¤å============"</span>);</span><br><span class="line">        singlyLinkedList.listHeroNode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢é“¾è¡¨çš„æœ‰æ•ˆèŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">        System.out.println(<span class="string">"æœ‰æ•ˆèŠ‚ç‚¹ä¸ªæ•°ï¼š"</span> + singlyLinkedList.getEffectiveNode(singlyLinkedList.getHead()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å€’æ•°ç¬¬indexä¸ªèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">"å€’æ•°ç¬¬2ä¸ªçš„èŠ‚ç‚¹ä¿¡æ¯ï¼š"</span> + singlyLinkedList.getHeroNodeByIndex(singlyLinkedList.getHead(), <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="string">"===============åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹============="</span>);</span><br><span class="line">        System.out.println(<span class="string">"è¿”å›å¤´èŠ‚ç‚¹:"</span> + singlyLinkedList.deleteHeroNodeByIndex(singlyLinkedList.getHead(), <span class="number">3</span>));</span><br><span class="line">        singlyLinkedList.listHeroNode();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªSinglyLinkedListç±»ï¼šç®¡ç†æˆ‘ä»¬çš„è‹±é›„å¯¹è±¡ï¼ˆHeroNodeï¼‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SinglyLinkedList</span> </span>{</span><br><span class="line">    <span class="comment">//é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼šä¸ç”¨äºå­˜å‚¨ä¿¡æ¯ï¼Œåªå•çº¯å½“åšå¤´èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> HeroNode head = <span class="keyword">new</span> HeroNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">getHead</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰å¢åŠ èŠ‚ç‚¹çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * ä¸è€ƒè™‘ç¼–å·çš„é¡ºåºè¿›è¡ŒèŠ‚ç‚¹çš„æ·»åŠ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addHeroNode</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="comment">//å› ä¸ºheadå¤´èŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡temp</span></span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span> (temp.next != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//ä¾æ¬¡å°†èŠ‚ç‚¹å¯¹è±¡åç§»ï¼ŒçŸ¥é“æ‰¾åˆ°next==nullçš„é‚£ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å½“é€€å‡ºwhileå¾ªç¯æ—¶ï¼Œtempè‚¯å®šæŒ‡å‘é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆnext==nullï¼‰ï¼Œè¿™æ—¶å°†æ­¤èŠ‚ç‚¹çš„nextæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line">        temp.next = heroNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åºå·é¡ºåºå°†è‹±é›„æ’å…¥åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªåºå·å·²ç»å­˜åœ¨ï¼Œåˆ™æ·»åŠ å¤±è´¥å¹¶ç»™å‡ºæç¤º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addHeroNodeByOrder</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="comment">//å› ä¸ºheadå¤´èŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡temp</span></span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºèŠ‚ç‚¹æ˜¯å¦é‡å¤</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (temp.next != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°å½“å‰å¯ä»¥æ’å…¥èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> (temp.next.id &gt; heroNode.id) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//åºå·å·²å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">if</span> (temp.next.id == heroNode.id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//tempåç§»ï¼šéå†é“¾è¡¨ï¼Œè¿›è¡Œä½ç½®æŸ¥æ‰¾</span></span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            System.out.printf(<span class="string">"å‡†å¤‡æ’å…¥çš„è‹±é›„çš„åºå·%då·²å­˜åœ¨ï¼\n"</span>, heroNode.id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//ä½ç½®æ‰¾åˆ°ï¼Œå°±åœ¨å½“å‰tempçš„åé¢æ’å…¥å³å¯</span></span><br><span class="line">            heroNode.next = temp.next;</span><br><span class="line">            temp.next = heroNode;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idè¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢å¹¶ä¿®æ”¹èŠ‚ç‚¹ä¿¡æ¯ï¼ˆidä¸èƒ½ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateHeroNode</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (head.next == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        HeroNode temp = head.next;</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (temp.id == heroNode.id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            temp.name = heroNode.name;</span><br><span class="line">            temp.nickname = heroNode.nickname;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.printf(<span class="string">"æ²¡æœ‰æ‰¾åˆ°è¯¥åºå·ä¸º%dçš„è‹±é›„ä¿¡æ¯\n"</span>, heroNode.id);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åºå·åˆ é™¤èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * éœ€è¦æ‰¾åˆ°è¢«åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteHeroNode</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="comment">//æ˜¯å¦åŒ¹é…åˆ°å¯åˆ é™¤é¡¹</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (temp.next != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (temp.next.id == id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            <span class="comment">//è¢«é—å¼ƒçš„é‚£ä¸ªèŠ‚ç‚¹ä¼šè¢«jvmçš„åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨å›æ”¶åˆ é™¤</span></span><br><span class="line">            temp.next = temp.next.next;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.printf(<span class="string">"æ²¡æœ‰æ‰¾åˆ°è¯¥åºå·ä¸º%dçš„è‹±é›„ä¿¡æ¯\n"</span>, id);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºé“¾è¡¨ï¼ˆéå†ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listHeroNode</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//åˆ¤æ–­é“¾è¡¨æ˜¯å¦ä¸ºç©º(å¦‚æœå¤´èŠ‚ç‚¹çš„next==null,é‚£ä¹ˆæ­¤é“¾è¡¨ä¸€å®šä¸ºç©º)</span></span><br><span class="line">        <span class="keyword">if</span> (head.next == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©º"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¾ªç¯éå†æ˜¾ç¤º</span></span><br><span class="line">        HeroNode temp = head.next;</span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">            <span class="comment">//å°†tempåç§»</span></span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡é“¾è¡¨ï¼ˆé™¤å¤´èŠ‚ç‚¹å¤–ï¼‰çš„æœ‰æ•ˆèŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEffectiveNode</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">        HeroNode temp = heroNode.next;</span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="keyword">null</span>) {</span><br><span class="line">            length++;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å€’æ•°ç¬¬indexä¸ªçš„èŠ‚ç‚¹(é™¤å»ä¸å¸¦ä¿¡æ¯çš„å¤´èŠ‚ç‚¹)ä¿¡æ¯ï¼ˆå› ä¸ºå•å‘é“¾è¡¨ä¸èƒ½é€†å‘éå†ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ï¼šæ­£ã€æ€»-indexã€‘= é€†ã€indexã€‘ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">getHeroNodeByIndex</span><span class="params">(HeroNode heroNode, <span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (heroNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è·å–é“¾è¡¨çš„æœ‰æ•ˆèŠ‚ç‚¹çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">int</span> length = <span class="keyword">this</span>.getEffectiveNode(heroNode);</span><br><span class="line">        <span class="comment">//æ ¡éªŒindex</span></span><br><span class="line">        <span class="keyword">if</span> (index &lt;= <span class="number">0</span> || index &gt; length) {</span><br><span class="line">            System.out.printf(<span class="string">"æ— æ³•æ‰¾åˆ°å€’æ•°ç¬¬%dä¸ªçš„èŠ‚ç‚¹ä¿¡æ¯\n"</span>, index);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        HeroNode currentNode = heroNode.next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length - index; i++) {</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> currentNode;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.printf(<span class="string">"æ— æ³•æ‰¾åˆ°å€’æ•°ç¬¬%dä¸ªçš„èŠ‚ç‚¹ä¿¡æ¯\n"</span>, index);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åè½¬å•é“¾è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseHeroNode</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="comment">//å¦‚æœé“¾è¡¨ä¸ºç©ºæˆ–è€…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥ç»ˆæ­¢è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (heroNode.next == <span class="keyword">null</span> || heroNode.next.next == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//åè½¬æ“ä½œ</span></span><br><span class="line">        <span class="comment">//ç”¨äºéå†çš„è¾…åŠ©å˜é‡</span></span><br><span class="line">        HeroNode currentNode = heroNode.next;</span><br><span class="line">        <span class="comment">//æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆç”¨äºæš‚æ—¶ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼‰</span></span><br><span class="line">        HeroNode next;</span><br><span class="line">        <span class="comment">//ç”¨äºåè½¬çš„è¾…åŠ©é“¾è¡¨</span></span><br><span class="line">        HeroNode reverseHead = <span class="keyword">new</span> HeroNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éå†åŸé“¾è¡¨ï¼Œæ¯éå†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°†æ­¤èŠ‚ç‚¹å–å‡ºå¹¶æ”¾åœ¨æ–°çš„reverseHeadé“¾è¡¨çš„æœ€å‰ç«¯ä½ç½®ï¼ˆreverseHeadå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œéå†å®Œåï¼Œæ–°é“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºå°±æ˜¯å€’åºæ’åˆ—çš„äº†</span></span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//æš‚æ—¶ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨äºä¸‹é¢çš„éå†èµ‹å€¼</span></span><br><span class="line">            next = currentNode.next;</span><br><span class="line">            <span class="comment">//æ¯æ¬¡éƒ½æŠŠå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°é“¾è¡¨çš„æœ€å‰ç«¯ï¼ˆè¿™ä¸¤å¥å°±ç›¸å½“äºæ¯æ¬¡åœ¨æ–°é“¾è¡¨çš„æœ€å‰ç«¯æ’å…¥ä¸€ä¸ªå½“å‰èŠ‚ç‚¹ï¼Œå°±æ˜¯æ’å…¥æ“ä½œï¼‰</span></span><br><span class="line">            currentNode.next = reverseHead.next;</span><br><span class="line">            reverseHead.next = currentNode;</span><br><span class="line">            <span class="comment">//å½“å‰èŠ‚ç‚¹åç§»</span></span><br><span class="line">            currentNode = next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//éå†ä¹‹åï¼Œå†æŠŠå¤´èŠ‚ç‚¹è¿›è¡Œæ›¿æ¢å³å¯</span></span><br><span class="line">        heroNode.next = reverseHead.next;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">deleteHeroNodeByIndex</span><span class="params">(HeroNode head, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (head.next == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è·å–é“¾è¡¨çš„æœ‰æ•ˆèŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">        HeroNode temp = head.next;</span><br><span class="line">        <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="keyword">null</span>) {</span><br><span class="line">            length++;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ ¡éªŒnçš„åˆæ³•æ€§</span></span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">0</span> || n &gt; length) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//éå†å¹¶æ‰¾åˆ°å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        HeroNode currentNode = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length - n; i++) {</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            currentNode.next = currentNode.next.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> head.next;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€†åºæ‰“å°å•é“¾è¡¨ï¼šä¸æ”¹å˜é“¾è¡¨çš„ç»“æ„ï¼Œï¼ˆè¿™é‡Œç»“åˆæ ˆçš„ â€œå…ˆè¿›åå‡ºâ€ åŸç†è¿›è¡Œæ“ä½œï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reversePrint</span><span class="params">(HeroNode heroNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (heroNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªæ ˆ</span></span><br><span class="line">        Stack&lt;HeroNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="comment">//éå†é“¾è¡¨ï¼šå°†å„ä¸ªèŠ‚ç‚¹å‹å…¥æ ˆä¸­</span></span><br><span class="line">        HeroNode currentNode = heroNode.next;</span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//è¿›æ ˆ</span></span><br><span class="line">            stack.push(currentNode);</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‡ºæ ˆæ‰“å°èŠ‚ç‚¹ä¿¡æ¯(æ¯æ¬¡è¾“å‡ºä¹‹åï¼Œstack.size()éƒ½ä¼šå‡1ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨forå¾ªç¯éå†)</span></span><br><span class="line">        <span class="keyword">while</span> (stack.size() &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">//å‡ºæ ˆ</span></span><br><span class="line">            System.out.println(stack.pop());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰HeroNode,æ¯ä¸ªHeroNodeå¯¹è±¡å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HeroNode next; <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> id, String name, String nickname)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"HeroNode{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", nickname='"</span> + nickname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213240.png" alt="å•å‘é“¾è¡¨"></p>
<h4 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a><code>åŒå‘é“¾è¡¨</code></h4><p>åŒå‘é“¾è¡¨ï¼š</p>
<ul>
<li>é“¾è¡¨ä¸­å…·æœ‰nextï¼Œå’Œpre,åˆ†åˆ«æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå’Œå½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ª</li>
<li>å¯ä»¥ç›´æ¥æ‰¾åˆ°æŸä¸€èŠ‚ç‚¹å¹¶ç›´æ¥åˆ é™¤å½“å‰èŠ‚ç‚¹</li>
<li>å…¶ä»–çš„æ“ä½œåŸºæœ¬å’Œå•å‘é“¾è¡¨çš„ç›¸åŒï¼Œåªæ˜¯é€»è¾‘ç¨å¾®æœ‰ç‚¹å˜åŒ–ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œç”šè‡³æ›´åŠ ç®€å•</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        PersonNode hero1 = <span class="keyword">new</span> PersonNode(<span class="number">1</span>, <span class="string">"å®‹æ±Ÿ"</span>, <span class="string">"åŠæ—¶é›¨"</span>);</span><br><span class="line">        PersonNode hero2 = <span class="keyword">new</span> PersonNode(<span class="number">2</span>, <span class="string">"å´ç”¨"</span>, <span class="string">"æ™ºå¤šæ˜Ÿ"</span>);</span><br><span class="line">        PersonNode hero3 = <span class="keyword">new</span> PersonNode(<span class="number">3</span>, <span class="string">"å¢ä¿Šä¹‰"</span>, <span class="string">"ç‰éº’éºŸ"</span>);</span><br><span class="line">        PersonNode hero4 = <span class="keyword">new</span> PersonNode(<span class="number">4</span>, <span class="string">"ä¸€ä¸ˆé’"</span>, <span class="string">"æ‰ˆä¸‰å¨˜"</span>);</span><br><span class="line"></span><br><span class="line">        DoubleLinkedList doubleLinkedList = <span class="keyword">new</span> DoubleLinkedList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯å¹¶æŒ‰idæ’åº</span></span><br><span class="line">        doubleLinkedList.addDoubleLinkedByOrder(hero4);</span><br><span class="line">        doubleLinkedList.addDoubleLinkedByOrder(hero2);</span><br><span class="line">        doubleLinkedList.addDoubleLinkedByOrder(hero1);</span><br><span class="line">        doubleLinkedList.addDoubleLinkedByOrder(hero3);</span><br><span class="line">        System.out.println(<span class="string">"===========æ·»åŠ èŠ‚ç‚¹=========="</span>);</span><br><span class="line">        doubleLinkedList.listDoubleLinked();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹</span></span><br><span class="line">        doubleLinkedList.updateDoubleLinked(<span class="keyword">new</span> PersonNode(<span class="number">3</span>, <span class="string">"æé€µ"</span>, <span class="string">"é»‘æ—‹é£"</span>));</span><br><span class="line">        System.out.println(<span class="string">"===========ä¿®æ”¹èŠ‚ç‚¹=========="</span>);</span><br><span class="line">        doubleLinkedList.listDoubleLinked();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤æŒ‡å®šèŠ‚ç‚¹</span></span><br><span class="line">        doubleLinkedList.deleteDoubleLinked(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">"===========åˆ é™¤èŠ‚ç‚¹=========="</span>);</span><br><span class="line">        doubleLinkedList.listDoubleLinked();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoubleLinkedList</span> </span>{</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œä¸å­˜æ”¾å…·ä½“æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> PersonNode personNode = <span class="keyword">new</span> PersonNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PersonNode <span class="title">getPersonNode</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> personNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†åŒå‘é“¾è¡¨ï¼ˆå’Œå•å‘é“¾è¡¨ç›¸åŒï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listDoubleLinked</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.personNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        PersonNode tempNode = personNode.next;</span><br><span class="line">        <span class="keyword">while</span> (tempNode != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(tempNode);</span><br><span class="line">            tempNode = tempNode.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ èŠ‚ç‚¹åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨ï¼ˆæœ‰åŒºåˆ«ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDoubleLinked</span><span class="params">(PersonNode personNode)</span> </span>{</span><br><span class="line">        PersonNode tempNode = <span class="keyword">this</span>.personNode;</span><br><span class="line">        <span class="comment">//éå†æ‰¾åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">while</span> (tempNode.next != <span class="keyword">null</span>) {</span><br><span class="line">            tempNode = tempNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">        tempNode.next = personNode;</span><br><span class="line">        personNode.pre = tempNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®åºå·é¡ºåºå°†è‹±é›„æ’å…¥åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªåºå·å·²ç»å­˜åœ¨ï¼Œåˆ™æ·»åŠ å¤±è´¥å¹¶ç»™å‡ºæç¤º</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDoubleLinkedByOrder</span><span class="params">(PersonNode personNode)</span> </span>{</span><br><span class="line">        PersonNode tempNode = <span class="keyword">this</span>.personNode;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (tempNode.next != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (tempNode.next.id == personNode.id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (tempNode.next.id &gt; personNode.id) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            tempNode = tempNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            System.out.printf(<span class="string">"åºå·ä¸º%dçš„èŠ‚ç‚¹ä¿¡æ¯å·²å­˜åœ¨\n"</span>, personNode.id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//æ’å…¥åˆ°é“¾è¡¨çš„ä¸­é—´çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> (tempNode.next != <span class="keyword">null</span>) {</span><br><span class="line">                personNode.next = tempNode.next;</span><br><span class="line">                tempNode.next.pre = personNode;</span><br><span class="line">                tempNode.next = personNode;</span><br><span class="line">                personNode.pre = tempNode;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨çš„æƒ…å†µ</span></span><br><span class="line">                tempNode.next = personNode;</span><br><span class="line">                personNode.pre = tempNode;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹åŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼ˆç›¸åŒï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDoubleLinked</span><span class="params">(PersonNode personNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.personNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        PersonNode tempNode = <span class="keyword">this</span>.personNode.next;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (tempNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (tempNode.id == personNode.id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            tempNode = tempNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            tempNode.name = personNode.name;</span><br><span class="line">            tempNode.nickname = personNode.nickname;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.printf(<span class="string">"æœªæ‰¾åˆ°åºå·ä¸º%dçš„èŠ‚ç‚¹ä¿¡æ¯\n"</span>, personNode.id);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤åŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹(ä¸åŒ)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteDoubleLinked</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.personNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        PersonNode tempNode = <span class="keyword">this</span>.personNode.next;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//ç›´æ¥æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">while</span> (tempNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (tempNode.id == id) {</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            tempNode = tempNode.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            <span class="comment">//åˆ é™¤å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">            tempNode.pre.next = tempNode.next;</span><br><span class="line">            <span class="comment">//é¿å…åˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (tempNode.next != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">//å¦‚æœåˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦ä¸‹é¢çš„ç¨‹åºï¼Œå¦ä¾§ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">                tempNode.next.pre = tempNode.pre;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.printf(<span class="string">"æœªæ‰¾åˆ°åºå·ä¸º%dçš„èŠ‚ç‚¹ä¿¡æ¯\n"</span>, id);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰èŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonNode</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String nickname;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> PersonNode next;</span><br><span class="line">    <span class="comment">//æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> PersonNode pre;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonNode</span><span class="params">(<span class="keyword">int</span> id, String name, String nickname)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"PersonNode{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", nickname='"</span> + nickname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213245.png" alt="åŒå‘é“¾è¡¨"></p>
<h4 id="å•ç¯å½¢é“¾è¡¨å’Œçº¦ç‘Ÿå¤«ç¯"><a href="#å•ç¯å½¢é“¾è¡¨å’Œçº¦ç‘Ÿå¤«ç¯" class="headerlink" title="å•ç¯å½¢é“¾è¡¨å’Œçº¦ç‘Ÿå¤«ç¯"></a><code>å•ç¯å½¢é“¾è¡¨å’Œçº¦ç‘Ÿå¤«ç¯</code></h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213248.png" alt="çº¦ç‘Ÿå¤«åœºæ™¯ä»‹ç»"></p>
<p>å°å­©å‡ºåœˆçš„æ€è·¯åˆ†æ</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213251.png" alt="æ€è·¯åˆ†æ"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        CircleSinglyLinkedList circleSinglyLinkedList = <span class="keyword">new</span> CircleSinglyLinkedList();</span><br><span class="line">        System.out.println(<span class="string">"=========æ„å»ºå•é¡¹ç¯å½¢é“¾è¡¨å¹¶éå†=========="</span>);</span><br><span class="line">        circleSinglyLinkedList.addCircleLinked(<span class="number">5</span>);</span><br><span class="line">        circleSinglyLinkedList.listCircleLinked();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=========çº¦ç‘Ÿå¤«ç¯çš„å°å­©å‡ºåœˆæµ‹è¯•=========="</span>);</span><br><span class="line">        circleSinglyLinkedList.JosupheCircleLinked(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå•é¡¹ç¯å½¢é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleSinglyLinkedList</span> </span>{</span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªfirstå¤´èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Body firstNode = <span class="keyword">new</span> Body(-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//åˆ›å»ºç¯å½¢é“¾è¡¨(åˆ©ç”¨forå¾ªç¯)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCircleLinked</span><span class="params">(<span class="keyword">int</span> nums)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (nums &lt; <span class="number">1</span>) {</span><br><span class="line">            System.out.println(<span class="string">"ç¯å½¢èŠ‚ç‚¹ä¸ªæ•°ä¸èƒ½å°äº1,è¯·é‡æ–°åˆ›å»º..."</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ ¹æ®å¾ªç¯åˆ›å»º</span></span><br><span class="line">        Body currentBody = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums; i++) {</span><br><span class="line">            <span class="comment">//æ ¹æ®ç¼–å·ï¼Œåˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">            Body body = <span class="keyword">new</span> Body(i);</span><br><span class="line">            <span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">this</span>.firstNode = body;</span><br><span class="line">                <span class="comment">//æ„æˆä¸€ä¸ªèŠ‚ç‚¹çš„å•å‘ç¯</span></span><br><span class="line">                <span class="keyword">this</span>.firstNode.next = <span class="keyword">this</span>.firstNode;</span><br><span class="line">                <span class="comment">//è¾…åŠ©èŠ‚ç‚¹</span></span><br><span class="line">                currentBody = <span class="keyword">this</span>.firstNode;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                currentBody.next = body;</span><br><span class="line">                body.next = <span class="keyword">this</span>.firstNode;</span><br><span class="line">                currentBody = body;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†ç¯å½¢é“¾è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listCircleLinked</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (firstNode == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"å½“å‰é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        Body currentNode = <span class="keyword">this</span>.firstNode;</span><br><span class="line">        <span class="comment">//å½“æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªç­‰äºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯éå†å®Œæ¯•</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            System.out.println(currentNode);</span><br><span class="line">            <span class="keyword">if</span> (currentNode.next == firstNode) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°çº¦ç‘Ÿå¤«ç¯å‡ºåœˆé—®é¢˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startNo å¼€å§‹æŠ¥æ•°çš„èŠ‚ç‚¹åºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> countNum æ¯æ¬¡æŠ¥æ•°å‡ºåœˆç§»åŠ¨çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">JosupheCircleLinked</span><span class="params">(<span class="keyword">int</span> startNo, <span class="keyword">int</span> countNum, <span class="keyword">int</span> nums)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.firstNode == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (startNo &lt; <span class="number">1</span> || startNo &gt; nums) {</span><br><span class="line">            System.out.println(<span class="string">"å‚æ•°ä¸åˆæ³•ï¼Œè¯·é‡æ–°è¾“å…¥..."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿›è¡Œå‡ºåœˆæ“ä½œ</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¾…åŠ©èŠ‚ç‚¹helper:äº‹å…ˆhelperåº”è¯¥æ‰§è¡Œç¯å½¢é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        Body helper = firstNode;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">if</span> (helper.next == firstNode) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            helper = helper.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å°å­©æŠ¥æ•°å‰ï¼šåº”è¯¥è®©helperå’ŒfirstNodeèŠ‚ç‚¹ç§»åŠ¨startNo-1æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; startNo - <span class="number">1</span>; i++) {</span><br><span class="line">            firstNode = firstNode.next;</span><br><span class="line">            helper = helper.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¼€å§‹æŠ¥æ•°ï¼šè®©firstNodeå’ŒhelperèŠ‚ç‚¹åŒæ—¶ç§»åŠ¨countNum-1æ¬¡ï¼ˆå¼€å§‹æŠ¥æ•°çš„å°å­©è‡ªå·±ä¹ŸæŠ¥æ•°ä¸€æ¬¡ï¼Œæ‰€ä»¥ç›¸å½“äºç§»åŠ¨countNum-1æ¬¡ï¼‰ï¼Œç„¶åè¢«æŒ‡å®šçš„èŠ‚ç‚¹å‡ºåœˆï¼Œç›´åˆ°åœˆä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºæ­¢</span></span><br><span class="line">        System.out.print(<span class="string">"å‡ºåœˆé¡ºåºä¸ºï¼š"</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="comment">//ç›´åˆ°åœˆä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (helper == firstNode) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//è®©firstNodeå’ŒhelperèŠ‚ç‚¹åŒæ—¶ç§»åŠ¨countNum-1æ¬¡</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; countNum - <span class="number">1</span>; i++) {</span><br><span class="line">                firstNode = firstNode.next;</span><br><span class="line">                helper = helper.next;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//è¿™æ—¶firstNodeçš„èŠ‚ç‚¹å°±æ˜¯è¦å‡ºåœˆçš„èŠ‚ç‚¹</span></span><br><span class="line">            System.out.printf(<span class="string">"%d==&gt;"</span>, firstNode.id);</span><br><span class="line">            <span class="comment">//åˆ é™¤è¦å‡ºåœˆçš„èŠ‚ç‚¹</span></span><br><span class="line">            firstNode = firstNode.next;</span><br><span class="line">            helper.next = firstNode;</span><br><span class="line">        }</span><br><span class="line">        System.out.printf(<span class="string">"%d\n"</span>, firstNode.id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªBodyç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Body</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> Body next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Body</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Body{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213256.png" alt="çº¦ç‘Ÿå¤«ç¯"></p>
<h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a><code>æ ˆ</code></h3><p>äº†è§£åŸºæœ¬åŸç†å³å¯â€¦</p>
<h3 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a><code>äºŒå‰æ ‘</code></h3><h4 id="1-åŸºæœ¬äºŒå‰æ ‘"><a href="#1-åŸºæœ¬äºŒå‰æ ‘" class="headerlink" title="1. åŸºæœ¬äºŒå‰æ ‘"></a>1. åŸºæœ¬äºŒå‰æ ‘</h4><blockquote>
<p>äºŒå‰æ ‘çš„å‰åºã€ä¸­åºã€ååºä¸‰ç§æ–¹å¼ç›¸å…³æ“ä½œï¼š</p>
<ul>
<li>éå†æ¼”ç¤º</li>
<li>æŸ¥æ‰¾æŒ‡å®šèŠ‚ç‚¹æ¼”ç¤º</li>
<li>åˆ é™¤æŒ‡å®šèŠ‚ç‚¹è¦æ±‚å’Œæ¼”ç¤º<ul>
<li>å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥åˆ é™¤ï¼›</li>
<li>å¦‚æœåˆ é™¤çš„æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥åˆ é™¤è¯¥å­æ ‘</li>
</ul>
</li>
</ul>
</blockquote>
<p>äºŒå‰æ ‘ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line">B(1.å®‹æ±Ÿ)</span><br><span class="line">B --&gt;C(2.å´ç”¨)</span><br><span class="line">C --&gt;E(6.å³==æ­¦æ¾)</span><br><span class="line">B --&gt;D(3.å¢ä¿Šä¹‰)</span><br><span class="line">D --&gt;F(5.æ¨æ—­è™)</span><br><span class="line">D --&gt;G(4.æ—å†²)</span><br><span class="line">H[äºŒå‰æ ‘ç¤ºä¾‹å›¾]</span><br></pre></td></tr></tbody></table></figure>
<p>é€’å½’éå†äºŒå‰æ ‘å’ŒæŸ¥æ‰¾æŒ‡å®šèŠ‚ç‚¹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTreeDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºäºŒå‰æ ‘å¯¹è±¡</span></span><br><span class="line">        BinaryTree binaryTree = <span class="keyword">new</span> BinaryTree();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line">        HeroNode root = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"å®‹æ±Ÿ"</span>);</span><br><span class="line">        HeroNode node2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"å´ç”¨"</span>);</span><br><span class="line">        HeroNode node3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"å¢ä¿Šä¹‰"</span>);</span><br><span class="line">        HeroNode node4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"æ—å†²"</span>);</span><br><span class="line">        HeroNode node5 = <span class="keyword">new</span> HeroNode(<span class="number">5</span>, <span class="string">"æ¨æ—­è™"</span>);</span><br><span class="line">        HeroNode node6 = <span class="keyword">new</span> HeroNode(<span class="number">6</span>, <span class="string">"æ­¦æ¾"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        root.setLeft(node2);</span><br><span class="line">        root.setRight(node3);</span><br><span class="line">        node2.setRight(node6);</span><br><span class="line">        node3.setLeft(node5);</span><br><span class="line">        node3.setRight(node4);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•</span></span><br><span class="line">        System.out.println(<span class="string">"=====å‰åºéå†====="</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====ä¸­åºéå†====="</span>);</span><br><span class="line">        binaryTree.infixOrder();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====ååºéå†====="</span>);</span><br><span class="line">        binaryTree.postOrder();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====å‰åºéå†æŸ¥æ‰¾====="</span>);</span><br><span class="line">        binaryTree.preOrderSearch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====ä¸­åºéå†æŸ¥æ‰¾====="</span>);</span><br><span class="line">        binaryTree.infixOrderSearch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====ååºéå†æŸ¥æ‰¾====="</span>);</span><br><span class="line">        binaryTree.postOrderSearch(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====åˆ é™¤æŒ‡å®šèŠ‚ç‚¹====="</span>);</span><br><span class="line">        System.out.println(<span class="string">"åˆ é™¤å‰===&gt;"</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">        binaryTree.remvoeNode(<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">"åˆ é™¤å===&gt;"</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºäºŒå‰æ ‘å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoot</span><span class="params">(HeroNode root)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.root = root;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰åºéå†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.root.preOrder();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"äºŒå‰æ ‘ä¸ºç©º,æ— æ³•éå†"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸­åºéå†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.root.infixOrder();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"äºŒå‰æ ‘ä¸ºç©º,æ— æ³•éå†"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºéå†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.root.postOrder();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"äºŒå‰æ ‘ä¸ºç©º,æ— æ³•éå†"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰åºéå†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            HeroNode heroNode = <span class="keyword">this</span>.root.preOrderSearch(id);</span><br><span class="line">            <span class="keyword">if</span> (heroNode != <span class="keyword">null</span>) {</span><br><span class="line">                System.out.println(<span class="string">"æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;"</span> + heroNode);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                System.out.println(<span class="string">"æŠ±æ­‰! æœªæ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸­åºéå†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            HeroNode heroNode = <span class="keyword">this</span>.root.infixOrderSearch(id);</span><br><span class="line">            <span class="keyword">if</span> (heroNode != <span class="keyword">null</span>) {</span><br><span class="line">                System.out.println(<span class="string">"æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;"</span> + heroNode);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                System.out.println(<span class="string">"æŠ±æ­‰! æœªæ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºéå†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            HeroNode heroNode = <span class="keyword">this</span>.root.postOrderSearch(id);</span><br><span class="line">            <span class="keyword">if</span> (heroNode != <span class="keyword">null</span>) {</span><br><span class="line">                System.out.println(<span class="string">"æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;"</span> + heroNode);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                System.out.println(<span class="string">"æŠ±æ­‰! æœªæ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤äºŒå‰æ ‘èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remvoeNode</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">// å¦‚æœåªæœ‰ä¸€ä¸ªrootå¯¹è±¡èŠ‚ç‚¹,è¿™æ—¶å› è¯¥ç«‹å³åˆ¤æ–­rootæ˜¯ä¸æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹,å¦åˆ™è°ƒç”¨æ–¹æ³•,è¿›è¡Œé€’å½’åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.root.getId() == id) {</span><br><span class="line">                <span class="keyword">this</span>.root = <span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.root.removeNode(id);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"æŠ±æ­‰! è¿™æ˜¯ç©ºæ ‘,æ— æ³•åˆ é™¤"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> HeroNode left; <span class="comment">// å·¦èŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> HeroNode right; <span class="comment">// å³èŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">getLeft</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(HeroNode left)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">getRight</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRight</span><span class="params">(HeroNode right)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"HeroNode{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰åºéå†(é€’å½’)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.left.preOrder();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.right.preOrder();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸­åºéå†(é€’å½’)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.left.infixOrder();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.right.infixOrder();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç»­éå†(é€’å½’)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.left.postOrder();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.right.postOrder();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰åºéå†æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id æŸ¥æ‰¾çš„å¯¹è±¡id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰¾åˆ°è¿”å›HeroNodeå¯¹è±¡, å¦åˆ™è¿”å›null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">preOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹(æ¯æ¬¡è°ƒç”¨å¯¹è±¡ä¸åŒ,thisçš„æŒ‡å‘ä¹Ÿä¸åŒ)æ˜¯ä¸æ˜¯,è‹¥ç›¸ç­‰,åˆ™è¿”å›å¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">"å‰åºæŸ¥æ‰¾æ¬¡æ•°..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.id == id) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º,ä¸ä¸ºç©º,åˆ™é€’å½’å‰åºæŸ¥æ‰¾</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°,åˆ™è¿”å›èŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line">        HeroNode resultNode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.left.preOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¦‚æœä¸´æ—¶èŠ‚ç‚¹å¯¹è±¡ä¸ä¸ºç©º,è¯´æ˜æ‰¾åˆ°,ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (resultNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> resultNode;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å‘å³é€’å½’å‰åºæŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.right.preOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æœ€ç»ˆæŸ¥æ‰¾ç»“æŸ:æ— è®ºæ˜¯å¦æ‰¾åˆ°,éƒ½è¦è¿”å›èŠ‚ç‚¹å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> resultNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸­åºéå†æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">infixOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        HeroNode resultNode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.left.infixOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (resultNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> resultNode;</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"ä¸­åºæŸ¥æ‰¾æ¬¡æ•°..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.id == id) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.right.infixOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> resultNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºéå†æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeroNode <span class="title">postOrderSearch</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        HeroNode resultNode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.left.postOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (resultNode != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> resultNode;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            resultNode = <span class="keyword">this</span>.right.postOrderSearch(id);</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"ååºæŸ¥æ‰¾æ¬¡æ•°..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.id == id) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> resultNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id èŠ‚ç‚¹å¯¹è±¡id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸ä¸ºç©º,å¹¶ä¸”å°±æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹,å°†å°†this.left=null,å¹¶ä¸”ç«‹å³è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.id == id) {</span><br><span class="line">            <span class="keyword">this</span>.left = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸ä¸ºç©º,å¹¶ä¸”å°±æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹,å°†å°†this.right=null,å¹¶ä¸”ç«‹å³è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.id == id) {</span><br><span class="line">            <span class="keyword">this</span>.right = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¦‚æœä¸Šé¢æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹,å°±å‘å·¦å­æ ‘è¿›è¡Œé€’å½’åˆ é™¤</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.left.removeNode(id);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å‘å³è¾¹é€’å½’åˆ é™¤</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.right.removeNode(id);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼šåˆ†æå„ç§æ–¹å¼çš„æŸ¥æ‰¾æ¬¡æ•°</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">=====å‰åºéå†=====</span><br><span class="line">HeroNode{id=1, name='å®‹æ±Ÿ'}</span><br><span class="line">HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">HeroNode{id=6, name='æ­¦æ¾'}</span><br><span class="line">HeroNode{id=3, name='å¢ä¿Šä¹‰'}</span><br><span class="line">HeroNode{id=5, name='æ¨æ—­è™'}</span><br><span class="line">HeroNode{id=4, name='æ—å†²'}</span><br><span class="line">=====ä¸­åºéå†=====</span><br><span class="line">HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">HeroNode{id=6, name='æ­¦æ¾'}</span><br><span class="line">HeroNode{id=1, name='å®‹æ±Ÿ'}</span><br><span class="line">HeroNode{id=5, name='æ¨æ—­è™'}</span><br><span class="line">HeroNode{id=3, name='å¢ä¿Šä¹‰'}</span><br><span class="line">HeroNode{id=4, name='æ—å†²'}</span><br><span class="line">=====ååºéå†=====</span><br><span class="line">HeroNode{id=6, name='æ­¦æ¾'}</span><br><span class="line">HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">HeroNode{id=5, name='æ¨æ—­è™'}</span><br><span class="line">HeroNode{id=4, name='æ—å†²'}</span><br><span class="line">HeroNode{id=3, name='å¢ä¿Šä¹‰'}</span><br><span class="line">HeroNode{id=1, name='å®‹æ±Ÿ'}</span><br><span class="line">=====å‰åºéå†æŸ¥æ‰¾=====</span><br><span class="line">å‰åºæŸ¥æ‰¾æ¬¡æ•°...</span><br><span class="line">å‰åºæŸ¥æ‰¾æ¬¡æ•°...</span><br><span class="line">æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">=====ä¸­åºéå†æŸ¥æ‰¾=====</span><br><span class="line">ä¸­åºæŸ¥æ‰¾æ¬¡æ•°...</span><br><span class="line">æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">=====ååºéå†æŸ¥æ‰¾=====</span><br><span class="line">ååºæŸ¥æ‰¾æ¬¡æ•°...</span><br><span class="line">ååºæŸ¥æ‰¾æ¬¡æ•°...</span><br><span class="line">æ‰¾åˆ°èŠ‚ç‚¹å¯¹è±¡==&gt;HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">=====åˆ é™¤æŒ‡å®šèŠ‚ç‚¹=====</span><br><span class="line">åˆ é™¤å‰===&gt;</span><br><span class="line">HeroNode{id=1, name='å®‹æ±Ÿ'}</span><br><span class="line">HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">HeroNode{id=6, name='æ­¦æ¾'}</span><br><span class="line">HeroNode{id=3, name='å¢ä¿Šä¹‰'}</span><br><span class="line">HeroNode{id=5, name='æ¨æ—­è™'}</span><br><span class="line">HeroNode{id=4, name='æ—å†²'}</span><br><span class="line">åˆ é™¤å===&gt;</span><br><span class="line">HeroNode{id=1, name='å®‹æ±Ÿ'}</span><br><span class="line">HeroNode{id=2, name='å´ç”¨'}</span><br><span class="line">HeroNode{id=6, name='æ­¦æ¾'}</span><br><span class="line">HeroNode{id=3, name='å¢ä¿Šä¹‰'}</span><br><span class="line">HeroNode{id=4, name='æ—å†²'}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-é¡ºåºå­˜å‚¨äºŒå‰æ ‘"><a href="#2-é¡ºåºå­˜å‚¨äºŒå‰æ ‘" class="headerlink" title="2. é¡ºåºå­˜å‚¨äºŒå‰æ ‘"></a>2. é¡ºåºå­˜å‚¨äºŒå‰æ ‘</h4><blockquote>
<p><strong>å®é™…åº”ç”¨ï¼šå †æ’åº</strong></p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å…ƒç´ æ’åˆ—çš„é¡ºåºå’Œæ•°ç»„arrayçš„æ’åˆ—é¡ºåºç›¸åŒ</li>
<li>é€šå¸¸åªè€ƒè™‘å®Œå…¨äºŒå‰æ ‘</li>
<li>ä¸‹æ ‡ä¸ºnçš„å…ƒç´ çš„å·¦å­èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸º 2*n+1</li>
<li>ä¸‹æ ‡ä¸ºnçš„å…ƒç´ çš„å³å­èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸º 2*n+2</li>
<li>ä¸‹æ ‡ä¸ºnçš„å…ƒç´ çš„çˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸º (n-1)/2</li>
</ul>
<p><strong>æ³¨æ„ï¼šnï¼šè¡¨ç¤ºäºŒå‰æ ‘ä¸­çš„çš„ç¬¬å‡ ä¸ªå…ƒç´ ï¼ˆå…ƒç´ ä¸‹æ ‡ï¼‰ï¼ŒæŒ‰ç…§0å¼€å§‹ç¼–å·ï¼Œå’Œæ•°ç»„çš„å…ƒç´ ä¸‹æ ‡ç¼–å·ç›¸åŒ</strong></p>
</blockquote>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line">a(n==0 node1) --&gt;b(n==1 å·¦node2)</span><br><span class="line">a(n==0 node1) --&gt;c(n==2 å³node3)</span><br><span class="line">b(n==1 å·¦node2) --&gt;d(n==3 å·¦node4)</span><br><span class="line">b(n==1 å·¦node2) --&gt;e(n==4 å³node5)</span><br><span class="line">c(n==2 å³node3) --&gt;f(n==5 å·¦node6)</span><br><span class="line">c(n==2 å³node3) --&gt;g(n==6 å³node7)</span><br><span class="line">h[é¡ºåºå­˜å‚¨äºŒå‰æ ‘]</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä¸Šå›¾çš„é¡ºåºå­˜å‚¨äºŒå‰æ ‘çš„å…ƒç´ å­˜å‚¨é¡ºåºå°±ç›¸å½“äºarrayæ•°ç»„</p>
<p>array = [â€œnode1â€, â€œnode2â€, â€œnode3â€, â€œnode4â€, â€œnode5â€, â€œnode6â€, â€œnode7â€]</p>
</blockquote>
<p>å®ç°ï¼šä»¥éå†äºŒå‰æ ‘çš„æ–¹å¼å®ç°arrayæ•°ç»„å…ƒç´ çš„è¾“å‡º</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayBinaryTreeDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">        String[] array = <span class="keyword">new</span> String[]{<span class="string">"node1"</span>, <span class="string">"node2"</span>, <span class="string">"node3"</span>, <span class="string">"node4"</span>, <span class="string">"node5"</span>, <span class="string">"node6"</span>, <span class="string">"node7"</span>};</span><br><span class="line"></span><br><span class="line">        ArrayBinaryTree binaryTree = <span class="keyword">new</span> ArrayBinaryTree(array);</span><br><span class="line">        System.out.println(<span class="string">"=====å‰åºéå†====="</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">        System.out.println(<span class="string">"\n=====ä¸­åºéå†====="</span>);</span><br><span class="line">        binaryTree.infixOrder();</span><br><span class="line">        System.out.println(<span class="string">"\n=====ååºéå†====="</span>);</span><br><span class="line">        binaryTree.postOrder();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayBinaryTree</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayBinaryTree</span><span class="params">(String[] array)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.array = array;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰åºéå†æ–¹æ³•é‡è½½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.preOrder(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°ç»„çš„å‰åºéå†(é¡ºåºå­˜å‚¨äºŒå‰æ ‘)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index å¼€å§‹çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length == <span class="number">0</span>) {</span><br><span class="line">            System.out.println(<span class="string">"æ•°ç»„ä¸ºç©º,æ— æ³•æŒ‰ç…§é¡ºåºå­˜å‚¨äºŒå‰æ ‘è¿›è¡Œéå†"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰èŠ‚ç‚¹å…ƒç´ </span></span><br><span class="line">        System.out.print(array[index] + <span class="string">"\t"</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸‹æ ‡ä¸è¶Šç•Œ,åˆ™è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">1</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.preOrder(index * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸‹æ ‡ä¸è¶Šç•Œ,åˆ™è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">2</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.preOrder(index * <span class="number">2</span> + <span class="number">2</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.infixOrder(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸­åºéå†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">(<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length == <span class="number">0</span>) {</span><br><span class="line">            System.out.println(<span class="string">"æ•°ç»„ä¸ºç©º,æ— æ³•æŒ‰ç…§é¡ºåºå­˜å‚¨äºŒå‰æ ‘è¿›è¡Œéå†"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">1</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.infixOrder(index * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        System.out.print(array[index] + <span class="string">"\t"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">2</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.infixOrder(index * <span class="number">2</span> + <span class="number">2</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.postOrder(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length == <span class="number">0</span>) {</span><br><span class="line">            System.out.println(<span class="string">"æ•°ç»„ä¸ºç©º,æ— æ³•æŒ‰ç…§é¡ºåºå­˜å‚¨äºŒå‰æ ‘è¿›è¡Œéå†"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">1</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.postOrder(index * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> ((index * <span class="number">2</span> + <span class="number">2</span>) &lt; array.length) {</span><br><span class="line">            <span class="keyword">this</span>.postOrder(index * <span class="number">2</span> + <span class="number">2</span>);</span><br><span class="line">        }</span><br><span class="line">        System.out.print(array[index] + <span class="string">"\t"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">=====å‰åºéå†=====</span><br><span class="line">node1	node2	node4	node5	node3	node6	node7	</span><br><span class="line">=====ä¸­åºéå†=====</span><br><span class="line">node4	node2	node5	node1	node6	node3	node7	</span><br><span class="line">=====ååºéå†=====</span><br><span class="line">node4	node5	node2	node6	node7	node3	node1</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ç©æ„åé¢å¤ªä»–å¦ˆéš¾äº†<span class="github-emoji"><span>ğŸ˜­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>â€¦</p>
<h3 id="å¸¸ç”¨æ’åºç®—æ³•"><a href="#å¸¸ç”¨æ’åºç®—æ³•" class="headerlink" title="å¸¸ç”¨æ’åºç®—æ³•"></a><code>å¸¸ç”¨æ’åºç®—æ³•</code></h3><h4 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213317.png" alt="å†’æ³¡æ’åº"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªéœ€è¦æ’åºçš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">80000</span>];</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">80000</span>; i++) {</span><br><span class="line">            array[i] = random.nextInt(<span class="number">8000000</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        bubbleSort(array);</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"80000ä¸ªæ•°æ®è€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†’æ³¡æ’åº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">        <span class="comment">//å†’æ³¡æ’åº:æ¯ä¸€è¶Ÿæ’åºéƒ½ç¡®å®šä¸€ä¸ªæœ€å¤§çš„æ”¾åˆ°æœ€åï¼ˆä¹Ÿå°±æ˜¯å†’æ³¡åˆ°æœ€ä¸Šé¢ï¼‰</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>; <span class="comment">//åœ¨ç¬¬nè¶Ÿæ’åºè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰è¿‡ä»»æ„ä¸€æ¬¡äº¤æ¢ï¼ˆä¹Ÿå°±æ˜¯å¦‚æœåœ¨ä¸€è¶Ÿæ’åºä¸­æ²¡æœ‰è¿›è¡Œè¿‡äº¤æ¢ï¼Œé‚£ä¹ˆè¯æ˜æ’åºå·²ç»å®Œæˆï¼Œåé¢çš„è‹¥å¹²è¶Ÿçš„æ’åºæ“ä½œä¸éœ€è¦å†è¿›è¡Œäº†ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length - <span class="number">1</span>; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; array.length - i - <span class="number">1</span>; j++) {</span><br><span class="line">                <span class="keyword">if</span> (array[j] &gt; array[j + <span class="number">1</span>]) {</span><br><span class="line">                    <span class="comment">//å¦‚æœè¿›è¡Œè¿‡äº¤æ¢ï¼Œå°±ç½®ä¸ºtrue</span></span><br><span class="line">                    flag = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">int</span> temp = array[j];</span><br><span class="line">                    array[j] = array[j + <span class="number">1</span>];</span><br><span class="line">                    array[j + <span class="number">1</span>] = temp;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å¦‚æœæ²¡æœ‰äº¤æ¢ï¼Œé‚£ä¹ˆå°±ç›´æ¥é€€å‡ºå¤§å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (!flag) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213321.png" alt="å†’æ³¡æ’åº"></p>
<h4 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213324.png" alt="é€‰æ‹©æ’åº"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªéœ€è¦æ’åºçš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">80000</span>];</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">80000</span>; i++) {</span><br><span class="line">            array[i] = random.nextInt(<span class="number">8000000</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        exchangeSort(array);</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"80000ä¸ªæ•°æ®è€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æ’åºï¼šæ¯ä¸€æ¬¡éƒ½æ‰¾åˆ°è¾ƒå°çš„æ•°æ”¾åœ¨æœ€å‰é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exchangeSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length - <span class="number">1</span>; i++) {</span><br><span class="line">            <span class="keyword">int</span> min = array[i];</span><br><span class="line">            <span class="keyword">int</span> minIndex = i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; array.length; j++) {</span><br><span class="line">                <span class="keyword">if</span> (min &gt; array[j]) {</span><br><span class="line">                    min = array[j];</span><br><span class="line">                    minIndex = j;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å¦‚æœæœ€å°å€¼çš„ä¸‹æ ‡å’Œå½“å‰å¤§å¾ªç¯çš„ç´¢å¼•iä¸ç›¸ç­‰æ—¶ï¼Œå°†æœ€å°å€¼èµ‹å€¼ç»™array[i]</span></span><br><span class="line">            <span class="keyword">if</span> (minIndex != i) {</span><br><span class="line">                array[minIndex] = array[i];</span><br><span class="line">                array[i] = min;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213327.png" alt="äº¤æ¢æ’åº"></p>
<h4 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h4><p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200604154503674.png" alt="æ’å…¥æ’åº"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ’åº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; array.length; i++) {</span><br><span class="line">            <span class="comment">//é¦–å…ˆå°†å¾…æ’å…¥çš„æ•°æš‚æ—¶ä¿å­˜ï¼ˆä¹Ÿå°±æ˜¯æ¯æ¬¡è¦è¿›è¡Œæ’å…¥çš„æ•°ï¼‰</span></span><br><span class="line">            <span class="keyword">int</span> insertVal = array[i];</span><br><span class="line">            <span class="comment">//å®šä¹‰å¾…æ’å…¥æ•°å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span></span><br><span class="line">            <span class="keyword">int</span> insertIndex = i - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//insertIndex &gt;= 0:ä¿è¯åœ¨ç»™insertvalæ‰¾æ’å…¥ä½ç½®æ—¶ï¼Œä¸‹æ ‡ä¸è¶Šç•Œ</span></span><br><span class="line">            <span class="comment">//insertVal &lt; array[insertIndex]:è¯´æ˜è¿˜æœªæ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">            <span class="comment">//æ³¨æ„ï¼šï¼ˆå½“æ¡ä»¶æ”¹ä¸ºï¼šinsertVal &gt; array[insertIndex]æ—¶ï¼Œæ˜¯ä»å¤§åˆ°å°æ’åºçš„ï¼‰</span></span><br><span class="line">            <span class="keyword">while</span> (insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; array[insertIndex]) {</span><br><span class="line">                <span class="comment">//ä¾æ¬¡å°†å‰é¢æ’å¥½åºçš„è¿›è¡Œåç§»ä¸€ä½ï¼ŒçŸ¥é“ä¸æ»¡è¶³å¾ªç¯æ¡ä»¶</span></span><br><span class="line">                array[insertIndex + <span class="number">1</span>] = array[insertIndex];</span><br><span class="line">                insertIndex--;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//é€€å‡ºwhileåï¼Œè¯´æ˜å·²æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œç›´æ¥è¿›è¡Œå€¼çš„æ’å…¥</span></span><br><span class="line">            array[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213333.png" alt="æ’å…¥æ’åº"></p>
<h4 id="å¸Œå°”æ’åº-ä¸å¤ªæ˜ç™½-ä½†æ•ˆç‡æé«˜"><a href="#å¸Œå°”æ’åº-ä¸å¤ªæ˜ç™½-ä½†æ•ˆç‡æé«˜" class="headerlink" title="å¸Œå°”æ’åº(ä¸å¤ªæ˜ç™½,ä½†æ•ˆç‡æé«˜)"></a>å¸Œå°”æ’åº(ä¸å¤ªæ˜ç™½,ä½†æ•ˆç‡æé«˜)</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213336.png" alt="å¸Œå°”æ’åº"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¸Œå°”æ’åº--ç§»ä½æ³•ï¼ˆä¹Ÿå°±æ˜¯åˆ©ç”¨æ’å…¥æ’åºçš„æ€æƒ³ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSortInsert</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">        <span class="comment">//å¸Œå°”æ’åºåˆ†ç»„çš„é™¤æ•°å›ºå®šå€¼ä¸º2</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> divisor = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> step = array.length / divisor; step &gt; <span class="number">0</span>; step /= divisor) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = step; i &lt; array.length; i++) {</span><br><span class="line">                <span class="keyword">int</span> insertIndex = i;</span><br><span class="line">                <span class="keyword">int</span> insertTemp = array[insertIndex];</span><br><span class="line">                <span class="keyword">if</span> (array[insertIndex] &lt; array[insertIndex - step]) {</span><br><span class="line">                    <span class="keyword">while</span> (insertIndex - step &gt;= <span class="number">0</span> &amp;&amp; insertTemp &lt; array[insertIndex - step]) {</span><br><span class="line">                        array[insertIndex] = array[insertIndex - step];</span><br><span class="line">                        insertIndex -= step;</span><br><span class="line">                    }</span><br><span class="line">                    array[insertIndex] = insertTemp;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200604164824547.png" alt="å¸Œå°”æ’åº"></p>
<h4 id="å½’å¹¶æ’åºï¼ˆé€’å½’æ€æƒ³ï¼Œæ•ˆç‡æé«˜ï¼‰"><a href="#å½’å¹¶æ’åºï¼ˆé€’å½’æ€æƒ³ï¼Œæ•ˆç‡æé«˜ï¼‰" class="headerlink" title="å½’å¹¶æ’åºï¼ˆé€’å½’æ€æƒ³ï¼Œæ•ˆç‡æé«˜ï¼‰"></a>å½’å¹¶æ’åºï¼ˆé€’å½’æ€æƒ³ï¼Œæ•ˆç‡æé«˜ï¼‰</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213354.png" alt="å½’å¹¶æ’åº"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½’å¹¶æ’åº--åˆ†è§£å’Œåˆå¹¶çš„å®Œæ•´ç»“åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> temp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergeSort</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span>[] temp)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (left &lt; right) {</span><br><span class="line">            <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">//å‘å·¦é€’å½’åˆ†è§£</span></span><br><span class="line">            MergeSort(array, left, mid, temp);</span><br><span class="line">            <span class="comment">//å‘å³é€’å½’åˆ†è§£</span></span><br><span class="line">            MergeSort(array, mid + <span class="number">1</span>, right, temp);</span><br><span class="line">            <span class="comment">//åˆå¹¶</span></span><br><span class="line">            merge(array, left, mid, right, temp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½’å¹¶æ’åº--åˆå¹¶çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array åŸå§‹æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left å·¦è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mid ä¸­é—´ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right å³è¾¹æœ‰åºåºåˆ—çš„æœ€åç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> temp è¾…åŠ©æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> mid, <span class="keyword">int</span> right, <span class="keyword">int</span>[] temp)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> i = left;</span><br><span class="line">        <span class="keyword">int</span> rightInitialIndex = mid + <span class="number">1</span>; <span class="comment">//å³è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">0</span>; <span class="comment">//æŒ‡å‘tempæ•°ç»„çš„å½“å‰ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.å…ˆæŠŠå·¦å³ä¸¤è¾¹çš„æœ‰åºåºåˆ—æŒ‰ç…§è§„åˆ™å¡«å……åˆ°tempæ•°ç»„ä¸­</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; rightInitialIndex &lt;= right) {</span><br><span class="line">            <span class="keyword">if</span> (array[i] &lt;= array[rightInitialIndex]) {</span><br><span class="line">                temp[t] = array[i];</span><br><span class="line">                t++;</span><br><span class="line">                i++;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                temp[t] = array[rightInitialIndex];</span><br><span class="line">                t++;</span><br><span class="line">                rightInitialIndex++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//2.æŠŠæ‰€æœ‰æŸä¸€è¾¹æ‰€æœ‰å‰©ä½™çš„æ•°æ®ä¸€æ¬¡å…¨éƒ¨å¡«å……åˆ°tempä¸­</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid) {</span><br><span class="line">            temp[t] = array[i];</span><br><span class="line">            t++;</span><br><span class="line">            i++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (rightInitialIndex &lt;= right) {</span><br><span class="line">            temp[t] = array[rightInitialIndex];</span><br><span class="line">            t++;</span><br><span class="line">            rightInitialIndex++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//3.å°†å½“å‰tempæ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´åˆ°arrayä¸­å»</span></span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> leftTemp = left;</span><br><span class="line">        <span class="keyword">while</span> (leftTemp &lt;= right) {</span><br><span class="line">            array[leftTemp] = temp[t];</span><br><span class="line">            leftTemp++;</span><br><span class="line">            t++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213406.png" alt="å½’å¹¶æ’åº"></p>
<h4 id="åŸºæ•°æ’åºï¼ˆæ•ˆç‡è¾ƒé«˜ï¼Œæ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«ä¼šå‘ç”Ÿå†…å­˜çˆ†ç‚¸ï¼‰"><a href="#åŸºæ•°æ’åºï¼ˆæ•ˆç‡è¾ƒé«˜ï¼Œæ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«ä¼šå‘ç”Ÿå†…å­˜çˆ†ç‚¸ï¼‰" class="headerlink" title="åŸºæ•°æ’åºï¼ˆæ•ˆç‡è¾ƒé«˜ï¼Œæ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«ä¼šå‘ç”Ÿå†…å­˜çˆ†ç‚¸ï¼‰"></a>åŸºæ•°æ’åºï¼ˆæ•ˆç‡è¾ƒé«˜ï¼Œæ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«ä¼šå‘ç”Ÿå†…å­˜çˆ†ç‚¸ï¼‰</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213409.png" alt="åŸºæ•°æ’åº"></p>
<p><img src="C:\Users\é©¬æ»¨\Desktop\typoraImages/image-20200604191532566.png" alt="åŸºæ•°æ’åº"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºæ•°æ’åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bucketSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> max = array[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) {</span><br><span class="line">        <span class="keyword">if</span> (max &lt; array[i]) {</span><br><span class="line">            max = array[i];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å·§å¦™çš„åˆ©ç”¨å­—ç¬¦ä¸²çš„é•¿åº¦ä»£æ›¿æœ€å¤§å€¼çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">int</span> arrayMaxLength = (max + <span class="string">""</span>).length();</span><br><span class="line">    <span class="comment">//åŸºæ•°æ’åº</span></span><br><span class="line">    <span class="comment">//å›ºå®šï¼šå®šä¹‰10ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶çš„å®¹é‡æ˜¯æ•°ç»„çš„æœ€å¤§å€¼ï¼ˆä»¥ç©ºé—´æ¢æ—¶é—´ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span>[][] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>][array.length];</span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼šç”¨äºç»Ÿè®¡æ¯ä¸ªæ¡¶ä¸­æ”¾å…¥å…ƒç´ çš„æ•°é‡ï¼Œæ¡¶ä¸­å„ä¸ªå…ƒç´ é»˜è®¤å€¼æ˜¯0</span></span><br><span class="line">    <span class="keyword">int</span>[] bucketElementsCount = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">1</span>; i &lt; arrayMaxLength; i++, n *= <span class="number">10</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> value : array) {</span><br><span class="line">            <span class="comment">//è·å–æ¯ä¸ªå…ƒç´ å¯¹åº”ä½çš„å€¼</span></span><br><span class="line">            <span class="keyword">int</span> digitOfElement = value / n % <span class="number">10</span>;</span><br><span class="line">            <span class="comment">//æ”¾å…¥å¯¹åº”çš„æ¡¶ä¸­</span></span><br><span class="line">            <span class="comment">//bucketElementsCount[digitOfElement]++ï¼šç»Ÿè®¡æ•°é‡çš„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œåœ¨è¿™é‡Œå°±æŠŠä»–ç†è§£æˆç»Ÿè®¡å¯¹åº”æ¡¶ä¸­å…ƒç´ æ•°é‡çš„ç´¢å¼•</span></span><br><span class="line">            bucket[digitOfElement][bucketElementsCount[digitOfElement]++] = value;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å–å‡ºæ•°æ®æ”¾å…¥åŸæ•°ç»„ä¸­</span></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//éå†æ¯ä¸€ä¸ªæ¡¶</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bucket.length; k++) {</span><br><span class="line">            <span class="keyword">if</span> (bucketElementsCount[k] &gt; <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; bucketElementsCount[k]; m++) {</span><br><span class="line">                    array[index++] = bucket[k][m];</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ³¨æ„ï¼šç¬¬ä¸€è½®å¤„ç†åï¼Œéœ€è¦å°†æ¯ä¸ªæ¡¶ä¸­ç»Ÿè®¡çš„æ•°é‡bucketElementsCount[k]ç½®ä¸º0</span></span><br><span class="line">            bucketElementsCount[k] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213413.png" alt="åŸºæ•°æ’åº"></p>
<h3 id="ç»å…¸æŸ¥æ‰¾ç®—æ³•"><a href="#ç»å…¸æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="ç»å…¸æŸ¥æ‰¾ç®—æ³•"></a><code>ç»å…¸æŸ¥æ‰¾ç®—æ³•</code></h3><h4 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213415.png" alt="äºŒåˆ†æŸ¥æ‰¾"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">		<span class="comment">//æµ‹è¯•ç¨‹åºï¼Œä¸å¿…åœ¨æ„ï¼ï¼ï¼</span></span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">80000</span>];</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">80000</span>; i++) {</span><br><span class="line">            array[i] = random.nextInt(<span class="number">8000000</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰ä¸€ä¸ªæ•°ç»„åˆ°éšæœºç”Ÿæˆçš„æ•°ç»„ä¸­ï¼šæµ‹è¯•æŸ¥æ‰¾é€Ÿåº¦</span></span><br><span class="line">        array[<span class="number">6666</span>] = <span class="number">999999</span>;</span><br><span class="line">        array[<span class="number">7777</span>] = <span class="number">999999</span>;</span><br><span class="line">        array[<span class="number">55786</span>] = <span class="number">999999</span>;</span><br><span class="line"></span><br><span class="line">        Sort sort = <span class="keyword">new</span> Sort();</span><br><span class="line">        sort.bucketSort(array);</span><br><span class="line">        List&lt;Integer&gt; indexList = binarySearchSame(array, <span class="number">0</span>, array.length - <span class="number">1</span>, <span class="number">999999</span>);</span><br><span class="line">        <span class="keyword">if</span> (indexList != <span class="keyword">null</span>) {</span><br><span class="line">            indexList.forEach(System.out::println);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"æœªæ‰¾åˆ°"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äºŒåˆ†æŸ¥æ‰¾ï¼šåŸå§‹æ•°ç»„å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array åŸå§‹æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left å·¦è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right å³è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> findVal è¦æŸ¥æ‰¾çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰¾åˆ°è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å›-1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> findVal)</span> </span>{</span><br><span class="line">        <span class="comment">//å½“left &gt; rightæ—¶ï¼šè¯´æ˜é€’å½’å®ŒçœŸä¸ªæ•°ç»„ï¼Œæ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">        <span class="keyword">if</span> (left &gt; right) {</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿›è¡Œé€’å½’æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> midVal = array[mid];</span><br><span class="line">        <span class="keyword">if</span> (findVal &lt; midVal) {</span><br><span class="line">            <span class="comment">//å‘å·¦è¾¹é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">return</span> binarySearch(array, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (findVal &gt; midVal) {</span><br><span class="line">            <span class="comment">//å‘å³é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">return</span> binarySearch(array, mid + <span class="number">1</span>, right, findVal);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//å¦‚æœåˆšå¥½ç­‰äºmidVal,è¿æ°”è¶³å¤Ÿå¥½ï¼Œç›´æ¥è¿”å›ä¸‹æ ‡å³å¯</span></span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äºŒåˆ†æŸ¥æ‰¾ï¼šæŸ¥æ‰¾æœ‰åºæ•°ç»„ä¸­æ‰€æœ‰ç¬¦åˆfindValçš„å€¼ï¼Œå¹¶è¿”å›ä¸‹æ ‡é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> findVal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰¾åˆ°è¿”å›ä¸‹æ ‡é›†åˆï¼Œå¦åˆ™è¿”å›null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title">binarySearchSame</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> findVal)</span> </span>{</span><br><span class="line">        <span class="comment">//å½“left &gt; rightæ—¶ï¼šè¯´æ˜é€’å½’å®ŒçœŸä¸ªæ•°ç»„ï¼Œæ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">        <span class="keyword">if</span> (left &gt; right) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿›è¡Œé€’å½’æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> midVal = array[mid];</span><br><span class="line">        <span class="keyword">if</span> (findVal &lt; midVal) {</span><br><span class="line">            <span class="comment">//å‘å·¦è¾¹é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">return</span> binarySearchSame(array, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (findVal &gt; midVal) {</span><br><span class="line">            <span class="comment">//å‘å³é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">return</span> binarySearchSame(array, mid + <span class="number">1</span>, right, findVal);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//åœ¨æ‰¾åˆ°midç´¢å¼•å€¼åï¼Œä¸è¦ç«‹å³è¿”å›ï¼Œ</span></span><br><span class="line">            <span class="comment">//åº”è¯¥å‘å·¦æˆ–è€…å‘å³ç»§ç»­æ‰«ææŸ¥æ‰¾findValï¼ŒçŸ¥é“å°†æ•°ç»„ä¸­æ‰€æœ‰çš„findValæŸ¥æ‰¾å®Œæ¯•å¹¶è¿”å›ä¸‹æ ‡é›†åˆ</span></span><br><span class="line">            List&lt;Integer&gt; indexList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">//å‘å·¦æ‰«æ</span></span><br><span class="line">            <span class="keyword">int</span> tempIndex = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (tempIndex &gt;= <span class="number">0</span> &amp;&amp; array[tempIndex] == findVal) {</span><br><span class="line">                indexList.add(tempIndex--);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å‘å³æ‰«æ</span></span><br><span class="line">            tempIndex = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (tempIndex &lt;= array.length - <span class="number">1</span> &amp;&amp; array[tempIndex] == findVal) {</span><br><span class="line">                indexList.add(tempIndex++);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ³¨æ„ï¼šåŠ ä¸Šç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å€¼çš„ç´¢å¼•mid</span></span><br><span class="line">            indexList.add(mid);</span><br><span class="line">            <span class="keyword">return</span> indexList;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ’å€¼æŸ¥æ‰¾"><a href="#æ’å€¼æŸ¥æ‰¾" class="headerlink" title="æ’å€¼æŸ¥æ‰¾"></a>æ’å€¼æŸ¥æ‰¾</h4><p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213421.png" alt="æ’å€¼æŸ¥æ‰¾"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213442.png" alt="æ’å€¼æŸ¥æ‰¾"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å€¼æŸ¥æ‰¾ï¼šæ±‚midçš„å…¬å¼ï¼ˆå›ºå®šçš„è‡ªé€‚åº”å…¬å¼ï¼‰å’ŒäºŒåˆ†æŸ¥æ‰¾çš„midæ±‚æ³•ä¸ä¸€æ ·ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒåŸºæœ¬ä¸€è‡´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> findVal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">insertValueSearch</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> findVal)</span> </span>{</span><br><span class="line">        <span class="comment">//å½“left &gt; rightæ—¶ï¼šè¯´æ˜é€’å½’å®ŒçœŸä¸ªæ•°ç»„ï¼Œæ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">        <span class="comment">//æˆ–è€…è¦æŸ¥æ‰¾çš„å€¼å°äºæœ‰åºæ•°ç»„ä¸­çš„æœ€å°å€¼||å¤§äºæœ€å¤§å€¼ï¼Œä¹Ÿæ˜¯æ— æ³•æ‰¾åˆ°çš„ï¼Œå¯ä»¥ç›´æ¥ç»ˆæ­¢è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (left &gt; right || findVal &lt; array[<span class="number">0</span>] || findVal &gt; array[array.length - <span class="number">1</span>]) {</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å›ºå®šå…¬å¼ï¼šæ±‚mid</span></span><br><span class="line">        <span class="keyword">int</span> mid = left + (right - left) * (findVal - array[left]) / (array[right] - array[left]);</span><br><span class="line">        <span class="keyword">int</span> midVal = array[mid];</span><br><span class="line">        <span class="keyword">if</span> (findVal &lt; midVal) {</span><br><span class="line">            <span class="keyword">return</span> insertValueSearch(array, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (findVal &gt; midVal) {</span><br><span class="line">            <span class="keyword">return</span> insertValueSearch(array, mid + <span class="number">1</span>, right, findVal);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ–æ³¢é‚£å¥‘ï¼ˆé»„é‡‘åˆ†å‰²æ³•ï¼‰æŸ¥æ‰¾-ï¼ˆéš¾ä»¥ç†è§£ï¼Œä»£ç æ”¾åœ¨è¿™ï¼‰"><a href="#æ–æ³¢é‚£å¥‘ï¼ˆé»„é‡‘åˆ†å‰²æ³•ï¼‰æŸ¥æ‰¾-ï¼ˆéš¾ä»¥ç†è§£ï¼Œä»£ç æ”¾åœ¨è¿™ï¼‰" class="headerlink" title="æ–æ³¢é‚£å¥‘ï¼ˆé»„é‡‘åˆ†å‰²æ³•ï¼‰æŸ¥æ‰¾==ï¼ˆéš¾ä»¥ç†è§£ï¼Œä»£ç æ”¾åœ¨è¿™ï¼‰"></a>æ–æ³¢é‚£å¥‘ï¼ˆé»„é‡‘åˆ†å‰²æ³•ï¼‰æŸ¥æ‰¾==ï¼ˆéš¾ä»¥ç†è§£ï¼Œä»£ç æ”¾åœ¨è¿™ï¼‰</h4><p>ç›´æ¥ä¸Šä»£ç </p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–æ³¢é‚£å¥‘æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key è¦æŸ¥æ‰¾çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fibSearch</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> hight = array.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>; <span class="comment">//è¡¨ç¤ºæ–æ³¢é‚£å¥‘åˆ†å‰²æ•°å€¼çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">int</span> mid; <span class="comment">//å­˜æ”¾midçš„å€¼</span></span><br><span class="line">    <span class="keyword">int</span>[] f = fib(); <span class="comment">//è·å–æ–æ³¢é‚£å¥‘æ•°åˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–æ–æ³¢é‚£å¥‘åˆ†å‰²æ•°å€¼çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">while</span> (hight &gt; f[k] - <span class="number">1</span>) {</span><br><span class="line">        k++;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">int</span>[] temp = Arrays.copyOf(array, f[k]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = hight + <span class="number">1</span>; i &lt; temp.length; i++) {</span><br><span class="line">        temp[i] = array[hight];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¼€å§‹æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= hight) {</span><br><span class="line">        mid = low + f[k - <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; temp[mid]) {</span><br><span class="line">            hight = mid - <span class="number">1</span>;</span><br><span class="line">            k--;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (key &gt; temp[mid]) {</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">            k -= <span class="number">2</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span> (mid &lt; hight) {</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> hight;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¾ªç¯ç»“æŸæœªæ‰¾åˆ°ï¼Œè¿”å›-1</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›æ–æ³¢é‚£å¥‘æ•°åˆ— maxSizeçš„å¤§å°è§†æƒ…å†µè€Œå®š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] fib() {</span><br><span class="line">    <span class="keyword">int</span>[] fibArray = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">    fibArray[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    fibArray[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; fibArray.length; i++) {</span><br><span class="line">        fibArray[i] = fibArray[i - <span class="number">1</span>] + fibArray[i - <span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fibArray;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a><code>å“ˆå¸Œè¡¨</code></h3><p><strong>åŠŸèƒ½ï¼š</strong>åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åšç¼“å­˜ä½¿ç”¨ï¼Œç›¸å½“äºç®€å•çš„redisçš„ä½œç”¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213447.png" alt="å“ˆå¸Œè¡¨åº”ç”¨å®ä¾‹"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        HashTab hashTab = <span class="keyword">new</span> HashTab(<span class="number">7</span>);</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            System.out.println(<span class="string">"add: æ·»åŠ å‘˜å·¥"</span>);</span><br><span class="line">            System.out.println(<span class="string">"find: æŸ¥æ‰¾å‘˜å·¥"</span>);</span><br><span class="line">            System.out.println(<span class="string">"list: æ˜¾ç¤ºå‘˜å·¥"</span>);</span><br><span class="line">            System.out.println(<span class="string">"exit: é€€å‡ºç³»ç»Ÿ"</span>);</span><br><span class="line">            <span class="keyword">switch</span> (scanner.next()) {</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"add"</span>:</span><br><span class="line">                    System.out.println(<span class="string">"è¯·è¾“å…¥å‘˜å·¥id"</span>);</span><br><span class="line">                    <span class="keyword">int</span> id = scanner.nextInt();</span><br><span class="line">                    System.out.println(<span class="string">"è¯·è¾“å…¥å‘˜å·¥å§“å"</span>);</span><br><span class="line">                    String name = scanner.next();</span><br><span class="line">                    Emp emp = <span class="keyword">new</span> Emp(id, name);</span><br><span class="line">                    hashTab.add(emp);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"find"</span>:</span><br><span class="line">                    System.out.println(<span class="string">"è¯·è¾“å…¥å‘˜å·¥id"</span>);</span><br><span class="line">                    <span class="keyword">int</span> findId = scanner.nextInt();</span><br><span class="line">                    hashTab.findEmpById(findId);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"list"</span>:</span><br><span class="line">                    hashTab.list();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"exit"</span>:</span><br><span class="line">                    scanner.close();</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºHashTabï¼šç®¡ç†å¤šæ¡é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTab</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EmpLinkedList[] empLinkedListArray;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTab</span><span class="params">(<span class="keyword">int</span> size)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">        <span class="keyword">this</span>.empLinkedListArray = <span class="keyword">new</span> EmpLinkedList[size];</span><br><span class="line">        <span class="comment">//åˆ†åˆ«åˆå§‹åŒ–æ¯ä¸€æ¡é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) {</span><br><span class="line">            empLinkedListArray[i] = <span class="keyword">new</span> EmpLinkedList();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¼–å†™:æ•£åˆ—å‡½æ•°è§„åˆ™(å–æ¨¡æ³•)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashFun</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id % <span class="keyword">this</span>.size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ å‘˜å·¥</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Emp emp)</span> </span>{</span><br><span class="line">        <span class="comment">//æ ¹æ®å‘˜å·¥idï¼Œç¡®å®šè¯¥å‘˜å·¥åº”è¯¥æ·»åŠ åˆ°é‚£æ¡é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">int</span> empLinkedListNum = <span class="keyword">this</span>.hashFun(emp.id);</span><br><span class="line">        <span class="comment">//è°ƒç”¨é“¾è¡¨çš„æ–¹æ³•ï¼šå°†empæ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„é“¾è¡¨ä¸­å»</span></span><br><span class="line">        empLinkedListArray[empLinkedListNum].add(emp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†å“ˆå¸Œè¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.size; i++) {</span><br><span class="line">            empLinkedListArray[i].list(i + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®idæŸ¥æ‰¾å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findEmpById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="comment">//ä½¿ç”¨æ•£åˆ—å‡½æ•°ï¼šç¡®å®šåˆ°é‚£æ¡é“¾è¡¨æŸ¥æ‰¾ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">int</span> empLinkedListNum = hashFun(id);</span><br><span class="line">        Emp emp = empLinkedListArray[empLinkedListNum].findEmpById(id);</span><br><span class="line">        <span class="keyword">if</span> (emp != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.printf(<span class="string">"åœ¨ç¬¬%dæ¡é“¾è¡¨ä¸­æ‰¾åˆ°id=%dçš„å‘˜å·¥\n"</span>, (empLinkedListNum + <span class="number">1</span>), emp.id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"å“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨è¯¥å‘˜å·¥ä¿¡æ¯ï¼"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘˜å·¥</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> Emp next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Emp</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Emp{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨ç¤ºä¸€æ¡é“¾è¡¨ï¼šæ— å¤´ç»“ç‚¹çš„é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmpLinkedList</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//head:å¹¶ä¸æ˜¯ç©ºçš„å¤´èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥æŒ‡å‘ç¬¬ä¸€ä¸ªEmpå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Emp head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ å‘˜å·¥</span></span><br><span class="line">    <span class="comment">//å‡å®šï¼šidè‡ªå¢é•¿ï¼Œæˆ‘ä»¬æ·»åŠ å‘˜å·¥çš„æ—¶å€™ï¼Œåªéœ€è¦ç›´æ¥åŠ è½½é“¾è¡¨çš„æœ€åä¸€ä¸ªå³å¯ï¼Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Emp emp)</span> </span>{</span><br><span class="line">        <span class="comment">//æ·»åŠ ç¬¬ä¸€ä¸ªå‘˜å·¥</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">            head = emp;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªå‘˜å·¥</span></span><br><span class="line">        Emp currentEmp = head;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">if</span> (currentEmp.next == <span class="keyword">null</span>) {</span><br><span class="line">                currentEmp.next = emp;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            currentEmp = currentEmp.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†å‘˜å·¥é“¾è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">(<span class="keyword">int</span> no)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.printf(<span class="string">"ç¬¬%dæ¡é“¾è¡¨ä¸ºç©ºï¼\n"</span>, no);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        System.out.printf(<span class="string">"ç¬¬%dæ¡é“¾è¡¨ä¿¡æ¯å¦‚ä¸‹ï¼š\n"</span>, no);</span><br><span class="line">        Emp currentEmp = head;</span><br><span class="line">        <span class="keyword">while</span> (currentEmp != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.print(<span class="string">"===&gt;"</span> + currentEmp);</span><br><span class="line">            currentEmp = currentEmp.next;</span><br><span class="line">        }</span><br><span class="line">        System.out.println();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®idæŸ¥æ‰¾å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Emp <span class="title">findEmpById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"é“¾è¡¨ä¸ºç©ºï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        Emp currentEmp = head;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">if</span> (currentEmp.id == id) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (currentEmp.next == <span class="keyword">null</span>) {</span><br><span class="line">                currentEmp = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            currentEmp = currentEmp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> currentEmp;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a><code>åŠ¨æ€è§„åˆ’</code></h3><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213459.png" alt="image-20200606102951102"></p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213503.png" alt="image-20200606103004777"></p>
<p>ä»£ç å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProgramming</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] weight = <span class="keyword">new</span> <span class="keyword">int</span>[]{<span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>};   <span class="comment">//å•†å“çš„é‡é‡</span></span><br><span class="line">        <span class="keyword">int</span>[] value = <span class="keyword">new</span> <span class="keyword">int</span>[]{<span class="number">1500</span>, <span class="number">3000</span>, <span class="number">2000</span>, <span class="number">3200</span>}; <span class="comment">//å•†å“å¯¹åº”çš„ä»·æ ¼</span></span><br><span class="line">        <span class="keyword">int</span> packageSize = <span class="number">5</span>; <span class="comment">//èƒŒåŒ…å®¹é‡</span></span><br><span class="line">        <span class="keyword">int</span> goodsCount = value.length; <span class="comment">//å•†å“ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//totalValue[i][j]:è¡¨ç¤ºåœ¨å‰iä¸ªå•†å“ä¸­èƒ½å¤Ÿè£…å…¥å®¹é‡ä¸ºjçš„èƒŒåŒ…ä¸­çš„æœ€å¤§ä»·å€¼</span></span><br><span class="line">        <span class="keyword">int</span>[][] totalValue = <span class="keyword">new</span> <span class="keyword">int</span>[goodsCount + <span class="number">1</span>][packageSize + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">//ç”¨äºæ‰“å°å•†å“è·¯å¾„</span></span><br><span class="line">        <span class="keyword">int</span>[][] path = <span class="keyword">new</span> <span class="keyword">int</span>[goodsCount + <span class="number">1</span>][packageSize + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ï¼šå…¨éƒ¨ç½®ä¸º0ï¼šä¹Ÿå¯ä»¥ä¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; totalValue.length; i++) {</span><br><span class="line">            totalValue[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; totalValue[<span class="number">0</span>].length; j++) {</span><br><span class="line">            totalValue[<span class="number">0</span>][j] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŠ¨æ€è§„åˆ’å¤„ç†:å› ä¸ºç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—éƒ½å·²ç»ç½®ä¸º0ï¼Œæ‰€ä»¥ä»1å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; totalValue.length; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; totalValue[<span class="number">0</span>].length; j++) {</span><br><span class="line">                <span class="keyword">if</span> (weight[i - <span class="number">1</span>] &gt; j) {</span><br><span class="line">                    totalValue[i][j] = totalValue[i - <span class="number">1</span>][j];</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">if</span> (totalValue[i - <span class="number">1</span>][j] &lt; value[i - <span class="number">1</span>] + totalValue[i - <span class="number">1</span>][j - weight[i - <span class="number">1</span>]]) {</span><br><span class="line">                        totalValue[i][j] = value[i - <span class="number">1</span>] + totalValue[i - <span class="number">1</span>][j - weight[i - <span class="number">1</span>]];</span><br><span class="line">                        path[i][j] = <span class="number">1</span>;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        totalValue[i][j] = totalValue[i - <span class="number">1</span>][j];</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¾“å‡ºåŠ¨æ€è§„åˆ’è¡¨</span></span><br><span class="line">        System.out.println(<span class="string">"==================åŠ¨æ€è§„åˆ’è¡¨=================="</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] ints : totalValue) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> anInt : ints) {</span><br><span class="line">                System.out.printf(<span class="string">"%d\t"</span>, anInt);</span><br><span class="line">            }</span><br><span class="line">            System.out.println();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"==================å•†å“æ¥æºè·¯å¾„================="</span>);</span><br><span class="line">        <span class="keyword">int</span> i = path.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> j = path[<span class="number">0</span>].length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; j &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (path[i][j] == <span class="number">1</span>) {</span><br><span class="line">                System.out.printf(<span class="string">"ç¬¬%dä¸ªå•†å“ä»·å€¼%dæ”¾å…¥èƒŒåŒ…\n"</span>, i, value[i - <span class="number">1</span>]);</span><br><span class="line">                j -= weight[i - <span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">            i--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213510.png" alt="image-20200606103055500"></p>
<h2 id="SpringCloudå¾®æœåŠ¡ï¼ˆè°·ç²’å­¦é™¢ï¼‰"><a href="#SpringCloudå¾®æœåŠ¡ï¼ˆè°·ç²’å­¦é™¢ï¼‰" class="headerlink" title="SpringCloudå¾®æœåŠ¡ï¼ˆè°·ç²’å­¦é™¢ï¼‰"></a>SpringCloudå¾®æœåŠ¡ï¼ˆè°·ç²’å­¦é™¢ï¼‰</h2><h3 id="1-å®šä¹‰è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼ï¼ˆjacksonï¼‰"><a href="#1-å®šä¹‰è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼ï¼ˆjacksonï¼‰" class="headerlink" title="1.å®šä¹‰è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼ï¼ˆjacksonï¼‰"></a>1.å®šä¹‰è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼ï¼ˆjacksonï¼‰</h3><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ³¨æ„ï¼šåœ¨å­—æ®µä¸Šé¢å®šä¹‰jsonè¿”å›ç±»å‹ï¼Œå¯ä»¥è¦†ç›–å…¨å±€é…ç½®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@ApiModelProperty(value = "å…¥é©»æ—¶é—´")</span></span><br><span class="line">   <span class="meta">@JsonFormat(timezone = "GMT+8", pattern = "yyyy-MM-dd")</span></span><br><span class="line">   <span class="keyword">private</span> Date joinDate;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¦‚æœæ˜¯null å’Œ â€œâ€ ä¸è¿”å›</span></span><br><span class="line">   <span class="meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span></span><br><span class="line">   <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœnullä¸è¿”å›</span></span><br><span class="line">   <span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line">   <span class="keyword">private</span> T data;</span><br></pre></td></tr></tbody></table></figure>
<p>å¤æ‚æ•°æ®ç±»å‹çš„è½¬æ¢</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference; <span class="comment">// æ³¨æ„ï¼šå¼•å…¥æ­£ç¡®çš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;	</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">md6Test</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>{</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"å°æ˜"</span>);</span><br><span class="line">        list.add(<span class="string">"å°ç™½"</span>);</span><br><span class="line">        list.add(<span class="string">"å¤§ç™½"</span>);</span><br><span class="line">        list.add(<span class="string">"åˆºå®¢"</span>);</span><br><span class="line">        list.add(<span class="string">"ä¼å…­ä¸ƒ"</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºmapperå¯¹è±¡:æ‰€æœ‰æ“ä½œéƒ½åŸºäºæ­¤</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">// listé›†åˆè½¬jsonå­—ç¬¦ä¸²</span></span><br><span class="line">        String jsonList = mapper.writeValueAsString(list);</span><br><span class="line">        System.out.println((<span class="string">"jsonList:"</span> + jsonList));</span><br><span class="line">        <span class="comment">// jsonçš„listé›†åˆå­—ç¬¦ä¸²è½¬listé›†åˆå¯¹è±¡</span></span><br><span class="line">        List&lt;String&gt; listObject = mapper.readValue(jsonList, <span class="keyword">new</span> TypeReference&lt;&gt;() {</span><br><span class="line">        });</span><br><span class="line">        listObject.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        map.put(<span class="string">"å—å¸"</span>, <span class="string">"å¤§ç†æ®µç‹çˆ·"</span>);</span><br><span class="line">        map.put(<span class="string">"åŒ—ä¸"</span>, <span class="string">"ä¸å¸®æ´ªä¸ƒå…¬"</span>);</span><br><span class="line">        map.put(<span class="string">"ä¸œé‚ª"</span>, <span class="string">"æ¡ƒèŠ±å²›é»„è€é‚ª"</span>);</span><br><span class="line">        map.put(<span class="string">"è¥¿æ¯’"</span>, <span class="string">"æ¬§é˜³é”‹"</span>);</span><br><span class="line">        map.put(<span class="string">"ä¸­ç¥é€š"</span>, <span class="string">"æ­¦å½“å‘¨ä¼¯é€š"</span>);</span><br><span class="line">        <span class="comment">// mapè½¬json</span></span><br><span class="line">        String jsonMap = mapper.writeValueAsString(map);</span><br><span class="line">        System.out.println(<span class="string">"jsonMap:"</span> + jsonMap);</span><br><span class="line">        <span class="comment">// jsonè½¬map</span></span><br><span class="line">        Map&lt;String, Object&gt; mapObject = mapper.readValue(jsonMap, <span class="keyword">new</span> TypeReference&lt;&gt;() {</span><br><span class="line">        });</span><br><span class="line">        mapObject.forEach((key, value) -&gt; System.out.println(key + <span class="string">"==&gt;"</span> + value));</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-logback-spring-xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®ï¼ˆé«˜çº§ç‰ˆï¼‰"><a href="#2-logback-spring-xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®ï¼ˆé«˜çº§ç‰ˆï¼‰" class="headerlink" title="2.logback-spring.xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®ï¼ˆé«˜çº§ç‰ˆï¼‰"></a>2.logback-spring.xmlæ–‡ä»¶çš„åŸºæœ¬é…ç½®ï¼ˆé«˜çº§ç‰ˆï¼‰</h3><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>  <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"10 seconds"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è‡ªå®šä¹‰ï¼šæ—¥å¿—è¾“å‡ºè·¯å¾„(ç»å¯¹è·¯å¾„)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"log.path"</span> <span class="attr">value</span>=<span class="string">"F:/HorseSchool/service/service_edu/src/log"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:é’è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:ç™½è‰² --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"CONSOLE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"FILE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%date{yyyy-MM-dd HH:mm:ss} |%-5level |%thread |%file:%line |%logger |%msg%n"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç¼–ç --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ENCODING"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"CONSOLE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è‡ªå®šä¹‰ï¼šæ—¥å¿—çº§åˆ«--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ ¼å¼--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—å­—ç¬¦é›†--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"INFO_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•INFOçº§åˆ«çš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"WARN_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•WARNçº§åˆ«çš„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"ERROR_FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è¿‡æ»¤å™¨ï¼šæ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${log.path}/log_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${FILE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>${ENCODING}<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¼€å‘ç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¯ä»¥çµæ´»è®¾ç½®æ­¤å¤„ï¼Œä»è€Œæ§åˆ¶æ—¥å¿—çš„è¾“å‡º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_FILE"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_FILE"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_FILE"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"pro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ERROR"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_FILE"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-é˜¿é‡Œå·´å·´Sentinel-openFeignç†”æ–­ä¿æŠ¤"><a href="#3-é˜¿é‡Œå·´å·´Sentinel-openFeignç†”æ–­ä¿æŠ¤" class="headerlink" title="3.é˜¿é‡Œå·´å·´Sentinel+openFeignç†”æ–­ä¿æŠ¤"></a>3.é˜¿é‡Œå·´å·´Sentinel+openFeignç†”æ–­ä¿æŠ¤</h3><blockquote>
<p>openFeignå¾®æœåŠ¡çš„æ•´åˆå…·ä½“æŸ¥çœ‹ä¹ä¼˜å•†åŸéƒ¨åˆ†ç¬”è®°</p>
</blockquote>
<p>åœ¨æœåŠ¡æ¨¡å—ä¸­å¼•å…¥pomï¼ˆçˆ¶å·¥ç¨‹æ§åˆ¶ç‰ˆæœ¬ï¼‰</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinelï¼šæœåŠ¡å®¹é”™--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>é…ç½®Sentinelçš„å¯è§†åŒ–ç›‘æ§ç•Œé¢</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#sentinelæœåŠ¡å®¹é”™ç›‘æ§</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8081</span> <span class="comment">#è·Ÿæ§åˆ¶å°äº¤æµçš„ç«¯å£ï¼Œéšæ„æŒ‡å®šä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£å³å¯</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment"># æŒ‡å®šæ§åˆ¶å°æœåŠ¡çš„åœ°å€</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ‰“å¼€å®˜æ–¹çš„jarçš„åŒ…ï¼ˆé»˜è®¤æ‰“å¼€8080ç«¯å£ï¼Œä¸€å®šè¦é¿å…ç«¯å£å†²çªï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213519.png" alt="sentinelç›‘æ§"></p>
<p>ç„¶ååœ¨æµè§ˆå™¨è¾“å…¥ï¼šlocalhost:8080å³å¯ç™»å½•å¯è§†åŒ–ç•Œé¢ï¼ˆç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ï¼šsentinelï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20210506213522.png" alt="image-20200808204138470"></p>
<p>ç™»å½•å³å¯è¿›è¡Œå…·ä½“é…ç½®ï¼ˆä¸€å®šè¦ä½¿ç”¨æ¥å£ï¼Œæ‰èƒ½åœ¨ç•Œé¢ä¸Šé¢çœ‹åˆ°å¹¶ç›‘æ§ï¼‰</p>
<p>é…ç½®Sentinelçš„ç®€å•ç†”æ–­ä¿æŠ¤</p>
<p>æ•´åˆçš„feignè¿œç¨‹è°ƒç”¨æ¥å£(å¤§å®¶æ‡‚çš„â€¦)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RemoveFileApi</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜¿é‡Œäº‘ï¼šæ ¹æ®æ–‡ä»¶URLåˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping("/admin/oss/file/remove")</span></span><br><span class="line">    <span class="function">R <span class="title">remove</span><span class="params">(<span class="meta">@RequestBody</span> String url)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>fallback = VodMediaServiceFallBack.class</p>
<p>å«ä¹‰ï¼šå½“è¿œç¨‹è°ƒç”¨æœåŠ¡å‡ºç°é”™è¯¯å¼‚å¸¸çš„æ—¶å€™ï¼Œè¿™æ—¶å°±ä¼šè§¦å‘ç†”æ–­ä¿æŠ¤æœºåˆ¶ï¼Œä½¿å…¶ä»–ç¨‹åºç»§ç»­è¿è¡Œä¸‹å»ï¼šè°ƒç”¨OssFileServiceFallBackç±»ä¸­è‡ªå®šä¹‰è¾“å‡ºç»“æœï¼Œä»è€Œä¸ä¼šå› ä¸ºè¿™ä¸ªè¿œç¨‹è°ƒç”¨æ¥å£å‡ºç°é”™è¯¯å¼‚å¸¸ï¼Œè€Œä½¿çœŸä¸ªç¨‹åºçš„è¿è¡Œä¸­æ–­</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = "service-oss", fallback = OssFileServiceFallBack.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RemoveFileClient</span> <span class="keyword">extends</span> <span class="title">RemoveFileApi</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç®€å•æ•´åˆSentinelçš„ç†”æ–­ä¿æŠ¤</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssFileServiceFallBack</span> <span class="keyword">implements</span> <span class="title">RemoveFileClient</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜¿é‡Œäº‘ï¼šæ ¹æ®æ–‡ä»¶URLåˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">remove</span><span class="params">(String url)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"è¿œç¨‹æœåŠ¡å¼‚å¸¸===ã€‹å¼€å¯æœ¬åœ°æœåŠ¡ç†”æ–­ä¿æŠ¤æœºåˆ¶"</span>);</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">"æœåŠ¡è°ƒç”¨è¶…æ—¶"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Alibaba"><a href="#Alibaba" class="headerlink" title="Alibaba"></a>Alibaba</h2><blockquote>
<p>é›†åˆçš„è‡ªå¾ªç¯çš„add/removeæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨Iteratorè¿­ä»£å™¨ï¼Œä¸è¦ä½¿ç”¨forEachå¾ªç¯ï¼Œå¦åˆ™ä¼šå‡ºç°ç»“æœæ­£ç¡®ä½†æŠ¥å¼‚å¸¸çš„æƒ…å†µ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®åšæ³•</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line">        list.add(<span class="number">4</span>);</span><br><span class="line">        list.add(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// è¿­ä»£å™¨å¾ªç¯</span></span><br><span class="line">        Iterator&lt;Integer&gt; iterator = list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) {</span><br><span class="line">            <span class="keyword">if</span> (iterator.next() == <span class="number">1</span>) {</span><br><span class="line">                iterator.remove();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">		<span class="comment">// ==========JDK8æ–°ç‰¹æ€§============</span></span><br><span class="line">        <span class="comment">// è¿­ä»£å™¨å¾ªç¯</span></span><br><span class="line">        list.removeIf(integer -&gt; integer == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯åšæ³•ï¼ˆç»“æœæ­£ç¡®ï¼Œä½†æ˜¯æŠ¥å¼‚å¸¸ï¼‰</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line">        list.add(<span class="number">4</span>);</span><br><span class="line">        list.add(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer integer : list) {</span><br><span class="line">            <span class="keyword">if</span> (integer == <span class="number">1</span>) {</span><br><span class="line">                list.remove(integer);</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="StreamæµåŸºç¡€"><a href="#StreamæµåŸºç¡€" class="headerlink" title="StreamæµåŸºç¡€"></a>StreamæµåŸºç¡€</h2><h3 id="æŸ¥æ‰¾ä¸åŒ¹é…"><a href="#æŸ¥æ‰¾ä¸åŒ¹é…" class="headerlink" title="æŸ¥æ‰¾ä¸åŒ¹é…"></a>æŸ¥æ‰¾ä¸åŒ¹é…</h3><p>listé›†åˆç¤ºä¾‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  list.add(<span class="string">"å¼ ä¸‰ä¸‰"</span>);</span><br><span class="line">  list.add(<span class="string">"æå››"</span>);</span><br><span class="line">  list.add(<span class="string">"ç‹äº”"</span>);</span><br><span class="line">  list.add(<span class="string">"å­™ä¸ƒ"</span>);</span><br><span class="line">  list.add(<span class="string">"èµµå…«"</span>);</span><br><span class="line">  list.add(<span class="string">"æ›¹æ“"</span>);</span><br><span class="line">  list.add(<span class="string">"åˆ˜å¤‡"</span>);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><blockquote>
<p>è¿”å›ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„å€¼</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; tempList = list.stream()</span><br><span class="line">        .filter(e -&gt; e.contains(<span class="string">"å¼ "</span>)) <span class="comment">// è¿‡æ»¤æ‰€æœ‰å§“å¼ çš„</span></span><br><span class="line">        .filter(e -&gt; e.length() == <span class="number">3</span>) <span class="comment">// è¿‡æ»¤æ‰€æœ‰å§“åæ˜¯3ä¸ªå­—çš„</span></span><br><span class="line">        .collect(Collectors.toList()); <span class="comment">// è¿”å›ä¸€ä¸ªæ–°çš„listé›†åˆ</span></span><br><span class="line">tempList.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="limit-n"><a href="#limit-n" class="headerlink" title="limit(n)"></a>limit(n)</h4><blockquote>
<p>è¿”å›å‰nä¸ªå…ƒç´ æ•°æ®å€¼ç»„æˆçš„Stream</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Set&lt;String&gt; tempSet = list.stream()</span><br><span class="line">    .limit(<span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toSet());</span><br><span class="line">tempSet.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="skip-n"><a href="#skip-n" class="headerlink" title="skip(n)"></a>skip(n)</h4><blockquote>
<p>è·³è¿‡å‰nä¸ªå…ƒç´ çš„ä¸­é—´æµæ“ä½œï¼Œè¿”å›å‰©ä¸‹çš„å€¼(ç»“åˆlimitå¯ä»¥å®ç°åˆ†é¡µï¼Œä½†ä¸€èˆ¬ä¸ä¼šè¿™ä¹ˆåšï¼ï¼ï¼)</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Set&lt;String&gt; tempSet = list.stream()</span><br><span class="line">        .skip(<span class="number">3</span>)</span><br><span class="line">        .limit(<span class="number">2</span>)</span><br><span class="line">        .collect(Collectors.toSet());</span><br><span class="line">tempSet.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h4><blockquote>
<p>é€šè¿‡æµä¸­å…ƒç´ çš„ hashCode() å’Œ equals() å»é™¤é‡å¤å…ƒç´ </p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; tempList = list.stream()</span><br><span class="line">    .distinct()</span><br><span class="line">    .collect(Collectors.toList());</span><br></pre></td></tr></tbody></table></figure>
<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><blockquote>
<p>è‡ªç„¶æ’åºï¼Œæµä¸­å…ƒç´ éœ€å®ç°Comparableæ¥å£</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; tempList = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .sorted()</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">tempList.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="sorted-Comparator-com"><a href="#sorted-Comparator-com" class="headerlink" title="sorted(Comparator com)"></a>sorted(Comparator com)</h4><blockquote>
<p>å®šåˆ¶æ’åºï¼Œè‡ªå®šä¹‰Comparatoræ’åºå™¨(å€’åº)</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; tempList = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .sorted(<span class="keyword">new</span> Comparator&lt;String&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String o1, String o2)</span> </span>{</span><br><span class="line">                <span class="keyword">return</span> o2.compareTo(o1);</span><br><span class="line">            }</span><br><span class="line">        })  <span class="comment">// å®ç°è‡ªå®šä¹‰å€’åºæ’åº</span></span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">tempList.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><blockquote>
<p>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; tempList = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .map(e-&gt;e.length()) <span class="comment">// è®¡ç®—å¹¶è¿”å›æ¯ä¸ªå…ƒç´ çš„é•¿åº¦(æ³¨æ„è¿”å›çš„æ•°æ®ç±»å‹)</span></span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">tempList.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="allMatch"><a href="#allMatch" class="headerlink" title="allMatch"></a>allMatch</h4><blockquote>
<p>æ¥æ”¶ä¸€ä¸ª Predicate å‡½æ•°ï¼Œå½“æµä¸­æ¯ä¸ªå…ƒç´ éƒ½ç¬¦åˆè¯¥æ–­è¨€æ—¶æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> match = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .allMatch(e -&gt; e.length() &gt; <span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">"match:"</span> + match);</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>match:false</p>
</blockquote>
<h4 id="noneMatch"><a href="#noneMatch" class="headerlink" title="noneMatch"></a>noneMatch</h4><blockquote>
<p>æ¥æ”¶ä¸€ä¸ª Predicate å‡½æ•°ï¼Œå½“æµä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç¬¦åˆè¯¥æ–­è¨€æ—¶æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> match = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .noneMatch(e -&gt; e.length() &gt; <span class="number">5</span>);</span><br><span class="line">System.out.println(<span class="string">"match:"</span> + match);</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>match:true</p>
</blockquote>
<h4 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h4><blockquote>
<p>æ¥æ”¶ä¸€ä¸ª Predicate å‡½æ•°ï¼Œåªè¦æµä¸­æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³è¯¥æ–­è¨€åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> match = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .anyMatch(e -&gt; e.length() == <span class="number">3</span>);</span><br><span class="line">System.out.println(<span class="string">"match:"</span> + match);</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>match:true</p>
</blockquote>
<h4 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h4><blockquote>
<p>è¿”å›æµä¸­ç¬¬ä¸€ä¸ªå…ƒç´ </p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; first = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .findFirst();</span><br><span class="line">System.out.println(<span class="string">"first:"</span> + first);</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>first:Optional[å¼ ä¸‰ä¸‰]</p>
</blockquote>
<h4 id="findAny"><a href="#findAny" class="headerlink" title="findAny"></a>findAny</h4><blockquote>
<p>è¿”å›æµä¸­çš„ä»»æ„å…ƒç´ </p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; first = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .findAny();</span><br><span class="line">System.out.println(<span class="string">"any:"</span> + any);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="count"><a href="#count" class="headerlink" title="count"></a>count</h4><blockquote>
<p>è¿”å›æµä¸­å…ƒç´ çš„æ€»ä¸ªæ•°</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> count = list.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .count();</span><br><span class="line">System.out.println(<span class="string">"count:"</span> + count);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å½’çº¦"><a href="#å½’çº¦" class="headerlink" title="å½’çº¦"></a>å½’çº¦</h3><blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç®€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>reduce(T iden, BinaryOperator b)</td>
<td>ç»™å®šåˆå§‹å€¼ï¼Œå¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› T</td>
</tr>
<tr>
<td>reduce(BinaryOperator b)</td>
<td>å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› Optional</td>
</tr>
</tbody>
</table>
</div>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// streamçš„ reduceå½’çº¦æ“ä½œ</span></span><br><span class="line"><span class="comment">// ç®€å•æ±‚å’Œ</span></span><br><span class="line">List&lt;Integer&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="number">1</span>, <span class="number">32</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">435</span>, <span class="number">6</span>, <span class="number">76</span>, <span class="number">234</span>));</span><br><span class="line"><span class="comment">// æœªç»™å®šåˆå§‹å€¼çš„å½’çº¦æ±‚å’Œ,è¿”å›ä¸€ä¸ª Optional å¯¹è±¡</span></span><br><span class="line">arrayList.stream().reduce(Integer::sum)</span><br><span class="line">        .ifPresent(integer -&gt; System.out.println(<span class="string">"&gt;&gt;&gt; ç®€å•æ±‚å’Œå§¿åŠ¿1 - sum: "</span> + integer));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™å®šåˆå§‹å€¼0çš„å½’çº¦æ±‚å’Œ</span></span><br><span class="line">Integer reduce = arrayList.stream().reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line">System.out.println(<span class="string">"&gt;&gt;&gt; ç®€å•æ±‚å’Œå§¿åŠ¿2 - sum: "</span> + reduce);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ“ä½œå¯¹è±¡æŸä¸ªå­—æ®µ</span></span><br><span class="line">ArrayList&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">userList.add(<span class="keyword">new</span> User().setUsername(<span class="string">"aaa"</span>).setLoginCount(<span class="number">666L</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> User().setUsername(<span class="string">"bbb"</span>).setLoginCount(<span class="number">888L</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> User().setUsername(<span class="string">"ccc"</span>).setLoginCount(<span class="number">999L</span>));</span><br><span class="line"></span><br><span class="line">userList.stream().map(User::getLoginCount).reduce(Long::sum)</span><br><span class="line">        .ifPresent(loginCount -&gt; System.out.println(<span class="string">"&gt;&gt;&gt; å¯¹è±¡å­—æ®µæ±‚å’Œ - sum: "</span> + loginCount));</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ”¶é›†"><a href="#æ”¶é›†" class="headerlink" title="æ”¶é›†"></a>æ”¶é›†</h3><blockquote>
<p>Collector æ¥å£ä¸­æ–¹æ³•çš„å®ç°å†³å®šäº†å¦‚ä½•å¯¹æµæ‰§è¡Œæ”¶é›†æ“ä½œ(å¦‚æ”¶é›†åˆ° Listã€Setã€Map)ã€‚ä½†æ˜¯ Collectors å®ç”¨ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå¸¸è§æ”¶é›†å™¨å®ä¾‹</p>
<p>æ³¨æ„ï¼šå‡æ˜¯ä¸€äº›ç®€å•çš„æ“ä½œï¼Œé‡Œå€Ÿå³å¯ã€‚</p>
</blockquote>
<h2 id="Jsoupçˆ¬è™«åŸºç¡€"><a href="#Jsoupçˆ¬è™«åŸºç¡€" class="headerlink" title="Jsoupçˆ¬è™«åŸºç¡€"></a>Jsoupçˆ¬è™«åŸºç¡€</h2><p>å¼•å…¥pomä¾èµ–</p>
<figure class="highlight xml"><figcaption><span>&lt;!--Jsoup--&gt;</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Jsoup--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="çˆ¬å–é“¾æ¥"><a href="#çˆ¬å–é“¾æ¥" class="headerlink" title="çˆ¬å–é“¾æ¥"></a>çˆ¬å–é“¾æ¥</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Jsoupç®€å•çˆ¬å–ç½‘é¡µå›¾ç‰‡é“¾æ¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generateDate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    String url = <span class="string">"https://bing.lylares.com/"</span>;</span><br><span class="line">    <span class="comment">// è·å–ç½‘é¡µæºä»£ç </span></span><br><span class="line">    Document document = Jsoup.parse(<span class="keyword">new</span> URL(url), <span class="number">60000</span>);</span><br><span class="line">    Elements elements = document.getElementsByClass(<span class="string">"media-content"</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element element : elements) {</span><br><span class="line">        <span class="comment">// è·å–styleå±æ€§ä¸­çš„å†…å®¹</span></span><br><span class="line">        String style = element.attr(<span class="string">"style"</span>);</span><br><span class="line">        <span class="comment">// åˆ†å‰²å¾—åˆ°ç›®æ ‡å­—ç¬¦ä¸²æ•°æ®</span></span><br><span class="line">        String hrefBefore = style.split(<span class="string">"\\("</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (hrefBefore.contains(<span class="string">")"</span>)) {</span><br><span class="line">            String href = hrefBefore.substring(<span class="number">0</span>, hrefBefore.length() - <span class="number">1</span>);</span><br><span class="line">            System.out.println(href);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(hrefBefore);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="çˆ¬å–å›¾ç‰‡"><a href="#çˆ¬å–å›¾ç‰‡" class="headerlink" title="çˆ¬å–å›¾ç‰‡"></a>çˆ¬å–å›¾ç‰‡</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Jsoupçˆ¬å–æ‘„å›¾ç½‘å›¾ç‰‡(ä»ç¬¬2é¡µå¼€å§‹)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">generateDate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String url = <span class="string">"https://699pic.com/photo-218808-0-new-all-0-all-all-"</span> + <span class="string">"%d"</span> + <span class="string">"-0-0-0-0-0-0-all-all"</span> + <span class="string">"%s"</span> +</span><br><span class="line">                <span class="string">".html"</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; <span class="number">4</span>; i++) {</span><br><span class="line">            String formatUrl = String.format(url, i, <span class="string">"-all"</span>);</span><br><span class="line">            System.out.println(formatUrl);</span><br><span class="line">            Document document = Jsoup.parse(<span class="keyword">new</span> URL(formatUrl), <span class="number">60000</span>);</span><br><span class="line">            <span class="comment">// è·å–imgæ ‡ç­¾å†…å®¹</span></span><br><span class="line">            Elements elements = document.select(<span class="string">"img.lazy"</span>);</span><br><span class="line">            <span class="keyword">for</span> (Element element : elements) {</span><br><span class="line">                <span class="comment">// è·å–å›¾ç‰‡URLå¹¶æ·»åŠ å®‰å…¨åè®®</span></span><br><span class="line">                String imageUrl = <span class="string">"https:"</span> + element.attr(<span class="string">"data-original"</span>);</span><br><span class="line">                <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å¯¹è±¡</span></span><br><span class="line">                URL urlConn = <span class="keyword">new</span> URL(imageUrl);</span><br><span class="line">                <span class="comment">// æ‰“å¼€ç½‘å€è¿æ¥</span></span><br><span class="line">                URLConnection connection = urlConn.openConnection();</span><br><span class="line">                <span class="comment">// è·å–æ•°æ®ä¸­çš„æ•°æ®æµ</span></span><br><span class="line">                InputStream inputStream = connection.getInputStream();</span><br><span class="line">                <span class="comment">// è·å–å›¾ç‰‡åç§°(æˆ–è€…è‡ªå·±é‡å‘½å)</span></span><br><span class="line">                String imageName = imageUrl.substring(imageUrl.lastIndexOf(<span class="string">"/"</span>) + <span class="number">1</span>);</span><br><span class="line">                System.out.println(imageName);</span><br><span class="line">                <span class="comment">// å°†æ•°æ®æµå†™å…¥ç£ç›˜</span></span><br><span class="line">                OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"E:/image/"</span> + imageName));</span><br><span class="line">                <span class="comment">// å°†è¾“å…¥æµä¸­çš„æ•°æ®è¾“å‡ºåˆ°è¾“å‡ºæµä¸­</span></span><br><span class="line">                <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">int</span> count;</span><br><span class="line">                <span class="keyword">while</span> ((count = inputStream.read(b)) != -<span class="number">1</span>) {</span><br><span class="line">                    outputStream.write(b, <span class="number">0</span>, count);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ThreadåŸºç¡€"><a href="#ThreadåŸºç¡€" class="headerlink" title="ThreadåŸºç¡€"></a>ThreadåŸºç¡€</h2><h3 id="1-çº¿ç¨‹åˆ›å»º"><a href="#1-çº¿ç¨‹åˆ›å»º" class="headerlink" title="1. çº¿ç¨‹åˆ›å»º"></a>1. çº¿ç¨‹åˆ›å»º</h3><h4 id="1-1-ç»§æ‰¿Threadç±»"><a href="#1-1-ç»§æ‰¿Threadç±»" class="headerlink" title="1.1 ç»§æ‰¿Threadç±»"></a>1.1 ç»§æ‰¿Threadç±»</h4><blockquote>
<p>å®ç°æ–¹å¼ï¼šç»§æ‰¿Threadç±»,é‡å†™run( )æ–¹æ³•</p>
<p>ä¸æ¨èä½¿ç”¨ï¼šæœ‰OOPå•ç»§æ‰¿å±€é™æ€§</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Threadçš„å¸¸ç”¨æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment"> * 1.currentThread():é™æ€çš„ï¼Œè·å–å½“å‰çš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * 2.getName():è·å–å½“å‰çº¿ç¨‹çš„åå­—</span></span><br><span class="line"><span class="comment"> * 3.setName():è®¾ç½®å½“å‰çº¿ç¨‹çš„åå­—</span></span><br><span class="line"><span class="comment"> * 4.yield():ç›´æ¥ä½¿ç”¨å­çº¿ç¨‹çš„ç±»åè°ƒç”¨ï¼Œé™ä½è§£ææˆæœ¬ã€‚è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹å°†ä¼šé‡Šæ”¾å½“å‰CPUçš„æ‰§è¡Œæƒï¼Œè®©CPUé‡æ–°è¿›è¡Œè°ƒåº¦ï¼ˆç¤¼è®©ä¸ä¸€å®š			   æˆåŠŸï¼Œå› ä¸ºé‡æ–°è°ƒåº¦çš„é‚£ä¸ªçº¿ç¨‹å¯èƒ½ä¾ç„¶æ˜¯é‚£ä¸ªè°ƒç”¨ç¤¼è®©æ–¹æ³•çš„çº¿ç¨‹ï¼‰</span></span><br><span class="line"><span class="comment"> * 5.join():è‹¥åœ¨Açº¿ç¨‹ä¸­è°ƒç”¨Bçº¿ç¨‹çš„join()æ–¹æ³•ï¼Œè¡¨ç¤ºï¼šå½“æ‰§è¡Œåˆ°æ­¤æ–¹æ³•æ—¶ï¼ŒAçº¿ç¨‹åœæ­¢æ‰§è¡Œï¼ŒBçº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œ</span></span><br><span class="line"><span class="comment"> *          Açº¿ç¨‹å†æ¥ç€join()ä¹‹åçš„ä»£ç æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * 6.isAlive():åˆ¤æ–­æŸä¸ªçº¿ç¨‹æ˜¯å¦è¿˜åœ¨å­˜æ´»çŠ¶æ€ï¼Œè¿”å›Booleanå€¼</span></span><br><span class="line"><span class="comment"> * 7.sleep(long time):æ˜¾å¼çš„è®©çº¿ç¨‹ç¡çœ timeæ¯«ç§’</span></span><br><span class="line"><span class="comment"> * 8.setPriority(int newPriority):çº¿ç¨‹å¯¹è±¡è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬ä¸º1-10çš„çº§åˆ«ï¼Œé»˜è®¤ä¸º5</span></span><br><span class="line"><span class="comment"> *               æ³¨æ„ï¼šä¼˜å…ˆçº§çš„é«˜ä½åªæ˜¯å†³å®šäº†å½“å‰çº¿ç¨‹æŠ¢å CPUæ‰§è¡Œæƒçš„æ¦‚ç‡å˜å¤§äº†ï¼Œå¹¶ä¸æ„å‘³ç€æœ¬çº¿ç¨‹ä¸€ç›´æ‰§è¡Œä¸‹å»</span></span><br><span class="line"><span class="comment"> * 9.getPriority():è·å–å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateThread</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œå®Œæˆ1-100ä¹‹é—´è‡ªç„¶æ•°çš„è¾“å‡ºï¼ŒåŒæ ·çš„ï¼Œä¸»çº¿ç¨‹è¿›è¡Œè°ƒç”¨ä¹Ÿæ‰§è¡ŒåŒæ ·çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">     * æ•ˆæœ:å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¸­æ–¹æ³•ç”±CPUä»»åŠ¡è°ƒåº¦å™¨è¿›è¡Œåˆ†é…,äº¤äº’è°ƒç”¨ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¸­çš„æ–¹æ³•,äº¤æ›¿éšæœºè¾“å‡º</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//åˆ›å»ºå­çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        subThread subthread1 = <span class="keyword">new</span> subThread();</span><br><span class="line">        subThread subthread2 = <span class="keyword">new</span> subThread();</span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">        subthread1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        subthread2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">        <span class="comment">//åªèƒ½åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œæ‰èƒ½è¿›è¡Œå¤šä¸ªçº¿ç¨‹çš„å¯åŠ¨å’Œè°ƒç”¨</span></span><br><span class="line">        subthread1.start();</span><br><span class="line">        subthread2.start();</span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹æ‰§è¡ŒåŒæ ·çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> +</span><br><span class="line">                    Thread.currentThread().getPriority() + <span class="string">":"</span> + i);</span><br><span class="line">            <span class="comment">//æ»¡è¶³æ¡ä»¶æ—¶ï¼Œé‡Šæ”¾CPUæ‰§è¡Œæƒ</span></span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">//å¯ä»¥ç›´æ¥ç”¨å­çº¿ç¨‹ç±»åè°ƒç”¨yield()æ–¹æ³•ï¼Œå‡å°‘è§£ææˆæœ¬</span></span><br><span class="line">                subThread.yield();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">20</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    subthread1.join();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"subthread1çº¿ç¨‹æ˜¯å¦è¿˜åœ¨å­˜æ´»çŠ¶æ€ï¼š"</span> + subthread1.isAlive());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºçº¿ç¨‹ç±»:ç»§æ‰¿Threadç±»,é‡å†™run()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">subThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> +</span><br><span class="line">                    Thread.currentThread().getPriority() + <span class="string">":"</span> + i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-2-å®ç°Runnableæ¥å£"><a href="#1-2-å®ç°Runnableæ¥å£" class="headerlink" title="1.2 å®ç°Runnableæ¥å£"></a>1.2 å®ç°Runnableæ¥å£</h4><blockquote>
<p>å®ç°æ–¹å¼ï¼šå®ç°Runnableæ¥å£,é‡å†™run()æ–¹æ³•</p>
<p>æ¨èä½¿ç”¨ï¼šé¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹:Threadå¯¹è±¡(ç›®æ ‡å¯¹è±¡).start()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        RunnableTest target = <span class="keyword">new</span> RunnableTest();</span><br><span class="line">        <span class="comment">// æ˜¾å¼åˆ›å»º2ä¸ªçº¿ç¨‹:åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨</span></span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(target, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">        Thread threadTwo = <span class="keyword">new</span> Thread(target, <span class="string">"çº¿ç¨‹2"</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        threadOne.start();</span><br><span class="line">        threadTwo.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºçº¿ç¨‹:å®ç°Runnableæ¥å£,é‡å†™run()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RunnableTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-çº¿ç¨‹é›¶ç¢"><a href="#2-çº¿ç¨‹é›¶ç¢" class="headerlink" title="2. çº¿ç¨‹é›¶ç¢"></a>2. çº¿ç¨‹é›¶ç¢</h3><h4 id="2-1-çº¿ç¨‹åœæ­¢"><a href="#2-1-çº¿ç¨‹åœæ­¢" class="headerlink" title="2.1 çº¿ç¨‹åœæ­¢"></a>2.1 çº¿ç¨‹åœæ­¢</h4><blockquote>
<p>æ¨èæ–¹æ³•ï¼šä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½flagæ¥ç»ˆæ­¢çº¿ç¨‹è¿è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        RunnableTest target = <span class="keyword">new</span> RunnableTest();</span><br><span class="line">        <span class="comment">// æ˜¾å¼åˆ›å»º2ä¸ªçº¿ç¨‹:åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">new</span> Thread(target, <span class="string">"çº¿ç¨‹1"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(target, <span class="string">"çº¿ç¨‹2"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å½“mainä¸»çº¿ç¨‹è¾¾åˆ°æŸä¸€æ¡ä»¶æ—¶:è°ƒç”¨stopæ–¹æ³•åˆ‡æ¢æ ‡å¿—ä½, è®©çº¿ç¨‹åœæ­¢</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            System.out.println(<span class="string">"main==&gt;"</span> + i);</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">900</span>) {</span><br><span class="line">                <span class="comment">// ç»ˆæ­¢çº¿ç¨‹</span></span><br><span class="line">                target.stop();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºçº¿ç¨‹:å®ç°Runnableæ¥å£,é‡å†™run()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RunnableTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ˜¯å¦æ‰§è¡Œæ ‡å¿—ä½</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ­»å¾ªç¯:è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨forå¾ªç¯å®šä¹‰æ‰§è¡Œæ¬¡æ•°æ¥ç»ˆæ­¢çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">while</span> (flag) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + ++i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹å¤–æä¾›åœæ­¢çº¿ç¨‹çš„æ–¹æ³•:æ”¹å˜æ ‡å¿—ä½flag</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2-çº¿ç¨‹ç¡çœ "><a href="#2-2-çº¿ç¨‹ç¡çœ " class="headerlink" title="2.2 çº¿ç¨‹ç¡çœ "></a>2.2 çº¿ç¨‹ç¡çœ </h4><blockquote>
<p>Thread.sleep(int)ï¼šä½¿å½“å‰çº¿ç¨‹ç¡çœ å¤šå°‘æ¯«ç§’ï¼ˆæ­¤æ—¶çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ï¼‰</p>
<p>æ³¨æ„ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleepä¸ä¼šé‡Šæ”¾é”ï¼ˆä¸»è¦ç”¨äºçº¿ç¨‹åŒæ­¥ï¼‰</p>
</blockquote>
<p>ç¡çœ æ’åºæ³•ï¼ˆæœ‰è¶£çš„æ’åºæ–¹æ³•â€¦ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * ç¡çœ æ’åºæ³•ï¼šå®é™…ç”Ÿæ´»ä¸­ä¸€å®šä¸èƒ½ä½¿ç”¨çš„å“Ÿï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SleepSortThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SleepSortThread</span><span class="params">(<span class="keyword">int</span> temp)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.temp = temp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// ç¡çœ æ—¶é—´æ‰©å¤§64å€</span></span><br><span class="line">            Thread.sleep(temp &lt;&lt; <span class="number">6</span>);</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>[] array = {<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">10</span>};</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : array) {</span><br><span class="line">            <span class="comment">// åˆ›å»ºå¤šä¸ªçº¿ç¨‹:å€¼è¶Šå°,ç¡çœ è¶Šå…ˆç»“æŸ</span></span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> SleepSortThread(i)).start();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-çº¿ç¨‹çŠ¶æ€"><a href="#2-3-çº¿ç¨‹çŠ¶æ€" class="headerlink" title="2.3 çº¿ç¨‹çŠ¶æ€"></a>2.3 çº¿ç¨‹çŠ¶æ€</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/21 18:24</span></span><br><span class="line"><span class="comment"> * è§‚æµ‹çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStateClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹:lambdaæ–¹å¼å®ç°çº¿ç¨‹ä½“(æ–°å¼å†™æ³•ï¼Œé‡Œé¢çš„ç›¸å½“äºç»§æ‰¿äº†Runnableæ¥å£çš„å®ç°ç±»)</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"å¾ªç¯æ‰§è¡Œç»“æŸ..."</span>);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹æœªå¯åŠ¨:è·å–çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line">        Thread.State state = thread.getState();</span><br><span class="line">        System.out.println(state);  <span class="comment">// NEW</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹å·²å¯åŠ¨:è·å–çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line">        thread.start();</span><br><span class="line">        state = thread.getState();</span><br><span class="line">        System.out.println(state);  <span class="comment">// RUNNABLE</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œåˆ°ç»“æŸçŠ¶æ€</span></span><br><span class="line">        <span class="keyword">while</span> (state != Thread.State.TERMINATED) {</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            state = thread.getState();</span><br><span class="line">            System.out.println(state); <span class="comment">// ä¸€ç›´æ˜¯ TIMED_WAITING,æœ€åä¸€æ¬¡è¾“å‡ºçš„æ˜¯ TERMINATED</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-4-çº¿ç¨‹å®ˆæŠ¤"><a href="#2-4-çº¿ç¨‹å®ˆæŠ¤" class="headerlink" title="2.4 çº¿ç¨‹å®ˆæŠ¤"></a>2.4 çº¿ç¨‹å®ˆæŠ¤</h4><blockquote>
<p>çº¿ç¨‹åˆ†ç±»ï¼š</p>
<ol>
<li><p>ç”¨æˆ·çº¿ç¨‹</p>
<ul>
<li>mainçº¿ç¨‹å’Œæˆ‘ä»¬å†™çš„è¿è¡Œçš„ç¨‹åºéƒ½æ˜¯ç”¨æˆ·çº¿ç¨‹</li>
<li>JVMè™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</li>
</ul>
<p>2.å®ˆæŠ¤çº¿ç¨‹</p>
<ul>
<li>ä¾‹å¦‚ï¼šgcåƒåœ¾å¤„ç†æœºåˆ¶</li>
<li>JVMè™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeamonThreadClass</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> God());</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸Šå¸çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹:é»˜è®¤ä¸ºfalse</span></span><br><span class="line">        thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨äººç±»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Person()).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ‰§è¡Œç»“æœ:å½“äººç±»çº¿ç¨‹æ‰§è¡Œå®Œå,æ­¤çº¿ç¨‹ç«‹å³åœæ­¢,ä½†æ˜¯ä¸Šå¸å®ˆæŠ¤çº¿ç¨‹ä¸ä¼šç«‹å³ç»“æŸ,è™šæ‹Ÿæœºä¸ä¼šç®¡å®ƒ,ç›´åˆ°è™šæ‹Ÿæœºåœæ­¢,ä¸Šå¸å®ˆæŠ¤çº¿ç¨‹æ‰ç»ˆæ­¢</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36500</span>; i++) {</span><br><span class="line">            System.out.println(<span class="string">"äººç±»ä¸€ç›´æ´»ç€..."</span> + i);</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"game over!!!"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">God</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            System.out.println(<span class="string">"ä¸Šå¸ä¸€ç›´å®ˆæŠ¤ç€äººç±»..."</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-çº¿ç¨‹åŒæ­¥-å¹¶å‘"><a href="#3-çº¿ç¨‹åŒæ­¥-å¹¶å‘" class="headerlink" title="3. çº¿ç¨‹åŒæ­¥(å¹¶å‘)"></a>3. çº¿ç¨‹åŒæ­¥(å¹¶å‘)</h3><blockquote>
<p><strong>å¹¶å‘ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªèµ„æºå¯¹è±¡</strong></p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå®ç°çº¿ç¨‹åŒæ­¥ï¼Œçº¿ç¨‹åŒæ­¥å…¶å®å°±æ˜¯ä¸€ç§ç­‰å¾…æœºåˆ¶,å¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤èµ„æºå¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ªèµ„æºçš„ç­‰å¾…æ± ï¼Œå½¢æˆé˜Ÿåˆ—ï¼Œç­‰å¾…å‰é¢çº¿ç¨‹ä½¿ç”¨å®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å†ä½¿ç”¨ã€‚</p>
</blockquote>
<h4 id="3-1-synchronizedæ–¹æ³•"><a href="#3-1-synchronizedæ–¹æ³•" class="headerlink" title="3.1 synchronizedæ–¹æ³•"></a>3.1 synchronizedæ–¹æ³•</h4><blockquote>
<p><strong>åŒæ­¥æ–¹æ³•:  </strong>å°†æ“ä½œå…±äº«æ•°æ®çš„æ–¹æ³•å£°æ˜ä¸ºsynchronized,å³æ­¤æ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿä¿è¯å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹åœ¨å¤–ç­‰å¾…ï¼Œç›´è‡³æ­¤çº¿ç¨‹æ‰§è¡Œå®Œæ­¤æ–¹æ³•</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>synchronizedåŒæ­¥éé™æ€æ–¹æ³•:é»˜è®¤é”å®šçš„å¯¹è±¡æ˜¯è°ƒç”¨å½“å‰è°ƒç”¨æ­¤æ–¹æ³•çš„å¯¹è±¡å®ä¾‹(tr)ï¼Œä¹Ÿå°±æ˜¯this</li>
<li>synchronizedåŒæ­¥(static)é™æ€æ–¹æ³•:é»˜è®¤é”å®šçš„å¯¹è±¡æ˜¯å½“å‰ç±»å¯¹è±¡ï¼ˆThreadRunnable2.classï¼‰,å’Œträ¸ä¸€æ ·</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateThreadRunnable2</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œå”®ç¥¨çª—å£çš„æ¨¡æ‹Ÿæ“ä½œ*/</span></span><br><span class="line">        ThreadRunnable2 tr = <span class="keyword">new</span> ThreadRunnable2();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"å­™æ‚Ÿç©º"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"è‡³å°Šå®"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"ç™½æ™¶æ™¶"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**å®ç°Runnableæ¥å£çš„å®ç°ç±»*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadRunnable2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤šä¸ªçª—å£å…±äº«è¿™100å¼ ç¥¨èµ„æºï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä¸éœ€è¦è®¾ç½®ä¸ºstaticå±æ€§</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤–éƒ¨åœæ­¢æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                buy();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * synchronizedåŒæ­¥æ–¹æ³•:é»˜è®¤é”å®šçš„å¯¹è±¡æ˜¯å½“å‰ç±»(ThreadRunnable2),ä¹Ÿå°±æ˜¯this.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">if</span> (ticket &lt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// åˆ‡æ¢çº¿ç¨‹æ ‡å¿—ä½</span></span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå»¶æ—¶:æ”¾å¤§çº¿ç¨‹çš„å¹¶å‘é—®é¢˜</span></span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// ä¹°ç¥¨æ‰“å°</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"ä¹°åˆ°"</span> + ticket-- + <span class="string">"å·ç¥¨"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-2-synchronizedä»£ç å—"><a href="#3-2-synchronizedä»£ç å—" class="headerlink" title="3.2 synchronizedä»£ç å—"></a>3.2 synchronizedä»£ç å—</h4><blockquote>
<p><strong>åŒæ­¥ç›‘è§†å™¨:</strong> å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨èä½¿ç”¨é‚£ä¸ªå˜åŒ–(æœ‰å¢åˆ æ”¹æŸ¥çš„å…±äº«èµ„æºå¯¹è±¡)çš„å¯¹è±¡,å¹¶ä¸”æ˜¯è¢«å¤šä¸ªçº¿ç¨‹å…±äº«çš„èµ„æºå¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateThreadRunnable2</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * javaå®ç°çº¿ç¨‹çš„å®‰å…¨ï¼šçº¿ç¨‹çš„åŒæ­¥æœºåˆ¶</span></span><br><span class="line"><span class="comment">         * æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—</span></span><br><span class="line"><span class="comment">         * synchronized(åŒæ­¥ç›‘è§†å™¨){</span></span><br><span class="line"><span class="comment">         *      éœ€è¦åŒæ­¥çš„ä»£ç å—</span></span><br><span class="line"><span class="comment">         *      }</span></span><br><span class="line"><span class="comment">         *æ³¨æ„ï¼šåŒæ­¥ç›‘è§†å™¨:å¿…é¡»è¦æ˜¯é‚£ä¸ªå˜åŒ–(å¢åˆ æ”¹æŸ¥)çš„å¯¹è±¡,å¹¶ä¸”æ˜¯è¢«å¤šä¸ªçº¿ç¨‹å…±äº«çš„èµ„æºå¯¹è±¡</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        ThreadRunnable2 tr = <span class="keyword">new</span> ThreadRunnable2();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"å­™æ‚Ÿç©º"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"è‡³å°Šå®"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"ç™½æ™¶æ™¶"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**å®ç°Runnableæ¥å£çš„å®ç°ç±»*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadRunnable2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *å¤šä¸ªçª—å£å…±äº«è¿™100å¼ ç¥¨èµ„æºï¼Œ å¹¶ä¸”åœ¨è¿™é‡Œä¸éœ€è¦è®¾ç½®ä¸ºstaticå±æ€§</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤–éƒ¨åœæ­¢æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                buy();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="comment">// synchronizedåŒæ­¥ä»£ç å—</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">if</span> (ticket &lt;= <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// åˆ‡æ¢çº¿ç¨‹æ ‡å¿—ä½</span></span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿå»¶æ—¶:æ”¾å¤§çº¿ç¨‹çš„å¹¶å‘é—®é¢˜</span></span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            <span class="comment">// ä¹°ç¥¨æ‰“å°</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"ä¹°åˆ°"</span> + ticket-- + <span class="string">"å·ç¥¨"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-3-Locké”"><a href="#3-3-Locké”" class="headerlink" title="3.3 Locké”"></a>3.3 Locké”</h4><blockquote>
<p>locké”ï¼šå¯ä»¥æ˜¾å¼çš„åŠ é”å’Œè§£é”</p>
<ul>
<li>åˆ›å»ºlocké”å¯¹è±¡ï¼šprivate final ReentrantLock lock = new ReentrantLock();</li>
<li>å…¶ä»–çš„çœ‹ä¸‹é¢çš„ä»£ç </li>
</ul>
<p>synchronizedä¸lockçš„å¯¹æ¯”ï¼š</p>
<ul>
<li>Lockæ˜¯æ˜¾å¼é”ï¼ˆæ‰‹åŠ¨å¼€å¯å’Œå…³é—­é”ï¼Œä¸€å®šä¸è¦å¿˜è®°è§£é”ï¼‰ï¼Œsynchronizedæ˜¯éšå¼é”ï¼Œå‡ºäº†è‡ªåŠ¨åŸŸè‡ªåŠ¨é‡Šæ”¾</li>
<li>Lockåªæœ‰ä»£ç å—é”ï¼Œsynchronizedæœ‰ä»£ç å—é”å’Œæ–¹æ³•é”</li>
<li>Locké”æ€§èƒ½æ›´å¥½ï¼Œæ‰©å±•æ€§æ›´å¥½</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateThreadRunnable2</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        </span><br><span class="line">        ThreadRunnable2 tr = <span class="keyword">new</span> ThreadRunnable2();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"å­™æ‚Ÿç©º"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"è‡³å°Šå®"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(tr, <span class="string">"ç™½æ™¶æ™¶"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**å®ç°Runnableæ¥å£çš„å®ç°ç±»*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadRunnable2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *å¤šä¸ªçª—å£å…±äº«è¿™100å¼ ç¥¨èµ„æºï¼Œ å¹¶ä¸”åœ¨è¿™é‡Œä¸éœ€è¦è®¾ç½®ä¸ºstaticå±æ€§</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤–éƒ¨åœæ­¢æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªlocké”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (flag) {</span><br><span class="line">            lock.lock(); <span class="comment">// æ˜¾å¼åŠ é”</span></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                buy();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                lock.unlock(); <span class="comment">// æ— è®ºå¦‚ä½•,å¿…é¡»è§£é”</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">if</span> (ticket &lt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// åˆ‡æ¢çº¿ç¨‹æ ‡å¿—ä½</span></span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå»¶æ—¶:æ”¾å¤§çº¿ç¨‹çš„å¹¶å‘é—®é¢˜</span></span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// ä¹°ç¥¨æ‰“å°</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"ä¹°åˆ°"</span> + ticket-- + <span class="string">"å·ç¥¨"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-çº¿ç¨‹é€šä¿¡"><a href="#4-çº¿ç¨‹é€šä¿¡" class="headerlink" title="4. çº¿ç¨‹é€šä¿¡"></a>4. çº¿ç¨‹é€šä¿¡</h3><h4 id="4-1-ç®¡é€šæ³•"><a href="#4-1-ç®¡é€šæ³•" class="headerlink" title="4.1 ç®¡é€šæ³•"></a>4.1 ç®¡é€šæ³•</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> horse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/22 10:46</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹é€šä¿¡:ç”Ÿäº§è€…--æ¶ˆè´¹è€…é—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadCommunication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        SynContainer synContainer = <span class="keyword">new</span> SynContainer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> pro(synContainer), <span class="string">"ç”Ÿäº§è€…"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> cus(synContainer), <span class="string">"æ¶ˆè´¹è€…==&gt;"</span>).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…:åªè´Ÿè´£ç”Ÿäº§å•†å“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pro</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    SynContainer synContainer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">pro</span><span class="params">(SynContainer synContainer)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.synContainer = synContainer;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="comment">// ç”Ÿäº§è€…ä¸€ç›´ç”Ÿäº§å•†å“</span></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            synContainer.push();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…:åªè´Ÿè´£æ¶ˆè´¹å•†å“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cus</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    SynContainer synContainer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">cus</span><span class="params">(SynContainer synContainer)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.synContainer = synContainer;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">150</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ¶ˆè´¹è€…ä¸€ç›´æ¶ˆè´¹å•†å“</span></span><br><span class="line">            synContainer.pop();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼“å†²åŒº:å½“æœ‰å•†å“æ—¶,é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹,å½“æ¶ˆè´¹ä¹‹å,é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§,ç›¸å½“äºå–è´§çš„åº—å‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SynContainer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…ç”Ÿäº§å•†å“</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœå®¹å™¨æ»¡äº†,ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">15</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(<span class="string">"===="</span>);</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        count++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"ç”Ÿäº§äº†ç¬¬"</span> + count + <span class="string">"ä»¶å•†å“"</span>);</span><br><span class="line">        <span class="comment">// æœ‰å•†å“äº†:é€šçŸ¥æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…æ¶ˆè´¹å•†å“</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœå®¹å™¨æ²¡æœ‰å•†å“:é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§å•†å“</span></span><br><span class="line">        <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(<span class="string">"+++++"</span>);</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹å•†å“</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"æ¶ˆè´¹äº†ç¬¬"</span> + count + <span class="string">"ä»¶å•†å“"</span>);</span><br><span class="line">        count--;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹äº†å•†å“:é€šçŸ¥ç”Ÿäº§è€…å¯ä»¥ç»§ç»­è¿›è¡Œç”Ÿäº§äº†</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-2-ä¿¡å·ç¯æ³•"><a href="#4-2-ä¿¡å·ç¯æ³•" class="headerlink" title="4.2 ä¿¡å·ç¯æ³•"></a>4.2 ä¿¡å·ç¯æ³•</h4><blockquote>
<p>ä¾‹å¦‚:</p>
<ul>
<li><p>å½“flag=trueæ—¶,æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®,é€šçŸ¥è§‚ä¼—è§‚çœ‹;å½“flag=falseæ—¶ï¼Œæ¼”å‘˜ç­‰å¾…</p>
</li>
<li><p>å½“flag=trueæ—¶ï¼Œè§‚ä¼—ç­‰å¾…ï¼Œå½“flag=flaseæ—¶,è§‚ä¼—çœ‹èŠ‚ç›®,çœ‹å®Œä¹‹åï¼Œé€šçŸ¥æ¼”å‘˜å¯ä»¥ç»§ç»­è¡¨æ¼”èŠ‚ç›®</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlinkerFlag</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹é€šä¿¡: ä¿¡å·ç¯æ³•</span></span><br><span class="line"><span class="comment">         * ä¾‹å¦‚: æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®,è§‚ä¼—è§‚çœ‹èŠ‚ç›®,å½“flag=trueæ—¶,æ¼”å‘˜æœ‰èŠ‚ç›®,é€šçŸ¥è§‚ä¼—è§‚çœ‹,å½“è§‚ä¼—çœ‹å®ŒèŠ‚ç›®æ—¶,é€šçŸ¥æ¼”å‘˜å¯ä»¥ç»§ç»­è¡¨æ¼”èŠ‚ç›®</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line"></span><br><span class="line">        TV tv = <span class="keyword">new</span> TV();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Actor(tv)).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Watcher(tv)).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…--æ¼”å‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Actor</span><span class="params">(TV tv)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// å¼€å§‹è¡¨æ¼”èŠ‚ç›®:ç´¯è®¡50åœº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="comment">// æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®</span></span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">"å€šå¤©å± é¾™è®°"</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">"ç¥é›•ä¾ ä¾£"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…--è§‚ä¼—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Watcher</span><span class="params">(TV tv)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="comment">// è§‚ä¼—è§‚çœ‹èŠ‚ç›®</span></span><br><span class="line">            <span class="keyword">this</span>.tv.watch();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº§å“--èŠ‚ç›®</span></span><br><span class="line"><span class="comment"> * æµç¨‹:æ¼”å‘˜è¡¨æ¼”,è§‚ä¼—ç­‰å¾… flag= true</span></span><br><span class="line"><span class="comment"> * è§‚ä¼—è§‚çœ‹,æ¼”å‘˜ç­‰å¾… flag = false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TV</span> </span>{</span><br><span class="line"></span><br><span class="line">    String voice; <span class="comment">// è¡¨æ¼”çš„èŠ‚ç›®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;  <span class="comment">// æ˜¯å¦è¡¨æ¼”/ç­‰å¾…çš„æ ‡å¿—ä½</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¼”å‘˜è¡¨æ¼”</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String voice)</span> </span>{</span><br><span class="line">        <span class="comment">// flag=false:æ¼”å‘˜ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (!flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// flag=true:æ¼”å‘˜è¡¨æ¼”</span></span><br><span class="line">        System.out.println(<span class="string">"æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®==&gt;"</span> + voice);</span><br><span class="line">        <span class="comment">// æ›´æ–°æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">        <span class="comment">// æ›´æ–°èŠ‚ç›®å•</span></span><br><span class="line">        <span class="keyword">this</span>.voice = voice;</span><br><span class="line">        <span class="comment">// å”¤é†’è§‚ä¼—çº¿ç¨‹:é€šçŸ¥è§‚ä¼—å¯ä»¥è§‚çœ‹èŠ‚ç›®äº†</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§‚ä¼—è§‚çœ‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">watch</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// flag=true:è§‚ä¼—ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// flag=false:è§‚ä¼—è§‚çœ‹</span></span><br><span class="line">        System.out.println(<span class="string">"è§‚ä¼—è§‚çœ‹èŠ‚ç›®===&gt;"</span> + voice);</span><br><span class="line">        <span class="comment">// æ›´æ–°æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">        <span class="comment">// å”¤é†’æ¼”å‘˜çº¿ç¨‹:é€šçŸ¥æ¼”å‘˜å¯ä»¥è¡¨æ¼”èŠ‚ç›®äº†</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-3-çº¿ç¨‹æ± "><a href="#4-3-çº¿ç¨‹æ± " class="headerlink" title="4.3 çº¿ç¨‹æ± "></a>4.3 çº¿ç¨‹æ± </h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlinkerFlag</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">		<span class="comment">// å°±è¿™é‡Œå¼€å¯çº¿ç¨‹çš„æ–¹å¼ä¸ä¸€æ ·ï¼šä½¿ç”¨äº†çº¿ç¨‹æ± </span></span><br><span class="line">        TV tv = <span class="keyword">new</span> TV();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„çº¿ç¨‹æ± (å¿½ç•¥æŠ¥é”™),å‚æ•°:çº¿ç¨‹æ± çš„å¤§å°</span></span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// å¼€å§‹æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">        service.execute(<span class="keyword">new</span> Actor(tv));</span><br><span class="line">        service.execute(<span class="keyword">new</span> Watcher(tv));</span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹è¿æ¥</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…--æ¼”å‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Actor</span><span class="params">(TV tv)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// å¼€å§‹è¡¨æ¼”èŠ‚ç›®:ç´¯è®¡50åœº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="comment">// æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®</span></span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">"å€šå¤©å± é¾™è®°"</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">"ç¥é›•ä¾ ä¾£"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…--è§‚ä¼—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Watcher</span><span class="params">(TV tv)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) {</span><br><span class="line">            <span class="comment">// è§‚ä¼—è§‚çœ‹èŠ‚ç›®</span></span><br><span class="line">            <span class="keyword">this</span>.tv.watch();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº§å“--èŠ‚ç›®</span></span><br><span class="line"><span class="comment"> * æµç¨‹:æ¼”å‘˜è¡¨æ¼”,è§‚ä¼—ç­‰å¾… flag= true</span></span><br><span class="line"><span class="comment"> * è§‚ä¼—è§‚çœ‹,æ¼”å‘˜ç­‰å¾… flag = false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TV</span> </span>{</span><br><span class="line"></span><br><span class="line">    String voice; <span class="comment">// è¡¨æ¼”çš„èŠ‚ç›®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;  <span class="comment">// æ˜¯å¦è¡¨æ¼”/ç­‰å¾…çš„æ ‡å¿—ä½</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¼”å‘˜è¡¨æ¼”</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String voice)</span> </span>{</span><br><span class="line">        <span class="comment">// flag=false:æ¼”å‘˜ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (!flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// flag=true:æ¼”å‘˜è¡¨æ¼”</span></span><br><span class="line">        System.out.println(<span class="string">"æ¼”å‘˜è¡¨æ¼”èŠ‚ç›®==&gt;"</span> + voice);</span><br><span class="line">        <span class="comment">// æ›´æ–°æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">        <span class="comment">// æ›´æ–°èŠ‚ç›®å•</span></span><br><span class="line">        <span class="keyword">this</span>.voice = voice;</span><br><span class="line">        <span class="comment">// å”¤é†’è§‚ä¼—çº¿ç¨‹:é€šçŸ¥è§‚ä¼—å¯ä»¥è§‚çœ‹èŠ‚ç›®äº†</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§‚ä¼—è§‚çœ‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">watch</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// flag=true:è§‚ä¼—ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// flag=false:è§‚ä¼—è§‚çœ‹</span></span><br><span class="line">        System.out.println(<span class="string">"è§‚ä¼—è§‚çœ‹èŠ‚ç›®===&gt;"</span> + voice);</span><br><span class="line">        <span class="comment">// æ›´æ–°æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">        <span class="comment">// å”¤é†’æ¼”å‘˜çº¿ç¨‹:é€šçŸ¥æ¼”å‘˜å¯ä»¥è¡¨æ¼”èŠ‚ç›®äº†</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="NginxåŸºç¡€"><a href="#NginxåŸºç¡€" class="headerlink" title="NginxåŸºç¡€"></a>NginxåŸºç¡€</h2><h3 id="1-nginxåŠŸèƒ½"><a href="#1-nginxåŠŸèƒ½" class="headerlink" title="1. nginxåŠŸèƒ½"></a>1. nginxåŠŸèƒ½</h3><blockquote>
<p><strong>åå‘ä»£ç†ï¼š</strong>å®¢æˆ·ç«¯ä¸éœ€è¦åšä»»ä½•é…ç½®ï¼Œåªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©çœŸæ­£çš„ç›®æ ‡æœåŠ¡å™¨è·å–æ•°æ®åï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš´éœ²çš„æ—¶æ³•ç›¸ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨çš„IPåœ°å€ã€‚</p>
<p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong>å½“å•ä¸ªæœåŠ¡å™¨ä¸èƒ½è§£å†³é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡çš„åŸç†ã€‚</p>
<p><strong>åŠ¨é™åˆ†ç¦»ï¼š</strong>ä¸ºåŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€èµ„æºå’Œé™æ€èµ„æºç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æï¼ŒåŠ å¿«è§£æç†Ÿè¯»ï¼Œé™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>
</blockquote>
<h3 id="2-nginxå‘½ä»¤"><a href="#2-nginxå‘½ä»¤" class="headerlink" title="2. nginxå‘½ä»¤"></a>2. nginxå‘½ä»¤</h3><blockquote>
<p>æ³¨æ„ï¼šå¿…é¡»è¦åœ¨nginxçš„å®‰è£…ç›®å½•ä¸‹æ‰èƒ½ä½¿ç”¨nginxçš„ç›¸å…³å‘½ä»¤</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">åŠŸèƒ½</th>
<th style="text-align:left">å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">æŸ¥çœ‹é…ç½®æ˜¯å¦æ­£ç¡®</td>
<td style="text-align:left">nginx -t</td>
</tr>
<tr>
<td style="text-align:left">æŸ¥çœ‹ç‰ˆæœ¬å·</td>
<td style="text-align:left">nginx -v</td>
</tr>
<tr>
<td style="text-align:left">å¯åŠ¨nginx</td>
<td style="text-align:left">start nginx</td>
</tr>
<tr>
<td style="text-align:left">å¼ºåˆ¶åœæ­¢nginx</td>
<td style="text-align:left">nginx -s stop</td>
</tr>
<tr>
<td style="text-align:left">ä¼˜é›…åœæ­¢nginx</td>
<td style="text-align:left">nginx -s quit</td>
</tr>
<tr>
<td style="text-align:left">é‡æ–°åŠ è½½nginxï¼ˆä¸€èˆ¬åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶åä½¿ç”¨ï¼‰</td>
<td style="text-align:left">nginx -s reload</td>
</tr>
<tr>
<td style="text-align:left">windowsä¸‹æŸ¥çœ‹nginxè¿›ç¨‹ï¼ˆæ˜¯å¦å¯åŠ¨ï¼‰</td>
<td style="text-align:left">tasklist /fi â€œimagename eq nginx.exeâ€</td>
</tr>
<tr>
<td style="text-align:left">LiunxæŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£å·</td>
<td style="text-align:left">firewall-cmd â€”list-all</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-åå‘ä»£ç†"><a href="#3-åå‘ä»£ç†" class="headerlink" title="3. åå‘ä»£ç†"></a>3. åå‘ä»£ç†</h3><h4 id="3-1-ä»£ç†é…ç½®"><a href="#3-1-ä»£ç†é…ç½®" class="headerlink" title="3.1 ä»£ç†é…ç½®"></a>3.1 ä»£ç†é…ç½®</h4><blockquote>
<p>åå‘ä»£ç†å®ä¾‹1ï¼šç›´æ¥åå‘ä»£ç†ï¼Œé€šè¿‡è®¿é—®åŸŸåï¼ˆmanage.leyou.comï¼‰æ¥é—´æ¥è®¿é—®æœåŠ¡å™¨ä¸­çš„tomcatæœåŠ¡å™¨ï¼ˆ47.99.152.217:8080ï¼‰</p>
<ul>
<li>å‡†å¤‡å·¥ä½œï¼šmanage.leyou.comæ˜ å°„æˆ127.0.0.1</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  server {</span><br><span class="line">      listen       80;  # ç›‘å¬ç«¯å£</span><br><span class="line">      server_name  manage.leyou.com;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line"># åå‘ä»£ç†è½¬å‘é…ç½®</span><br><span class="line">      location / {</span><br><span class="line">	proxy_pass http:<span class="comment">//47.99.152.217:8080;  # ä»£ç†è½¬å‘ç›®æ ‡åœ°å€</span></span><br><span class="line">	proxy_connect_timeout 600; # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">	proxy_read_timeout 600; # è¯·æ±‚è¯»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">      location = /50x.html {</span><br><span class="line">          root   html;</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>åå‘ä»£ç†å®ä¾‹2ï¼š<strong>æ ¹æ®è®¿é—®çš„è·¯å¾„ä¸åŒè·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­</strong></p>
<ul>
<li>å‡†å¤‡å·¥ä½œ:ä¸¤å°ä¸åŒç«¯å£çš„tomcatæœåŠ¡å™¨ï¼Œåˆ†åˆ«æ”¾ç½®ä¸åŒçš„è·¯å¾„å’Œé¡µé¢ï¼Œ</li>
<li>å®ç°æ•ˆæœï¼š<ul>
<li>å½“è®¿é—®manage.leyou.com:9001/vod/xxx.jspè·¯å¾„æ—¶ï¼Œè½¬å‘åˆ°ç¬¬ä¸€ä¸ªlocationé…ç½®è·¯å¾„ä¸­å»ï¼›</li>
<li>å½“è®¿é—®manage.leyou.com:9001/edu/xxx.jspè·¯å¾„æ—¶ï¼Œè½¬å‘åˆ°ç¬¬äºŒä¸ªlocationé…ç½®è·¯å¾„ä¸­å»</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  server {</span><br><span class="line">      listen       9001;  # ç›‘å¬ç«¯å£</span><br><span class="line">      server_name  manage.leyou.com;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line"># åå‘ä»£ç†è½¬å‘é…ç½®(ä¸€ä¸ªserverä¸­å¯ä»¥é…ç½®å¤šä¸ªlocation)</span><br><span class="line">      location ~ /vod/ {</span><br><span class="line">	proxy_pass http:<span class="comment">//47.99.152.217:8080;  # ä»£ç†è½¬å‘ç›®æ ‡åœ°å€</span></span><br><span class="line">	proxy_connect_timeout 600; # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">	proxy_read_timeout 600; # è¯·æ±‚è¯»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">location ~ /edu/ {</span><br><span class="line">	proxy_pass http:<span class="comment">//47.99.152.217:8081;  # ä»£ç†è½¬å‘ç›®æ ‡åœ°å€</span></span><br><span class="line">	proxy_connect_timeout 600; # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">	proxy_read_timeout 600; # è¯·æ±‚è¯»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">      location = /50x.html {</span><br><span class="line">          root   html;</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-2-locationåŒ¹é…è§„åˆ™"><a href="#3-2-locationåŒ¹é…è§„åˆ™" class="headerlink" title="3.2 locationåŒ¹é…è§„åˆ™"></a>3.2 locationåŒ¹é…è§„åˆ™</h4><blockquote>
<p>ä¼˜å…ˆçº§ï¼š(location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location ^~ è·¯å¾„) &gt; (location ,* æ­£åˆ™é¡ºåº) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) &gt; (/)</p>
</blockquote>
<p>å…·ä½“ä»‹ç»ï¼š</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è§„åˆ™ä¸èƒ½æ··åˆä½¿ç”¨</li>
<li>ä»¥ä¸‹è¯´æ˜éƒ½æ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªserveré…ç½®ä¸ºåŸºç¡€</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">server {</span><br><span class="line">       listen       <span class="number">8861</span>;</span><br><span class="line">       server_name  abc.com;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-1-â€œ-â€"><a href="#3-2-1-â€œ-â€" class="headerlink" title="3.2.1 â€œ=â€"></a>3.2.1 â€œ=â€</h5><blockquote>
<p>â€œ=â€ï¼šåœ°å€è¦å®Œå…¨ä¸€è‡´æ‰èƒ½åŒ¹é…æˆåŠŸ</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">location = / {</span><br><span class="line">   .....</span><br><span class="line">}</span><br><span class="line"># åªåŒ¹é… http://abc.com</span><br><span class="line">#  http://abc.com [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#  http://abc.com/index [åŒ¹é…å¤±è´¥]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-1-â€œ-â€-1"><a href="#3-2-1-â€œ-â€-1" class="headerlink" title="3.2.1 â€œ~â€"></a>3.2.1 â€œ~â€</h5><blockquote>
<p>â€œ~â€ï¼šå¤§å°å†™æ•æ„Ÿï¼Œåªè¦åœ°å€ä¸­åŒ…å«æ­¤åœ°å€æ®µå¹¶ä¸”å¤§å°å†™ä¸€è‡´ï¼Œå³å¯åŒ¹é…æˆåŠŸ</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">location ~ /Example/ {</span><br><span class="line">   .....</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#http://abc.com/Example/  [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#http://abc.com/example/  [åŒ¹é…å¤±è´¥]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-3-â€œ-â€œ"><a href="#3-2-3-â€œ-â€œ" class="headerlink" title="3.2.3  â€œ~*â€œ"></a>3.2.3  â€œ~*â€œ</h5><blockquote>
<p>â€œ~*â€:å¤§å°å†™ä¸æ•æ„Ÿï¼Œåªè¦åªè¦åœ°å€ä¸­åŒ…å«æ­¤åœ°å€æ®µï¼Œå³å¯åŒ¹é…æˆåŠŸ</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">location ~* /Example/ {</span><br><span class="line">   .....</span><br><span class="line">}</span><br><span class="line"># åˆ™ä¼šå¿½ç•¥ uri éƒ¨åˆ†çš„å¤§å°å†™</span><br><span class="line">#http://abc.com/test/Example/  [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#http://abc.com/example/  [åŒ¹é…æˆåŠŸ]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-4-â€œ-â€"><a href="#3-2-4-â€œ-â€" class="headerlink" title="3.2.4 â€œ^~â€"></a>3.2.4 â€œ^~â€</h5><blockquote>
<p>â€œ^~â€ï¼šåªåŒ¹é…ä»¥é…ç½®çš„uriå¼€å¤´çš„</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">location ^~ /index/ {</span><br><span class="line">   .....</span><br><span class="line">}</span><br><span class="line">#ä»¥ /index/ å¼€å¤´çš„è¯·æ±‚ï¼Œéƒ½ä¼šåŒ¹é…ä¸Š</span><br><span class="line">#http://abc.com/index/index.page   [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#http://abc.com/error/error.page [åŒ¹é…å¤±è´¥]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-5-â€œ-â€"><a href="#3-2-5-â€œ-â€" class="headerlink" title="3.2.5 â€œ@â€"></a>3.2.5 â€œ@â€</h5><blockquote>
<p>â€œ@â€:nginxçš„å†…éƒ¨è·³è½¬ï¼ˆä¸å¸¸ç”¨ï¼‰</p>
</blockquote>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">location /index/ {</span><br><span class="line">    error_page <span class="number">404</span> <span class="meta">@index_error</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">location <span class="meta">@index_error</span> {</span><br><span class="line">   .....</span><br><span class="line">}</span><br><span class="line">#ä»¥ /index/ å¼€å¤´çš„è¯·æ±‚ï¼Œå¦‚æœé“¾æ¥çš„çŠ¶æ€ä¸º 404ã€‚åˆ™ä¼šåŒ¹é…åˆ° @index_error è¿™æ¡è§„åˆ™ä¸Šã€‚ </span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-2-6-æ— åŒ¹é…ç¬¦"><a href="#3-2-6-æ— åŒ¹é…ç¬¦" class="headerlink" title="3.2.6 æ— åŒ¹é…ç¬¦"></a>3.2.6 æ— åŒ¹é…ç¬¦</h5><blockquote>
<ul>
<li>ä¸åŠ ä»»ä½•è§„åˆ™åˆ™æ—¶ï¼Œé»˜è®¤æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œå‰ç¼€åŒ¹é…ï¼Œç›¸å½“äºåŠ äº†â€œ~â€ä¸â€œ^~â€</li>
<li>åªæœ‰ â€œ/â€ è¡¨ç¤ºåŒ¹é…æ‰€æœ‰uri</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">location /index/ {</span><br><span class="line">    ......</span><br><span class="line">}</span><br><span class="line">#http://abc.com/index   [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#http://abc.com/index/index.page   [åŒ¹é…æˆåŠŸ]</span><br><span class="line">#http://abc.com/test/index   [åŒ¹é…å¤±è´¥ï¼ˆä¸æ˜¯å‰ç¼€ï¼‰]</span><br><span class="line">#http://abc.com/Index   [åŒ¹é…å¤±è´¥(å¤§å°å†™é”™è¯¯)]</span><br><span class="line"></span><br><span class="line"># åŒ¹é…åˆ°æ‰€æœ‰uri</span><br><span class="line">location / {</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-è´Ÿè½½å‡è¡¡"><a href="#4-è´Ÿè½½å‡è¡¡" class="headerlink" title="4. è´Ÿè½½å‡è¡¡"></a>4. è´Ÿè½½å‡è¡¡</h3><blockquote>
<p>  å®ä¾‹ï¼šå½“è®¿é—®47.99.152.217:80/edu/xxx.jspé¡µé¢æ—¶ï¼Œç”±äºé…ç½®äº†æœåŠ¡æµï¼Œæ‰€ä»¥é»˜è®¤ä¼šä»¥<strong>è½®è¯¢</strong>çš„æ–¹å¼è½¬å‘åˆ°æœåŠ¡æµä¸­çš„å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå°±ç›¸å½“äºè®¿é—®47.99.152.217:808x/edu/xxx.jspé¡µé¢ï¼Œæ­¤æ–¹å¼è¢«ç§°ä¸ºè´Ÿè½½å‡è¡¡ã€‚</p>
<p>åˆ†é…ç­–ç•¥ï¼š</p>
<ul>
<li>è½®è¯¢ï¼šé»˜è®¤ç­–ç•¥ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒæœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œå°±è‡ªåŠ¨å‰”é™¤ã€‚</li>
<li>æƒé‡(weight)ï¼šä»£è¡¨æƒé‡ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡è¶Šé«˜è¢«åˆ†é…çš„å®¢æˆ·ç«¯è¶Šå¤šï¼Œæ­¤æœåŠ¡å™¨è¢«åˆ†é…åˆ°çš„æ¦‚ç‡è¶Šå¤§ã€‚</li>
<li>ip_hashï¼šæ¯ä¸ªè¯·æ±‚æŒ‰ç…§è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·åªè¦ipè®¿é—®è¿‡å¹¶è¢«åˆ†é…è¿‡æœåŠ¡å™¨ä¹‹åï¼Œä»¥åå†æ¬¡æ–¹ä½ï¼Œåˆ†é…çš„éƒ½å°†æ˜¯åŒä¸€ä¸ªæœåŠ¡å™¨ï¼ˆå¯ä»¥æœ‰æ•ˆè§£å†³sessionå…±äº«é—®é¢˜ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">http {</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">	</span><br><span class="line">	# åˆ›å»ºæœåŠ¡æµï¼ˆmyServer:è‡ªå®šä¹‰çš„æœåŠ¡æµåç§°ï¼‰</span><br><span class="line">    # é»˜è®¤è½®è¯¢ç­–ç•¥</span><br><span class="line">	upstream myServer {</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span>;</span><br><span class="line">	}</span><br><span class="line">    </span><br><span class="line">     # æƒé‡ç­–ç•¥+å¤±è´¥é‡è¯•</span><br><span class="line">     # åœ¨fail_timeoutæ—¶é—´å†…å¤±è´¥äº†max_failsæ¬¡åï¼Œåˆ™ä»»åŠ¡è¯¥ä¸Šæ¸¸æœåŠ¡å™¨ä¸å¯ç”¨ç»™ï¼Œç„¶åå°†è¯¥æœåŠ¡å™¨åœ°å€å‰”é™¤æ‰ã€‚fail_timeoutçš„æ—¶é—´åä¼šå†æ¬¡å°†è¯¥æœåŠ¡å™¨åŠ å…¥åˆ°å­˜æ´»åˆ—è¡¨ä¸­ï¼Œè¿›è¡Œè¯·æ±‚é‡è¯•ã€‚</span><br><span class="line">	upstream myServer {</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span> weight=<span class="number">5</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">60</span>s;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span> weight=<span class="number">10</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">60</span>s;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span> weight=<span class="number">8</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">60</span>s;</span><br><span class="line">	}</span><br><span class="line">    </span><br><span class="line">      # ip_hashæ–¹å¼</span><br><span class="line">	upstream myServer {</span><br><span class="line">         ip_hash               # åªè¦æ·»ä¸Šè¿™ä¸€å¥ï¼Œå°±æ˜¯ip_hashåˆ†é…ç­–ç•¥</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8080</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8081</span>;</span><br><span class="line">		server <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>:<span class="number">8082</span>;</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">    server {</span><br><span class="line">        listen       <span class="number">80</span>;  # ç›‘å¬ç«¯å£</span><br><span class="line">        server_name  <span class="number">47.99</span><span class="number">.152</span><span class="number">.217</span>;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line">		# åå‘ä»£ç†è½¬å‘é…ç½®(ä¸€ä¸ªserverä¸­å¯ä»¥é…ç½®å¤šä¸ªlocation)</span><br><span class="line">        location / {</span><br><span class="line">			proxy_pass http:<span class="comment">//myServer;  # è´Ÿè½½å‡è¡¡çš„æœåŠ¡æµåç§°</span></span><br><span class="line">			proxy_connect_timeout <span class="number">600</span>; # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">			proxy_read_timeout <span class="number">600</span>; # è¯·æ±‚è¯»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¹Ÿå¯ä»¥ï¼‰</span><br><span class="line">        }</span><br><span class="line">		</span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html {</span><br><span class="line">            root   html;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-åŠ¨é™åˆ†ç¦»"><a href="#5-åŠ¨é™åˆ†ç¦»" class="headerlink" title="5. åŠ¨é™åˆ†ç¦»"></a>5. åŠ¨é™åˆ†ç¦»</h3><blockquote>
<p>å°çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><code>alias</code>æ˜¯æŠŠlocationçš„å€¼æ›¿æ¢æ‰</li>
<li><code>root</code>æ˜¯æ‹¼æ¥locationçš„å€¼ï¼ˆåŒ…æ‹¬â€/â€œç¬¦å·ï¼‰</li>
<li>autoindex onï¼šè‡ªåŠ¨å±•ç¤ºè®¿é—®çš„æ–‡ä»¶å¤¹åˆ—è¡¨æ–‡ä»¶</li>
</ul>
<p>å‡†å¤‡å·¥ä½œï¼šæ­¤C:\Users\é©¬æ»¨\Pictures\WebBg\index_bg.jpgè·¯å¾„ä¸‹å­˜åœ¨ä¸€å¼ å›¾ç‰‡</p>
<p>==æ³¨æ„ï¼š é™æ€èµ„æºçš„æ–‡ä»¶è·¯å¾„ä¸èƒ½åŒ…å«æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™ï¼ï¼ï¼==</p>
</blockquote>
<p>rootæ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  server {</span><br><span class="line">      listen       80;  # ç›‘å¬ç«¯å£</span><br><span class="line">      server_name  localhost;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line"># rootæ–¹å¼ï¼šé…ç½®è®¿é—®é™æ€å›¾ç‰‡</span><br><span class="line">      location /WebBg/ {</span><br><span class="line">	root C:/Users/é©¬æ»¨/Pictures;</span><br><span class="line">	autoindex on;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">      location = /50x.html {</span><br><span class="line">          root   html;</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>aliasæ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  server {</span><br><span class="line">      listen       80;  # ç›‘å¬ç«¯å£</span><br><span class="line">      server_name  localhost;  # ç›‘å¬åœ°å€</span><br><span class="line"></span><br><span class="line"># aliasæ–¹å¼ï¼šé…ç½®è®¿é—®é™æ€å›¾ç‰‡</span><br><span class="line">      location /WebBg/ {</span><br><span class="line">	alias C:/Users/é©¬æ»¨/Pictures/WebBg/;</span><br><span class="line">	autoindex on;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">      location = /50x.html {</span><br><span class="line">          root   html;</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-IPé™æµ"><a href="#6-IPé™æµ" class="headerlink" title="6. IPé™æµ"></a>6. IPé™æµ</h3><blockquote>
<p>é…ç½®æ­¥éª¤ï¼š</p>
<ul>
<li>é…ç½®é™æµçš„å…·ä½“ç­–ç•¥å‚æ•°</li>
<li>è®¾ç½®é™æµ</li>
</ul>
</blockquote>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"># é…ç½®é™æµçš„å…·ä½“ç­–ç•¥å‚æ•°</span><br><span class="line">   # limit_req_zoneéœ€è¦å®šä¹‰åœ¨å®šä¹‰åœ¨httpå—ä¸­</span><br><span class="line"># $binary_remote_addrï¼šä¿å­˜å®¢æˆ·ç«¯IPçš„äºŒè¿›åˆ¶å½¢å¼</span><br><span class="line"><span class="meta"># zoneï¼šå®šä¹‰IPçŠ¶æ€åŠURLè®¿é—®é¢‘ç‡çš„å…±äº«å†…å­˜åŒºåŸŸã€‚zone=keywordï¼šæ ‡è¯†åŒºåŸŸçš„åå­—ï¼ˆè‡ªå®šä¹‰åç§°ï¼‰ï¼Œå†’å·åé¢è·ŸåŒºåŸŸå¤§å°ï¼ˆ16000ä¸ªIPåœ°å€çš„çŠ¶æ€ä¿¡æ¯çº¦1MBï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­åŒºåŸŸå¯ä»¥å­˜å‚¨160000ä¸ªIPåœ°å€ï¼‰</span></span><br><span class="line"><span class="meta"># rateï¼šå®šä¹‰æœ€å¤§è¯·æ±‚é€Ÿç‡ï¼Œç¤ºä¾‹ä¸­é€Ÿç‡ä¸è¶…è¿‡æ¯ç§’100ä¸ªè¯·æ±‚</span></span><br><span class="line">limit_req_zone $binary_remote_addr zone=mylimit:<span class="number">10</span>m rate=<span class="number">100</span>r/s;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">location /platform/file/ {</span><br><span class="line">	proxy_connect_timeout   <span class="number">300</span>;</span><br><span class="line">	proxy_send_timeout      <span class="number">600</span>;</span><br><span class="line">	proxy_read_timeout      <span class="number">600</span>;</span><br><span class="line">	proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">	proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">	proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	proxy_set_header X-Forwarded-Scheme  $scheme;</span><br><span class="line">	proxy_set_header X-Forwarded-Server $host;</span><br><span class="line">	proxy_pass http:<span class="comment">//fapi-test/viewOnline/;</span></span><br><span class="line">	# è®¾ç½®é™æµ</span><br><span class="line">	<span class="meta"># burstï¼šè¡¨ç¤ºæ’é˜Ÿçš„å¤§å°</span></span><br><span class="line">	<span class="meta"># nodelayï¼šè¡¨ç¤ºä¸é™åˆ¶å•ä¸ªè¯·æ±‚é—´çš„æ—¶é—´</span></span><br><span class="line">	limit_req zone=mylimit burst=<span class="number">20</span> nodelay;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="7-é™æµç™½åå•"><a href="#7-é™æµç™½åå•" class="headerlink" title="7. é™æµç™½åå•"></a>7. é™æµç™½åå•</h4><blockquote>
<p>é€šè¿‡é…ç½®IPç™½åå•ç»“åˆIPé™æµçš„é…ç½®ï¼Œå®ç°ç™½åå•åŠŸèƒ½é…ç½®ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta"># geoæŒ‡ä»¤ï¼šå®šä¹‰ä¸€ä¸ª $whitelist ç™½åå•ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œè¡¨ç¤ºæ‰€æœ‰ipéƒ½å—é™åˆ¶ã€‚å¦‚æœå®¢æˆ·ç«¯ipå’Œç™½åå•åˆ—å‡ºçš„IPç›¸åŒ¹é…ï¼Œåˆ™å¯¹åº”çš„å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸å—é™åˆ¶</span></span><br><span class="line">	geo $whitelist {</span><br><span class="line">		defalut <span class="number">1</span>;</span><br><span class="line">		<span class="number">192.168</span><span class="number">.1</span><span class="number">.120</span> <span class="number">0</span>;</span><br><span class="line">        <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">0</span>;</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="meta"># mapæŒ‡ä»¤ï¼šå°†ä¸Šé¢ $whitelist å€¼ä¸º1çš„ï¼Œä¹Ÿå°±æ˜¯å—é™åˆ¶ipï¼Œæ˜ å°„ä¸ºå®¢æˆ·ç«¯IPã€‚å°† $whitelist å€¼ä¸º0çš„ï¼Œä¹Ÿå°±æ˜¯ç™½åå•IPï¼Œæ˜ å°„ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">	<span class="built_in">map</span> $whitelist $limit_key {</span><br><span class="line">		<span class="number">1</span> $binary_remote_addr;</span><br><span class="line">		<span class="number">0</span> <span class="string">""</span>;</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	# é™æµå‚æ•°é…ç½®</span><br><span class="line">	# limit_req_zone å’Œ limit_conn_zone æŒ‡ä»¤å¯¹äºé”®å€¼ä¸ºç©ºå€¼çš„å°†è¢«å¿½ç•¥ï¼Œä»è€Œå®ç°å¯¹ç™½åå•ä¸­çš„IPä¸åšé™åˆ¶</span><br><span class="line">	# $binary_remote_addrï¼šä¿å­˜å®¢æˆ·ç«¯IPçš„äºŒè¿›åˆ¶å½¢å¼</span><br><span class="line">	<span class="meta"># zoneï¼šå®šä¹‰IPçŠ¶æ€åŠURLè®¿é—®é¢‘ç‡çš„å…±äº«å†…å­˜åŒºåŸŸã€‚zone=keywordï¼šæ ‡è¯†åŒºåŸŸçš„åå­—ï¼ˆè‡ªå®šä¹‰åç§°ï¼‰ï¼Œå†’å·åé¢è·ŸåŒºåŸŸå¤§å°ï¼ˆ16000ä¸ªIPåœ°å€çš„çŠ¶æ€ä¿¡æ¯çº¦1MBï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­åŒºåŸŸå¯ä»¥å­˜å‚¨160000ä¸ªIPåœ°å€ï¼‰</span></span><br><span class="line">	<span class="meta"># rateï¼šå®šä¹‰æœ€å¤§è¯·æ±‚é€Ÿç‡ï¼Œç¤ºä¾‹ä¸­é€Ÿç‡ä¸è¶…è¿‡æ¯ç§’100ä¸ªè¯·æ±‚</span></span><br><span class="line">	limit_req_zone $limit_key zone=mylimit:<span class="number">10</span>m rate=<span class="number">100</span>r/s;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	location /platform/file/ {</span><br><span class="line">		proxy_connect_timeout   <span class="number">300</span>;</span><br><span class="line">		proxy_send_timeout      <span class="number">600</span>;</span><br><span class="line">		proxy_read_timeout      <span class="number">600</span>;</span><br><span class="line">		proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">		proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		proxy_set_header X-Forwarded-Scheme  $scheme;</span><br><span class="line">		proxy_set_header X-Forwarded-Server $host;</span><br><span class="line">		proxy_pass http:<span class="comment">//fapi-test/viewOnline/;</span></span><br><span class="line">		# è®¾ç½®ipé™æµ</span><br><span class="line">		<span class="meta"># burstï¼šè¡¨ç¤ºæ’é˜Ÿçš„å¤§å°(ç¼“å­˜çš„å¤§å°)</span></span><br><span class="line">		<span class="meta"># nodelayï¼šè¡¨ç¤ºä¸é™åˆ¶å•ä¸ªè¯·æ±‚é—´çš„æ—¶é—´</span></span><br><span class="line">		limit_req zone=mylimit burst=<span class="number">20</span> nodelay;</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="8-æ—¥å¿—åˆ†æå‘½ä»¤"><a href="#8-æ—¥å¿—åˆ†æå‘½ä»¤" class="headerlink" title="8. æ—¥å¿—åˆ†æå‘½ä»¤"></a>8. æ—¥å¿—åˆ†æå‘½ä»¤</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ç»Ÿè®¡IPè®¿é—®é‡</span></span><br><span class="line">awk <span class="string">'{print $1}'</span> access.log | sort -n | uniq | wc -l</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸€æ—¶é—´æ®µçš„IPè®¿é—®é‡(4-5ç‚¹)</span></span><br><span class="line">grep <span class="string">"07/Apr/2017:0[4-5]"</span> access.log | awk <span class="string">'{print $1}'</span> | sort | uniq -c| sort -nr | wc -l   </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®¿é—®æœ€é¢‘ç¹çš„å‰100ä¸ªIP</span></span><br><span class="line">awk <span class="string">'{print $1}'</span> access.log | sort -n |uniq -c | sort -rn | head -n 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®¿é—®100æ¬¡ä»¥ä¸Šçš„IP</span></span><br><span class="line">awk <span class="string">'{print $1}'</span> access.log | sort -n |uniq -c |awk <span class="string">'{if($1 &gt;100) print $0}'</span>|sort -rn</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŸä¸ªIPçš„è¯¦ç»†è®¿é—®æƒ…å†µ,æŒ‰è®¿é—®é¢‘ç‡æ’åº</span></span><br><span class="line">grep <span class="string">'104.217.108.66'</span> access.log |awk <span class="string">'{print $7}'</span>|sort |uniq -c |sort -rn |head -n 100   </span><br><span class="line"> </span><br><span class="line"><span class="comment"># é¡µé¢è®¿é—®ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®¿é—®æœ€é¢‘çš„é¡µé¢(TOP100)</span></span><br><span class="line">awk <span class="string">'{print $7}'</span> access.log | sort |uniq -c | sort -rn | head -n 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®¿é—®æœ€é¢‘çš„é¡µé¢([æ’é™¤phpé¡µé¢ã€‘(TOP100)</span></span><br><span class="line">grep -v <span class="string">".php"</span>  access.log | awk <span class="string">'{print $7}'</span> | sort |uniq -c | sort -rn | head -n 100          </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹é¡µé¢è®¿é—®æ¬¡æ•°è¶…è¿‡100æ¬¡çš„é¡µé¢</span></span><br><span class="line">cat access.log | cut -d <span class="string">' '</span> -f 7 | sort |uniq -c | awk <span class="string">'{if ($1 &gt; 100) print $0}'</span> | less</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœ€è¿‘1000æ¡è®°å½•ï¼Œè®¿é—®é‡æœ€é«˜çš„é¡µé¢</span></span><br><span class="line">tail -1000 access.log |awk <span class="string">'{print $7}'</span>|sort|uniq -c|sort -nr|less</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ¯ç§’è¯·æ±‚é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ¯ç§’çš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°ç§’)</span></span><br><span class="line">awk <span class="string">'{print $4}'</span> access.log |cut -c 14-21|sort|uniq -c|sort -nr|head -n 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ¯åˆ†é’Ÿè¯·æ±‚é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ¯åˆ†é’Ÿçš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°åˆ†é’Ÿ)</span></span><br><span class="line">awk <span class="string">'{print $4}'</span> access.log |cut -c 14-18|sort|uniq -c|sort -nr|head -n 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ¯å°æ—¶è¯·æ±‚é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ¯å°æ—¶çš„è¯·æ±‚æ•°,top100çš„æ—¶é—´ç‚¹(ç²¾ç¡®åˆ°å°æ—¶)</span></span><br><span class="line">awk <span class="string">'{print $4}'</span> access.log |cut -c 14-15|sort|uniq -c|sort -nr|head -n 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ€§èƒ½åˆ†æ</span></span><br><span class="line"><span class="comment"># åœ¨nginx logä¸­æœ€åä¸€ä¸ªå­—æ®µåŠ å…¥$request_time</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># åˆ—å‡ºä¼ è¾“æ—¶é—´è¶…è¿‡ 3 ç§’çš„é¡µé¢ï¼Œæ˜¾ç¤ºå‰20æ¡</span></span><br><span class="line"> </span><br><span class="line">cat access.log|awk <span class="string">'($NF &gt; 3){print $7}'</span>|sort -n|uniq -c|sort -nr|head -20</span><br><span class="line"><span class="comment"># åˆ—å‡ºphpé¡µé¢è¯·æ±‚æ—¶é—´è¶…è¿‡3ç§’çš„é¡µé¢ï¼Œå¹¶ç»Ÿè®¡å…¶å‡ºç°çš„æ¬¡æ•°ï¼Œæ˜¾ç¤ºå‰100æ¡</span></span><br><span class="line"> </span><br><span class="line">cat access.log|awk <span class="string">'($NF &gt; 1 &amp;&amp;  $7~/\.php/){print $7}'</span>|sort -n|uniq -c|sort -nr|head -100</span><br><span class="line"><span class="comment"># èœ˜è››æŠ“å–ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡èœ˜è››æŠ“å–æ¬¡æ•°</span></span><br><span class="line"> </span><br><span class="line">grep <span class="string">'Baiduspider'</span> access.log |wc -l</span><br><span class="line"><span class="comment"># ç»Ÿè®¡èœ˜è››æŠ“å–404çš„æ¬¡æ•°</span></span><br><span class="line"> </span><br><span class="line">grep <span class="string">'Baiduspider'</span> access.log |grep <span class="string">'404'</span> | wc -l</span><br><span class="line"> </span><br><span class="line"><span class="comment"># TCPè¿æ¥ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰TCPè¿æ¥æ•°</span></span><br><span class="line">netstat -tan | grep <span class="string">"ESTABLISHED"</span> | grep <span class="string">":80"</span> | wc -l</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ç”¨tcpdumpå—…æ¢80ç«¯å£çš„è®¿é—®çœ‹çœ‹è°æœ€é«˜</span></span><br><span class="line">tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F<span class="string">"."</span> <span class="string">'{print $1"."$2"."$3"."$4}'</span> | sort | uniq -c | sort -nr</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Threadå¹¶å‘ç¼–ç¨‹"><a href="#Threadå¹¶å‘ç¼–ç¨‹" class="headerlink" title="Threadå¹¶å‘ç¼–ç¨‹"></a>Threadå¹¶å‘ç¼–ç¨‹</h2><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. åŸºæœ¬æ¦‚å¿µ</h3><blockquote>
<p><strong>å¹¶è¡Œï¼š</strong>(concurrent)æ˜¯åŒä¸€æ—¶é—´åº”å¯¹å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</p>
<p><strong>å¹¶å‘ï¼š</strong>(parallel)æ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</p>
<p><strong>ä¸´ç•ŒåŒº</strong>ï¼šå¯¹å…±äº«èµ„æºåŒæ—¶å­˜åœ¨è¯»å†™æ“ä½œçš„ä»£ç ç‰‡æ®µ</p>
<p><strong>volatileï¼ˆæ˜“å˜å…³é”®å­—ï¼‰ï¼š</strong>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜(ä¸€èˆ¬æ¥è¯´ï¼Œå¤šçº¿ç¨‹ä¸­å…±äº«çš„å¸ƒå°”å€¼æ ‡å¿—ä½éƒ½åº”è¯¥ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°)</p>
</blockquote>
<p>windowä¸‹æŸ¥çœ‹è¿›ç¨‹å‘½ä»¤</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>tasklist \</td>
<td>findstr â€œPIDâ€</td>
<td>æ ¹æ®PIDæŸ¥è¯¢ä»»åŠ¡è¿›ç¨‹</td>
</tr>
<tr>
<td>taskkill -pid PID -f</td>
<td>å¼ºåˆ¶æ€æ­»PIDè¿›ç¨‹</td>
</tr>
<tr>
<td>netstat -ano \</td>
<td>findstr  â€œç«¯å£å·â€</td>
<td>æ ¹æ®ç«¯å£å·æŸ¥è¯¢ä»»åŠ¡PID</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-çº¿ç¨‹åŸºç¡€"><a href="#2-çº¿ç¨‹åŸºç¡€" class="headerlink" title="2. çº¿ç¨‹åŸºç¡€"></a>2. çº¿ç¨‹åŸºç¡€</h3><h4 id="2-1-lambdaç²¾ç®€ä»£ç "><a href="#2-1-lambdaç²¾ç®€ä»£ç " class="headerlink" title="2.1 lambdaç²¾ç®€ä»£ç "></a>2.1 lambdaç²¾ç®€ä»£ç </h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadBase</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// lambdaæ–¹å¼åˆ›å»ºçº¿ç¨‹(åŸºäºRunnableæ¥å£çš„çº¿ç¨‹å®ç°)</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        },<span class="string">"çº¿ç¨‹å£¹å·"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Callableæ¥å£åˆ›å»ºçº¿ç¨‹(lambdaçš„æ–¹å¼)ï¼Œå¸¦æœ‰è¿”å›å€¼çš„çº¿ç¨‹</span></span><br><span class="line">        FutureTask&lt;String&gt; task = <span class="keyword">new</span> FutureTask&lt;&gt;(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"===&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> Thread.currentThread().getName();</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(task, <span class="string">"çº¿ç¨‹è´°å·"</span>).start();</span><br><span class="line">        <span class="comment">// å½“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹å,è¾“å‡ºè¿”å›ç»“æœ</span></span><br><span class="line">        System.out.println(<span class="string">"è¿”å›ç»“æœ:"</span> + task.get());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-2-çº¿ç¨‹è®¾è®¡æ¨¡å¼"><a href="#2-2-çº¿ç¨‹è®¾è®¡æ¨¡å¼" class="headerlink" title="2.2 çº¿ç¨‹è®¾è®¡æ¨¡å¼"></a>2.2 çº¿ç¨‹è®¾è®¡æ¨¡å¼</h4><blockquote>
<p>Thread.sleep(2000)</p>
<ul>
<li>è°ƒç”¨sleepä¼šè®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰è¿›å…¥é˜»å¡çŠ¶æ€ï¼ˆTimed Waitingï¼‰</li>
<li>å…¶ä»–çº¿ç¨‹å¯ä»¥ä½¿ç”¨interruptæ–¹æ³•æ‰“æ–­å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œè¿™æ—¶sleepä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸<ul>
<li>æ‰“æ–­æ­£åœ¨sleepçš„çº¿ç¨‹ï¼šä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€Thread.currentThread().isInterrupted()==false</li>
<li>æ‰“æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼šä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€Thread.currentThread().isInterrupted()==true</li>
</ul>
</li>
<li>ç¡çœ ç»“æŸåçš„çº¿ç¨‹ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œä»ç„¶å›åˆ°å°±ç»ªçŠ¶æ€æ’é˜Ÿï¼Œç­‰å¾…CPUè¿›è¡Œè°ƒåº¦</li>
<li>ä¼˜é›…å†™æ³•ï¼šTimeUnit.SECONDS.sleep(2L);</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadBase</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2L</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"æ‰§è¡Œäº†..."</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                System.out.println(<span class="string">"æ•è·å¼‚å¸¸ç±»å==&gt;"</span> + e.getClass().getName());</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹å£¹å·"</span>);</span><br><span class="line">        System.out.println(<span class="string">"startä¹‹å‰çº¿ç¨‹çŠ¶æ€:"</span> + thread.getState());</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(<span class="string">"startä¹‹åçº¿ç¨‹çŠ¶æ€:"</span> + thread.getState());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ç¡çœ 1ç§’: è¿™æ—¶,threadçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">"startä¹‹åçº¿ç¨‹çŠ¶æ€==&gt;"</span> + thread.getState());</span><br><span class="line">        <span class="comment">// æ‰“æ–­threadçº¿ç¨‹: è¿™æ—¶ä¼šæ‰“æ–­å½“å‰çº¿ç¨‹çš„ç¡çœ ,ç„¶åæŠ›å‡ºè¢«æ‰“æ–­çš„å¼‚å¸¸</span></span><br><span class="line">        thread.interrupt();</span><br><span class="line">        System.out.println(<span class="string">"ç¡çœ çº¿ç¨‹æ‰“æ–­æ ‡è®°==&gt;"</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">startä¹‹å‰çº¿ç¨‹çŠ¶æ€:NEW</span><br><span class="line">startä¹‹åçº¿ç¨‹çŠ¶æ€:RUNNABLE</span><br><span class="line">startä¹‹åçº¿ç¨‹çŠ¶æ€==&gt;TIMED_WAITING</span><br><span class="line">æ•è·å¼‚å¸¸ç±»å==&gt;java.lang.InterruptedException</span><br><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line">	at java.base/java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at java.base/java.lang.Thread.sleep(Thread.java:340)</span><br><span class="line">	at java.base/java.util.concurrent.TimeUnit.sleep(TimeUnit.java:446)</span><br><span class="line">	at thread.ThreadBase.lambda$main$0(ThreadBase.java:16)</span><br><span class="line">	at java.base/java.lang.Thread.run(Thread.java:835)</span><br><span class="line">ç¡çœ çº¿ç¨‹æ‰“æ–­æ ‡è®°==&gt;false</span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-2-1-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"><a href="#2-2-1-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼" class="headerlink" title="2.2.1 ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"></a>2.2.1 ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</h5><blockquote>
<p>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šåˆ©ç”¨æ‰“æ–­æ ‡è®°å¸ƒå°”å€¼è¿›è¡Œåˆ¤æ–­ï¼Œä¼˜é›…çš„ç»“æŸçº¿ç¨‹,ä¹Ÿè¢«æˆä¸ºâ€œä¿¡å·ç¯æ³•â€</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadBase</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        twoStageTermination termination = <span class="keyword">new</span> twoStageTermination();</span><br><span class="line">        termination.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mainçº¿ç¨‹ç¡çœ 3.5ç§’(åˆšå¥½åœ¨threadçº¿ç¨‹å¤„äºsleepçš„æ—¶å€™è¿›è¡Œæ‰“æ–­)</span></span><br><span class="line">        Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">	    <span class="comment">// æ‰“æ–­threadçº¿ç¨‹</span></span><br><span class="line">        termination.stop();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼: åˆ©ç”¨æ‰“æ–­æ ‡è®°ä¼˜é›…çš„ç»“æŸçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">twoStageTermination</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºå…·ä½“çº¿ç¨‹</span></span><br><span class="line">        thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="comment">// å¦‚æœæ‰“æ–­æ ‡è®°ä¸ºtrue,åˆ™æ–™ç†åäº‹,ç»“æŸçº¿ç¨‹(ç»“æŸå¾ªç¯,çº¿ç¨‹è‡ªåŠ¨ç»“æŸ)</span></span><br><span class="line">                <span class="keyword">if</span> (thread.isInterrupted()) {</span><br><span class="line">                    System.out.println(<span class="string">"æ–™ç†åäº‹,å‡†å¤‡ç»“æŸçº¿ç¨‹..."</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// å¦åˆ™æ‰§è¡Œä¸€äº›é€»è¾‘æ“ä½œ</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">// åœ¨sleepæ—¶æœŸå†…è¢«æ‰“æ–­,ä¼šæŠ¥å‡ºå¼‚å¸¸InterruptedException,å¹¶æ¸…é™¤æ‰“æ–­æ ‡è®°(false),æ‰€ä»¥åœ¨catchä¸­è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°</span></span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">                    <span class="comment">// åœ¨æ‰§è¡Œé€»è¾‘çš„æ—¶å€™è¢«æ‰“æ–­,å±äºæ­£å¸¸æ‰“æ–­,ä¸ä¼šå‡ºç°å¼‚å¸¸ä¸ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°(true)</span></span><br><span class="line">                    System.out.println(<span class="string">"æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ..."</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    System.out.println(<span class="string">"sleepæ—¶æœŸè¢«æ‰“æ–­..."</span>);</span><br><span class="line">                    <span class="comment">// é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°</span></span><br><span class="line">                    thread.interrupt();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        },<span class="string">"ä¸šåŠ¡é€»è¾‘çº¿ç¨‹"</span>);</span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        thread.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“æ–­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>volatileä¼˜åŒ–ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Termination termination = <span class="keyword">new</span> Termination();</span><br><span class="line">        termination.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        System.out.println(<span class="string">"åœæ­¢ç›‘æ§"</span>);</span><br><span class="line">        <span class="comment">// æ‰“æ–­threadçº¿ç¨‹</span></span><br><span class="line">        termination.stop();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼: åˆ©ç”¨æ‰“æ–­æ ‡è®°ä¼˜é›…çš„ç»“æŸçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Termination</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦åœæ­¢çš„æ ‡è¯†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºå…·ä½“çº¿ç¨‹</span></span><br><span class="line">        thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="comment">// å¦‚æœæ‰“æ–­æ ‡è®°ä¸ºtrue,åˆ™æ–™ç†åäº‹,ç»“æŸçº¿ç¨‹(ç»“æŸå¾ªç¯,çº¿ç¨‹è‡ªåŠ¨ç»“æŸ)</span></span><br><span class="line">                <span class="keyword">if</span> (flag) {</span><br><span class="line">                    System.out.println(<span class="string">"æ–™ç†åäº‹,å‡†å¤‡ç»“æŸçº¿ç¨‹..."</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    System.out.println(<span class="string">"æ‰§è¡Œä¸šåŠ¡é€»è¾‘..."</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    System.out.println(<span class="string">"sleepæ—¶æœŸæ‰“æ–­..."</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"ä¸šåŠ¡é€»è¾‘çº¿ç¨‹"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“æ–­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ...</span><br><span class="line">æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ...</span><br><span class="line">æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ...</span><br><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line">	at java.base/java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at java.base/java.lang.Thread.sleep(Thread.java:340)</span><br><span class="line">	at java.base/java.util.concurrent.TimeUnit.sleep(TimeUnit.java:446)</span><br><span class="line">	at thread.twoStageTermination.lambda$start$0(ThreadBase.java:48)</span><br><span class="line">	at java.base/java.lang.Thread.run(Thread.java:835)</span><br><span class="line">sleepæ—¶æœŸè¢«æ‰“æ–­...</span><br><span class="line">æ–™ç†åäº‹,å‡†å¤‡ç»“æŸçº¿ç¨‹...</span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-2-2-çŠ¹è±«æ¨¡å¼"><a href="#2-2-2-çŠ¹è±«æ¨¡å¼" class="headerlink" title="2.2.2 çŠ¹è±«æ¨¡å¼"></a>2.2.2 çŠ¹è±«æ¨¡å¼</h5><blockquote>
<p>BalkingçŠ¹è±«æ¨¡å¼ï¼šåº”ç”¨åœºæ™¯ï¼šé˜²æ­¢é‡å¤å¯åŠ¨åŒä¸€ä¸ªçº¿ç¨‹</p>
<p>å«ä¹‰ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å·²ç»åšäº†æŸä¸€ä»¶ç°åŒçš„äº‹æƒ…çš„æ—¶å€™ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åšäº†ï¼Œç›´æ¥ç»“æŸ(return;)è¿”å›å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        </span><br><span class="line">        Termination termination = <span class="keyword">new</span> Termination();</span><br><span class="line">        <span class="comment">// å¯åŠ¨å¤šä¸ªçº¿ç¨‹æµ‹è¯•(æ˜¯å¦ä¼šé‡å¤å¯åŠ¨æ°”å­”çº¿ç¨‹)</span></span><br><span class="line">        termination.start();</span><br><span class="line">        termination.start();</span><br><span class="line">        termination.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        System.out.println(<span class="string">"åœæ­¢ç›‘æ§"</span>);</span><br><span class="line">        <span class="comment">// æ‰“æ–­threadçº¿ç¨‹</span></span><br><span class="line">        termination.stop();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼: åˆ©ç”¨æ‰“æ–­æ ‡è®°ä¼˜é›…çš„ç»“æŸçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Termination</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line">    <span class="comment">// é˜²æ­¢å¯åŠ¨å¤šä¸ªçº¿ç¨‹(çŠ¹è±«æ¨¡å¼)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> starting = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// åˆ›å»ºå…·ä½“çº¿ç¨‹</span></span><br><span class="line">        thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="comment">// è¦åŠ é”ï¼šä¿è¯startingæ ‡è¯†çš„åŸå­æ€§</span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">                <span class="keyword">if</span> (starting) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹å·²ç»å¯åŠ¨å®Œæˆäº†,è¯·ç«‹å³é€€å›..."</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                starting = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="comment">// å¦‚æœæ‰“æ–­æ ‡è®°ä¸ºtrue,åˆ™æ–™ç†åäº‹,ç»“æŸçº¿ç¨‹(ç»“æŸå¾ªç¯,çº¿ç¨‹è‡ªåŠ¨ç»“æŸ)</span></span><br><span class="line">                <span class="keyword">if</span> (flag) {</span><br><span class="line">                    System.out.println(<span class="string">"æ–™ç†åäº‹,å‡†å¤‡ç»“æŸçº¿ç¨‹..."</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    System.out.println(<span class="string">"æ‰§è¡Œä¸šåŠ¡é€»è¾‘..."</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    System.out.println(<span class="string">"sleepæ—¶æœŸæ‰“æ–­..."</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"ä¸šåŠ¡é€»è¾‘çº¿ç¨‹"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“æ–­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-2-3-åŒæ­¥æ¨¡å¼"><a href="#2-2-3-åŒæ­¥æ¨¡å¼" class="headerlink" title="2.2.3 åŒæ­¥æ¨¡å¼"></a>2.2.3 åŒæ­¥æ¨¡å¼</h5><h6 id="2-2-3-1-é¡ºåºæ‰§è¡Œ"><a href="#2-2-3-1-é¡ºåºæ‰§è¡Œ" class="headerlink" title="2.2.3.1 é¡ºåºæ‰§è¡Œ"></a>2.2.3.1 é¡ºåºæ‰§è¡Œ</h6><blockquote>
<p>é¡ºåºæ‰§è¡Œ==ã€‹waitÂ¬ify: ä¿è¯çº¿ç¨‹2å§‹ç»ˆåœ¨çº¿ç¨‹1ä¹‹å‰è¿è¡Œ<span class="github-emoji"><span>ğŸ˜›</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f61b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…±äº«é”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è´°å·æ˜¯å¦è¿è¡Œè¿‡æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> isRun = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">                <span class="keyword">while</span> (!isRun) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;è¿›å…¥ç­‰å¾…"</span>);</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1å·"</span>);</span><br><span class="line"></span><br><span class="line">        Thread threadTwo = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">                isRun = <span class="keyword">true</span>;</span><br><span class="line">                LOCK.notify();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹2å·"</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        threadOne.start();</span><br><span class="line">        <span class="comment">// æ•…æ„ç­‰å¾…1ç§’ï¼ˆä¸‹è¿‡æ›´æ˜æ˜¾ï¼‰</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        threadTwo.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>é¡ºåºæ‰§è¡Œ==ã€‹await&amp;signalï¼šä¿è¯çº¿ç¨‹2å§‹ç»ˆåœ¨çº¿ç¨‹1ä¹‹å‰è¿è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line">    <span class="comment">// å…±äº«é”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">static</span> ReentrantLock LOCK = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="comment">// æ¡ä»¶å˜é‡</span></span><br><span class="line">    <span class="keyword">static</span> Condition condition = LOCK.newCondition();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è´°å·æ˜¯å¦è¿è¡Œè¿‡æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> isRun = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            LOCK.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">while</span> (!isRun) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;è¿›å…¥ç­‰å¾…"</span>);</span><br><span class="line">                        condition.await();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                LOCK.unlock();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1å·"</span>);</span><br><span class="line"></span><br><span class="line">        Thread threadTwo = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            LOCK.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">                isRun = <span class="keyword">true</span>;</span><br><span class="line">                condition.signal();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                LOCK.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹2å·"</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        threadOne.start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        threadTwo.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>é¡ºåºæ‰§è¡Œ==ã€‹park&amp;unpark: ä¿è¯çº¿ç¨‹2å§‹ç»ˆåœ¨çº¿ç¨‹1ä¹‹å‰è¿è¡Œï¼ˆæ›´åŠ ç®€å•ï¼‰</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="comment">// è®©threadOneè¿›å…¥ç­‰å¾…</span></span><br><span class="line">            LockSupport.park();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1å·"</span>);</span><br><span class="line"></span><br><span class="line">        Thread threadTwo = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹è¿è¡Œ"</span>);</span><br><span class="line">            <span class="comment">// å”¤é†’threadOneçº¿ç¨‹</span></span><br><span class="line">            LockSupport.unpark(threadOne);</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹2å·"</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        threadOne.start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        threadTwo.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šè¿°è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">çº¿ç¨‹2å·==&gt;å¼€å§‹è¿è¡Œ</span><br><span class="line">çº¿ç¨‹1å·==&gt;å¼€å§‹è¿è¡Œ</span><br></pre></td></tr></tbody></table></figure>
<h6 id="2-2-3-2-äº¤æ›¿æ‰§è¡Œ"><a href="#2-2-3-2-äº¤æ›¿æ‰§è¡Œ" class="headerlink" title="2.2.3.2 äº¤æ›¿æ‰§è¡Œ"></a>2.2.3.2 äº¤æ›¿æ‰§è¡Œ</h6><blockquote>
<p>wait&amp;natifyAll: äº¤æ›¿æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * è¦æ±‚: 3ä¸ªçº¿ç¨‹å„è‡ªå¾ªç¯5æ¬¡,æ‰“å°å†…å®¹ä¸º: abc abc abc abc abc äº¤æ›¿è¾“å‡º</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line"></span><br><span class="line">        WaitNotify wn = <span class="keyword">new</span> WaitNotify(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"a"</span>, <span class="number">1</span>, <span class="number">2</span>), <span class="string">"Thread1"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"b"</span>, <span class="number">2</span>, <span class="number">3</span>), <span class="string">"Thread2"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"c"</span>, <span class="number">3</span>, <span class="number">1</span>), <span class="string">"Thread3"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­‰å¾…å”¤é†’é€»è¾‘ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaitNotify</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹æ ‡è®°ï¼šé»˜è®¤ä¸º 1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag;</span><br><span class="line">    <span class="comment">// å¾ªç¯æ¬¡æ•°ï¼š é»˜è®¤ä¸º 5</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loopNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaitNotify</span><span class="params">(<span class="keyword">int</span> flag, <span class="keyword">int</span> loopNumber)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">        <span class="keyword">this</span>.loopNumber = loopNumber;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°é€»è¾‘: å½“flag==waitFlagæ—¶,æ‰“å°å½“å‰çº¿ç¨‹å†…å®¹str,å¹¶ä¸”æ›´æ–°flagä¸ºnextFlag,å”¤é†’æ‰€æœ‰çº¿ç¨‹,å¦åˆ™è¿›è¡Œç­‰å¾…,ç›´åˆ°è¢«å”¤é†’è€Œä¸”flagç¬¦åˆæ¡ä»¶,æ‰“å°å†…å®¹</span></span><br><span class="line"><span class="comment">     *  é€»è¾‘: str -- waitFlag -- nextFlag</span></span><br><span class="line"><span class="comment">     *      a -- 1 -- 2</span></span><br><span class="line"><span class="comment">     *      b -- 2 -- 3</span></span><br><span class="line"><span class="comment">     *      c -- 3 -- 1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str æ‰“å°å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> waitFlag ç­‰å¾…æ ‡è®°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextFlag ä¸‹ä¸€ä¸ªæ‰“å°æ ‡è®°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str, <span class="keyword">int</span> waitFlag, <span class="keyword">int</span> nextFlag)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loopNumber; i++) {</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">                <span class="keyword">while</span> (flag != waitFlag) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        <span class="keyword">this</span>.wait();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// æ ‡è®°å¯¹åº”æˆåŠŸ</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + str);</span><br><span class="line">                <span class="comment">// æ›´æ–°æ ‡è®°</span></span><br><span class="line">                flag = nextFlag;</span><br><span class="line">                <span class="comment">// å”¤é†’æ‰€æœ‰çº¿ç¨‹(è‡ªç”±waitFlagç¬¦åˆæ¡ä»¶çš„æ‰èƒ½è¿›è¡Œä¸‹æ¬¡æ‰“å°ï¼Œå…¶ä»–çš„è¿˜æ˜¯è¿›å…¥ç­‰å¾…)</span></span><br><span class="line">                <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>await&amp;signalï¼šäº¤æ›¿æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * è¦æ±‚: 3ä¸ªçº¿ç¨‹å„è‡ªå¾ªç¯5æ¬¡,æ‰“å°å†…å®¹ä¸º: abc abc abc abc abc äº¤æ›¿è¾“å‡º</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line"></span><br><span class="line">        WaitNotify wn = <span class="keyword">new</span> WaitNotify(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»º3ä¸ªä¼‘æ¯å®¤</span></span><br><span class="line">        Condition one = wn.newCondition();</span><br><span class="line">        Condition two = wn.newCondition();</span><br><span class="line">        Condition three = wn.newCondition();</span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"a"</span>, one, two), <span class="string">"Thread1"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"b"</span>, two, three), <span class="string">"thread2"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"c"</span>, three, one), <span class="string">"thread3"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹: åˆå§‹åŒ–å”¤é†’oneä¼‘æ¯å®¤ä¸­çš„çº¿ç¨‹ThreadOne</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        wn.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            one.signal();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            wn.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­‰å¾…å”¤é†’é€»è¾‘ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaitNotify</span> <span class="keyword">extends</span> <span class="title">ReentrantLock</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾ªç¯æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loopNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaitNotify</span><span class="params">(<span class="keyword">int</span> loopNumber)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.loopNumber = loopNumber;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°é€»è¾‘: å…ˆè®©æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¿›å…¥å„è‡ªçš„ä¼‘æ¯å®¤ç­‰å¾…,ç„¶åä¸»çº¿ç¨‹åˆå§‹åŒ–å”¤é†’oneä¼‘æ¯å®¤å†…çš„çº¿ç¨‹,ç„¶åè¿›è¡Œæ‰“å°,ç„¶åå”¤é†’ä¸‹ä¸€ä¸ªtwoä¼‘æ¯å®¤å†…çš„çº¿ç¨‹,ç»§ç»­å¤§è¿,å¾€å¤å¾ªç¯...</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str æ‰“å°å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentCondition å½“å‰æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextCondition ä¸‹ä¸€ä¸ªæ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str, Condition currentCondition, Condition nextCondition)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loopNumber; i++) {</span><br><span class="line">            <span class="keyword">this</span>.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    currentCondition.await();  <span class="comment">// å½“æ­¤ä¼‘æ¯å®¤å†…çš„çº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œawaitä¸‹é¢çš„è¯­å¥</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + str);</span><br><span class="line">                    nextCondition.signal();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                <span class="keyword">this</span>.unlock();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>park&amp;unparkï¼šäº¤æ›¿æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Thread threadOne;</span><br><span class="line">    <span class="keyword">static</span> Thread threadTwo;</span><br><span class="line">    <span class="keyword">static</span> Thread threadThree;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * è¦æ±‚: 3ä¸ªçº¿ç¨‹å„è‡ªå¾ªç¯5æ¬¡,æ‰“å°å†…å®¹ä¸º: abc abc abc abc abc äº¤æ›¿è¾“å‡º</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line"></span><br><span class="line">        WaitNotify wn = <span class="keyword">new</span> WaitNotify(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ä¸‰ä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadOne = <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"a"</span>, threadTwo), <span class="string">"Thread1"</span>);</span><br><span class="line">        threadTwo = <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"b"</span>, threadThree), <span class="string">"Thread2"</span>);</span><br><span class="line">        threadThree = <span class="keyword">new</span> Thread(() -&gt; wn.print(<span class="string">"c"</span>, threadOne), <span class="string">"Thread3"</span>);</span><br><span class="line">        threadOne.start();</span><br><span class="line">        threadTwo.start();</span><br><span class="line">        threadThree.start();</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹é»˜è®¤å”¤é†’threadOneçº¿ç¨‹</span></span><br><span class="line">        LockSupport.unpark(threadOne);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­‰å¾…å”¤é†’é€»è¾‘ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaitNotify</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾ªç¯æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loopNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaitNotify</span><span class="params">(<span class="keyword">int</span> loopNumber)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.loopNumber = loopNumber;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°é€»è¾‘: è°ƒç”¨park()æ–¹æ³•çš„è°ƒç”¨è€…é»˜è®¤æ¯æ¬¡å°±æ˜¯å½“å‰çº¿ç¨‹,æ¯ä¸ªçº¿ç¨‹éƒ½å…ˆç­‰å¾…ç€,ç„¶åè¢«å”¤é†’å,å°±æ¥ç€å»å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹nextThread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextThread ä¸‹ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str, Thread nextThread)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loopNumber; i++) {</span><br><span class="line">            LockSupport.park();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + str);</span><br><span class="line">            LockSupport.unpark(nextThread);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šè¿°è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">Thread1==&gt;a</span><br><span class="line">Thread2==&gt;b</span><br><span class="line">Thread3==&gt;c</span><br><span class="line">Thread1==&gt;a</span><br><span class="line">Thread2==&gt;b</span><br><span class="line">Thread3==&gt;c</span><br><span class="line">Thread1==&gt;a</span><br><span class="line">Thread2==&gt;b</span><br><span class="line">Thread3==&gt;c</span><br><span class="line">Thread1==&gt;a</span><br><span class="line">Thread2==&gt;b</span><br><span class="line">Thread3==&gt;c</span><br><span class="line">Thread1==&gt;a</span><br><span class="line">Thread2==&gt;b</span><br><span class="line">Thread3==&gt;c</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-3-locké”ï¼ˆé˜²æ­»é”ï¼‰"><a href="#2-3-locké”ï¼ˆé˜²æ­»é”ï¼‰" class="headerlink" title="2.3 locké”ï¼ˆé˜²æ­»é”ï¼‰"></a>2.3 locké”ï¼ˆé˜²æ­»é”ï¼‰</h4><h5 id="2-3-1-å¯æ‰“æ–­"><a href="#2-3-1-å¯æ‰“æ–­" class="headerlink" title="2.3.1 å¯æ‰“æ–­"></a>2.3.1 å¯æ‰“æ–­</h5><blockquote>
<p>å¯æ‰“æ–­ï¼šå½“æ­¤çº¿ç¨‹è·å–ä¸åˆ°é”ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥è°ƒç”¨interruptæ–¹æ³•æ‰“æ–­æ­¤çº¿ç¨‹ã€‚ ä½¿å…¶ä¸ä¼šä¸€ç›´å¤„åœ¨é˜»å¡çŠ¶æ€,æ— é™åˆ¶çš„ç­‰å¾…ä¸‹å»</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReentrantLock reentrantLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"å°è¯•è·å–é”..."</span>);</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * reentrantLock.lockInterruptibly():å¯æ‰“æ–­çš„locké”</span></span><br><span class="line"><span class="comment">                 *       1. å¦‚æœè·å–é”çš„è¿‡ç¨‹ä¸­,æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„ç«äº‰,æ­¤çº¿ç¨‹ä¼šè·å–åˆ°é”å¯¹è±¡</span></span><br><span class="line"><span class="comment">                 *       2. å¦‚æœæœ‰ç«äº‰å°±è¿›å…¥é˜»å¡é˜Ÿåˆ—,å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹è°ƒç”¨interruptæ–¹æ³•æ‰“æ–­,å¹¶æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">                 * æ³¨æ„: å¦‚æœæ˜¯ä¸å¯ä¸­æ–­æ¨¡å¼ï¼Œé‚£ä¹ˆå³ä½¿ä½¿ç”¨äº† interrupt ä¹Ÿä¸ä¼šè®©ç­‰å¾…ä¸­æ–­</span></span><br><span class="line"><span class="comment">                 * */</span></span><br><span class="line">                reentrantLock.lockInterruptibly();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"è·å–é”è¿‡ç¨‹è¢«æ‰“æ–­..."</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"æˆåŠŸè·å–é”..."</span>);</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                reentrantLock.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹å£¹å·"</span>);</span><br><span class="line"></span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"ä¸»çº¿ç¨‹ç«äº‰é”,å¹¶å…ˆè·å¾—..."</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="comment">// æ‰“æ–­threadçº¿ç¨‹,ä½¿å…¶ä¸ä¼šä¸€ç›´å¤„åœ¨é˜»å¡çŠ¶æ€,æ— é™åˆ¶çš„ç­‰å¾…ä¸‹å»</span></span><br><span class="line">        thread.interrupt();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-3-2-é”è¶…æ—¶"><a href="#2-3-2-é”è¶…æ—¶" class="headerlink" title="2.3.2 é”è¶…æ—¶"></a>2.3.2 é”è¶…æ—¶</h5><blockquote>
<p>é”è¶…æ—¶ï¼šå½“æ­¤çº¿ç¨‹æ— æ³•åŠæ—¶è·å–åˆ°é”çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œfinallyé‡Šæ”¾é”ï¼Œé˜²æ­¢çº¿ç¨‹æ— é™åˆ¶ç­‰å¾…ä¸‹å»ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReentrantLock reentrantLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"å°è¯•è·å–é”..."</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">// å¦‚æœå†è§„å®šæ—¶é—´å†…,mainä¸»çº¿ç¨‹é‡Šæ”¾äº†é”,é‚£ä¹ˆæ­¤çº¿ç¨‹ä»ç„¶å¯ä»¥è·å–åˆ°é”(reentrantLock.tryLock(1,TimeUnit.SECONDS) == true)</span></span><br><span class="line">                <span class="comment">// å¦åˆ™è¿”å›false,æ— æ³•è·å–åˆ°é”(å½“tryLocké‡Œé¢è®¾ç½®çš„å‚æ•°ä¸º1æ—¶)</span></span><br><span class="line">                <span class="comment">// tryLocké‡Œé¢æ— å‚æ•°ï¼šè¡¨ç¤ºè·å–ä¸åˆ°ï¼Œå°±ç«‹å³é‡Šæ”¾</span></span><br><span class="line">                <span class="keyword">if</span> (!reentrantLock.tryLock(<span class="number">3</span>,TimeUnit.SECONDS)) {</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"è·å–é”å¤±è´¥..."</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(<span class="string">"è¢«æ‰“æ–­,è·å–ä¸åˆ°é”"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"æˆåŠŸè·å–é”..."</span>);</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                reentrantLock.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹å£¹å·"</span>);</span><br><span class="line"></span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"ä¸»çº¿ç¨‹ç«äº‰é”,å¹¶å…ˆè·å¾—...,å†å¯åŠ¨threadçº¿ç¨‹"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼šï¼ˆç­‰å¾…3ç§’ï¼‰</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">mainä¸»çº¿ç¨‹ç«äº‰é”,å¹¶å…ˆè·å¾—...,å†å¯åŠ¨threadçº¿ç¨‹</span><br><span class="line">çº¿ç¨‹å£¹å·å°è¯•è·å–é”...</span><br><span class="line">çº¿ç¨‹å£¹å·æˆåŠŸè·å–é”...</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼šï¼ˆç­‰å¾…1ç§’ï¼‰</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">mainä¸»çº¿ç¨‹ç«äº‰é”,å¹¶å…ˆè·å¾—...,å†å¯åŠ¨threadçº¿ç¨‹</span><br><span class="line">çº¿ç¨‹å£¹å·å°è¯•è·å–é”...</span><br><span class="line">çº¿ç¨‹å£¹å·è·å–é”å¤±è´¥...</span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-3-3-æ¡ä»¶å˜é‡"><a href="#2-3-3-æ¡ä»¶å˜é‡" class="headerlink" title="2.3.3 æ¡ä»¶å˜é‡"></a>2.3.3 æ¡ä»¶å˜é‡</h5><blockquote>
<p>Condition: Locké”ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼ˆä¹Ÿå°±æ˜¯ï¼šå¯ä»¥å®šä¹‰å¤šä¸ªä¼‘æ¯å®¤ï¼Œå½“çº¿ç¨‹ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå¯ä»¥åˆ°å„è‡ªä¸“é—¨çš„ä¼‘æ¯å®¤å†…ï¼Œæœ€åï¼Œæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå†åˆ°æŒ‡å®šçš„ä¼‘æ¯å®¤ä¸­å”¤é†’æ­¤çº¿ç¨‹ï¼ŒsynchronizedåŠ é”çš„æƒ…å†µï¼šæ‰€æœ‰ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹åªèƒ½åˆ°åŒä¸€é—´ä¼‘æ¯å®¤å†…ã€‚ï¼‰</p>
<p>ä½¿ç”¨è¦ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨awaitå‰å¿…é¡»å…ˆè·å–locké”</li>
<li>await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾…</li>
<li>await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é”</li>
<li>ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§è¡Œ</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReentrantLock ROOM = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªä¼‘æ¯å®¤</span></span><br><span class="line">    <span class="keyword">static</span> Condition conditionSmoke = ROOM.newCondition();</span><br><span class="line">    <span class="keyword">static</span> Condition conditionBreakfast = ROOM.newCondition();</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªæ ‡è¯†</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> hasSmoke = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> hasBreakfast = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹:æ²¡æœ‰çƒŸåˆ°å¯¹åº”çš„ä¼‘æ¯å®¤ç­‰å¾…,æœ‰çƒŸå¼€å§‹å¹²æ´»çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            ROOM.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">// æ²¡æœ‰çƒŸ:ç­‰å¾…</span></span><br><span class="line">                <span class="keyword">while</span> (!hasSmoke) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        System.out.println(<span class="string">"æ²¡æœ‰çƒŸ==&gt;è¿›å…¥conditionSmokeä¼‘æ¯å®¤å†…ç­‰å¾…"</span>);</span><br><span class="line">                        conditionSmoke.await();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// æœ‰çƒŸ: å¼€å§‹å¹²æ´»</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹å¹²æ´»"</span>);</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                ROOM.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹å£¹å·"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹:åŠŸèƒ½ç›¸åŒ</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            ROOM.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">// æ²¡æ—©é¤: ç­‰å¾…</span></span><br><span class="line">                <span class="keyword">while</span> (!hasBreakfast) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        System.out.println(<span class="string">"æ²¡æœ‰çƒŸ==&gt;è¿›å…¥conditionBreakfastä¼‘æ¯å®¤å†…ç­‰å¾…"</span>);</span><br><span class="line">                        conditionBreakfast.await();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">// æœ‰æ—©é¤: å¼€å§‹å¹²æ´»</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;å¼€å§‹å¹²æ´»"</span>);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                ROOM.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹è´°å·"</span>).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 2ç§’åçƒŸé€åˆ°</span></span><br><span class="line">        SendSmoke();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 1ç§’åæ—©é¤é€åˆ°</span></span><br><span class="line">        SendBreakfast();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SendSmoke</span><span class="params">()</span> </span>{</span><br><span class="line">        ROOM.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            System.out.println(<span class="string">"çƒŸé€åˆ°äº†..."</span>);</span><br><span class="line">            hasSmoke = <span class="keyword">true</span>;</span><br><span class="line">            conditionSmoke.signal();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            ROOM.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SendBreakfast</span><span class="params">()</span> </span>{</span><br><span class="line">        ROOM.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            System.out.println(<span class="string">"æ—©é¤é€åˆ°äº†..."</span>);</span><br><span class="line">            hasBreakfast = <span class="keyword">true</span>;</span><br><span class="line">            conditionBreakfast.signal();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            ROOM.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">æ²¡æœ‰çƒŸ==&gt;è¿›å…¥conditionBreakfastä¼‘æ¯å®¤å†…ç­‰å¾…</span><br><span class="line">æ²¡æœ‰çƒŸ==&gt;è¿›å…¥conditionSmokeä¼‘æ¯å®¤å†…ç­‰å¾…</span><br><span class="line">çƒŸé€åˆ°äº†...</span><br><span class="line">çº¿ç¨‹å£¹å·==&gt;å¼€å§‹å¹²æ´»</span><br><span class="line">æ—©é¤é€åˆ°äº†...</span><br><span class="line">çº¿ç¨‹è´°å·==&gt;å¼€å§‹å¹²æ´»</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-4-CASæ— é”å¹¶å‘"><a href="#2-4-CASæ— é”å¹¶å‘" class="headerlink" title="2.4 CASæ— é”å¹¶å‘"></a>2.4 CASæ— é”å¹¶å‘</h4><blockquote>
<p>CASå’Œvolatileå¯ä»¥å®ç°æ— é”å¹¶å‘ï¼šä½¿ç”¨äºçº¿ç¨‹æ•°å°‘ï¼Œå¤šæ ¸CPUçš„åœºæ™¯ä¸‹</p>
<p>å’Œsynchronizedé”æ¯”è¾ƒï¼š</p>
<ul>
<li>CASåŸºäºä¹è§‚é”æ€æƒ³ï¼šæœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡èµ„æºï¼Œå°±ç®—ä¿®æ”¹äº†ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œè‡ªå·±å†å¾ªç¯é‡è¯•å‘—ï¼Œ</li>
<li>synchronizedé”åŸºäºæ‚²è§‚é”æ€æƒ³ï¼šæœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œæ¯æ—¶æ¯åˆ»éƒ½è¦é˜²ç€å…¶ä»–çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡èµ„æºï¼Œæˆ‘è·å–åˆ°é”ï¼Œæˆ‘å°±è¦æ‰§è¡Œå®Œæ“ä½œåæ‰é‡Šæ”¾é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½ç«äº‰é”ï¼Œæ‰æœ‰æœºä¼šã€‚</li>
<li>CASä½“ç°çš„æ˜¯æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘ã€‚<ul>
<li>å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€</li>
<li>ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li>
</ul>
</li>
</ul>
</blockquote>
<p>ä¸¤ç§æ–¹å¼çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicOperationalThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// åŠ é”æµ‹è¯•</span></span><br><span class="line">        Account.updateMoney(<span class="keyword">new</span> AccountUnsafe(<span class="number">10000</span>));</span><br><span class="line">        <span class="comment">// æ— é”æµ‹è¯•</span></span><br><span class="line">        Account.updateMoney(<span class="keyword">new</span> AccountSafe(<span class="number">10000</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´¦æˆ·æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä½™é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">getBalance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£é’±(æ¯æ¬¡-10å…ƒ)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(Integer money)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * é™æ€æ–¹æ³•ï¼šå¯ç›´æ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨1000ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ10000å…ƒ,ç›´è‡³ä½™é¢ç­‰äº0ä¸ºæ­¢</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateMoney</span><span class="params">(Account account)</span> </span>{</span><br><span class="line">        List&lt;Thread&gt; threadList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// åˆ›å»º1000ä¸ªçº¿ç¨‹:å¼€å§‹æ‰£é’±,ç›´åˆ°ä½™é¢ç­‰äº0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            threadList.add(<span class="keyword">new</span> Thread(() -&gt; account.deductMoney(<span class="number">10</span>)));</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¼€å¯æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        threadList.forEach(Thread::start);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ‰€æœ‰1000ä¸ªçº¿ç¨‹åœ¨mainä¸»çº¿ç¨‹ä¹‹å‰æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">        threadList.forEach(thread -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                thread.join();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"ä½™é¢:"</span> + account.getBalance() + <span class="string">"==&gt;æ‰§è¡Œæ—¶é—´:"</span> + (end - begin) + <span class="string">"ms"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ é”çš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountUnsafe</span> <span class="keyword">implements</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountUnsafe</span><span class="params">(Integer balance)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.balance = balance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä½™é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getBalance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">return</span> balance;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£é’±</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money æ¯æ¬¡æ‰£çš„é’±</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(Integer money)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            balance -= money;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ— é”çš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountSafe</span> <span class="keyword">implements</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œçš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> AtomicInteger balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountSafe</span><span class="params">(Integer balance)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.balance = <span class="keyword">new</span> AtomicInteger(balance);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getBalance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> balance.get(); <span class="comment">// è·å–å½“å‰balanceå€¼</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(Integer money)</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="comment">// è·å–ä½™é¢æœ€æ–°å€¼</span></span><br><span class="line">            <span class="keyword">int</span> prev = balance.get();</span><br><span class="line">            <span class="comment">// è·å–ä¿®æ”¹åçš„ä½™é¢</span></span><br><span class="line">            <span class="keyword">int</span> next = prev - money;</span><br><span class="line">            <span class="comment">// çœŸæ­£è¿›è¡Œä¿®æ”¹çš„åŸå­æ“ä½œ</span></span><br><span class="line">            <span class="comment">// åŸç†: å—é™prevå€¼å…ˆå’Œä¸»å­˜ä¸­çš„balanceçš„å€¼è¿›è¡Œæ¯”è¾ƒ,å¦‚æœç›¸ç­‰å°±è¿”å›true,å°±å°†balanceçš„å€¼ç½®ä¸ºnext,è·³å‡ºå¾ªç¯;</span></span><br><span class="line">            <span class="comment">// å¦åˆ™å°±è¿”å›false,å†æ¬¡è¿›è¡Œæ­¤å¾ªç¯,ç›´åˆ°è·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (balance.compareAndSet(prev, next)) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">ä½™é¢:0==&gt;æ‰§è¡Œæ—¶é—´:63ms</span><br><span class="line">ä½™é¢:0==&gt;æ‰§è¡Œæ—¶é—´:53ms</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-åŸå­å·¥å…·ç±»"><a href="#3-åŸå­å·¥å…·ç±»" class="headerlink" title="3. åŸå­å·¥å…·ç±»"></a>3. åŸå­å·¥å…·ç±»</h3><h4 id="3-1-åŸå­åŸºæœ¬æ•°æ®ç±»å‹"><a href="#3-1-åŸå­åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="3.1 åŸå­åŸºæœ¬æ•°æ®ç±»å‹"></a>3.1 åŸå­åŸºæœ¬æ•°æ®ç±»å‹</h4><blockquote>
<p>AtomicIntegerã€AtomicLongã€AtomicBooleanç­‰åŸºæœ¬æ•°æ®ç±»å‹</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicClassTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        AtomicBoolean atomicBoolean = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span><br><span class="line">        AtomicLong atomicLong = <span class="keyword">new</span> AtomicLong(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‹é¢ä½¿ç”¨åŸå­Integeræ¼”ç¤º(å…¶ä»–çš„åŸç†ç›¸åŒ)</span></span><br><span class="line">        AtomicInteger i = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++</span></span><br><span class="line">        System.out.println(i.getAndIncrement());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i</span></span><br><span class="line">        System.out.println(i.incrementAndGet());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i</span></span><br><span class="line">        System.out.println(i.decrementAndGet());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span></span><br><span class="line">        System.out.println(i.getAndDecrement());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰</span></span><br><span class="line">        System.out.println(i.getAndAdd(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line">        System.out.println(i.addAndGet(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰</span></span><br><span class="line">        <span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">        System.out.println(i.getAndUpdate(p -&gt; p - <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line">        <span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">        System.out.println(i.updateAndGet(p -&gt; p + <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰</span></span><br><span class="line">        <span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">        <span class="comment">// getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„</span></span><br><span class="line">        <span class="comment">// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ final</span></span><br><span class="line">        System.out.println(i.getAndAccumulate(<span class="number">10</span>, (p, x) -&gt; p + x));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line">        <span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">        System.out.println(i.accumulateAndGet(-<span class="number">10</span>, (p, x) -&gt; p + x));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">0</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-2-åŸå­å¼•ç”¨"><a href="#3-2-åŸå­å¼•ç”¨" class="headerlink" title="3.2 åŸå­å¼•ç”¨"></a>3.2 åŸå­å¼•ç”¨</h4><blockquote>
<p>åŸå­å¼•ç”¨ï¼šAtomicReferenceå’ŒAtomicIntegeréå¸¸ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„å°±åœ¨äºAtomicIntegeræ˜¯å¯¹æ•´æ•°çš„å°è£…ï¼Œåº•å±‚é‡‡ç”¨çš„æ˜¯compareAndSwapIntå®ç°CASï¼Œæ¯”è¾ƒçš„æ˜¯æ•°å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€ŒAtomicReferenceåˆ™å¯¹åº”æ™®é€šçš„å¯¹è±¡å¼•ç”¨ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯compareAndSwapObjectå®ç°CASï¼Œæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯å®ƒå¯ä»¥ä¿è¯ä½ åœ¨ä¿®æ”¹å¯¹è±¡å¼•ç”¨æ—¶çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
</blockquote>
<p>å¯¹äºBigDecimalå¤§æ•°çš„åŸå­æ“ä½œç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicOperationalThread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// åŠ é”æµ‹è¯•</span></span><br><span class="line">        Account.updateMoney(<span class="keyword">new</span> AccountUnsafe(<span class="keyword">new</span> BigDecimal(<span class="string">"10000"</span>)));</span><br><span class="line">        <span class="comment">// æ— é”æµ‹è¯•</span></span><br><span class="line">        Account.updateMoney(<span class="keyword">new</span> AccountSafe(<span class="keyword">new</span> BigDecimal(<span class="string">"10000"</span>)));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´¦æˆ·æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä½™é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">BigDecimal <span class="title">getBalance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£é’±(æ¯æ¬¡-10å…ƒ)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(BigDecimal money)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨1000ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ10000å…ƒ,ç›´è‡³ä½™é¢ç­‰äº0ä¸ºæ­¢</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateMoney</span><span class="params">(Account account)</span> </span>{</span><br><span class="line">        List&lt;Thread&gt; threadList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// åˆ›å»º1000ä¸ªçº¿ç¨‹:å¼€å§‹æ‰£é’±,ç›´åˆ°ä½™é¢ç­‰äº0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            threadList.add(<span class="keyword">new</span> Thread(() -&gt; account.deductMoney(<span class="keyword">new</span> BigDecimal(<span class="string">"10"</span>))));</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¼€å¯æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        threadList.forEach(Thread::start);</span><br><span class="line">        <span class="comment">// å°†æ‰€æœ‰çº¿ç¨‹å†mainä¸»çº¿ç¨‹ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">        threadList.forEach(thread -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                thread.join();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"ä½™é¢:"</span> + account.getBalance() + <span class="string">"==&gt;æ‰§è¡Œæ—¶é—´:"</span> + (end - begin) + <span class="string">"ms"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ é”çš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountUnsafe</span> <span class="keyword">implements</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountUnsafe</span><span class="params">(BigDecimal balance)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.balance = balance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä½™é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getBalance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">return</span> balance;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£é’±</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money æ¯æ¬¡æ‰£çš„é’±</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(BigDecimal money)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            balance = balance.subtract(money);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ— é”çš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountSafe</span> <span class="keyword">implements</span> <span class="title">Account</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜å˜é‡ä¸ºåŸå­å¼•ç”¨ç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;BigDecimal&gt; balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountSafe</span><span class="params">(BigDecimal balance)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.balance = <span class="keyword">new</span> AtomicReference&lt;&gt;(balance);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getBalance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> balance.get(); <span class="comment">// è·å–å½“å‰balanceå€¼</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deductMoney</span><span class="params">(BigDecimal money)</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="comment">// è·å–ä½™é¢æœ€æ–°å€¼</span></span><br><span class="line">            BigDecimal prev = balance.get();</span><br><span class="line">            <span class="comment">// è·å–ä¿®æ”¹åçš„ä½™é¢(æ‰ç”¨ç›¸å…³æ–¹æ³•)</span></span><br><span class="line">            BigDecimal next = prev.subtract(money);</span><br><span class="line">            <span class="comment">// çœŸæ­£è¿›è¡Œä¿®æ”¹çš„åŸå­æ“ä½œ</span></span><br><span class="line">            <span class="comment">// åŸç†: å—é™prevå€¼å…ˆå’Œä¸»å­˜ä¸­çš„balanceçš„å€¼è¿›è¡Œæ¯”è¾ƒ,å¦‚æœç›¸ç­‰å°±è¿”å›true,å°±å°†balanceçš„å€¼ç½®ä¸ºnext,è·³å‡ºå¾ªç¯;</span></span><br><span class="line">            <span class="comment">// å¦åˆ™å°±è¿”å›false,å†æ¬¡è¿›è¡Œæ­¤å¾ªç¯,ç›´åˆ°è·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (balance.compareAndSet(prev, next)) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">ä½™é¢:0==&gt;æ‰§è¡Œæ—¶é—´:68ms</span><br><span class="line">ä½™é¢:0==&gt;æ‰§è¡Œæ—¶é—´:59ms</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-çº¿ç¨‹æ± "><a href="#4-çº¿ç¨‹æ± " class="headerlink" title="4. çº¿ç¨‹æ± "></a>4. çº¿ç¨‹æ± </h3><h4 id="4-1-çº¿ç¨‹æ± ç§ç±»"><a href="#4-1-çº¿ç¨‹æ± ç§ç±»" class="headerlink" title="4.1 çº¿ç¨‹æ± ç§ç±»"></a>4.1 çº¿ç¨‹æ± ç§ç±»</h4><p><code>newFixedThreadPool</code></p>
<blockquote>
<p>newFixedThreadPoolï¼šé€‚ç”¨äºä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± (åˆ›å»ºçš„æ˜¯éå®ˆæŠ¤çº¿ç¨‹)</span></span><br><span class="line">        <span class="comment">// å®ç°çº¿ç¨‹å·¥å‚ThreadFactory: è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">2</span>, <span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬äºŒä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»“æŸçº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>newCachedThreadPool</code></p>
<blockquote>
<p>newCachedThreadPoolï¼šæ•´ä¸ªçº¿ç¨‹æ± è¡¨ç°ä¸ºçº¿ç¨‹æ•°ä¼šæ ¹æ®ä»»åŠ¡é‡ä¸æ–­å¢é•¿ï¼Œæ²¡æœ‰ä¸Šé™ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç©ºé—² 1åˆ†é’Ÿåé‡Šæ”¾çº¿ç¨‹ã€‚ é€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ExecutorService threadPool = Executors.newCachedThreadPool(<span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬äºŒä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æŸçº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>newSingleThreadExecutor</code></p>
<blockquote>
<p>newSingleThreadExecutorï¼šå¸Œæœ›å¤šä¸ªä»»åŠ¡æ’é˜Ÿæ‰§è¡Œã€‚çº¿ç¨‹æ•°å›ºå®šä¸º 1ï¼Œä»»åŠ¡æ•°å¤šäº 1 æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™å”¯ä¸€çš„çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æªæ–½ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œã€‚</li>
<li>Executors.newSingleThreadExecutor() çº¿ç¨‹ä¸ªæ•°å§‹ç»ˆä¸º1ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œè€ŒExecutors.newFixedThreadPool(1) åˆå§‹æ—¶ä¸º1ï¼Œä»¥åè¿˜å¯ä»¥ä¿®æ”¹ã€‚</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ExecutorService threadPool = Executors.newSingleThreadExecutor(<span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ç¬¬äºŒä¸ªçº¿ç¨‹</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æŸçº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-2-ä»»åŠ¡æäº¤"><a href="#4-2-ä»»åŠ¡æäº¤" class="headerlink" title="4.2 ä»»åŠ¡æäº¤"></a>4.2 ä»»åŠ¡æäº¤</h4><p><code>executeå’Œsubmit</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ExecutorService threadPool = Executors.newSingleThreadExecutor(<span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// executeæäº¤ä»»åŠ¡</span></span><br><span class="line">        threadPool.execute(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt;"</span> + i);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// submitæäº¤ä»»åŠ¡: æœ‰è¿”å›å€¼</span></span><br><span class="line">        Future&lt;Integer&gt; future = threadPool.submit(<span class="keyword">new</span> Callable&lt;&gt;() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">                    <span class="keyword">int</span> finalValue = i;</span><br><span class="line">                    atomicInteger.updateAndGet(operand -&gt; operand + finalValue);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> atomicInteger.get();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// è¾“å‡ºè¿”å›ç»“æœ</span></span><br><span class="line">        System.out.println(<span class="string">"Callableè¿”å›å€¼:"</span> + future.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æŸæ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>invokeAll</code></p>
<blockquote>
<p>æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">3</span>, <span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// invokeAllæ— è¿‡æœŸæ—¶é—´æ–¹å¼(å‚æ•°ä¸­å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´)</span></span><br><span class="line">        List&lt;Future&lt;String&gt;&gt; futures = threadPool.invokeAll(Arrays.asList(</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"one"</span>;</span><br><span class="line">                },</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"two"</span>;</span><br><span class="line">                },</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"three"</span>;</span><br><span class="line">                }</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†è¾“å‡ºè¿”å›ç»“æœ</span></span><br><span class="line">        futures.forEach(stringFuture -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(<span class="string">"value==&gt;"</span> + stringFuture.get());</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">catch</span> (ExecutionException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æŸæ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>invokeAny</code></p>
<blockquote>
<p>æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆ</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">3</span>, <span class="keyword">new</span> ThreadFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åç§°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"çº¿ç¨‹"</span> + atomicInteger.getAndIncrement() + <span class="string">"å·"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‚æ•°ä¸­ä¹Ÿå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        String result = threadPool.invokeAny(Arrays.asList(</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"one"</span>;</span><br><span class="line">                },</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"two"</span>;</span><br><span class="line">                },</span><br><span class="line">                () -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"å¼€å§‹æ‰§è¡Œ..."</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"three"</span>;</span><br><span class="line">                }</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"result:"</span> + result);</span><br><span class="line">        <span class="comment">// ç»“æŸæ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tbody><tr><td class="code"><pre><span class="line">å¼€å§‹æ‰§è¡Œ...</span><br><span class="line">å¼€å§‹æ‰§è¡Œ...</span><br><span class="line">å¼€å§‹æ‰§è¡Œ...</span><br><span class="line">result:one</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-3-çº¿ç¨‹æ± å…³é—­"><a href="#4-3-çº¿ç¨‹æ± å…³é—­" class="headerlink" title="4.3 çº¿ç¨‹æ± å…³é—­"></a>4.3 çº¿ç¨‹æ± å…³é—­</h4><blockquote>
<ul>
<li>shutdown()æ–¹æ³•ï¼šåœ¨ç»“æŸä¹‹å‰ï¼Œå·²ç»æäº¤çš„ä»»åŠ¡ä¼šæ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨shutdownæ–¹æ³•åï¼Œå†æäº¤çš„ä»»åŠ¡å°±ä¸å†æ‰§è¡Œã€‚</li>
<li>shutdownNow()æ–¹æ³•ï¼šè°ƒç”¨æ­¤æ–¹æ³•åï¼Œæ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•éƒ½ä¼šä»¥ï¼ˆï¼‰çš„æ–¹å¼è¢«æ‰“æ–­ï¼Œå·²æäº¤è¿›å…¥é˜Ÿåˆ—ä½†è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¼šä»¥<code>List&lt;Runnable&gt;</code>çš„æ–¹å¼è¿”å›ã€‚</li>
</ul>
</blockquote>
<h2 id="Redisè¿›é˜¶"><a href="#Redisè¿›é˜¶" class="headerlink" title="Redisè¿›é˜¶"></a>Redisè¿›é˜¶</h2><h3 id="Rediså…¥é—¨"><a href="#Rediså…¥é—¨" class="headerlink" title="Rediså…¥é—¨"></a>Rediså…¥é—¨</h3><h4 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h4><p><strong>Rediså‘½ä»¤å‚è€ƒç½‘ç«™ï¼š</strong><a href="http://redisdoc.com/">http://redisdoc.com </a></p>
<blockquote>
<ul>
<li>Rediséå…³ç³»å‹æ•°æ®åº“ï¼Œé»˜è®¤æœ‰16ä¸ªåˆ†åº“ï¼Œä¸€èˆ¬æˆ‘ä»¬é»˜è®¤ä½¿ç”¨ç¬¬0ä¸ªåº“</li>
<li>Redisä¸­å‘½ä»¤ä¸åŒºåˆ†å¤§å°å†™</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 1  <span class="comment"># åˆ‡æ¢æ•°æ®åº“</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; DBSIZE <span class="comment"># æŸ¥è¯¢å½“å‰æ•°æ®åº“å¤§å°</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name horse <span class="comment"># è®¾ç½®ä¸€ä¸ªstringç±»å‹çš„é”®å€¼æ•°æ®</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name <span class="comment"># è·å–keyå¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="string">"horse"</span></span><br><span class="line">127.0.0.1:6379&gt; DBSIZE <span class="comment"># å½“å‰æ•°æ®åº“å¤§å°</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; keys * <span class="comment"># å½“å‰æ•°æ®åº“çš„æ‰€æœ‰key</span></span><br><span class="line">1) <span class="string">"name"</span></span><br><span class="line">127.0.0.1:6379&gt; flushdb <span class="comment"># æ¸…ç©ºå½“å‰æ•°æ®åº“</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">127.0.0.1:6379&gt; flushall <span class="comment"># æ¸…ç©ºæ‰€æœ‰ï¼ˆ16ä¸ªï¼‰æ•°æ®åº“æ•°æ®</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p><strong>Redisæ˜¯å•çº¿ç¨‹çš„ï¼ï¼ï¼</strong></p>
<ul>
<li>Redisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUæ€§èƒ½ä¸æ˜¯Redisçš„æ€§èƒ½ç“¶é¢ˆï¼ŒRedisçš„æ€§èƒ½ç“¶é¢ˆæ˜¯æ ¹æ®æœºå™¨çš„å†…å­˜å’Œç½‘ç»œå¸¦å®½æ¥å½±å“çš„ã€‚</li>
<li>Redisæ˜¯Cè¯­è¨€å†™çš„ï¼Œå®˜æ–¹æ•°æ®è¡¨ç¤º100000+QPS,å®Œå…¨ä¸æ¯”åŒæ—¶ä½¿ç”¨key-valueçš„Menecacheæ€§èƒ½å·®ã€‚</li>
</ul>
<p><strong>Rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆä»ç„¶è¿˜é‚£ä¹ˆå¿«ï¼Ÿ</strong></p>
<ul>
<li>äººä»¬å¸¸æœ‰çš„è¯¯åŒºï¼š<ol>
<li>é«˜æ€§èƒ½çš„æœåŠ¡å™¨ä¸€å®šæ˜¯å¤šçº¿ç¨‹çš„</li>
<li>å¤šçº¿ç¨‹çš„æ•ˆç‡ä¸€å®šæ¯”å•çº¿ç¨‹çš„æ•ˆç‡é«˜</li>
</ol>
</li>
<li>whyï¼šRedisæ˜¯å°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨æ”¾è¿›å†…å­˜ä¸­ï¼Œå¦‚æœä½¿ç”¨å¤šçº¿ç¨‹æ“ä½œçš„è¯ï¼Œåœ¨è¿™æœŸé—´ä¼šæœ‰CPUä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ“ä½œï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œå½±å“æ•ˆç‡ï¼Œè€ŒRedisä½¿ç”¨å•çº¿ç¨‹å»æ“ä½œæ•°æ®ï¼Œä¸€æ¡çº¿è¿›è¡Œåˆ°åº•ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚å¯¹äºå†…å­˜æ¥è®²ï¼Œæ²¡æœ‰CPUåˆ‡æ¢çš„æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¤šæ¬¡è¯»å†™éƒ½æ˜¯åœ¨ä¸€ä¸ªCPUä¸Šé¢ï¼Œæ‰€ä»¥Redisçš„æ•ˆç‡ä¹Ÿå¾ˆé«˜ã€‚</li>
</ul>
</blockquote>
<h4 id="Redis-Key"><a href="#Redis-Key" class="headerlink" title="Redis-Key"></a>Redis-Key</h4><blockquote>
<p>redisä¸­å…³äºkeyçš„å‘½ä»¤æ¼”ç¤º</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set name horse</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set age 22</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *  # è®¾ç½®ä¸¤ä¸ªkey-valueé”®å€¼å¯¹</span><br><span class="line">1) "name"</span><br><span class="line">2) "age"</span><br><span class="line">127.0.0.1:6379&gt; EXISTS name age sex  # æŸ¥è¯¢keyæ˜¯å¦å­˜åœ¨ï¼ˆç»“æœï¼šåªå­˜åœ¨å‰ä¸¤ä¸ªï¼Œsexä¸å­˜åœ¨ï¼‰</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; move name  # ç§»é™¤ä¸€ä¸ªkey-valueé”®å€¼å¯¹</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "age"</span><br><span class="line">127.0.0.1:6379&gt; expire age 30  # ä¸ºkey-valueé”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl age # æŸ¥çœ‹å½“å‰keyçš„å‰©ä½™æ—¶é—´</span><br><span class="line">(integer) 25</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(integer) 23</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(integer) 21</span><br><span class="line">127.0.0.1:6379&gt; type age # æŸ¥çœ‹å½“å‰keyçš„ç±»å‹ï¼ˆsetå…³é”®å­—è®¾ç½®çš„éƒ½æ˜¯stringç±»å‹çš„ï¼‰</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="RedisåŸºæœ¬æ•°æ®ç±»å‹"><a href="#RedisåŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="RedisåŸºæœ¬æ•°æ®ç±»å‹"></a>RedisåŸºæœ¬æ•°æ®ç±»å‹</h3><h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><blockquote>
<p>Stringç±»å‹æ˜¯Redisä¸­æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ®è¯´ï¼Œ90%çš„ç¨‹åºå‘˜åªä¼šä½¿ç”¨Stringç±»å‹ï¼ˆå½“ç„¶è¿™æ˜¯ç©ç¬‘è¯ï¼‰</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>Redisè®¡æ•°å™¨ï¼ˆæµè§ˆé‡è®¡æ•°ï¼Œç§’æ€é™æµâ€¦ï¼‰<ul>
<li>incr/decrå‘½ä»¤çš„è‡ªå¢/è‡ªå‡æ“ä½œå®ç°</li>
</ul>
</li>
<li>ç»Ÿè®¡å¤šå•ä½çš„æ•°é‡ï¼ˆåŒæ—¶ç»Ÿè®¡ç”¨æˆ·çš„æ–‡ç« æ•°é‡ï¼Œç²‰ä¸æ•°é‡ï¼Œè¯„è®ºæ•°é‡ç­‰ï¼‰<ul>
<li>mset/mgetå‘½ä»¤çš„æ‰¹é‡è®¾ç½®/è·å–æ“ä½œå®ç°</li>
</ul>
</li>
<li>å¯¹è±¡ç¼“å­˜å­˜å‚¨ï¼šï¼ˆå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç¼“å­˜æ•°æ®åˆ°å†…å­˜ä¸­çš„æ–¹å¼ï¼‰<ul>
<li>ä¾‹å¦‚ï¼šblog:{id} {jsonå†…å®¹}</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set name horse</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">"horse"</span><br><span class="line">127.0.0.1:6379&gt; EXISTS name</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; APPEND name @muzi  # è¿½åŠ keyä¸ºnameçš„å€¼ï¼ˆå¦‚æœè¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œç›¸å½“äºsetå‘½ä»¤ï¼‰å’ŒJavaä¸­appendæ–¹æ³•æ•ˆæœç›¸åŒ</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; STRLEN name  # è·å–keyçš„é•¿åº¦</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">"horse@muzi"</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨åœºæ™¯ï¼šredisè®¡æ•°å™¨ï¼ˆåŸå­æ“ä½œï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; set views 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line">"0"</span><br><span class="line">127.0.0.1:6379&gt; INCR views  # è‡ªå¢+1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line">"1"</span><br><span class="line">127.0.0.1:6379&gt; INCR views</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; incr views</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; INCRBY views 10 # å¯ä»¥è®¾ç½®æ­¥é•¿,æ‰§è¡Œå¢é‡ï¼ˆè‡ªå¢+10ï¼‰</span><br><span class="line">(integer) 13</span><br><span class="line">127.0.0.1:6379&gt; DECRby views 5 # è‡ªå‡-5</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; decr views  # è‡ªå‡-1</span><br><span class="line">(integer) 7</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–å­—ç¬¦ä¸²range</span></span><br><span class="line">127.0.0.1:6379&gt; set content horsemuzi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get content</span><br><span class="line">"horsemuzi"</span><br><span class="line">127.0.0.1:6379&gt; getrange content 0 4  # æˆªå–å­—ç¬¦ä¸²ï¼šä»ä¸‹æ ‡0å¼€å§‹åˆ°ä¸‹æ ‡4ç»“æŸï¼ˆåŒ…å«å¤´å°¾ï¼‰</span><br><span class="line">"horse"</span><br><span class="line">127.0.0.1:6379&gt; getrange content 0 -1  # è·å–å…¨éƒ¨å­—ç¬¦ä¸²ï¼Œå’Œgetå‘½ä»¤æ•ˆæœç›¸åŒï¼ˆ-1ï¼šè¡¨ç¤ºåˆ°æœ€åä½ç½®ï¼‰</span><br><span class="line">"horsemuzi"</span><br><span class="line">127.0.0.1:6379&gt; setrange content 1 xxxx # ä»æŒ‡å®šä¸‹æ ‡å¼€å§‹æ›¿æ¢ç›¸åº”çš„å­—ç¬¦ä¸²</span><br><span class="line">(integer) 9</span><br><span class="line">127.0.0.1:6379&gt; get content</span><br><span class="line">"hxxxxmuzi"</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> setex(<span class="built_in">set</span> with expire) :å¸¦æœ‰è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> setnx(<span class="built_in">set</span> <span class="keyword">if</span> not exist): ä¸å­˜åœ¨åˆ™è®¾ç½®ï¼ˆåœ¨åˆ†å¸ƒå¼é”ä¸­å¸¸ç”¨ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; setex name 60 horse  # è®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) 57</span><br><span class="line">127.0.0.1:6379&gt; setnx mykey "redis"  # å¦‚æœmykeyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›1ï¼Œè¡¨æ˜è®¾ç½®æˆåŠŸ</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; setnx mykey "mogoDB"  # å¦‚æœmykeyå·²å­˜åœ¨ï¼Œåˆ™è¿”å›0ï¼Œè¡¨æ˜è®¾ç½®ä¸æˆåŠŸ</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "mykey"</span><br><span class="line">2) "name"</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ttl mykey # -1:è¡¨ç¤ºæ°¸ä¹…å­˜åœ¨ï¼Œæ²¡æœ‰æ—¶é—´é™åˆ¶</span><br><span class="line">(integer) -1</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰¹é‡æ“ä½œé”®å€¼å¯¹</span></span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3  # åŒæ—¶è®¾ç½®å¤šä¸ªkey-valueé”®å€¼å¯¹</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "k3"</span><br><span class="line">2) "k1"</span><br><span class="line">3) "k2"</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3  # åŒæ—¶è·å–å¤šä¸ªkeyå€¼</span><br><span class="line">1) "v1"</span><br><span class="line">2) "v2"</span><br><span class="line">3) "v3"</span><br><span class="line">127.0.0.1:6379&gt; MSETNX k1 v1 k4 v4  # msetnxå‘½ä»¤ï¼šæ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·ï¼ˆå½“k1å€¼å·²å­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®å¤±è´¥ï¼‰</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> redisä¸­å¯ä»¥è®¾ç½®ä¸€ä¸ªuser:1å¯¹è±¡ä¸ºkey,jsonå­—ç¬¦ä¸²å†…å®¹ä¸ºå¯¹è±¡å†…å®¹ï¼Œè¿›è¡Œå­˜å‚¨ï¼Œredisæ”¯æŒè¿™æ ·çš„æ“ä½œï¼ˆå¸¸ç”¨æ“ä½œï¼šè¯»å–å¯¹åº”çš„jsonå­—ç¬¦ä¸²ï¼Œç„¶åè§£æå…¶å†…å®¹è¿›è¡Œä½¿ç”¨ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; set user:1 {name:horse,age:3}</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get user:1</span><br><span class="line">"{name:horse,age:3}"</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">getsetå‘½ä»¤ï¼šå…ˆè·å–åè®¾ç½®</span><br><span class="line">127.0.0.1:6379&gt; getset k1 v11 # å¦‚æœå½“å‰keyå­˜åœ¨ï¼Œåˆ™è¿”å›å½“å‰keyåŸæ¥çš„å€¼ï¼Œå†å°†å½“å‰keyå€¼ä¿®æ”¹æ–°çš„å€¼ä¸ºv11</span><br><span class="line">"v1"</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">"v11"</span><br><span class="line">127.0.0.1:6379&gt; getset k4 v4  # å¦‚æœå½“å‰keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nil,å¹¶ä¸”è®¾ç½®å½“å‰keyçš„å€¼</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">"v4"</span><br></pre></td></tr></tbody></table></figure>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><blockquote>
<p>Listç±»å‹ï¼šæˆ‘ä»¬å¯ä»¥å°†redisä¸­çš„listç±»å‹æ”¹é€ æˆæ ˆã€é˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ç­‰â€¦ï¼ˆå¦‚æœä½¿ç”¨MQæ¶ˆæ¯é˜Ÿåˆ—å¤ªé‡é‡çº§çš„è¯ï¼Œå¯ä»¥é€‚å½“è¿›è¡Œæ”¹é€ ï¼‰</p>
<ul>
<li>æ”¹é€ æ¨¡æ‹Ÿé€»è¾‘ï¼š<ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šlpush(å·¦è¾¹è¿›) â€”&gt; rpop(å³è¾¹å‡º)</li>
<li>æ ˆï¼šlpush(å·¦è¾¹è¿›) â€”&gt; lpop(å·¦è¾¹å‡º)</li>
</ul>
</li>
</ul>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p><strong>listä¸­å¯ä»¥å­˜åœ¨é‡å¤å€¼</strong></p>
</li>
<li><p>listå®é™…ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå·¦è¾¹å’Œå³è¾¹éƒ½å¯ä»¥æ’å…¥å€¼</p>
<ul>
<li><p>å¦‚æœç§»é™¤äº†æŸä¸ªlistä¸­çš„æ‰€æœ‰å€¼ï¼Œlistæˆä¸ºç©ºé“¾è¡¨ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªé“¾è¡¨ä¹Ÿå°±ä¸å¤å­˜åœ¨å•¦</p>
</li>
<li><p>åœ¨ä¸¤è¾¹æ’å…¥æˆ–è€…æ”¹å˜å€¼ï¼Œæ•ˆç‡æœ€é«˜ï¼Œè¶Šå¾€ä¸­é—´ï¼Œæ•ˆç‡è¶Šä½ï¼ˆé“¾è¡¨ç‰¹æ€§ï¼‰</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">lpushï¼šå°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼ï¼Œpushè¿›åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆä»å·¦è¾¹å¼€å§‹æ’å…¥ï¼‰</span><br><span class="line">lpopï¼šä»å·¦è¾¹å¼€å§‹ç§»é™¤ä¸€ä¸ªå…ƒç´ </span><br><span class="line">rpushï¼šå°†ä¸€ä¸ªå€¼æˆ–è€…å¤šä¸ªå€¼ï¼Œpushè¿›åˆ—è¡¨çš„å°¾éƒ¨ï¼ˆä»å³è¾¹å¼€å§‹æ’å…¥ï¼‰</span><br><span class="line">rpopï¼š ä»å³è¾¹å¼€å§‹ç§»é™¤ä¸€ä¸ªå…ƒç´ </span><br><span class="line">lindexï¼šé€šè¿‡ç´¢å¼•ä¸‹æ ‡è·å–listä¸­çš„å¯¹åº”çš„æŸä¸ªå€¼</span><br><span class="line">llenï¼šè·å–listçš„é•¿åº¦</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list one two three  # å°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼ï¼Œpushè¿›åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆä»å·¦è¾¹å¼€å§‹æ’å…¥ï¼‰</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 1 # è·å–listä¸­çš„åŒºé—´å€¼</span><br><span class="line">1) "three"</span><br><span class="line">2) "two" </span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1  # è·å–listä¸­å…¨éƒ¨çš„å€¼</span><br><span class="line">1) "three"</span><br><span class="line">2) "two"</span><br><span class="line">3) "one"</span><br><span class="line">127.0.0.1:6379&gt; RPUSH list four five  # å°†ä¸€ä¸ªå€¼æˆ–è€…å¤šä¸ªå€¼ï¼Œpushè¿›åˆ—è¡¨çš„å°¾éƒ¨ï¼ˆä»å³è¾¹å¼€å§‹æ’å…¥ï¼‰</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "three"</span><br><span class="line">2) "two"</span><br><span class="line">3) "one"</span><br><span class="line">4) "four"</span><br><span class="line">5) "five"</span><br><span class="line">127.0.0.1:6379&gt; lpop list  # ä»å·¦è¾¹å¼€å§‹ç§»é™¤ä¸€ä¸ªå…ƒç´ </span><br><span class="line">"three"</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "two"</span><br><span class="line">2) "one"</span><br><span class="line">3) "four"</span><br><span class="line">4) "five"</span><br><span class="line">127.0.0.1:6379&gt; rpop list # ä»å³è¾¹å¼€å§‹ç§»é™¤ä¸€ä¸ªå…ƒç´ </span><br><span class="line">"five"</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "two"</span><br><span class="line">2) "one"</span><br><span class="line">3) "four"</span><br><span class="line">127.0.0.1:6379&gt; LINDEX list 1  # é€šè¿‡ç´¢å¼•ä¸‹æ ‡è·å–listä¸­çš„å¯¹åº”çš„æŸä¸ªå€¼</span><br><span class="line">"one"</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "two"</span><br><span class="line">2) "one"</span><br><span class="line">3) "four"</span><br><span class="line">127.0.0.1:6379&gt; llen list  # è·å–listçš„é•¿åº¦</span><br><span class="line">(integer) 3</span><br><span class="line">=================================================================================================================</span><br><span class="line">lremï¼šä½¿ç”¨åœºæ™¯ï¼šæ ¹æ®uidå–æ¶ˆå…³æ³¨ç­‰ï¼ˆç§»é™¤æŒ‡å®šçš„å€¼ï¼‰</span><br><span class="line">127.0.0.1:6379&gt; lpush list one  # listä¸­å¯ä»¥å­˜å‚¨é‡å¤çš„å€¼</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "one"</span><br><span class="line">2) "two"</span><br><span class="line">3) "one"</span><br><span class="line">4) "four"</span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 two  # ç§»é™¤æŒ‡å®šæ•°é‡çš„listä¸­æŒ‡å®šçš„å€¼ï¼ˆæ ¹æ®å€¼è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼‰</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "one"</span><br><span class="line">2) "one"</span><br><span class="line">3) "four"</span><br><span class="line">127.0.0.1:6379&gt; lrem list 2 one  # ç§»é™¤æŒ‡å®šæ•°é‡çš„åŒ¹é…å€¼</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "four"</span><br><span class="line">127.0.0.1:6379&gt; lrem list 2 four # ç§»é™¤æŒ‡å®šæ•°é‡çš„åŒ¹é…å€¼ï¼ˆlistä¸­åŒ¹é…çš„å€¼å¦‚æœå°äºæŒ‡å®šåˆ é™¤çš„æ•°é‡å€¼ï¼Œåˆ™åŒ¹é…å€¼å…¨éƒ¨åˆ é™¤ï¼‰</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">ltrimï¼šæˆªå–æŒ‡å®šé•¿åº¦listä¸­çš„å€¼</span><br><span class="line">127.0.0.1:6379&gt; rpush user:list horse horse1 horse2 horse3</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange user:list 0 -1</span><br><span class="line">1) "horse"</span><br><span class="line">2) "horse1"</span><br><span class="line">3) "horse2"</span><br><span class="line">4) "horse3"</span><br><span class="line">127.0.0.1:6379&gt; LTRIM user:list 1 2  # é€šè¿‡ç´¢å¼•ä¸‹æ ‡æˆªå–æŒ‡å®šçš„é•¿åº¦ï¼ˆè¿™æ—¶ï¼Œuser:listä¸­å°±åªæœ‰æˆªå–çš„å€¼ï¼Œè€Œä¸æ˜¯æˆªå–å‰©ä¸‹çš„å€¼ï¼‰</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange user:list 0 -1</span><br><span class="line">1) "horse1"</span><br><span class="line">2) "horse2"</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">rpoplpushï¼šï¼ˆç»„åˆå‘½ä»¤ï¼šä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œå…ˆpopï¼Œå†push,æ•ˆæœä¸€æ ·ï¼‰ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°†æ­¤å…ƒç´ ç§»åŠ¨åˆ°æ–°çš„åˆ—è¡¨ä¸­å»</span><br><span class="line">lsetï¼šæ›´æ–°listä¸­æ‰§è¡Œç´¢å¼•ä¸‹æ ‡çš„å€¼ï¼ˆè¯¥ä¸‹æ ‡å¯¹åº”çš„å€¼å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™ï¼ï¼ï¼ï¼‰</span><br><span class="line">127.0.0.1:6379&gt; lpush list one two three four</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1  # æŸ¥çœ‹liståŸæ¥å€¼</span><br><span class="line">1) "four"</span><br><span class="line">2) "three"</span><br><span class="line">3) "two"</span><br><span class="line">4) "one"</span><br><span class="line">127.0.0.1:6379&gt; RPOPLPUSH list new:list  # æ‰§è¡Œæ“ä½œ</span><br><span class="line">"one"</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1 # å†æŸ¥çœ‹listä¸­çš„å€¼ï¼ˆå³è¾¹æœ€åä¸€ä¸ªå…ƒç´ å·²ç»è¢«popå‡ºå»ï¼‰</span><br><span class="line">1) "four"</span><br><span class="line">2) "three"</span><br><span class="line">3) "two"</span><br><span class="line">127.0.0.1:6379&gt; lrange new:list 0 -1  # æŸ¥çœ‹æ–°åˆ—è¡¨çš„å€¼</span><br><span class="line">1) "one"</span><br><span class="line">127.0.0.1:6379&gt; LSET new:list 0 two  # æ›´æ–°listä¸­æ‰§è¡Œç´¢å¼•ä¸‹æ ‡çš„å€¼ï¼ˆè¯¥ä¸‹æ ‡å¯¹åº”çš„å€¼å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™ï¼ï¼ï¼ï¼‰</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange new:list 0 -1  # æŸ¥çœ‹ï¼šä¿®æ”¹æˆåŠŸ</span><br><span class="line">1) "two"</span><br><span class="line">127.0.0.1:6379&gt; LPOP new:list  # å¼¹å‡ºè¯¥å€¼ï¼ˆæ­¤æ—¶new:listä¸­æ²¡æœ‰ä»»ä½•å€¼ï¼‰</span><br><span class="line">"two"</span><br><span class="line">127.0.0.1:6379&gt; lrange new:list 0 -1</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; LSET new:list 0 two  # æ›´æ–°æŒ‡å®šç´¢å¼•çš„å€¼ï¼Œæœç„¶æŠ¥é”™</span><br><span class="line">(error) ERR no such key</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">linsertï¼šå°†æŸä¸ªvalueå€¼æ’å…¥åˆ°åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„å‰é¢æˆ–è€…åé¢</span><br><span class="line">127.0.0.1:6379&gt; lpush list one two three four</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "four"</span><br><span class="line">2) "three"</span><br><span class="line">3) "two"</span><br><span class="line">4) "one"</span><br><span class="line">127.0.0.1:6379&gt; LINSERT list before three other_value # åœ¨threeå€¼å‰é¢æ’å…¥ä¸€ä¸ªå€¼</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "four"</span><br><span class="line">2) "other_value"</span><br><span class="line">3) "three"</span><br><span class="line">4) "two"</span><br><span class="line">5) "one"</span><br><span class="line">127.0.0.1:6379&gt; LINSERT list after three after_value # # åœ¨threeå€¼åé¢æ’å…¥ä¸€ä¸ªå€¼</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) "four"</span><br><span class="line">2) "other_value"</span><br><span class="line">3) "three"</span><br><span class="line">4) "after_value"</span><br><span class="line">5) "two"</span><br><span class="line">6) "one"</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><blockquote>
<p>Setç±»å‹ï¼šç±»ä¼¼äºJavaä¸­çš„Seté›†åˆä¸€æ ·ï¼Œæ˜¯æ— éœ€ä¸é‡å¤é›†åˆ</p>
<p>ç‰¹æ€§ï¼š</p>
<ul>
<li>setä¸­çš„å€¼ä¸èƒ½é‡å¤ï¼ˆå’Œlistçš„åŒºåˆ«ï¼‰</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">saddï¼šç»™<span class="built_in">set</span>ä¸­æ·»åŠ å…ƒç´ </span><br><span class="line">smembersï¼š æŸ¥çœ‹æŒ‡å®š<span class="built_in">set</span>çš„æ‰€æœ‰æˆå‘˜å…ƒç´ </span><br><span class="line">sismemberï¼š æŸ¥çœ‹<span class="built_in">set</span>ä¸­æŒ‡å®šæˆå‘˜å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0</span><br><span class="line">scardï¼šè·å–<span class="built_in">set</span>çš„æˆå‘˜å…ƒç´ çš„æ•°é‡</span><br><span class="line">sremï¼šç§»é™¤<span class="built_in">set</span>ä¸­æŒ‡å®šçš„å…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼Œç›´æ¥ç§»é™¤ï¼Œå¦åˆ™ä¸è¿›è¡Œç§»é™¤ï¼‰</span><br><span class="line">srandmemberï¼šéšæœºè¿”å›æŒ‡å®šæ•°é‡çš„æˆå‘˜å…ƒç´ ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤è¿”å›ä¸€ä¸ª</span><br><span class="line">spopï¼šéšæœºåˆ é™¤æŒ‡å®šæ•°é‡çš„æˆå‘˜å…ƒç´ ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤åˆ é™¤ä¸€ä¸ª</span><br><span class="line">smvoeï¼šå°†<span class="built_in">set</span>ä¸­æŒ‡å®šçš„æˆå‘˜å…ƒç´ ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªæ–°çš„<span class="built_in">set</span>ä¸­ï¼ˆå¦‚æœæ–°é›†åˆä¸å­˜åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼‰</span><br><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> one two three three  <span class="comment"># ç»™setä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span>  <span class="comment"># æŸ¥çœ‹æŒ‡å®šsetçš„æ‰€æœ‰æˆå‘˜å…ƒç´ </span></span><br><span class="line">1) <span class="string">"three"</span></span><br><span class="line">2) <span class="string">"one"</span></span><br><span class="line">3) <span class="string">"two"</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER <span class="built_in">set</span> one  <span class="comment"># æŸ¥çœ‹setä¸­æŒ‡å®šæˆå‘˜å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER <span class="built_in">set</span> four</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; scard <span class="built_in">set</span>  <span class="comment"># è·å–setçš„æˆå‘˜å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; srem <span class="built_in">set</span> one <span class="comment"># ç§»é™¤setä¸­æŒ‡å®šçš„å…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼Œç›´æ¥ç§»é™¤ï¼Œå¦åˆ™ä¸è¿›è¡Œç§»é™¤ï¼‰</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; srem <span class="built_in">set</span> four</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span>  <span class="comment"># æŸ¥çœ‹ç§»é™¤æˆåŠŸ</span></span><br><span class="line">1) <span class="string">"three"</span></span><br><span class="line">2) <span class="string">"two"</span></span><br><span class="line">127.0.0.1:6379&gt; sadd <span class="built_in">set</span> one four five six seven eight nine ten</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span></span><br><span class="line"> 1) <span class="string">"two"</span></span><br><span class="line"> 2) <span class="string">"four"</span></span><br><span class="line"> 3) <span class="string">"six"</span></span><br><span class="line"> 4) <span class="string">"seven"</span></span><br><span class="line"> 5) <span class="string">"three"</span></span><br><span class="line"> 6) <span class="string">"eight"</span></span><br><span class="line"> 7) <span class="string">"ten"</span></span><br><span class="line"> 8) <span class="string">"five"</span></span><br><span class="line"> 9) <span class="string">"nine"</span></span><br><span class="line">10) <span class="string">"one"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER <span class="built_in">set</span>  <span class="comment"># éšæœºè¿”å›ä¸€ä¸ªæˆå‘˜å…ƒç´ </span></span><br><span class="line"><span class="string">"ten"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER <span class="built_in">set</span></span><br><span class="line"><span class="string">"six"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER <span class="built_in">set</span></span><br><span class="line"><span class="string">"three"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER <span class="built_in">set</span> 2 <span class="comment"># éšå³è¿”å›æ‰§è¡Œæ•°é‡çš„æˆå‘˜å…ƒç´ </span></span><br><span class="line">1) <span class="string">"four"</span></span><br><span class="line">2) <span class="string">"nine"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER <span class="built_in">set</span> 2</span><br><span class="line">1) <span class="string">"four"</span></span><br><span class="line">2) <span class="string">"two"</span></span><br><span class="line">127.0.0.1:6379&gt; spop <span class="built_in">set</span>  <span class="comment"># éšæœºåˆ é™¤setä¸­çš„ä¸€ä¸ªæˆå‘˜å…ƒç´ </span></span><br><span class="line"><span class="string">"one"</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span></span><br><span class="line">1) <span class="string">"ten"</span></span><br><span class="line">2) <span class="string">"five"</span></span><br><span class="line">3) <span class="string">"two"</span></span><br><span class="line">4) <span class="string">"six"</span></span><br><span class="line">5) <span class="string">"seven"</span></span><br><span class="line">6) <span class="string">"eight"</span></span><br><span class="line">7) <span class="string">"nine"</span></span><br><span class="line">8) <span class="string">"four"</span></span><br><span class="line">9) <span class="string">"three"</span></span><br><span class="line">127.0.0.1:6379&gt; spop <span class="built_in">set</span> 5  <span class="comment"># åˆ é™¤setä¸­æŒ‡å®šæ•°é‡çš„æˆå‘˜å…ƒç´ </span></span><br><span class="line">1) <span class="string">"three"</span></span><br><span class="line">2) <span class="string">"four"</span></span><br><span class="line">3) <span class="string">"nine"</span></span><br><span class="line">4) <span class="string">"eight"</span></span><br><span class="line">5) <span class="string">"six"</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span></span><br><span class="line">1) <span class="string">"ten"</span></span><br><span class="line">2) <span class="string">"five"</span></span><br><span class="line">3) <span class="string">"two"</span></span><br><span class="line">4) <span class="string">"seven"</span></span><br><span class="line">127.0.0.1:6379&gt; SMOVE <span class="built_in">set</span> new:<span class="built_in">set</span> five  <span class="comment"># å°†setä¸­æŒ‡å®šçš„æˆå‘˜å…ƒç´ ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªæ–°çš„setä¸­</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS <span class="built_in">set</span>  <span class="comment"># æŸ¥çœ‹setæˆå‘˜å…ƒç´ </span></span><br><span class="line">1) <span class="string">"ten"</span></span><br><span class="line">2) <span class="string">"two"</span></span><br><span class="line">3) <span class="string">"seven"</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS new:<span class="built_in">set</span>  <span class="comment"># æŸ¥çœ‹æ–°çš„setä¸­æˆå‘˜å…ƒç´ </span></span><br><span class="line">1) <span class="string">"five"</span></span><br><span class="line">=================================================================================================================</span><br><span class="line">å¾®åšã€Bæ ˆçš„å…±åŒå…³æ³¨ï¼Œå…±åŒçˆ±å¥½ã€ç­‰åŠŸèƒ½å®ç°ï¼ˆå¹¶é›†å¯ä»¥å®ç°ï¼‰</span><br><span class="line">é€»è¾‘ï¼šå°†Aç”¨æˆ·çš„å…³æ³¨çš„UPä¸»æ”¾è¿›ä¸€ä¸ªset1ä¸­ï¼Œå°†Bç”¨æˆ·çš„å…³æ³¨çš„UPä¸»ä¹Ÿæ”¾è¿›ä¸€ä¸ªse2tä¸­ï¼Œset1å’Œset2çš„äº¤é›†å°±æ˜¯ä¸¤ä¸ªç”¨æˆ·çš„å…±åŒå…³æ³¨ï¼Œå…¶ä»–çš„åŠŸèƒ½å®ç°ä¹Ÿæ˜¯ç±»ä¼¼</span><br><span class="line">127.0.0.1:6379&gt; sadd one:<span class="built_in">set</span> a b c d</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd two:<span class="built_in">set</span> c d e f g</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; sdiff one:<span class="built_in">set</span> two:<span class="built_in">set</span>  <span class="comment"># å·®é›†</span></span><br><span class="line">1) <span class="string">"a"</span></span><br><span class="line">2) <span class="string">"b"</span></span><br><span class="line">127.0.0.1:6379&gt; sinter one:<span class="built_in">set</span> two:<span class="built_in">set</span>  <span class="comment"># äº¤é›† ï¼ˆå…±åŒå¥½å‹çš„åŠŸèƒ½å¯ä»¥è¿™æ ·å®ç°ï¼‰</span></span><br><span class="line">1) <span class="string">"d"</span></span><br><span class="line">2) <span class="string">"c"</span></span><br><span class="line">127.0.0.1:6379&gt; sunion one:<span class="built_in">set</span> two:<span class="built_in">set</span>  <span class="comment"># å¹¶é›†</span></span><br><span class="line">1) <span class="string">"c"</span></span><br><span class="line">2) <span class="string">"g"</span></span><br><span class="line">3) <span class="string">"f"</span></span><br><span class="line">4) <span class="string">"e"</span></span><br><span class="line">5) <span class="string">"d"</span></span><br><span class="line">6) <span class="string">"b"</span></span><br><span class="line">7) <span class="string">"a"</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><blockquote>
<p>Hashç±»å‹ï¼šæœ¬è´¨å’ŒStringç±»å‹çš„key-valueæ•°æ®å·®ä¸å¤šï¼Œåªä¸è¿‡valueå€¼åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªMapé›†åˆè€Œå·²ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>é€‚ç”¨äºå­˜å‚¨ä¸€äº›ç»å¸¸å˜æ›´çš„æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨ä¸€ä¸ªuser:1å¯¹è±¡ï¼Œå­˜å‚¨å®ƒçš„nameï¼Œageï¼Œsexç­‰å­—æ®µä¿¡æ¯ï¼Œéšæ—¶å¯ä»¥å‡†ç¡®å˜æ›´ï¼Œè€Œå­˜å‚¨ä¸ºStringçš„è¯ï¼Œå¦‚æœåªæ›´æ–°user:1ä¸­çš„æŸä¸ªå­—æ®µå€¼ï¼Œè¿˜éœ€è¦æŠŠæ•´ä¸ªuser:1å¯¹è±¡è¦†ç›–æ‰æ¥è¿›è¡Œæ›´æ–°å­—æ®µæ•°æ®ï¼Œæ€æ ·å¤ªæ…¢ï¼Œè€Œhashå¯ä»¥è¿›è¡Œå‡†ç¡®çš„å­—æ®µæ•°æ®æ›´æ–°ï¼Œæ“ä½œæ›´åŠ æ–¹ä¾¿ã€‚</li>
<li>æ€»ä¹‹ï¼šHashé€‚åˆå­˜å‚¨å¯¹è±¡ï¼ŒStringé€‚åˆå­˜å‚¨å­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ—¶è¦åˆç†é€‰æ‹©ã€‚</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">hashçš„å‘½ä»¤å’ŒStringçš„å‘½ä»¤ç›¸ä¼¼ï¼Œåªæ˜¯è¦ä»¥hå¼€å¤´</span><br><span class="line">hsetï¼šsetä¸€ä¸ªkyeä¸ºlog,å€¼ä¸º 001-oneçš„mapé”®å€¼å¯¹</span><br><span class="line">hgetï¼šè·å–ä¸€ä¸ªå€¼</span><br><span class="line">hmsetï¼šsetå¤šä¸ªkey-valueå€¼</span><br><span class="line">hmgetï¼šè·å–å¤šä¸ªkey-valueå€¼</span><br><span class="line">hgetallï¼šæŸ¥çœ‹æ‰€æœ‰keyä¸ºlogçš„æ‰€æœ‰hashå€¼ï¼ˆåŒ…æ‹¬keyå’Œå¯¹åº”çš„valueï¼‰</span><br><span class="line">hlenï¼šæŸ¥çœ‹hashçš„å­—æ®µæ•°é‡ï¼ˆä¸€ä¸ªkeyé‡Œé¢æœ‰å¤šå°‘ä¸ªkey-valueé”®å€¼å¯¹ï¼‰</span><br><span class="line">HEXISTSï¼šæŸ¥çœ‹hashæŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨è¿”å›0ï¼Œå­˜åœ¨è¿”å›1</span><br><span class="line">hkeysï¼šåªè·å–hashçš„æ‰€æœ‰keyå€¼</span><br><span class="line">hvalsï¼šåªè·å–hashçš„æ‰€æœ‰valueå€¼</span><br><span class="line">HINCRBYï¼šæŒ‡å®šå¢é‡ï¼Œå¢åŠ æ•°å€¼(æŒ‡å®šå¢é‡ä¸ºè´Ÿæ•°ï¼Œç›¸å½“äºè¿›è¡Œå‡æ³•æ“ä½œ)</span><br><span class="line">hsetnxï¼šå¦‚æœå­—æ®µå€¼ä¸å­˜åœ¨å°±è®¾ç½®ï¼Œå¦åˆ™å°±ä¸è®¾ç½®</span><br><span class="line">127.0.0.1:6379&gt; hset log 001 one  # setä¸€ä¸ªkyeä¸ºlog,å€¼ä¸º 001-oneçš„mapé”®å€¼å¯¹</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hget log 001  # è·å–ä¸€ä¸ªå€¼</span><br><span class="line">"one"</span><br><span class="line">127.0.0.1:6379&gt; hmset log 002 two 003 three 004 four  # setå¤šä¸ªkey-valueå€¼</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget log 001 002 003 004  # è·å–å¤šä¸ªkey-valueå€¼</span><br><span class="line">1) "one"</span><br><span class="line">2) "two"</span><br><span class="line">3) "three"</span><br><span class="line">4) "four"</span><br><span class="line">127.0.0.1:6379&gt; HGETALL log  # æŸ¥çœ‹æ‰€æœ‰keyä¸ºlogçš„æ‰€æœ‰hashå€¼ï¼ˆåŒ…æ‹¬keyå’Œå¯¹åº”çš„valueï¼‰</span><br><span class="line">1) "001"</span><br><span class="line">2) "one"</span><br><span class="line">3) "002"</span><br><span class="line">4) "two"</span><br><span class="line">5) "003"</span><br><span class="line">6) "three"</span><br><span class="line">7) "004"</span><br><span class="line">8) "four"</span><br><span class="line">127.0.0.1:6379&gt; HLEN log  # æŸ¥çœ‹hashçš„å­—æ®µæ•°é‡ï¼ˆä¸€ä¸ªkeyé‡Œé¢æœ‰å¤šå°‘ä¸ªkey-valueé”®å€¼å¯¹ï¼‰</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; HDEL log 002  # åˆ é™¤hashæŒ‡å®šçš„keyå­—æ®µï¼Œå¯¹åº”çš„valueä¹Ÿå°±æ¶ˆå¤±äº†</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HGETALL log</span><br><span class="line">1) "001"</span><br><span class="line">2) "one"</span><br><span class="line">3) "003"</span><br><span class="line">4) "three"</span><br><span class="line">5) "004"</span><br><span class="line">6) "four"</span><br><span class="line">127.0.0.1:6379&gt; hlen log  # å†æ¬¡æŸ¥çœ‹é•¿åº¦ï¼ˆåˆ é™¤æˆåŠŸï¼‰</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS log oo3  # æŸ¥çœ‹hashæŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨è¿”å›0ï¼Œå­˜åœ¨è¿”å›1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS log 004</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hkeys log  # åªè·å–hashçš„æ‰€æœ‰keyå€¼</span><br><span class="line">1) "001"</span><br><span class="line">2) "003"</span><br><span class="line">3) "004"</span><br><span class="line">127.0.0.1:6379&gt; hvals log  # åªè·å–hashçš„æ‰€æœ‰valueå€¼</span><br><span class="line">1) "one"</span><br><span class="line">2) "three"</span><br><span class="line">3) "four"</span><br><span class="line">127.0.0.1:6379&gt; hset blog views 0  </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY blog views 10  # æŒ‡å®šå¢é‡ï¼Œå¢åŠ æ•°å€¼</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; hincrby blog views -5  # æŒ‡å®šå¢é‡ä¸ºè´Ÿæ•°ï¼Œç›¸å½“äºè¿›è¡Œå‡æ³•æ“ä½œ</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; hsetnx blog name "blogName"  # å¦‚æœå­—æ®µå€¼ä¸å­˜åœ¨å°±è®¾ç½®ï¼Œå¦åˆ™å°±ä¸è®¾ç½®</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hsetnx  blog name "name"  # å­—æ®µå€¼å·²å­˜åœ¨ï¼Œæ²¡æœ‰è®¾ç½®æˆåŠŸ</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; HGETALL blog  # æŸ¥çœ‹æ‰€æœ‰key-value</span><br><span class="line">1) "views"</span><br><span class="line">2) "5"</span><br><span class="line">3) "name"</span><br><span class="line">4) "blogName"</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h4><blockquote>
<p>Zsetç±»å‹ï¼šå’Œsetç±»å‹ï¼Œlistç±»å‹éƒ½å·®ä¸å¤šï¼Œåªä¸è¿‡å¢åŠ äº†ä¸€ä¸ªscoreçš„æ ‡å¿—ï¼ˆå¯ä»¥æ ¹æ®scoreè¿›è¡Œä¸€äº›é€»è¾‘æ“ä½œï¼‰</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>æ’åºï¼šç­çº§æˆç»©æ’åºï¼Œå·¥èµ„è¡¨æ’åº</li>
<li>è®¾ç½®æƒé‡ï¼šä¾‹å¦‚ï¼Œå°†æ™®é€šæ¶ˆæ¯çš„scoreè®¾ç½®ä¸º1ï¼Œé‡è¦æ¶ˆæ¯scoreè®¾ç½®ä¸º2ï¼Œç„¶åæ ¹æ®scoreçš„å€¼æ¥åˆ¤æ–­æ¶ˆæ¯ç±»å‹ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ</li>
<li>å„ç§æ’è¡Œæ¦œçš„å®ç°â€¦</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">zaddï¼šå¾€zsetä¸­è®¾ç½®ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼</span><br><span class="line">127.0.0.1:6379&gt; zadd zset 1 one  # å¾€zsetä¸­è®¾ç½®ä¸€ä¸ªå€¼</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd zset 2 two 3 three 4 four  # ä¸€æ¬¡è®¾ç½®å¤šä¸ªå€¼</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE zset 0 -1  # æŸ¥çœ‹æ‰€æœ‰å€¼</span><br><span class="line">1) "one"</span><br><span class="line">2) "two"</span><br><span class="line">3) "three"</span><br><span class="line">4) "four"</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">zrangeï¼šé»˜è®¤ä»å°åˆ°å¤§æŒ‰ç…§scoreï¼ˆscoreè‹¥ç›¸ç­‰ï¼ŒæŒ‰ç…§å­—å…¸é¡ºåºï¼‰çš„å€¼æ’åˆ—æˆå‘˜</span><br><span class="line">zrevrangeï¼šé»˜è®¤ä»å¤§åˆ°å°æŒ‰ç…§scoreï¼ˆscoreè‹¥ç›¸ç­‰ï¼ŒæŒ‰ç…§å­—å…¸é¡ºåºï¼‰çš„å€¼æ’åˆ—æˆå‘˜</span><br><span class="line">ZRANGEBYSCOREï¼šæ˜¾å¼æ•´ä¸ªæœ‰åºé›†ï¼ˆ-infï¼šè´Ÿæ— ç©·ï¼Œ+infï¼šæ­£æ— ç©·ï¼‰é»˜è®¤æŒ‰ç…§å‡åºæ’åˆ—</span><br><span class="line">zcountï¼šæ˜¾ç¤ºåœ¨-infåˆ°+infåŒºé—´å†…çš„æˆå‘˜æ•°é‡(è·å–æŒ‡å®šåŒºé—´çš„æˆå‘˜æ•°é‡)</span><br><span class="line">zcardï¼šæ˜¾ç¤ºæ•´ä¸ªzsetä¸­çš„æˆå‘˜æ•°é‡</span><br><span class="line">zrevrangebyscoreï¼šé€†åºæ’åˆ—æ‰€æœ‰æˆå‘˜</span><br><span class="line">zremï¼šç§»é™¤zsetä¸­æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œè¿”å›ç§»é™¤æˆåŠŸçš„ä¸ªæ•°ï¼Œè¢«ç§»é™¤æˆå‘˜ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0</span><br><span class="line">127.0.0.1:6379&gt; zadd salary 1100 horse 2200 muzi 3300 lili 4400 shasha 5500 siyu</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE salary 0 -1  # é»˜è®¤ä»å°åˆ°å¤§æŒ‰ç…§scoreï¼ˆscoreè‹¥ç›¸ç­‰ï¼ŒæŒ‰ç…§å­—å…¸é¡ºåºï¼‰çš„å€¼æ’åˆ—æˆå‘˜</span><br><span class="line">1) "horse"</span><br><span class="line">2) "muzi"</span><br><span class="line">3) "lili"</span><br><span class="line">4) "shasha"</span><br><span class="line">5) "siyu"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf  # æ˜¾å¼æ•´ä¸ªæœ‰åºé›†ï¼ˆ-infï¼šè´Ÿæ— ç©·ï¼Œ+infï¼šæ­£æ— ç©·ï¼‰</span><br><span class="line">1) "horse"</span><br><span class="line">2) "muzi"</span><br><span class="line">3) "lili"</span><br><span class="line">4) "shasha"</span><br><span class="line">5) "siyu"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf withscores  # æ˜¾ç¤ºæ•´ä¸ªæœ‰åºé›†åŠæˆå‘˜çš„ score å€¼</span><br><span class="line"> 1) "horse"</span><br><span class="line"> 2) "1100"</span><br><span class="line"> 3) "muzi"</span><br><span class="line"> 4) "2200"</span><br><span class="line"> 5) "lili"</span><br><span class="line"> 6) "3300"</span><br><span class="line"> 7) "shasha"</span><br><span class="line"> 8) "4400"</span><br><span class="line"> 9) "siyu"</span><br><span class="line">10) "5500"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf withscores limit 1 3  # æ˜¾ç¤ºæ•´ä¸ªæœ‰åºé›†æˆå‘˜çš„scoreå€¼å¹¶ä¸”æ¡è·³è¿‡1ä¸ªæŸ¥è¯¢3ä¸ª</span><br><span class="line">1) "muzi"</span><br><span class="line">2) "2200"</span><br><span class="line">3) "lili"</span><br><span class="line">4) "3300"</span><br><span class="line">5) "shasha"</span><br><span class="line">6) "4400"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf 4000 withscores  # æ˜¾ç¤º &lt;=4000 çš„æˆå‘˜</span><br><span class="line">1) "horse"</span><br><span class="line">2) "1100"</span><br><span class="line">3) "muzi"</span><br><span class="line">4) "2200"</span><br><span class="line">5) "lili"</span><br><span class="line">6) "3300"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary 4000 +inf withscores  # æ˜¾ç¤º &gt;=4000 çš„æˆå‘˜</span><br><span class="line">1) "shasha"</span><br><span class="line">2) "4400"</span><br><span class="line">3) "siyu"</span><br><span class="line">4) "5500"</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE salary 0 -1 withscores</span><br><span class="line"> 1) "horse"</span><br><span class="line"> 2) "1100"</span><br><span class="line"> 3) "muzi"</span><br><span class="line"> 4) "2200"</span><br><span class="line"> 5) "lili"</span><br><span class="line"> 6) "3300"</span><br><span class="line"> 7) "shasha"</span><br><span class="line"> 8) "4400"</span><br><span class="line"> 9) "siyu"</span><br><span class="line">10) "5500"</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 withscores  # é»˜è®¤ä»å¤§åˆ°å°æŒ‰ç…§scoreï¼ˆscoreè‹¥ç›¸ç­‰ï¼ŒæŒ‰ç…§å­—å…¸é¡ºåºï¼‰çš„å€¼æ’åˆ—æˆå‘˜</span><br><span class="line"> 1) "siyu"</span><br><span class="line"> 2) "5500"</span><br><span class="line"> 3) "shasha"</span><br><span class="line"> 4) "4400"</span><br><span class="line"> 5) "lili"</span><br><span class="line"> 6) "3300"</span><br><span class="line"> 7) "muzi"</span><br><span class="line"> 8) "2200"</span><br><span class="line"> 9) "horse"</span><br><span class="line">10) "1100"</span><br><span class="line">127.0.0.1:6379&gt; zcount salary -inf +inf  # æ˜¾ç¤ºåœ¨-infåˆ°+infåŒºé—´å†…çš„æˆå‘˜æ•°é‡(è·å–æŒ‡å®šåŒºé—´çš„æˆå‘˜æ•°é‡)</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; zcard salary  # æ˜¾ç¤ºæ•´ä¸ªzsetä¸­çš„æˆå‘˜æ•°é‡</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGEBYSCORE salary 6000 2000 withscores  # é€†åºæ’åˆ—salaryä»6000åˆ°2000ä¹‹é—´çš„æˆå‘˜</span><br><span class="line">1) "siyu"</span><br><span class="line">2) "5500"</span><br><span class="line">3) "shasha"</span><br><span class="line">4) "4400"</span><br><span class="line">5) "lili"</span><br><span class="line">6) "3300"</span><br><span class="line">7) "muzi"</span><br><span class="line">8) "2200"</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGEBYSCORE salary +inf -inf withscores  # é€†åºæ’åˆ—æ‰€æœ‰æˆå‘˜</span><br><span class="line"> 1) "siyu"</span><br><span class="line"> 2) "5500"</span><br><span class="line"> 3) "shasha"</span><br><span class="line"> 4) "4400"</span><br><span class="line"> 5) "lili"</span><br><span class="line"> 6) "3300"</span><br><span class="line"> 7) "muzi"</span><br><span class="line"> 8) "2200"</span><br><span class="line"> 9) "horse"</span><br><span class="line">10) "1100"</span><br><span class="line">127.0.0.1:6379&gt; ZREM salary siyu lili  # ç§»é™¤zsetä¸­æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œè¿”å›ç§»é™¤æˆåŠŸçš„ä¸ªæ•°ï¼Œè¢«ç§»é™¤æˆå‘˜ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ZREM salary sss  # è¢«ç§»é™¤æˆå‘˜ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) "horse"</span><br><span class="line">2) "muzi"</span><br><span class="line">3) "shasha"</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisç‰¹æ®Šæ•°æ®ç±»å‹"><a href="#Redisç‰¹æ®Šæ•°æ®ç±»å‹" class="headerlink" title="Redisç‰¹æ®Šæ•°æ®ç±»å‹"></a>Redisç‰¹æ®Šæ•°æ®ç±»å‹</h3><h4 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a>Geospatial</h4><blockquote>
<p>Geospatialç±»å‹ï¼šåœ°ç†ä½ç½®ç›¸å…³ä¸šåŠ¡å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šæœ‹å‹å®šä½ï¼Œé™„è¿‘çš„äººï¼Œæ‰“è½¦è·ç¦»è®¡ç®—ç­‰ç­‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¹³å¸¸å¼€å‘ç”¨ä¸åˆ°ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<ul>
<li><p>geoåº•å±‚çš„å®ç°åŸç†å…¶å®å°±æ˜¯zsetï¼Œå¯ä»¥ä½¿ç”¨zsetçš„æœ‰å…³å‘½ä»¤æ¥æ“ä½œgeo</p>
</li>
<li><p>ä½¿ç”¨ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ç¨‹åºå°†ä½ç½®çš„ç»çº¬åº¦è¾“å…¥é‡Œé¢ï¼Œæ‰èƒ½è¿›è¡Œä¸€äº›æ“ä½œ</p>
</li>
<li>ç»çº¬åº¦çš„é¡ºåºä¸èƒ½å†™å</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">geoaddï¼šå°†ç»™å®šçš„ç©ºé—´å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„é”®é‡Œé¢ï¼ˆç”¨æˆ·å¿…é¡»å…ˆè¾“å…¥ç»åº¦ï¼Œ ç„¶åå†è¾“å…¥çº¬åº¦ ==&gt; å‚æ•°é¡ºåºï¼šï¼ˆç»åº¦ ç»´åº¦ åœ°ç‚¹åç§°ï¼‰</span><br><span class="line">geoposï¼šè·å–å½“å‰åŸå¸‚çš„ç»åº¦å’Œç»´åº¦ï¼ˆä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼‰</span><br><span class="line">GEODISTï¼šè·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»ï¼ˆå•ä½ï¼šm,km,miï¼šè‹±é‡Œï¼Œft:è‹±å°ºï¼‰å¦‚æœä½ç½®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸ºç©º</span><br><span class="line">		ä½¿ç”¨åœºæ™¯ï¼šä¸¤äººä¹‹é—´çš„è·ç¦»è®¡ç®—</span><br><span class="line">georadiusï¼š ä»¥ç»™å®šç»çº¬åº¦ä½ç½®ä¸ºä¸­å¿ƒï¼ˆ110 30ï¼‰å¯»æ‰¾æ–¹åœ†1000kmä¹‹å†…çš„ä½ç½®å…ƒç´ ï¼ˆå¯ä»¥é…åˆå‚æ•°ï¼Œè®¾ç½®è¿”å›ç»“æœï¼‰</span><br><span class="line">		ä½¿ç”¨åœºæ™¯ï¼šå¾®ä¿¡é™„è¿‘çš„äºº</span><br><span class="line">GEORADIUSBYMEMBERï¼šè¿”å›æŒ‡å®šä½ç½®å‘¨å›´çš„å…¶ä»–å…ƒç´ ï¼ˆè¿™é‡Œç›´æ¥ä½¿ç”¨ä½ç½®ï¼Œè€Œä¸æ˜¯ç»çº¬åº¦ï¼‰</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.408 39.904 beijing  # è¾“å…¥ä¸€ä¸ªç©ºé—´å…ƒç´ åˆ°china:cityçš„é”®é‡Œé¢</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.445 31.213 shanghai</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 117.246 39.117 tianjing</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 106.549 29.581 chongqing</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd chain:city 126.645 45.758 haerbin 123.964 47.343 qiqihaer  #ä¸€æ¬¡è¾“å…¥å¤šä¸ªç©ºé—´å…ƒç´ åˆ°china:cityçš„é”®é‡Œé¢</span><br><span class="line">(integer) 2</span><br><span class="line">=================================================================================================================</span><br><span class="line">127.0.0.1:6379&gt; geopos china:city beijing  # è·å–å½“å‰åŸå¸‚çš„ç»åº¦å’Œç»´åº¦ï¼ˆä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼‰</span><br><span class="line">1) 1) "116.40800267457962036"</span><br><span class="line">   2) "39.90399988166036138"</span><br><span class="line">127.0.0.1:6379&gt; geopos china:city beijing chongqing</span><br><span class="line">1) 1) "116.40800267457962036"</span><br><span class="line">   2) "39.90399988166036138"</span><br><span class="line">2) 1) "106.54900163412094116"</span><br><span class="line">   2) "29.58100070345364685"</span><br><span class="line"> =================================================================================================================</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqing km  # è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»ï¼ˆå•ä½ï¼šm,km,miï¼šè‹±é‡Œï¼Œft:è‹±å°ºï¼‰ï¼Œå¦‚æœä½ç½®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸ºç©º</span><br><span class="line">"1457.4843"</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqing m</span><br><span class="line">"1457484.3470"</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqing mi</span><br><span class="line">"905.6410"</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqing ft</span><br><span class="line">"4781772.7919"</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqin km</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line">=================================================================================================================</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km  # ä»¥ç»™å®šç»çº¬åº¦ä½ç½®ä¸ºä¸­å¿ƒï¼ˆ110 30ï¼‰å¯»æ‰¾æ–¹åœ†1000kmä¹‹å†…çš„ä½ç½®å…ƒç´ </span><br><span class="line">1) "chongqing"</span><br><span class="line">2) "tianjing"</span><br><span class="line">3) "beijing"</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km withdist  # åŒæ—¶è¿”å›ä½ç½®å…ƒç´ ä¸ä¸­å¿ƒä½ç½®çš„è·ç¦»</span><br><span class="line">1) 1) "chongqing"</span><br><span class="line">   2) "684.3945"</span><br><span class="line">2) 1) "tianjing"</span><br><span class="line">   2) "789.0899"</span><br><span class="line">3) 1) "beijing"</span><br><span class="line">   2) "785.4967"</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km withdist withcoord  # åŒæ—¶è¿”å›ä½ç½®å…ƒç´ çš„ç»çº¬åº¦</span><br><span class="line">1) 1) "chongqing"</span><br><span class="line">   2) "684.3945"</span><br><span class="line">   3) 1) "106.54900163412094116"</span><br><span class="line">      2) "29.58100070345364685"</span><br><span class="line">2) 1) "tianjing"</span><br><span class="line">   2) "789.0899"</span><br><span class="line">   3) 1) "117.24599987268447876"</span><br><span class="line">      2) "39.11699937833952134"</span><br><span class="line">3) 1) "beijing"</span><br><span class="line">   2) "785.4967"</span><br><span class="line">   3) 1) "116.40800267457962036"</span><br><span class="line">      2) "39.90399988166036138"</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km withdist withcoord asc  # æŒ‰ç…§è·ç¦»çš„ç”±è¿‘åŠè¿œçš„é¡ºåºè¿”å›</span><br><span class="line">1) 1) "chongqing"</span><br><span class="line">   2) "684.3945"</span><br><span class="line">   3) 1) "106.54900163412094116"</span><br><span class="line">      2) "29.58100070345364685"</span><br><span class="line">2) 1) "beijing"</span><br><span class="line">   2) "785.4967"</span><br><span class="line">   3) 1) "116.40800267457962036"</span><br><span class="line">      2) "39.90399988166036138"</span><br><span class="line">3) 1) "tianjing"</span><br><span class="line">   2) "789.0899"</span><br><span class="line">   3) 1) "117.24599987268447876"</span><br><span class="line">      2) "39.11699937833952134"</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km withdist withcoord desc # æŒ‰ç…§è·ç¦»çš„ç”±è¿œåŠè¿‘çš„é¡ºåºè¿”å›</span><br><span class="line">1) 1) "tianjing"</span><br><span class="line">   2) "789.0899"</span><br><span class="line">   3) 1) "117.24599987268447876"</span><br><span class="line">      2) "39.11699937833952134"</span><br><span class="line">2) 1) "beijing"</span><br><span class="line">   2) "785.4967"</span><br><span class="line">   3) 1) "116.40800267457962036"</span><br><span class="line">      2) "39.90399988166036138"</span><br><span class="line">3) 1) "chongqing"</span><br><span class="line">   2) "684.3945"</span><br><span class="line">   3) 1) "106.54900163412094116"</span><br><span class="line">      2) "29.58100070345364685"</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 35 1000 km withdist withcoord count 2 desc  # é™åˆ¶è¿”å›2ä¸ªä½ç½®å…ƒç´ </span><br><span class="line">1) 1) "tianjing"</span><br><span class="line">   2) "789.0899"</span><br><span class="line">   3) 1) "117.24599987268447876"</span><br><span class="line">      2) "39.11699937833952134"</span><br><span class="line">2) 1) "beijing"</span><br><span class="line">   2) "785.4967"</span><br><span class="line">   3) 1) "116.40800267457962036"</span><br><span class="line">      2) "39.90399988166036138"</span><br><span class="line">      </span><br><span class="line">=================================================================================================================</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city beijing 1000 km withcoord withdist asc  # è¿”å›æŒ‡å®šä½ç½®å‘¨å›´çš„å…¶ä»–å…ƒç´ </span><br><span class="line">1) 1) "beijing"</span><br><span class="line">   2) "0.0000"</span><br><span class="line">   3) 1) "116.40800267457962036"</span><br><span class="line">      2) "39.90399988166036138"</span><br><span class="line">2) 1) "tianjing"</span><br><span class="line">   2) "113.2837"</span><br><span class="line">   3) 1) "117.24599987268447876"</span><br><span class="line">      2) "39.11699937833952134"</span><br><span class="line">=================================================================================================================</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE china:city 0 -1  # åº•å±‚çš„å®ç°åŸç†æ˜¯zsetï¼Œæ‰€ä»¥zsetçš„å‘½ä»¤åœ¨geoè¿™é‡Œä»ç„¶é€‚ç”¨</span><br><span class="line">1) "chongqing"</span><br><span class="line">2) "shanghai"</span><br><span class="line">3) "tianjing"</span><br><span class="line">4) "beijing"</span><br><span class="line">5) "qiqihaer"</span><br><span class="line">6) "haerbin"</span><br><span class="line">127.0.0.1:6379&gt; zrem china:city beijing chongqing  # ç§»é™¤ä¸¤ä¸ªå…ƒç´ </span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE china:city 0 -1</span><br><span class="line">1) "shanghai"</span><br><span class="line">2) "tianjing"</span><br><span class="line">3) "qiqihaer"</span><br><span class="line">4) "haerbin"</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h4><blockquote>
<p>Hyperloglogç±»å‹ï¼šè®¡ç®—åŸºæ•°æ•°é‡çš„æ•°æ®ç±»å‹</p>
<ul>
<li><p>ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ</p>
<ul>
<li><p>åŸºæ•°ï¼šä¸é‡å¤çš„å…ƒç´ çš„æ•°é‡ï¼ˆå¯ä»¥æ¥æ”¶ä¸€å®šçš„è¯¯å·®ï¼‰</p>
</li>
<li><p>ä¾‹å¦‚ï¼šA:{1,2,3,6,7},B:{1,3,5,6},é‚£ä¹ˆAå’ŒBä¸­ä¸é‡å¤çš„å…ƒç´ æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ6ï¼Œ7é‚£ä¹ˆè¿”å›çš„åŸºæ•°æ•°é‡å°±æ˜¯6ä¸ª</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
</li>
<li><p>ç½‘é¡µçš„UVç»Ÿè®¡ï¼ˆä¸€ä¸ªäººè®¿é—®ä¸€ä¸ªç»Ÿæˆ˜å¤šæ¬¡ï¼Œä½†æ˜¯è¿˜ç®—æ˜¯ä¸€ä¸ªäººçš„è¿™æ ·ç»Ÿè®¡ï¼‰</p>
<ul>
<li>ä¼ ç»Ÿæ–¹å¼ï¼šsetä¿å­˜ç”¨æˆ·idï¼Œsetä¸­å…ƒç´ ä¸å…è®¸é‡å¤ï¼Œæ‰€æœ‰ä»¥setä¸­çš„æ•°æ®é‡ä½œä¸ºç»Ÿè®¡åŸºå‡†</li>
<li>setæ–¹å¼å¦‚æœä¿å­˜å¤§é‡idï¼Œä¼šæ¯”è¾ƒå å†…å­˜ï¼Œå¦‚æœå•çº¯è®¡æ•°çš„è¯ï¼Œä¼šæ¯”è¾ƒæµªè´¹å†…å­˜</li>
<li>æ‰€æœ‰å¯ä»¥ä½¿ç”¨Hyperloglogç»Ÿè®¡UV</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¼˜ç‚¹ï¼šå ç”¨çš„å†…å­˜æ˜¯å›ºå®šçš„ï¼Œå­˜å‚¨2^64^ä¸åŒçš„å…ƒç´ æ—¶ï¼Œåªéœ€è¦12KBå†…å­˜å¤§å°ï¼Œå¦‚æœä»å­˜å‚¨å†…å­˜è§’åº¦æ¥æ¯”è¾ƒçš„è¯ï¼ŒHyperloglogæ˜¯ç»Ÿè®¡æ“ä½œçš„é¦–é€‰</p>
</li>
<li><p>ç¼ºç‚¹ï¼šå®˜æ–¹ç»™å‡ºä¼šæœ‰0.81%çš„é”™è¯¯ç‡ï¼Œä½†æ˜¯ç»Ÿè®¡ä»»åŠ¡çš„è¯ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡</p>
</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å¦‚æœå…è®¸å®¹é”™ï¼Œä½¿ç”¨Hyperloglog</li>
<li>å¦‚æœä¸å…è®¸å®¹é”™ï¼Œå¯ä»¥ä½¿ç”¨setæˆ–è€…å…¶ä»–çš„æ•°æ®ç±»å‹</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">pfaddï¼šåˆ›å»ºHyperloglogç±»å‹çš„ä¸€ç»„å…ƒç´ ï¼Œå¦‚æœè®¾ç½®çš„å…ƒç´ å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œè®¾ç½®å¤±è´¥ï¼Œè¿”å›0ï¼Œå¦åˆ™è¿”å›1</span><br><span class="line">PFMERGEï¼šåˆå¹¶ä¸¤ç»„å…ƒç´ ï¼Œè¿”å›å¹¶é›†ç»“æœ</span><br><span class="line">pfcountï¼šè¿”å›Hyperloglogç±»å‹ç»„ä¸­å…ƒç´ çš„æ•°é‡</span><br><span class="line">127.0.0.1:6379&gt; pfadd user:views 1 2 3 4 5  # åˆ›å»ºç¬¬ä¸€ç»„keyä¸ºuser:viewsçš„å…ƒç´ </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd user:views 2  # å¦‚æœè®¾ç½®çš„å…ƒç´ å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œè®¾ç½®å¤±è´¥ï¼Œè¿”å›0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; pfadd user:views 6 # å¦‚æœè®¾ç½®çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œæ›´æ–°æ“ä½œï¼Œè®¾ç½®æˆåŠŸï¼Œè¿”å›1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd user:id 4 5 6 7 8 9 10  # åˆ›å»ºç¬¬äºŒç»„keyä¸ºuser:idçš„å…ƒç´ </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PFMERGE user user:views user:id  # åˆå¹¶ä¸¤ç»„å…ƒç´ ï¼Œè¿”å›å¹¶é›†ç»“æœ</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount user  # è¿”å›ä¸€ç»„å…ƒç´ çš„æ•°é‡</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; pfcount user:views user:id  # ä¹Ÿå¯ä»¥ç›´æ¥ç»Ÿè®¡å¹¶è¿”å›å¤šç»„å…ƒç´ çš„æ•°é‡</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h4><blockquote>
<p>Bitmapç±»å‹ï¼šä½å›¾æ•°æ®ç»“æ„ï¼Œéƒ½æ˜¯æ“ä½œäºŒè¿›åˆ¶ä½æ¥è¿›è¡Œè®°å½•ï¼Œå°±åªæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç»Ÿè®¡ç”¨æˆ·æŸæ®µæ—¶é—´å†…æ˜¯å¦æ´»è·ƒï¼Œæ˜¯å¦ç™»å½•ï¼Œæ˜¯å¦æ‰“å¡ç­‰ç­‰ï¼Œåªè¦æ˜¯åªæœ‰ä¸¤ä¸ªçŠ¶æ€çš„ï¼Œå¦å¯ä»¥ä½¿ç”¨bitmapæ¥å®ç°ã€‚</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">å‘¨ä¸€åˆ°å‘¨æ—¥è¡¨ç¤ºæ ‡å¿—ï¼š1 2 3 4 ... 7 æ•°å­—è¡¨ç¤º</span><br><span class="line">127.0.0.1:6379&gt; SETBIT sign 1 1  <span class="comment"># è®¾ç½®ä¸€å‘¨ä¹‹ä¸­æ¯å¤©æ˜¯å¦æ‰“å¡ï¼ˆ0ï¼šæœªæ‰“å¡ï¼Œ1ï¼šæ‰“å¡ï¼‰</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 4 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 5 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 6 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 7 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 2  <span class="comment"># æŸ¥çœ‹æŸä¸€å¤©æ˜¯å¦æœ‰æ‰“å¡</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 3</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT sign  <span class="comment"># ç»Ÿè®¡è¿™å‘¨çš„æ‰“å¡å¤©æ•°</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisäº‹åŠ¡"><a href="#Redisäº‹åŠ¡" class="headerlink" title="Redisäº‹åŠ¡"></a>Redisäº‹åŠ¡</h3><blockquote>
<p><strong>é‡ç‚¹ï¼šRediså•æ¡å‘½ä»¤æ˜¯ä¿è¯åŸå­æ€§çš„ï¼Œä½†æ˜¯Redisäº‹åŠ¡ä¸ä¿è¯åŸå­æ€§</strong></p>
<p>ä¾‹å¦‚ï¼šå¯¹åŒä¸€ä¸ªè´¦æˆ·ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ“ä½œæœ‰ä¸¤æ¡å‘½ä»¤ï¼Œç¬¬ä¸€æ¡å‘½ä»¤ï¼š+100å…ƒï¼Œç¬¬äºŒæ¡å‘½ä»¤ï¼š-100å…ƒï¼Œåœ¨MySQLä¸­ï¼Œäº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œå¦‚æœç¬¬ä¸€æ¡å‘½ä»¤å¤±è´¥äº†ï¼Œé‚£ä¹ˆç¬¬äºŒæ¡å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€æœ‰mysqläº‹åŠ¡éµå¾ªACIDåŸåˆ™ï¼Œä½†æ˜¯åœ¨Redisä¸­ï¼Œå¦‚æœç¬¬ä¸€æ¡å‘½ä»¤åœ¨è¿è¡Œæ—¶å‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆç¬¬äºŒæ¡å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæœ€ç»ˆä¼šå¯¼è‡´æ•°æ®é”™è¯¯ï¼Œæ‰€ä»¥åœ¨Redisäº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ã€‚</p>
<p><strong>é‡ç‚¹ï¼šRedisäº‹åŠ¡æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</strong></p>
<ul>
<li>æ‰€æœ‰çš„å‘½ä»¤å…ˆè®¾ç½®åœ¨äº‹åŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥è¢«æ‰§è¡Œï¼Œè€Œæ˜¯å½“å‘èµ·æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼ŒæŒ‰ç…§Redisäº‹åŠ¡çš„ç‰¹ç‚¹è¿›è¡Œæ‰§è¡Œã€‚</li>
<li>ä¸ä¼šå‡ºç°MySQLç­‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„è„è¯»ã€å¹»è¯»ã€ç­‰å½±å“ã€‚</li>
</ul>
<p>Redisäº‹ç‰©æœ¬è´¨ï¼šä¸€ç»„å‘½ä»¤çš„é›†åˆï¼ä¸€ä¸ªé£Ÿç‰©ä¸­æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œåœ¨äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§ä¹¦å‹‹æ‰§è¡Œã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸€æ¬¡æ€§ï¼šä¸€æ¬¡æ‰§è¡Œå®Œæ¯•</li>
<li>é¡ºåºæ€§ï¼šæŒ‰ç…§å‘½ä»¤çš„å…ˆåå¾ªåºæ‰§è¡Œ</li>
<li>æ’ä»–æ€§ï¼šåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸èƒ½æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤</li>
</ul>
<p>Redisäº‹åŠ¡çš„å…·ä½“å‘½ä»¤æ“ä½œ</p>
<ul>
<li>å¼€å¯äº‹åŠ¡ï¼šmulti</li>
<li>å‘½ä»¤å…¥é˜Ÿï¼šå†™å…¥åŸºæœ¬çš„å‘½ä»¤æ“ä½œ</li>
<li>æ‰§è¡Œäº‹åŠ¡ï¼šexec</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šæ­£å¸¸æ‰§è¡Œäº‹åŠ¡çš„æµç¨‹</span><br><span class="line">127.0.0.1:6379&gt; multi  # å¼€å¯äº‹åŠ¡</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2  # å‘½ä»¤å…¥é˜Ÿ</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3  # å‘½ä»¤å…¥é˜Ÿ</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2  # å‘½ä»¤å…¥é˜Ÿ</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; APPEND k1 @horse</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec  # æ‰§è¡Œäº‹åŠ¡ï¼ˆå…¥é˜Ÿçš„å‘½ä»¤æŒ‰ç…§é¡ºåºæ‰§è¡ŒæˆåŠŸï¼‰</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) "v2"</span><br><span class="line">4) 1) "v1"</span><br><span class="line">   2) "v3"</span><br><span class="line">5) (integer) 8</span><br><span class="line">6) "v1@horse"</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šæ”¾å¼ƒäº‹åŠ¡ï¼ˆæ”¾å¼ƒäº‹åŠ¡ä¹‹åï¼Œä¹‹å‰å…¥é˜Ÿçš„æ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼‰</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD  # å–æ¶ˆäº‹åŠ¡</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k3  # äº‹åŠ¡ä¸­çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œè·å–ä¸åˆ°å€¼</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2</span><br><span class="line">1) (nil)</span><br><span class="line">2) (nil)</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šç¼–è¯‘å¼‚å¸¸ï¼ˆå¦‚æœä»£ç æœ‰é—®é¢˜ï¼Œæˆ–è€…å‘½ä»¤æœ‰é”™ï¼Œç¼–è¯‘æ—¶å°±æ²¡æœ‰é€šè¿‡ï¼Œé‚£ä¹ˆæ­¤æ—¶äº‹åŠ¡ä¸­æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼‰</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k1 @horse</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k2   # è¿™é‡Œä»£ç å‘½ä»¤é”™è¯¯ï¼ˆä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼‰</span><br><span class="line">(error) ERR wrong number of arguments for 'getset' command</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec  # å¼€å¯äº‹åŠ¡æ—¶æŠ¥é”™ï¼ˆä¹‹å‰å…¥é˜Ÿçš„å‘½ä»¤ï¼Œå…¨éƒ¨æ²¡æœ‰æ‰§è¡Œï¼‰</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt; get k1  # æ— æ³•è·å–å€¼</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; mget k2 k3</span><br><span class="line">1) (nil)</span><br><span class="line">2) (nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼š1/0è¿™æ ·å¼‚å¸¸ï¼Œå¦‚æœå‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸ï¼Œé‚£ä¹ˆæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œå…¶ä»–å‘½ä»¤å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œè€Œå‘ç”Ÿå¼‚å¸¸çš„å‘½ä»¤ä¼šè¢«æŠ›å‡ºå¼‚å¸¸ï¼Œå®Œå…¨ä¸å½±å“å…¶ä»–æ­£å¸¸å‘½ä»¤çš„æ‰§è¡Œï¼‰</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 "horse"  # å…ˆè®¾ç½®ä¸€ä¸ªå€¼</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1  # å°†è¿™ä¸ªk1è‡ªå¢ï¼ˆè¯­æ³•æ²¡æœ‰é”™è¯¯ï¼Œä½†æ˜¯åªæœ‰integerç±»å‹çš„æ•°æ®å¯ä»¥è‡ªå¢ï¼Œæ‰€ä»¥è¿™é‡Œä¼šæŠ¥é”™ï¼‰</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an integer or out of range  # ç¬¬äºŒæ¡å‘½ä»¤æŠ¥é”™ï¼Œä½†æ˜¯ä¸‹é¢çš„å‘½ä»¤ä»ç„¶æ­£å¸¸æ‰§è¡Œï¼Œæ¯«ä¸å½±å“</span><br><span class="line">3) OK</span><br><span class="line">4) OK</span><br><span class="line">5) 1) "horse"</span><br><span class="line">   2) "v2"</span><br><span class="line">   3) "v3"</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Watchç›‘è§†"><a href="#Watchç›‘è§†" class="headerlink" title="Watchç›‘è§†"></a>Watchç›‘è§†</h4><blockquote>
<p>Watchç›‘è§†ï¼šç›¸å½“äºä¹è§‚é”çš„æ€ç»´é€»è¾‘</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šæ­£å¸¸æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money  <span class="comment"># è®¾ç½®ç›‘è§†moneyå¯¹è±¡ï¼ˆç›‘è§†moneyçš„å€¼æ˜¯å¦ä¼šå‘ç”Ÿæ”¹å˜ï¼‰</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget money out</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>  <span class="comment"># äº‹åŠ¡æ­£å¸¸æ‰§è¡ŒæˆåŠŸï¼Œmoneyçš„æ•°æ®åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ï¼›</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br><span class="line">3) 1) <span class="string">"80"</span></span><br><span class="line">   2) <span class="string">"20"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">æ¼”ç¤ºï¼šåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ï¼Œå¦ä¸€æ¡redisçš„çº¿ç¨‹ä¿®æ”¹äº†moneyçš„å€¼ï¼Œå¯¼è‡´æ•´ä¸ªäº‹åŠ¡æ‰§è¡Œå¤±è´¥</span><br><span class="line">=================================================================================================================</span><br><span class="line">redisäº‹åŠ¡çº¿ç¨‹ï¼šå½“æ‰§è¡Œ<span class="built_in">exec</span>æ—¶ï¼Œé¦–å…ˆä¼šæ¯”è¾ƒmoneyçš„å€¼æ˜¯å¦è¢«æ”¹å˜è¿‡ï¼Œå¦‚æœæ”¹å˜è¿‡ï¼Œåˆ™äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå¦åˆ™äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget money out</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>  <span class="comment"># å½“æ‰§è¡Œäº‹åŠ¡åï¼Œè¿”å›å€¼ä¸ºç©ºï¼ˆæ˜¯å› ä¸ºå¦ä¸€æ¡redisçš„çº¿ç¨‹ä¿®æ”¹äº†moneyçš„å€¼ï¼Œå¯¼è‡´æ•´ä¸ªäº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼‰</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line"><span class="string">"1000"</span></span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">å¦ä¸€æ¡çº¿ç¨‹ï¼šæ”¹å˜moneyçš„å€¼</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 1000  <span class="comment"># ä¿®æ”¹money=1000</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get money  <span class="comment"># ä¿®æ”¹æˆåŠŸ</span></span><br><span class="line"><span class="string">"1000"</span></span><br><span class="line"></span><br><span class="line">=================================================================================================================</span><br><span class="line">å¦‚æœå‘ç°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå¿…é¡»å…ˆè§£é”ï¼Œè·å–æœ€æ–°å€¼ï¼Œå†æ¬¡ç›‘è§†ï¼Œè¿›è¡Œäº‹åŠ¡æ‰§è¡Œ</span><br><span class="line">127.0.0.1:6379&gt; get money  <span class="comment"># æŸ¥çœ‹moneyçš„å½“å‰å€¼</span></span><br><span class="line"><span class="string">"1000"</span></span><br><span class="line">127.0.0.1:6379&gt; UNWATCH  <span class="comment"># è§£é™¤å¯¹æ‰€æœ‰keyå€¼çš„watchç›‘è§†</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money  <span class="comment"># é‡æ–°ç›‘è§†ï¼ˆç›¸å½“äº select version çš„æ“ä½œï¼‰</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 100</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 100</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget money out</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>  <span class="comment"># æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 900</span><br><span class="line">2) (<span class="built_in">integer</span>) 100</span><br><span class="line">3) 1) <span class="string">"900"</span></span><br><span class="line">   2) <span class="string">"100"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisä»£ç æ¼”ç¤º"><a href="#Redisä»£ç æ¼”ç¤º" class="headerlink" title="Redisä»£ç æ¼”ç¤º"></a>Redisä»£ç æ¼”ç¤º</h3><blockquote>
<p>å¯¹äºJavaå¯¹Redidçš„APIçš„æ“ä½œç»ƒä¹ ï¼Œåé¢æœ‰æ—¶é—´ç»Ÿä¸€è¿›è¡Œã€‚</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">===============================================string============================================================</span><br><span class="line">    </span><br><span class="line">        ValueOperations&lt;String, Object&gt; stringTemplate = redisTemplate.opsForValue();</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å­˜åœ¨å°±è®¾ç½®key(setpx)</span></span><br><span class="line">        stringTemplate.setIfAbsent(<span class="string">"name"</span>, <span class="string">"horse"</span>, <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">        stringTemplate.setIfAbsent(<span class="string">"name"</span>, <span class="string">"muzi"</span>, <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨(exists)</span></span><br><span class="line">        redisTemplate.hasKey(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// ç§»é™¤keyçš„è¿‡æœŸæ—¶é—´,ä½¿å…¶å˜æˆæ°¸ä¸è¿‡æœŸçš„key(persist)</span></span><br><span class="line">        redisTemplate.persist(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­keyå¯¹åº”ä¿¡æ¯çš„ç±»å‹(type)</span></span><br><span class="line">        System.out.println(redisTemplate.type(<span class="string">"name"</span>));</span><br><span class="line">        <span class="comment">// è¿½åŠ keyä¸ºnameçš„å€¼()append</span></span><br><span class="line">        stringTemplate.append(<span class="string">"name"</span>, <span class="string">"@muzi"</span>);</span><br><span class="line">        <span class="comment">// è·å–å½“å‰keyçš„å¤§å°(strlen)</span></span><br><span class="line">        System.out.println(stringTemplate.size(<span class="string">"name"</span>));</span><br><span class="line">        <span class="comment">// å°†æ—§çš„keyè®¾ç½®ä¸ºvalueï¼Œå¹¶ä¸”è¿”å›æ—§çš„key</span></span><br><span class="line">        System.out.println(stringTemplate.getAndSet(<span class="string">"name"</span>, <span class="string">"horsemuzi"</span>));</span><br><span class="line">        <span class="comment">// è‡ªå¢/è‡ªå‡</span></span><br><span class="line">        stringTemplate.setIfAbsent(<span class="string">"age"</span>, <span class="number">22</span>);</span><br><span class="line">        stringTemplate.increment(<span class="string">"age"</span>, <span class="number">20</span>);</span><br><span class="line">        stringTemplate.increment(<span class="string">"age"</span>);</span><br><span class="line">        stringTemplate.decrement(<span class="string">"age"</span>, <span class="number">10</span>);</span><br><span class="line">        stringTemplate.decrement(<span class="string">"age"</span>);</span><br><span class="line">        System.out.println(stringTemplate.get(<span class="string">"age"</span>));</span><br><span class="line">        <span class="comment">// æ‰¹é‡è·å–key</span></span><br><span class="line">        List&lt;Object&gt; list = stringTemplate.multiGet(<span class="keyword">new</span> ArrayList&lt;String&gt;(Arrays.asList(<span class="string">"name"</span>, <span class="string">"age"</span>)));</span><br><span class="line">===============================================hash============================================================</span><br><span class="line">		HashOperations&lt;String, Object, Object&gt; hashTemplate = redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€ä¸ªå€¼</span></span><br><span class="line">        hashTemplate.put(<span class="string">"log"</span>, <span class="string">"log01"</span>, <span class="string">"ç¬¬ä¸€æ¡æ—¥å¿—å¯¹è±¡"</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€ä¸ªå€¼,ä¸å­˜åœ¨æ‰è®¾ç½®</span></span><br><span class="line">        hashTemplate.putIfAbsent(<span class="string">"log"</span>, <span class="string">"log02"</span>, <span class="string">"ç¬¬äºŒæ¡æ—¥å¿—"</span>);</span><br><span class="line">        hashTemplate.putIfAbsent(<span class="string">"log"</span>, <span class="string">"log03"</span>, <span class="string">"ç¬¬ä¸‰æ¡æ—¥å¿—"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å˜é‡ä¸­çš„æŒ‡å®šmapé”®æ˜¯å¦æœ‰å€¼,å¦‚æœå­˜åœ¨è¯¥mapé”®åˆ™è·å–å€¼ï¼Œæ²¡æœ‰åˆ™è¿”å›null</span></span><br><span class="line">        System.out.println(hashTemplate.get(<span class="string">"log"</span>, <span class="string">"log01"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰key-valueé›†åˆ</span></span><br><span class="line">        Map&lt;Object, Object&gt; logs = hashTemplate.entries(<span class="string">"log"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; log : logs.entrySet()) {</span><br><span class="line">            System.out.println(log.getKey() + <span class="string">"===&gt;"</span> + log.getValue());</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰keyçš„é›†åˆ</span></span><br><span class="line">        Set&lt;Object&gt; keys = hashTemplate.keys(<span class="string">"log"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object key : keys) {</span><br><span class="line">            System.out.println(<span class="string">"key:"</span> + key);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰valueçš„é›†åˆ</span></span><br><span class="line">        List&lt;Object&gt; values = hashTemplate.values(<span class="string">"log"</span>);</span><br><span class="line">        values.forEach(System.out::println);    </span><br><span class="line">    </span><br><span class="line">         <span class="comment">// åˆ¤æ–­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        System.out.println(hashTemplate.hasKey(<span class="string">"log"</span>, <span class="string">"log02"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤æŒ‡å®šå­—æ®µ(å¯ä¸€æ¬¡åˆ é™¤å¤šä¸ª)</span></span><br><span class="line">        System.out.println(hashTemplate.delete(<span class="string">"log"</span>, <span class="string">"log02"</span>));</span><br><span class="line"></span><br><span class="line">===============================================list============================================================</span><br><span class="line">    	ListOperations&lt;String, Object&gt; listTemplate = redisTemplate.opsForList();</span><br><span class="line"></span><br><span class="line">        listTemplate.leftPush(<span class="string">"list"</span>, <span class="number">1</span>);</span><br><span class="line">        listTemplate.leftPushAll(<span class="string">"list"</span>, Arrays.asList(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">        listTemplate.rightPush(<span class="string">"list"</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœç´¢å¼•ä¸º3çš„å€¼å­˜åœ¨å°±åœ¨å…¶å‰é¢æ·»åŠ ä¸€ä¸ªå€¼</span></span><br><span class="line">        listTemplate.leftPush(<span class="string">"list"</span>, <span class="number">3</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </span></span><br><span class="line">        List&lt;Object&gt; list = listTemplate.range(<span class="string">"list"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æŒ‡å®šç´¢å¼•å¤„çš„å€¼</span></span><br><span class="line">        System.out.println(listTemplate.index(<span class="string">"list"</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®æŒ‡å®šç´¢å¼•å¤„å…ƒç´ çš„å€¼</span></span><br><span class="line">        listTemplate.set(<span class="string">"list"</span>, <span class="number">0</span>, <span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤å¹¶è·å–åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        System.out.println(listTemplate.leftPop(<span class="string">"list"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        System.out.println(listTemplate.rightPop(<span class="string">"list"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ä¸€ä¸ªé˜Ÿåˆ—çš„å³è¾¹å¼¹å‡ºä¸€ä¸ªå…ƒç´ å¹¶å°†è¿™ä¸ªå…ƒç´ æ”¾å…¥å¦ä¸€ä¸ªæŒ‡å®šé˜Ÿåˆ—çš„æœ€å·¦è¾¹</span></span><br><span class="line">        listTemplate.rightPopAndLeftPush(<span class="string">"list"</span>, <span class="string">"new:list"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤é›†åˆä¸­å€¼ç­‰äºvalueçš„å…ƒç´ (index=0, åˆ é™¤æ‰€æœ‰å€¼ç­‰äºvalueçš„å…ƒç´ ; index&gt;0, ä»å¤´éƒ¨å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªå€¼ç­‰äºvalueçš„å…ƒç´ ; index&lt;0, ä»å°¾éƒ¨å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªå€¼ç­‰äºvalueçš„å…ƒç´ )</span></span><br><span class="line">        listTemplate.remove(<span class="string">"list"</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–listé•¿åº¦</span></span><br><span class="line">        System.out.println(listTemplate.size(<span class="string">"list"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰ªåˆ‡list</span></span><br><span class="line">        listTemplate.trim(<span class="string">"list"</span>, <span class="number">0</span>, <span class="number">4</span>);   </span><br><span class="line">    </span><br><span class="line"> ===============================================set============================================================ </span><br><span class="line">		SetOperations&lt;String, Object&gt; setTemplate = redisTemplate.opsForSet();</span><br><span class="line"></span><br><span class="line">        setTemplate.add(<span class="string">"set"</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span>, <span class="string">"five"</span>, <span class="string">"six"</span>);</span><br><span class="line"></span><br><span class="line">        setTemplate.add(<span class="string">"other:set"</span>, <span class="string">"eight"</span>, <span class="string">"one"</span>, <span class="string">"five"</span>, <span class="string">"nine"</span>, <span class="string">"ten"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–é›†åˆçš„å¤§å°</span></span><br><span class="line">        System.out.println(setTemplate.size(<span class="string">"set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–seté›†åˆçš„æ‰€æœ‰æˆå‘˜å…ƒç´ </span></span><br><span class="line">        System.out.println(setTemplate.members(<span class="string">"set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤å…ƒç´ (å•ä¸ªå€¼ã€å¤šä¸ªå€¼)</span></span><br><span class="line">        setTemplate.remove(<span class="string">"set"</span>, <span class="string">"two"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤å¹¶ä¸”è¿”å›ä¸€ä¸ªéšæœºçš„å…ƒç´ </span></span><br><span class="line">        System.out.println(setTemplate.pop(<span class="string">"set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«value</span></span><br><span class="line">        System.out.println(setTemplate.isMember(<span class="string">"set"</span>, <span class="string">"seven"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†</span></span><br><span class="line">        System.out.println(setTemplate.intersect(<span class="string">"set"</span>, <span class="string">"other:set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†å¹¶å­˜å‚¨åˆ°æ–°çš„é›†åˆä¸­</span></span><br><span class="line">        setTemplate.intersectAndStore(Arrays.asList(<span class="string">"set"</span>, <span class="string">"other:set"</span>), <span class="string">"new:set"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ä¸¤ä¸ªæˆ–è€…å¤šä¸ªé›†åˆçš„å¹¶é›†</span></span><br><span class="line">        System.out.println(setTemplate.union(<span class="string">"set"</span>, <span class="string">"other:set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ä¸¤ä¸ªæˆ–è€…å¤šä¸ªé›†åˆçš„å·®é›†</span></span><br><span class="line">        System.out.println(setTemplate.difference(<span class="string">"set"</span>, <span class="string">"other:set"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éšæœºè¿”å›é›†åˆä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´ </span></span><br><span class="line">        System.out.println(setTemplate.randomMembers(<span class="string">"set"</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(setTemplate.scan(<span class="string">"set"</span>, ScanOptions.NONE));</span><br><span class="line">     </span><br><span class="line">===============================================zset============================================================   </span><br><span class="line">        ZSetOperations&lt;String, Object&gt; zsetTemplate = redisTemplate.opsForZSet();</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"horse"</span>, <span class="number">1100</span>);</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"muzi"</span>, <span class="number">2200</span>);</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"lili"</span>, <span class="number">3300</span>);</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"shasha"</span>, <span class="number">4400</span>);</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"siyu"</span>, <span class="number">5500</span>);</span><br><span class="line">        zsetTemplate.add(<span class="string">"salary"</span>, <span class="string">"caixia"</span>, <span class="number">6600</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–é›†åˆå¤§å°</span></span><br><span class="line">        System.out.println(zsetTemplate.size(<span class="string">"salary"</span>));</span><br><span class="line">        System.out.println(zsetTemplate.zCard(<span class="string">"salary"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›scoreåœ¨1000-4000åŒºé—´å†…çš„æˆå‘˜æ•°é‡</span></span><br><span class="line">        System.out.println(zsetTemplate.count(<span class="string">"salary"</span>, <span class="number">1000</span>, <span class="number">4000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–é›†åˆä¸­ç»™å®šåŒºé—´çš„å…ƒç´ </span></span><br><span class="line">        System.out.println(zsetTemplate.range(<span class="string">"salary"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¢åŠ å…ƒç´ çš„scoreå€¼ï¼Œå¹¶è¿”å›å¢åŠ åçš„å€¼</span></span><br><span class="line">        System.out.println(zsetTemplate.incrementScore(<span class="string">"salary"</span>, <span class="string">"horse"</span>, <span class="number">500</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æœ‰åºé›†åˆæ˜¯æŒ‰ç…§å…ƒç´ çš„scoreå€¼ç”±å°åˆ°å¤§æ’åˆ—</span></span><br><span class="line">        System.out.println(zsetTemplate.rank(<span class="string">"salary"</span>, <span class="string">"muzi"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æŒ‰å…ƒç´ çš„scoreå€¼ç”±å¤§åˆ°å°æ’åˆ—</span></span><br><span class="line">        System.out.println(zsetTemplate.reverseRank(<span class="string">"salary"</span>, <span class="string">"muzi"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ç…§Scoreå€¼æŸ¥è¯¢é›†åˆä¸­çš„å…ƒç´ ï¼Œç»“æœä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">        System.out.println(zsetTemplate.rangeByScore(<span class="string">"salary"</span>, Double.MIN_VALUE, Double.MAX_VALUE));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ç…§Scoreå€¼æŸ¥è¯¢é›†åˆä¸­çš„å…ƒç´ ï¼Œç»“æœä»å¤§åˆ°å°æ’åº</span></span><br><span class="line">        System.out.println(zsetTemplate.reverseRangeByScore(<span class="string">"salary"</span>, Double.MIN_VALUE, Double.MAX_VALUE));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ç…§Scoreå€¼æŸ¥è¯¢é›†åˆä¸­çš„å…ƒç´ ï¼Œç»“æœä»å°åˆ°å¤§æ’åº,è¿”å›å€¼å¸¦æœ‰scoreå€¼,å¹¶ä¸”è·³è¿‡ç¬¬ä¸€ä¸ª,è¿”å›3ä¸ª</span></span><br><span class="line">        System.out.println(zsetTemplate.rangeByScoreWithScores(<span class="string">"salary"</span>, Double.MIN_VALUE, Double.MAX_VALUE, <span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–é›†åˆä¸­keyã€valueå…ƒç´ å¯¹åº”çš„scoreå€¼</span></span><br><span class="line">        System.out.println(zsetTemplate.score(<span class="string">"salary"</span>, <span class="string">"horse"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤æŒ‡å®šscoreèŒƒå›´çš„é›†åˆæˆå‘˜</span></span><br><span class="line">        System.out.println(zsetTemplate.removeRangeByScore(<span class="string">"salary"</span>, <span class="number">2000</span>, <span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†é›†åˆï¼ˆå’Œiteratorä¸€æ¨¡ä¸€æ ·ï¼‰</span></span><br><span class="line">        Cursor&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; salarys = zsetTemplate.scan(<span class="string">"salary"</span>, ScanOptions.NONE);</span><br><span class="line">        <span class="keyword">while</span> (salarys.hasNext()) {</span><br><span class="line">            ZSetOperations.TypedTuple&lt;Object&gt; next = salarys.next();</span><br><span class="line">            System.out.println(next.getValue() + <span class="string">"==="</span> + next.getScore());</span><br><span class="line">        }    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">===============================================hyperloglog=======================================================</span><br><span class="line">        <span class="comment">// åŸºæ•°ç»Ÿè®¡(å ç”¨ç©ºé—´å°)</span></span><br><span class="line">        HyperLogLogOperations&lt;String, Object&gt; hyperLogLogTemplate = redisTemplate.opsForHyperLogLog();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç¬¬ä¸€ç»„keyä¸ºuser:viewsçš„å…ƒç´ </span></span><br><span class="line">        hyperLogLogTemplate.add(<span class="string">"user:views"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        hyperLogLogTemplate.add(<span class="string">"other:views"</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç›´æ¥ç»Ÿè®¡å¤šç»„å…ƒç´ çš„åŸºæ•°(ä¸é‡å¤çš„æ•°çš„æ•°é‡)</span></span><br><span class="line">        System.out.println(hyperLogLogTemplate.size(<span class="string">"user:views"</span>, <span class="string">"other:views"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆåˆå¹¶å¤šç»„å…ƒç´ ,å†ç»Ÿè®¡</span></span><br><span class="line">        hyperLogLogTemplate.union(<span class="string">"new:views"</span>, <span class="string">"user:views"</span>, <span class="string">"other:views"</span>);</span><br><span class="line">        System.out.println(hyperLogLogTemplate.size(<span class="string">"new:views"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸€ç»„å…ƒç´ </span></span><br><span class="line">        hyperLogLogTemplate.delete(<span class="string">"user:views"</span>);    </span><br><span class="line"></span><br><span class="line">===============================================bitmap=======================================================</span><br><span class="line"> 		ValueOperations&lt;String, Object&gt; stringTemplate = redisTemplate.opsForValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå‘¨ä¸€åˆ°å‘¨æ—¥çš„ç­¾åˆ°æ•ˆæœ,true: ç­¾åˆ°,false: æœªç­¾åˆ°</span></span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">0</span>, <span class="keyword">true</span>);</span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">3</span>, <span class="keyword">true</span>);</span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">4</span>, <span class="keyword">false</span>);</span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">5</span>, <span class="keyword">true</span>);</span><br><span class="line">        stringTemplate.setBit(<span class="string">"user:1001"</span>, <span class="number">6</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°</span></span><br><span class="line">        System.out.println(stringTemplate.getBit(<span class="string">"user:1001"</span>, <span class="number">3</span>));</span><br><span class="line">	   <span class="comment">// è·å–ç­¾åˆ°æ€»å¤©æ•°</span></span><br><span class="line">        Long count = redisTemplate.execute((RedisCallback&lt;Long&gt;) cou -&gt; cou.bitCount(<span class="string">"user:1001"</span>.getBytes()));</span><br><span class="line">        System.out.println(<span class="string">"ä¸€å‘¨ç­¾åˆ°å¤©æ•°:"</span> + count);</span><br><span class="line"></span><br><span class="line">===============================================watchç›‘æ§+äº‹åŠ¡æ¼”ç¤º=============================================</span><br><span class="line">	    ValueOperations&lt;String, Object&gt; stringTemplate = redisTemplate.opsForValue();</span><br><span class="line"></span><br><span class="line">        stringTemplate.set(<span class="string">"money"</span>, <span class="number">100</span>);</span><br><span class="line">        stringTemplate.set(<span class="string">"out"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// watchç›‘æ§(å¦‚æœæœ‰å¦ä¸€ä¸ªçº¿ç¨‹åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´,ä¿®æ”¹äº†è¿™ä¸ªmoneyå€¼,é‚£ä¹ˆæ­¤äº‹åŠ¡ä¸ä¼šæ‰§è¡Œ)</span></span><br><span class="line">        redisTemplate.watch(<span class="string">"money"</span>);</span><br><span class="line">		<span class="comment">// æ¨¡æ‹Ÿå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹moneyçš„å€¼</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; {</span><br><span class="line">            stringTemplate.increment(<span class="string">"money"</span>, <span class="number">1000</span>);</span><br><span class="line">        }).start();</span><br><span class="line">        <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        redisTemplate.multi();</span><br><span class="line">        stringTemplate.decrement(<span class="string">"money"</span>, <span class="number">20</span>);</span><br><span class="line">        stringTemplate.increment(<span class="string">"out"</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œäº‹åŠ¡æ€»çš„å‘½ä»¤</span></span><br><span class="line">        redisTemplate.exec();</span><br><span class="line">        System.out.println(stringTemplate.multiGet(Arrays.asList(<span class="string">"money"</span>, <span class="string">"out"</span>)));</span><br><span class="line">		<span class="comment">// ç»“æœï¼š[1100, 0] è¡¨æ˜äº‹åŠ¡æ²¡æœ‰æ‰§è¡Œ</span></span><br><span class="line">		</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisé…ç½®æ–‡ä»¶"><a href="#Redisé…ç½®æ–‡ä»¶" class="headerlink" title="Redisé…ç½®æ–‡ä»¶"></a>Redisé…ç½®æ–‡ä»¶</h3><blockquote>
<p>Redis.confæ–‡ä»¶åŸºæœ¬é…ç½®äº†è§£</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">===============================================ç½‘ç»œ===============================================</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1  <span class="comment"># æ­¤redisç»‘å®šçš„ip,å¦‚æœè®¾ç½®ä¸ºâ€œ*â€åˆ™è¡¨ç¤ºï¼šå¯ä»¥ä»»æ„å®¢æˆ·ç«¯ipè®¿é—®</span></span><br><span class="line">protected-mode yes <span class="comment"># å¼€å§‹ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">port 6379 <span class="comment"># é»˜è®¤ç«¯å£å·</span></span><br><span class="line"></span><br><span class="line">===============================================é€šç”¨===============================================</span><br><span class="line">daemonize yes <span class="comment"># ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥å…è®¸åå°è¿è¡Œï¼‰é»˜è®¤æ˜¯no,æˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyes</span></span><br><span class="line">datebases 16 <span class="comment"># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æœ‰16ä¸ª</span></span><br><span class="line">alaas-show-logo yes <span class="comment"># æ˜¯å¦æ€»æ˜¯æ˜¾ç¤ºå¼€å¯redisæ—¶çš„logoæ ·å¼ï¼ˆæ— å…³ç´§è¦ï¼‰</span></span><br><span class="line"></span><br><span class="line">===============================================æŒä¹…åŒ–===============================================</span><br><span class="line"><span class="comment"># æŒä¹…åŒ–ï¼šè®¾ç½®åœ¨è§„å®šæ—¶é—´å†…ï¼Œæ‰§è¡Œäº†å¤šå°‘æ¬¡æ“ä½œåå°±æŒä¹…åŒ–æ•°æ®åˆ°rdbæ–‡ä»¶ä¸­ï¼ˆè¿™ä¸ªæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># redisæ˜¯å†…å­˜å‹æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ•°æ®æ–­ç”µå°±æ˜¯æ¶ˆå¤±</span></span><br><span class="line">save 900 1 <span class="comment"># å¦‚æœ900så†…ï¼Œè‡³å°‘æœ‰1ä¸ªkeyè¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 300 10 <span class="comment">#  å¦‚æœ300så†…ï¼Œè‡³å°‘æœ‰10ä¸ªkeyè¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 60 10000 <span class="comment">#  å¦‚æœ60så†…ï¼Œè‡³å°‘æœ‰10000ä¸ªkeyè¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes  <span class="comment"># å¦‚æœæŒä¹…åŒ–å‡ºé”™ï¼Œæ˜¯å¦è¿˜éœ€è¦ç»§ç»­å·¥ä½œ</span></span><br><span class="line"></span><br><span class="line">rdbcompression yes  <span class="comment"># æ˜¯å¦å‹ç¼©rdbæ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›cpuèµ„æº</span></span><br><span class="line"></span><br><span class="line">rdbchecksum yes  <span class="comment"># ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯å¦è¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒ</span></span><br><span class="line"></span><br><span class="line">dir ./  <span class="comment"># è®¾ç½®rdbæ–‡ä»¶ä¿å­˜çš„ä½ç½®ç›®å½•</span></span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb  <span class="comment"># è®¾ç½®rdbæ–¹å¼æŒä¹…åŒ–äº§ç”Ÿçš„æ–‡ä»¶å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># aofçš„é…ç½®ï¼Œå…¨éƒ¨é»˜è®¤å³å¯ï¼Œåªæ˜¯äº†è§£ä¸€ä¸‹</span></span><br><span class="line">appendonly no  <span class="comment">#æ—¶å€™å¼€å¯rofæŒä¹…åŒ–æ¨¡å¼ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒrdbæŒä¹…åŒ–æ¨¡å¼å®Œå…¨å¤Ÿç”¨</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span>  <span class="comment"># è®¾ç½®æŒä¹…åŒ–æ–‡ä»¶çš„åå­—</span></span><br><span class="line">appendfsync everysec  <span class="comment"># æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„å€¼</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Redisçš„å¯†ç è®¾ç½®ï¼ˆå‘½ä»¤ç‰ˆï¼‰:redisé»˜è®¤æ˜¯æ²¡æœ‰å¯†ç çš„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è®¾ç½®å®Œå¯†ç ä¹‹åï¼Œéœ€è¦è¿›è¡Œç™»å½•ï¼Œæ‰èƒ½è¿›è¡Œæ­£å¸¸çš„å·¥ä½œã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get requirepass  # è·å–redisçš„å¯†ç ï¼Œé»˜è®¤ä¸ºç©º</span><br><span class="line">1) "requirepass"</span><br><span class="line">2) ""</span><br><span class="line">127.0.0.1:6379&gt; config set requirepass "redis123"  # è®¾ç½®redisçš„å¯†ç </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; auth redis123  # ä½¿ç”¨å¯†ç è¿›è¡Œç™»å½•redis</span><br><span class="line">OK </span><br><span class="line">127.0.0.1:6379&gt; config get requirepass  # å†æ¬¡æŸ¥çœ‹redisçš„å¯†ç </span><br><span class="line">1) "requirepass"</span><br><span class="line">2) "redis123"</span><br></pre></td></tr></tbody></table></figure>
<h3 id="RedisæŒä¹…åŒ–"><a href="#RedisæŒä¹…åŒ–" class="headerlink" title="RedisæŒä¹…åŒ–"></a>RedisæŒä¹…åŒ–</h3><h4 id="RDBæ¨¡å¼"><a href="#RDBæ¨¡å¼" class="headerlink" title="RDBæ¨¡å¼"></a>RDBæ¨¡å¼</h4><blockquote>
<p>ä¸ºä»€ä¹ˆè¦è¿›è¡ŒæŒä¹…åŒ–ï¼Ÿ</p>
<ul>
<li>Redisæ˜¯å†…å­˜å‹æ•°æ®åº“ï¼Œå¦‚æœä¸å°†å†…å­˜ä¸­çš„æ•°æ®çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆæœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®ä¹Ÿéƒ½ä¼šéšä¹‹æ¶ˆå¤±ï¼Œæ‰€ä»¥Redisæä¾›äº†æŒä¹…åŒ–çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>ä¸»è¦æŒä¹…åŒ–æ–¹å¼ï¼š</p>
<ul>
<li>RDBæŒä¹…åŒ–æ¨¡å¼ï¼ˆä¸€èˆ¬ä¸éœ€è¦å†è¿›è¡Œé…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼‰</li>
</ul>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>RDBä¼˜ç‚¹ï¼š<ul>
<li>æ¯”AOFçš„æ–¹å¼æ›´åŠ é«˜æ•ˆ</li>
<li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</li>
</ul>
</li>
<li>RDBç¼ºç‚¹ï¼š<ul>
<li>å¦‚æœåœ¨è¿›è¡Œæœ€åä¸€æ¬¡æŒä¹…åŒ–çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆæœ€åä¸€æ¬¡æŒä¹…åŒ–çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚</li>
<li>å½“åœ¨ç”Ÿæˆdump.rdbæ–‡ä»¶æ—¶ï¼Œforkè¿›ç¨‹çš„æ—¶å€™ï¼ˆå¼€å¯å¦å¤–ä¸€æ¡çº¿ç¨‹ï¼‰ï¼Œä¼šå ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´</li>
</ul>
</li>
</ul>
<p>è§¦å‘RDBçš„æœºåˆ¶ï¼Ÿ</p>
<ul>
<li>æ»¡è¶³é…ç½®æ–‡ä»¶ä¸­saveè§„åˆ™çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbï¼Œè¿›è¡ŒæŒä¹…åŒ–</li>
<li>æ‰§è¡Œflushallå‘½ä»¤æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbï¼Œè¿›è¡ŒæŒä¹…åŒ–</li>
<li>é€€å‡ºredisæ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbï¼Œè¿›è¡ŒæŒä¹…åŒ–</li>
</ul>
</blockquote>
<p>AOFæ¨¡å¼</p>
<blockquote>
<p>åŸç†ï¼šå°†æˆ‘ä»¬æœåŠ¡å™¨è¿è¡ŒæœŸé—´å†…æ‰€æœ‰å‘½ä»¤éƒ½è®°å½•ä¸‹æ¥ï¼Œç”Ÿæˆä¸€ä¸ªxxx.aofç±»å‹æ–‡ä»¶ï¼Œç›¸å½“äºæœåŠ¡å™¨ä¸­çš„historyå‘½ä»¤çš„æ•ˆæœï¼Œæ¢å¤çš„æ—¶å€™å°±æŠŠè¿™ä¸ªæ–‡ä»¶å…¨éƒ¨æ‰§è¡Œä¸€è¾¹ï¼ˆä¸€èˆ¬æˆ‘ä»¬ä¸ä½¿ç”¨è¿™ç§æŒä¹…åŒ–æ–¹å¼ï¼‰</p>
</blockquote>
<h3 id="Redisè®¢é˜…"><a href="#Redisè®¢é˜…" class="headerlink" title="Redisè®¢é˜…"></a>Redisè®¢é˜…</h3><blockquote>
<p>Redisè®¢é˜…ï¼šæ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼Œå‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsubï¼‰æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>==ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ï¼ˆç±»ä¼¼äºä¸€ä¸ªå¾®ä¿¡å·å¯ä»¥è®¢é˜…å…³æ³¨å¤šä¸ªå¾®ä¿¡å…¬ä¼—å·ï¼‰==</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</li>
<li>å®æ—¶èŠå¤©å®¤ï¼ˆæŠŠé¢‘é“å½“ä½œèŠå¤©å®¤ï¼Œå°†æ¶ˆæ¯å›æ˜¾ç»™æ‰€æœ‰äººå³å¯ï¼‰</li>
<li>å¾®ä¿¡å…¬ä¼—å·è®¢é˜…ï¼Œå…³æ³¨ç­‰åŠŸèƒ½</li>
<li>ç¨å¾®å¤æ‚çš„åœºæ™¯æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨MQæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œredisä¹Ÿå¯ä»¥åšç®€å•çš„åŠŸèƒ½ã€‚</li>
</ul>
</blockquote>
<p>è®¢é˜…ç«¯ï¼š</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE horse  # è®¢é˜…ä¸€ä¸ªåç§°ä¸ºhorseçš„é¢‘é“</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "horse"</span><br><span class="line">3) (integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç­‰å¾…è¯»å–å‘é€ç«¯æ¨é€çš„æ¶ˆæ¯</span></span><br><span class="line">1) "message"  # æ¶ˆæ¯</span><br><span class="line">2) "horse"  # é‚£ä¸ªé¢‘é“çš„æ¶ˆæ¯</span><br><span class="line">3) "hello world!"  # æ¶ˆæ¯çš„å…·ä½“å†…å®¹</span><br><span class="line"></span><br><span class="line">1) "message"</span><br><span class="line">2) "horse"</span><br><span class="line">3) "Are You Ok!"</span><br><span class="line"></span><br><span class="line">1) "message"</span><br><span class="line">2) "horse"</span><br><span class="line">3) "Yes, I am fine. And you?"</span><br></pre></td></tr></tbody></table></figure>
<p>å‘é€ç«¯ï¼š</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; publish horse <span class="string">"hello world!"</span>   <span class="comment"># å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°horseé¢‘é“ï¼Œåªè¦è®¢é˜…äº†è¿™ä¸ªé¢‘é“ï¼Œéƒ½ä¼šæ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; publish horse <span class="string">"Are You Ok!"</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; publish horse <span class="string">"Yes, I am fine. And you?"</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisä¸»ä»å¤åˆ¶"><a href="#Redisä¸»ä»å¤åˆ¶" class="headerlink" title="Redisä¸»ä»å¤åˆ¶"></a>Redisä¸»ä»å¤åˆ¶</h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><blockquote>
<p>Redisä¸»ä»å¤åˆ¶ï¼šæŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–RedisæœåŠ¡å™¨ï¼Œå‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmaster/leaderï¼‰ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslave/followerï¼‰ã€‚</p>
<p>ä¸»ä»å¤åˆ¶ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹</li>
<li>ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ä»¥å†™ä¸ºä¸»ï¼›ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ä»¥è¯»ä¸ºä¸»</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½å¯ä»¥æ˜¯ä¸»èŠ‚ç‚¹ï¼ˆé™¤éé…ç½®æˆé›†ç¾¤ï¼‰</li>
<li>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥è®¾ç½®æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆæˆ–æ²¡æœ‰ä»èŠ‚ç‚¹ï¼‰ï¼Œä½†æ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</li>
</ul>
<p>ä¸»ä»å¤åˆ¶åŠŸèƒ½ä½œç”¨ï¼š</p>
<ol>
<li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</li>
<li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li>
<li>è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ã€‚å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹çš„åˆ†æ‘Šè´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li>
<li>yichongerzhongé«˜å¯ç”¨ï¼ˆé›†ç¾¤ï¼‰åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°åŠŸèƒ½ä¹‹å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µæ¨¡å¼å’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé›†ç¾¤é«˜å¯ç”¨çš„åŸºç¡€ã€‚</li>
</ol>
</blockquote>
<h5 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h5><blockquote>
<p>æˆ‘ä»¬è¿™é‡Œæµ‹è¯•æœ€ç®€å•çš„é›†ç¾¤é…ç½®ï¼ˆä¸€ä¸»äºŒä»ï¼‰ï¼šåªéœ€è¦é…ç½®ä»åº“ï¼Œä¸ç”¨é…ç½®ä¸»åº“ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication  <span class="comment"># æŸ¥çœ‹å½“å‰åº“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master   <span class="comment"># è§’è‰²ï¼šmaster(ä¸»æœº)</span></span><br><span class="line">connected_slaves:0  <span class="comment"># è¿æ¥çš„ä»æœºæ•°é‡ï¼š0ä¸ªï¼ˆå½“å‰æ²¡æœ‰é…ç½®ä»æœºï¼‰</span></span><br><span class="line">master_replid:bff2254b54e54ecedf7033ce5bf168a12fb2eea3</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></tbody></table></figure>
<p>==å¤åˆ¶ä¸‰ä¸ªé…ç½®redisé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«å‘½åä¸ºï¼šredis6379.confã€redis6380.confã€redis6381.confï¼Œä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºçš„ä¿¡æ¯å³å¯==</p>
<blockquote>
<p>ä¸»è¦é…ç½®ä¿¡æ¯ï¼š</p>
<ol>
<li>ç«¯å£å·</li>
<li>pidåç§°ï¼ˆå’Œç«¯å£å·ä¿æŒä¸€è‡´ï¼‰</li>
<li>logæ–‡ä»¶åå­—ï¼ˆå’Œç«¯å£å·ä¿æŒä¸€è‡´å³å¯ï¼Œæ˜“äºåŒºåˆ†ï¼‰</li>
<li>dump.rdbæ–‡ä»¶åç§°ï¼ˆå’Œç«¯å£å·ä¿æŒä¸€è‡´å³å¯ï¼Œæ˜“äºåŒºåˆ†ï¼‰</li>
</ol>
</blockquote>
<p>==ä¿®æ”¹å®Œæ¯•ï¼Œå¯åŠ¨3ä¸ªredisæœåŠ¡å™¨ï¼ˆç°åœ¨è¿˜æ²¡æœ‰è¿›è¡Œä¸»ä»é…ç½®ï¼Œæ‰€ä»¥æ¯ä¸€å°æœåŠ¡å™¨éƒ½å¯ä»¥æ˜¯ä¸»èŠ‚ç‚¹ï¼‰==</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin redis]<span class="comment"># ps -ef | grep redis  # æŸ¥çœ‹3å°redisæœåŠ¡å™¨åˆ†åˆ«å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">root      8787     1  0 14:18 ?        00:00:00 redis-server *:6379</span><br><span class="line">root      8834     1  0 14:19 ?        00:00:00 redis-server *:6380</span><br><span class="line">root      8879     1  1 14:20 ?        00:00:00 redis-server *:6381</span><br><span class="line">root      8891  8213  0 14:20 pts/2    00:00:00 grep --color=auto redis</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>é…ç½®ä¸€ä¸»äºŒä»æ¨¡å¼çš„ç®€å•é›†ç¾¤ï¼šå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€å°Rediséƒ½å¯ä»¥æ˜¯ä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨è‡ªéœ€è¦é…ç½®ä¸¤ä¸ªä»æœºå³å¯ã€‚</p>
<p>è§„åˆ™ï¼šä¸»æœºï¼ˆreids6379.confï¼‰,ä»æœºï¼ˆredis6380.confã€redis6381.confï¼‰</p>
</blockquote>
<p>==6380ï¼ˆä»æœºï¼‰â€”&gt;å‘½ä»¤é…ç½®==</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin redis]<span class="comment"># redis-cli -p 6380</span></span><br><span class="line">127.0.0.1:6380&gt; info replication  <span class="comment"># æ²¡æœ‰é…ç½®æˆä¸ºä»æœºä¹‹å‰ï¼Œè§’è‰²æ˜¯ä¸»æœº</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master  <span class="comment"># è§’è‰²ï¼šä¸»æœº</span></span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:bfbd46ee72759ea74ff4c0623bdde2e02221db2b</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 6379   <span class="comment"># é…ç½®æˆä¸ºç«¯å£ä¸º6379RedisæœåŠ¡å™¨çš„ä»æœº</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication  <span class="comment"># å†æ¬¡æŸ¥çœ‹ï¼šè§’è‰²å˜æ›´ä¸ºä»æœº</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave  <span class="comment"># è§’è‰²ï¼šä»æœº</span></span><br><span class="line">master_host:127.0.0.1  <span class="comment"># å¯ä»¥çœ‹åˆ°ä¸»æœºçš„xi'ni</span></span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:1</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:3ac67367ce4f1e01b042862263ec10f2ad7a5142</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br></pre></td></tr></tbody></table></figure>
<p>==6380ï¼ˆä»æœºï¼‰â€”&gt;confé…ç½®==</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">replicaof 127.0.0.1 6379 <span class="comment"># é…ç½®è¿æ¥çš„ä¸»æœºipå’Œç«¯å£</span></span><br><span class="line">masterauth &lt;ä¸»æœºå¯†ç &gt;  <span class="comment"># å¦‚æœä¸»æœºæœ‰å¯†ç ï¼Œåˆ™é…ç½®å¯†ç ï¼Œå¦åˆ™ç›´æ¥æ³¨é‡Šæ‰æ­¤è¡Œå³å¯</span></span><br></pre></td></tr></tbody></table></figure>
<p>==6381ï¼ˆä»æœºï¼‰â€”&gt;å‘½ä»¤ç‰ˆ==</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin redis]<span class="comment"># redis-cli -p 6381</span></span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:3ff3c95f9e7493afe286055612eca586344616c9</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379  <span class="comment"># é…ç½®æˆä¸ºç«¯å£ä¸º6379RedisæœåŠ¡å™¨çš„ä»æœº</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt; info replication  <span class="comment"># å†æ¬¡æŸ¥çœ‹ï¼šè§’è‰²å˜æ›´ä¸ºä»æœº</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave  </span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:434</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:3ac67367ce4f1e01b042862263ec10f2ad7a5142</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:434</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:435</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></tbody></table></figure>
<p>==6381ï¼ˆä»æœºï¼‰â€”&gt;confé…ç½®==</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">replicaof 127.0.0.1 6379 <span class="comment"># é…ç½®è¿æ¥çš„ä¸»æœºipå’Œç«¯å£</span></span><br><span class="line">masterauth &lt;ä¸»æœºå¯†ç &gt;  <span class="comment"># å¦‚æœä¸»æœºæœ‰å¯†ç ï¼Œåˆ™é…ç½®å¯†ç ï¼Œå¦åˆ™ç›´æ¥æ³¨é‡Šæ‰æ­¤è¡Œå³å¯</span></span><br></pre></td></tr></tbody></table></figure>
<p>==6379ï¼ˆä¸»æœº,æ— éœ€é…ç½®ï¼‰==</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication  <span class="comment"># æ²¡æœ‰é…ç½®ä¹‹ä¹‹å‰ï¼šæŸ¥çœ‹å½“å‰åº“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master   <span class="comment"># è§’è‰²ï¼šmaster(ä¸»æœº)</span></span><br><span class="line">connected_slaves:0  <span class="comment"># è¿æ¥çš„ä»æœºæ•°é‡ï¼š0ä¸ªï¼ˆå½“å‰æ²¡æœ‰é…ç½®ä»æœºï¼‰</span></span><br><span class="line">master_replid:bff2254b54e54ecedf7033ce5bf168a12fb2eea3</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; info replication  <span class="comment"># é…ç½®ä¹‹åï¼šæ‹¥æœ‰ä¸¤å°ä»æœº</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=560,lag=1  <span class="comment"># ç¬¬ä¸€å°ä»æœºä¿¡æ¯</span></span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=560,lag=0  <span class="comment"># ç¬¬äºŒå°ä»æœºä¿¡æ¯</span></span><br><span class="line">master_replid:3ac67367ce4f1e01b042862263ec10f2ad7a5142</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:560</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:560</span><br></pre></td></tr></tbody></table></figure>
<p>==æ³¨æ„ï¼šçœŸå®çš„ä¸»ä»é…ç½®åº”è¯¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œé…ç½®çš„æ˜¯æ°¸ä¹…çš„ï¼Œè€Œä¸Šé¢çš„é…ç½®æ˜¯ä½¿ç”¨å‘½ä»¤é…ç½®çš„ï¼Œé…ç½®æ˜¯æš‚æ—¶çš„==</p>
<blockquote>
<p>é›†ç¾¤æ¨¡å¼åŠŸèƒ½ç»†èŠ‚ï¼š</p>
<ul>
<li>ä¸»æœºå¯ä»¥å†™ï¼Œä»æœºä¸èƒ½å†™åªèƒ½è¯»ã€‚</li>
<li>ä¸»æœºä¸­çš„æ‰€æœ‰ä¿¡æ¯å’Œæ•°æ®ï¼Œéƒ½ä¼šè¢«ä»æœºä¿å­˜</li>
</ul>
</blockquote>
<p>6379ä¸»æœºå†™æ•°æ®</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">==================================================6379===========================================</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3  <span class="comment"># å†™æ•°æ®</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) <span class="string">"v1"</span></span><br><span class="line">2) <span class="string">"v2"</span></span><br><span class="line">3) <span class="string">"v3"</span></span><br></pre></td></tr></tbody></table></figure>
<p>6380å’Œ6381ä»æœºä¸­ä¹Ÿå¯ä»¥è¯»å–åˆ°6379ä¸»æœºä¸­å†™çš„æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½å†™å…¥æ•°æ®</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">==================================================6380===========================================</span><br><span class="line">127.0.0.1:6380&gt; keys *  <span class="comment"># ä¸»æœºå†™ä¹‹å‰ï¼šæ²¡æœ‰æ•°æ®</span></span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">127.0.0.1:6380&gt; keys *  <span class="comment"># ä¸»æœºå†™ä¹‹åï¼šæœ‰æ•°æ®</span></span><br><span class="line">1) <span class="string">"k2"</span></span><br><span class="line">2) <span class="string">"k3"</span></span><br><span class="line">3) <span class="string">"k1"</span></span><br><span class="line">127.0.0.1:6380&gt; mget k1 k2 k3  <span class="comment"># è¯»å–æ•°æ®</span></span><br><span class="line">1) <span class="string">"v1"</span></span><br><span class="line">2) <span class="string">"v2"</span></span><br><span class="line">3) <span class="string">"v3"</span></span><br><span class="line">127.0.0.1:6380&gt; <span class="built_in">set</span> k4 v4  <span class="comment"># ä»æœºä¸èƒ½è¿›è¡Œå†™æ•°æ®</span></span><br><span class="line">(error) READONLY You can<span class="string">'t write against a read only replica.</span></span><br><span class="line"><span class="string">127.0.0.1:6380&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">==================================================6381===========================================</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; keys *</span></span><br><span class="line"><span class="string">(empty list or set)</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; keys *</span></span><br><span class="line"><span class="string">1) "k2"</span></span><br><span class="line"><span class="string">2) "k1"</span></span><br><span class="line"><span class="string">3) "k3"</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; mget k1 k2 k3</span></span><br><span class="line"><span class="string">1) "v1"</span></span><br><span class="line"><span class="string">2) "v2"</span></span><br><span class="line"><span class="string">3) "v3"</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; set k4 v4</span></span><br><span class="line"><span class="string">(error) READONLY You can'</span>t write against a <span class="built_in">read</span> only replica.</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>==ç®€å•æµ‹è¯•==</p>
<blockquote>
<p>æµ‹è¯•1ï¼š6379ä¸»æœºæ–­å¼€è¿æ¥çš„å½±å“ï¼Ÿ</p>
<ul>
<li>ä¸»æœºæ–­å¼€è¿æ¥ï¼Œä»æœºä»ç„¶è¿˜åœ¨è¿æ¥ç€ä¸»æœºï¼Œä½†æ˜¯æ²¡æœ‰å†™çš„æ“ä½œäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœä¸»æœºé‡æ–°å¯åŠ¨ï¼Œé‚£ä¹ˆä»æœºä¾æ—§å¯ä»¥ç›´æ¥è·å–åˆ°ä¸»æœºä¸­å†™çš„ä¿¡æ¯ã€‚</li>
</ul>
<p>æµ‹è¯•2ï¼š6380ä»æœºæ–­å¼€è¿æ¥çš„å½±å“ï¼Ÿ</p>
<ul>
<li>å› ä¸ºå½“å‰æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œè®¾ç½®çš„ä¸»æœºå’Œä»æœºçš„å…³ç³»ï¼Œæ‰€ä»¥å¦‚æœä»æœºå®•æœºäº†ï¼Œå†é‡å¯å›æ¥æ—¶ï¼Œå°±æ˜¯å˜å›ä¸»æœºï¼Œä¸§å¤±ä¸€åˆ‡é…ç½®çš„æ•ˆæœã€‚ä½†æ˜¯å¦‚æœè¿™æ—¶å†æ¬¡æŠŠ6380é…ç½®ä¸º6379çš„ä»æœºï¼Œé‚£ä¹ˆ6379ä¸­å­˜åœ¨çš„ä¿¡æ¯ï¼Œåœ¨ä»æœºä¸­ä¹Ÿå¯ä»¥è¯»å–åˆ°ã€‚</li>
</ul>
</blockquote>
<p>==å¤åˆ¶åŸç†==</p>
<blockquote>
<ol>
<li>slaveä»æœºæˆåŠŸè¿æ¥åˆ°masterä¸»æœºåä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤</li>
<li>masterä¸»æœºæ¥æ”¶åˆ°å‘½ä»¤åï¼Œä¼šå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹çš„æ•°æ®é›†çš„å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveä»æœºï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li>
</ol>
<p>æ¦‚å¿µï¼š</p>
<ul>
<li>å…¨é‡å¤åˆ¶ï¼šslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®æ–‡ä»¶åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­</li>
<li>å¢é‡å¤åˆ¶ï¼šmasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ é€ç»™slaveï¼Œå®ŒæˆåŒæ­¥</li>
</ul>
<p>==åªè¦æ—¶slaveä»æœºé‡æ–°è¿æ¥masterä¸»æœºï¼Œå°±æ˜¯æ‰§è¡Œä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰ï¼Œä¸»æœºä¸­çš„æ•°æ®åœ¨ä»æœºä¸­ä¸€å®šå¯ä»¥æ‰¾åˆ°ã€‚</p>
</blockquote>
<h4 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h4><blockquote>
<p>å“¨å…µæ¨¡å¼ï¼šå½“masterä¸»æœºå®•æœºä¹‹åï¼Œslaveä¼šè‡ªåŠ¨é€‰å–è€å¤§çš„æ¨¡å¼ã€‚</p>
<p>åŸç†ï¼šèƒ½å¤Ÿåå°ç›‘æ§masterä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†ï¼Œä¼šè‡ªåŠ¨æ ¹æ®æŠ•ç¥¨æ•°ï¼ˆæŠ•ç¥¨ç®—æ³•ï¼‰è‡ªåŠ¨å°†slaveè‡ªåŠ¨å°†ä»æœºè½¬æ¢ä¸ºä¸»æœºã€‚</p>
<p>è§„åˆ™ï¼šå½“masterä¸»æœºå‘ç”Ÿæ•…éšœä¹‹åï¼Œå†é‡æ–°å¯åŠ¨çš„è¯ï¼Œåªèƒ½å½’å¹¶åˆ°æ–°é€‰å–çš„masterä¸»æœºä¹‹ä¸‹ï¼ˆå½“ä½œæ–°ä¸»æœºçš„ä»æœºï¼‰ï¼Œè¿™æ˜¯å“¨å…µæ¨¡å¼çš„ä¼˜ç§€è§„åˆ™ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å“¨å…µé›†ç¾¤ï¼Œä¸»è¦åŸºäºRedisçš„ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œæ‰€æœ‰çš„ä¸»ä»å¤åˆ¶é…ç½®ä¼˜ç‚¹ï¼Œå®ƒå…¨éƒ¨éƒ½æœ‰</li>
<li>ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§å°±ä¼šæ›´å¥½</li>
<li>å“¨å…µæ¨¡å¼å°±æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ç‰ˆï¼Œç”±æ‰‹åŠ¨åˆ°è‡ªåŠ¨çš„å‡çº§ï¼Œæ¶æ„æ›´åŠ å¼ºå£®</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>Redisä¸å®¹æ˜“åœ¨çº¿æ‰©å®¹ï¼Œé›†ç¾¤å®¹é‡ä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œåœ¨çº¿æ‰©å®¹å°±ååˆ†éº»çƒ¦</li>
<li>å“¨å…µæ¨¡å¼çš„sentinel.confé…ç½®æ–‡ä»¶ä¸­æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå…¶å®ä¹Ÿéå¸¸éº»çƒ¦ï¼ˆç¤ºä¾‹åœ¨ä¸‹é¢â€¦ï¼‰</li>
</ul>
</blockquote>
<p>==é…ç½®å“¨å…µï¼ˆç›®å‰æ¨¡å¼ï¼šä¸€ä¸»äºŒä»,å…ˆé…ç½®ä¸€ä¸ªå“¨å…µï¼ˆå®é™…å·¥ä½œä¸­åº”è¯¥æœ€å°‘é…ç½®3ä¸ªå“¨å…µï¼‰ï¼‰==</p>
<p>1.é…ç½®å“¨å…µé…ç½®æ–‡ä»¶sentinel.conf</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åé¢çš„æ•°å­—1è¡¨ç¤ºï¼šé…ç½®å¤šå°‘ä¸ªsentinelå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆå°±å¦å¤–é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯æ‰“ç®—é…ç½®å¤šå°‘ä¸ªå“¨å…µè¿›ç¨‹ï¼Œå½“å‰æˆ‘ä»¬å°±é…ç½®äº†ä¸€ä¸ªå“¨å…µè¿›ç¨‹ï¼‰</span></span><br><span class="line">sentinel monnitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></tbody></table></figure>
<p>2.å¯åŠ¨å“¨å…µè¿›ç¨‹</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@centos7-mabin redis]<span class="comment"># redis-sentinel sentinel.conf</span></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.856 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 13710:X 14 Nov 2020 15:57:29.856 # Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=13710, just started</span></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.856 <span class="comment"># Configuration loaded</span></span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">''</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 5.0.5 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._</span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 13710</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span></span><br><span class="line">          `-._        _.-<span class="string">'</span></span><br><span class="line"><span class="string">              `-.__.-'</span></span><br><span class="line"></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.857 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.857 <span class="comment"># Sentinel ID is e7d079569b8b3a5faf573a234865a4641f213bd3</span></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.857 <span class="comment"># +monitor master mymaster 127.0.0.1 6379 quorum 1</span></span><br><span class="line">13710:X 14 Nov 2020 15:57:29.857 <span class="comment"># +monitor master myMaster 127.0.0.1 6379 quorum 1</span></span><br><span class="line">.....</span><br></pre></td></tr></tbody></table></figure>
<p>3.æ–­å¼€6379masterä¸»æœºï¼šæµ‹è¯•å“¨å…µæ˜¯å¦ä¼šä»ä¸¤ä¸ªslaveä»æœºä¸­æŠ•ç¥¨é€‰ä¸¾ä¸€ä¸ªæ–°ä¸»æœº</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; shutdown  <span class="comment"># æ–­å¼€RedisæœåŠ¡å™¨</span></span><br><span class="line">not connected&gt; <span class="built_in">exit</span></span><br><span class="line">[root@centos7-mabin redis]<span class="comment"># redis-server redis6379.conf</span></span><br><span class="line">[root@centos7-mabin redis]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line">127.0.0.1:6379&gt; info replication  <span class="comment"># é‡æ–°è¿æ¥æŸ¥çœ‹ï¼šæ­¤æ—¶è‡ªå·±å·²ç»å˜ä¸º6381çš„ä»æœº</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave  <span class="comment"># è§’è‰²ï¼šä»æœº</span></span><br><span class="line">master_host:127.0.0.1  </span><br><span class="line">master_port:6381   <span class="comment"># æ‰€å±ä¸»æœºï¼š6381</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:54423</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:a7679ff06aaed5e47cf0b14d23360beb1a4b52a5</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:54423</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:53869</span><br><span class="line">repl_backlog_histlen:555</span><br></pre></td></tr></tbody></table></figure>
<p>4.æŸ¥çœ‹6381çŠ¶æ€ï¼šè¢«é€‰ä¸¾ä¸ºæ–°masterä¸»æœº</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master  <span class="comment"># è§’è‰²ï¼šä¸»æœº</span></span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=144485,lag=0   <span class="comment"># ä»æœº6380</span></span><br><span class="line">slave1:ip=127.0.0.1,port=6379,state=online,offset=144485,lag=1   <span class="comment"># ä»æœº6379</span></span><br><span class="line">master_replid:a7679ff06aaed5e47cf0b14d23360beb1a4b52a5</span><br><span class="line">master_replid2:3ac67367ce4f1e01b042862263ec10f2ad7a5142</span><br><span class="line">master_repl_offset:144485</span><br><span class="line">second_repl_offset:37186</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:435</span><br><span class="line">repl_backlog_histlen:144051</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>5.æŸ¥çœ‹6380çŠ¶æ€ï¼šä»6379çš„ä»æœºå˜æˆäº†6381çš„ä»æœº</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication  </span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave  <span class="comment"># è§’è‰²ï¼š ä»æœº</span></span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6381   <span class="comment"># æ‰€å±ä¸»æœºï¼š6381</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:1</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:49024</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:a7679ff06aaed5e47cf0b14d23360beb1a4b52a5</span><br><span class="line">master_replid2:3ac67367ce4f1e01b042862263ec10f2ad7a5142</span><br><span class="line">master_repl_offset:49024</span><br><span class="line">second_repl_offset:37186</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:49024</span><br><span class="line">127.0.0.1:6380&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>==sentinel.confé…ç½®æ–‡ä»¶è¯¦è§£==ï¼ˆä¸€èˆ¬æ˜¯è¿ç»´æ“ä½œçš„ï¼‰</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å“¨å…µæ¨¡å¼é»˜è®¤ç«¯å£ï¼ˆå¦‚æœé…ç½®å¤šä¸ªå“¨å…µï¼Œåˆ™åº”è¯¥é…ç½®å¤šä¸ªç«¯å£ï¼‰</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦è®¾ç½®æˆä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œé»˜è®¤ä¸ºno</span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶çš„åç§°</span></span><br><span class="line">logfile <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å“¨å…µsentinelçš„å·¥ä½œç›®å½•</span></span><br><span class="line">dir <span class="string">"/tmp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é”®é…ç½®ï¼š</span></span><br><span class="line">  <span class="comment"># master-name: å¯ä»¥è‡ªå®šä¹‰åç§°çš„ä¸»èŠ‚ç‚¹åå­—ï¼Œåªèƒ½ç”±å­—æ¯ï¼Œæ•°å­—ï¼Œä¸‹åˆ’çº¿ç­‰ç»„æˆ</span></span><br><span class="line">  <span class="comment"># quorum: é…ç½®å½“æœ‰å¤šå°‘ä¸ªå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹æ•…éšœäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å®¢è§‚ä¸Šå°±è®¤ä¸ºæ­¤masterèŠ‚ç‚¹çœŸçš„æ•…éšœäº†</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6381 1</span><br><span class="line"></span><br><span class="line">.....åé¢è¿˜æœ‰å¾ˆå¤šé…æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸Šé¢çš„å…³é”®é…ç½®å³å¯</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Redisç¼“å­˜ç©¿é€"><a href="#Redisç¼“å­˜ç©¿é€" class="headerlink" title="Redisç¼“å­˜ç©¿é€"></a>Redisç¼“å­˜ç©¿é€</h3><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><blockquote>
<p>ç¼“å­˜ç©¿é€æ¦‚å¿µï¼šå¤§é¢ç§¯æŸ¥è¯¢ä¸åˆ°é€ æˆçš„</p>
<p>å½“ç”¨æˆ·æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œå‘ç°rediså†…å­˜æ•°æ®åº“ä¸­æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰ï¼Œäºæ˜¯æœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ã€‚ä½†æ˜¯å½“ç”¨æˆ·å¾ˆå¤šçš„æ—¶å€™ï¼Œç¼“å­˜åæ²¡æœ‰å‘½ä¸­ï¼ˆä¾‹ï¼šç§’æ€æ´»åŠ¨ä¸­åŒæ—¶æœ‰ä¸Šä¸‡ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯redisæ€»æ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œä¸Šä¸‡ä¸ªè¯·æ±‚éƒ½è½¬å‘Mysqlæ•°æ®åº“å»è¯·æ±‚ï¼‰ï¼Œé‚£ä¹ˆæŒä¹…å±‚æ•°æ®åº“å‹åŠ›å¾ˆå¤§ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°å®•æœºæ•…éšœï¼Œè¿™ä¸ªæ—¶å€™å°±ç›¸å½“äºå‡ºç°ç¼“å­˜ç©¿é€ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¸ƒéš†è¿‡æ»¤å™¨<ul>
<li>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°éƒ½å·²hashå½¢å¼å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å±‚å…ˆè¿›æ€§æ ¡éªŒï¼Œä¸ç¬¦åˆè§„åˆ™è¯·æ±‚å°±ä¸¢å¼ƒï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ï¼ˆæ¨èä½¿ç”¨ï¼‰</li>
</ul>
</li>
<li>ç¼“å­˜ç©ºå¯¹è±¡<ul>
<li>å½“å­˜å‚¨å±‚æ²¡æœ‰å‘½ä¸­åï¼Œå³ä½¿è¿”å›çš„æ˜¯ç©ºå¯¹è±¡ä¹Ÿå°†å…¶ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹‹åå†æœ‰è¯·æ±‚è®¿é—®è¿™ä¸ªæ•°æ®å°†ä¼šä»ç¼“å­˜æ€»è·å–ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤äº†åç«¯å­˜å‚¨ç³»ç»Ÿã€‚ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><blockquote>
<p>ç¼“å­˜å‡»ç©¿æ¦‚å¿µï¼šå¤§é‡è¯·æ±‚é›†äºä¸€ä¸ªç‚¹ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´è€Œé€ æˆçš„</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„å’Œç¼“å­˜ç©¿é€çš„åŒºåˆ«ï¼Œç¼“å­˜å‡»ç©¿æŒ‡çš„æ˜¯æŸä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼ˆä¾‹ï¼šå¾®åšçƒ­æœï¼Œä¼šæœ‰å¤§é‡çš„è¯·æ±‚å»è¯·æ±‚è¿™ä¸ªçƒ­ç‚¹keyï¼‰ï¼Œ==å½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼Œåœ¨è¿™ä¸ªå¤±æ•ˆçš„ç©ºæ¡£æœŸï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ä¼šç©¿ç ´ç¼“å­˜ï¼Œ==ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œé€ æˆç¼“å­˜å‡»ç©¿ï¼Œå°±åƒæ˜¯åœ¨å±å¹•ä¸Šç ¸å¼€äº†ä¸€ä¸ªæ´çš„æ“ä½œã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼ˆæµªè´¹ç©ºé—´ï¼‰<ul>
<li>ä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çƒ­ç‚¹keyè¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜</li>
</ul>
</li>
<li>åŠ äº’æ–¥é”<ul>
<li>ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œä¿è¯å¯¹äºæ¯ä¸ªkeyåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå»æŸ¥è¯¢åç«¯æœåŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰è·å–åˆ†å¸ƒå¼é”çš„æƒé™ï¼Œå› æ­¤åªéœ€è¦ç­‰å¾…å³å¯ï¼Œè¿™æ ·çš„è¯ï¼Œå¯¹åˆ†å¸ƒå¼é”çš„è€ƒéªŒå¾ˆå¤§ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><blockquote>
<p>ç¼“å­˜é›ªå´©æ¦‚å¿µï¼šæŸä¸€æ—¶é—´æ®µï¼Œç¼“å­˜é›†ä¸­è¿‡æœŸå¤±æ•ˆï¼Œè·å–RedisæœåŠ¡å™¨å®•æœºé€ æˆçš„</p>
<p>ä¾‹å¦‚ï¼šåŒåä¸€çš„æŸä¸€æ‰¹å•†å“é›†ä¸­æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œè®¾ç½®1å°æ—¶å¤±æ•ˆæ—¶é—´ï¼Œé‚£ä¹ˆä¸€å°æ—¶ä¹‹åï¼Œå¦‚æœå†æœ‰å¤§é‡å¯¹äºæ­¤å•†å“çš„æŸ¥è¯¢è¯·æ±‚ï¼Œå°±ä¼šç›´æ¥è½¬å‘æ•°æ®åº“ï¼Œé‚£ä¹ˆå¦‚æœæ•°æ®åº“æ‰›ä¸ä½è¿™äº›å‹åŠ›ï¼Œå°±æœ‰å¯èƒ½åœ¨æˆå­˜å‚¨å±‚æŒ‚æ‰çš„æƒ…å†µã€‚è¿™å°±æ˜¯ç¼“å­˜é›ªå´©ã€‚</p>
<p>æ¯”è¾ƒè‡´å‘½çš„é›ªå´©æ˜¯ï¼šæŸä¸ªç¼“å­˜æœåŠ¡å™¨ç›´æ¥å®•æœºæˆ–è€…æ–­ç½‘äº†ï¼Œè¿™æ˜¯æ•°æ®åº“æ‰¿å—çš„å‹åŠ›æ— æ³•æƒ³è±¡ï¼Œéå¸¸è‡´å‘½ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>Redisé«˜å¯ç”¨<ul>
<li>æ­å»ºé«˜å¯ç”¨çš„Redisé›†ç¾¤ï¼ˆå¼‚åœ°å¤šæ´»ï¼‰</li>
</ul>
</li>
<li>é™æµé™çº§<ul>
<li>åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚</li>
</ul>
</li>
<li>æ•°æ®é¢„çƒ­<ul>
<li>åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œå…ˆæŠŠå¯èƒ½çš„æ•°æ®é¢„å…ˆè®¿é—®ä¸€éï¼Œå°†å¤§éƒ¨åˆ†è¢«è®¿é—®çš„æ•°æ®å…ˆåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œè®¾ç½®ä¸åŒçš„keyå’Œä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h3><blockquote>
<p>éœ€æ±‚ï¼šæ‰‹åŠ¨å¼•å…¥ å¸ƒéš†è¿‡æ»¤å™¨ æ¨¡å—åˆ°redisä¸­ï¼ˆredisçš„4.xç‰ˆæœ¬å¼€å§‹å¼•å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼‰</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>ä¸‹è½½èµ„æºï¼š<a href="https://github.com/RedisBloom/RedisBloom/archive/v2.2.3.tar.gz">å¸ƒéš†è¿‡æ»¤å™¨2.2.3ä¸‹è½½</a></li>
<li>åœ¨ redis.conf ä¸­å¼•å…¥æ¨¡å—</li>
<li>é‡æ–°å¯åŠ¨redis</li>
</ul>
</blockquote>
<h4 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h4><h5 id="è§£å‹æ–‡ä»¶"><a href="#è§£å‹æ–‡ä»¶" class="headerlink" title="è§£å‹æ–‡ä»¶"></a>è§£å‹æ–‡ä»¶</h5><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶</span></span><br><span class="line">tar -xzvf RedisBloom-2.2.3.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ï¼ˆè¿›å…¥RedisBloom-2.2.3ï¼‰</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class="line">[root@horse bloom]<span class="comment"># cd RedisBloom-2.2.3/</span></span><br><span class="line">[root@horse RedisBloom-2.2.3]<span class="comment"># ll</span></span><br><span class="line">total 380</span><br><span class="line">-rw-rw-r-- 1 root root    211 Jul  9  2020 changelog</span><br><span class="line">drwxrwxr-x 2 root root   4096 Jul 28 16:33 contrib</span><br><span class="line">-rw-rw-r-- 1 root root    405 Jul  9  2020 Dockerfile</span><br><span class="line">drwxrwxr-x 3 root root   4096 Jul  9  2020 docs</span><br><span class="line">-rw-rw-r-- 1 root root   5794 Jul  9  2020 LICENSE</span><br><span class="line">-rw-rw-r-- 1 root root   2634 Jul  9  2020 Makefile</span><br><span class="line">-rw-rw-r-- 1 root root   1005 Jul  9  2020 mkdocs.yml</span><br><span class="line">-rw-rw-r-- 1 root root    511 Jul  9  2020 ramp.yml</span><br><span class="line">-rw-rw-r-- 1 root root   3162 Jul  9  2020 README.md</span><br><span class="line">-rwxr-xr-x 1 root root 331824 Jul 28 16:33 redisbloom.so  <span class="comment"># éœ€è¦å¼•å…¥çš„æ–‡ä»¶</span></span><br><span class="line">drwxrwxr-x 2 root root   4096 Jul 28 16:33 rmutil</span><br><span class="line">drwxrwxr-x 2 root root   4096 Jul 28 16:33 src</span><br><span class="line">drwxrwxr-x 2 root root   4096 Jul  9  2020 tests</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="redis-confé…ç½®"><a href="#redis-confé…ç½®" class="headerlink" title="redis.confé…ç½®"></a>redis.confé…ç½®</h5><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨redis.conf ä¸­å¼•å…¥æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================åŠ è½½å¤–éƒ¨æ¨¡å—====================</span></span><br><span class="line"><span class="comment"># é…ç½®åŠ è½½å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆä»¥ç»å¯¹è·¯å¾„å¼•å…¥ï¼‰</span></span><br><span class="line"></span><br><span class="line">loadmodule /usr/<span class="built_in">local</span>/redis/redis-6.2.1/bloom/RedisBloom-2.2.3/redisbloom.so</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h5 id="é‡å¯reids"><a href="#é‡å¯reids" class="headerlink" title="é‡å¯reids"></a>é‡å¯reids</h5><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="comment"># æŸ¥çœ‹redisçš„é‡å¯æ—¥å¿—ï¼ŒæˆåŠŸåŠ è½½é…ç½®æ¨¡å—</span></span><br><span class="line"> </span><br><span class="line">13744:C 28 Jul 2021 16:43:31.292 <span class="comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=13744, just started</span></span><br><span class="line">13744:C 28 Jul 2021 16:43:31.292 <span class="comment"># Configuration loaded</span></span><br><span class="line">13744:M 28 Jul 2021 16:43:31.293 * monotonic clock: POSIX clock_gettime</span><br><span class="line">13744:M 28 Jul 2021 16:43:31.293 * Running mode=standalone, port=6379.</span><br><span class="line">13744:M 28 Jul 2021 16:43:31.293 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">13744:M 28 Jul 2021 16:43:31.293 <span class="comment"># Server initialized</span></span><br><span class="line">13744:M 28 Jul 2021 16:43:31.293 <span class="comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span></span><br><span class="line"></span><br><span class="line">13744:M 28 Jul 2021 16:43:31.296 * Module <span class="string">'bf'</span> loaded from /usr/<span class="built_in">local</span>/redis/redis-6.2.1/bloom/RedisBloom-2.2.3/redisbloom.so  <span class="comment"># æ—¥å¿—æ˜¾ç¤ºï¼šæ¨¡å—å·²åŠ è½½</span></span><br><span class="line"></span><br><span class="line">13744:M 28 Jul 2021 16:43:31.313 * Loading RDB produced by version 6.2.1</span><br><span class="line">13744:M 28 Jul 2021 16:43:31.313 * RDB age 4822571 seconds</span><br><span class="line">13744:M 28 Jul 2021 16:43:31.313 * RDB memory usage when created 0.83 Mb</span><br><span class="line">13744:M 28 Jul 2021 16:43:31.313 * DB loaded from disk: 0.017 seconds</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="LinuxæœåŠ¡å™¨"><a href="#LinuxæœåŠ¡å™¨" class="headerlink" title="LinuxæœåŠ¡å™¨"></a>LinuxæœåŠ¡å™¨</h2><h3 id="è„šæœ¬ç¤ºä¾‹"><a href="#è„šæœ¬ç¤ºä¾‹" class="headerlink" title="è„šæœ¬ç¤ºä¾‹"></a>è„šæœ¬ç¤ºä¾‹</h3><blockquote>
<p>ä¸‹é¢è®°å½•çš„æ˜¯ä¸€äº›å¹³å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„è„šæœ¬</p>
</blockquote>
<h4 id="shellå¸¸ç”¨è¿ç®—ç¬¦"><a href="#shellå¸¸ç”¨è¿ç®—ç¬¦" class="headerlink" title="shellå¸¸ç”¨è¿ç®—ç¬¦"></a>shellå¸¸ç”¨è¿ç®—ç¬¦</h4><p><img src="https://cdn.jsdelivr.net/gh/java-horse/horse_second_images/img/20220127155731.png" alt="shellå¸¸ç”¨è¿ç®—ç¬¦"></p>
<h4 id="javaå¯åŠ¨è„šæœ¬"><a href="#javaå¯åŠ¨è„šæœ¬" class="headerlink" title="javaå¯åŠ¨è„šæœ¬"></a>javaå¯åŠ¨è„šæœ¬</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åºï¼Œå…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span></span><br><span class="line">APP_NAME=topsun-admin.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMçš„ä¸€äº›é…ç½®ï¼ˆå¯¹äºé¡¹ç›®å¯åŠ¨ç¯å¢ƒè¦æ±‚è¾ƒé«˜æ—¶ï¼Œå¯ä»¥è¿›è¡Œé…ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦è¿›è¡Œé…ç½®ï¼‰</span></span><br><span class="line">JAVA_OPTS=<span class="string">'-Xms48g -Xmx48g -XX:SurvivorRatio=6 -XX:NewRatio=2</span></span><br><span class="line"><span class="string">-XX:+PrintGCDetails</span></span><br><span class="line"><span class="string">-XX:+PrintGCDateStamps</span></span><br><span class="line"><span class="string">-Xloggc:/home/gclog/gc-%t.log</span></span><br><span class="line"><span class="string">-XX:+UseGCLogFileRotation</span></span><br><span class="line"><span class="string">-XX:NumberOfGCLogFiles=1000</span></span><br><span class="line"><span class="string">-XX:GCLogFileSize=300M</span></span><br><span class="line"><span class="string">-XX:+PrintTenuringDistribution</span></span><br><span class="line"><span class="string">-XX:+PrintHeapAtGC</span></span><br><span class="line"><span class="string">-XX:+PrintGCApplicationStoppedTime</span></span><br><span class="line"><span class="string">-XX:+PrintReferenceGC</span></span><br><span class="line"><span class="string">-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5002'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶çš„åˆ«åï¼ˆä¾‹å¦‚ï¼šapplication-cprod.ymlï¼Œapplication-ctest.ymlï¼‰</span></span><br><span class="line">ENV=cprod</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨è¯´æ˜ï¼Œç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"è„šæœ¬å¯åŠ¨å‘½ä»¤è¯´æ˜: sh æ‰§è¡Œè„šæœ¬åç§°.sh [start|stop|restart|status]"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line"><span class="function"><span class="title">is_exist</span></span>(){</span><br><span class="line">  pid=`ps -ef|grep <span class="variable">$APP_NAME</span>|grep -v grep|awk <span class="string">'{print $2}'</span>`</span><br><span class="line">  <span class="comment">#å¦‚æœä¸å­˜åœ¨è¿”å›1ï¼Œå­˜åœ¨è¿”å›0</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">${pid}</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆå¦‚æœæ²¡æœ‰å¯ç”¨JVMç›¸å…³é…ç½®ï¼Œä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="function"><span class="title">is_bind</span></span>(){</span><br><span class="line">  port=`netstat -tln | grep 5002 `</span><br><span class="line">  <span class="comment">#å¦‚æœè¢«å ç”¨1ï¼Œå¦åˆ™è¿”å›0</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">${port}</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">return</span> 0</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${port}</span>"</span></span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>(){</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${APP_NAME}</span> is already running! peocess pid=<span class="variable">${pid}</span>"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment">#nohup java -jar $APP_NAME --spring.profiles.active=$ENV &gt;/dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line">	<span class="built_in">source</span> /etc/profile;    </span><br><span class="line">	nohup java <span class="variable">$JAVA_OPTS</span> -jar /home/yh/<span class="variable">$APP_NAME</span> --spring.profiles.active=<span class="variable">$ENV</span> --topsun.scheduler.autoStart=<span class="literal">true</span> &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">${APP_NAME}</span> is running"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>(){</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${APP_NAME}</span> is not running"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºè¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">status</span></span>(){</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${APP_NAME}</span> is running. pid is <span class="variable">${pid}</span>"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${APP_NAME}</span> is not running."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯</span></span><br><span class="line"><span class="function"><span class="title">restart</span></span>(){</span><br><span class="line">  stop</span><br><span class="line">  is_bind</span><br><span class="line">  <span class="keyword">while</span> [ $? -eq <span class="string">"1"</span> ];</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    sleep 0.1</span><br><span class="line">    is_bind</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  start</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®è¾“å…¥å‚æ•°ï¼Œé€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">  <span class="string">"start"</span>)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">"stop"</span>)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">"status"</span>)</span><br><span class="line">    status</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">"restart"</span>)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">""</span>)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    usage</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</div></blockquote>]]></content>
      <categories>
        <category>å¼€å‘æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Redis</tag>
        <tag>Docker</tag>
        <tag>MyBatis</tag>
        <tag>Nginx</tag>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
</search>
